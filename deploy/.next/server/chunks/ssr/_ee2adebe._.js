module.exports=[4365,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=(a,b,c,d,e,f,g,h)=>{let i=document.documentElement,j=["light","dark"];function k(b){var c;(Array.isArray(a)?a:[a]).forEach(a=>{let c="class"===a,d=c&&f?e.map(a=>f[a]||a):e;c?(i.classList.remove(...d),i.classList.add(f&&f[b]?f[b]:b)):i.setAttribute(a,b)}),c=b,h&&j.includes(c)&&(i.style.colorScheme=c)}if(d)k(d);else try{let a=localStorage.getItem(b)||c,d=g&&"system"===a?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":a;k(d)}catch(a){}},e=["light","dark"],f="(prefers-color-scheme: dark)",g=c.createContext(void 0),h=a=>c.useContext(g)?c.createElement(c.Fragment,null,a.children):c.createElement(j,{...a}),i=["light","dark"],j=({forcedTheme:a,disableTransitionOnChange:b=!1,enableSystem:d=!0,enableColorScheme:h=!0,storageKey:j="theme",themes:o=i,defaultTheme:p=d?"system":"light",attribute:q="data-theme",value:r,children:s,nonce:t,scriptProps:u})=>{let[v,w]=c.useState(()=>l(j,p)),[x,y]=c.useState(()=>"system"===v?n():v),z=r?Object.values(r):o,A=c.useCallback(a=>{let c=a;if(!c)return;"system"===a&&d&&(c=n());let f=r?r[c]:c,g=b?m(t):null,i=document.documentElement,j=a=>{"class"===a?(i.classList.remove(...z),f&&i.classList.add(f)):a.startsWith("data-")&&(f?i.setAttribute(a,f):i.removeAttribute(a))};if(Array.isArray(q)?q.forEach(j):j(q),h){let a=e.includes(p)?p:null,b=e.includes(c)?c:a;i.style.colorScheme=b}null==g||g()},[t]),B=c.useCallback(a=>{let b="function"==typeof a?a(v):a;w(b);try{localStorage.setItem(j,b)}catch(a){}},[v]),C=c.useCallback(b=>{y(n(b)),"system"===v&&d&&!a&&A("system")},[v,a]);c.useEffect(()=>{let a=window.matchMedia(f);return a.addListener(C),C(a),()=>a.removeListener(C)},[C]),c.useEffect(()=>{let a=a=>{a.key===j&&(a.newValue?w(a.newValue):B(p))};return window.addEventListener("storage",a),()=>window.removeEventListener("storage",a)},[B]),c.useEffect(()=>{A(null!=a?a:v)},[a,v]);let D=c.useMemo(()=>({theme:v,setTheme:B,forcedTheme:a,resolvedTheme:"system"===v?x:v,themes:d?[...o,"system"]:o,systemTheme:d?x:void 0}),[v,B,a,x,d,o]);return c.createElement(g.Provider,{value:D},c.createElement(k,{forcedTheme:a,storageKey:j,attribute:q,enableSystem:d,enableColorScheme:h,defaultTheme:p,value:r,themes:o,nonce:t,scriptProps:u}),s)},k=c.memo(({forcedTheme:a,storageKey:b,attribute:e,enableSystem:f,enableColorScheme:g,defaultTheme:h,value:i,themes:j,nonce:k,scriptProps:l})=>{let m=JSON.stringify([e,b,h,a,j,i,f,g]).slice(1,-1);return c.createElement("script",{...l,suppressHydrationWarning:!0,nonce:k,dangerouslySetInnerHTML:{__html:`(${d.toString()})(${m})`}})}),l=(a,b)=>{},m=a=>{let b=document.createElement("style");return a&&b.setAttribute("nonce",a),b.appendChild(document.createTextNode("*,*::before,*::after{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),document.head.appendChild(b),()=>{window.getComputedStyle(document.body),setTimeout(()=>{document.head.removeChild(b)},1)}},n=a=>(a||(a=window.matchMedia(f)),a.matches?"dark":"light");function o({children:a,...c}){return(0,b.jsx)(h,{...c,children:a})}a.s(["ThemeProvider",()=>o],4365)},91416,a=>{"use strict";var b,c=a.i(87924),d=a.i(50944),e=a.i(72131),f=a.i(97895),g=a.i(38246),h=a.i(56716),i=a.i(2932),j=a.i(70106);let k=(0,j.default)("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]),l=(0,j.default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var m=a.i(35112),n=a.i(50104),o=a.i(7554),p=a.i(30553),q=a.i(25152),r=a.i(70121),s=e.createContext(void 0),t=a.i(77192),u=a.i(72752),v=e[" useId ".trim().toString()]||(()=>void 0),w=0;function x(a){let[b,c]=e.useState(v());return(0,u.useLayoutEffect)(()=>{a||c(a=>a??String(w++))},[a]),a||(b?`radix-${b}`:"")}function y(a){var b;let d,f=(b=a,(d=e.forwardRef((a,b)=>{let{children:c,...d}=a;if(e.isValidElement(c)){var f;let a,g,h=(f=c,(g=(a=Object.getOwnPropertyDescriptor(f.props,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?f.ref:(g=(a=Object.getOwnPropertyDescriptor(f,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?f.props.ref:f.props.ref||f.ref),i=function(a,b){let c={...b};for(let d in b){let e=a[d],f=b[d];/^on[A-Z]/.test(d)?e&&f?c[d]=(...a)=>{let b=f(...a);return e(...a),b}:e&&(c[d]=e):"style"===d?c[d]={...e,...f}:"className"===d&&(c[d]=[e,f].filter(Boolean).join(" "))}return{...a,...c}}(d,c.props);return c.type!==e.Fragment&&(i.ref=b?(0,r.composeRefs)(b,h):h),e.cloneElement(c,i)}return e.Children.count(c)>1?e.Children.only(null):null})).displayName=`${b}.SlotClone`,d),g=e.forwardRef((a,b)=>{let{children:d,...g}=a,h=e.Children.toArray(d),i=h.find(A);if(i){let a=i.props.children,d=h.map(b=>b!==i?b:e.Children.count(a)>1?e.Children.only(null):e.isValidElement(a)?a.props.children:null);return(0,c.jsx)(f,{...g,ref:b,children:e.isValidElement(a)?e.cloneElement(a,void 0,d):null})}return(0,c.jsx)(f,{...g,ref:b,children:d})});return g.displayName=`${a}.Slot`,g}var z=Symbol("radix.slottable");function A(a){return e.isValidElement(a)&&"function"==typeof a.type&&"__radixId"in a.type&&a.type.__radixId===z}function B(a){let b=a+"CollectionProvider",[d,f]=(0,n.createContextScope)(b),[g,h]=d(b,{collectionRef:{current:null},itemMap:new Map}),i=a=>{let{scope:b,children:d}=a,f=e.default.useRef(null),h=e.default.useRef(new Map).current;return(0,c.jsx)(g,{scope:b,itemMap:h,collectionRef:f,children:d})};i.displayName=b;let j=a+"CollectionSlot",k=y(j),l=e.default.forwardRef((a,b)=>{let{scope:d,children:e}=a,f=h(j,d),g=(0,r.useComposedRefs)(b,f.collectionRef);return(0,c.jsx)(k,{ref:g,children:e})});l.displayName=j;let m=a+"CollectionItemSlot",o="data-radix-collection-item",p=y(m),q=e.default.forwardRef((a,b)=>{let{scope:d,children:f,...g}=a,i=e.default.useRef(null),j=(0,r.useComposedRefs)(b,i),k=h(m,d);return e.default.useEffect(()=>(k.itemMap.set(i,{ref:i,...g}),()=>void k.itemMap.delete(i))),(0,c.jsx)(p,{...{[o]:""},ref:j,children:f})});return q.displayName=m,[{Provider:i,Slot:l,ItemSlot:q},function(b){let c=h(a+"CollectionConsumer",b);return e.default.useCallback(()=>{let a=c.collectionRef.current;if(!a)return[];let b=Array.from(a.querySelectorAll(`[${o}]`));return Array.from(c.itemMap.values()).sort((a,c)=>b.indexOf(a.ref.current)-b.indexOf(c.ref.current))},[c.collectionRef,c.itemMap])},f]}var C=new WeakMap;function D(a,b){var c,d;let e,f,g;if("at"in Array.prototype)return Array.prototype.at.call(a,b);let h=(c=a,d=b,e=c.length,(g=(f=E(d))>=0?f:e+f)<0||g>=e?-1:g);return -1===h?void 0:a[h]}function E(a){return a!=a||0===a?0:Math.trunc(a)}function F(a){let b=e.useRef(a);return e.useEffect(()=>{b.current=a}),e.useMemo(()=>(...a)=>b.current?.(...a),[])}(class a extends Map{#a;constructor(a){super(a),this.#a=[...super.keys()],C.set(this,!0)}set(a,b){return C.get(this)&&(this.has(a)?this.#a[this.#a.indexOf(a)]=a:this.#a.push(a)),super.set(a,b),this}insert(a,b,c){let d,e=this.has(b),f=this.#a.length,g=E(a),h=g>=0?g:f+g,i=h<0||h>=f?-1:h;if(i===this.size||e&&i===this.size-1||-1===i)return this.set(b,c),this;let j=this.size+ +!e;g<0&&h++;let k=[...this.#a],l=!1;for(let a=h;a<j;a++)if(h===a){let f=k[a];k[a]===b&&(f=k[a+1]),e&&this.delete(b),d=this.get(f),this.set(b,c)}else{l||k[a-1]!==b||(l=!0);let c=k[l?a:a-1],e=d;d=this.get(c),this.delete(c),this.set(c,e)}return this}with(b,c,d){let e=new a(this);return e.insert(b,c,d),e}before(a){let b=this.#a.indexOf(a)-1;if(!(b<0))return this.entryAt(b)}setBefore(a,b,c){let d=this.#a.indexOf(a);return -1===d?this:this.insert(d,b,c)}after(a){let b=this.#a.indexOf(a);if(-1!==(b=-1===b||b===this.size-1?-1:b+1))return this.entryAt(b)}setAfter(a,b,c){let d=this.#a.indexOf(a);return -1===d?this:this.insert(d+1,b,c)}first(){return this.entryAt(0)}last(){return this.entryAt(-1)}clear(){return this.#a=[],super.clear()}delete(a){let b=super.delete(a);return b&&this.#a.splice(this.#a.indexOf(a),1),b}deleteAt(a){let b=this.keyAt(a);return void 0!==b&&this.delete(b)}at(a){let b=D(this.#a,a);if(void 0!==b)return this.get(b)}entryAt(a){let b=D(this.#a,a);if(void 0!==b)return[b,this.get(b)]}indexOf(a){return this.#a.indexOf(a)}keyAt(a){return D(this.#a,a)}from(a,b){let c=this.indexOf(a);if(-1===c)return;let d=c+b;return d<0&&(d=0),d>=this.size&&(d=this.size-1),this.at(d)}keyFrom(a,b){let c=this.indexOf(a);if(-1===c)return;let d=c+b;return d<0&&(d=0),d>=this.size&&(d=this.size-1),this.keyAt(d)}find(a,b){let c=0;for(let d of this){if(Reflect.apply(a,b,[d,c,this]))return d;c++}}findIndex(a,b){let c=0;for(let d of this){if(Reflect.apply(a,b,[d,c,this]))return c;c++}return -1}filter(b,c){let d=[],e=0;for(let a of this)Reflect.apply(b,c,[a,e,this])&&d.push(a),e++;return new a(d)}map(b,c){let d=[],e=0;for(let a of this)d.push([a[0],Reflect.apply(b,c,[a,e,this])]),e++;return new a(d)}reduce(...a){let[b,c]=a,d=0,e=c??this.at(0);for(let c of this)e=0===d&&1===a.length?c:Reflect.apply(b,this,[e,c,d,this]),d++;return e}reduceRight(...a){let[b,c]=a,d=c??this.at(-1);for(let c=this.size-1;c>=0;c--){let e=this.at(c);d=c===this.size-1&&1===a.length?e:Reflect.apply(b,this,[d,e,c,this])}return d}toSorted(b){return new a([...this.entries()].sort(b))}toReversed(){let b=new a;for(let a=this.size-1;a>=0;a--){let c=this.keyAt(a),d=this.get(c);b.set(c,d)}return b}toSpliced(...b){let c=[...this.entries()];return c.splice(...b),new a(c)}slice(b,c){let d=new a,e=this.size-1;if(void 0===b)return d;b<0&&(b+=this.size),void 0!==c&&c>0&&(e=c-1);for(let a=b;a<=e;a++){let b=this.keyAt(a),c=this.get(b);d.set(b,c)}return d}every(a,b){let c=0;for(let d of this){if(!Reflect.apply(a,b,[d,c,this]))return!1;c++}return!0}some(a,b){let c=0;for(let d of this){if(Reflect.apply(a,b,[d,c,this]))return!0;c++}return!1}});var G="dismissableLayer.update",H=e.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),I=e.forwardRef((a,d)=>{let{disableOutsidePointerEvents:f=!1,onEscapeKeyDown:g,onPointerDownOutside:h,onFocusOutside:i,onInteractOutside:j,onDismiss:k,...l}=a,m=e.useContext(H),[n,q]=e.useState(null),s=n?.ownerDocument??globalThis?.document,[,t]=e.useState({}),u=(0,r.useComposedRefs)(d,a=>q(a)),v=Array.from(m.layers),[w]=[...m.layersWithOutsidePointerEventsDisabled].slice(-1),x=v.indexOf(w),y=n?v.indexOf(n):-1,z=m.layersWithOutsidePointerEventsDisabled.size>0,A=y>=x,B=function(a,b=globalThis?.document){let c=F(a),d=e.useRef(!1),f=e.useRef(()=>{});return e.useEffect(()=>{let a=a=>{if(a.target&&!d.current){let d=function(){K("dismissableLayer.pointerDownOutside",c,e,{discrete:!0})},e={originalEvent:a};"touch"===a.pointerType?(b.removeEventListener("click",f.current),f.current=d,b.addEventListener("click",f.current,{once:!0})):d()}else b.removeEventListener("click",f.current);d.current=!1},e=window.setTimeout(()=>{b.addEventListener("pointerdown",a)},0);return()=>{window.clearTimeout(e),b.removeEventListener("pointerdown",a),b.removeEventListener("click",f.current)}},[b,c]),{onPointerDownCapture:()=>d.current=!0}}(a=>{let b=a.target,c=[...m.branches].some(a=>a.contains(b));A&&!c&&(h?.(a),j?.(a),a.defaultPrevented||k?.())},s),C=function(a,b=globalThis?.document){let c=F(a),d=e.useRef(!1);return e.useEffect(()=>{let a=a=>{a.target&&!d.current&&K("dismissableLayer.focusOutside",c,{originalEvent:a},{discrete:!1})};return b.addEventListener("focusin",a),()=>b.removeEventListener("focusin",a)},[b,c]),{onFocusCapture:()=>d.current=!0,onBlurCapture:()=>d.current=!1}}(a=>{let b=a.target;![...m.branches].some(a=>a.contains(b))&&(i?.(a),j?.(a),a.defaultPrevented||k?.())},s);return!function(a,b=globalThis?.document){let c=F(a);e.useEffect(()=>{let a=a=>{"Escape"===a.key&&c(a)};return b.addEventListener("keydown",a,{capture:!0}),()=>b.removeEventListener("keydown",a,{capture:!0})},[c,b])}(a=>{y===m.layers.size-1&&(g?.(a),!a.defaultPrevented&&k&&(a.preventDefault(),k()))},s),e.useEffect(()=>{if(n)return f&&(0===m.layersWithOutsidePointerEventsDisabled.size&&(b=s.body.style.pointerEvents,s.body.style.pointerEvents="none"),m.layersWithOutsidePointerEventsDisabled.add(n)),m.layers.add(n),J(),()=>{f&&1===m.layersWithOutsidePointerEventsDisabled.size&&(s.body.style.pointerEvents=b)}},[n,s,f,m]),e.useEffect(()=>()=>{n&&(m.layers.delete(n),m.layersWithOutsidePointerEventsDisabled.delete(n),J())},[n,m]),e.useEffect(()=>{let a=()=>t({});return document.addEventListener(G,a),()=>document.removeEventListener(G,a)},[]),(0,c.jsx)(p.Primitive.div,{...l,ref:u,style:{pointerEvents:z?A?"auto":"none":void 0,...a.style},onFocusCapture:(0,o.composeEventHandlers)(a.onFocusCapture,C.onFocusCapture),onBlurCapture:(0,o.composeEventHandlers)(a.onBlurCapture,C.onBlurCapture),onPointerDownCapture:(0,o.composeEventHandlers)(a.onPointerDownCapture,B.onPointerDownCapture)})});function J(){let a=new CustomEvent(G);document.dispatchEvent(a)}function K(a,b,c,{discrete:d}){let e=c.originalEvent.target,f=new CustomEvent(a,{bubbles:!1,cancelable:!0,detail:c});b&&e.addEventListener(a,b,{once:!0}),d?(0,p.dispatchDiscreteCustomEvent)(e,f):e.dispatchEvent(f)}I.displayName="DismissableLayer",e.forwardRef((a,b)=>{let d=e.useContext(H),f=e.useRef(null),g=(0,r.useComposedRefs)(b,f);return e.useEffect(()=>{let a=f.current;if(a)return d.branches.add(a),()=>{d.branches.delete(a)}},[d.branches]),(0,c.jsx)(p.Primitive.div,{...a,ref:g})}).displayName="DismissableLayerBranch";var L=a.i(77994),M=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),N=e.forwardRef((a,b)=>(0,c.jsx)(p.Primitive.span,{...a,ref:b,style:{...M,...a.style}}));N.displayName="VisuallyHidden";var O="NavigationMenu",[P,Q,R]=B(O),[S,T,U]=B(O),[V,W]=(0,n.createContextScope)(O,[R,U]),[X,Y]=V(O),[Z,$]=V(O),_=e.forwardRef((a,b)=>{let d,{__scopeNavigationMenu:f,value:g,onValueChange:h,defaultValue:i,delayDuration:j=200,skipDelayDuration:k=300,orientation:l="horizontal",dir:m,...n}=a,[o,t]=e.useState(null),u=(0,r.useComposedRefs)(b,a=>t(a)),v=(d=e.useContext(s),m||d||"ltr"),w=e.useRef(0),x=e.useRef(0),y=e.useRef(0),[z,A]=e.useState(!0),[B,C]=(0,q.useControllableState)({prop:g,onChange:a=>{let b=k>0;""!==a?(window.clearTimeout(y.current),b&&A(!1)):(window.clearTimeout(y.current),y.current=window.setTimeout(()=>A(!0),k)),h?.(a)},defaultProp:i??"",caller:O}),D=e.useCallback(()=>{window.clearTimeout(x.current),x.current=window.setTimeout(()=>C(""),150)},[C]),E=e.useCallback(a=>{window.clearTimeout(x.current),C(a)},[C]),F=e.useCallback(a=>{B===a?window.clearTimeout(x.current):w.current=window.setTimeout(()=>{window.clearTimeout(x.current),C(a)},j)},[B,C,j]);return e.useEffect(()=>()=>{window.clearTimeout(w.current),window.clearTimeout(x.current),window.clearTimeout(y.current)},[]),(0,c.jsx)(ab,{scope:f,isRootMenu:!0,value:B,dir:v,orientation:l,rootNavigationMenu:o,onTriggerEnter:a=>{window.clearTimeout(w.current),z?F(a):E(a)},onTriggerLeave:()=>{window.clearTimeout(w.current),D()},onContentEnter:()=>window.clearTimeout(x.current),onContentLeave:D,onItemSelect:a=>{C(b=>b===a?"":a)},onItemDismiss:()=>C(""),children:(0,c.jsx)(p.Primitive.nav,{"aria-label":"Main","data-orientation":l,dir:v,...n,ref:u})})});_.displayName=O;var aa="NavigationMenuSub";e.forwardRef((a,b)=>{let{__scopeNavigationMenu:d,value:e,onValueChange:f,defaultValue:g,orientation:h="horizontal",...i}=a,j=Y(aa,d),[k,l]=(0,q.useControllableState)({prop:e,onChange:f,defaultProp:g??"",caller:aa});return(0,c.jsx)(ab,{scope:d,isRootMenu:!1,value:k,dir:j.dir,orientation:h,rootNavigationMenu:j.rootNavigationMenu,onTriggerEnter:a=>l(a),onItemSelect:a=>l(a),onItemDismiss:()=>l(""),children:(0,c.jsx)(p.Primitive.div,{"data-orientation":h,...i,ref:b})})}).displayName=aa;var ab=a=>{let{scope:b,isRootMenu:d,rootNavigationMenu:f,dir:g,orientation:h,children:i,value:j,onItemSelect:k,onItemDismiss:l,onTriggerEnter:m,onTriggerLeave:n,onContentEnter:o,onContentLeave:p}=a,[q,r]=e.useState(null),[s,t]=e.useState(new Map),[u,v]=e.useState(null);return(0,c.jsx)(X,{scope:b,isRootMenu:d,rootNavigationMenu:f,value:j,previousValue:(0,L.usePrevious)(j),baseId:x(),dir:g,orientation:h,viewport:q,onViewportChange:r,indicatorTrack:u,onIndicatorTrackChange:v,onTriggerEnter:F(m),onTriggerLeave:F(n),onContentEnter:F(o),onContentLeave:F(p),onItemSelect:F(k),onItemDismiss:F(l),onViewportContentChange:e.useCallback((a,b)=>{t(c=>(c.set(a,b),new Map(c)))},[]),onViewportContentRemove:e.useCallback(a=>{t(b=>b.has(a)?(b.delete(a),new Map(b)):b)},[]),children:(0,c.jsx)(P.Provider,{scope:b,children:(0,c.jsx)(Z,{scope:b,items:s,children:i})})})},ac="NavigationMenuList",ad=e.forwardRef((a,b)=>{let{__scopeNavigationMenu:d,...e}=a,f=Y(ac,d),g=(0,c.jsx)(p.Primitive.ul,{"data-orientation":f.orientation,...e,ref:b});return(0,c.jsx)(p.Primitive.div,{style:{position:"relative"},ref:f.onIndicatorTrackChange,children:(0,c.jsx)(P.Slot,{scope:d,children:f.isRootMenu?(0,c.jsx)(ax,{asChild:!0,children:g}):g})})});ad.displayName=ac;var ae="NavigationMenuItem",[af,ag]=V(ae),ah=e.forwardRef((a,b)=>{let{__scopeNavigationMenu:d,value:f,...g}=a,h=x(),i=e.useRef(null),j=e.useRef(null),k=e.useRef(null),l=e.useRef(()=>{}),m=e.useRef(!1),n=e.useCallback((a="start")=>{if(i.current){l.current();let b=aA(i.current);b.length&&aB("start"===a?b:b.reverse())}},[]),o=e.useCallback(()=>{if(i.current){var a;let b=aA(i.current);b.length&&((a=b).forEach(a=>{a.dataset.tabindex=a.getAttribute("tabindex")||"",a.setAttribute("tabindex","-1")}),l.current=()=>{a.forEach(a=>{let b=a.dataset.tabindex;a.setAttribute("tabindex",b)})})}},[]);return(0,c.jsx)(af,{scope:d,value:f||h||"LEGACY_REACT_AUTO_VALUE",triggerRef:j,contentRef:i,focusProxyRef:k,wasEscapeCloseRef:m,onEntryKeyDown:n,onFocusProxyEnter:n,onRootContentClose:o,onContentFocusOutside:o,children:(0,c.jsx)(p.Primitive.li,{...g,ref:b})})});ah.displayName=ae;var ai="NavigationMenuTrigger",aj=e.forwardRef((a,b)=>{let{__scopeNavigationMenu:d,disabled:f,...g}=a,h=Y(ai,a.__scopeNavigationMenu),i=ag(ai,a.__scopeNavigationMenu),j=e.useRef(null),k=(0,r.useComposedRefs)(j,i.triggerRef,b),l=aE(h.baseId,i.value),m=aF(h.baseId,i.value),n=e.useRef(!1),q=e.useRef(!1),s=i.value===h.value;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(P.ItemSlot,{scope:d,value:i.value,children:(0,c.jsx)(az,{asChild:!0,children:(0,c.jsx)(p.Primitive.button,{id:l,disabled:f,"data-disabled":f?"":void 0,"data-state":aD(s),"aria-expanded":s,"aria-controls":m,...g,ref:k,onPointerEnter:(0,o.composeEventHandlers)(a.onPointerEnter,()=>{q.current=!1,i.wasEscapeCloseRef.current=!1}),onPointerMove:(0,o.composeEventHandlers)(a.onPointerMove,aG(()=>{f||q.current||i.wasEscapeCloseRef.current||n.current||(h.onTriggerEnter(i.value),n.current=!0)})),onPointerLeave:(0,o.composeEventHandlers)(a.onPointerLeave,aG(()=>{f||(h.onTriggerLeave(),n.current=!1)})),onClick:(0,o.composeEventHandlers)(a.onClick,()=>{h.onItemSelect(i.value),q.current=s}),onKeyDown:(0,o.composeEventHandlers)(a.onKeyDown,a=>{let b={horizontal:"ArrowDown",vertical:"rtl"===h.dir?"ArrowLeft":"ArrowRight"}[h.orientation];s&&a.key===b&&(i.onEntryKeyDown(),a.preventDefault())})})})}),s&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(N,{"aria-hidden":!0,tabIndex:0,ref:i.focusProxyRef,onFocus:a=>{let b=i.contentRef.current,c=a.relatedTarget,d=c===j.current,e=b?.contains(c);(d||!e)&&i.onFocusProxyEnter(d?"start":"end")}}),h.viewport&&(0,c.jsx)("span",{"aria-owns":m})]})]})});aj.displayName=ai;var ak="navigationMenu.linkSelect",al=e.forwardRef((a,b)=>{let{__scopeNavigationMenu:d,active:e,onSelect:f,...g}=a;return(0,c.jsx)(az,{asChild:!0,children:(0,c.jsx)(p.Primitive.a,{"data-active":e?"":void 0,"aria-current":e?"page":void 0,...g,ref:b,onClick:(0,o.composeEventHandlers)(a.onClick,a=>{let b=a.target,c=new CustomEvent(ak,{bubbles:!0,cancelable:!0});if(b.addEventListener(ak,a=>f?.(a),{once:!0}),(0,p.dispatchDiscreteCustomEvent)(b,c),!c.defaultPrevented&&!a.metaKey){let a=new CustomEvent(as,{bubbles:!0,cancelable:!0});(0,p.dispatchDiscreteCustomEvent)(b,a)}},{checkForDefaultPrevented:!1})})})});al.displayName="NavigationMenuLink";var am="NavigationMenuIndicator",an=e.forwardRef((a,b)=>{let{forceMount:d,...e}=a,f=Y(am,a.__scopeNavigationMenu),g=!!f.value;return f.indicatorTrack?m.default.createPortal((0,c.jsx)(t.Presence,{present:d||g,children:(0,c.jsx)(ao,{...e,ref:b})}),f.indicatorTrack):null});an.displayName=am;var ao=e.forwardRef((a,b)=>{let{__scopeNavigationMenu:d,...f}=a,g=Y(am,d),h=Q(d),[i,j]=e.useState(null),[k,l]=e.useState(null),m="horizontal"===g.orientation,n=!!g.value;e.useEffect(()=>{let a=h(),b=a.find(a=>a.value===g.value)?.ref.current;b&&j(b)},[h,g.value]);let o=()=>{i&&l({size:m?i.offsetWidth:i.offsetHeight,offset:m?i.offsetLeft:i.offsetTop})};return aC(i,o),aC(g.indicatorTrack,o),k?(0,c.jsx)(p.Primitive.div,{"aria-hidden":!0,"data-state":n?"visible":"hidden","data-orientation":g.orientation,...f,ref:b,style:{position:"absolute",...m?{left:0,width:k.size+"px",transform:`translateX(${k.offset}px)`}:{top:0,height:k.size+"px",transform:`translateY(${k.offset}px)`},...f.style}}):null}),ap="NavigationMenuContent",aq=e.forwardRef((a,b)=>{let{forceMount:d,...e}=a,f=Y(ap,a.__scopeNavigationMenu),g=ag(ap,a.__scopeNavigationMenu),h=(0,r.useComposedRefs)(g.contentRef,b),i=g.value===f.value,j={value:g.value,triggerRef:g.triggerRef,focusProxyRef:g.focusProxyRef,wasEscapeCloseRef:g.wasEscapeCloseRef,onContentFocusOutside:g.onContentFocusOutside,onRootContentClose:g.onRootContentClose,...e};return f.viewport?(0,c.jsx)(ar,{forceMount:d,...j,ref:h}):(0,c.jsx)(t.Presence,{present:d||i,children:(0,c.jsx)(at,{"data-state":aD(i),...j,ref:h,onPointerEnter:(0,o.composeEventHandlers)(a.onPointerEnter,f.onContentEnter),onPointerLeave:(0,o.composeEventHandlers)(a.onPointerLeave,aG(f.onContentLeave)),style:{pointerEvents:!i&&f.isRootMenu?"none":void 0,...j.style}})})});aq.displayName=ap;var ar=e.forwardRef((a,b)=>{let{onViewportContentChange:c,onViewportContentRemove:d}=Y(ap,a.__scopeNavigationMenu);return(0,u.useLayoutEffect)(()=>{c(a.value,{ref:b,...a})},[a,b,c]),(0,u.useLayoutEffect)(()=>()=>d(a.value),[a.value,d]),null}),as="navigationMenu.rootContentDismiss",at=e.forwardRef((a,b)=>{let{__scopeNavigationMenu:d,value:f,triggerRef:g,focusProxyRef:h,wasEscapeCloseRef:i,onRootContentClose:j,onContentFocusOutside:k,...l}=a,m=Y(ap,d),n=e.useRef(null),p=(0,r.useComposedRefs)(n,b),q=aE(m.baseId,f),s=aF(m.baseId,f),t=Q(d),u=e.useRef(null),{onItemDismiss:v}=m;e.useEffect(()=>{let a=n.current;if(m.isRootMenu&&a){let b=()=>{v(),j(),a.contains(document.activeElement)&&g.current?.focus()};return a.addEventListener(as,b),()=>a.removeEventListener(as,b)}},[m.isRootMenu,a.value,g,v,j]);let w=e.useMemo(()=>{let a=t().map(a=>a.value);"rtl"===m.dir&&a.reverse();let b=a.indexOf(m.value),c=a.indexOf(m.previousValue),d=f===m.value,e=c===a.indexOf(f);if(!d&&!e)return u.current;let g=(()=>{if(b!==c){if(d&&-1!==c)return b>c?"from-end":"from-start";if(e&&-1!==b)return b>c?"to-start":"to-end"}return null})();return u.current=g,g},[m.previousValue,m.value,m.dir,t,f]);return(0,c.jsx)(ax,{asChild:!0,children:(0,c.jsx)(I,{id:s,"aria-labelledby":q,"data-motion":w,"data-orientation":m.orientation,...l,ref:p,disableOutsidePointerEvents:!1,onDismiss:()=>{let a=new Event(as,{bubbles:!0,cancelable:!0});n.current?.dispatchEvent(a)},onFocusOutside:(0,o.composeEventHandlers)(a.onFocusOutside,a=>{k();let b=a.target;m.rootNavigationMenu?.contains(b)&&a.preventDefault()}),onPointerDownOutside:(0,o.composeEventHandlers)(a.onPointerDownOutside,a=>{let b=a.target,c=t().some(a=>a.ref.current?.contains(b)),d=m.isRootMenu&&m.viewport?.contains(b);(c||d||!m.isRootMenu)&&a.preventDefault()}),onKeyDown:(0,o.composeEventHandlers)(a.onKeyDown,a=>{let b=a.altKey||a.ctrlKey||a.metaKey;if("Tab"===a.key&&!b){let b=aA(a.currentTarget),c=document.activeElement,d=b.findIndex(a=>a===c);aB(a.shiftKey?b.slice(0,d).reverse():b.slice(d+1,b.length))?a.preventDefault():h.current?.focus()}}),onEscapeKeyDown:(0,o.composeEventHandlers)(a.onEscapeKeyDown,a=>{i.current=!0})})})}),au="NavigationMenuViewport",av=e.forwardRef((a,b)=>{let{forceMount:d,...e}=a,f=!!Y(au,a.__scopeNavigationMenu).value;return(0,c.jsx)(t.Presence,{present:d||f,children:(0,c.jsx)(aw,{...e,ref:b})})});av.displayName=au;var aw=e.forwardRef((a,b)=>{let{__scopeNavigationMenu:d,children:f,...g}=a,h=Y(au,d),i=(0,r.useComposedRefs)(b,h.onViewportChange),j=$(ap,a.__scopeNavigationMenu),[k,l]=e.useState(null),[m,n]=e.useState(null),q=k?k?.width+"px":void 0,s=k?k?.height+"px":void 0,u=!!h.value,v=u?h.value:h.previousValue;return aC(m,()=>{m&&l({width:m.offsetWidth,height:m.offsetHeight})}),(0,c.jsx)(p.Primitive.div,{"data-state":aD(u),"data-orientation":h.orientation,...g,ref:i,style:{pointerEvents:!u&&h.isRootMenu?"none":void 0,"--radix-navigation-menu-viewport-width":q,"--radix-navigation-menu-viewport-height":s,...g.style},onPointerEnter:(0,o.composeEventHandlers)(a.onPointerEnter,h.onContentEnter),onPointerLeave:(0,o.composeEventHandlers)(a.onPointerLeave,aG(h.onContentLeave)),children:Array.from(j.items).map(([a,{ref:b,forceMount:d,...e}])=>{let f=v===a;return(0,c.jsx)(t.Presence,{present:d||f,children:(0,c.jsx)(at,{...e,ref:(0,r.composeRefs)(b,a=>{f&&a&&n(a)})})},a)})})}),ax=e.forwardRef((a,b)=>{let{__scopeNavigationMenu:d,...e}=a,f=Y("FocusGroup",d);return(0,c.jsx)(S.Provider,{scope:d,children:(0,c.jsx)(S.Slot,{scope:d,children:(0,c.jsx)(p.Primitive.div,{dir:f.dir,...e,ref:b})})})}),ay=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],az=e.forwardRef((a,b)=>{let{__scopeNavigationMenu:d,...e}=a,f=T(d),g=Y("FocusGroupItem",d);return(0,c.jsx)(S.ItemSlot,{scope:d,children:(0,c.jsx)(p.Primitive.button,{...e,ref:b,onKeyDown:(0,o.composeEventHandlers)(a.onKeyDown,a=>{if(["Home","End",...ay].includes(a.key)){let b=f().map(a=>a.ref.current);if(["rtl"===g.dir?"ArrowRight":"ArrowLeft","ArrowUp","End"].includes(a.key)&&b.reverse(),ay.includes(a.key)){let c=b.indexOf(a.currentTarget);b=b.slice(c+1)}setTimeout(()=>aB(b)),a.preventDefault()}})})})});function aA(a){let b=[],c=document.createTreeWalker(a,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{let b="INPUT"===a.tagName&&"hidden"===a.type;return a.disabled||a.hidden||b?NodeFilter.FILTER_SKIP:a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;c.nextNode();)b.push(c.currentNode);return b}function aB(a){let b=document.activeElement;return a.some(a=>a===b||(a.focus(),document.activeElement!==b))}function aC(a,b){let c=F(b);(0,u.useLayoutEffect)(()=>{let b=0;if(a){let d=new ResizeObserver(()=>{cancelAnimationFrame(b),b=window.requestAnimationFrame(c)});return d.observe(a),()=>{window.cancelAnimationFrame(b),d.unobserve(a)}}},[a,c])}function aD(a){return a?"open":"closed"}function aE(a,b){return`${a}-trigger-${b}`}function aF(a,b){return`${a}-content-${b}`}function aG(a){return b=>"mouse"===b.pointerType?a(b):void 0}var aH=a.i(187);let aI=(0,j.default)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),aJ=e.forwardRef(({className:a,children:b,...d},e)=>(0,c.jsxs)(_,{ref:e,className:(0,f.cn)("relative z-10 flex max-w-max flex-1 items-center justify-center",a),...d,children:[b,(0,c.jsx)(aO,{})]}));aJ.displayName=_.displayName;let aK=e.forwardRef(({className:a,...b},d)=>(0,c.jsx)(ad,{ref:d,className:(0,f.cn)("group flex flex-1 list-none items-center justify-center gap-8",a),...b}));aK.displayName=ad.displayName;let aL=(0,aH.cva)("group inline-flex h-9 w-max items-center justify-center rounded-md bg-transparent px-2 py-2 text-sm font-medium transition-colors hover:text-accent focus:text-accent focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:text-accent"),aM=e.forwardRef(({className:a,children:b,...d},e)=>(0,c.jsxs)(aj,{ref:e,className:(0,f.cn)(aL(),"group",a),...d,children:[b," ",(0,c.jsx)(aI,{className:"relative top-px ml-1 h-3 w-3 transition duration-300 group-data-[state=open]:rotate-180","aria-hidden":"true"})]}));aM.displayName=aj.displayName;let aN=e.forwardRef(({className:a,...b},d)=>(0,c.jsx)(aq,{ref:d,className:(0,f.cn)("data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 top-0 left-0 w-full md:absolute md:w-auto",a),...b}));aN.displayName=aq.displayName;let aO=e.forwardRef(({className:a,...b},d)=>(0,c.jsx)("div",{className:(0,f.cn)("absolute top-full left-0 flex w-full justify-center"),children:(0,c.jsx)(av,{className:(0,f.cn)("origin-top-center border-foreground/10 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 relative mt-3 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-xl border shadow-lg md:w-[var(--radix-navigation-menu-viewport-width)]","bg-background/80 backdrop-blur-md",a),ref:d,...b})}));aO.displayName=av.displayName,e.forwardRef(({className:a,...b},d)=>(0,c.jsx)(an,{ref:d,className:(0,f.cn)("data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in top-full z-1 flex h-1.5 items-end justify-center overflow-hidden",a),...b,children:(0,c.jsx)("div",{className:"bg-border relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm shadow-md"})})).displayName=an.displayName;var aP=a.i(8234);function aQ({className:a,services:b,posts:d}){let[j,m]=(0,e.useState)(!1);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:(0,f.cn)("fixed top-6 right-0 left-0 z-50 flex justify-center transition-all duration-500",a),children:(0,c.jsxs)("nav",{className:"border-foreground/10 bg-secondary/60 hover:bg-secondary/80 mx-4 flex w-11/12 items-center justify-between gap-4 rounded-full border py-3 pr-7 pl-5 shadow-lg backdrop-blur-xl transition-all sm:w-11/12 md:w-11/12 md:min-w-[600px] lg:w-9/12 lg:min-w-[700px]",children:[(0,c.jsx)(h.Pattern,{className:"text-accent -z-10 opacity-40"}),(0,c.jsx)(g.default,{href:"/",className:"text-foreground hover:text-accent z-50 flex shrink-0 items-center transition-colors",children:(0,c.jsx)(h.LogoInline,{className:"h-8 w-auto"})}),(0,c.jsx)("div",{className:"hidden flex-1 px-4 md:block",children:(0,c.jsx)(aJ,{className:"mx-auto",dir:"rtl",children:(0,c.jsxs)(aK,{children:[(0,c.jsx)(ah,{children:(0,c.jsx)(al,{asChild:!0,children:(0,c.jsx)(g.default,{href:"/",className:(0,f.cn)(aL(),"font-vazirmatn bg-transparent text-base"),children:"خانه"})})}),(0,c.jsxs)(ah,{children:[(0,c.jsx)(aM,{className:"font-vazirmatn bg-transparent text-base",children:"سرویس‌ها"}),(0,c.jsxs)(aN,{className:"backdrop-blur-2xl",children:[(0,c.jsx)(aP.default,{}),(0,c.jsxs)("ul",{className:"grid w-[300px] gap-2 p-4 md:w-[400px] md:grid-cols-2",children:[b.map(a=>(0,c.jsx)(aR,{title:a.title,href:`/services/${a.slug}`,children:(0,c.jsx)("span",{className:"text-xs opacity-70",children:a.category})},a.slug)),(0,c.jsx)("li",{className:"border-foreground/10 col-span-2 mt-2 border-t pt-2",children:(0,c.jsx)(al,{asChild:!0,children:(0,c.jsx)(g.default,{href:"/services",className:"hover:bg-accent hover:text-accent-foreground font-vazirmatn text-accent block rounded-md p-2 text-center text-sm font-medium transition-colors select-none",children:"مشاهده همه سرویس‌ها"})})})]})]})]}),(0,c.jsxs)(ah,{children:[(0,c.jsx)(aM,{className:"font-vazirmatn bg-transparent text-base",children:"مقالات"}),(0,c.jsxs)(aN,{className:"backdrop-blur-2xl",children:[(0,c.jsx)(aP.default,{}),(0,c.jsxs)("ul",{className:"grid w-[300px] gap-2 p-4 md:w-[400px]",children:[d.map(a=>(0,c.jsx)(aR,{title:a.title,href:`/posts/${a.slug}`,children:a.excerpt},a.slug)),(0,c.jsx)("li",{className:"border-foreground/10 mt-2 border-t pt-2",children:(0,c.jsx)(al,{asChild:!0,children:(0,c.jsx)(g.default,{href:"/posts",className:"hover:bg-accent hover:text-accent-foreground font-vazirmatn text-accent block rounded-md p-2 text-center text-sm font-medium transition-colors select-none",children:"مشاهده همه مقالات"})})})]})]})]}),(0,c.jsx)(ah,{children:(0,c.jsx)(al,{asChild:!0,children:(0,c.jsx)(g.default,{href:"/about",className:(0,f.cn)(aL(),"font-vazirmatn bg-transparent text-base"),children:"درباره ما"})})}),(0,c.jsx)(ah,{children:(0,c.jsx)(al,{asChild:!0,children:(0,c.jsx)(g.default,{href:"/contact",className:(0,f.cn)(aL(),"font-vazirmatn bg-transparent text-base"),children:"تماس با ما"})})})]})})}),(0,c.jsx)("div",{className:"z-50 md:hidden",children:(0,c.jsx)("button",{onClick:()=>m(!j),className:"text-foreground p-2",children:j?(0,c.jsx)(l,{}):(0,c.jsx)(k,{})})}),(0,c.jsx)("div",{className:"hidden shrink-0 md:block",children:(0,c.jsx)(i.MagneticButton,{variant:"white",href:"/contact",children:"شروع پروژه"})})]})}),(0,c.jsxs)("div",{className:(0,f.cn)("bg-background/60 fixed inset-0 z-40 flex flex-col items-center justify-center gap-8 backdrop-blur-xl transition-all duration-500 md:hidden",j?"pointer-events-auto opacity-100":"pointer-events-none opacity-0"),children:[(0,c.jsxs)("nav",{className:"font-vazirmatn flex flex-col items-center gap-6 text-xl",children:[(0,c.jsx)(g.default,{href:"/",onClick:()=>m(!1),className:"hover:text-accent transition-colors",children:"خانه"}),(0,c.jsx)(g.default,{href:"/services",onClick:()=>m(!1),className:"hover:text-accent transition-colors",children:"سرویس‌ها"}),(0,c.jsx)(g.default,{href:"/posts",onClick:()=>m(!1),className:"hover:text-accent transition-colors",children:"مقالات"}),(0,c.jsx)(g.default,{href:"/about",onClick:()=>m(!1),className:"hover:text-accent transition-colors",children:"درباره ما"}),(0,c.jsx)(g.default,{href:"/contact",onClick:()=>m(!1),className:"hover:text-accent transition-colors",children:"تماس با ما"})]}),(0,c.jsx)("div",{className:"mt-8",children:(0,c.jsx)(i.MagneticButton,{variant:"accent",size:"lg",href:"/contact",children:"شروع پروژه"})})]})]})}let aR=e.default.forwardRef(({className:a,title:b,children:d,href:e,...h},i)=>(0,c.jsx)("li",{children:(0,c.jsx)(al,{asChild:!0,children:(0,c.jsxs)(g.default,{href:e||"#",ref:i,className:(0,f.cn)("hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground block space-y-1 rounded-md p-3 leading-none no-underline transition-colors outline-none select-none",a),...h,children:[(0,c.jsx)("div",{className:"font-vazirmatn text-sm leading-none font-medium",children:b}),(0,c.jsx)("p",{className:"text-muted-foreground font-vazirmatn line-clamp-2 text-sm leading-snug opacity-70",children:d})]})})}));function aS({services:a,posts:b}){let e=(0,d.usePathname)();return(0,c.jsx)(c.Fragment,{children:"/"===e?null:(0,c.jsx)(aQ,{services:a,posts:b})})}aR.displayName="ListItem",a.s(["default",()=>aS],91416)},88205,a=>{"use strict";var b=a.i(87924),c=a.i(72131);let d=(0,c.createContext)(null);function e({children:a}){let e=(0,c.useRef)(null),[f,g]=(0,c.useState)(0),[h,i]=(0,c.useState)(!1),j=(0,c.useRef)(0),k=(0,c.useRef)(0),l=(0,c.useRef)(null),m=(0,c.useRef)(null),n=(0,c.useRef)(!1);(0,c.useEffect)(()=>{let a=()=>{if(l.current){let a=l.current.querySelector("canvas");if(a&&a.width>0&&a.height>0)return i(!0),!0}return!1};if(a())return;let b=setInterval(()=>{a()&&clearInterval(b)},100),c=setTimeout(()=>{i(!0)},1500);return()=>{clearInterval(b),clearTimeout(c)}},[]);let o=a=>{if(e.current){let b=e.current.children;b[a]&&(b[a].scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),g(a))}};return(0,c.useEffect)(()=>{let a=a=>{j.current=a.touches[0].clientY,k.current=a.touches[0].clientX},b=a=>{Math.abs(a.touches[0].clientY-j.current)>10&&a.preventDefault()},c=a=>{let b=a.changedTouches[0].clientY,c=a.changedTouches[0].clientX,d=j.current-b;Math.abs(d)>Math.abs(k.current-c)&&Math.abs(d)>50&&(d>0&&f<4?o(f+1):d<0&&f>0&&o(f-1))},d=e.current;return d&&(d.addEventListener("touchstart",a,{passive:!0}),d.addEventListener("touchmove",b,{passive:!1}),d.addEventListener("touchend",c,{passive:!0})),()=>{d&&(d.removeEventListener("touchstart",a),d.removeEventListener("touchmove",b),d.removeEventListener("touchend",c))}},[f]),(0,c.useEffect)(()=>{let a=a=>{if(Math.abs(a.deltaY)>Math.abs(a.deltaX)){if(!e.current||n.current)return;e.current.scrollBy({left:-a.deltaY,behavior:"auto"});let b=e.current.offsetWidth,c=Math.round(Math.abs(e.current.scrollLeft)/b);c!==f&&g(c)}},b=e.current;return b&&b.addEventListener("wheel",a,{passive:!1}),()=>{b&&b.removeEventListener("wheel",a)}},[f]),(0,c.useEffect)(()=>{let a=()=>{m.current||(m.current=window.requestAnimationFrame(()=>{if(!e.current){m.current=null;return}let a=e.current.offsetWidth,b=Math.round(Math.abs(e.current.scrollLeft)/a);b!==f&&b>=0&&b<=4&&g(b),m.current=null}))},b=e.current;return b&&b.addEventListener("scroll",a,{passive:!0}),()=>{b&&b.removeEventListener("scroll",a),null!==m.current&&cancelAnimationFrame(m.current)}},[f]),(0,b.jsx)(d.Provider,{value:{scrollContainerRef:e,currentSection:f,scrollToSection:o},children:a})}a.s(["ScrollContext",0,d,"ScrollProvider",()=>e,"useScroll",0,()=>{let a=(0,c.useContext)(d);if(!a)throw Error("useScroll must be used inside ScrollProvider");return a}])},34031,a=>{"use strict";let b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;var v=a.i(87924),w=a.i(72131),x=Object.defineProperty,y=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?x(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c},z=Object.defineProperty,A=Object.getOwnPropertyDescriptor,B=Object.getOwnPropertyNames,C=Object.prototype.hasOwnProperty,D=(a,b)=>()=>(a&&(b=a(a=0)),b),E=a=>{let b={};for(var c in a)z(b,c,{get:a[c],enumerable:!0});return b};function F(a){for(let b=a.length-1;b>=0;--b)if(a[b]>=65535)return!0;return!1}function G(a){return document.createElementNS("http://www.w3.org/1999/xhtml",a)}function H(...a){let b="THREE."+a.shift();bH?bH("log",b,...a):console.log(b,...a)}function I(...a){let b="THREE."+a.shift();bH?bH("warn",b,...a):console.warn(b,...a)}function J(...a){let b="THREE."+a.shift();bH?bH("error",b,...a):console.error(b,...a)}function K(...a){let b=a.join(" ");b in bG||(bG[b]=!0,I(...a))}function L(){let a=0xffffffff*Math.random()|0,b=0xffffffff*Math.random()|0,c=0xffffffff*Math.random()|0,d=0xffffffff*Math.random()|0;return(bJ[255&a]+bJ[a>>8&255]+bJ[a>>16&255]+bJ[a>>24&255]+"-"+bJ[255&b]+bJ[b>>8&255]+"-"+bJ[b>>16&15|64]+bJ[b>>24&255]+"-"+bJ[63&c|128]+bJ[c>>8&255]+"-"+bJ[c>>16&255]+bJ[c>>24&255]+bJ[255&d]+bJ[d>>8&255]+bJ[d>>16&255]+bJ[d>>24&255]).toLowerCase()}function M(a,b,c){return Math.max(b,Math.min(c,a))}function N(a,b){return(a%b+b)%b}function O(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)}function P(a,b,c){return a===b?0:(c-a)/(b-a)}function Q(a,b,c){return(1-c)*a+c*b}function R(a,b,c,d){return Q(a,b,1-Math.exp(-c*d))}function S(a,b=1){return b-Math.abs(N(a,2*b)-b)}function T(a,b,c){return a<=b?0:a>=c?1:(a=(a-b)/(c-b))*a*(3-2*a)}function U(a,b,c){return a<=b?0:a>=c?1:(a=(a-b)/(c-b))*a*a*(a*(6*a-15)+10)}function V(a,b){return a+Math.floor(Math.random()*(b-a+1))}function W(a,b){return a+Math.random()*(b-a)}function X(a){return a*(.5-Math.random())}function Y(a){void 0!==a&&(bK=a);let b=bK+=0x6d2b79f5;return b=Math.imul(b^b>>>15,1|b),(((b^=b+Math.imul(b^b>>>7,61|b))^b>>>14)>>>0)/0x100000000}function Z(a){return a*bL}function $(a){return a*bM}function _(a){return(a&a-1)==0&&0!==a}function aa(a){return 2**Math.ceil(Math.log(a)/Math.LN2)}function ab(a){return 2**Math.floor(Math.log(a)/Math.LN2)}function ac(a,b,c,d,e){let f=Math.cos,g=Math.sin,h=f(c/2),i=g(c/2),j=f((b+d)/2),k=g((b+d)/2),l=f((b-d)/2),m=g((b-d)/2),n=f((d-b)/2),o=g((d-b)/2);switch(e){case"XYX":a.set(h*k,i*l,i*m,h*j);break;case"YZY":a.set(i*m,h*k,i*l,h*j);break;case"ZXZ":a.set(i*l,i*m,h*k,h*j);break;case"XZX":a.set(h*k,i*o,i*n,h*j);break;case"YXY":a.set(i*n,h*k,i*o,h*j);break;case"ZYZ":a.set(i*o,i*n,h*k,h*j);break;default:I("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+e)}}function ad(a,b){switch(b.constructor){case Float32Array:return a;case Uint32Array:return a/0xffffffff;case Uint16Array:return a/65535;case Uint8Array:return a/255;case Int32Array:return Math.max(a/0x7fffffff,-1);case Int16Array:return Math.max(a/32767,-1);case Int8Array:return Math.max(a/127,-1);default:throw Error("Invalid component type.")}}function ae(a,b){switch(b.constructor){case Float32Array:return a;case Uint32Array:return Math.round(0xffffffff*a);case Uint16Array:return Math.round(65535*a);case Uint8Array:return Math.round(255*a);case Int32Array:return Math.round(0x7fffffff*a);case Int16Array:return Math.round(32767*a);case Int8Array:return Math.round(127*a);default:throw Error("Invalid component type.")}}function af(a){return a<.04045?.0773993808*a:(.9478672986*a+.0521327014)**2.4}function ag(a){return a<.0031308?12.92*a:1.055*a**.41666-.055}function ah(a){return"u">typeof HTMLImageElement&&a instanceof HTMLImageElement||"u">typeof HTMLCanvasElement&&a instanceof HTMLCanvasElement||"u">typeof ImageBitmap&&a instanceof ImageBitmap?bZ.getDataURL(a):a.data?{data:Array.from(a.data),width:a.width,height:a.height,type:a.data.constructor.name}:(I("Texture: Unable to serialize Texture."),{})}function ai(a,b,c,d,e){for(let f=0,g=a.length-3;f<=g;f+=3){ck.fromArray(a,f);let g=e.x*Math.abs(ck.x)+e.y*Math.abs(ck.y)+e.z*Math.abs(ck.z),h=b.dot(ck),i=c.dot(ck),j=d.dot(ck);if(Math.max(-Math.max(h,i,j),Math.min(h,i,j))>g)return!1}return!0}function aj(a,b,c){return c<0&&(c+=1),c>1&&--c,c<1/6?a+(b-a)*6*c:c<.5?b:c<2/3?a+(b-a)*6*(2/3-c):a}function ak(a){Math.abs(a)>65504&&I("DataUtils.toHalfFloat(): Value out of range."),a=M(a,-65504,65504),dj.floatView[0]=a;let b=dj.uint32View[0],c=b>>23&511;return dj.baseTable[c]+((8388607&b)>>dj.shiftTable[c])}function al(a){let b=a>>10;return dj.uint32View[0]=dj.mantissaTable[dj.offsetTable[b]+(1023&a)]+dj.exponentTable[b],dj.floatView[0]}function am(a,b,c,d,e,f,g,h,i,j){a.getVertexPosition(h,dF),a.getVertexPosition(i,dG),a.getVertexPosition(j,dH);let k=function(a,b,c,d,e,f,g,h){if(null===(1===b.side?d.intersectTriangle(g,f,e,!0,h):d.intersectTriangle(e,f,g,0===b.side,h)))return null;dL.copy(h),dL.applyMatrix4(a.matrixWorld);let i=c.ray.origin.distanceTo(dL);return i<c.near||i>c.far?null:{distance:i,point:dL.clone(),object:a}}(a,b,c,d,dF,dG,dH,dK);if(k){let a=new bQ;da.getBarycoord(dK,dF,dG,dH,a),e&&(k.uv=da.getInterpolatedAttribute(e,h,i,j,a,new bO)),f&&(k.uv1=da.getInterpolatedAttribute(f,h,i,j,a,new bO)),g&&(k.normal=da.getInterpolatedAttribute(g,h,i,j,a,new bQ),k.normal.dot(d.direction)>0&&k.normal.multiplyScalar(-1));let b={a:h,b:i,c:j,normal:new bQ,materialIndex:0};da.getNormal(dF,dG,dH,b.normal),k.face=b,k.barycoord=a}return k}function an(a){let b={};for(let c in a)for(let d in b[c]={},a[c]){let e=a[c][d];e&&(e.isColor||e.isMatrix3||e.isMatrix4||e.isVector2||e.isVector3||e.isVector4||e.isTexture||e.isQuaternion)?e.isRenderTargetTexture?(I("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),b[c][d]=null):b[c][d]=e.clone():Array.isArray(e)?b[c][d]=e.slice():b[c][d]=e}return b}function ao(a,b){return a&&a.constructor!==b?"number"==typeof b.BYTES_PER_ELEMENT?new b(a):Array.prototype.slice.call(a):a}var ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a$,a_,a0,a1,a2,a3,a4,a5,a6,a7,a8,a9,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b$,b_,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG,cH,cI,cJ,cK,cL,cM,cN,cO,cP,cQ,cR,cS,cT,cU,cV,cW,cX,cY,cZ,c$,c_,c0,c1,c2,c3,c4,c5,c6,c7,c8,c9,da,db,dc,dd,de,df,dg,dh,di,dj,dk,dl,dm,dn,dp,dq,dr,ds,dt,du,dv,dw,dx,dy,dz,dA,dB,dC,dD,dE,dF,dG,dH,dI,dJ,dK,dL,dM,dN,dO,dP,dQ,dR,dS,dT,dU,dV,dW,dX,dY,dZ,d$,d_,d0,d1,d2,d3,d4,d5,d6,d7,d8,d9,ea,eb,ec,ed,ee,ef,eg,eh,ei,ej,ek,el,em,en,eo,ep,eq,er,es,et,eu,ev,ew,ex,ey,ez,eA,eB,eC,eD,eE,eF,eG,eH,eI,eJ,eK,eL,eM,eN,eO,eP,eQ,eR,eS,eT,eU,eV,eW,eX,eY,eZ,e$,e_,e0,e1,e2,e3,e4,e5,e6,e7,e8,e9,fa,fb,fc,fd,fe,ff,fg,fh,fi=D(()=>{let a,b,c,d;ap=1e3,aq=1001,ar=1002,as=1003,at=1004,au=1005,av=1006,aw=1007,ax=1008,ay=1008,az=1009,aA=1010,aB=1011,aC=1012,aD=1013,aE=1014,aF=1015,aG=1016,aH=1017,aI=1018,aJ=1020,aK=35902,aL=35899,aM=1021,aN=1022,aO=1023,aP=1026,aQ=1027,aR=1028,aS=1029,aT=1030,aU=1031,aV=1032,aW=1033,aX=33776,aY=33777,aZ=33778,a$=33779,a_=35840,a0=35841,a1=35842,a2=35843,a3=36196,a4=37492,a5=37496,a6=37808,a7=37809,a8=37810,a9=37811,ba=37812,bb=37813,bc=37814,bd=37815,be=37816,bf=37817,bg=37818,bh=37819,bi=37820,bj=37821,bk=36492,bl=36494,bm=36495,bn=36283,bo=36284,bp=36285,bq=36286,br="srgb",bs="srgb-linear",bt="linear",bu=7680,bv=7681,bw=7682,bx=7683,by=34055,bz=34056,bA=5386,bB=35044,bC=35048,bD=2e3,bE=2001,bF={COMPUTE:"compute",RENDER:"render"},bG={},bH=null,bI=class{addEventListener(a,b){void 0===this._listeners&&(this._listeners={});let c=this._listeners;void 0===c[a]&&(c[a]=[]),-1===c[a].indexOf(b)&&c[a].push(b)}hasEventListener(a,b){let c=this._listeners;return void 0!==c&&void 0!==c[a]&&-1!==c[a].indexOf(b)}removeEventListener(a,b){let c=this._listeners;if(void 0===c)return;let d=c[a];if(void 0!==d){let a=d.indexOf(b);-1!==a&&d.splice(a,1)}}dispatchEvent(a){let b=this._listeners;if(void 0===b)return;let c=b[a.type];if(void 0!==c){a.target=this;let b=c.slice(0);for(let c=0,d=b.length;c<d;c++)b[c].call(this,a);a.target=null}}},bJ="00.01.02.03.04.05.06.07.08.09.0a.0b.0c.0d.0e.0f.10.11.12.13.14.15.16.17.18.19.1a.1b.1c.1d.1e.1f.20.21.22.23.24.25.26.27.28.29.2a.2b.2c.2d.2e.2f.30.31.32.33.34.35.36.37.38.39.3a.3b.3c.3d.3e.3f.40.41.42.43.44.45.46.47.48.49.4a.4b.4c.4d.4e.4f.50.51.52.53.54.55.56.57.58.59.5a.5b.5c.5d.5e.5f.60.61.62.63.64.65.66.67.68.69.6a.6b.6c.6d.6e.6f.70.71.72.73.74.75.76.77.78.79.7a.7b.7c.7d.7e.7f.80.81.82.83.84.85.86.87.88.89.8a.8b.8c.8d.8e.8f.90.91.92.93.94.95.96.97.98.99.9a.9b.9c.9d.9e.9f.a0.a1.a2.a3.a4.a5.a6.a7.a8.a9.aa.ab.ac.ad.ae.af.b0.b1.b2.b3.b4.b5.b6.b7.b8.b9.ba.bb.bc.bd.be.bf.c0.c1.c2.c3.c4.c5.c6.c7.c8.c9.ca.cb.cc.cd.ce.cf.d0.d1.d2.d3.d4.d5.d6.d7.d8.d9.da.db.dc.dd.de.df.e0.e1.e2.e3.e4.e5.e6.e7.e8.e9.ea.eb.ec.ed.ee.ef.f0.f1.f2.f3.f4.f5.f6.f7.f8.f9.fa.fb.fc.fd.fe.ff".split("."),bK=1234567,bN={DEG2RAD:bL=Math.PI/180,RAD2DEG:bM=180/Math.PI,generateUUID:L,clamp:M,euclideanModulo:N,mapLinear:O,inverseLerp:P,lerp:Q,damp:R,pingpong:S,smoothstep:T,smootherstep:U,randInt:V,randFloat:W,randFloatSpread:X,seededRandom:Y,degToRad:Z,radToDeg:$,isPowerOfTwo:_,ceilPowerOfTwo:aa,floorPowerOfTwo:ab,setQuaternionFromProperEuler:ac,normalize:ae,denormalize:ad},bO=class a{constructor(b=0,c=0){a.prototype.isVector2=!0,this.x=b,this.y=c}get width(){return this.x}set width(a){this.x=a}get height(){return this.y}set height(a){this.y=a}set(a,b){return this.x=a,this.y=b,this}setScalar(a){return this.x=a,this.y=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setComponent(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y)}copy(a){return this.x=a.x,this.y=a.y,this}add(a){return this.x+=a.x,this.y+=a.y,this}addScalar(a){return this.x+=a,this.y+=a,this}addVectors(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this}addScaledVector(a,b){return this.x+=a.x*b,this.y+=a.y*b,this}sub(a){return this.x-=a.x,this.y-=a.y,this}subScalar(a){return this.x-=a,this.y-=a,this}subVectors(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this}multiply(a){return this.x*=a.x,this.y*=a.y,this}multiplyScalar(a){return this.x*=a,this.y*=a,this}divide(a){return this.x/=a.x,this.y/=a.y,this}divideScalar(a){return this.multiplyScalar(1/a)}applyMatrix3(a){let b=this.x,c=this.y,d=a.elements;return this.x=d[0]*b+d[3]*c+d[6],this.y=d[1]*b+d[4]*c+d[7],this}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this}clamp(a,b){return this.x=M(this.x,a.x,b.x),this.y=M(this.y,a.y,b.y),this}clampScalar(a,b){return this.x=M(this.x,a,b),this.y=M(this.y,a,b),this}clampLength(a,b){let c=this.length();return this.divideScalar(c||1).multiplyScalar(M(c,a,b))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(a){return this.x*a.x+this.y*a.y}cross(a){return this.x*a.y-this.y*a.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(a){let b=Math.sqrt(this.lengthSq()*a.lengthSq());return 0===b?Math.PI/2:Math.acos(M(this.dot(a)/b,-1,1))}distanceTo(a){return Math.sqrt(this.distanceToSquared(a))}distanceToSquared(a){let b=this.x-a.x,c=this.y-a.y;return b*b+c*c}manhattanDistanceTo(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this}lerpVectors(a,b,c){return this.x=a.x+(b.x-a.x)*c,this.y=a.y+(b.y-a.y)*c,this}equals(a){return a.x===this.x&&a.y===this.y}fromArray(a,b=0){return this.x=a[b],this.y=a[b+1],this}toArray(a=[],b=0){return a[b]=this.x,a[b+1]=this.y,a}fromBufferAttribute(a,b){return this.x=a.getX(b),this.y=a.getY(b),this}rotateAround(a,b){let c=Math.cos(b),d=Math.sin(b),e=this.x-a.x,f=this.y-a.y;return this.x=e*c-f*d+a.x,this.y=e*d+f*c+a.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},bP=class{constructor(a=0,b=0,c=0,d=1){this.isQuaternion=!0,this._x=a,this._y=b,this._z=c,this._w=d}static slerpFlat(a,b,c,d,e,f,g){let h=c[d+0],i=c[d+1],j=c[d+2],k=c[d+3],l=e[f+0],m=e[f+1],n=e[f+2],o=e[f+3];if(g<=0){a[b+0]=h,a[b+1]=i,a[b+2]=j,a[b+3]=k;return}if(g>=1){a[b+0]=l,a[b+1]=m,a[b+2]=n,a[b+3]=o;return}if(k!==o||h!==l||i!==m||j!==n){let a=h*l+i*m+j*n+k*o;a<0&&(l=-l,m=-m,n=-n,o=-o,a=-a);let b=1-g;if(a<.9995){let c=Math.acos(a),d=Math.sin(c);h=h*(b=Math.sin(b*c)/d)+l*(g=Math.sin(g*c)/d),i=i*b+m*g,j=j*b+n*g,k=k*b+o*g}else{h=h*b+l*g,i=i*b+m*g;let a=1/Math.sqrt(h*h+i*i+(j=j*b+n*g)*j+(k=k*b+o*g)*k);h*=a,i*=a,j*=a,k*=a}}a[b]=h,a[b+1]=i,a[b+2]=j,a[b+3]=k}static multiplyQuaternionsFlat(a,b,c,d,e,f){let g=c[d],h=c[d+1],i=c[d+2],j=c[d+3],k=e[f],l=e[f+1],m=e[f+2],n=e[f+3];return a[b]=g*n+j*k+h*m-i*l,a[b+1]=h*n+j*l+i*k-g*m,a[b+2]=i*n+j*m+g*l-h*k,a[b+3]=j*n-g*k-h*l-i*m,a}get x(){return this._x}set x(a){this._x=a,this._onChangeCallback()}get y(){return this._y}set y(a){this._y=a,this._onChangeCallback()}get z(){return this._z}set z(a){this._z=a,this._onChangeCallback()}get w(){return this._w}set w(a){this._w=a,this._onChangeCallback()}set(a,b,c,d){return this._x=a,this._y=b,this._z=c,this._w=d,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(a){return this._x=a.x,this._y=a.y,this._z=a.z,this._w=a.w,this._onChangeCallback(),this}setFromEuler(a,b=!0){let c=a._x,d=a._y,e=a._z,f=a._order,g=Math.cos,h=Math.sin,i=g(c/2),j=g(d/2),k=g(e/2),l=h(c/2),m=h(d/2),n=h(e/2);switch(f){case"XYZ":this._x=l*j*k+i*m*n,this._y=i*m*k-l*j*n,this._z=i*j*n+l*m*k,this._w=i*j*k-l*m*n;break;case"YXZ":this._x=l*j*k+i*m*n,this._y=i*m*k-l*j*n,this._z=i*j*n-l*m*k,this._w=i*j*k+l*m*n;break;case"ZXY":this._x=l*j*k-i*m*n,this._y=i*m*k+l*j*n,this._z=i*j*n+l*m*k,this._w=i*j*k-l*m*n;break;case"ZYX":this._x=l*j*k-i*m*n,this._y=i*m*k+l*j*n,this._z=i*j*n-l*m*k,this._w=i*j*k+l*m*n;break;case"YZX":this._x=l*j*k+i*m*n,this._y=i*m*k+l*j*n,this._z=i*j*n-l*m*k,this._w=i*j*k-l*m*n;break;case"XZY":this._x=l*j*k-i*m*n,this._y=i*m*k-l*j*n,this._z=i*j*n+l*m*k,this._w=i*j*k+l*m*n;break;default:I("Quaternion: .setFromEuler() encountered an unknown order: "+f)}return!0===b&&this._onChangeCallback(),this}setFromAxisAngle(a,b){let c=b/2,d=Math.sin(c);return this._x=a.x*d,this._y=a.y*d,this._z=a.z*d,this._w=Math.cos(c),this._onChangeCallback(),this}setFromRotationMatrix(a){let b=a.elements,c=b[0],d=b[4],e=b[8],f=b[1],g=b[5],h=b[9],i=b[2],j=b[6],k=b[10],l=c+g+k;if(l>0){let a=.5/Math.sqrt(l+1);this._w=.25/a,this._x=(j-h)*a,this._y=(e-i)*a,this._z=(f-d)*a}else if(c>g&&c>k){let a=2*Math.sqrt(1+c-g-k);this._w=(j-h)/a,this._x=.25*a,this._y=(d+f)/a,this._z=(e+i)/a}else if(g>k){let a=2*Math.sqrt(1+g-c-k);this._w=(e-i)/a,this._x=(d+f)/a,this._y=.25*a,this._z=(h+j)/a}else{let a=2*Math.sqrt(1+k-c-g);this._w=(f-d)/a,this._x=(e+i)/a,this._y=(h+j)/a,this._z=.25*a}return this._onChangeCallback(),this}setFromUnitVectors(a,b){let c=a.dot(b)+1;return c<1e-8?(c=0,Math.abs(a.x)>Math.abs(a.z)?(this._x=-a.y,this._y=a.x,this._z=0):(this._x=0,this._y=-a.z,this._z=a.y)):(this._x=a.y*b.z-a.z*b.y,this._y=a.z*b.x-a.x*b.z,this._z=a.x*b.y-a.y*b.x),this._w=c,this.normalize()}angleTo(a){return 2*Math.acos(Math.abs(M(this.dot(a),-1,1)))}rotateTowards(a,b){let c=this.angleTo(a);if(0===c)return this;let d=Math.min(1,b/c);return this.slerp(a,d),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let a=this.length();return 0===a?(this._x=0,this._y=0,this._z=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a),this._onChangeCallback(),this}multiply(a){return this.multiplyQuaternions(this,a)}premultiply(a){return this.multiplyQuaternions(a,this)}multiplyQuaternions(a,b){let c=a._x,d=a._y,e=a._z,f=a._w,g=b._x,h=b._y,i=b._z,j=b._w;return this._x=c*j+f*g+d*i-e*h,this._y=d*j+f*h+e*g-c*i,this._z=e*j+f*i+c*h-d*g,this._w=f*j-c*g-d*h-e*i,this._onChangeCallback(),this}slerp(a,b){if(b<=0)return this;if(b>=1)return this.copy(a);let c=a._x,d=a._y,e=a._z,f=a._w,g=this.dot(a);g<0&&(c=-c,d=-d,e=-e,f=-f,g=-g);let h=1-b;if(g<.9995){let a=Math.acos(g),i=Math.sin(a);h=Math.sin(h*a)/i,b=Math.sin(b*a)/i,this._x=this._x*h+c*b,this._y=this._y*h+d*b,this._z=this._z*h+e*b,this._w=this._w*h+f*b,this._onChangeCallback()}else this._x=this._x*h+c*b,this._y=this._y*h+d*b,this._z=this._z*h+e*b,this._w=this._w*h+f*b,this.normalize();return this}slerpQuaternions(a,b,c){return this.copy(a).slerp(b,c)}random(){let a=2*Math.PI*Math.random(),b=2*Math.PI*Math.random(),c=Math.random(),d=Math.sqrt(1-c),e=Math.sqrt(c);return this.set(d*Math.sin(a),d*Math.cos(a),e*Math.sin(b),e*Math.cos(b))}equals(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w}fromArray(a,b=0){return this._x=a[b],this._y=a[b+1],this._z=a[b+2],this._w=a[b+3],this._onChangeCallback(),this}toArray(a=[],b=0){return a[b]=this._x,a[b+1]=this._y,a[b+2]=this._z,a[b+3]=this._w,a}fromBufferAttribute(a,b){return this._x=a.getX(b),this._y=a.getY(b),this._z=a.getZ(b),this._w=a.getW(b),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(a){return this._onChangeCallback=a,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},bQ=class a{constructor(b=0,c=0,d=0){a.prototype.isVector3=!0,this.x=b,this.y=c,this.z=d}set(a,b,c){return void 0===c&&(c=this.z),this.x=a,this.y=b,this.z=c,this}setScalar(a){return this.x=a,this.y=a,this.z=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setZ(a){return this.z=a,this}setComponent(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(a){return this.x=a.x,this.y=a.y,this.z=a.z,this}add(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this}addScalar(a){return this.x+=a,this.y+=a,this.z+=a,this}addVectors(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this}addScaledVector(a,b){return this.x+=a.x*b,this.y+=a.y*b,this.z+=a.z*b,this}sub(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this}subScalar(a){return this.x-=a,this.y-=a,this.z-=a,this}subVectors(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this}multiply(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this}multiplyScalar(a){return this.x*=a,this.y*=a,this.z*=a,this}multiplyVectors(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this}applyEuler(a){return this.applyQuaternion(bS.setFromEuler(a))}applyAxisAngle(a,b){return this.applyQuaternion(bS.setFromAxisAngle(a,b))}applyMatrix3(a){let b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[3]*c+e[6]*d,this.y=e[1]*b+e[4]*c+e[7]*d,this.z=e[2]*b+e[5]*c+e[8]*d,this}applyNormalMatrix(a){return this.applyMatrix3(a).normalize()}applyMatrix4(a){let b=this.x,c=this.y,d=this.z,e=a.elements,f=1/(e[3]*b+e[7]*c+e[11]*d+e[15]);return this.x=(e[0]*b+e[4]*c+e[8]*d+e[12])*f,this.y=(e[1]*b+e[5]*c+e[9]*d+e[13])*f,this.z=(e[2]*b+e[6]*c+e[10]*d+e[14])*f,this}applyQuaternion(a){let b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z,h=a.w,i=2*(f*d-g*c),j=2*(g*b-e*d),k=2*(e*c-f*b);return this.x=b+h*i+f*k-g*j,this.y=c+h*j+g*i-e*k,this.z=d+h*k+e*j-f*i,this}project(a){return this.applyMatrix4(a.matrixWorldInverse).applyMatrix4(a.projectionMatrix)}unproject(a){return this.applyMatrix4(a.projectionMatrixInverse).applyMatrix4(a.matrixWorld)}transformDirection(a){let b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d,this.y=e[1]*b+e[5]*c+e[9]*d,this.z=e[2]*b+e[6]*c+e[10]*d,this.normalize()}divide(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this}divideScalar(a){return this.multiplyScalar(1/a)}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this.z=Math.max(this.z,a.z),this}clamp(a,b){return this.x=M(this.x,a.x,b.x),this.y=M(this.y,a.y,b.y),this.z=M(this.z,a.z,b.z),this}clampScalar(a,b){return this.x=M(this.x,a,b),this.y=M(this.y,a,b),this.z=M(this.z,a,b),this}clampLength(a,b){let c=this.length();return this.divideScalar(c||1).multiplyScalar(M(c,a,b))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this}lerpVectors(a,b,c){return this.x=a.x+(b.x-a.x)*c,this.y=a.y+(b.y-a.y)*c,this.z=a.z+(b.z-a.z)*c,this}cross(a){return this.crossVectors(this,a)}crossVectors(a,b){let c=a.x,d=a.y,e=a.z,f=b.x,g=b.y,h=b.z;return this.x=d*h-e*g,this.y=e*f-c*h,this.z=c*g-d*f,this}projectOnVector(a){let b=a.lengthSq();if(0===b)return this.set(0,0,0);let c=a.dot(this)/b;return this.copy(a).multiplyScalar(c)}projectOnPlane(a){return bR.copy(this).projectOnVector(a),this.sub(bR)}reflect(a){return this.sub(bR.copy(a).multiplyScalar(2*this.dot(a)))}angleTo(a){let b=Math.sqrt(this.lengthSq()*a.lengthSq());return 0===b?Math.PI/2:Math.acos(M(this.dot(a)/b,-1,1))}distanceTo(a){return Math.sqrt(this.distanceToSquared(a))}distanceToSquared(a){let b=this.x-a.x,c=this.y-a.y,d=this.z-a.z;return b*b+c*c+d*d}manhattanDistanceTo(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)}setFromSpherical(a){return this.setFromSphericalCoords(a.radius,a.phi,a.theta)}setFromSphericalCoords(a,b,c){let d=Math.sin(b)*a;return this.x=d*Math.sin(c),this.y=Math.cos(b)*a,this.z=d*Math.cos(c),this}setFromCylindrical(a){return this.setFromCylindricalCoords(a.radius,a.theta,a.y)}setFromCylindricalCoords(a,b,c){return this.x=a*Math.sin(b),this.y=c,this.z=a*Math.cos(b),this}setFromMatrixPosition(a){let b=a.elements;return this.x=b[12],this.y=b[13],this.z=b[14],this}setFromMatrixScale(a){let b=this.setFromMatrixColumn(a,0).length(),c=this.setFromMatrixColumn(a,1).length(),d=this.setFromMatrixColumn(a,2).length();return this.x=b,this.y=c,this.z=d,this}setFromMatrixColumn(a,b){return this.fromArray(a.elements,4*b)}setFromMatrix3Column(a,b){return this.fromArray(a.elements,3*b)}setFromEuler(a){return this.x=a._x,this.y=a._y,this.z=a._z,this}setFromColor(a){return this.x=a.r,this.y=a.g,this.z=a.b,this}equals(a){return a.x===this.x&&a.y===this.y&&a.z===this.z}fromArray(a,b=0){return this.x=a[b],this.y=a[b+1],this.z=a[b+2],this}toArray(a=[],b=0){return a[b]=this.x,a[b+1]=this.y,a[b+2]=this.z,a}fromBufferAttribute(a,b){return this.x=a.getX(b),this.y=a.getY(b),this.z=a.getZ(b),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let a=Math.random()*Math.PI*2,b=2*Math.random()-1,c=Math.sqrt(1-b*b);return this.x=c*Math.cos(a),this.y=b,this.z=c*Math.sin(a),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},bR=new bQ,bS=new bP,bU=new(bT=class a{constructor(b,c,d,e,f,g,h,i,j){a.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==b&&this.set(b,c,d,e,f,g,h,i,j)}set(a,b,c,d,e,f,g,h,i){let j=this.elements;return j[0]=a,j[1]=d,j[2]=g,j[3]=b,j[4]=e,j[5]=h,j[6]=c,j[7]=f,j[8]=i,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(a){let b=this.elements,c=a.elements;return b[0]=c[0],b[1]=c[1],b[2]=c[2],b[3]=c[3],b[4]=c[4],b[5]=c[5],b[6]=c[6],b[7]=c[7],b[8]=c[8],this}extractBasis(a,b,c){return a.setFromMatrix3Column(this,0),b.setFromMatrix3Column(this,1),c.setFromMatrix3Column(this,2),this}setFromMatrix4(a){let b=a.elements;return this.set(b[0],b[4],b[8],b[1],b[5],b[9],b[2],b[6],b[10]),this}multiply(a){return this.multiplyMatrices(this,a)}premultiply(a){return this.multiplyMatrices(a,this)}multiplyMatrices(a,b){let c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[3],h=c[6],i=c[1],j=c[4],k=c[7],l=c[2],m=c[5],n=c[8],o=d[0],p=d[3],q=d[6],r=d[1],s=d[4],t=d[7],u=d[2],v=d[5],w=d[8];return e[0]=f*o+g*r+h*u,e[3]=f*p+g*s+h*v,e[6]=f*q+g*t+h*w,e[1]=i*o+j*r+k*u,e[4]=i*p+j*s+k*v,e[7]=i*q+j*t+k*w,e[2]=l*o+m*r+n*u,e[5]=l*p+m*s+n*v,e[8]=l*q+m*t+n*w,this}multiplyScalar(a){let b=this.elements;return b[0]*=a,b[3]*=a,b[6]*=a,b[1]*=a,b[4]*=a,b[7]*=a,b[2]*=a,b[5]*=a,b[8]*=a,this}determinant(){let a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*f*j-b*g*i-c*e*j+c*g*h+d*e*i-d*f*h}invert(){let a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=j*f-g*i,l=g*h-j*e,m=i*e-f*h,n=b*k+c*l+d*m;if(0===n)return this.set(0,0,0,0,0,0,0,0,0);let o=1/n;return a[0]=k*o,a[1]=(d*i-j*c)*o,a[2]=(g*c-d*f)*o,a[3]=l*o,a[4]=(j*b-d*h)*o,a[5]=(d*e-g*b)*o,a[6]=m*o,a[7]=(c*h-i*b)*o,a[8]=(f*b-c*e)*o,this}transpose(){let a,b=this.elements;return a=b[1],b[1]=b[3],b[3]=a,a=b[2],b[2]=b[6],b[6]=a,a=b[5],b[5]=b[7],b[7]=a,this}getNormalMatrix(a){return this.setFromMatrix4(a).invert().transpose()}transposeIntoArray(a){let b=this.elements;return a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8],this}setUvTransform(a,b,c,d,e,f,g){let h=Math.cos(e),i=Math.sin(e);return this.set(c*h,c*i,-c*(h*f+i*g)+f+a,-d*i,d*h,-d*(-i*f+h*g)+g+b,0,0,1),this}scale(a,b){return this.premultiply(bU.makeScale(a,b)),this}rotate(a){return this.premultiply(bU.makeRotation(-a)),this}translate(a,b){return this.premultiply(bU.makeTranslation(a,b)),this}makeTranslation(a,b){return a.isVector2?this.set(1,0,a.x,0,1,a.y,0,0,1):this.set(1,0,a,0,1,b,0,0,1),this}makeRotation(a){let b=Math.cos(a),c=Math.sin(a);return this.set(b,-c,0,c,b,0,0,0,1),this}makeScale(a,b){return this.set(a,0,0,0,b,0,0,0,1),this}equals(a){let b=this.elements,c=a.elements;for(let a=0;a<9;a++)if(b[a]!==c[a])return!1;return!0}fromArray(a,b=0){for(let c=0;c<9;c++)this.elements[c]=a[c+b];return this}toArray(a=[],b=0){let c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a}clone(){return new this.constructor().fromArray(this.elements)}}),bV=new bT().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),bW=new bT().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715),b=[.64,.33,.3,.6,.15,.06],c=[.2126,.7152,.0722],d=[.3127,.329],(a={enabled:!0,workingColorSpace:bs,spaces:{},convert:function(a,b,c){return!1!==this.enabled&&b!==c&&b&&c&&("srgb"===this.spaces[b].transfer&&(a.r=af(a.r),a.g=af(a.g),a.b=af(a.b)),this.spaces[b].primaries!==this.spaces[c].primaries&&(a.applyMatrix3(this.spaces[b].toXYZ),a.applyMatrix3(this.spaces[c].fromXYZ)),"srgb"===this.spaces[c].transfer&&(a.r=ag(a.r),a.g=ag(a.g),a.b=ag(a.b))),a},workingToColorSpace:function(a,b){return this.convert(a,this.workingColorSpace,b)},colorSpaceToWorking:function(a,b){return this.convert(a,b,this.workingColorSpace)},getPrimaries:function(a){return this.spaces[a].primaries},getTransfer:function(a){return""===a?bt:this.spaces[a].transfer},getToneMappingMode:function(a){return this.spaces[a].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(a,b=this.workingColorSpace){return a.fromArray(this.spaces[b].luminanceCoefficients)},define:function(a){Object.assign(this.spaces,a)},_getMatrix:function(a,b,c){return a.copy(this.spaces[b].toXYZ).multiply(this.spaces[c].fromXYZ)},_getDrawingBufferColorSpace:function(a){return this.spaces[a].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(a=this.workingColorSpace){return this.spaces[a].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(b,c){return K("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),a.workingToColorSpace(b,c)},toWorkingColorSpace:function(b,c){return K("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),a.colorSpaceToWorking(b,c)}}).define({[bs]:{primaries:b,whitePoint:d,transfer:bt,toXYZ:bV,fromXYZ:bW,luminanceCoefficients:c,workingColorSpaceConfig:{unpackColorSpace:br},outputColorSpaceConfig:{drawingBufferColorSpace:br}},[br]:{primaries:b,whitePoint:d,transfer:"srgb",toXYZ:bV,fromXYZ:bW,luminanceCoefficients:c,outputColorSpaceConfig:{drawingBufferColorSpace:br}}}),bX=a,bZ=class{static getDataURL(a,b="image/png"){let c;if(/^data:/i.test(a.src)||typeof HTMLCanvasElement>"u")return a.src;if(a instanceof HTMLCanvasElement)c=a;else{void 0===bY&&(bY=G("canvas")),bY.width=a.width,bY.height=a.height;let b=bY.getContext("2d");a instanceof ImageData?b.putImageData(a,0,0):b.drawImage(a,0,0,a.width,a.height),c=bY}return c.toDataURL(b)}static sRGBToLinear(a){if("u">typeof HTMLImageElement&&a instanceof HTMLImageElement||"u">typeof HTMLCanvasElement&&a instanceof HTMLCanvasElement||"u">typeof ImageBitmap&&a instanceof ImageBitmap){let b=G("canvas");b.width=a.width,b.height=a.height;let c=b.getContext("2d");c.drawImage(a,0,0,a.width,a.height);let d=c.getImageData(0,0,a.width,a.height),e=d.data;for(let a=0;a<e.length;a++)e[a]=255*af(e[a]/255);return c.putImageData(d,0,0),b}if(!a.data)return I("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),a;{let b=a.data.slice(0);for(let a=0;a<b.length;a++)b instanceof Uint8Array||b instanceof Uint8ClampedArray?b[a]=Math.floor(255*af(b[a]/255)):b[a]=af(b[a]);return{data:b,width:a.width,height:a.height}}}},b$=0,b_=class{constructor(a=null){this.isSource=!0,Object.defineProperty(this,"id",{value:b$++}),this.uuid=L(),this.data=a,this.dataReady=!0,this.version=0}getSize(a){let b=this.data;return"u">typeof HTMLVideoElement&&b instanceof HTMLVideoElement?a.set(b.videoWidth,b.videoHeight,0):b instanceof VideoFrame?a.set(b.displayHeight,b.displayWidth,0):null===b?a.set(0,0,0):a.set(b.width,b.height,b.depth||0),a}set needsUpdate(a){!0===a&&this.version++}toJSON(a){let b=void 0===a||"string"==typeof a;if(!b&&void 0!==a.images[this.uuid])return a.images[this.uuid];let c={uuid:this.uuid,url:""},d=this.data;if(null!==d){let a;if(Array.isArray(d)){a=[];for(let b=0,c=d.length;b<c;b++)d[b].isDataTexture?a.push(ah(d[b].image)):a.push(ah(d[b]))}else a=ah(d);c.url=a}return b||(a.images[this.uuid]=c),c}},b0=0,b1=new bQ,b2=class a extends bI{constructor(b=a.DEFAULT_IMAGE,c=a.DEFAULT_MAPPING,d=aq,e=aq,f=av,g=ax,h=aO,i=az,j=a.DEFAULT_ANISOTROPY,k=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:b0++}),this.uuid=L(),this.name="",this.source=new b_(b),this.mipmaps=[],this.mapping=c,this.channel=0,this.wrapS=d,this.wrapT=e,this.magFilter=f,this.minFilter=g,this.anisotropy=j,this.format=h,this.internalFormat=null,this.type=i,this.offset=new bO(0,0),this.repeat=new bO(1,1),this.center=new bO(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new bT,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=k,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(b&&b.depth&&b.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(b1).x}get height(){return this.source.getSize(b1).y}get depth(){return this.source.getSize(b1).z}get image(){return this.source.data}set image(a=null){this.source.data=a}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(a,b){this.updateRanges.push({start:a,count:b})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(a){return this.name=a.name,this.source=a.source,this.mipmaps=a.mipmaps.slice(0),this.mapping=a.mapping,this.channel=a.channel,this.wrapS=a.wrapS,this.wrapT=a.wrapT,this.magFilter=a.magFilter,this.minFilter=a.minFilter,this.anisotropy=a.anisotropy,this.format=a.format,this.internalFormat=a.internalFormat,this.type=a.type,this.offset.copy(a.offset),this.repeat.copy(a.repeat),this.center.copy(a.center),this.rotation=a.rotation,this.matrixAutoUpdate=a.matrixAutoUpdate,this.matrix.copy(a.matrix),this.generateMipmaps=a.generateMipmaps,this.premultiplyAlpha=a.premultiplyAlpha,this.flipY=a.flipY,this.unpackAlignment=a.unpackAlignment,this.colorSpace=a.colorSpace,this.renderTarget=a.renderTarget,this.isRenderTargetTexture=a.isRenderTargetTexture,this.isArrayTexture=a.isArrayTexture,this.userData=JSON.parse(JSON.stringify(a.userData)),this.needsUpdate=!0,this}setValues(a){for(let b in a){let c=a[b];if(void 0===c){I(`Texture.setValues(): parameter '${b}' has value of undefined.`);continue}let d=this[b];if(void 0===d){I(`Texture.setValues(): property '${b}' does not exist.`);continue}d&&c&&d.isVector2&&c.isVector2||d&&c&&d.isVector3&&c.isVector3||d&&c&&d.isMatrix3&&c.isMatrix3?d.copy(c):this[b]=c}}toJSON(a){let b=void 0===a||"string"==typeof a;if(!b&&void 0!==a.textures[this.uuid])return a.textures[this.uuid];let c={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(a).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(c.userData=this.userData),b||(a.textures[this.uuid]=c),c}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(a){if(300!==this.mapping)return a;if(a.applyMatrix3(this.matrix),a.x<0||a.x>1)switch(this.wrapS){case ap:a.x-=Math.floor(a.x);break;case aq:a.x=a.x<0?0:1;break;case ar:1===Math.abs(Math.floor(a.x)%2)?a.x=Math.ceil(a.x)-a.x:a.x-=Math.floor(a.x)}if(a.y<0||a.y>1)switch(this.wrapT){case ap:a.y-=Math.floor(a.y);break;case aq:a.y=a.y<0?0:1;break;case ar:1===Math.abs(Math.floor(a.y)%2)?a.y=Math.ceil(a.y)-a.y:a.y-=Math.floor(a.y)}return this.flipY&&(a.y=1-a.y),a}set needsUpdate(a){!0===a&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(a){!0===a&&this.pmremVersion++}},b2.DEFAULT_IMAGE=null,b2.DEFAULT_MAPPING=300,b2.DEFAULT_ANISOTROPY=1,b3=class a{constructor(b=0,c=0,d=0,e=1){a.prototype.isVector4=!0,this.x=b,this.y=c,this.z=d,this.w=e}get width(){return this.z}set width(a){this.z=a}get height(){return this.w}set height(a){this.w=a}set(a,b,c,d){return this.x=a,this.y=b,this.z=c,this.w=d,this}setScalar(a){return this.x=a,this.y=a,this.z=a,this.w=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setZ(a){return this.z=a,this}setW(a){return this.w=a,this}setComponent(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=void 0===a.w?1:a.w,this}add(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this.w+=a.w,this}addScalar(a){return this.x+=a,this.y+=a,this.z+=a,this.w+=a,this}addVectors(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this.w=a.w+b.w,this}addScaledVector(a,b){return this.x+=a.x*b,this.y+=a.y*b,this.z+=a.z*b,this.w+=a.w*b,this}sub(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this.w-=a.w,this}subScalar(a){return this.x-=a,this.y-=a,this.z-=a,this.w-=a,this}subVectors(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this.w=a.w-b.w,this}multiply(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this.w*=a.w,this}multiplyScalar(a){return this.x*=a,this.y*=a,this.z*=a,this.w*=a,this}applyMatrix4(a){let b=this.x,c=this.y,d=this.z,e=this.w,f=a.elements;return this.x=f[0]*b+f[4]*c+f[8]*d+f[12]*e,this.y=f[1]*b+f[5]*c+f[9]*d+f[13]*e,this.z=f[2]*b+f[6]*c+f[10]*d+f[14]*e,this.w=f[3]*b+f[7]*c+f[11]*d+f[15]*e,this}divide(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this.w/=a.w,this}divideScalar(a){return this.multiplyScalar(1/a)}setAxisAngleFromQuaternion(a){this.w=2*Math.acos(a.w);let b=Math.sqrt(1-a.w*a.w);return b<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b),this}setAxisAngleFromRotationMatrix(a){let b,c,d,e,f=a.elements,g=f[0],h=f[4],i=f[8],j=f[1],k=f[5],l=f[9],m=f[2],n=f[6],o=f[10];if(.01>Math.abs(h-j)&&.01>Math.abs(i-m)&&.01>Math.abs(l-n)){if(.1>Math.abs(h+j)&&.1>Math.abs(i+m)&&.1>Math.abs(l+n)&&.1>Math.abs(g+k+o-3))return this.set(1,0,0,0),this;b=Math.PI;let a=(g+1)/2,f=(k+1)/2,p=(o+1)/2,q=(h+j)/4,r=(i+m)/4,s=(l+n)/4;return a>f&&a>p?a<.01?(c=0,d=.707106781,e=.707106781):(d=q/(c=Math.sqrt(a)),e=r/c):f>p?f<.01?(c=.707106781,d=0,e=.707106781):(c=q/(d=Math.sqrt(f)),e=s/d):p<.01?(c=.707106781,d=.707106781,e=0):(c=r/(e=Math.sqrt(p)),d=s/e),this.set(c,d,e,b),this}let p=Math.sqrt((n-l)*(n-l)+(i-m)*(i-m)+(j-h)*(j-h));return .001>Math.abs(p)&&(p=1),this.x=(n-l)/p,this.y=(i-m)/p,this.z=(j-h)/p,this.w=Math.acos((g+k+o-1)/2),this}setFromMatrixPosition(a){let b=a.elements;return this.x=b[12],this.y=b[13],this.z=b[14],this.w=b[15],this}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this.w=Math.min(this.w,a.w),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this.z=Math.max(this.z,a.z),this.w=Math.max(this.w,a.w),this}clamp(a,b){return this.x=M(this.x,a.x,b.x),this.y=M(this.y,a.y,b.y),this.z=M(this.z,a.z,b.z),this.w=M(this.w,a.w,b.w),this}clampScalar(a,b){return this.x=M(this.x,a,b),this.y=M(this.y,a,b),this.z=M(this.z,a,b),this.w=M(this.w,a,b),this}clampLength(a,b){let c=this.length();return this.divideScalar(c||1).multiplyScalar(M(c,a,b))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this.w+=(a.w-this.w)*b,this}lerpVectors(a,b,c){return this.x=a.x+(b.x-a.x)*c,this.y=a.y+(b.y-a.y)*c,this.z=a.z+(b.z-a.z)*c,this.w=a.w+(b.w-a.w)*c,this}equals(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w}fromArray(a,b=0){return this.x=a[b],this.y=a[b+1],this.z=a[b+2],this.w=a[b+3],this}toArray(a=[],b=0){return a[b]=this.x,a[b+1]=this.y,a[b+2]=this.z,a[b+3]=this.w,a}fromBufferAttribute(a,b){return this.x=a.getX(b),this.y=a.getY(b),this.z=a.getZ(b),this.w=a.getW(b),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},b4=class extends bI{constructor(a=1,b=1,c={}){super(),c=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:av,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},c),this.isRenderTarget=!0,this.width=a,this.height=b,this.depth=c.depth,this.scissor=new b3(0,0,a,b),this.scissorTest=!1,this.viewport=new b3(0,0,a,b);let d=new b2({width:a,height:b,depth:c.depth});this.textures=[];let e=c.count;for(let a=0;a<e;a++)this.textures[a]=d.clone(),this.textures[a].isRenderTargetTexture=!0,this.textures[a].renderTarget=this;this._setTextureOptions(c),this.depthBuffer=c.depthBuffer,this.stencilBuffer=c.stencilBuffer,this.resolveDepthBuffer=c.resolveDepthBuffer,this.resolveStencilBuffer=c.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=c.depthTexture,this.samples=c.samples,this.multiview=c.multiview}_setTextureOptions(a={}){let b={minFilter:av,generateMipmaps:!1,flipY:!1,internalFormat:null};void 0!==a.mapping&&(b.mapping=a.mapping),void 0!==a.wrapS&&(b.wrapS=a.wrapS),void 0!==a.wrapT&&(b.wrapT=a.wrapT),void 0!==a.wrapR&&(b.wrapR=a.wrapR),void 0!==a.magFilter&&(b.magFilter=a.magFilter),void 0!==a.minFilter&&(b.minFilter=a.minFilter),void 0!==a.format&&(b.format=a.format),void 0!==a.type&&(b.type=a.type),void 0!==a.anisotropy&&(b.anisotropy=a.anisotropy),void 0!==a.colorSpace&&(b.colorSpace=a.colorSpace),void 0!==a.flipY&&(b.flipY=a.flipY),void 0!==a.generateMipmaps&&(b.generateMipmaps=a.generateMipmaps),void 0!==a.internalFormat&&(b.internalFormat=a.internalFormat);for(let a=0;a<this.textures.length;a++)this.textures[a].setValues(b)}get texture(){return this.textures[0]}set texture(a){this.textures[0]=a}set depthTexture(a){null!==this._depthTexture&&(this._depthTexture.renderTarget=null),null!==a&&(a.renderTarget=this),this._depthTexture=a}get depthTexture(){return this._depthTexture}setSize(a,b,c=1){if(this.width!==a||this.height!==b||this.depth!==c){this.width=a,this.height=b,this.depth=c;for(let d=0,e=this.textures.length;d<e;d++)this.textures[d].image.width=a,this.textures[d].image.height=b,this.textures[d].image.depth=c,!0!==this.textures[d].isData3DTexture&&(this.textures[d].isArrayTexture=this.textures[d].image.depth>1);this.dispose()}this.viewport.set(0,0,a,b),this.scissor.set(0,0,a,b)}clone(){return new this.constructor().copy(this)}copy(a){this.width=a.width,this.height=a.height,this.depth=a.depth,this.scissor.copy(a.scissor),this.scissorTest=a.scissorTest,this.viewport.copy(a.viewport),this.textures.length=0;for(let b=0,c=a.textures.length;b<c;b++){this.textures[b]=a.textures[b].clone(),this.textures[b].isRenderTargetTexture=!0,this.textures[b].renderTarget=this;let c=Object.assign({},a.textures[b].image);this.textures[b].source=new b_(c)}return this.depthBuffer=a.depthBuffer,this.stencilBuffer=a.stencilBuffer,this.resolveDepthBuffer=a.resolveDepthBuffer,this.resolveStencilBuffer=a.resolveStencilBuffer,null!==a.depthTexture&&(this.depthTexture=a.depthTexture.clone()),this.samples=a.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},b5=class extends b4{constructor(a=1,b=1,c={}){super(a,b,c),this.isWebGLRenderTarget=!0}},b6=class extends b2{constructor(a=null,b=1,c=1,d=1){super(null),this.isDataArrayTexture=!0,this.image={data:a,width:b,height:c,depth:d},this.magFilter=as,this.minFilter=as,this.wrapR=aq,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(a){this.layerUpdates.add(a)}clearLayerUpdates(){this.layerUpdates.clear()}},b7=class{constructor(a=new bQ(1/0,1/0,1/0),b=new bQ(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=a,this.max=b}set(a,b){return this.min.copy(a),this.max.copy(b),this}setFromArray(a){this.makeEmpty();for(let b=0,c=a.length;b<c;b+=3)this.expandByPoint(b9.fromArray(a,b));return this}setFromBufferAttribute(a){this.makeEmpty();for(let b=0,c=a.count;b<c;b++)this.expandByPoint(b9.fromBufferAttribute(a,b));return this}setFromPoints(a){this.makeEmpty();for(let b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this}setFromCenterAndSize(a,b){let c=b9.copy(b).multiplyScalar(.5);return this.min.copy(a).sub(c),this.max.copy(a).add(c),this}setFromObject(a,b=!1){return this.makeEmpty(),this.expandByObject(a,b)}clone(){return new this.constructor().copy(this)}copy(a){return this.min.copy(a.min),this.max.copy(a.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(a){return this.isEmpty()?a.set(0,0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(a){return this.isEmpty()?a.set(0,0,0):a.subVectors(this.max,this.min)}expandByPoint(a){return this.min.min(a),this.max.max(a),this}expandByVector(a){return this.min.sub(a),this.max.add(a),this}expandByScalar(a){return this.min.addScalar(-a),this.max.addScalar(a),this}expandByObject(a,b=!1){a.updateWorldMatrix(!1,!1);let c=a.geometry;if(void 0!==c){let d=c.getAttribute("position");if(!0===b&&void 0!==d&&!0!==a.isInstancedMesh)for(let b=0,c=d.count;b<c;b++)!0===a.isMesh?a.getVertexPosition(b,b9):b9.fromBufferAttribute(d,b),b9.applyMatrix4(a.matrixWorld),this.expandByPoint(b9);else void 0===a.boundingBox?(null===c.boundingBox&&c.computeBoundingBox(),ca.copy(c.boundingBox)):(null===a.boundingBox&&a.computeBoundingBox(),ca.copy(a.boundingBox)),ca.applyMatrix4(a.matrixWorld),this.union(ca)}let d=a.children;for(let a=0,c=d.length;a<c;a++)this.expandByObject(d[a],b);return this}containsPoint(a){return a.x>=this.min.x&&a.x<=this.max.x&&a.y>=this.min.y&&a.y<=this.max.y&&a.z>=this.min.z&&a.z<=this.max.z}containsBox(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z}getParameter(a,b){return b.set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(a){return a.max.x>=this.min.x&&a.min.x<=this.max.x&&a.max.y>=this.min.y&&a.min.y<=this.max.y&&a.max.z>=this.min.z&&a.min.z<=this.max.z}intersectsSphere(a){return this.clampPoint(a.center,b9),b9.distanceToSquared(a.center)<=a.radius*a.radius}intersectsPlane(a){let b,c;return a.normal.x>0?(b=a.normal.x*this.min.x,c=a.normal.x*this.max.x):(b=a.normal.x*this.max.x,c=a.normal.x*this.min.x),a.normal.y>0?(b+=a.normal.y*this.min.y,c+=a.normal.y*this.max.y):(b+=a.normal.y*this.max.y,c+=a.normal.y*this.min.y),a.normal.z>0?(b+=a.normal.z*this.min.z,c+=a.normal.z*this.max.z):(b+=a.normal.z*this.max.z,c+=a.normal.z*this.min.z),b<=-a.constant&&c>=-a.constant}intersectsTriangle(a){if(this.isEmpty())return!1;this.getCenter(ch),ci.subVectors(this.max,ch),cb.subVectors(a.a,ch),cc.subVectors(a.b,ch),cd.subVectors(a.c,ch),ce.subVectors(cc,cb),cf.subVectors(cd,cc),cg.subVectors(cb,cd);let b=[0,-ce.z,ce.y,0,-cf.z,cf.y,0,-cg.z,cg.y,ce.z,0,-ce.x,cf.z,0,-cf.x,cg.z,0,-cg.x,-ce.y,ce.x,0,-cf.y,cf.x,0,-cg.y,cg.x,0];return!!ai(b,cb,cc,cd,ci)&&!!ai(b=[1,0,0,0,1,0,0,0,1],cb,cc,cd,ci)&&(cj.crossVectors(ce,cf),ai(b=[cj.x,cj.y,cj.z],cb,cc,cd,ci))}clampPoint(a,b){return b.copy(a).clamp(this.min,this.max)}distanceToPoint(a){return this.clampPoint(a,b9).distanceTo(a)}getBoundingSphere(a){return this.isEmpty()?a.makeEmpty():(this.getCenter(a.center),a.radius=.5*this.getSize(b9).length()),a}intersect(a){return this.min.max(a.min),this.max.min(a.max),this.isEmpty()&&this.makeEmpty(),this}union(a){return this.min.min(a.min),this.max.max(a.max),this}applyMatrix4(a){return this.isEmpty()||(b8[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(a),b8[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(a),b8[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(a),b8[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(a),b8[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(a),b8[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(a),b8[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(a),b8[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(a),this.setFromPoints(b8)),this}translate(a){return this.min.add(a),this.max.add(a),this}equals(a){return a.min.equals(this.min)&&a.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(a){return this.min.fromArray(a.min),this.max.fromArray(a.max),this}},b8=[new bQ,new bQ,new bQ,new bQ,new bQ,new bQ,new bQ,new bQ],b9=new bQ,ca=new b7,cb=new bQ,cc=new bQ,cd=new bQ,ce=new bQ,cf=new bQ,cg=new bQ,ch=new bQ,ci=new bQ,cj=new bQ,ck=new bQ,cl=new b7,cm=new bQ,cn=new bQ,co=class{constructor(a=new bQ,b=-1){this.isSphere=!0,this.center=a,this.radius=b}set(a,b){return this.center.copy(a),this.radius=b,this}setFromPoints(a,b){let c=this.center;void 0===b?cl.setFromPoints(a).getCenter(c):c.copy(b);let d=0;for(let b=0,e=a.length;b<e;b++)d=Math.max(d,c.distanceToSquared(a[b]));return this.radius=Math.sqrt(d),this}copy(a){return this.center.copy(a.center),this.radius=a.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(a){return a.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(a){return a.distanceTo(this.center)-this.radius}intersectsSphere(a){let b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b}intersectsBox(a){return a.intersectsSphere(this)}intersectsPlane(a){return Math.abs(a.distanceToPoint(this.center))<=this.radius}clampPoint(a,b){let c=this.center.distanceToSquared(a);return b.copy(a),c>this.radius*this.radius&&(b.sub(this.center).normalize(),b.multiplyScalar(this.radius).add(this.center)),b}getBoundingBox(a){return this.isEmpty()?a.makeEmpty():(a.set(this.center,this.center),a.expandByScalar(this.radius)),a}applyMatrix4(a){return this.center.applyMatrix4(a),this.radius*=a.getMaxScaleOnAxis(),this}translate(a){return this.center.add(a),this}expandByPoint(a){if(this.isEmpty())return this.center.copy(a),this.radius=0,this;cm.subVectors(a,this.center);let b=cm.lengthSq();if(b>this.radius*this.radius){let a=Math.sqrt(b),c=(a-this.radius)*.5;this.center.addScaledVector(cm,c/a),this.radius+=c}return this}union(a){return a.isEmpty()||(this.isEmpty()?this.copy(a):!0===this.center.equals(a.center)?this.radius=Math.max(this.radius,a.radius):(cn.subVectors(a.center,this.center).setLength(a.radius),this.expandByPoint(cm.copy(a.center).add(cn)),this.expandByPoint(cm.copy(a.center).sub(cn)))),this}equals(a){return a.center.equals(this.center)&&a.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(a){return this.radius=a.radius,this.center.fromArray(a.center),this}},cp=new bQ,cq=new bQ,cr=new bQ,cs=new bQ,ct=new bQ,cu=new bQ,cv=new bQ,cw=class{constructor(a=new bQ,b=new bQ(0,0,-1)){this.origin=a,this.direction=b}set(a,b){return this.origin.copy(a),this.direction.copy(b),this}copy(a){return this.origin.copy(a.origin),this.direction.copy(a.direction),this}at(a,b){return b.copy(this.origin).addScaledVector(this.direction,a)}lookAt(a){return this.direction.copy(a).sub(this.origin).normalize(),this}recast(a){return this.origin.copy(this.at(a,cp)),this}closestPointToPoint(a,b){b.subVectors(a,this.origin);let c=b.dot(this.direction);return c<0?b.copy(this.origin):b.copy(this.origin).addScaledVector(this.direction,c)}distanceToPoint(a){return Math.sqrt(this.distanceSqToPoint(a))}distanceSqToPoint(a){let b=cp.subVectors(a,this.origin).dot(this.direction);return b<0?this.origin.distanceToSquared(a):(cp.copy(this.origin).addScaledVector(this.direction,b),cp.distanceToSquared(a))}distanceSqToSegment(a,b,c,d){cq.copy(a).add(b).multiplyScalar(.5),cr.copy(b).sub(a).normalize(),cs.copy(this.origin).sub(cq);let e=.5*a.distanceTo(b),f=-this.direction.dot(cr),g=cs.dot(this.direction),h=-cs.dot(cr),i=cs.lengthSq(),j=Math.abs(1-f*f),k,l,m,n;if(j>0)if(k=f*h-g,l=f*g-h,n=e*j,k>=0)if(l>=-n)if(l<=n){let a=1/j;k*=a,l*=a,m=k*(k+f*l+2*g)+l*(f*k+l+2*h)+i}else m=-(k=Math.max(0,-(f*(l=e)+g)))*k+l*(l+2*h)+i;else m=-(k=Math.max(0,-(f*(l=-e)+g)))*k+l*(l+2*h)+i;else l<=-n?(l=(k=Math.max(0,-(-f*e+g)))>0?-e:Math.min(Math.max(-e,-h),e),m=-k*k+l*(l+2*h)+i):l<=n?(k=0,m=(l=Math.min(Math.max(-e,-h),e))*(l+2*h)+i):(l=(k=Math.max(0,-(f*e+g)))>0?e:Math.min(Math.max(-e,-h),e),m=-k*k+l*(l+2*h)+i);else l=f>0?-e:e,m=-(k=Math.max(0,-(f*l+g)))*k+l*(l+2*h)+i;return c&&c.copy(this.origin).addScaledVector(this.direction,k),d&&d.copy(cq).addScaledVector(cr,l),m}intersectSphere(a,b){cp.subVectors(a.center,this.origin);let c=cp.dot(this.direction),d=cp.dot(cp)-c*c,e=a.radius*a.radius;if(d>e)return null;let f=Math.sqrt(e-d),g=c-f,h=c+f;return h<0?null:g<0?this.at(h,b):this.at(g,b)}intersectsSphere(a){return!(a.radius<0)&&this.distanceSqToPoint(a.center)<=a.radius*a.radius}distanceToPlane(a){let b=a.normal.dot(this.direction);if(0===b)return 0===a.distanceToPoint(this.origin)?0:null;let c=-(this.origin.dot(a.normal)+a.constant)/b;return c>=0?c:null}intersectPlane(a,b){let c=this.distanceToPlane(a);return null===c?null:this.at(c,b)}intersectsPlane(a){let b=a.distanceToPoint(this.origin);return 0===b||a.normal.dot(this.direction)*b<0}intersectBox(a,b){let c,d,e,f,g,h,i=1/this.direction.x,j=1/this.direction.y,k=1/this.direction.z,l=this.origin;return i>=0?(c=(a.min.x-l.x)*i,d=(a.max.x-l.x)*i):(c=(a.max.x-l.x)*i,d=(a.min.x-l.x)*i),j>=0?(e=(a.min.y-l.y)*j,f=(a.max.y-l.y)*j):(e=(a.max.y-l.y)*j,f=(a.min.y-l.y)*j),c>f||e>d||((e>c||isNaN(c))&&(c=e),(f<d||isNaN(d))&&(d=f),k>=0?(g=(a.min.z-l.z)*k,h=(a.max.z-l.z)*k):(g=(a.max.z-l.z)*k,h=(a.min.z-l.z)*k),c>h||g>d)||((g>c||c!=c)&&(c=g),(h<d||d!=d)&&(d=h),d<0)?null:this.at(c>=0?c:d,b)}intersectsBox(a){return null!==this.intersectBox(a,cp)}intersectTriangle(a,b,c,d,e){ct.subVectors(b,a),cu.subVectors(c,a),cv.crossVectors(ct,cu);let f=this.direction.dot(cv),g;if(f>0){if(d)return null;g=1}else{if(!(f<0))return null;g=-1,f=-f}cs.subVectors(this.origin,a);let h=g*this.direction.dot(cu.crossVectors(cs,cu));if(h<0)return null;let i=g*this.direction.dot(ct.cross(cs));if(i<0||h+i>f)return null;let j=-g*cs.dot(cv);return j<0?null:this.at(j/f,e)}applyMatrix4(a){return this.origin.applyMatrix4(a),this.direction.transformDirection(a),this}equals(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},cx=class a{constructor(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){a.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==b&&this.set(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q)}set(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){let q=this.elements;return q[0]=a,q[4]=b,q[8]=c,q[12]=d,q[1]=e,q[5]=f,q[9]=g,q[13]=h,q[2]=i,q[6]=j,q[10]=k,q[14]=l,q[3]=m,q[7]=n,q[11]=o,q[15]=p,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new a().fromArray(this.elements)}copy(a){let b=this.elements,c=a.elements;return b[0]=c[0],b[1]=c[1],b[2]=c[2],b[3]=c[3],b[4]=c[4],b[5]=c[5],b[6]=c[6],b[7]=c[7],b[8]=c[8],b[9]=c[9],b[10]=c[10],b[11]=c[11],b[12]=c[12],b[13]=c[13],b[14]=c[14],b[15]=c[15],this}copyPosition(a){let b=this.elements,c=a.elements;return b[12]=c[12],b[13]=c[13],b[14]=c[14],this}setFromMatrix3(a){let b=a.elements;return this.set(b[0],b[3],b[6],0,b[1],b[4],b[7],0,b[2],b[5],b[8],0,0,0,0,1),this}extractBasis(a,b,c){return a.setFromMatrixColumn(this,0),b.setFromMatrixColumn(this,1),c.setFromMatrixColumn(this,2),this}makeBasis(a,b,c){return this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1),this}extractRotation(a){let b=this.elements,c=a.elements,d=1/cy.setFromMatrixColumn(a,0).length(),e=1/cy.setFromMatrixColumn(a,1).length(),f=1/cy.setFromMatrixColumn(a,2).length();return b[0]=c[0]*d,b[1]=c[1]*d,b[2]=c[2]*d,b[3]=0,b[4]=c[4]*e,b[5]=c[5]*e,b[6]=c[6]*e,b[7]=0,b[8]=c[8]*f,b[9]=c[9]*f,b[10]=c[10]*f,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this}makeRotationFromEuler(a){let b=this.elements,c=a.x,d=a.y,e=a.z,f=Math.cos(c),g=Math.sin(c),h=Math.cos(d),i=Math.sin(d),j=Math.cos(e),k=Math.sin(e);if("XYZ"===a.order){let a=f*j,c=f*k,d=g*j,e=g*k;b[0]=h*j,b[4]=-h*k,b[8]=i,b[1]=c+d*i,b[5]=a-e*i,b[9]=-g*h,b[2]=e-a*i,b[6]=d+c*i,b[10]=f*h}else if("YXZ"===a.order){let a=h*j,c=h*k,d=i*j,e=i*k;b[0]=a+e*g,b[4]=d*g-c,b[8]=f*i,b[1]=f*k,b[5]=f*j,b[9]=-g,b[2]=c*g-d,b[6]=e+a*g,b[10]=f*h}else if("ZXY"===a.order){let a=h*j,c=h*k,d=i*j,e=i*k;b[0]=a-e*g,b[4]=-f*k,b[8]=d+c*g,b[1]=c+d*g,b[5]=f*j,b[9]=e-a*g,b[2]=-f*i,b[6]=g,b[10]=f*h}else if("ZYX"===a.order){let a=f*j,c=f*k,d=g*j,e=g*k;b[0]=h*j,b[4]=d*i-c,b[8]=a*i+e,b[1]=h*k,b[5]=e*i+a,b[9]=c*i-d,b[2]=-i,b[6]=g*h,b[10]=f*h}else if("YZX"===a.order){let a=f*h,c=f*i,d=g*h,e=g*i;b[0]=h*j,b[4]=e-a*k,b[8]=d*k+c,b[1]=k,b[5]=f*j,b[9]=-g*j,b[2]=-i*j,b[6]=c*k+d,b[10]=a-e*k}else if("XZY"===a.order){let a=f*h,c=f*i,d=g*h,e=g*i;b[0]=h*j,b[4]=-k,b[8]=i*j,b[1]=a*k+e,b[5]=f*j,b[9]=c*k-d,b[2]=d*k-c,b[6]=g*j,b[10]=e*k+a}return b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this}makeRotationFromQuaternion(a){return this.compose(cA,a,cB)}lookAt(a,b,c){let d=this.elements;return cE.subVectors(a,b),0===cE.lengthSq()&&(cE.z=1),cE.normalize(),cC.crossVectors(c,cE),0===cC.lengthSq()&&(1===Math.abs(c.z)?cE.x+=1e-4:cE.z+=1e-4,cE.normalize(),cC.crossVectors(c,cE)),cC.normalize(),cD.crossVectors(cE,cC),d[0]=cC.x,d[4]=cD.x,d[8]=cE.x,d[1]=cC.y,d[5]=cD.y,d[9]=cE.y,d[2]=cC.z,d[6]=cD.z,d[10]=cE.z,this}multiply(a){return this.multiplyMatrices(this,a)}premultiply(a){return this.multiplyMatrices(a,this)}multiplyMatrices(a,b){let c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],i=c[12],j=c[1],k=c[5],l=c[9],m=c[13],n=c[2],o=c[6],p=c[10],q=c[14],r=c[3],s=c[7],t=c[11],u=c[15],v=d[0],w=d[4],x=d[8],y=d[12],z=d[1],A=d[5],B=d[9],C=d[13],D=d[2],E=d[6],F=d[10],G=d[14],H=d[3],I=d[7],J=d[11],K=d[15];return e[0]=f*v+g*z+h*D+i*H,e[4]=f*w+g*A+h*E+i*I,e[8]=f*x+g*B+h*F+i*J,e[12]=f*y+g*C+h*G+i*K,e[1]=j*v+k*z+l*D+m*H,e[5]=j*w+k*A+l*E+m*I,e[9]=j*x+k*B+l*F+m*J,e[13]=j*y+k*C+l*G+m*K,e[2]=n*v+o*z+p*D+q*H,e[6]=n*w+o*A+p*E+q*I,e[10]=n*x+o*B+p*F+q*J,e[14]=n*y+o*C+p*G+q*K,e[3]=r*v+s*z+t*D+u*H,e[7]=r*w+s*A+t*E+u*I,e[11]=r*x+s*B+t*F+u*J,e[15]=r*y+s*C+t*G+u*K,this}multiplyScalar(a){let b=this.elements;return b[0]*=a,b[4]*=a,b[8]*=a,b[12]*=a,b[1]*=a,b[5]*=a,b[9]*=a,b[13]*=a,b[2]*=a,b[6]*=a,b[10]*=a,b[14]*=a,b[3]*=a,b[7]*=a,b[11]*=a,b[15]*=a,this}determinant(){let a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],i=a[13],j=a[2],k=a[6],l=a[10],m=a[14];return a[3]*(e*h*k-d*i*k-e*g*l+c*i*l+d*g*m-c*h*m)+a[7]*(b*h*m-b*i*l+e*f*l-d*f*m+d*i*j-e*h*j)+a[11]*(b*i*k-b*g*m-e*f*k+c*f*m+e*g*j-c*i*j)+a[15]*(-d*g*j-b*h*k+b*g*l+d*f*k-c*f*l+c*h*j)}transpose(){let a=this.elements,b;return b=a[1],a[1]=a[4],a[4]=b,b=a[2],a[2]=a[8],a[8]=b,b=a[6],a[6]=a[9],a[9]=b,b=a[3],a[3]=a[12],a[12]=b,b=a[7],a[7]=a[13],a[13]=b,b=a[11],a[11]=a[14],a[14]=b,this}setPosition(a,b,c){let d=this.elements;return a.isVector3?(d[12]=a.x,d[13]=a.y,d[14]=a.z):(d[12]=a,d[13]=b,d[14]=c),this}invert(){let a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=k*p*i-o*l*i+o*h*m-g*p*m-k*h*q+g*l*q,s=n*l*i-j*p*i-n*h*m+f*p*m+j*h*q-f*l*q,t=j*o*i-n*k*i+n*g*m-f*o*m-j*g*q+f*k*q,u=n*k*h-j*o*h-n*g*l+f*o*l+j*g*p-f*k*p,v=b*r+c*s+d*t+e*u;if(0===v)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let w=1/v;return a[0]=r*w,a[1]=(o*l*e-k*p*e-o*d*m+c*p*m+k*d*q-c*l*q)*w,a[2]=(g*p*e-o*h*e+o*d*i-c*p*i-g*d*q+c*h*q)*w,a[3]=(k*h*e-g*l*e-k*d*i+c*l*i+g*d*m-c*h*m)*w,a[4]=s*w,a[5]=(j*p*e-n*l*e+n*d*m-b*p*m-j*d*q+b*l*q)*w,a[6]=(n*h*e-f*p*e-n*d*i+b*p*i+f*d*q-b*h*q)*w,a[7]=(f*l*e-j*h*e+j*d*i-b*l*i-f*d*m+b*h*m)*w,a[8]=t*w,a[9]=(n*k*e-j*o*e-n*c*m+b*o*m+j*c*q-b*k*q)*w,a[10]=(f*o*e-n*g*e+n*c*i-b*o*i-f*c*q+b*g*q)*w,a[11]=(j*g*e-f*k*e-j*c*i+b*k*i+f*c*m-b*g*m)*w,a[12]=u*w,a[13]=(j*o*d-n*k*d+n*c*l-b*o*l-j*c*p+b*k*p)*w,a[14]=(n*g*d-f*o*d-n*c*h+b*o*h+f*c*p-b*g*p)*w,a[15]=(f*k*d-j*g*d+j*c*h-b*k*h-f*c*l+b*g*l)*w,this}scale(a){let b=this.elements,c=a.x,d=a.y,e=a.z;return b[0]*=c,b[4]*=d,b[8]*=e,b[1]*=c,b[5]*=d,b[9]*=e,b[2]*=c,b[6]*=d,b[10]*=e,b[3]*=c,b[7]*=d,b[11]*=e,this}getMaxScaleOnAxis(){let a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))}makeTranslation(a,b,c){return a.isVector3?this.set(1,0,0,a.x,0,1,0,a.y,0,0,1,a.z,0,0,0,1):this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1),this}makeRotationX(a){let b=Math.cos(a),c=Math.sin(a);return this.set(1,0,0,0,0,b,-c,0,0,c,b,0,0,0,0,1),this}makeRotationY(a){let b=Math.cos(a),c=Math.sin(a);return this.set(b,0,c,0,0,1,0,0,-c,0,b,0,0,0,0,1),this}makeRotationZ(a){let b=Math.cos(a),c=Math.sin(a);return this.set(b,-c,0,0,c,b,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(a,b){let c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,g=a.y,h=a.z,i=e*f,j=e*g;return this.set(i*f+c,i*g-d*h,i*h+d*g,0,i*g+d*h,j*g+c,j*h-d*f,0,i*h-d*g,j*h+d*f,e*h*h+c,0,0,0,0,1),this}makeScale(a,b,c){return this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1),this}makeShear(a,b,c,d,e,f){return this.set(1,c,e,0,a,1,f,0,b,d,1,0,0,0,0,1),this}compose(a,b,c){let d=this.elements,e=b._x,f=b._y,g=b._z,h=b._w,i=e+e,j=f+f,k=g+g,l=e*i,m=e*j,n=e*k,o=f*j,p=f*k,q=g*k,r=h*i,s=h*j,t=h*k,u=c.x,v=c.y,w=c.z;return d[0]=(1-(o+q))*u,d[1]=(m+t)*u,d[2]=(n-s)*u,d[3]=0,d[4]=(m-t)*v,d[5]=(1-(l+q))*v,d[6]=(p+r)*v,d[7]=0,d[8]=(n+s)*w,d[9]=(p-r)*w,d[10]=(1-(l+o))*w,d[11]=0,d[12]=a.x,d[13]=a.y,d[14]=a.z,d[15]=1,this}decompose(a,b,c){let d=this.elements,e=cy.set(d[0],d[1],d[2]).length(),f=cy.set(d[4],d[5],d[6]).length(),g=cy.set(d[8],d[9],d[10]).length();0>this.determinant()&&(e=-e),a.x=d[12],a.y=d[13],a.z=d[14],cz.copy(this);let h=1/e,i=1/f,j=1/g;return cz.elements[0]*=h,cz.elements[1]*=h,cz.elements[2]*=h,cz.elements[4]*=i,cz.elements[5]*=i,cz.elements[6]*=i,cz.elements[8]*=j,cz.elements[9]*=j,cz.elements[10]*=j,b.setFromRotationMatrix(cz),c.x=e,c.y=f,c.z=g,this}makePerspective(a,b,c,d,e,f,g=bD,h=!1){let i=this.elements,j,k;if(h)j=e/(f-e),k=f*e/(f-e);else if(2e3===g)j=-(f+e)/(f-e),k=-2*f*e/(f-e);else if(2001===g)j=-f/(f-e),k=-f*e/(f-e);else throw Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+g);return i[0]=2*e/(b-a),i[4]=0,i[8]=(b+a)/(b-a),i[12]=0,i[1]=0,i[5]=2*e/(c-d),i[9]=(c+d)/(c-d),i[13]=0,i[2]=0,i[6]=0,i[10]=j,i[14]=k,i[3]=0,i[7]=0,i[11]=-1,i[15]=0,this}makeOrthographic(a,b,c,d,e,f,g=bD,h=!1){let i=this.elements,j,k;if(h)j=1/(f-e),k=f/(f-e);else if(2e3===g)j=-2/(f-e),k=-(f+e)/(f-e);else if(2001===g)j=-1/(f-e),k=-e/(f-e);else throw Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+g);return i[0]=2/(b-a),i[4]=0,i[8]=0,i[12]=-(b+a)/(b-a),i[1]=0,i[5]=2/(c-d),i[9]=0,i[13]=-(c+d)/(c-d),i[2]=0,i[6]=0,i[10]=j,i[14]=k,i[3]=0,i[7]=0,i[11]=0,i[15]=1,this}equals(a){let b=this.elements,c=a.elements;for(let a=0;a<16;a++)if(b[a]!==c[a])return!1;return!0}fromArray(a,b=0){for(let c=0;c<16;c++)this.elements[c]=a[c+b];return this}toArray(a=[],b=0){let c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a[b+9]=c[9],a[b+10]=c[10],a[b+11]=c[11],a[b+12]=c[12],a[b+13]=c[13],a[b+14]=c[14],a[b+15]=c[15],a}},cy=new bQ,cz=new cx,cA=new bQ(0,0,0),cB=new bQ(1,1,1),cC=new bQ,cD=new bQ,cE=new bQ,cF=new cx,cG=new bP,(cH=class a{constructor(b=0,c=0,d=0,e=a.DEFAULT_ORDER){this.isEuler=!0,this._x=b,this._y=c,this._z=d,this._order=e}get x(){return this._x}set x(a){this._x=a,this._onChangeCallback()}get y(){return this._y}set y(a){this._y=a,this._onChangeCallback()}get z(){return this._z}set z(a){this._z=a,this._onChangeCallback()}get order(){return this._order}set order(a){this._order=a,this._onChangeCallback()}set(a,b,c,d=this._order){return this._x=a,this._y=b,this._z=c,this._order=d,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(a){return this._x=a._x,this._y=a._y,this._z=a._z,this._order=a._order,this._onChangeCallback(),this}setFromRotationMatrix(a,b=this._order,c=!0){let d=a.elements,e=d[0],f=d[4],g=d[8],h=d[1],i=d[5],j=d[9],k=d[2],l=d[6],m=d[10];switch(b){case"XYZ":this._y=Math.asin(M(g,-1,1)),.9999999>Math.abs(g)?(this._x=Math.atan2(-j,m),this._z=Math.atan2(-f,e)):(this._x=Math.atan2(l,i),this._z=0);break;case"YXZ":this._x=Math.asin(-M(j,-1,1)),.9999999>Math.abs(j)?(this._y=Math.atan2(g,m),this._z=Math.atan2(h,i)):(this._y=Math.atan2(-k,e),this._z=0);break;case"ZXY":this._x=Math.asin(M(l,-1,1)),.9999999>Math.abs(l)?(this._y=Math.atan2(-k,m),this._z=Math.atan2(-f,i)):(this._y=0,this._z=Math.atan2(h,e));break;case"ZYX":this._y=Math.asin(-M(k,-1,1)),.9999999>Math.abs(k)?(this._x=Math.atan2(l,m),this._z=Math.atan2(h,e)):(this._x=0,this._z=Math.atan2(-f,i));break;case"YZX":this._z=Math.asin(M(h,-1,1)),.9999999>Math.abs(h)?(this._x=Math.atan2(-j,i),this._y=Math.atan2(-k,e)):(this._x=0,this._y=Math.atan2(g,m));break;case"XZY":this._z=Math.asin(-M(f,-1,1)),.9999999>Math.abs(f)?(this._x=Math.atan2(l,i),this._y=Math.atan2(g,e)):(this._x=Math.atan2(-j,m),this._y=0);break;default:I("Euler: .setFromRotationMatrix() encountered an unknown order: "+b)}return this._order=b,!0===c&&this._onChangeCallback(),this}setFromQuaternion(a,b,c){return cF.makeRotationFromQuaternion(a),this.setFromRotationMatrix(cF,b,c)}setFromVector3(a,b=this._order){return this.set(a.x,a.y,a.z,b)}reorder(a){return cG.setFromEuler(this),this.setFromQuaternion(cG,a)}equals(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order}fromArray(a){return this._x=a[0],this._y=a[1],this._z=a[2],void 0!==a[3]&&(this._order=a[3]),this._onChangeCallback(),this}toArray(a=[],b=0){return a[b]=this._x,a[b+1]=this._y,a[b+2]=this._z,a[b+3]=this._order,a}_onChange(a){return this._onChangeCallback=a,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}).DEFAULT_ORDER="XYZ",cI=class{constructor(){this.mask=1}set(a){this.mask=1<<a>>>0}enable(a){this.mask|=1<<a}enableAll(){this.mask=-1}toggle(a){this.mask^=1<<a}disable(a){this.mask&=~(1<<a)}disableAll(){this.mask=0}test(a){return(this.mask&a.mask)!=0}isEnabled(a){return(this.mask&1<<a)!=0}},cJ=0,cK=new bQ,cL=new bP,cM=new cx,cN=new bQ,cO=new bQ,cP=new bQ,cQ=new bP,cR=new bQ(1,0,0),cS=new bQ(0,1,0),cT=new bQ(0,0,1),cU={type:"added"},cV={type:"removed"},cW={type:"childadded",child:null},cX={type:"childremoved",child:null},cY=class a extends bI{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:cJ++}),this.uuid=L(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=a.DEFAULT_UP.clone();let b=new bQ,c=new cH,d=new bP,e=new bQ(1,1,1);c._onChange(function(){d.setFromEuler(c,!1)}),d._onChange(function(){c.setFromQuaternion(d,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:b},rotation:{configurable:!0,enumerable:!0,value:c},quaternion:{configurable:!0,enumerable:!0,value:d},scale:{configurable:!0,enumerable:!0,value:e},modelViewMatrix:{value:new cx},normalMatrix:{value:new bT}}),this.matrix=new cx,this.matrixWorld=new cx,this.matrixAutoUpdate=a.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=a.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new cI,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(a){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(a),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(a){return this.quaternion.premultiply(a),this}setRotationFromAxisAngle(a,b){this.quaternion.setFromAxisAngle(a,b)}setRotationFromEuler(a){this.quaternion.setFromEuler(a,!0)}setRotationFromMatrix(a){this.quaternion.setFromRotationMatrix(a)}setRotationFromQuaternion(a){this.quaternion.copy(a)}rotateOnAxis(a,b){return cL.setFromAxisAngle(a,b),this.quaternion.multiply(cL),this}rotateOnWorldAxis(a,b){return cL.setFromAxisAngle(a,b),this.quaternion.premultiply(cL),this}rotateX(a){return this.rotateOnAxis(cR,a)}rotateY(a){return this.rotateOnAxis(cS,a)}rotateZ(a){return this.rotateOnAxis(cT,a)}translateOnAxis(a,b){return cK.copy(a).applyQuaternion(this.quaternion),this.position.add(cK.multiplyScalar(b)),this}translateX(a){return this.translateOnAxis(cR,a)}translateY(a){return this.translateOnAxis(cS,a)}translateZ(a){return this.translateOnAxis(cT,a)}localToWorld(a){return this.updateWorldMatrix(!0,!1),a.applyMatrix4(this.matrixWorld)}worldToLocal(a){return this.updateWorldMatrix(!0,!1),a.applyMatrix4(cM.copy(this.matrixWorld).invert())}lookAt(a,b,c){a.isVector3?cN.copy(a):cN.set(a,b,c);let d=this.parent;this.updateWorldMatrix(!0,!1),cO.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?cM.lookAt(cO,cN,this.up):cM.lookAt(cN,cO,this.up),this.quaternion.setFromRotationMatrix(cM),d&&(cM.extractRotation(d.matrixWorld),cL.setFromRotationMatrix(cM),this.quaternion.premultiply(cL.invert()))}add(a){if(arguments.length>1){for(let a=0;a<arguments.length;a++)this.add(arguments[a]);return this}return a===this?J("Object3D.add: object can't be added as a child of itself.",a):a&&a.isObject3D?(a.removeFromParent(),a.parent=this,this.children.push(a),a.dispatchEvent(cU),cW.child=a,this.dispatchEvent(cW),cW.child=null):J("Object3D.add: object not an instance of THREE.Object3D.",a),this}remove(a){if(arguments.length>1){for(let a=0;a<arguments.length;a++)this.remove(arguments[a]);return this}let b=this.children.indexOf(a);return -1!==b&&(a.parent=null,this.children.splice(b,1),a.dispatchEvent(cV),cX.child=a,this.dispatchEvent(cX),cX.child=null),this}removeFromParent(){let a=this.parent;return null!==a&&a.remove(this),this}clear(){return this.remove(...this.children)}attach(a){return this.updateWorldMatrix(!0,!1),cM.copy(this.matrixWorld).invert(),null!==a.parent&&(a.parent.updateWorldMatrix(!0,!1),cM.multiply(a.parent.matrixWorld)),a.applyMatrix4(cM),a.removeFromParent(),a.parent=this,this.children.push(a),a.updateWorldMatrix(!1,!0),a.dispatchEvent(cU),cW.child=a,this.dispatchEvent(cW),cW.child=null,this}getObjectById(a){return this.getObjectByProperty("id",a)}getObjectByName(a){return this.getObjectByProperty("name",a)}getObjectByProperty(a,b){if(this[a]===b)return this;for(let c=0,d=this.children.length;c<d;c++){let d=this.children[c].getObjectByProperty(a,b);if(void 0!==d)return d}}getObjectsByProperty(a,b,c=[]){this[a]===b&&c.push(this);let d=this.children;for(let e=0,f=d.length;e<f;e++)d[e].getObjectsByProperty(a,b,c);return c}getWorldPosition(a){return this.updateWorldMatrix(!0,!1),a.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(a){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(cO,a,cP),a}getWorldScale(a){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(cO,cQ,a),a}getWorldDirection(a){this.updateWorldMatrix(!0,!1);let b=this.matrixWorld.elements;return a.set(b[8],b[9],b[10]).normalize()}raycast(){}traverse(a){a(this);let b=this.children;for(let c=0,d=b.length;c<d;c++)b[c].traverse(a)}traverseVisible(a){if(!1===this.visible)return;a(this);let b=this.children;for(let c=0,d=b.length;c<d;c++)b[c].traverseVisible(a)}traverseAncestors(a){let b=this.parent;null!==b&&(a(b),b.traverseAncestors(a))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(a){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||a)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,a=!0);let b=this.children;for(let c=0,d=b.length;c<d;c++)b[c].updateMatrixWorld(a)}updateWorldMatrix(a,b){let c=this.parent;if(!0===a&&null!==c&&c.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===b){let a=this.children;for(let b=0,c=a.length;b<c;b++)a[b].updateWorldMatrix(!1,!0)}}toJSON(a){let b=void 0===a||"string"==typeof a,c={};b&&(a={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},c.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});let d={};function e(b,c){return void 0===b[c.uuid]&&(b[c.uuid]=c.toJSON(a)),c.uuid}if(d.uuid=this.uuid,d.type=this.type,""!==this.name&&(d.name=this.name),!0===this.castShadow&&(d.castShadow=!0),!0===this.receiveShadow&&(d.receiveShadow=!0),!1===this.visible&&(d.visible=!1),!1===this.frustumCulled&&(d.frustumCulled=!1),0!==this.renderOrder&&(d.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(d.userData=this.userData),d.layers=this.layers.mask,d.matrix=this.matrix.toArray(),d.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(d.matrixAutoUpdate=!1),this.isInstancedMesh&&(d.type="InstancedMesh",d.count=this.count,d.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(d.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(d.type="BatchedMesh",d.perObjectFrustumCulled=this.perObjectFrustumCulled,d.sortObjects=this.sortObjects,d.drawRanges=this._drawRanges,d.reservedRanges=this._reservedRanges,d.geometryInfo=this._geometryInfo.map(a=>({...a,boundingBox:a.boundingBox?a.boundingBox.toJSON():void 0,boundingSphere:a.boundingSphere?a.boundingSphere.toJSON():void 0})),d.instanceInfo=this._instanceInfo.map(a=>({...a})),d.availableInstanceIds=this._availableInstanceIds.slice(),d.availableGeometryIds=this._availableGeometryIds.slice(),d.nextIndexStart=this._nextIndexStart,d.nextVertexStart=this._nextVertexStart,d.geometryCount=this._geometryCount,d.maxInstanceCount=this._maxInstanceCount,d.maxVertexCount=this._maxVertexCount,d.maxIndexCount=this._maxIndexCount,d.geometryInitialized=this._geometryInitialized,d.matricesTexture=this._matricesTexture.toJSON(a),d.indirectTexture=this._indirectTexture.toJSON(a),null!==this._colorsTexture&&(d.colorsTexture=this._colorsTexture.toJSON(a)),null!==this.boundingSphere&&(d.boundingSphere=this.boundingSphere.toJSON()),null!==this.boundingBox&&(d.boundingBox=this.boundingBox.toJSON())),this.isScene)this.background&&(this.background.isColor?d.background=this.background.toJSON():this.background.isTexture&&(d.background=this.background.toJSON(a).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(d.environment=this.environment.toJSON(a).uuid);else if(this.isMesh||this.isLine||this.isPoints){d.geometry=e(a.geometries,this.geometry);let b=this.geometry.parameters;if(void 0!==b&&void 0!==b.shapes){let c=b.shapes;if(Array.isArray(c))for(let b=0,d=c.length;b<d;b++){let d=c[b];e(a.shapes,d)}else e(a.shapes,c)}}if(this.isSkinnedMesh&&(d.bindMode=this.bindMode,d.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(e(a.skeletons,this.skeleton),d.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){let b=[];for(let c=0,d=this.material.length;c<d;c++)b.push(e(a.materials,this.material[c]));d.material=b}else d.material=e(a.materials,this.material);if(this.children.length>0){d.children=[];for(let b=0;b<this.children.length;b++)d.children.push(this.children[b].toJSON(a).object)}if(this.animations.length>0){d.animations=[];for(let b=0;b<this.animations.length;b++){let c=this.animations[b];d.animations.push(e(a.animations,c))}}if(b){let b=f(a.geometries),d=f(a.materials),e=f(a.textures),g=f(a.images),h=f(a.shapes),i=f(a.skeletons),j=f(a.animations),k=f(a.nodes);b.length>0&&(c.geometries=b),d.length>0&&(c.materials=d),e.length>0&&(c.textures=e),g.length>0&&(c.images=g),h.length>0&&(c.shapes=h),i.length>0&&(c.skeletons=i),j.length>0&&(c.animations=j),k.length>0&&(c.nodes=k)}return c.object=d,c;function f(a){let b=[];for(let c in a){let d=a[c];delete d.metadata,b.push(d)}return b}}clone(a){return new this.constructor().copy(this,a)}copy(a,b=!0){if(this.name=a.name,this.up.copy(a.up),this.position.copy(a.position),this.rotation.order=a.rotation.order,this.quaternion.copy(a.quaternion),this.scale.copy(a.scale),this.matrix.copy(a.matrix),this.matrixWorld.copy(a.matrixWorld),this.matrixAutoUpdate=a.matrixAutoUpdate,this.matrixWorldAutoUpdate=a.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate,this.layers.mask=a.layers.mask,this.visible=a.visible,this.castShadow=a.castShadow,this.receiveShadow=a.receiveShadow,this.frustumCulled=a.frustumCulled,this.renderOrder=a.renderOrder,this.animations=a.animations.slice(),this.userData=JSON.parse(JSON.stringify(a.userData)),!0===b)for(let b=0;b<a.children.length;b++){let c=a.children[b];this.add(c.clone())}return this}},cY.DEFAULT_UP=new bQ(0,1,0),cY.DEFAULT_MATRIX_AUTO_UPDATE=!0,cY.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0,cZ=new bQ,c$=new bQ,c_=new bQ,c0=new bQ,c1=new bQ,c2=new bQ,c3=new bQ,c4=new bQ,c5=new bQ,c6=new bQ,c7=new b3,c8=new b3,c9=new b3,da=class a{constructor(a=new bQ,b=new bQ,c=new bQ){this.a=a,this.b=b,this.c=c}static getNormal(a,b,c,d){d.subVectors(c,b),cZ.subVectors(a,b),d.cross(cZ);let e=d.lengthSq();return e>0?d.multiplyScalar(1/Math.sqrt(e)):d.set(0,0,0)}static getBarycoord(a,b,c,d,e){cZ.subVectors(d,b),c$.subVectors(c,b),c_.subVectors(a,b);let f=cZ.dot(cZ),g=cZ.dot(c$),h=cZ.dot(c_),i=c$.dot(c$),j=c$.dot(c_),k=f*i-g*g;if(0===k)return e.set(0,0,0),null;let l=1/k,m=(i*h-g*j)*l,n=(f*j-g*h)*l;return e.set(1-m-n,n,m)}static containsPoint(a,b,c,d){return null!==this.getBarycoord(a,b,c,d,c0)&&c0.x>=0&&c0.y>=0&&c0.x+c0.y<=1}static getInterpolation(a,b,c,d,e,f,g,h){return null===this.getBarycoord(a,b,c,d,c0)?(h.x=0,h.y=0,"z"in h&&(h.z=0),"w"in h&&(h.w=0),null):(h.setScalar(0),h.addScaledVector(e,c0.x),h.addScaledVector(f,c0.y),h.addScaledVector(g,c0.z),h)}static getInterpolatedAttribute(a,b,c,d,e,f){return c7.setScalar(0),c8.setScalar(0),c9.setScalar(0),c7.fromBufferAttribute(a,b),c8.fromBufferAttribute(a,c),c9.fromBufferAttribute(a,d),f.setScalar(0),f.addScaledVector(c7,e.x),f.addScaledVector(c8,e.y),f.addScaledVector(c9,e.z),f}static isFrontFacing(a,b,c,d){return cZ.subVectors(c,b),c$.subVectors(a,b),0>cZ.cross(c$).dot(d)}set(a,b,c){return this.a.copy(a),this.b.copy(b),this.c.copy(c),this}setFromPointsAndIndices(a,b,c,d){return this.a.copy(a[b]),this.b.copy(a[c]),this.c.copy(a[d]),this}setFromAttributeAndIndices(a,b,c,d){return this.a.fromBufferAttribute(a,b),this.b.fromBufferAttribute(a,c),this.c.fromBufferAttribute(a,d),this}clone(){return new this.constructor().copy(this)}copy(a){return this.a.copy(a.a),this.b.copy(a.b),this.c.copy(a.c),this}getArea(){return cZ.subVectors(this.c,this.b),c$.subVectors(this.a,this.b),.5*cZ.cross(c$).length()}getMidpoint(a){return a.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(b){return a.getNormal(this.a,this.b,this.c,b)}getPlane(a){return a.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(b,c){return a.getBarycoord(b,this.a,this.b,this.c,c)}getInterpolation(b,c,d,e,f){return a.getInterpolation(b,this.a,this.b,this.c,c,d,e,f)}containsPoint(b){return a.containsPoint(b,this.a,this.b,this.c)}isFrontFacing(b){return a.isFrontFacing(this.a,this.b,this.c,b)}intersectsBox(a){return a.intersectsTriangle(this)}closestPointToPoint(a,b){let c=this.a,d=this.b,e=this.c,f,g;c1.subVectors(d,c),c2.subVectors(e,c),c4.subVectors(a,c);let h=c1.dot(c4),i=c2.dot(c4);if(h<=0&&i<=0)return b.copy(c);c5.subVectors(a,d);let j=c1.dot(c5),k=c2.dot(c5);if(j>=0&&k<=j)return b.copy(d);let l=h*k-j*i;if(l<=0&&h>=0&&j<=0)return f=h/(h-j),b.copy(c).addScaledVector(c1,f);c6.subVectors(a,e);let m=c1.dot(c6),n=c2.dot(c6);if(n>=0&&m<=n)return b.copy(e);let o=m*i-h*n;if(o<=0&&i>=0&&n<=0)return g=i/(i-n),b.copy(c).addScaledVector(c2,g);let p=j*n-m*k;if(p<=0&&k-j>=0&&m-n>=0)return c3.subVectors(e,d),g=(k-j)/(k-j+(m-n)),b.copy(d).addScaledVector(c3,g);let q=1/(p+o+l);return f=o*q,g=l*q,b.copy(c).addScaledVector(c1,f).addScaledVector(c2,g)}equals(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}},db={aliceblue:0xf0f8ff,antiquewhite:0xfaebd7,aqua:65535,aquamarine:8388564,azure:0xf0ffff,beige:0xf5f5dc,bisque:0xffe4c4,black:0,blanchedalmond:0xffebcd,blue:255,blueviolet:9055202,brown:0xa52a2a,burlywood:0xdeb887,cadetblue:6266528,chartreuse:8388352,chocolate:0xd2691e,coral:0xff7f50,cornflowerblue:6591981,cornsilk:0xfff8dc,crimson:0xdc143c,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:0xb8860b,darkgray:0xa9a9a9,darkgreen:25600,darkgrey:0xa9a9a9,darkkhaki:0xbdb76b,darkmagenta:9109643,darkolivegreen:5597999,darkorange:0xff8c00,darkorchid:0x9932cc,darkred:9109504,darksalmon:0xe9967a,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:0xff1493,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:0xb22222,floralwhite:0xfffaf0,forestgreen:2263842,fuchsia:0xff00ff,gainsboro:0xdcdcdc,ghostwhite:0xf8f8ff,gold:0xffd700,goldenrod:0xdaa520,gray:8421504,green:32768,greenyellow:0xadff2f,grey:8421504,honeydew:0xf0fff0,hotpink:0xff69b4,indianred:0xcd5c5c,indigo:4915330,ivory:0xfffff0,khaki:0xf0e68c,lavender:0xe6e6fa,lavenderblush:0xfff0f5,lawngreen:8190976,lemonchiffon:0xfffacd,lightblue:0xadd8e6,lightcoral:0xf08080,lightcyan:0xe0ffff,lightgoldenrodyellow:0xfafad2,lightgray:0xd3d3d3,lightgreen:9498256,lightgrey:0xd3d3d3,lightpink:0xffb6c1,lightsalmon:0xffa07a,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:0xb0c4de,lightyellow:0xffffe0,lime:65280,limegreen:3329330,linen:0xfaf0e6,magenta:0xff00ff,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:0xba55d3,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:0xc71585,midnightblue:1644912,mintcream:0xf5fffa,mistyrose:0xffe4e1,moccasin:0xffe4b5,navajowhite:0xffdead,navy:128,oldlace:0xfdf5e6,olive:8421376,olivedrab:7048739,orange:0xffa500,orangered:0xff4500,orchid:0xda70d6,palegoldenrod:0xeee8aa,palegreen:0x98fb98,paleturquoise:0xafeeee,palevioletred:0xdb7093,papayawhip:0xffefd5,peachpuff:0xffdab9,peru:0xcd853f,pink:0xffc0cb,plum:0xdda0dd,powderblue:0xb0e0e6,purple:8388736,rebeccapurple:6697881,red:0xff0000,rosybrown:0xbc8f8f,royalblue:4286945,saddlebrown:9127187,salmon:0xfa8072,sandybrown:0xf4a460,seagreen:3050327,seashell:0xfff5ee,sienna:0xa0522d,silver:0xc0c0c0,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:0xfffafa,springgreen:65407,steelblue:4620980,tan:0xd2b48c,teal:32896,thistle:0xd8bfd8,tomato:0xff6347,turquoise:4251856,violet:0xee82ee,wheat:0xf5deb3,white:0xffffff,whitesmoke:0xf5f5f5,yellow:0xffff00,yellowgreen:0x9acd32},dc={h:0,s:0,l:0},dd={h:0,s:0,l:0},de=class{constructor(a,b,c){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(a,b,c)}set(a,b,c){return void 0===b&&void 0===c?a&&a.isColor?this.copy(a):"number"==typeof a?this.setHex(a):"string"==typeof a&&this.setStyle(a):this.setRGB(a,b,c),this}setScalar(a){return this.r=a,this.g=a,this.b=a,this}setHex(a,b=br){return a=Math.floor(a),this.r=(a>>16&255)/255,this.g=(a>>8&255)/255,this.b=(255&a)/255,bX.colorSpaceToWorking(this,b),this}setRGB(a,b,c,d=bX.workingColorSpace){return this.r=a,this.g=b,this.b=c,bX.colorSpaceToWorking(this,d),this}setHSL(a,b,c,d=bX.workingColorSpace){if(a=N(a,1),b=M(b,0,1),c=M(c,0,1),0===b)this.r=this.g=this.b=c;else{let d=c<=.5?c*(1+b):c+b-c*b,e=2*c-d;this.r=aj(e,d,a+1/3),this.g=aj(e,d,a),this.b=aj(e,d,a-1/3)}return bX.colorSpaceToWorking(this,d),this}setStyle(a,b=br){let c;function d(b){void 0!==b&&1>parseFloat(b)&&I("Color: Alpha component of "+a+" will be ignored.")}if(c=/^(\w+)\(([^\)]*)\)/.exec(a)){let e,f=c[1],g=c[2];switch(f){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(g))return d(e[4]),this.setRGB(Math.min(255,parseInt(e[1],10))/255,Math.min(255,parseInt(e[2],10))/255,Math.min(255,parseInt(e[3],10))/255,b);if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(g))return d(e[4]),this.setRGB(Math.min(100,parseInt(e[1],10))/100,Math.min(100,parseInt(e[2],10))/100,Math.min(100,parseInt(e[3],10))/100,b);break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(g))return d(e[4]),this.setHSL(parseFloat(e[1])/360,parseFloat(e[2])/100,parseFloat(e[3])/100,b);break;default:I("Color: Unknown color model "+a)}}else if(c=/^\#([A-Fa-f\d]+)$/.exec(a)){let d=c[1],e=d.length;if(3===e)return this.setRGB(parseInt(d.charAt(0),16)/15,parseInt(d.charAt(1),16)/15,parseInt(d.charAt(2),16)/15,b);if(6===e)return this.setHex(parseInt(d,16),b);I("Color: Invalid hex color "+a)}else if(a&&a.length>0)return this.setColorName(a,b);return this}setColorName(a,b=br){let c=db[a.toLowerCase()];return void 0===c?I("Color: Unknown color "+a):this.setHex(c,b),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(a){return this.r=a.r,this.g=a.g,this.b=a.b,this}copySRGBToLinear(a){return this.r=af(a.r),this.g=af(a.g),this.b=af(a.b),this}copyLinearToSRGB(a){return this.r=ag(a.r),this.g=ag(a.g),this.b=ag(a.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(a=br){return bX.workingToColorSpace(df.copy(this),a),65536*Math.round(M(255*df.r,0,255))+256*Math.round(M(255*df.g,0,255))+Math.round(M(255*df.b,0,255))}getHexString(a=br){return("000000"+this.getHex(a).toString(16)).slice(-6)}getHSL(a,b=bX.workingColorSpace){bX.workingToColorSpace(df.copy(this),b);let c=df.r,d=df.g,e=df.b,f=Math.max(c,d,e),g=Math.min(c,d,e),h,i,j=(g+f)/2;if(g===f)h=0,i=0;else{let a=f-g;switch(i=j<=.5?a/(f+g):a/(2-f-g),f){case c:h=(d-e)/a+6*(d<e);break;case d:h=(e-c)/a+2;break;case e:h=(c-d)/a+4}h/=6}return a.h=h,a.s=i,a.l=j,a}getRGB(a,b=bX.workingColorSpace){return bX.workingToColorSpace(df.copy(this),b),a.r=df.r,a.g=df.g,a.b=df.b,a}getStyle(a=br){bX.workingToColorSpace(df.copy(this),a);let b=df.r,c=df.g,d=df.b;return"srgb"===a?`rgb(${Math.round(255*b)},${Math.round(255*c)},${Math.round(255*d)})`:`color(${a} ${b.toFixed(3)} ${c.toFixed(3)} ${d.toFixed(3)})`}offsetHSL(a,b,c){return this.getHSL(dc),this.setHSL(dc.h+a,dc.s+b,dc.l+c)}add(a){return this.r+=a.r,this.g+=a.g,this.b+=a.b,this}addColors(a,b){return this.r=a.r+b.r,this.g=a.g+b.g,this.b=a.b+b.b,this}addScalar(a){return this.r+=a,this.g+=a,this.b+=a,this}sub(a){return this.r=Math.max(0,this.r-a.r),this.g=Math.max(0,this.g-a.g),this.b=Math.max(0,this.b-a.b),this}multiply(a){return this.r*=a.r,this.g*=a.g,this.b*=a.b,this}multiplyScalar(a){return this.r*=a,this.g*=a,this.b*=a,this}lerp(a,b){return this.r+=(a.r-this.r)*b,this.g+=(a.g-this.g)*b,this.b+=(a.b-this.b)*b,this}lerpColors(a,b,c){return this.r=a.r+(b.r-a.r)*c,this.g=a.g+(b.g-a.g)*c,this.b=a.b+(b.b-a.b)*c,this}lerpHSL(a,b){this.getHSL(dc),a.getHSL(dd);let c=Q(dc.h,dd.h,b),d=Q(dc.s,dd.s,b),e=Q(dc.l,dd.l,b);return this.setHSL(c,d,e),this}setFromVector3(a){return this.r=a.x,this.g=a.y,this.b=a.z,this}applyMatrix3(a){let b=this.r,c=this.g,d=this.b,e=a.elements;return this.r=e[0]*b+e[3]*c+e[6]*d,this.g=e[1]*b+e[4]*c+e[7]*d,this.b=e[2]*b+e[5]*c+e[8]*d,this}equals(a){return a.r===this.r&&a.g===this.g&&a.b===this.b}fromArray(a,b=0){return this.r=a[b],this.g=a[b+1],this.b=a[b+2],this}toArray(a=[],b=0){return a[b]=this.r,a[b+1]=this.g,a[b+2]=this.b,a}fromBufferAttribute(a,b){return this.r=a.getX(b),this.g=a.getY(b),this.b=a.getZ(b),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}},df=new de,de.NAMES=db,dg=0,dh=class extends bI{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:dg++}),this.uuid=L(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new de(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=bu,this.stencilZFail=bu,this.stencilZPass=bu,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(a){this._alphaTest>0!=a>0&&this.version++,this._alphaTest=a}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(a){if(void 0!==a)for(let b in a){let c=a[b];if(void 0===c){I(`Material: parameter '${b}' has value of undefined.`);continue}let d=this[b];if(void 0===d){I(`Material: '${b}' is not a property of THREE.${this.type}.`);continue}d&&d.isColor?d.set(c):d&&d.isVector3&&c&&c.isVector3?d.copy(c):this[b]=c}}toJSON(a){let b=void 0===a||"string"==typeof a;b&&(a={textures:{},images:{}});let c={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};function d(a){let b=[];for(let c in a){let d=a[c];delete d.metadata,b.push(d)}return b}if(c.uuid=this.uuid,c.type=this.type,""!==this.name&&(c.name=this.name),this.color&&this.color.isColor&&(c.color=this.color.getHex()),void 0!==this.roughness&&(c.roughness=this.roughness),void 0!==this.metalness&&(c.metalness=this.metalness),void 0!==this.sheen&&(c.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(c.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(c.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(c.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(c.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(c.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(c.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(c.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(c.shininess=this.shininess),void 0!==this.clearcoat&&(c.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(c.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(c.clearcoatMap=this.clearcoatMap.toJSON(a).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(c.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(a).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(c.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(a).uuid,c.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(c.sheenColorMap=this.sheenColorMap.toJSON(a).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(c.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(a).uuid),void 0!==this.dispersion&&(c.dispersion=this.dispersion),void 0!==this.iridescence&&(c.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(c.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(c.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(c.iridescenceMap=this.iridescenceMap.toJSON(a).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(c.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(a).uuid),void 0!==this.anisotropy&&(c.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(c.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(c.anisotropyMap=this.anisotropyMap.toJSON(a).uuid),this.map&&this.map.isTexture&&(c.map=this.map.toJSON(a).uuid),this.matcap&&this.matcap.isTexture&&(c.matcap=this.matcap.toJSON(a).uuid),this.alphaMap&&this.alphaMap.isTexture&&(c.alphaMap=this.alphaMap.toJSON(a).uuid),this.lightMap&&this.lightMap.isTexture&&(c.lightMap=this.lightMap.toJSON(a).uuid,c.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(c.aoMap=this.aoMap.toJSON(a).uuid,c.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(c.bumpMap=this.bumpMap.toJSON(a).uuid,c.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(c.normalMap=this.normalMap.toJSON(a).uuid,c.normalMapType=this.normalMapType,c.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(c.displacementMap=this.displacementMap.toJSON(a).uuid,c.displacementScale=this.displacementScale,c.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(c.roughnessMap=this.roughnessMap.toJSON(a).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(c.metalnessMap=this.metalnessMap.toJSON(a).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(c.emissiveMap=this.emissiveMap.toJSON(a).uuid),this.specularMap&&this.specularMap.isTexture&&(c.specularMap=this.specularMap.toJSON(a).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(c.specularIntensityMap=this.specularIntensityMap.toJSON(a).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(c.specularColorMap=this.specularColorMap.toJSON(a).uuid),this.envMap&&this.envMap.isTexture&&(c.envMap=this.envMap.toJSON(a).uuid,void 0!==this.combine&&(c.combine=this.combine)),void 0!==this.envMapRotation&&(c.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(c.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(c.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(c.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(c.gradientMap=this.gradientMap.toJSON(a).uuid),void 0!==this.transmission&&(c.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(c.transmissionMap=this.transmissionMap.toJSON(a).uuid),void 0!==this.thickness&&(c.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(c.thicknessMap=this.thicknessMap.toJSON(a).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(c.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(c.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(c.size=this.size),null!==this.shadowSide&&(c.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(c.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(c.blending=this.blending),0!==this.side&&(c.side=this.side),!0===this.vertexColors&&(c.vertexColors=!0),this.opacity<1&&(c.opacity=this.opacity),!0===this.transparent&&(c.transparent=!0),204!==this.blendSrc&&(c.blendSrc=this.blendSrc),205!==this.blendDst&&(c.blendDst=this.blendDst),100!==this.blendEquation&&(c.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(c.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(c.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(c.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(c.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(c.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(c.depthFunc=this.depthFunc),!1===this.depthTest&&(c.depthTest=this.depthTest),!1===this.depthWrite&&(c.depthWrite=this.depthWrite),!1===this.colorWrite&&(c.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(c.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(c.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(c.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(c.stencilFuncMask=this.stencilFuncMask),7680!==this.stencilFail&&(c.stencilFail=this.stencilFail),7680!==this.stencilZFail&&(c.stencilZFail=this.stencilZFail),7680!==this.stencilZPass&&(c.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(c.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(c.rotation=this.rotation),!0===this.polygonOffset&&(c.polygonOffset=!0),0!==this.polygonOffsetFactor&&(c.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(c.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(c.linewidth=this.linewidth),void 0!==this.dashSize&&(c.dashSize=this.dashSize),void 0!==this.gapSize&&(c.gapSize=this.gapSize),void 0!==this.scale&&(c.scale=this.scale),!0===this.dithering&&(c.dithering=!0),this.alphaTest>0&&(c.alphaTest=this.alphaTest),!0===this.alphaHash&&(c.alphaHash=!0),!0===this.alphaToCoverage&&(c.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(c.premultipliedAlpha=!0),!0===this.forceSinglePass&&(c.forceSinglePass=!0),!0===this.wireframe&&(c.wireframe=!0),this.wireframeLinewidth>1&&(c.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(c.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(c.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(c.flatShading=!0),!1===this.visible&&(c.visible=!1),!1===this.toneMapped&&(c.toneMapped=!1),!1===this.fog&&(c.fog=!1),Object.keys(this.userData).length>0&&(c.userData=this.userData),b){let b=d(a.textures),e=d(a.images);b.length>0&&(c.textures=b),e.length>0&&(c.images=e)}return c}clone(){return new this.constructor().copy(this)}copy(a){this.name=a.name,this.blending=a.blending,this.side=a.side,this.vertexColors=a.vertexColors,this.opacity=a.opacity,this.transparent=a.transparent,this.blendSrc=a.blendSrc,this.blendDst=a.blendDst,this.blendEquation=a.blendEquation,this.blendSrcAlpha=a.blendSrcAlpha,this.blendDstAlpha=a.blendDstAlpha,this.blendEquationAlpha=a.blendEquationAlpha,this.blendColor.copy(a.blendColor),this.blendAlpha=a.blendAlpha,this.depthFunc=a.depthFunc,this.depthTest=a.depthTest,this.depthWrite=a.depthWrite,this.stencilWriteMask=a.stencilWriteMask,this.stencilFunc=a.stencilFunc,this.stencilRef=a.stencilRef,this.stencilFuncMask=a.stencilFuncMask,this.stencilFail=a.stencilFail,this.stencilZFail=a.stencilZFail,this.stencilZPass=a.stencilZPass,this.stencilWrite=a.stencilWrite;let b=a.clippingPlanes,c=null;if(null!==b){let a=b.length;c=Array(a);for(let d=0;d!==a;++d)c[d]=b[d].clone()}return this.clippingPlanes=c,this.clipIntersection=a.clipIntersection,this.clipShadows=a.clipShadows,this.shadowSide=a.shadowSide,this.colorWrite=a.colorWrite,this.precision=a.precision,this.polygonOffset=a.polygonOffset,this.polygonOffsetFactor=a.polygonOffsetFactor,this.polygonOffsetUnits=a.polygonOffsetUnits,this.dithering=a.dithering,this.alphaTest=a.alphaTest,this.alphaHash=a.alphaHash,this.alphaToCoverage=a.alphaToCoverage,this.premultipliedAlpha=a.premultipliedAlpha,this.forceSinglePass=a.forceSinglePass,this.visible=a.visible,this.toneMapped=a.toneMapped,this.userData=JSON.parse(JSON.stringify(a.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(a){!0===a&&this.version++}},di=class extends dh{constructor(a){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new de(0xffffff),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new cH,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.envMapRotation.copy(a.envMapRotation),this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.fog=a.fog,this}},dj=function(){let a=new ArrayBuffer(4),b=new Float32Array(a),c=new Uint32Array(a),d=new Uint32Array(512),e=new Uint32Array(512);for(let a=0;a<256;++a){let b=a-127;b<-27?(d[a]=0,d[256|a]=32768,e[a]=24,e[256|a]=24):b<-14?(d[a]=1024>>-b-14,d[256|a]=1024>>-b-14|32768,e[a]=-b-1,e[256|a]=-b-1):b<=15?(d[a]=b+15<<10,d[256|a]=b+15<<10|32768,e[a]=13,e[256|a]=13):b<128?(d[a]=31744,d[256|a]=64512,e[a]=24,e[256|a]=24):(d[a]=31744,d[256|a]=64512,e[a]=13,e[256|a]=13)}let f=new Uint32Array(2048),g=new Uint32Array(64),h=new Uint32Array(64);for(let a=1;a<1024;++a){let b=a<<13,c=0;for(;!(8388608&b);)b<<=1,c-=8388608;b&=-8388609,c+=0x38800000,f[a]=b|c}for(let a=1024;a<2048;++a)f[a]=0x38000000+(a-1024<<13);for(let a=1;a<31;++a)g[a]=a<<23;g[31]=0x47800000,g[32]=0x80000000;for(let a=33;a<63;++a)g[a]=0x80000000+(a-32<<23);g[63]=0xc7800000;for(let a=1;a<64;++a)32!==a&&(h[a]=1024);return{floatView:b,uint32View:c,baseTable:d,shiftTable:e,mantissaTable:f,exponentTable:g,offsetTable:h}}(),dk=new bQ,dl=new bO,dm=0,dn=class{constructor(a,b,c=!1){if(Array.isArray(a))throw TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:dm++}),this.name="",this.array=a,this.itemSize=b,this.count=void 0===a?0:a.length/b,this.normalized=c,this.usage=bB,this.updateRanges=[],this.gpuType=aF,this.version=0}onUploadCallback(){}set needsUpdate(a){!0===a&&this.version++}setUsage(a){return this.usage=a,this}addUpdateRange(a,b){this.updateRanges.push({start:a,count:b})}clearUpdateRanges(){this.updateRanges.length=0}copy(a){return this.name=a.name,this.array=new a.array.constructor(a.array),this.itemSize=a.itemSize,this.count=a.count,this.normalized=a.normalized,this.usage=a.usage,this.gpuType=a.gpuType,this}copyAt(a,b,c){a*=this.itemSize,c*=b.itemSize;for(let d=0,e=this.itemSize;d<e;d++)this.array[a+d]=b.array[c+d];return this}copyArray(a){return this.array.set(a),this}applyMatrix3(a){if(2===this.itemSize)for(let b=0,c=this.count;b<c;b++)dl.fromBufferAttribute(this,b),dl.applyMatrix3(a),this.setXY(b,dl.x,dl.y);else if(3===this.itemSize)for(let b=0,c=this.count;b<c;b++)dk.fromBufferAttribute(this,b),dk.applyMatrix3(a),this.setXYZ(b,dk.x,dk.y,dk.z);return this}applyMatrix4(a){for(let b=0,c=this.count;b<c;b++)dk.fromBufferAttribute(this,b),dk.applyMatrix4(a),this.setXYZ(b,dk.x,dk.y,dk.z);return this}applyNormalMatrix(a){for(let b=0,c=this.count;b<c;b++)dk.fromBufferAttribute(this,b),dk.applyNormalMatrix(a),this.setXYZ(b,dk.x,dk.y,dk.z);return this}transformDirection(a){for(let b=0,c=this.count;b<c;b++)dk.fromBufferAttribute(this,b),dk.transformDirection(a),this.setXYZ(b,dk.x,dk.y,dk.z);return this}set(a,b=0){return this.array.set(a,b),this}getComponent(a,b){let c=this.array[a*this.itemSize+b];return this.normalized&&(c=ad(c,this.array)),c}setComponent(a,b,c){return this.normalized&&(c=ae(c,this.array)),this.array[a*this.itemSize+b]=c,this}getX(a){let b=this.array[a*this.itemSize];return this.normalized&&(b=ad(b,this.array)),b}setX(a,b){return this.normalized&&(b=ae(b,this.array)),this.array[a*this.itemSize]=b,this}getY(a){let b=this.array[a*this.itemSize+1];return this.normalized&&(b=ad(b,this.array)),b}setY(a,b){return this.normalized&&(b=ae(b,this.array)),this.array[a*this.itemSize+1]=b,this}getZ(a){let b=this.array[a*this.itemSize+2];return this.normalized&&(b=ad(b,this.array)),b}setZ(a,b){return this.normalized&&(b=ae(b,this.array)),this.array[a*this.itemSize+2]=b,this}getW(a){let b=this.array[a*this.itemSize+3];return this.normalized&&(b=ad(b,this.array)),b}setW(a,b){return this.normalized&&(b=ae(b,this.array)),this.array[a*this.itemSize+3]=b,this}setXY(a,b,c){return a*=this.itemSize,this.normalized&&(b=ae(b,this.array),c=ae(c,this.array)),this.array[a+0]=b,this.array[a+1]=c,this}setXYZ(a,b,c,d){return a*=this.itemSize,this.normalized&&(b=ae(b,this.array),c=ae(c,this.array),d=ae(d,this.array)),this.array[a+0]=b,this.array[a+1]=c,this.array[a+2]=d,this}setXYZW(a,b,c,d,e){return a*=this.itemSize,this.normalized&&(b=ae(b,this.array),c=ae(c,this.array),d=ae(d,this.array),e=ae(e,this.array)),this.array[a+0]=b,this.array[a+1]=c,this.array[a+2]=d,this.array[a+3]=e,this}onUpload(a){return this.onUploadCallback=a,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let a={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(a.name=this.name),35044!==this.usage&&(a.usage=this.usage),a}},dp=class extends dn{constructor(a,b,c){super(new Uint16Array(a),b,c)}},dq=class extends dn{constructor(a,b,c){super(new Uint32Array(a),b,c)}},dr=class extends dn{constructor(a,b,c){super(new Uint16Array(a),b,c),this.isFloat16BufferAttribute=!0}getX(a){let b=al(this.array[a*this.itemSize]);return this.normalized&&(b=ad(b,this.array)),b}setX(a,b){return this.normalized&&(b=ae(b,this.array)),this.array[a*this.itemSize]=ak(b),this}getY(a){let b=al(this.array[a*this.itemSize+1]);return this.normalized&&(b=ad(b,this.array)),b}setY(a,b){return this.normalized&&(b=ae(b,this.array)),this.array[a*this.itemSize+1]=ak(b),this}getZ(a){let b=al(this.array[a*this.itemSize+2]);return this.normalized&&(b=ad(b,this.array)),b}setZ(a,b){return this.normalized&&(b=ae(b,this.array)),this.array[a*this.itemSize+2]=ak(b),this}getW(a){let b=al(this.array[a*this.itemSize+3]);return this.normalized&&(b=ad(b,this.array)),b}setW(a,b){return this.normalized&&(b=ae(b,this.array)),this.array[a*this.itemSize+3]=ak(b),this}setXY(a,b,c){return a*=this.itemSize,this.normalized&&(b=ae(b,this.array),c=ae(c,this.array)),this.array[a+0]=ak(b),this.array[a+1]=ak(c),this}setXYZ(a,b,c,d){return a*=this.itemSize,this.normalized&&(b=ae(b,this.array),c=ae(c,this.array),d=ae(d,this.array)),this.array[a+0]=ak(b),this.array[a+1]=ak(c),this.array[a+2]=ak(d),this}setXYZW(a,b,c,d,e){return a*=this.itemSize,this.normalized&&(b=ae(b,this.array),c=ae(c,this.array),d=ae(d,this.array),e=ae(e,this.array)),this.array[a+0]=ak(b),this.array[a+1]=ak(c),this.array[a+2]=ak(d),this.array[a+3]=ak(e),this}},ds=class extends dn{constructor(a,b,c){super(new Float32Array(a),b,c)}},dt=0,du=new cx,dv=new cY,dw=new bQ,dx=new b7,dy=new b7,dz=new bQ,dA=class a extends bI{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:dt++}),this.uuid=L(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(a){return Array.isArray(a)?this.index=new(F(a)?dq:dp)(a,1):this.index=a,this}setIndirect(a){return this.indirect=a,this}getIndirect(){return this.indirect}getAttribute(a){return this.attributes[a]}setAttribute(a,b){return this.attributes[a]=b,this}deleteAttribute(a){return delete this.attributes[a],this}hasAttribute(a){return void 0!==this.attributes[a]}addGroup(a,b,c=0){this.groups.push({start:a,count:b,materialIndex:c})}clearGroups(){this.groups=[]}setDrawRange(a,b){this.drawRange.start=a,this.drawRange.count=b}applyMatrix4(a){let b=this.attributes.position;void 0!==b&&(b.applyMatrix4(a),b.needsUpdate=!0);let c=this.attributes.normal;if(void 0!==c){let b=new bT().getNormalMatrix(a);c.applyNormalMatrix(b),c.needsUpdate=!0}let d=this.attributes.tangent;return void 0!==d&&(d.transformDirection(a),d.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(a){return du.makeRotationFromQuaternion(a),this.applyMatrix4(du),this}rotateX(a){return du.makeRotationX(a),this.applyMatrix4(du),this}rotateY(a){return du.makeRotationY(a),this.applyMatrix4(du),this}rotateZ(a){return du.makeRotationZ(a),this.applyMatrix4(du),this}translate(a,b,c){return du.makeTranslation(a,b,c),this.applyMatrix4(du),this}scale(a,b,c){return du.makeScale(a,b,c),this.applyMatrix4(du),this}lookAt(a){return dv.lookAt(a),dv.updateMatrix(),this.applyMatrix4(dv.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(dw).negate(),this.translate(dw.x,dw.y,dw.z),this}setFromPoints(a){let b=this.getAttribute("position");if(void 0===b){let b=[];for(let c=0,d=a.length;c<d;c++){let d=a[c];b.push(d.x,d.y,d.z||0)}this.setAttribute("position",new ds(b,3))}else{let c=Math.min(a.length,b.count);for(let d=0;d<c;d++){let c=a[d];b.setXYZ(d,c.x,c.y,c.z||0)}a.length>b.count&&I("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),b.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new b7);let a=this.attributes.position,b=this.morphAttributes.position;if(a&&a.isGLBufferAttribute){J("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new bQ(-1/0,-1/0,-1/0),new bQ(1/0,1/0,1/0));return}if(void 0!==a){if(this.boundingBox.setFromBufferAttribute(a),b)for(let a=0,c=b.length;a<c;a++){let c=b[a];dx.setFromBufferAttribute(c),this.morphTargetsRelative?(dz.addVectors(this.boundingBox.min,dx.min),this.boundingBox.expandByPoint(dz),dz.addVectors(this.boundingBox.max,dx.max),this.boundingBox.expandByPoint(dz)):(this.boundingBox.expandByPoint(dx.min),this.boundingBox.expandByPoint(dx.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&J('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new co);let a=this.attributes.position,b=this.morphAttributes.position;if(a&&a.isGLBufferAttribute){J("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new bQ,1/0);return}if(a){let c=this.boundingSphere.center;if(dx.setFromBufferAttribute(a),b)for(let a=0,c=b.length;a<c;a++){let c=b[a];dy.setFromBufferAttribute(c),this.morphTargetsRelative?(dz.addVectors(dx.min,dy.min),dx.expandByPoint(dz),dz.addVectors(dx.max,dy.max),dx.expandByPoint(dz)):(dx.expandByPoint(dy.min),dx.expandByPoint(dy.max))}dx.getCenter(c);let d=0;for(let b=0,e=a.count;b<e;b++)dz.fromBufferAttribute(a,b),d=Math.max(d,c.distanceToSquared(dz));if(b)for(let e=0,f=b.length;e<f;e++){let f=b[e],g=this.morphTargetsRelative;for(let b=0,e=f.count;b<e;b++)dz.fromBufferAttribute(f,b),g&&(dw.fromBufferAttribute(a,b),dz.add(dw)),d=Math.max(d,c.distanceToSquared(dz))}this.boundingSphere.radius=Math.sqrt(d),isNaN(this.boundingSphere.radius)&&J('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let a=this.index,b=this.attributes;if(null===a||void 0===b.position||void 0===b.normal||void 0===b.uv)return void J("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");let c=b.position,d=b.normal,e=b.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new dn(new Float32Array(4*c.count),4));let f=this.getAttribute("tangent"),g=[],h=[];for(let a=0;a<c.count;a++)g[a]=new bQ,h[a]=new bQ;let i=new bQ,j=new bQ,k=new bQ,l=new bO,m=new bO,n=new bO,o=new bQ,p=new bQ,q=this.groups;0===q.length&&(q=[{start:0,count:a.count}]);for(let b=0,d=q.length;b<d;++b){let d=q[b],f=d.start,r=d.count;for(let b=f,d=f+r;b<d;b+=3)!function(a,b,d){i.fromBufferAttribute(c,a),j.fromBufferAttribute(c,b),k.fromBufferAttribute(c,d),l.fromBufferAttribute(e,a),m.fromBufferAttribute(e,b),n.fromBufferAttribute(e,d),j.sub(i),k.sub(i),m.sub(l),n.sub(l);let f=1/(m.x*n.y-n.x*m.y);isFinite(f)&&(o.copy(j).multiplyScalar(n.y).addScaledVector(k,-m.y).multiplyScalar(f),p.copy(k).multiplyScalar(m.x).addScaledVector(j,-n.x).multiplyScalar(f),g[a].add(o),g[b].add(o),g[d].add(o),h[a].add(p),h[b].add(p),h[d].add(p))}(a.getX(b+0),a.getX(b+1),a.getX(b+2))}let r=new bQ,s=new bQ,t=new bQ,u=new bQ;function v(a){t.fromBufferAttribute(d,a),u.copy(t);let b=g[a];r.copy(b),r.sub(t.multiplyScalar(t.dot(b))).normalize(),s.crossVectors(u,b);let c=0>s.dot(h[a])?-1:1;f.setXYZW(a,r.x,r.y,r.z,c)}for(let b=0,c=q.length;b<c;++b){let c=q[b],d=c.start,e=c.count;for(let b=d,c=d+e;b<c;b+=3)v(a.getX(b+0)),v(a.getX(b+1)),v(a.getX(b+2))}}computeVertexNormals(){let a=this.index,b=this.getAttribute("position");if(void 0!==b){let c=this.getAttribute("normal");if(void 0===c)c=new dn(new Float32Array(3*b.count),3),this.setAttribute("normal",c);else for(let a=0,b=c.count;a<b;a++)c.setXYZ(a,0,0,0);let d=new bQ,e=new bQ,f=new bQ,g=new bQ,h=new bQ,i=new bQ,j=new bQ,k=new bQ;if(a)for(let l=0,m=a.count;l<m;l+=3){let m=a.getX(l+0),n=a.getX(l+1),o=a.getX(l+2);d.fromBufferAttribute(b,m),e.fromBufferAttribute(b,n),f.fromBufferAttribute(b,o),j.subVectors(f,e),k.subVectors(d,e),j.cross(k),g.fromBufferAttribute(c,m),h.fromBufferAttribute(c,n),i.fromBufferAttribute(c,o),g.add(j),h.add(j),i.add(j),c.setXYZ(m,g.x,g.y,g.z),c.setXYZ(n,h.x,h.y,h.z),c.setXYZ(o,i.x,i.y,i.z)}else for(let a=0,g=b.count;a<g;a+=3)d.fromBufferAttribute(b,a+0),e.fromBufferAttribute(b,a+1),f.fromBufferAttribute(b,a+2),j.subVectors(f,e),k.subVectors(d,e),j.cross(k),c.setXYZ(a+0,j.x,j.y,j.z),c.setXYZ(a+1,j.x,j.y,j.z),c.setXYZ(a+2,j.x,j.y,j.z);this.normalizeNormals(),c.needsUpdate=!0}}normalizeNormals(){let a=this.attributes.normal;for(let b=0,c=a.count;b<c;b++)dz.fromBufferAttribute(a,b),dz.normalize(),a.setXYZ(b,dz.x,dz.y,dz.z)}toNonIndexed(){function b(a,b){let c=a.array,d=a.itemSize,e=a.normalized,f=new c.constructor(b.length*d),g=0,h=0;for(let e=0,i=b.length;e<i;e++){g=a.isInterleavedBufferAttribute?b[e]*a.data.stride+a.offset:b[e]*d;for(let a=0;a<d;a++)f[h++]=c[g++]}return new dn(f,d,e)}if(null===this.index)return I("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let c=new a,d=this.index.array,e=this.attributes;for(let a in e){let f=b(e[a],d);c.setAttribute(a,f)}let f=this.morphAttributes;for(let a in f){let e=[],g=f[a];for(let a=0,c=g.length;a<c;a++){let c=b(g[a],d);e.push(c)}c.morphAttributes[a]=e}c.morphTargetsRelative=this.morphTargetsRelative;let g=this.groups;for(let a=0,b=g.length;a<b;a++){let b=g[a];c.addGroup(b.start,b.count,b.materialIndex)}return c}toJSON(){let a={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(a.uuid=this.uuid,a.type=this.type,""!==this.name&&(a.name=this.name),Object.keys(this.userData).length>0&&(a.userData=this.userData),void 0!==this.parameters){let b=this.parameters;for(let c in b)void 0!==b[c]&&(a[c]=b[c]);return a}a.data={attributes:{}};let b=this.index;null!==b&&(a.data.index={type:b.array.constructor.name,array:Array.prototype.slice.call(b.array)});let c=this.attributes;for(let b in c){let d=c[b];a.data.attributes[b]=d.toJSON(a.data)}let d={},e=!1;for(let b in this.morphAttributes){let c=this.morphAttributes[b],f=[];for(let b=0,d=c.length;b<d;b++){let d=c[b];f.push(d.toJSON(a.data))}f.length>0&&(d[b]=f,e=!0)}e&&(a.data.morphAttributes=d,a.data.morphTargetsRelative=this.morphTargetsRelative);let f=this.groups;f.length>0&&(a.data.groups=JSON.parse(JSON.stringify(f)));let g=this.boundingSphere;return null!==g&&(a.data.boundingSphere=g.toJSON()),a}clone(){return new this.constructor().copy(this)}copy(a){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let b={};this.name=a.name;let c=a.index;null!==c&&this.setIndex(c.clone());let d=a.attributes;for(let a in d){let c=d[a];this.setAttribute(a,c.clone(b))}let e=a.morphAttributes;for(let a in e){let c=[],d=e[a];for(let a=0,e=d.length;a<e;a++)c.push(d[a].clone(b));this.morphAttributes[a]=c}this.morphTargetsRelative=a.morphTargetsRelative;let f=a.groups;for(let a=0,b=f.length;a<b;a++){let b=f[a];this.addGroup(b.start,b.count,b.materialIndex)}let g=a.boundingBox;null!==g&&(this.boundingBox=g.clone());let h=a.boundingSphere;return null!==h&&(this.boundingSphere=h.clone()),this.drawRange.start=a.drawRange.start,this.drawRange.count=a.drawRange.count,this.userData=a.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}},dB=new cx,dC=new cw,dD=new co,dE=new bQ,dF=new bQ,dG=new bQ,dH=new bQ,dI=new bQ,dJ=new bQ,dK=new bQ,dL=new bQ,dM=class extends cY{constructor(a=new dA,b=new di){super(),this.isMesh=!0,this.type="Mesh",this.geometry=a,this.material=b,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(a,b){return super.copy(a,b),void 0!==a.morphTargetInfluences&&(this.morphTargetInfluences=a.morphTargetInfluences.slice()),void 0!==a.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},a.morphTargetDictionary)),this.material=Array.isArray(a.material)?a.material.slice():a.material,this.geometry=a.geometry,this}updateMorphTargets(){let a=this.geometry.morphAttributes,b=Object.keys(a);if(b.length>0){let c=a[b[0]];if(void 0!==c){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,b=c.length;a<b;a++){let b=c[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[b]=a}}}}getVertexPosition(a,b){let c=this.geometry,d=c.attributes.position,e=c.morphAttributes.position,f=c.morphTargetsRelative;b.fromBufferAttribute(d,a);let g=this.morphTargetInfluences;if(e&&g){dJ.set(0,0,0);for(let c=0,d=e.length;c<d;c++){let d=g[c],h=e[c];0!==d&&(dI.fromBufferAttribute(h,a),f?dJ.addScaledVector(dI,d):dJ.addScaledVector(dI.sub(b),d))}b.add(dJ)}return b}raycast(a,b){let c=this.geometry,d=this.material,e=this.matrixWorld;void 0!==d&&(null===c.boundingSphere&&c.computeBoundingSphere(),dD.copy(c.boundingSphere),dD.applyMatrix4(e),dC.copy(a.ray).recast(a.near),!1===dD.containsPoint(dC.origin)&&(null===dC.intersectSphere(dD,dE)||dC.origin.distanceToSquared(dE)>(a.far-a.near)**2)||(dB.copy(e).invert(),dC.copy(a.ray).applyMatrix4(dB),(null===c.boundingBox||!1!==dC.intersectsBox(c.boundingBox))&&this._computeIntersections(a,b,dC)))}_computeIntersections(a,b,c){let d,e=this.geometry,f=this.material,g=e.index,h=e.attributes.position,i=e.attributes.uv,j=e.attributes.uv1,k=e.attributes.normal,l=e.groups,m=e.drawRange;if(null!==g)if(Array.isArray(f))for(let e=0,h=l.length;e<h;e++){let h=l[e],n=f[h.materialIndex],o=Math.max(h.start,m.start),p=Math.min(g.count,Math.min(h.start+h.count,m.start+m.count));for(let e=o;e<p;e+=3)(d=am(this,n,a,c,i,j,k,g.getX(e),g.getX(e+1),g.getX(e+2)))&&(d.faceIndex=Math.floor(e/3),d.face.materialIndex=h.materialIndex,b.push(d))}else{let e=Math.max(0,m.start),h=Math.min(g.count,m.start+m.count);for(let l=e;l<h;l+=3)(d=am(this,f,a,c,i,j,k,g.getX(l),g.getX(l+1),g.getX(l+2)))&&(d.faceIndex=Math.floor(l/3),b.push(d))}else if(void 0!==h)if(Array.isArray(f))for(let e=0,g=l.length;e<g;e++){let g=l[e],n=f[g.materialIndex],o=Math.max(g.start,m.start),p=Math.min(h.count,Math.min(g.start+g.count,m.start+m.count));for(let e=o;e<p;e+=3)(d=am(this,n,a,c,i,j,k,e,e+1,e+2))&&(d.faceIndex=Math.floor(e/3),d.face.materialIndex=g.materialIndex,b.push(d))}else{let e=Math.max(0,m.start),g=Math.min(h.count,m.start+m.count);for(let h=e;h<g;h+=3)(d=am(this,f,a,c,i,j,k,h,h+1,h+2))&&(d.faceIndex=Math.floor(h/3),b.push(d))}}},dN=class a extends dA{constructor(a=1,b=1,c=1,d=1,e=1,f=1){super(),this.type="BoxGeometry",this.parameters={width:a,height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};let g=this;d=Math.floor(d),e=Math.floor(e);let h=[],i=[],j=[],k=[],l=0,m=0;function n(a,b,c,d,e,f,n,o,p,q,r){let s=f/p,t=n/q,u=f/2,v=n/2,w=o/2,x=p+1,y=q+1,z=0,A=0,B=new bQ;for(let f=0;f<y;f++){let g=f*t-v;for(let h=0;h<x;h++)B[a]=(h*s-u)*d,B[b]=g*e,B[c]=w,i.push(B.x,B.y,B.z),B[a]=0,B[b]=0,B[c]=o>0?1:-1,j.push(B.x,B.y,B.z),k.push(h/p),k.push(1-f/q),z+=1}for(let a=0;a<q;a++)for(let b=0;b<p;b++){let c=l+b+x*a,d=l+b+x*(a+1),e=l+(b+1)+x*(a+1),f=l+(b+1)+x*a;h.push(c,d,f),h.push(d,e,f),A+=6}g.addGroup(m,A,r),m+=A,l+=z}n("z","y","x",-1,-1,c,b,a,f=Math.floor(f),e,0),n("z","y","x",1,-1,c,b,-a,f,e,1),n("x","z","y",1,1,a,c,b,d,f,2),n("x","z","y",1,-1,a,c,-b,d,f,3),n("x","y","z",1,-1,a,b,c,d,e,4),n("x","y","z",-1,-1,a,b,-c,d,e,5),this.setIndex(h),this.setAttribute("position",new ds(i,3)),this.setAttribute("normal",new ds(j,3)),this.setAttribute("uv",new ds(k,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(b){return new a(b.width,b.height,b.depth,b.widthSegments,b.heightSegments,b.depthSegments)}},dO=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,dP=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,dQ=class extends dh{constructor(a){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=dO,this.fragmentShader=dP,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==a&&this.setValues(a)}copy(a){return super.copy(a),this.fragmentShader=a.fragmentShader,this.vertexShader=a.vertexShader,this.uniforms=an(a.uniforms),this.uniformsGroups=function(a){let b=[];for(let c=0;c<a.length;c++)b.push(a[c].clone());return b}(a.uniformsGroups),this.defines=Object.assign({},a.defines),this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.fog=a.fog,this.lights=a.lights,this.clipping=a.clipping,this.extensions=Object.assign({},a.extensions),this.glslVersion=a.glslVersion,this}toJSON(a){let b=super.toJSON(a);for(let c in b.glslVersion=this.glslVersion,b.uniforms={},this.uniforms){let d=this.uniforms[c].value;d&&d.isTexture?b.uniforms[c]={type:"t",value:d.toJSON(a).uuid}:d&&d.isColor?b.uniforms[c]={type:"c",value:d.getHex()}:d&&d.isVector2?b.uniforms[c]={type:"v2",value:d.toArray()}:d&&d.isVector3?b.uniforms[c]={type:"v3",value:d.toArray()}:d&&d.isVector4?b.uniforms[c]={type:"v4",value:d.toArray()}:d&&d.isMatrix3?b.uniforms[c]={type:"m3",value:d.toArray()}:d&&d.isMatrix4?b.uniforms[c]={type:"m4",value:d.toArray()}:b.uniforms[c]={value:d}}Object.keys(this.defines).length>0&&(b.defines=this.defines),b.vertexShader=this.vertexShader,b.fragmentShader=this.fragmentShader,b.lights=this.lights,b.clipping=this.clipping;let c={};for(let a in this.extensions)!0===this.extensions[a]&&(c[a]=!0);return Object.keys(c).length>0&&(b.extensions=c),b}},dR=class extends cY{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new cx,this.projectionMatrix=new cx,this.projectionMatrixInverse=new cx,this.coordinateSystem=bD,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(a,b){return super.copy(a,b),this.matrixWorldInverse.copy(a.matrixWorldInverse),this.projectionMatrix.copy(a.projectionMatrix),this.projectionMatrixInverse.copy(a.projectionMatrixInverse),this.coordinateSystem=a.coordinateSystem,this}getWorldDirection(a){return super.getWorldDirection(a).negate()}updateMatrixWorld(a){super.updateMatrixWorld(a),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(a,b){super.updateWorldMatrix(a,b),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},dS=new bQ,dT=new bO,dU=new bO,dV=class extends dR{constructor(a=50,b=1,c=.1,d=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=a,this.zoom=1,this.near=c,this.far=d,this.focus=10,this.aspect=b,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(a,b){return super.copy(a,b),this.fov=a.fov,this.zoom=a.zoom,this.near=a.near,this.far=a.far,this.focus=a.focus,this.aspect=a.aspect,this.view=null===a.view?null:Object.assign({},a.view),this.filmGauge=a.filmGauge,this.filmOffset=a.filmOffset,this}setFocalLength(a){let b=.5*this.getFilmHeight()/a;this.fov=2*bM*Math.atan(b),this.updateProjectionMatrix()}getFocalLength(){let a=Math.tan(.5*bL*this.fov);return .5*this.getFilmHeight()/a}getEffectiveFOV(){return 2*bM*Math.atan(Math.tan(.5*bL*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(a,b,c){dS.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),b.set(dS.x,dS.y).multiplyScalar(-a/dS.z),dS.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),c.set(dS.x,dS.y).multiplyScalar(-a/dS.z)}getViewSize(a,b){return this.getViewBounds(a,dT,dU),b.subVectors(dU,dT)}setViewOffset(a,b,c,d,e,f){this.aspect=a/b,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=a,this.view.fullHeight=b,this.view.offsetX=c,this.view.offsetY=d,this.view.width=e,this.view.height=f,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let a=this.near,b=a*Math.tan(.5*bL*this.fov)/this.zoom,c=2*b,d=this.aspect*c,e=-.5*d,f=this.view;if(null!==this.view&&this.view.enabled){let a=f.fullWidth,g=f.fullHeight;e+=f.offsetX*d/a,b-=f.offsetY*c/g,d*=f.width/a,c*=f.height/g}let g=this.filmOffset;0!==g&&(e+=a*g/this.getFilmWidth()),this.projectionMatrix.makePerspective(e,e+d,b,b-c,a,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(a){let b=super.toJSON(a);return b.object.fov=this.fov,b.object.zoom=this.zoom,b.object.near=this.near,b.object.far=this.far,b.object.focus=this.focus,b.object.aspect=this.aspect,null!==this.view&&(b.object.view=Object.assign({},this.view)),b.object.filmGauge=this.filmGauge,b.object.filmOffset=this.filmOffset,b}},dW=class extends cY{constructor(a,b,c){super(),this.type="CubeCamera",this.renderTarget=c,this.coordinateSystem=null,this.activeMipmapLevel=0;let d=new dV(-90,1,a,b);d.layers=this.layers,this.add(d);let e=new dV(-90,1,a,b);e.layers=this.layers,this.add(e);let f=new dV(-90,1,a,b);f.layers=this.layers,this.add(f);let g=new dV(-90,1,a,b);g.layers=this.layers,this.add(g);let h=new dV(-90,1,a,b);h.layers=this.layers,this.add(h);let i=new dV(-90,1,a,b);i.layers=this.layers,this.add(i)}updateCoordinateSystem(){let a=this.coordinateSystem,b=this.children.concat(),[c,d,e,f,g,h]=b;for(let a of b)this.remove(a);if(2e3===a)c.up.set(0,1,0),c.lookAt(1,0,0),d.up.set(0,1,0),d.lookAt(-1,0,0),e.up.set(0,0,-1),e.lookAt(0,1,0),f.up.set(0,0,1),f.lookAt(0,-1,0),g.up.set(0,1,0),g.lookAt(0,0,1),h.up.set(0,1,0),h.lookAt(0,0,-1);else if(2001===a)c.up.set(0,-1,0),c.lookAt(-1,0,0),d.up.set(0,-1,0),d.lookAt(1,0,0),e.up.set(0,0,1),e.lookAt(0,1,0),f.up.set(0,0,-1),f.lookAt(0,-1,0),g.up.set(0,-1,0),g.lookAt(0,0,1),h.up.set(0,-1,0),h.lookAt(0,0,-1);else throw Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+a);for(let a of b)this.add(a),a.updateMatrixWorld()}update(a,b){null===this.parent&&this.updateMatrixWorld();let{renderTarget:c,activeMipmapLevel:d}=this;this.coordinateSystem!==a.coordinateSystem&&(this.coordinateSystem=a.coordinateSystem,this.updateCoordinateSystem());let[e,f,g,h,i,j]=this.children,k=a.getRenderTarget(),l=a.getActiveCubeFace(),m=a.getActiveMipmapLevel(),n=a.xr.enabled;a.xr.enabled=!1;let o=c.texture.generateMipmaps;c.texture.generateMipmaps=!1,a.setRenderTarget(c,0,d),a.render(b,e),a.setRenderTarget(c,1,d),a.render(b,f),a.setRenderTarget(c,2,d),a.render(b,g),a.setRenderTarget(c,3,d),a.render(b,h),a.setRenderTarget(c,4,d),a.render(b,i),c.texture.generateMipmaps=o,a.setRenderTarget(c,5,d),a.render(b,j),a.setRenderTarget(k,l,m),a.xr.enabled=n,c.texture.needsPMREMUpdate=!0}},dX=class extends b2{constructor(a=[],b=301,c,d,e,f,g,h,i,j){super(a,b,c,d,e,f,g,h,i,j),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(a){this.image=a}},dY=class extends b5{constructor(a=1,b={}){super(a,a,b),this.isWebGLCubeRenderTarget=!0;let c={width:a,height:a,depth:1};this.texture=new dX([c,c,c,c,c,c]),this._setTextureOptions(b),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(a,b){this.texture.type=b.type,this.texture.colorSpace=b.colorSpace,this.texture.generateMipmaps=b.generateMipmaps,this.texture.minFilter=b.minFilter,this.texture.magFilter=b.magFilter;let c={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},d=new dN(5,5,5),e=new dQ({name:"CubemapFromEquirect",uniforms:an(c.uniforms),vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,side:1,blending:0});e.uniforms.tEquirect.value=b;let f=new dM(d,e),g=b.minFilter;return 1008===b.minFilter&&(b.minFilter=av),new dW(1,10,this).update(a,f),b.minFilter=g,f.geometry.dispose(),f.material.dispose(),this}clear(a,b=!0,c=!0,d=!0){let e=a.getRenderTarget();for(let e=0;e<6;e++)a.setRenderTarget(this,e),a.clear(b,c,d);a.setRenderTarget(e)}},dZ=class extends cY{constructor(){super(),this.isGroup=!0,this.type="Group"}},d$={type:"move"},d_=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new dZ,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new dZ,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new bQ,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new bQ),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new dZ,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new bQ,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new bQ),this._grip}dispatchEvent(a){return null!==this._targetRay&&this._targetRay.dispatchEvent(a),null!==this._grip&&this._grip.dispatchEvent(a),null!==this._hand&&this._hand.dispatchEvent(a),this}connect(a){if(a&&a.hand){let b=this._hand;if(b)for(let c of a.hand.values())this._getHandJoint(b,c)}return this.dispatchEvent({type:"connected",data:a}),this}disconnect(a){return this.dispatchEvent({type:"disconnected",data:a}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(a,b,c){let d=null,e=null,f=null,g=this._targetRay,h=this._grip,i=this._hand;if(a&&"visible-blurred"!==b.session.visibilityState){if(i&&a.hand){for(let d of(f=!0,a.hand.values())){let a=b.getJointPose(d,c),e=this._getHandJoint(i,d);null!==a&&(e.matrix.fromArray(a.transform.matrix),e.matrix.decompose(e.position,e.rotation,e.scale),e.matrixWorldNeedsUpdate=!0,e.jointRadius=a.radius),e.visible=null!==a}let d=i.joints["index-finger-tip"],e=i.joints["thumb-tip"],g=d.position.distanceTo(e.position);i.inputState.pinching&&g>.025?(i.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:a.handedness,target:this})):!i.inputState.pinching&&g<=.015&&(i.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:a.handedness,target:this}))}else null!==h&&a.gripSpace&&null!==(e=b.getPose(a.gripSpace,c))&&(h.matrix.fromArray(e.transform.matrix),h.matrix.decompose(h.position,h.rotation,h.scale),h.matrixWorldNeedsUpdate=!0,e.linearVelocity?(h.hasLinearVelocity=!0,h.linearVelocity.copy(e.linearVelocity)):h.hasLinearVelocity=!1,e.angularVelocity?(h.hasAngularVelocity=!0,h.angularVelocity.copy(e.angularVelocity)):h.hasAngularVelocity=!1);null!==g&&(null===(d=b.getPose(a.targetRaySpace,c))&&null!==e&&(d=e),null!==d&&(g.matrix.fromArray(d.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.matrixWorldNeedsUpdate=!0,d.linearVelocity?(g.hasLinearVelocity=!0,g.linearVelocity.copy(d.linearVelocity)):g.hasLinearVelocity=!1,d.angularVelocity?(g.hasAngularVelocity=!0,g.angularVelocity.copy(d.angularVelocity)):g.hasAngularVelocity=!1,this.dispatchEvent(d$)))}return null!==g&&(g.visible=null!==d),null!==h&&(h.visible=null!==e),null!==i&&(i.visible=null!==f),this}_getHandJoint(a,b){if(void 0===a.joints[b.jointName]){let c=new dZ;c.matrixAutoUpdate=!1,c.visible=!1,a.joints[b.jointName]=c,a.add(c)}return a.joints[b.jointName]}},d0=class extends cY{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new cH,this.environmentIntensity=1,this.environmentRotation=new cH,this.overrideMaterial=null,"u">typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(a,b){return super.copy(a,b),null!==a.background&&(this.background=a.background.clone()),null!==a.environment&&(this.environment=a.environment.clone()),null!==a.fog&&(this.fog=a.fog.clone()),this.backgroundBlurriness=a.backgroundBlurriness,this.backgroundIntensity=a.backgroundIntensity,this.backgroundRotation.copy(a.backgroundRotation),this.environmentIntensity=a.environmentIntensity,this.environmentRotation.copy(a.environmentRotation),null!==a.overrideMaterial&&(this.overrideMaterial=a.overrideMaterial.clone()),this.matrixAutoUpdate=a.matrixAutoUpdate,this}toJSON(a){let b=super.toJSON(a);return null!==this.fog&&(b.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(b.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(b.object.backgroundIntensity=this.backgroundIntensity),b.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(b.object.environmentIntensity=this.environmentIntensity),b.object.environmentRotation=this.environmentRotation.toArray(),b}},d1=class{constructor(a,b){this.isInterleavedBuffer=!0,this.array=a,this.stride=b,this.count=void 0===a?0:a.length/b,this.usage=bB,this.updateRanges=[],this.version=0,this.uuid=L()}onUploadCallback(){}set needsUpdate(a){!0===a&&this.version++}setUsage(a){return this.usage=a,this}addUpdateRange(a,b){this.updateRanges.push({start:a,count:b})}clearUpdateRanges(){this.updateRanges.length=0}copy(a){return this.array=new a.array.constructor(a.array),this.count=a.count,this.stride=a.stride,this.usage=a.usage,this}copyAt(a,b,c){a*=this.stride,c*=b.stride;for(let d=0,e=this.stride;d<e;d++)this.array[a+d]=b.array[c+d];return this}set(a,b=0){return this.array.set(a,b),this}clone(a){void 0===a.arrayBuffers&&(a.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=L()),void 0===a.arrayBuffers[this.array.buffer._uuid]&&(a.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let b=new this.array.constructor(a.arrayBuffers[this.array.buffer._uuid]),c=new this.constructor(b,this.stride);return c.setUsage(this.usage),c}onUpload(a){return this.onUploadCallback=a,this}toJSON(a){return void 0===a.arrayBuffers&&(a.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=L()),void 0===a.arrayBuffers[this.array.buffer._uuid]&&(a.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},d2=new bQ,d3=class a{constructor(a,b,c,d=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=a,this.itemSize=b,this.offset=c,this.normalized=d}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(a){this.data.needsUpdate=a}applyMatrix4(a){for(let b=0,c=this.data.count;b<c;b++)d2.fromBufferAttribute(this,b),d2.applyMatrix4(a),this.setXYZ(b,d2.x,d2.y,d2.z);return this}applyNormalMatrix(a){for(let b=0,c=this.count;b<c;b++)d2.fromBufferAttribute(this,b),d2.applyNormalMatrix(a),this.setXYZ(b,d2.x,d2.y,d2.z);return this}transformDirection(a){for(let b=0,c=this.count;b<c;b++)d2.fromBufferAttribute(this,b),d2.transformDirection(a),this.setXYZ(b,d2.x,d2.y,d2.z);return this}getComponent(a,b){let c=this.array[a*this.data.stride+this.offset+b];return this.normalized&&(c=ad(c,this.array)),c}setComponent(a,b,c){return this.normalized&&(c=ae(c,this.array)),this.data.array[a*this.data.stride+this.offset+b]=c,this}setX(a,b){return this.normalized&&(b=ae(b,this.array)),this.data.array[a*this.data.stride+this.offset]=b,this}setY(a,b){return this.normalized&&(b=ae(b,this.array)),this.data.array[a*this.data.stride+this.offset+1]=b,this}setZ(a,b){return this.normalized&&(b=ae(b,this.array)),this.data.array[a*this.data.stride+this.offset+2]=b,this}setW(a,b){return this.normalized&&(b=ae(b,this.array)),this.data.array[a*this.data.stride+this.offset+3]=b,this}getX(a){let b=this.data.array[a*this.data.stride+this.offset];return this.normalized&&(b=ad(b,this.array)),b}getY(a){let b=this.data.array[a*this.data.stride+this.offset+1];return this.normalized&&(b=ad(b,this.array)),b}getZ(a){let b=this.data.array[a*this.data.stride+this.offset+2];return this.normalized&&(b=ad(b,this.array)),b}getW(a){let b=this.data.array[a*this.data.stride+this.offset+3];return this.normalized&&(b=ad(b,this.array)),b}setXY(a,b,c){return a=a*this.data.stride+this.offset,this.normalized&&(b=ae(b,this.array),c=ae(c,this.array)),this.data.array[a+0]=b,this.data.array[a+1]=c,this}setXYZ(a,b,c,d){return a=a*this.data.stride+this.offset,this.normalized&&(b=ae(b,this.array),c=ae(c,this.array),d=ae(d,this.array)),this.data.array[a+0]=b,this.data.array[a+1]=c,this.data.array[a+2]=d,this}setXYZW(a,b,c,d,e){return a=a*this.data.stride+this.offset,this.normalized&&(b=ae(b,this.array),c=ae(c,this.array),d=ae(d,this.array),e=ae(e,this.array)),this.data.array[a+0]=b,this.data.array[a+1]=c,this.data.array[a+2]=d,this.data.array[a+3]=e,this}clone(b){if(void 0!==b)return void 0===b.interleavedBuffers&&(b.interleavedBuffers={}),void 0===b.interleavedBuffers[this.data.uuid]&&(b.interleavedBuffers[this.data.uuid]=this.data.clone(b)),new a(b.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized);{H("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let a=[];for(let b=0;b<this.count;b++){let c=b*this.data.stride+this.offset;for(let b=0;b<this.itemSize;b++)a.push(this.data.array[c+b])}return new dn(new this.array.constructor(a),this.itemSize,this.normalized)}}toJSON(a){if(void 0!==a)return void 0===a.interleavedBuffers&&(a.interleavedBuffers={}),void 0===a.interleavedBuffers[this.data.uuid]&&(a.interleavedBuffers[this.data.uuid]=this.data.toJSON(a)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized};{H("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let a=[];for(let b=0;b<this.count;b++){let c=b*this.data.stride+this.offset;for(let b=0;b<this.itemSize;b++)a.push(this.data.array[c+b])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:a,normalized:this.normalized}}}},d4=class extends dh{constructor(a){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new de(0xffffff),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.alphaMap=a.alphaMap,this.rotation=a.rotation,this.sizeAttenuation=a.sizeAttenuation,this.fog=a.fog,this}},d5=class extends b2{constructor(a=null,b=1,c=1,d,e,f,g,h,i=as,j=as,k,l){super(null,f,g,h,i,j,d,e,k,l),this.isDataTexture=!0,this.image={data:a,width:b,height:c},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},d6=class extends dn{constructor(a,b,c,d=1){super(a,b,c),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=d}copy(a){return super.copy(a),this.meshPerAttribute=a.meshPerAttribute,this}toJSON(){let a=super.toJSON();return a.meshPerAttribute=this.meshPerAttribute,a.isInstancedBufferAttribute=!0,a}},d7=new bQ,d8=new bQ,d9=new bT,ea=class{constructor(a=new bQ(1,0,0),b=0){this.isPlane=!0,this.normal=a,this.constant=b}set(a,b){return this.normal.copy(a),this.constant=b,this}setComponents(a,b,c,d){return this.normal.set(a,b,c),this.constant=d,this}setFromNormalAndCoplanarPoint(a,b){return this.normal.copy(a),this.constant=-b.dot(this.normal),this}setFromCoplanarPoints(a,b,c){let d=d7.subVectors(c,b).cross(d8.subVectors(a,b)).normalize();return this.setFromNormalAndCoplanarPoint(d,a),this}copy(a){return this.normal.copy(a.normal),this.constant=a.constant,this}normalize(){let a=1/this.normal.length();return this.normal.multiplyScalar(a),this.constant*=a,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(a){return this.normal.dot(a)+this.constant}distanceToSphere(a){return this.distanceToPoint(a.center)-a.radius}projectPoint(a,b){return b.copy(a).addScaledVector(this.normal,-this.distanceToPoint(a))}intersectLine(a,b){let c=a.delta(d7),d=this.normal.dot(c);if(0===d)return 0===this.distanceToPoint(a.start)?b.copy(a.start):null;let e=-(a.start.dot(this.normal)+this.constant)/d;return e<0||e>1?null:b.copy(a.start).addScaledVector(c,e)}intersectsLine(a){let b=this.distanceToPoint(a.start),c=this.distanceToPoint(a.end);return b<0&&c>0||c<0&&b>0}intersectsBox(a){return a.intersectsPlane(this)}intersectsSphere(a){return a.intersectsPlane(this)}coplanarPoint(a){return a.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(a,b){let c=b||d9.getNormalMatrix(a),d=this.coplanarPoint(d7).applyMatrix4(a),e=this.normal.applyMatrix3(c).normalize();return this.constant=-d.dot(e),this}translate(a){return this.constant-=a.dot(this.normal),this}equals(a){return a.normal.equals(this.normal)&&a.constant===this.constant}clone(){return new this.constructor().copy(this)}},eb=new co,ec=new bO(.5,.5),ed=new bQ,ee=class{constructor(a=new ea,b=new ea,c=new ea,d=new ea,e=new ea,f=new ea){this.planes=[a,b,c,d,e,f]}set(a,b,c,d,e,f){let g=this.planes;return g[0].copy(a),g[1].copy(b),g[2].copy(c),g[3].copy(d),g[4].copy(e),g[5].copy(f),this}copy(a){let b=this.planes;for(let c=0;c<6;c++)b[c].copy(a.planes[c]);return this}setFromProjectionMatrix(a,b=bD,c=!1){let d=this.planes,e=a.elements,f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=e[5],l=e[6],m=e[7],n=e[8],o=e[9],p=e[10],q=e[11],r=e[12],s=e[13],t=e[14],u=e[15];if(d[0].setComponents(i-f,m-j,q-n,u-r).normalize(),d[1].setComponents(i+f,m+j,q+n,u+r).normalize(),d[2].setComponents(i+g,m+k,q+o,u+s).normalize(),d[3].setComponents(i-g,m-k,q-o,u-s).normalize(),c)d[4].setComponents(h,l,p,t).normalize(),d[5].setComponents(i-h,m-l,q-p,u-t).normalize();else if(d[4].setComponents(i-h,m-l,q-p,u-t).normalize(),2e3===b)d[5].setComponents(i+h,m+l,q+p,u+t).normalize();else if(2001===b)d[5].setComponents(h,l,p,t).normalize();else throw Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+b);return this}intersectsObject(a){if(void 0!==a.boundingSphere)null===a.boundingSphere&&a.computeBoundingSphere(),eb.copy(a.boundingSphere).applyMatrix4(a.matrixWorld);else{let b=a.geometry;null===b.boundingSphere&&b.computeBoundingSphere(),eb.copy(b.boundingSphere).applyMatrix4(a.matrixWorld)}return this.intersectsSphere(eb)}intersectsSprite(a){return eb.center.set(0,0,0),eb.radius=.7071067811865476+ec.distanceTo(a.center),eb.applyMatrix4(a.matrixWorld),this.intersectsSphere(eb)}intersectsSphere(a){let b=this.planes,c=a.center,d=-a.radius;for(let a=0;a<6;a++)if(b[a].distanceToPoint(c)<d)return!1;return!0}intersectsBox(a){let b=this.planes;for(let c=0;c<6;c++){let d=b[c];if(ed.x=d.normal.x>0?a.max.x:a.min.x,ed.y=d.normal.y>0?a.max.y:a.min.y,ed.z=d.normal.z>0?a.max.z:a.min.z,0>d.distanceToPoint(ed))return!1}return!0}containsPoint(a){let b=this.planes;for(let c=0;c<6;c++)if(0>b[c].distanceToPoint(a))return!1;return!0}clone(){return new this.constructor().copy(this)}},ef=new cx,eg=new ee,eh=class a{constructor(){this.coordinateSystem=bD}intersectsObject(a,b){if(!b.isArrayCamera||0===b.cameras.length)return!1;for(let c=0;c<b.cameras.length;c++){let d=b.cameras[c];if(ef.multiplyMatrices(d.projectionMatrix,d.matrixWorldInverse),eg.setFromProjectionMatrix(ef,d.coordinateSystem,d.reversedDepth),eg.intersectsObject(a))return!0}return!1}intersectsSprite(a,b){if(!b||!b.cameras||0===b.cameras.length)return!1;for(let c=0;c<b.cameras.length;c++){let d=b.cameras[c];if(ef.multiplyMatrices(d.projectionMatrix,d.matrixWorldInverse),eg.setFromProjectionMatrix(ef,d.coordinateSystem,d.reversedDepth),eg.intersectsSprite(a))return!0}return!1}intersectsSphere(a,b){if(!b||!b.cameras||0===b.cameras.length)return!1;for(let c=0;c<b.cameras.length;c++){let d=b.cameras[c];if(ef.multiplyMatrices(d.projectionMatrix,d.matrixWorldInverse),eg.setFromProjectionMatrix(ef,d.coordinateSystem,d.reversedDepth),eg.intersectsSphere(a))return!0}return!1}intersectsBox(a,b){if(!b||!b.cameras||0===b.cameras.length)return!1;for(let c=0;c<b.cameras.length;c++){let d=b.cameras[c];if(ef.multiplyMatrices(d.projectionMatrix,d.matrixWorldInverse),eg.setFromProjectionMatrix(ef,d.coordinateSystem,d.reversedDepth),eg.intersectsBox(a))return!0}return!1}containsPoint(a,b){if(!b||!b.cameras||0===b.cameras.length)return!1;for(let c=0;c<b.cameras.length;c++){let d=b.cameras[c];if(ef.multiplyMatrices(d.projectionMatrix,d.matrixWorldInverse),eg.setFromProjectionMatrix(ef,d.coordinateSystem,d.reversedDepth),eg.containsPoint(a))return!0}return!1}clone(){return new a}},ei=class extends dh{constructor(a){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new de(0xffffff),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.linewidth=a.linewidth,this.linecap=a.linecap,this.linejoin=a.linejoin,this.fog=a.fog,this}},ej=class extends dh{constructor(a){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new de(0xffffff),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.alphaMap=a.alphaMap,this.size=a.size,this.sizeAttenuation=a.sizeAttenuation,this.fog=a.fog,this}},ek=class extends b2{constructor(a,b){super({width:a,height:b}),this.isFramebufferTexture=!0,this.magFilter=as,this.minFilter=as,this.generateMipmaps=!1,this.needsUpdate=!0}},el=class extends b2{constructor(a,b,c=aE,d,e,f,g=as,h=as,i,j=aP,k=1){if(1026!==j&&1027!==j)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super({width:a,height:b,depth:k},d,e,f,g,h,j,c,i),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(a){return super.copy(a),this.source=new b_(Object.assign({},a.image)),this.compareFunction=a.compareFunction,this}toJSON(a){let b=super.toJSON(a);return null!==this.compareFunction&&(b.compareFunction=this.compareFunction),b}},em=class a extends dA{constructor(a=1,b=1,c=1,d=32,e=1,f=!1,g=0,h=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:h};let i=this;d=Math.floor(d),e=Math.floor(e);let j=[],k=[],l=[],m=[],n=0,o=[],p=c/2,q=0;function r(c){let e=n,f=new bO,o=new bQ,r=0,s=!0===c?a:b,t=!0===c?1:-1;for(let a=1;a<=d;a++)k.push(0,p*t,0),l.push(0,t,0),m.push(.5,.5),n++;let u=n;for(let a=0;a<=d;a++){let b=a/d*h+g,c=Math.cos(b),e=Math.sin(b);o.x=s*e,o.y=p*t,o.z=s*c,k.push(o.x,o.y,o.z),l.push(0,t,0),f.x=.5*c+.5,f.y=.5*e*t+.5,m.push(f.x,f.y),n++}for(let a=0;a<d;a++){let b=e+a,d=u+a;!0===c?j.push(d,d+1,b):j.push(d+1,d,b),r+=3}i.addGroup(q,r,!0===c?1:2),q+=r}(function(){let f=new bQ,r=new bQ,s=0,t=(b-a)/c;for(let i=0;i<=e;i++){let j=[],q=i/e,s=q*(b-a)+a;for(let a=0;a<=d;a++){let b=a/d,e=b*h+g,i=Math.sin(e),o=Math.cos(e);r.x=s*i,r.y=-q*c+p,r.z=s*o,k.push(r.x,r.y,r.z),f.set(i,t,o).normalize(),l.push(f.x,f.y,f.z),m.push(b,1-q),j.push(n++)}o.push(j)}for(let c=0;c<d;c++)for(let d=0;d<e;d++){let f=o[d][c],g=o[d+1][c],h=o[d+1][c+1],i=o[d][c+1];(a>0||0!==d)&&(j.push(f,g,i),s+=3),(b>0||d!==e-1)&&(j.push(g,h,i),s+=3)}i.addGroup(q,s,0),q+=s})(),!1===f&&(a>0&&r(!0),b>0&&r(!1)),this.setIndex(j),this.setAttribute("position",new ds(k,3)),this.setAttribute("normal",new ds(l,3)),this.setAttribute("uv",new ds(m,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(b){return new a(b.radiusTop,b.radiusBottom,b.height,b.radialSegments,b.heightSegments,b.openEnded,b.thetaStart,b.thetaLength)}},en=class a extends dA{constructor(a=1,b=1,c=1,d=1){super(),this.type="PlaneGeometry",this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};let e=a/2,f=b/2,g=Math.floor(c),h=Math.floor(d),i=g+1,j=h+1,k=a/g,l=b/h,m=[],n=[],o=[],p=[];for(let a=0;a<j;a++){let b=a*l-f;for(let c=0;c<i;c++){let d=c*k-e;n.push(d,-b,0),o.push(0,0,1),p.push(c/g),p.push(1-a/h)}}for(let a=0;a<h;a++)for(let b=0;b<g;b++){let c=b+i*a,d=b+i*(a+1),e=b+1+i*(a+1),f=b+1+i*a;m.push(c,d,f),m.push(d,e,f)}this.setIndex(m),this.setAttribute("position",new ds(n,3)),this.setAttribute("normal",new ds(o,3)),this.setAttribute("uv",new ds(p,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(b){return new a(b.width,b.height,b.widthSegments,b.heightSegments)}},eo=class a extends dA{constructor(a=1,b=32,c=16,d=0,e=2*Math.PI,f=0,g=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g},b=Math.max(3,Math.floor(b)),c=Math.max(2,Math.floor(c));let h=Math.min(f+g,Math.PI),i=0,j=[],k=new bQ,l=new bQ,m=[],n=[],o=[],p=[];for(let m=0;m<=c;m++){let q=[],r=m/c,s=0;0===m&&0===f?s=.5/b:m===c&&h===Math.PI&&(s=-.5/b);for(let c=0;c<=b;c++){let h=c/b;k.x=-a*Math.cos(d+h*e)*Math.sin(f+r*g),k.y=a*Math.cos(f+r*g),k.z=a*Math.sin(d+h*e)*Math.sin(f+r*g),n.push(k.x,k.y,k.z),l.copy(k).normalize(),o.push(l.x,l.y,l.z),p.push(h+s,1-r),q.push(i++)}j.push(q)}for(let a=0;a<c;a++)for(let d=0;d<b;d++){let b=j[a][d+1],e=j[a][d],g=j[a+1][d],i=j[a+1][d+1];(0!==a||f>0)&&m.push(b,e,i),(a!==c-1||h<Math.PI)&&m.push(e,g,i)}this.setIndex(m),this.setAttribute("position",new ds(n,3)),this.setAttribute("normal",new ds(o,3)),this.setAttribute("uv",new ds(p,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(b){return new a(b.radius,b.widthSegments,b.heightSegments,b.phiStart,b.phiLength,b.thetaStart,b.thetaLength)}},ep=class extends dh{constructor(a){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new de(0),this.transparent=!0,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.fog=a.fog,this}},eq=class extends dh{constructor(a){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new de(0xffffff),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new de(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new bO(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new cH,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.defines={STANDARD:""},this.color.copy(a.color),this.roughness=a.roughness,this.metalness=a.metalness,this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.roughnessMap=a.roughnessMap,this.metalnessMap=a.metalnessMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.envMapRotation.copy(a.envMapRotation),this.envMapIntensity=a.envMapIntensity,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.flatShading=a.flatShading,this.fog=a.fog,this}},er=class extends eq{constructor(a){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new bO(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return M(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(a){this.ior=(1+.4*a)/(1-.4*a)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new de(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new de(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new de(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(a)}get anisotropy(){return this._anisotropy}set anisotropy(a){this._anisotropy>0!=a>0&&this.version++,this._anisotropy=a}get clearcoat(){return this._clearcoat}set clearcoat(a){this._clearcoat>0!=a>0&&this.version++,this._clearcoat=a}get iridescence(){return this._iridescence}set iridescence(a){this._iridescence>0!=a>0&&this.version++,this._iridescence=a}get dispersion(){return this._dispersion}set dispersion(a){this._dispersion>0!=a>0&&this.version++,this._dispersion=a}get sheen(){return this._sheen}set sheen(a){this._sheen>0!=a>0&&this.version++,this._sheen=a}get transmission(){return this._transmission}set transmission(a){this._transmission>0!=a>0&&this.version++,this._transmission=a}copy(a){return super.copy(a),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=a.anisotropy,this.anisotropyRotation=a.anisotropyRotation,this.anisotropyMap=a.anisotropyMap,this.clearcoat=a.clearcoat,this.clearcoatMap=a.clearcoatMap,this.clearcoatRoughness=a.clearcoatRoughness,this.clearcoatRoughnessMap=a.clearcoatRoughnessMap,this.clearcoatNormalMap=a.clearcoatNormalMap,this.clearcoatNormalScale.copy(a.clearcoatNormalScale),this.dispersion=a.dispersion,this.ior=a.ior,this.iridescence=a.iridescence,this.iridescenceMap=a.iridescenceMap,this.iridescenceIOR=a.iridescenceIOR,this.iridescenceThicknessRange=[...a.iridescenceThicknessRange],this.iridescenceThicknessMap=a.iridescenceThicknessMap,this.sheen=a.sheen,this.sheenColor.copy(a.sheenColor),this.sheenColorMap=a.sheenColorMap,this.sheenRoughness=a.sheenRoughness,this.sheenRoughnessMap=a.sheenRoughnessMap,this.transmission=a.transmission,this.transmissionMap=a.transmissionMap,this.thickness=a.thickness,this.thicknessMap=a.thicknessMap,this.attenuationDistance=a.attenuationDistance,this.attenuationColor.copy(a.attenuationColor),this.specularIntensity=a.specularIntensity,this.specularIntensityMap=a.specularIntensityMap,this.specularColor.copy(a.specularColor),this.specularColorMap=a.specularColorMap,this}},es=class extends dh{constructor(a){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new de(0xffffff),this.specular=new de(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new de(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new bO(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new cH,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.specular.copy(a.specular),this.shininess=a.shininess,this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.envMapRotation.copy(a.envMapRotation),this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.flatShading=a.flatShading,this.fog=a.fog,this}},et=class extends dh{constructor(a){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new de(0xffffff),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new de(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new bO(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.gradientMap=a.gradientMap,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.alphaMap=a.alphaMap,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.fog=a.fog,this}},eu=class extends dh{constructor(a){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new bO(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(a)}copy(a){return super.copy(a),this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.flatShading=a.flatShading,this}},ev=class extends dh{constructor(a){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new de(0xffffff),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new de(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new bO(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new cH,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.envMapRotation.copy(a.envMapRotation),this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.flatShading=a.flatShading,this.fog=a.fog,this}},ew=class extends dh{constructor(a){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new de(0xffffff),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new bO(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.defines={MATCAP:""},this.color.copy(a.color),this.matcap=a.matcap,this.map=a.map,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.alphaMap=a.alphaMap,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.flatShading=a.flatShading,this.fog=a.fog,this}},ex=class extends ei{constructor(a){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(a)}copy(a){return super.copy(a),this.scale=a.scale,this.dashSize=a.dashSize,this.gapSize=a.gapSize,this}},ey=class{constructor(a,b,c,d){this.parameterPositions=a,this._cachedIndex=0,this.resultBuffer=void 0===d?new b.constructor(c):d,this.sampleValues=b,this.valueSize=c,this.settings=null,this.DefaultSettings_={}}evaluate(a){let b=this.parameterPositions,c=this._cachedIndex,d=b[c],e=b[c-1];a:{b:{let f;c:{d:if(!(a<d)){for(let f=c+2;;){if(void 0===d){if(a<e)break d;return c=b.length,this._cachedIndex=c,this.copySampleValue_(c-1)}if(c===f)break;if(e=d,a<(d=b[++c]))break b}f=b.length;break c}if(!(a>=e)){let g=b[1];a<g&&(c=2,e=g);for(let f=c-2;;){if(void 0===e)return this._cachedIndex=0,this.copySampleValue_(0);if(c===f)break;if(d=e,a>=(e=b[--c-1]))break b}f=c,c=0;break c}break a}for(;c<f;){let d=c+f>>>1;a<b[d]?f=d:c=d+1}if(d=b[c],void 0===(e=b[c-1]))return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===d)return c=b.length,this._cachedIndex=c,this.copySampleValue_(c-1)}this._cachedIndex=c,this.intervalChanged_(c,e,d)}return this.interpolate_(c,e,a,d)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(a){let b=this.resultBuffer,c=this.sampleValues,d=this.valueSize,e=a*d;for(let a=0;a!==d;++a)b[a]=c[e+a];return b}interpolate_(){throw Error("call to abstract method")}intervalChanged_(){}},ez=class extends ey{constructor(a,b,c,d){super(a,b,c,d),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(a,b,c){let d=this.parameterPositions,e=a-2,f=a+1,g=d[e],h=d[f];if(void 0===g)switch(this.getSettings_().endingStart){case 2401:e=a,g=2*b-c;break;case 2402:e=d.length-2,g=b+d[e]-d[e+1];break;default:e=a,g=c}if(void 0===h)switch(this.getSettings_().endingEnd){case 2401:f=a,h=2*c-b;break;case 2402:f=1,h=c+d[1]-d[0];break;default:f=a-1,h=b}let i=(c-b)*.5,j=this.valueSize;this._weightPrev=i/(b-g),this._weightNext=i/(h-c),this._offsetPrev=e*j,this._offsetNext=f*j}interpolate_(a,b,c,d){let e=this.resultBuffer,f=this.sampleValues,g=this.valueSize,h=a*g,i=h-g,j=this._offsetPrev,k=this._offsetNext,l=this._weightPrev,m=this._weightNext,n=(c-b)/(d-b),o=n*n,p=o*n,q=-l*p+2*l*o-l*n,r=(1+l)*p+(-1.5-2*l)*o+(-.5+l)*n+1,s=(-1-m)*p+(1.5+m)*o+.5*n,t=m*p-m*o;for(let a=0;a!==g;++a)e[a]=q*f[j+a]+r*f[i+a]+s*f[h+a]+t*f[k+a];return e}},eA=class extends ey{constructor(a,b,c,d){super(a,b,c,d)}interpolate_(a,b,c,d){let e=this.resultBuffer,f=this.sampleValues,g=this.valueSize,h=a*g,i=h-g,j=(c-b)/(d-b),k=1-j;for(let a=0;a!==g;++a)e[a]=f[i+a]*k+f[h+a]*j;return e}},eB=class extends ey{constructor(a,b,c,d){super(a,b,c,d)}interpolate_(a){return this.copySampleValue_(a-1)}},eC=class{constructor(a,b,c,d){if(void 0===a)throw Error("THREE.KeyframeTrack: track name is undefined");if(void 0===b||0===b.length)throw Error("THREE.KeyframeTrack: no keyframes in track named "+a);this.name=a,this.times=ao(b,this.TimeBufferType),this.values=ao(c,this.ValueBufferType),this.setInterpolation(d||this.DefaultInterpolation)}static toJSON(a){let b=a.constructor,c;if(b.toJSON!==this.toJSON)c=b.toJSON(a);else{c={name:a.name,times:ao(a.times,Array),values:ao(a.values,Array)};let b=a.getInterpolation();b!==a.DefaultInterpolation&&(c.interpolation=b)}return c.type=a.ValueTypeName,c}InterpolantFactoryMethodDiscrete(a){return new eB(this.times,this.values,this.getValueSize(),a)}InterpolantFactoryMethodLinear(a){return new eA(this.times,this.values,this.getValueSize(),a)}InterpolantFactoryMethodSmooth(a){return new ez(this.times,this.values,this.getValueSize(),a)}setInterpolation(a){let b;switch(a){case 2300:b=this.InterpolantFactoryMethodDiscrete;break;case 2301:b=this.InterpolantFactoryMethodLinear;break;case 2302:b=this.InterpolantFactoryMethodSmooth}if(void 0===b){let b="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant)if(a!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw Error(b);return I("KeyframeTrack:",b),this}return this.createInterpolant=b,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(a){if(0!==a){let b=this.times;for(let c=0,d=b.length;c!==d;++c)b[c]+=a}return this}scale(a){if(1!==a){let b=this.times;for(let c=0,d=b.length;c!==d;++c)b[c]*=a}return this}trim(a,b){let c=this.times,d=c.length,e=0,f=d-1;for(;e!==d&&c[e]<a;)++e;for(;-1!==f&&c[f]>b;)--f;if(++f,0!==e||f!==d){e>=f&&(e=(f=Math.max(f,1))-1);let a=this.getValueSize();this.times=c.slice(e,f),this.values=this.values.slice(e*a,f*a)}return this}validate(){var a;let b=!0,c=this.getValueSize();c-Math.floor(c)!=0&&(J("KeyframeTrack: Invalid value size in track.",this),b=!1);let d=this.times,e=this.values,f=d.length;0===f&&(J("KeyframeTrack: Track is empty.",this),b=!1);let g=null;for(let a=0;a!==f;a++){let c=d[a];if("number"==typeof c&&isNaN(c)){J("KeyframeTrack: Time is not a valid number.",this,a,c),b=!1;break}if(null!==g&&g>c){J("KeyframeTrack: Out of order keys.",this,a,c,g),b=!1;break}g=c}if(void 0!==e&&ArrayBuffer.isView(a=e)&&!(a instanceof DataView))for(let a=0,c=e.length;a!==c;++a){let c=e[a];if(isNaN(c)){J("KeyframeTrack: Value is not a valid number.",this,a,c),b=!1;break}}return b}optimize(){let a=this.times.slice(),b=this.values.slice(),c=this.getValueSize(),d=2302===this.getInterpolation(),e=a.length-1,f=1;for(let g=1;g<e;++g){let e=!1,h=a[g];if(h!==a[g+1]&&(1!==g||h!==a[0]))if(d)e=!0;else{let a=g*c,d=a-c,f=a+c;for(let g=0;g!==c;++g){let c=b[a+g];if(c!==b[d+g]||c!==b[f+g]){e=!0;break}}}if(e){if(g!==f){a[f]=a[g];let d=g*c,e=f*c;for(let a=0;a!==c;++a)b[e+a]=b[d+a]}++f}}if(e>0){a[f]=a[e];for(let a=e*c,d=f*c,g=0;g!==c;++g)b[d+g]=b[a+g];++f}return f===a.length?(this.times=a,this.values=b):(this.times=a.slice(0,f),this.values=b.slice(0,f*c)),this}clone(){let a=this.times.slice(),b=this.values.slice(),c=new this.constructor(this.name,a,b);return c.createInterpolant=this.createInterpolant,c}},eC.prototype.ValueTypeName="",eC.prototype.TimeBufferType=Float32Array,eC.prototype.ValueBufferType=Float32Array,eC.prototype.DefaultInterpolation=2301,(eD=class extends eC{constructor(a,b,c){super(a,b,c)}}).prototype.ValueTypeName="bool",eD.prototype.ValueBufferType=Array,eD.prototype.DefaultInterpolation=2300,eD.prototype.InterpolantFactoryMethodLinear=void 0,eD.prototype.InterpolantFactoryMethodSmooth=void 0,(class extends eC{constructor(a,b,c,d){super(a,b,c,d)}}).prototype.ValueTypeName="color",(class extends eC{constructor(a,b,c,d){super(a,b,c,d)}}).prototype.ValueTypeName="number",eE=class extends ey{constructor(a,b,c,d){super(a,b,c,d)}interpolate_(a,b,c,d){let e=this.resultBuffer,f=this.sampleValues,g=this.valueSize,h=(c-b)/(d-b),i=a*g;for(let a=i+g;i!==a;i+=4)bP.slerpFlat(e,0,f,i-g,f,i,h);return e}},(eF=class extends eC{constructor(a,b,c,d){super(a,b,c,d)}InterpolantFactoryMethodLinear(a){return new eE(this.times,this.values,this.getValueSize(),a)}}).prototype.ValueTypeName="quaternion",eF.prototype.InterpolantFactoryMethodSmooth=void 0,(eG=class extends eC{constructor(a,b,c){super(a,b,c)}}).prototype.ValueTypeName="string",eG.prototype.ValueBufferType=Array,eG.prototype.DefaultInterpolation=2300,eG.prototype.InterpolantFactoryMethodLinear=void 0,eG.prototype.InterpolantFactoryMethodSmooth=void 0,(class extends eC{constructor(a,b,c,d){super(a,b,c,d)}}).prototype.ValueTypeName="vector",eH={enabled:!1,files:{},add:function(a,b){!1!==this.enabled&&(this.files[a]=b)},get:function(a){if(!1!==this.enabled)return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}},eI=new class{constructor(a,b,c){let d=this,e=!1,f=0,g=0,h,i=[];this.onStart=void 0,this.onLoad=a,this.onProgress=b,this.onError=c,this._abortController=null,this.itemStart=function(a){g++,!1===e&&void 0!==d.onStart&&d.onStart(a,f,g),e=!0},this.itemEnd=function(a){f++,void 0!==d.onProgress&&d.onProgress(a,f,g),f===g&&(e=!1,void 0!==d.onLoad&&d.onLoad())},this.itemError=function(a){void 0!==d.onError&&d.onError(a)},this.resolveURL=function(a){return h?h(a):a},this.setURLModifier=function(a){return h=a,this},this.addHandler=function(a,b){return i.push(a,b),this},this.removeHandler=function(a){let b=i.indexOf(a);return -1!==b&&i.splice(b,2),this},this.getHandler=function(a){for(let b=0,c=i.length;b<c;b+=2){let c=i[b],d=i[b+1];if(c.global&&(c.lastIndex=0),c.test(a))return d}return null},this.abort=function(){return this.abortController.abort(),this._abortController=null,this}}get abortController(){return this._abortController||(this._abortController=new AbortController),this._abortController}},eJ=class{constructor(a){this.manager=void 0===a?eI:a,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(a,b){let c=this;return new Promise(function(d,e){c.load(a,d,b,e)})}parse(){}setCrossOrigin(a){return this.crossOrigin=a,this}setWithCredentials(a){return this.withCredentials=a,this}setPath(a){return this.path=a,this}setResourcePath(a){return this.resourcePath=a,this}setRequestHeader(a){return this.requestHeader=a,this}abort(){return this}},eJ.DEFAULT_MATERIAL_NAME="__DEFAULT",eK=new WeakMap,eL=class extends eJ{constructor(a){super(a)}load(a,b,c,d){void 0!==this.path&&(a=this.path+a),a=this.manager.resolveURL(a);let e=this,f=eH.get(`image:${a}`);if(void 0!==f){if(!0===f.complete)e.manager.itemStart(a),setTimeout(function(){b&&b(f),e.manager.itemEnd(a)},0);else{let a=eK.get(f);void 0===a&&(a=[],eK.set(f,a)),a.push({onLoad:b,onError:d})}return f}let g=G("img");function h(){j(),b&&b(this);let c=eK.get(this)||[];for(let a=0;a<c.length;a++){let b=c[a];b.onLoad&&b.onLoad(this)}eK.delete(this),e.manager.itemEnd(a)}function i(b){j(),d&&d(b),eH.remove(`image:${a}`);let c=eK.get(this)||[];for(let a=0;a<c.length;a++){let d=c[a];d.onError&&d.onError(b)}eK.delete(this),e.manager.itemError(a),e.manager.itemEnd(a)}function j(){g.removeEventListener("load",h,!1),g.removeEventListener("error",i,!1)}return g.addEventListener("load",h,!1),g.addEventListener("error",i,!1),"data:"!==a.slice(0,5)&&void 0!==this.crossOrigin&&(g.crossOrigin=this.crossOrigin),eH.add(`image:${a}`,g),e.manager.itemStart(a),g.src=a,g}},eM=class extends eJ{constructor(a){super(a)}load(a,b,c,d){let e=new b2,f=new eL(this.manager);return f.setCrossOrigin(this.crossOrigin),f.setPath(this.path),f.load(a,function(a){e.image=a,e.needsUpdate=!0,void 0!==b&&b(e)},c,d),e}},eN=class extends cY{constructor(a,b=1){super(),this.isLight=!0,this.type="Light",this.color=new de(a),this.intensity=b}dispose(){}copy(a,b){return super.copy(a,b),this.color.copy(a.color),this.intensity=a.intensity,this}toJSON(a){let b=super.toJSON(a);return b.object.color=this.color.getHex(),b.object.intensity=this.intensity,void 0!==this.groundColor&&(b.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(b.object.distance=this.distance),void 0!==this.angle&&(b.object.angle=this.angle),void 0!==this.decay&&(b.object.decay=this.decay),void 0!==this.penumbra&&(b.object.penumbra=this.penumbra),void 0!==this.shadow&&(b.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(b.object.target=this.target.uuid),b}},eO=class extends eN{constructor(a,b,c){super(a,c),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(cY.DEFAULT_UP),this.updateMatrix(),this.groundColor=new de(b)}copy(a,b){return super.copy(a,b),this.groundColor.copy(a.groundColor),this}},eP=new cx,eQ=new bQ,eR=new bQ,eS=class{constructor(a){this.camera=a,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new bO(512,512),this.mapType=az,this.map=null,this.mapPass=null,this.matrix=new cx,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ee,this._frameExtents=new bO(1,1),this._viewportCount=1,this._viewports=[new b3(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(a){let b=this.camera,c=this.matrix;eQ.setFromMatrixPosition(a.matrixWorld),b.position.copy(eQ),eR.setFromMatrixPosition(a.target.matrixWorld),b.lookAt(eR),b.updateMatrixWorld(),eP.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse),this._frustum.setFromProjectionMatrix(eP,b.coordinateSystem,b.reversedDepth),b.reversedDepth?c.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):c.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),c.multiply(eP)}getViewport(a){return this._viewports[a]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(a){return this.camera=a.camera.clone(),this.intensity=a.intensity,this.bias=a.bias,this.radius=a.radius,this.autoUpdate=a.autoUpdate,this.needsUpdate=a.needsUpdate,this.normalBias=a.normalBias,this.blurSamples=a.blurSamples,this.mapSize.copy(a.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let a={};return 1!==this.intensity&&(a.intensity=this.intensity),0!==this.bias&&(a.bias=this.bias),0!==this.normalBias&&(a.normalBias=this.normalBias),1!==this.radius&&(a.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(a.mapSize=this.mapSize.toArray()),a.camera=this.camera.toJSON(!1).object,delete a.camera.matrix,a}},eT=class extends eS{constructor(){super(new dV(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(a){let b=this.camera,c=2*bM*a.angle*this.focus,d=this.mapSize.width/this.mapSize.height*this.aspect,e=a.distance||b.far;(c!==b.fov||d!==b.aspect||e!==b.far)&&(b.fov=c,b.aspect=d,b.far=e,b.updateProjectionMatrix()),super.updateMatrices(a)}copy(a){return super.copy(a),this.focus=a.focus,this}},eU=class extends eN{constructor(a,b,c=0,d=Math.PI/3,e=0,f=2){super(a,b),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(cY.DEFAULT_UP),this.updateMatrix(),this.target=new cY,this.distance=c,this.angle=d,this.penumbra=e,this.decay=f,this.map=null,this.shadow=new eT}get power(){return this.intensity*Math.PI}set power(a){this.intensity=a/Math.PI}dispose(){this.shadow.dispose()}copy(a,b){return super.copy(a,b),this.distance=a.distance,this.angle=a.angle,this.penumbra=a.penumbra,this.decay=a.decay,this.target=a.target.clone(),this.shadow=a.shadow.clone(),this}},eV=new cx,eW=new bQ,eX=new bQ,eY=class extends eS{constructor(){super(new dV(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new bO(4,2),this._viewportCount=6,this._viewports=[new b3(2,1,1,1),new b3(0,1,1,1),new b3(3,1,1,1),new b3(1,1,1,1),new b3(3,0,1,1),new b3(1,0,1,1)],this._cubeDirections=[new bQ(1,0,0),new bQ(-1,0,0),new bQ(0,0,1),new bQ(0,0,-1),new bQ(0,1,0),new bQ(0,-1,0)],this._cubeUps=[new bQ(0,1,0),new bQ(0,1,0),new bQ(0,1,0),new bQ(0,1,0),new bQ(0,0,1),new bQ(0,0,-1)]}updateMatrices(a,b=0){let c=this.camera,d=this.matrix,e=a.distance||c.far;e!==c.far&&(c.far=e,c.updateProjectionMatrix()),eW.setFromMatrixPosition(a.matrixWorld),c.position.copy(eW),eX.copy(c.position),eX.add(this._cubeDirections[b]),c.up.copy(this._cubeUps[b]),c.lookAt(eX),c.updateMatrixWorld(),d.makeTranslation(-eW.x,-eW.y,-eW.z),eV.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse),this._frustum.setFromProjectionMatrix(eV,c.coordinateSystem,c.reversedDepth)}},eZ=class extends eN{constructor(a,b,c=0,d=2){super(a,b),this.isPointLight=!0,this.type="PointLight",this.distance=c,this.decay=d,this.shadow=new eY}get power(){return 4*this.intensity*Math.PI}set power(a){this.intensity=a/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(a,b){return super.copy(a,b),this.distance=a.distance,this.decay=a.decay,this.shadow=a.shadow.clone(),this}},e$=class extends dR{constructor(a=-1,b=1,c=1,d=-1,e=.1,f=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=a,this.right=b,this.top=c,this.bottom=d,this.near=e,this.far=f,this.updateProjectionMatrix()}copy(a,b){return super.copy(a,b),this.left=a.left,this.right=a.right,this.top=a.top,this.bottom=a.bottom,this.near=a.near,this.far=a.far,this.zoom=a.zoom,this.view=null===a.view?null:Object.assign({},a.view),this}setViewOffset(a,b,c,d,e,f){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=a,this.view.fullHeight=b,this.view.offsetX=c,this.view.offsetY=d,this.view.width=e,this.view.height=f,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let a=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,d=(this.top+this.bottom)/2,e=c-a,f=c+a,g=d+b,h=d-b;if(null!==this.view&&this.view.enabled){let a=(this.right-this.left)/this.view.fullWidth/this.zoom,b=(this.top-this.bottom)/this.view.fullHeight/this.zoom;e+=a*this.view.offsetX,f=e+a*this.view.width,g-=b*this.view.offsetY,h=g-b*this.view.height}this.projectionMatrix.makeOrthographic(e,f,g,h,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(a){let b=super.toJSON(a);return b.object.zoom=this.zoom,b.object.left=this.left,b.object.right=this.right,b.object.top=this.top,b.object.bottom=this.bottom,b.object.near=this.near,b.object.far=this.far,null!==this.view&&(b.object.view=Object.assign({},this.view)),b}},e_=class extends eS{constructor(){super(new e$(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},e0=class extends eN{constructor(a,b){super(a,b),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(cY.DEFAULT_UP),this.updateMatrix(),this.target=new cY,this.shadow=new e_}dispose(){this.shadow.dispose()}copy(a){return super.copy(a),this.target=a.target.clone(),this.shadow=a.shadow.clone(),this}},e1=class extends eN{constructor(a,b){super(a,b),this.isAmbientLight=!0,this.type="AmbientLight"}},e2=class extends eN{constructor(a,b,c=10,d=10){super(a,b),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=c,this.height=d}get power(){return this.intensity*this.width*this.height*Math.PI}set power(a){this.intensity=a/(this.width*this.height*Math.PI)}copy(a){return super.copy(a),this.width=a.width,this.height=a.height,this}toJSON(a){let b=super.toJSON(a);return b.object.width=this.width,b.object.height=this.height,b}},e3=class{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let a=0;a<9;a++)this.coefficients.push(new bQ)}set(a){for(let b=0;b<9;b++)this.coefficients[b].copy(a[b]);return this}zero(){for(let a=0;a<9;a++)this.coefficients[a].set(0,0,0);return this}getAt(a,b){let c=a.x,d=a.y,e=a.z,f=this.coefficients;return b.copy(f[0]).multiplyScalar(.282095),b.addScaledVector(f[1],.488603*d),b.addScaledVector(f[2],.488603*e),b.addScaledVector(f[3],.488603*c),b.addScaledVector(f[4],c*d*1.092548),b.addScaledVector(f[5],d*e*1.092548),b.addScaledVector(f[6],.315392*(3*e*e-1)),b.addScaledVector(f[7],c*e*1.092548),b.addScaledVector(f[8],.546274*(c*c-d*d)),b}getIrradianceAt(a,b){let c=a.x,d=a.y,e=a.z,f=this.coefficients;return b.copy(f[0]).multiplyScalar(.886227),b.addScaledVector(f[1],1.023328*d),b.addScaledVector(f[2],1.023328*e),b.addScaledVector(f[3],1.023328*c),b.addScaledVector(f[4],.858086*c*d),b.addScaledVector(f[5],.858086*d*e),b.addScaledVector(f[6],.743125*e*e-.247708),b.addScaledVector(f[7],.858086*c*e),b.addScaledVector(f[8],.429043*(c*c-d*d)),b}add(a){for(let b=0;b<9;b++)this.coefficients[b].add(a.coefficients[b]);return this}addScaledSH(a,b){for(let c=0;c<9;c++)this.coefficients[c].addScaledVector(a.coefficients[c],b);return this}scale(a){for(let b=0;b<9;b++)this.coefficients[b].multiplyScalar(a);return this}lerp(a,b){for(let c=0;c<9;c++)this.coefficients[c].lerp(a.coefficients[c],b);return this}equals(a){for(let b=0;b<9;b++)if(!this.coefficients[b].equals(a.coefficients[b]))return!1;return!0}copy(a){return this.set(a.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(a,b=0){let c=this.coefficients;for(let d=0;d<9;d++)c[d].fromArray(a,b+3*d);return this}toArray(a=[],b=0){let c=this.coefficients;for(let d=0;d<9;d++)c[d].toArray(a,b+3*d);return a}static getBasisAt(a,b){let c=a.x,d=a.y,e=a.z;b[0]=.282095,b[1]=.488603*d,b[2]=.488603*e,b[3]=.488603*c,b[4]=1.092548*c*d,b[5]=1.092548*d*e,b[6]=.315392*(3*e*e-1),b[7]=1.092548*c*e,b[8]=.546274*(c*c-d*d)}},e4=class extends eN{constructor(a=new e3,b=1){super(void 0,b),this.isLightProbe=!0,this.sh=a}copy(a){return super.copy(a),this.sh.copy(a.sh),this}fromJSON(a){return this.intensity=a.intensity,this.sh.fromArray(a.sh),this}toJSON(a){let b=super.toJSON(a);return b.object.sh=this.sh.toArray(),b}},e5=class extends dV{constructor(a=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=a}},e7=RegExp("["+(e6="\\[\\]\\.:\\/")+"]","g"),e8="[^"+e6+"]",e9="[^"+e6.replace("\\.","")+"]",fa="((?:WC+[\\/:])*)".replace("WC",e8),fb="(WCOD+)?".replace("WCOD",e9),fc=RegExp("^"+fa+fb+"(?:\\.(WC+)(?:\\[(.+)\\])?)?".replace("WC",e8)+"\\.(WC+)(?:\\[(.+)\\])?".replace("WC",e8)+"$"),fd=["material","materials","bones","map"],fe=class{constructor(a,b,c){let d=c||ff.parseTrackName(b);this._targetGroup=a,this._bindings=a.subscribe_(b,d)}getValue(a,b){this.bind();let c=this._targetGroup.nCachedObjects_,d=this._bindings[c];void 0!==d&&d.getValue(a,b)}setValue(a,b){let c=this._bindings;for(let d=this._targetGroup.nCachedObjects_,e=c.length;d!==e;++d)c[d].setValue(a,b)}bind(){let a=this._bindings;for(let b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].bind()}unbind(){let a=this._bindings;for(let b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].unbind()}},(ff=class a{constructor(b,c,d){this.path=c,this.parsedPath=d||a.parseTrackName(c),this.node=a.findNode(b,this.parsedPath.nodeName),this.rootNode=b,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(b,c,d){return b&&b.isAnimationObjectGroup?new a.Composite(b,c,d):new a(b,c,d)}static sanitizeNodeName(a){return a.replace(/\s/g,"_").replace(e7,"")}static parseTrackName(a){let b=fc.exec(a);if(null===b)throw Error("PropertyBinding: Cannot parse trackName: "+a);let c={nodeName:b[2],objectName:b[3],objectIndex:b[4],propertyName:b[5],propertyIndex:b[6]},d=c.nodeName&&c.nodeName.lastIndexOf(".");if(void 0!==d&&-1!==d){let a=c.nodeName.substring(d+1);-1!==fd.indexOf(a)&&(c.nodeName=c.nodeName.substring(0,d),c.objectName=a)}if(null===c.propertyName||0===c.propertyName.length)throw Error("PropertyBinding: can not parse propertyName from trackName: "+a);return c}static findNode(a,b){if(void 0===b||""===b||"."===b||-1===b||b===a.name||b===a.uuid)return a;if(a.skeleton){let c=a.skeleton.getBoneByName(b);if(void 0!==c)return c}if(a.children){let c=function(a){for(let d=0;d<a.length;d++){let e=a[d];if(e.name===b||e.uuid===b)return e;let f=c(e.children);if(f)return f}return null},d=c(a.children);if(d)return d}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(a,b){a[b]=this.targetObject[this.propertyName]}_getValue_array(a,b){let c=this.resolvedProperty;for(let d=0,e=c.length;d!==e;++d)a[b++]=c[d]}_getValue_arrayElement(a,b){a[b]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(a,b){this.resolvedProperty.toArray(a,b)}_setValue_direct(a,b){this.targetObject[this.propertyName]=a[b]}_setValue_direct_setNeedsUpdate(a,b){this.targetObject[this.propertyName]=a[b],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(a,b){this.targetObject[this.propertyName]=a[b],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(a,b){let c=this.resolvedProperty;for(let d=0,e=c.length;d!==e;++d)c[d]=a[b++]}_setValue_array_setNeedsUpdate(a,b){let c=this.resolvedProperty;for(let d=0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(a,b){let c=this.resolvedProperty;for(let d=0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(a,b){this.resolvedProperty[this.propertyIndex]=a[b]}_setValue_arrayElement_setNeedsUpdate(a,b){this.resolvedProperty[this.propertyIndex]=a[b],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(a,b){this.resolvedProperty[this.propertyIndex]=a[b],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(a,b){this.resolvedProperty.fromArray(a,b)}_setValue_fromArray_setNeedsUpdate(a,b){this.resolvedProperty.fromArray(a,b),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(a,b){this.resolvedProperty.fromArray(a,b),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(a,b){this.bind(),this.getValue(a,b)}_setValue_unbound(a,b){this.bind(),this.setValue(a,b)}bind(){let b=this.node,c=this.parsedPath,d=c.objectName,e=c.propertyName,f=c.propertyIndex;if(b||(b=a.findNode(this.rootNode,c.nodeName),this.node=b),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!b)return void I("PropertyBinding: No target node found for track: "+this.path+".");if(d){let a=c.objectIndex;switch(d){case"materials":if(!b.material)return void J("PropertyBinding: Can not bind to material as node does not have a material.",this);if(!b.material.materials)return void J("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);b=b.material.materials;break;case"bones":if(!b.skeleton)return void J("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);b=b.skeleton.bones;for(let c=0;c<b.length;c++)if(b[c].name===a){a=c;break}break;case"map":if("map"in b){b=b.map;break}if(!b.material)return void J("PropertyBinding: Can not bind to material as node does not have a material.",this);if(!b.material.map)return void J("PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);b=b.material.map;break;default:if(void 0===b[d])return void J("PropertyBinding: Can not bind to objectName of node undefined.",this);b=b[d]}if(void 0!==a){if(void 0===b[a])return void J("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,b);b=b[a]}}let g=b[e];if(void 0===g)return void J("PropertyBinding: Trying to update property for track: "+c.nodeName+"."+e+" but it wasn't found.",b);let h=this.Versioning.None;this.targetObject=b,!0===b.isMaterial?h=this.Versioning.NeedsUpdate:!0===b.isObject3D&&(h=this.Versioning.MatrixWorldNeedsUpdate);let i=this.BindingType.Direct;if(void 0!==f){if("morphTargetInfluences"===e){if(!b.geometry)return void J("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!b.geometry.morphAttributes)return void J("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==b.morphTargetDictionary[f]&&(f=b.morphTargetDictionary[f])}i=this.BindingType.ArrayElement,this.resolvedProperty=g,this.propertyIndex=f}else void 0!==g.fromArray&&void 0!==g.toArray?(i=this.BindingType.HasFromToArray,this.resolvedProperty=g):Array.isArray(g)?(i=this.BindingType.EntireArray,this.resolvedProperty=g):this.propertyName=e;this.getValue=this.GetterByBindingType[i],this.setValue=this.SetterByBindingTypeAndVersioning[i][h]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}).Composite=fe,ff.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},ff.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},ff.prototype.GetterByBindingType=[ff.prototype._getValue_direct,ff.prototype._getValue_array,ff.prototype._getValue_arrayElement,ff.prototype._getValue_toArray],ff.prototype.SetterByBindingTypeAndVersioning=[[ff.prototype._setValue_direct,ff.prototype._setValue_direct_setNeedsUpdate,ff.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ff.prototype._setValue_array,ff.prototype._setValue_array_setNeedsUpdate,ff.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ff.prototype._setValue_arrayElement,ff.prototype._setValue_arrayElement_setNeedsUpdate,ff.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ff.prototype._setValue_fromArray,ff.prototype._setValue_fromArray_setNeedsUpdate,ff.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],fg=class extends d1{constructor(a,b,c=1){super(a,b),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=c}copy(a){return super.copy(a),this.meshPerAttribute=a.meshPerAttribute,this}clone(a){let b=super.clone(a);return b.meshPerAttribute=this.meshPerAttribute,b}toJSON(a){let b=super.toJSON(a);return b.isInstancedInterleavedBuffer=!0,b.meshPerAttribute=this.meshPerAttribute,b}},fh=class a{constructor(b,c,d,e){a.prototype.isMatrix2=!0,this.elements=[1,0,0,1],void 0!==b&&this.set(b,c,d,e)}identity(){return this.set(1,0,0,1),this}fromArray(a,b=0){for(let c=0;c<4;c++)this.elements[c]=a[c+b];return this}set(a,b,c,d){let e=this.elements;return e[0]=a,e[2]=b,e[1]=c,e[3]=d,this}},"u">typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"181"}}))});function fj(a,b=0){let c=0xdeadbeef^b,d=0x41c6ce57^b;if(a instanceof Array)for(let b=0,e;b<a.length;b++)c=Math.imul(c^(e=a[b]),0x9e3779b1),d=Math.imul(d^e,0x5f356495);else for(let b=0,e;b<a.length;b++)c=Math.imul(c^(e=a.charCodeAt(b)),0x9e3779b1),d=Math.imul(d^e,0x5f356495);return c=Math.imul(c^c>>>16,0x85ebca6b)^Math.imul(d^d>>>13,0xc2b2ae35),0x100000000*(2097151&(d=Math.imul(d^d>>>16,0x85ebca6b)^Math.imul(c^c>>>13,0xc2b2ae35)))+(c>>>0)}function fk(a){if(/[iu]?vec\d/.test(a))return a.startsWith("ivec")?Int32Array:a.startsWith("uvec")?Uint32Array:Float32Array;if(/mat\d/.test(a)||/float/.test(a))return Float32Array;if(/uint/.test(a))return Uint32Array;if(/int/.test(a))return Int32Array;throw Error(`THREE.NodeUtils: Unsupported type: ${a}`)}function fl(a){return/float|int|uint/.test(a)?1:/vec2/.test(a)?2:/vec3/.test(a)?3:/vec4/.test(a)||/mat2/.test(a)?4:/mat3/.test(a)?9:/mat4/.test(a)?16:void J("TSL: Unsupported type:",a)}function fm(a){if(null==a)return null;let b=typeof a;return!0===a.isNode?"node":"number"===b?"float":"boolean"===b?"bool":"string"===b?"string":"function"===b?"shader":!0===a.isVector2?"vec2":!0===a.isVector3?"vec3":!0===a.isVector4?"vec4":!0===a.isMatrix2?"mat2":!0===a.isMatrix3?"mat3":!0===a.isMatrix4?"mat4":!0===a.isColor?"color":a instanceof ArrayBuffer?"ArrayBuffer":null}function fn(a,...b){let c=a?a.slice(-4):void 0;return 1===b.length&&("vec2"===c?b=[b[0],b[0]]:"vec3"===c?b=[b[0],b[0],b[0]]:"vec4"===c&&(b=[b[0],b[0],b[0],b[0]])),"color"===a?new de(...b):"vec2"===c?new bO(...b):"vec3"===c?new bQ(...b):"vec4"===c?new b3(...b):"mat2"===c?new fh(...b):"mat3"===c?new bT(...b):"mat4"===c?new cx(...b):"bool"===a?b[0]||!1:"float"===a||"int"===a||"uint"===a?b[0]||0:"string"===a?b[0]||"":"ArrayBuffer"===a?fq(b[0]):null}function fo(a){let b=gb.get(a);return void 0===b&&(b={},gb.set(a,b)),b}function fp(a){let b="",c=new Uint8Array(a);for(let a=0;a<c.length;a++)b+=String.fromCharCode(c[a]);return btoa(b)}function fq(a){return Uint8Array.from(atob(a),a=>a.charCodeAt(0)).buffer}function fr(a,b){if(gA.has(a))return void I(`TSL: Redefinition of method chaining '${a}'.`);if("function"!=typeof b)throw Error(`THREE.TSL: Node element ${a} is not a function`);gA.set(a,b),"assign"!==a&&(gm.prototype[a]=function(...a){return this.isStackNode?this.addToStack(b(...a)):b(this,...a)},gm.prototype[a+"Assign"]=function(...a){return this.isStackNode?this.assign(a[0],b(...a)):this.assign(b(this,...a))})}function fs(a,b,c){gC[a]=gC[b]=gC[c]={get(){this._cache=this._cache||{};let b=this._cache[a];return void 0===b&&(b=new gs(this,a),this._cache[a]=b),b},set(b){this[a].assign(g0(b))}};let d=a.toUpperCase(),e=b.toUpperCase(),f=c.toUpperCase();gm.prototype["set"+d]=gm.prototype["set"+e]=gm.prototype["set"+f]=function(b){let c=gB(a);return new gt(this,c,g0(b))},gm.prototype["flip"+d]=gm.prototype["flip"+e]=gm.prototype["flip"+f]=function(){let b=gB(a);return new gu(this,b)}}function ft(a,b){return new gN(a,b)}function fu(a,b=null){let c=new g8(a,b);return new Proxy(()=>{},{apply:(a,b,d)=>c.call(...d),get:(a,b,d)=>Reflect.get(c,b,d),set:(a,b,d,e)=>Reflect.set(c,b,d,e)})}function fv(a){return gz&&gz.addToStack(a),a}function fw(a,b){return I('TSL: "label()" has been deprecated. Use "setName()" instead.'),jX(a,b)}function fx(a,b=!0){return I('TSL: "cache()" has been deprecated. Use "isolate()" instead.'),ks(a).setParent(b)}function fy(a,b="",c=null){return(a=g0(a)).before(new kG(a,b,c))}function fz(a){I("TSL: AddNodeElement has been removed in favor of tree-shaking. Trying add",a)}function fA(a){let b=a.target;b.removeEventListener("dispose",fA);let c=oG.get(b);void 0!==c&&(oG.delete(b),c.dispose())}function fB(a,b){303===b?a.mapping=301:304===b&&(a.mapping=302)}function fC(a,b){let c=new b4(a,b,{magFilter:av,minFilter:av,generateMipmaps:!1,type:aG,format:aO,colorSpace:bs});return c.texture.mapping=306,c.texture.name="PMREM.cubeUv",c.texture.isPMREMTexture=!0,c.scissorTest=!0,c}function fD(a,b,c,d,e){a.viewport.set(b,c,d,e),a.scissor.set(b,c,d,e)}function fE(a){let b=new ot;return b.depthTest=!1,b.depthWrite=!1,b.blending=0,b.name=`PMREM_${a}`,b}function fF(a){let b=fE("cubemap");return b.fragmentNode=mc(a,qd),b}function fG(a){let b=fE("equirect");return b.fragmentNode=kP(a,oE(qd),0),b}function fH(a){return null===a.index?a.attributes.position.version:a.index.version}function fI(a){let b=[],c=a.index,d=a.attributes.position;if(null!==c){let a=c.array;for(let c=0,d=a.length;c<d;c+=3){let d=a[c+0],e=a[c+1],f=a[c+2];b.push(d,e,e,f,f,d)}}else{let a=d.array;for(let c=0,d=a.length/3-1;c<d;c+=3){let a=c+0,d=c+1,e=c+2;b.push(a,d,d,e,e,a)}}let e=new(F(b)?dq:dp)(b,1);return e.version=fH(a),e}function fJ(a,b){return a.groupOrder===b.groupOrder?a.renderOrder===b.renderOrder?a.z===b.z?a.id-b.id:a.z-b.z:a.renderOrder-b.renderOrder:a.groupOrder-b.groupOrder}function fK(a,b){return a.groupOrder===b.groupOrder?a.renderOrder===b.renderOrder?a.z===b.z?a.id-b.id:b.z-a.z:a.renderOrder-b.renderOrder:a.groupOrder-b.groupOrder}function fL(a){return(a.transmission>0||a.transmissionNode&&a.transmissionNode.isNode)&&2===a.side&&!1===a.forceSinglePass}function fM(a){let{textures:b,activeCubeFace:c,activeMipmapLevel:d}=a,e=[c,d];for(let a of b)e.push(a.id);return f9(e)}function fN(a,b){for(let c=0;c<a.length;c++)if(a[c].name===b)return c;return -1}function fO(a){let b=sA.get(a);return void 0===b&&(b={},sA.set(a,b)),b}function fP(a,b=0){let c=fO(a),d=c[b];return void 0===d&&(c[b]=d=new cx,c[b].copy(a.matrixWorld)),d}function fQ(a){let b,c=a.context.getViewZ;return void 0!==c&&(b=c(this)),(b||lL.z).negate()}function fR(a,b,c){return I('TSL: "rangeFog( color, near, far )" is deprecated. Use "fog( color, rangeFogFactor( near, far ) )" instead.'),tg(a,te(b,c))}function fS(a,b){return I('TSL: "densityFog( color, density )" is deprecated. Use "fog( color, densityFogFactor( density ) )" instead.'),tg(a,tf(b))}function fT(a){t8||(t8=new WeakMap);let b=t8.get(a);return void 0===b&&t8.set(a,b={}),b}function fU(a){let b=fT(a);return b.shadowMatrix||(b.shadowMatrix=id("mat4").setGroup(ia).onRenderUpdate(b=>((!0!==a.castShadow||!1===b.renderer.shadowMap.enabled)&&(a.shadow.camera.coordinateSystem!==b.camera.coordinateSystem&&(a.shadow.camera.coordinateSystem=b.camera.coordinateSystem,a.shadow.camera.updateProjectionMatrix()),a.shadow.updateMatrices(a)),a.shadow.matrix)))}function fV(a,b=lJ){let c=fU(a).mul(b);return c.xyz.div(c.w)}function fW(a){let b=fT(a);return b.position||(b.position=id(new bQ).setGroup(ia).onRenderUpdate((b,c)=>c.value.setFromMatrixPosition(a.matrixWorld)))}function fX(a){let b=fT(a);return b.targetPosition||(b.targetPosition=id(new bQ).setGroup(ia).onRenderUpdate((b,c)=>c.value.setFromMatrixPosition(a.target.matrixWorld)))}function fY(a){let b=fT(a);return b.viewPosition||(b.viewPosition=id(new bQ).setGroup(ia).onRenderUpdate(({camera:b},c)=>{c.value=c.value||new bQ,c.value.setFromMatrixPosition(a.matrixWorld),c.value.applyMatrix4(b.matrixWorldInverse)}))}function fZ(a,b){null===b?a.matrixWorld.copy(a.matrix):a.matrixWorld.multiplyMatrices(b.matrixWorld,a.matrix),a.matrixWorldInverse.copy(a.matrixWorld).invert()}function f$(a){let b=this._controllerInputSources.indexOf(a.inputSource);if(-1===b)return;let c=this._controllers[b];if(void 0!==c){let b=this.getReferenceSpace();c.update(a.inputSource,a.frame,b),c.dispatchEvent({type:a.type,data:a.inputSource})}}function f_(){let a=this._session,b=this._renderer;a.removeEventListener("select",this._onSessionEvent),a.removeEventListener("selectstart",this._onSessionEvent),a.removeEventListener("selectend",this._onSessionEvent),a.removeEventListener("squeeze",this._onSessionEvent),a.removeEventListener("squeezestart",this._onSessionEvent),a.removeEventListener("squeezeend",this._onSessionEvent),a.removeEventListener("end",this._onSessionEnd),a.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let a=0;a<this._controllers.length;a++){let b=this._controllerInputSources[a];null!==b&&(this._controllerInputSources[a]=null,this._controllers[a].disconnect(b))}if(this._currentDepthNear=null,this._currentDepthFar=null,b._resetXRState(),this._session=null,this._xrRenderTarget=null,this._glBinding=null,this._glBaseLayer=null,this._glProjLayer=null,!0===this._sessionUsesLayers)for(let a of this._layers)a.renderTarget=new xa(a.pixelwidth,a.pixelheight,{format:aO,type:az,depthTexture:new el(a.pixelwidth,a.pixelheight,a.stencilBuffer?aJ:aE,void 0,void 0,void 0,void 0,void 0,void 0,a.stencilBuffer?aQ:aP),stencilBuffer:a.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),a.renderTarget.isXRRenderTarget=!1,a.plane.material=a.material,a.material.map=a.renderTarget.texture,a.material.map.offset.y=1,a.material.map.repeat.y=-1,delete a.xrlayer;this.isPresenting=!1,this._useMultiview=!1,b._animation.stop(),b._animation.setAnimationLoop(this._currentAnimationLoop),b._animation.setContext(this._currentAnimationContext),b._animation.start(),b.setPixelRatio(this._currentPixelRatio),b.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function f0(a){let b=this._controllers,c=this._controllerInputSources;for(let d=0;d<a.removed.length;d++){let e=a.removed[d],f=c.indexOf(e);f>=0&&(c[f]=null,b[f].disconnect(e))}for(let d=0;d<a.added.length;d++){let e=a.added[d],f=c.indexOf(e);if(-1===f){for(let a=0;a<b.length;a++)if(a>=c.length){c.push(e),f=a;break}else if(null===c[a]){c[a]=e,f=a;break}if(-1===f)break}let g=b[f];g&&g.connect(e)}}function f1(a){return"quad"===a.type?this._glBinding.createQuadLayer({transform:new XRRigidTransform(a.translation,a.quaternion),width:a.width/2,height:a.height/2,space:this._referenceSpace,viewPixelWidth:a.pixelwidth,viewPixelHeight:a.pixelheight,clearOnAccess:!1}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(a.translation,a.quaternion),radius:a.radius,centralAngle:a.centralAngle,aspectRatio:a.aspectRatio,space:this._referenceSpace,viewPixelWidth:a.pixelwidth,viewPixelHeight:a.pixelheight,clearOnAccess:!1})}function f2(a,b){if(void 0===b)return;let c=this._cameraXR,d=this._renderer,e=d.backend,f=this._glBaseLayer,g=this.getReferenceSpace(),h=b.getViewerPose(g);if(this._xrFrame=b,null!==h){let a=h.views;null!==this._glBaseLayer&&e.setXRTarget(f.framebuffer);let b=!1;a.length!==c.cameras.length&&(c.cameras.length=0,b=!0);for(let d=0;d<a.length;d++){let g=a[d],h;if(!0===this._supportsLayers){let a=this._glBinding.getViewSubImage(this._glProjLayer,g);h=a.viewport,0===d&&e.setXRRenderTargetTextures(this._xrRenderTarget,a.colorTexture,this._glProjLayer.ignoreDepthValues&&!this._useMultiview?void 0:a.depthStencilTexture)}else h=f.getViewport(g);let i=this._cameras[d];void 0===i&&((i=new dV).layers.enable(d),i.viewport=new b3,this._cameras[d]=i),i.matrix.fromArray(g.transform.matrix),i.matrix.decompose(i.position,i.quaternion,i.scale),i.projectionMatrix.fromArray(g.projectionMatrix),i.projectionMatrixInverse.copy(i.projectionMatrix).invert(),i.viewport.set(h.x,h.y,h.width,h.height),0===d&&(c.matrix.copy(i.matrix),c.matrix.decompose(c.position,c.quaternion,c.scale)),!0===b&&c.cameras.push(i)}d.setOutputRenderTarget(this._xrRenderTarget)}for(let a=0;a<this._controllers.length;a++){let c=this._controllerInputSources[a],d=this._controllers[a];null!==c&&void 0!==d&&d.update(c,b,g)}this._currentAnimationLoop&&this._currentAnimationLoop(a,b),b.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:b}),this._xrFrame=null}function f3(a){return a.isDataTexture?a.image.data:"u">typeof HTMLImageElement&&a instanceof HTMLImageElement||"u">typeof HTMLCanvasElement&&a instanceof HTMLCanvasElement||"u">typeof ImageBitmap&&a instanceof ImageBitmap||"u">typeof OffscreenCanvas&&a instanceof OffscreenCanvas?a:a.data}function f4(a,b=null){let c=a.format,d=a.type,e=a.colorSpace,f=bX.getTransfer(e),g;if(!0===a.isCompressedTexture||!0===a.isCompressedArrayTexture)switch(c){case aX:case aY:g="srgb"===f?ya.BC1RGBAUnormSRGB:ya.BC1RGBAUnorm;break;case aZ:g="srgb"===f?ya.BC2RGBAUnormSRGB:ya.BC2RGBAUnorm;break;case a$:g="srgb"===f?ya.BC3RGBAUnormSRGB:ya.BC3RGBAUnorm;break;case bn:g=ya.BC4RUnorm;break;case bo:g=ya.BC4RSnorm;break;case bp:g=ya.BC5RGUnorm;break;case bq:g=ya.BC5RGSnorm;break;case bk:g="srgb"===f?ya.BC7RGBAUnormSRGB:ya.BC7RGBAUnorm;break;case a4:case a3:g="srgb"===f?ya.ETC2RGB8UnormSRGB:ya.ETC2RGB8Unorm;break;case a5:g="srgb"===f?ya.ETC2RGBA8UnormSRGB:ya.ETC2RGBA8Unorm;break;case a6:g="srgb"===f?ya.ASTC4x4UnormSRGB:ya.ASTC4x4Unorm;break;case a7:g="srgb"===f?ya.ASTC5x4UnormSRGB:ya.ASTC5x4Unorm;break;case a8:g="srgb"===f?ya.ASTC5x5UnormSRGB:ya.ASTC5x5Unorm;break;case a9:g="srgb"===f?ya.ASTC6x5UnormSRGB:ya.ASTC6x5Unorm;break;case ba:g="srgb"===f?ya.ASTC6x6UnormSRGB:ya.ASTC6x6Unorm;break;case bb:g="srgb"===f?ya.ASTC8x5UnormSRGB:ya.ASTC8x5Unorm;break;case bc:g="srgb"===f?ya.ASTC8x6UnormSRGB:ya.ASTC8x6Unorm;break;case bd:g="srgb"===f?ya.ASTC8x8UnormSRGB:ya.ASTC8x8Unorm;break;case be:g="srgb"===f?ya.ASTC10x5UnormSRGB:ya.ASTC10x5Unorm;break;case bf:g="srgb"===f?ya.ASTC10x6UnormSRGB:ya.ASTC10x6Unorm;break;case bg:g="srgb"===f?ya.ASTC10x8UnormSRGB:ya.ASTC10x8Unorm;break;case bh:g="srgb"===f?ya.ASTC10x10UnormSRGB:ya.ASTC10x10Unorm;break;case bi:g="srgb"===f?ya.ASTC12x10UnormSRGB:ya.ASTC12x10Unorm;break;case bj:g="srgb"===f?ya.ASTC12x12UnormSRGB:ya.ASTC12x12Unorm;break;case aO:g="srgb"===f?ya.RGBA8UnormSRGB:ya.RGBA8Unorm;break;default:J("WebGPURenderer: Unsupported texture format.",c)}else switch(c){case aO:switch(d){case aA:g=ya.RGBA8Snorm;break;case aB:g=ya.RGBA16Sint;break;case aC:g=ya.RGBA16Uint;break;case aE:g=ya.RGBA32Uint;break;case aD:g=ya.RGBA32Sint;break;case az:g="srgb"===f?ya.RGBA8UnormSRGB:ya.RGBA8Unorm;break;case aG:g=ya.RGBA16Float;break;case aF:g=ya.RGBA32Float;break;default:J("WebGPURenderer: Unsupported texture type with RGBAFormat.",d)}break;case aN:switch(d){case aK:g=ya.RGB9E5UFloat;break;case aL:g=ya.RG11B10UFloat;break;default:J("WebGPURenderer: Unsupported texture type with RGBFormat.",d)}break;case aR:switch(d){case aA:g=ya.R8Snorm;break;case aB:g=ya.R16Sint;break;case aC:g=ya.R16Uint;break;case aE:g=ya.R32Uint;break;case aD:g=ya.R32Sint;break;case az:g=ya.R8Unorm;break;case aG:g=ya.R16Float;break;case aF:g=ya.R32Float;break;default:J("WebGPURenderer: Unsupported texture type with RedFormat.",d)}break;case aT:switch(d){case aA:g=ya.RG8Snorm;break;case aB:g=ya.RG16Sint;break;case aC:g=ya.RG16Uint;break;case aE:g=ya.RG32Uint;break;case aD:g=ya.RG32Sint;break;case az:g=ya.RG8Unorm;break;case aG:g=ya.RG16Float;break;case aF:g=ya.RG32Float;break;default:J("WebGPURenderer: Unsupported texture type with RGFormat.",d)}break;case aP:switch(d){case aC:g=ya.Depth16Unorm;break;case aE:g=ya.Depth24Plus;break;case aF:g=ya.Depth32Float;break;default:J("WebGPURenderer: Unsupported texture type with DepthFormat.",d)}break;case aQ:switch(d){case aJ:g=ya.Depth24PlusStencil8;break;case aF:b&&!1===b.features.has(yp.Depth32FloatStencil8)&&J('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),g=ya.Depth32FloatStencil8;break;default:J("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",d)}break;case aS:switch(d){case aD:g=ya.R32Sint;break;case aE:g=ya.R32Uint;break;default:J("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",d)}break;case aU:switch(d){case aD:g=ya.RG32Sint;break;case aE:g=ya.RG32Uint;break;default:J("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",d)}break;case aW:switch(d){case aD:g=ya.RGBA32Sint;break;case aE:g=ya.RGBA32Uint;break;default:J("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",d)}break;default:J("WebGPURenderer: Unsupported texture format.",c)}return g}var f5,f6,f7,f8,f9,ga,gb,gc,gd,ge,gf,gg,gh,gi,gj,gk,gl,gm,gn,go,gp,gq,gr,gs,gt,gu,gv,gw,gx,gy,gz,gA,gB,gC,gD,gE,gF,gG,gH,gI,gJ,gK,gL,gM,gN,gO,gP,gQ,gR,gS,gT,gU,gV,gW,gX,gY,gZ,g$,g_,g0,g1,g2,g3,g4,g5,g6,g7,g8,g9,ha,hb,hc,hd,he,hf,hg,hh,hi,hj,hk,hl,hm,hn,ho,hp,hq,hr,hs,ht,hu,hv,hw,hx,hy,hz,hA,hB,hC,hD,hE,hF,hG,hH,hI,hJ,hK,hL,hM,hN,hO,hP,hQ,hR,hS,hT,hU,hV,hW,hX,hY,hZ,h$,h_,h0,h1,h2,h3,h4,h5,h6,h7,h8,h9,ia,ib,ic,id,ie,ig,ih,ii,ij,ik,il,im,io,ip,iq,ir,is,it,iu,iv,iw,ix,iy,iz,iA,iB,iC,iD,iE,iF,iG,iH,iI,iJ,iK,iL,iM,iN,iO,iP,iQ,iR,iS,iT,iU,iV,iW,iX,iY,iZ,i$,i_,i0,i1,i2,i3,i4,i5,i6,i7,i8,i9,ja,jb,jc,jd,je,jf,jg,jh,ji,jj,jk,jl,jm,jn,jo,jp,jq,jr,js,jt,ju,jv,jw,jx,jy,jz,jA,jB,jC,jD,jE,jF,jG,jH,jI,jJ,jK,jL,jM,jN,jO,jP,jQ,jR,jS,jT,jU,jV,jW,jX,jY,jZ,j$,j_,j0,j1,j2,j3,j4,j5,j6,j7,j8,j9,ka,kb,kc,kd,ke,kf,kg,kh,ki,kj,kk,kl,km,kn,ko,kp,kq,kr,ks,kt,ku,kv,kw,kx,ky,kz,kA,kB,kC,kD,kE,kF,kG,kH,kI,kJ,kK,kL,kM,kN,kO,kP,kQ,kR,kS,kT,kU,kV,kW,kX,kY,kZ,k$,k_,k0,k1,k2,k3,k4,k5,k6,k7,k8,k9,la,lb,lc,ld,le,lf,lg,lh,li,lj,lk,ll,lm,ln,lo,lp,lq,lr,ls,lt,lu,lv,lw,lx,ly,lz,lA,lB,lC,lD,lE,lF,lG,lH,lI,lJ,lK,lL,lM,lN,lO,lP,lQ,lR,lS,lT,lU,lV,lW,lX,lY,lZ,l$,l_,l0,l1,l2,l3,l4,l5,l6,l7,l8,l9,ma,mb,mc,md,me,mf,mg,mh,mi,mj,mk,ml,mm,mn,mo,mp,mq,mr,ms,mt,mu,mv,mw,mx,my,mz,mA,mB,mC,mD,mE,mF,mG,mH,mI,mJ,mK,mL,mM,mN,mO,mP,mQ,mR,mS,mT,mU,mV,mW,mX,mY,mZ,m$,m_,m0,m1,m2,m3,m4,m5,m6,m7,m8,m9,na,nb,nc,nd,ne,nf,ng,nh,ni,nj,nk,nl,nm,nn,no,np,nq,nr,ns,nt,nu,nv,nw,nx,ny,nz,nA,nB,nC,nD,nE,nF,nG,nH,nI,nJ,nK,nL,nM,nN,nO,nP,nQ,nR,nS,nT,nU,nV,nW,nX,nY,nZ,n$,n_,n0,n1,n2,n3,n4,n5,n6,n7,n8,n9,oa,ob,oc,od,oe,of,og,oh,oi,oj,ok,ol,om,on,oo,op,oq,or,os,ot,ou,ov,ow,ox,oy,oz,oA,oB,oC,oD,oE,oF,oG,oH,oI,oJ,oK,oL,oM,oN,oO,oP,oQ,oR,oS,oT,oU,oV,oW,oX,oY,oZ,o$,o_,o0,o1,o2,o3,o4,o5,o6,o7,o8,o9,pa,pb,pc,pd,pe,pf,pg,ph,pi,pj,pk,pl,pm,pn,po,pp,pq,pr,ps,pt,pu,pv,pw,px,py,pz,pA,pB,pC,pD,pE,pF,pG,pH,pI,pJ,pK,pL,pM,pN,pO,pP,pQ,pR,pS,pT,pU,pV,pW,pX,pY,pZ,p$,p_,p0,p1,p2,p3,p4,p5,p6,p7,p8,p9,qa,qb,qc,qd,qe,qf,qg,qh,qi,qj,qk,ql,qm,qn,qo,qp,qq,qr,qs,qt,qu,qv,qw,qx,qy,qz,qA,qB,qC,qD,qE,qF,qG,qH,qI,qJ,qK,qL,qM,qN,qO,qP,qQ,qR,qS,qT,qU,qV,qW,qX,qY,qZ,q$,q_,q0,q1,q2,q3,q4,q5,q6,q7,q8,q9,ra,rb,rc,rd,re,rf,rg,rh,ri,rj,rk,rl,rm,rn,ro,rp,rq,rr,rs,rt,ru,rv,rw,rx,ry,rz,rA,rB,rC,rD,rE,rF,rG,rH,rI,rJ,rK,rL,rM,rN,rO,rP,rQ,rR,rS,rT,rU,rV,rW,rX,rY,rZ,r$,r_,r0,r1,r2,r3,r4,r5,r6,r7,r8,r9,sa,sb,sc,sd,se,sf,sg,sh,si,sj,sk,sl,sm,sn,so,sp,sq,sr,ss,st,su,sv,sw,sx,sy,sz,sA,sB,sC,sD,sE,sF,sG,sH,sI,sJ,sK,sL,sM,sN,sO,sP,sQ,sR,sS,sT,sU,sV,sW,sX,sY,sZ,s$,s_,s0,s1,s2,s3,s4,s5,s6,s7,s8,s9,ta,tb,tc,td,te,tf,tg,th,ti,tj,tk,tl,tm,tn,to,tp,tq,tr,ts,tt,tu,tv,tw,tx,ty,tz,tA,tB,tC,tD,tE,tF,tG,tH,tI,tJ,tK,tL,tM,tN,tO,tP,tQ,tR,tS,tT,tU,tV,tW,tX,tY,tZ,t$,t_,t0,t1,t2,t3,t4,t5,t6,t7,t8,t9,ua,ub,uc,ud,ue,uf,ug,uh,ui,uj,uk,ul,um,un,uo,up,uq,ur,us,ut,uu,uv,uw,ux,uy,uz,uA,uB,uC,uD,uE,uF,uG,uH,uI,uJ,uK,uL,uM,uN,uO,uP,uQ,uR,uS,uT,uU,uV,uW,uX,uY,uZ,u$,u_,u0,u1,u2,u3,u4,u5,u6,u7,u8,u9,va,vb,vc,vd,ve,vf,vg,vh,vi,vj,vk,vl,vm,vn,vo,vp,vq,vr,vs,vt,vu,vv,vw,vx,vy,vz,vA,vB,vC,vD,vE,vF,vG,vH,vI,vJ,vK,vL,vM,vN,vO,vP,vQ,vR,vS,vT,vU,vV,vW,vX,vY,vZ,v$,v_,v0,v1,v2,v3,v4,v5,v6,v7,v8,v9,wa,wb,wc,wd,we,wf,wg,wh,wi,wj,wk,wl,wm,wn,wo,wp,wq,wr,ws,wt,wu,wv,ww,wx,wy,wz,wA,wB,wC,wD,wE,wF,wG,wH,wI,wJ,wK,wL,wM,wN,wO,wP,wQ,wR,wS,wT,wU,wV,wW,wX,wY,wZ,w$,w_,w0,w1,w2,w3,w4,w5,w6,w7,w8,w9,xa,xb,xc,xd,xe,xf,xg,xh,xi,xj,xk,xl,xm,xn,xo,xp,xq,xr,xs,xt,xu,xv,xw,xx,xy,xz,xA,xB,xC,xD,xE,xF,xG,xH,xI,xJ,xK,xL,xM,xN,xO,xP,xQ,xR,xS,xT,xU,xV,xW,xX,xY,xZ,x$,x_,x0,x1,x2,x3,x4,x5,x6,x7,x8,x9,ya,yb,yc,yd,ye,yf,yg,yh,yi,yj,yk,yl,ym,yn,yo,yp,yq,yr,ys,yt,yu,yv,yw,yx,yy,yz,yA,yB,yC,yD,yE,yF,yG,yH,yI,yJ,yK,yL,yM,yN,yO,yP,yQ,yR,yS,yT,yU,yV,yW,yX,yY,yZ,y$,y_,y0,y1,y2,y3,y4,y5,y6,y7,y8,y9,za,zb,zc,zd,ze,zf,zg,zh,zi,zj,zk,zl,zm,zn,zo,zp,zq,zr,zs,zt,zu,zv,zw,zx,zy,zz,zA,zB,zC,zD,zE,zF,zG,zH,zI,zJ,zK,zL,zM,zN,zO,zP,zQ,zR,zS,zT,zU,zV,zW,zX,zY,zZ,z$,z_,z0,z1,z2,z3,z4,z5,z6,z7,z8,z9,Aa,Ab,Ac,Ad,Ae,Af,Ag,Ah,Ai,Aj,Ak,Al,Am,An,Ao,Ap,Aq,Ar,As,At,Au,Av,Aw,Ax,Ay,Az,AA,AB,AC,AD,AE,AF,AG,AH,AI,AJ,AK,AL,AM,AN,AO,AP,AQ,AR,AS,AT,AU,AV,AW,AX,AY,AZ,A$,A_,A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,Ba,Bb,Bc,Bd,Be,Bf,Bg,Bh,Bi,Bj,Bk,Bl,Bm,Bn,Bo,Bp,Bq,Br,Bs,Bt,Bu,Bv,Bw,Bx,By,Bz,BA,BB,BC,BD,BE,BF,BG,BH,BI,BJ,BK,BL,BM,BN,BO,BP,BQ,BR,BS,BT,BU,BV,BW,BX,BY,BZ,B$,B_,B0,B1,B2,B3,B4,B5,B6,B7,B8,B9,Ca,Cb,Cc,Cd,Ce,Cf,Cg,Ch,Ci,Cj,Ck,Cl,Cm,Cn,Co,Cp,Cq,Cr,Cs,Ct,Cu,Cv,Cw,Cx,Cy,Cz,CA,CB,CC,CD,CE,CF,CG,CH,CI,CJ,CK,CL,CM,CN,CO,CP,CQ,CR,CS,CT,CU,CV,CW,CX,CY,CZ,C$,C_,C0,C1,C2,C3,C4,C5,C6,C7,C8,C9,Da,Db,Dc,Dd,De,Df,Dg,Dh,Di,Dj,Dk,Dl,Dm,Dn,Do,Dp,Dq,Dr,Ds,Dt,Du,Dv,Dw,Dx,Dy,Dz,DA,DB,DC,DD,DE,DF,DG,DH,DI,DJ,DK,DL,DM,DN,DO,DP,DQ,DR,DS,DT,DU,DV,DW,DX,DY,DZ,D$,D_,D0,D1,D2,D3,D4,D5,D6,D7,D8,D9,Ea,Eb,Ec,Ed,Ee,Ef,Eg,Eh,Ei,Ej,Ek,El,Em,En,Eo,Ep,Eq,Er,Es,Et,Eu,Ev,Ew,Ex,Ey,Ez,EA,EB,EC,ED,EE,EF,EG,EH,EI,EJ,EK,EL,EM,EN,EO,EP,EQ,ER,ES,ET,EU,EV,EW,EX,EY,EZ,E$,E_,E0,E1,E2,E3,E4,E5,E6,E7,E8,E9,Fa,Fb,Fc,Fd,Fe,Ff,Fg,Fh,Fi,Fj,Fk,Fl,Fm,Fn,Fo,Fp,Fq,Fr,Fs,Ft,Fu,Fv,Fw,Fx,Fy,Fz,FA,FB,FC,FD,FE,FF,FG,FH,FI,FJ,FK,FL,FM,FN,FO,FP,FQ,FR,FS,FT,FU,FV,FW,FX,FY,FZ,F$,F_,F0,F1,F2,F3,F4,F5,F6,F7,F8,F9,Ga,Gb,Gc,Gd,Ge,Gf,Gg,Gh,Gi,Gj,Gk,Gl,Gm,Gn,Go,Gp,Gq,Gr,Gs,Gt,Gu,Gv,Gw,Gx,Gy,Gz,GA,GB,GC,GD,GE,GF,GG,GH,GI,GJ,GK,GL,GM,GN,GO,GP,GQ,GR,GS,GT,GU,GV,GW,GX,GY,GZ,G$,G_,G0,G1,G2,G3,G4,G5,G6,G7,G8,G9,Ha,Hb,Hc,Hd,He,Hf,Hg,Hh,Hi,Hj,Hk,Hl,Hm,Hn,Ho,Hp,Hq,Hr,Hs,Ht,Hu,Hv,Hw,Hx,Hy,Hz,HA,HB,HC,HD,HE,HF,HG,HH,HI,HJ,HK,HL,HM,HN,HO,HP,HQ,HR,HS,HT,HU,HV,HW,HX,HY,HZ,H$,H_,H0,H1,H2,H3,H4,H5,H6,H7,H8,H9,Ia,Ib,Ic,Id,Ie,If,Ig,Ih,Ii,Ij,Ik,Il,Im,In,Io,Ip,Iq,Ir,Is,It,Iu,Iv,Iw,Ix,Iy,Iz,IA,IB,IC,ID,IE,IF,IG=D(()=>{fi(),f5="alphaMap.alphaTest.anisotropy.anisotropyMap.anisotropyRotation.aoMap.aoMapIntensity.attenuationColor.attenuationDistance.bumpMap.clearcoat.clearcoatMap.clearcoatNormalMap.clearcoatNormalScale.clearcoatRoughness.color.dispersion.displacementMap.emissive.emissiveIntensity.emissiveMap.envMap.envMapIntensity.gradientMap.ior.iridescence.iridescenceIOR.iridescenceMap.iridescenceThicknessMap.lightMap.lightMapIntensity.map.matcap.metalness.metalnessMap.normalMap.normalScale.opacity.roughness.roughnessMap.sheen.sheenColor.sheenColorMap.sheenRoughnessMap.shininess.specular.specularColor.specularColorMap.specularIntensity.specularIntensityMap.specularMap.thickness.transmission.transmissionMap".split("."),f6=new WeakMap,f7=class{constructor(a){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(a),this.hasAnimation=!0===a.object.isSkinnedMesh,this.refreshUniforms=f5,this.renderId=0}firstInitialization(a){return!1===this.renderObjects.has(a)&&(this.getRenderObjectData(a),!0)}needsVelocity(a){let b=a.getMRT();return null!==b&&b.has("velocity")}getRenderObjectData(a){let b=this.renderObjects.get(a);if(void 0===b){let{geometry:c,material:d,object:e}=a;if(b={material:this.getMaterialData(d),geometry:{id:c.id,attributes:this.getAttributesData(c.attributes),indexVersion:c.index?c.index.version:null,drawRange:{start:c.drawRange.start,count:c.drawRange.count}},worldMatrix:e.matrixWorld.clone()},e.center&&(b.center=e.center.clone()),e.morphTargetInfluences&&(b.morphTargetInfluences=e.morphTargetInfluences.slice()),null!==a.bundle&&(b.version=a.bundle.version),b.material.transmission>0){let{width:c,height:d}=a.context;b.bufferWidth=c,b.bufferHeight=d}b.lights=this.getLightsData(a.lightsNode.getLights()),this.renderObjects.set(a,b)}return b}getAttributesData(a){let b={};for(let c in a)b[c]={version:a[c].version};return b}containsNode(a){let b=a.material;for(let a in b)if(b[a]&&b[a].isNode)return!0;return null!==a.renderer.overrideNodes.modelViewMatrix||null!==a.renderer.overrideNodes.modelNormalViewMatrix}getMaterialData(a){let b={};for(let c of this.refreshUniforms){let d=a[c];null!=d&&("object"==typeof d&&void 0!==d.clone?!0===d.isTexture?b[c]={id:d.id,version:d.version}:b[c]=d.clone():b[c]=d)}return b}equals(a,b){let{object:c,material:d,geometry:e}=a,f=this.getRenderObjectData(a);if(!0!==f.worldMatrix.equals(c.matrixWorld))return f.worldMatrix.copy(c.matrixWorld),!1;let g=f.material;for(let a in g){let b=g[a],c=d[a];if(void 0!==b.equals){if(!1===b.equals(c))return b.copy(c),!1}else if(!0===c.isTexture){if(b.id!==c.id||b.version!==c.version)return b.id=c.id,b.version=c.version,!1}else if(b!==c)return g[a]=c,!1}if(g.transmission>0){let{width:b,height:c}=a.context;if(f.bufferWidth!==b||f.bufferHeight!==c)return f.bufferWidth=b,f.bufferHeight=c,!1}let h=f.geometry,i=e.attributes,j=h.attributes,k=Object.keys(j),l=Object.keys(i);if(h.id!==e.id)return h.id=e.id,!1;if(k.length!==l.length)return f.geometry.attributes=this.getAttributesData(i),!1;for(let a of k){let b=j[a],c=i[a];if(void 0===c)return delete j[a],!1;if(b.version!==c.version)return b.version=c.version,!1}let m=e.index,n=h.indexVersion,o=m?m.version:null;if(n!==o)return h.indexVersion=o,!1;if(h.drawRange.start!==e.drawRange.start||h.drawRange.count!==e.drawRange.count)return h.drawRange.start=e.drawRange.start,h.drawRange.count=e.drawRange.count,!1;if(f.morphTargetInfluences){let a=!1;for(let b=0;b<f.morphTargetInfluences.length;b++)f.morphTargetInfluences[b]!==c.morphTargetInfluences[b]&&(f.morphTargetInfluences[b]=c.morphTargetInfluences[b],a=!0);if(a)return!1}if(f.lights){for(let a=0;a<b.length;a++)if(f.lights[a].map!==b[a].map)return!1}return f.center&&!1===f.center.equals(c.center)?f.center.copy(c.center):null!==a.bundle&&(f.version=a.bundle.version),!0}getLightsData(a){let b=[];for(let c of a)!0===c.isSpotLight&&null!==c.map&&b.push({map:c.map.version});return b}getLights(a,b){if(f6.has(a)){let c=f6.get(a);if(c.renderId===b)return c.lightsData}let c=this.getLightsData(a.getLights());return f6.set(a,{renderId:b,lightsData:c}),c}needsRefresh(a,b){if(this.hasNode||this.hasAnimation||this.firstInitialization(a)||this.needsVelocity(b.renderer))return!0;let{renderId:c}=b;if(this.renderId!==c)return this.renderId=c,!0;let d=!0===a.object.static,e=null!==a.bundle&&!0===a.bundle.static&&this.getRenderObjectData(a).version===a.bundle.version;if(d||e)return!1;let f=this.getLights(a.lightsNode,c);return!0!==this.equals(a,f)}},f8=a=>fj(a),f9=a=>fj(a),ga=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),gb=new WeakMap,gc={VERTEX:"vertex",FRAGMENT:"fragment"},gd={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},ge={BOOLEAN:"bool",INTEGER:"int",FLOAT:"float",VECTOR2:"vec2",VECTOR3:"vec3",VECTOR4:"vec4",MATRIX2:"mat2",MATRIX3:"mat3",MATRIX4:"mat4"},gf={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},gh=["setup","analyze","generate"],gi=[...gg=["fragment","vertex"],"compute"],gj=["x","y","z","w"],gk={analyze:"setup",generate:"analyze"},gl=0,gm=class extends bI{static get type(){return"Node"}constructor(a=null){super(),this.nodeType=a,this.updateType=gd.NONE,this.updateBeforeType=gd.NONE,this.updateAfterType=gd.NONE,this.uuid=bN.generateUUID(),this.version=0,this.name="",this.global=!1,this.parents=!1,this.isNode=!0,this._beforeNodes=null,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:gl++})}set needsUpdate(a){!0===a&&this.version++}get type(){return this.constructor.type}onUpdate(a,b){return this.updateType=b,this.update=a.bind(this),this}onFrameUpdate(a){return this.onUpdate(a,gd.FRAME)}onRenderUpdate(a){return this.onUpdate(a,gd.RENDER)}onObjectUpdate(a){return this.onUpdate(a,gd.OBJECT)}onReference(a){return this.updateReference=a.bind(this),this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(let{childNode:a}of this._getChildren())yield a}dispose(){this.dispatchEvent({type:"dispose"})}traverse(a){for(let b of(a(this),this.getChildren()))b.traverse(a)}_getChildren(a=new Set){let b=[];for(let c of(a.add(this),Object.getOwnPropertyNames(this))){let d=this[c];if(!(!0===c.startsWith("_")||a.has(d))){if(!0===Array.isArray(d))for(let a=0;a<d.length;a++){let e=d[a];e&&!0===e.isNode&&b.push({property:c,index:a,childNode:e})}else if(d&&!0===d.isNode)b.push({property:c,childNode:d});else if(d&&Object.getPrototypeOf(d)===Object.prototype)for(let a in d){if(!0===a.startsWith("_"))continue;let e=d[a];e&&!0===e.isNode&&b.push({property:c,index:a,childNode:e})}}}return b}getCacheKey(a=!1,b=null){if(a||(a=this.version!==this._cacheKeyVersion),!0===a||null===this._cacheKey){null===b&&(b=new Set);let c=[];for(let{property:d,childNode:e}of this._getChildren(b))c.push(f8(d.slice(0,-4)),e.getCacheKey(a,b));this._cacheKey=((...a)=>fj(a))(f9(c),this.customCacheKey()),this._cacheKeyVersion=this.version}return this._cacheKey}customCacheKey(){return this.id}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(a){let b=this.getNodeType(a);return a.getElementType(b)}getMemberType(){return"void"}getNodeType(a){let b=a.getNodeProperties(this);return b.outputNode?b.outputNode.getNodeType(a):this.nodeType}getShared(a){let b=this.getHash(a);return a.getNodeFromHash(b)||this}getArrayCount(){return null}setup(a){let b=a.getNodeProperties(this),c=0;for(let a of this.getChildren())b["node"+c++]=a;return b.outputNode||null}analyze(a,b=null){let c=a.increaseUsage(this);if(!0===this.parents){let c=a.getDataFromNode(this,"any");c.stages=c.stages||{},c.stages[a.shaderStage]=c.stages[a.shaderStage]||[],c.stages[a.shaderStage].push(b)}if(1===c)for(let b of Object.values(a.getNodeProperties(this)))b&&!0===b.isNode&&b.build(a,this)}generate(a,b){let{outputNode:c}=a.getNodeProperties(this);if(c&&!0===c.isNode)return c.build(a,b)}updateBefore(){I("Abstract function.")}updateAfter(){I("Abstract function.")}update(){I("Abstract function.")}before(a){return null===this._beforeNodes&&(this._beforeNodes=[]),this._beforeNodes.push(a),this}build(a,b=null){let c=this.getShared(a);if(this!==c)return c.build(a,b);if(null!==this._beforeNodes){let c=this._beforeNodes;for(let d of(this._beforeNodes=null,c))d.build(a,b);this._beforeNodes=c}let d=a.getDataFromNode(this);d.buildStages=d.buildStages||{},d.buildStages[a.buildStage]=!0;let e=gk[a.buildStage];if(e&&!0!==d.buildStages[e]){let b=a.getBuildStage();a.setBuildStage(e),this.build(a),a.setBuildStage(b)}a.addNode(this),a.addChain(this);let f=null,g=a.getBuildStage();if("setup"===g){this.updateReference(a);let b=a.getNodeProperties(this);if(!0!==b.initialized){for(let c of(b.initialized=!0,b.outputNode=this.setup(a)||b.outputNode||null,Object.values(b)))if(c&&!0===c.isNode){if(!0===c.parents){let b=a.getNodeProperties(c);b.parents=b.parents||[],b.parents.push(this)}c.build(a)}}f=b.outputNode}else if("analyze"===g)this.analyze(a,b);else if("generate"===g){if(this.generate.length<2){let c=this.getNodeType(a),d=a.getDataFromNode(this);void 0===(f=d.snippet)?void 0===d.generated?(d.generated=!0,d.snippet=f=this.generate(a)||""):(I("Node: Recursion detected.",this),f="/* Recursion detected. */"):void 0!==d.flowCodes&&void 0!==a.context.nodeBlock&&a.addFlowCodeHierarchy(this,a.context.nodeBlock),f=a.format(f,c,b)}else f=this.generate(a,b)||"";""===f&&null!==b&&"void"!==b&&"OutputType"!==b&&(J(`TSL: Invalid generated code, expected a "${b}".`),f=a.generateConst(b))}return a.removeChain(this),a.addSequentialNode(this),f}getSerializeChildren(){return this._getChildren()}serialize(a){let b=this.getSerializeChildren(),c={};for(let{property:d,index:e,childNode:f}of b)void 0===e?c[d]=f.toJSON(a.meta).uuid:(void 0===c[d]&&(c[d]=Number.isInteger(e)?[]:{}),c[d][e]=f.toJSON(a.meta).uuid);Object.keys(c).length>0&&(a.inputNodes=c)}deserialize(a){if(void 0!==a.inputNodes){let b=a.meta.nodes;for(let c in a.inputNodes)if(Array.isArray(a.inputNodes[c])){let d=[];for(let e of a.inputNodes[c])d.push(b[e]);this[c]=d}else if("object"==typeof a.inputNodes[c]){let d={};for(let e in a.inputNodes[c])d[e]=b[a.inputNodes[c][e]];this[c]=d}else this[c]=b[a.inputNodes[c]]}}toJSON(a){let{uuid:b,type:c}=this,d=void 0===a||"string"==typeof a;d&&(a={textures:{},images:{},nodes:{}});let e=a.nodes[b];function f(a){let b=[];for(let c in a){let d=a[c];delete d.metadata,b.push(d)}return b}if(void 0===e&&(e={uuid:b,type:c,meta:a,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},!0!==d&&(a.nodes[e.uuid]=e),this.serialize(e),delete e.meta),d){let b=f(a.textures),c=f(a.images),d=f(a.nodes);b.length>0&&(e.textures=b),c.length>0&&(e.images=c),d.length>0&&(e.nodes=d)}return e}},gn=class extends gm{static get type(){return"ArrayElementNode"}constructor(a,b){super(),this.node=a,this.indexNode=b,this.isArrayElementNode=!0}getNodeType(a){return this.node.getElementType(a)}generate(a){let b=this.indexNode.getNodeType(a);return`${this.node.build(a)}[ ${this.indexNode.build(a,!a.isVector(b)&&a.isInteger(b)?b:"uint")} ]`}},go=class extends gm{static get type(){return"ConvertNode"}constructor(a,b){super(),this.node=a,this.convertTo=b}getNodeType(a){let b=this.node.getNodeType(a),c=null;for(let d of this.convertTo.split("|"))(null===c||a.getTypeLength(b)===a.getTypeLength(d))&&(c=d);return c}serialize(a){super.serialize(a),a.convertTo=this.convertTo}deserialize(a){super.deserialize(a),this.convertTo=a.convertTo}generate(a,b){let c=this.node,d=this.getNodeType(a),e=c.build(a,d);return a.format(e,d,b)}},gp=class extends gm{static get type(){return"TempNode"}constructor(a=null){super(a),this.isTempNode=!0}hasDependencies(a){return a.getDataFromNode(this).usageCount>1}build(a,b){if("generate"===a.getBuildStage()){let c=a.getVectorType(this.getNodeType(a,b)),d=a.getDataFromNode(this);if(void 0!==d.propertyName)return a.format(d.propertyName,c,b);if("void"!==c&&"void"!==b&&this.hasDependencies(a)){let e=super.build(a,c),f=a.getVarFromNode(this,null,c),g=a.getPropertyName(f);return a.addLineFlowCode(`${g} = ${e}`,this),d.snippet=e,d.propertyName=g,a.format(d.propertyName,c,b)}}return super.build(a,b)}},gq=class extends gp{static get type(){return"JoinNode"}constructor(a=[],b=null){super(b),this.nodes=a}getNodeType(a){return null===this.nodeType?a.getTypeFromLength(this.nodes.reduce((b,c)=>b+a.getTypeLength(c.getNodeType(a)),0)):a.getVectorType(this.nodeType)}generate(a,b){let c=this.getNodeType(a),d=a.getTypeLength(c),e=this.nodes,f=a.getComponentType(c),g=[],h=0;for(let b of e){if(h>=d){J(`TSL: Length of parameters exceeds maximum length of function '${c}()' type.`);break}let e=b.getNodeType(a),i=a.getTypeLength(e),j;if(h+i>d&&(J(`TSL: Length of '${c}()' data exceeds maximum length of output type.`),i=d-h,e=a.getTypeFromLength(i)),h+=i,j=b.build(a,e),a.getComponentType(e)!==f){let b=a.getTypeFromLength(i,f);j=a.format(j,e,b)}g.push(j)}let i=`${a.getType(c)}( ${g.join(", ")} )`;return a.format(i,c,b)}},gr=gj.join(""),gs=class extends gm{static get type(){return"SplitNode"}constructor(a,b="x"){super(),this.node=a,this.components=b,this.isSplitNode=!0}getVectorLength(){let a=this.components.length;for(let b of this.components)a=Math.max(gj.indexOf(b)+1,a);return a}getComponentType(a){return a.getComponentType(this.node.getNodeType(a))}getNodeType(a){return a.getTypeFromLength(this.components.length,this.getComponentType(a))}getScope(){return this.node.getScope()}generate(a,b){let c=this.node,d=a.getTypeLength(c.getNodeType(a)),e=null;if(d>1){let f=null;this.getVectorLength()>=d&&(f=a.getTypeFromLength(this.getVectorLength(),this.getComponentType(a)));let g=c.build(a,f);e=this.components.length===d&&this.components===gr.slice(0,this.components.length)?a.format(g,f,b):a.format(`${g}.${this.components}`,this.getNodeType(a),b)}else e=c.build(a,b);return e}serialize(a){super.serialize(a),a.components=this.components}deserialize(a){super.deserialize(a),this.components=a.components}},gt=class extends gp{static get type(){return"SetNode"}constructor(a,b,c){super(),this.sourceNode=a,this.components=b,this.targetNode=c}getNodeType(a){return this.sourceNode.getNodeType(a)}generate(a){let{sourceNode:b,components:c,targetNode:d}=this,e=this.getNodeType(a),f=a.getComponentType(d.getNodeType(a)),g=a.getTypeFromLength(c.length,f),h=d.build(a,g),i=b.build(a,e),j=a.getTypeLength(e),k=[];for(let a=0;a<j;a++){let b=gj[a];b===c[0]?(k.push(h),a+=c.length-1):k.push(i+"."+b)}return`${a.getType(e)}( ${k.join(", ")} )`}},gu=class extends gp{static get type(){return"FlipNode"}constructor(a,b){super(),this.sourceNode=a,this.components=b}getNodeType(a){return this.sourceNode.getNodeType(a)}generate(a){let{components:b,sourceNode:c}=this,d=this.getNodeType(a),e=c.build(a),f=a.getVarFromNode(this),g=a.getPropertyName(f);a.addLineFlowCode(g+" = "+e,this);let h=a.getTypeLength(d),i=[],j=0;for(let a=0;a<h;a++){let c=gj[a];c===b[j]?(i.push("1.0 - "+g+"."+c),j++):i.push(g+"."+c)}return`${a.getType(d)}( ${i.join(", ")} )`}},gv=class extends gm{static get type(){return"InputNode"}constructor(a,b=null){super(b),this.isInputNode=!0,this.value=a,this.precision=null}getNodeType(){return null===this.nodeType?fm(this.value):this.nodeType}getInputType(a){return this.getNodeType(a)}setPrecision(a){return this.precision=a,this}serialize(a){super.serialize(a),a.value=this.value,this.value&&this.value.toArray&&(a.value=this.value.toArray()),a.valueType=fm(this.value),a.nodeType=this.nodeType,"ArrayBuffer"===a.valueType&&(a.value=fp(a.value)),a.precision=this.precision}deserialize(a){super.deserialize(a),this.nodeType=a.nodeType,this.value=Array.isArray(a.value)?fn(a.valueType,...a.value):a.value,this.precision=a.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(a.value))}generate(){I("Abstract function.")}},gw=/float|u?int/,gx=class extends gv{static get type(){return"ConstNode"}constructor(a,b=null){super(a,b),this.isConstNode=!0}generateConst(a){return a.generateConst(this.getNodeType(a),this.value)}generate(a,b){let c=this.getNodeType(a);return gw.test(c)&&gw.test(b)?a.generateConst(b,this.value):a.format(this.generateConst(a),c,b)}},gy=class extends gm{static get type(){return"MemberNode"}constructor(a,b){super(),this.structNode=a,this.property=b,this.isMemberNode=!0}hasMember(a){return(!this.structNode.isMemberNode||!1!==this.structNode.hasMember(a))&&"void"!==this.structNode.getMemberType(a,this.property)}getNodeType(a){return!1===this.hasMember(a)?"float":this.structNode.getMemberType(a,this.property)}getMemberType(a,b){if(!1===this.hasMember(a))return"float";let c=this.getNodeType(a);return a.getStructTypeNode(c).getMemberType(a,b)}generate(a){if(!1===this.hasMember(a)){I(`TSL: Member "${this.property}" does not exist in struct.`);let b=this.getNodeType(a);return a.generateConst(b)}return this.structNode.build(a)+"."+this.property}},gz=null,gA=new Map,gB=a=>a.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w").split("").sort().join(""),gm.prototype.assign=function(...a){if(!0!==this.isStackNode)return null===gz?J("TSL: No stack defined for assign operation. Make sure the assign is inside a Fn()."):gz.assign(this,...a),this;{let b=gA.get("assign");return this.addToStack(b(...a))}},gm.prototype.toVarIntent=function(){return this},gm.prototype.get=function(a){return new gy(this,a)},gC={},gD=["x","y","z","w"],gE=["r","g","b","a"],gF=["s","t","p","q"];for(let a=0;a<4;a++){let b=gD[a],c=gE[a],d=gF[a];fs(b,c,d);for(let e=0;e<4;e++){b=gD[a]+gD[e],fs(b,c=gE[a]+gE[e],d=gF[a]+gF[e]);for(let f=0;f<4;f++){b=gD[a]+gD[e]+gD[f],fs(b,c=gE[a]+gE[e]+gE[f],d=gF[a]+gF[e]+gF[f]);for(let g=0;g<4;g++)b=gD[a]+gD[e]+gD[f]+gD[g],fs(b,c=gE[a]+gE[e]+gE[f]+gE[g],d=gF[a]+gF[e]+gF[f]+gF[g])}}}for(let a=0;a<32;a++)gC[a]={get(){this._cache=this._cache||{};let b=this._cache[a];return void 0===b&&(b=new gn(this,new gx(a,"uint")),this._cache[a]=b),b},set(b){this[a].assign(g0(b))}};for(let a of(Object.defineProperties(gm.prototype,gC),gG=new WeakMap,gH=function(a,b=null){let c=fm(a);return"node"===c?a:null===b&&("float"===c||"boolean"===c)||c&&"shader"!==c&&"string"!==c?g0(gY(a,b)):"shader"===c?a.isFn?a:fu(a):a},gI=function(a,b=null){for(let c in a)a[c]=g0(a[c],b);return a},gJ=function(a,b=null){let c=a.length;for(let d=0;d<c;d++)a[d]=g0(a[d],b);return a},gK=function(a,b=null,c=null,d=null){function e(a){return null===d?a=g0(a):(a=g0(Object.assign(a,d)),!0===d.intent&&(a=a.toVarIntent())),a}let f,g=b,h,i;function j(b){let c;return c=g?/[a-z]/i.test(g)?g+"()":g:a.type,void 0!==h&&b.length<h?(J(`TSL: "${c}" parameter length is less than minimum required.`),b.concat(Array(h-b.length).fill(0))):void 0!==i&&b.length>i?(J(`TSL: "${c}" parameter length exceeds limit.`),b.slice(0,i)):b}return null===b?f=(...b)=>e(new a(...g3(j(b)))):null===c?f=(...c)=>e(new a(b,...g3(j(c)))):(c=g0(c),f=(...d)=>e(new a(b,...g3(j(d)),c))),f.setParameterLength=(...a)=>(1===a.length?h=i=a[0]:2===a.length&&([h,i]=a),f),f.setName=a=>(g=a,f),f},gL=function(a,...b){return g0(new a(...g3(b)))},gM=class extends gm{constructor(a,b){super(),this.shaderNode=a,this.rawInputs=b,this.isShaderCallNodeInternal=!0}getNodeType(a){return this.shaderNode.nodeType||this.getOutputNode(a).getNodeType(a)}getElementType(a){return this.getOutputNode(a).getElementType(a)}getMemberType(a,b){return this.getOutputNode(a).getMemberType(a,b)}call(a){let{shaderNode:b,rawInputs:c}=this,d=a.getNodeProperties(b),e=a.getClosestSubBuild(b.subBuilds)||"",f=e||"default";if(d[f])return d[f];let g=a.subBuildFn,h=a.fnCall;a.subBuildFn=e,a.fnCall=this;let i=null;if(b.layout){let d=gG.get(a.constructor);void 0===d&&(d=new WeakMap,gG.set(a.constructor,d));let e=d.get(b);void 0===e&&(e=g0(a.buildFunctionNode(b)),d.set(b,e)),a.addInclude(e);let f=c?(g2(c),c[0]&&(c[0].isNode||Object.getPrototypeOf(c[0])!==Object.prototype)?[...c]:c[0]):null;i=g0(e.call(f))}else{let d,e=new Proxy(a,{get:(a,b,c)=>Symbol.iterator===b?function*(){yield}:Reflect.get(a,b,c)}),f=c?(d=0,g2(c),new Proxy(c,{get:(a,b,e)=>{let f;if("length"===b)return c.length;if(Symbol.iterator===b)f=function*(){for(let a of c)yield g0(a)};else{if(c.length>0)if(Object.getPrototypeOf(c[0])===Object.prototype){let a=c[0];f=void 0===a[b]?a[d++]:Reflect.get(a,b,e)}else c[0]instanceof gm&&(f=void 0===c[b]?c[d++]:Reflect.get(c,b,e));else f=Reflect.get(a,b,e);f=g0(f)}return f}})):null,g=Array.isArray(c)?c.length>0:null!==c,h=b.jsFunc;i=g0(g||h.length>1?h(f,e):h(e))}return a.subBuildFn=g,a.fnCall=h,b.once&&(d[f]=i),i}setupOutput(a){return a.addStack(),a.stack.outputNode=this.call(a),a.removeStack()}getOutputNode(a){let b=a.getNodeProperties(this),c=a.getSubBuildOutput(this);return b[c]=b[c]||this.setupOutput(a),b[c].subBuild=a.getClosestSubBuild(this),b[c]}build(a,b=null){let c=null,d=a.getBuildStage(),e=a.getNodeProperties(this),f=a.getSubBuildOutput(this),g=this.getOutputNode(a),h=a.fnCall;if(a.fnCall=this,"setup"===d){let b=a.getSubBuildProperty("initialized",this);if(!0!==e[b]&&(e[b]=!0,e[f]=this.getOutputNode(a),e[f].build(a),this.shaderNode.subBuilds))for(let b of a.chaining){let c=a.getDataFromNode(b,"any");for(let a of(c.subBuilds=c.subBuilds||new Set,this.shaderNode.subBuilds))c.subBuilds.add(a)}c=e[f]}else"analyze"===d?g.build(a,b):"generate"===d&&(c=g.build(a,b)||"");return a.fnCall=h,c}},gN=class extends gm{constructor(a,b){super(b),this.jsFunc=a,this.layout=null,this.global=!0,this.once=!1}setLayout(a){return this.layout=a,this}getLayout(){return this.layout}call(a=null){return new gM(this,a)}setup(){return this.call()}},gO=[!1,!0],gP=[0,1,2,3],gQ=[-1,-2],gR=[.5,1.5,1/3,1e-6,1e6,Math.PI,2*Math.PI,1/Math.PI,2/Math.PI,1/(2*Math.PI),Math.PI/2],gS=new Map,gO))gS.set(a,new gx(a));for(let a of(gT=new Map,gP))gT.set(a,new gx(a,"uint"));for(let a of(gU=new Map([...gT].map(a=>new gx(a.value,"int"))),gQ))gU.set(a,new gx(a,"int"));for(let a of(gV=new Map([...gU].map(a=>new gx(a.value))),gR))gV.set(a,new gx(a));for(let a of gR)gV.set(-a,new gx(-a));gW={bool:gS,uint:gT,ints:gU,float:gV},gX=new Map([...gS,...gV]),gY=(a,b)=>gX.has(a)?gX.get(a):!0===a.isNode?a:new gx(a,b),gZ=function(a,b=null){return(...c)=>{for(let b of c)if(void 0===b)return J(`TSL: Invalid parameter for the type "${a}".`),g0(new gx(0,a));if((0===c.length||!["bool","float","int","uint"].includes(a)&&c.every(a=>{let b=typeof a;return"object"!==b&&"function"!==b}))&&(c=[fn(a,...c)]),1===c.length&&null!==b&&b.has(c[0]))return g1(b.get(c[0]));if(1===c.length){let b=gY(c[0],a);return b.nodeType===a?g1(b):g1(new go(b,a))}return g1(new gq(c.map(a=>gY(a)),a))}},g$=a=>"object"==typeof a&&a?a.value:a,g_=a=>null==a?null:a.nodeType||a.convertTo||("string"==typeof a?a:null),g0=(a,b=null)=>gH(a,b),g1=(a,b=null)=>g0(a,b).toVarIntent(),g2=(a,b=null)=>new gI(a,b),g3=(a,b=null)=>new gJ(a,b),g4=(a,b=null,c=null,d=null)=>new gK(a,b,c,d),g5=(a,...b)=>new gL(a,...b),g6=(a,b=null,c=null,d={})=>new gK(a,b,c,{...d,intent:!0}),g7=0,g8=class extends gm{constructor(a,b=null){super();let c=null;null!==b&&("object"==typeof b?c=b.return:("string"==typeof b?c=b:J("TSL: Invalid layout type."),b=null)),this.shaderNode=new ft(a,c),null!==b&&this.setLayout(b),this.isFn=!0}setLayout(a){let b=this.shaderNode.nodeType;if("object"!=typeof a.inputs){let c={name:"fn"+g7++,type:b,inputs:[]};for(let b in a)"return"!==b&&c.inputs.push({name:b,type:a[b]});a=c}return this.shaderNode.setLayout(a),this}getNodeType(a){return this.shaderNode.getNodeType(a)||"float"}call(...a){let b=this.shaderNode.call(a);return"void"===this.shaderNode.nodeType&&b.toStack(),b.toVarIntent()}once(a=null){return this.shaderNode.once=!0,this.shaderNode.subBuilds=a,this}generate(a){let b=this.getNodeType(a);return J('TSL: "Fn()" was declared but not invoked. Try calling it like "Fn()( ...params )".'),a.generateConst(b)}},g9=a=>{gz=a},ha=()=>gz,hb=(...a)=>gz.If(...a),hc=(...a)=>gz.Switch(...a),fr("toStack",fv),hd=new gZ("color"),he=new gZ("float",gW.float),hf=new gZ("int",gW.ints),hg=new gZ("uint",gW.uint),hh=new gZ("bool",gW.bool),hi=new gZ("vec2"),hj=new gZ("ivec2"),hk=new gZ("uvec2"),hl=new gZ("bvec2"),hm=new gZ("vec3"),hn=new gZ("ivec3"),ho=new gZ("uvec3"),hp=new gZ("bvec3"),hq=new gZ("vec4"),hr=new gZ("ivec4"),hs=new gZ("uvec4"),ht=new gZ("bvec4"),hu=new gZ("mat2"),hv=new gZ("mat3"),hw=new gZ("mat4"),hx=(a="")=>g0(new gx(a,"string")),hy=a=>g0(new gx(a,"ArrayBuffer")),fr("toColor",hd),fr("toFloat",he),fr("toInt",hf),fr("toUint",hg),fr("toBool",hh),fr("toVec2",hi),fr("toIVec2",hj),fr("toUVec2",hk),fr("toBVec2",hl),fr("toVec3",hm),fr("toIVec3",hn),fr("toUVec3",ho),fr("toBVec3",hp),fr("toVec4",hq),fr("toIVec4",hr),fr("toUVec4",hs),fr("toBVec4",ht),fr("toMat2",hu),fr("toMat3",hv),fr("toMat4",hw),hz=g4(gn).setParameterLength(2),hA=(a,b)=>g0(new go(g0(a),b)),hB=(a,b)=>g0(new gs(g0(a),b)),fr("element",hz),fr("convert",hA),hC=a=>(I("TSL: append() has been renamed to Stack()."),fv(a)),fr("append",a=>(I("TSL: .append() has been renamed to .toStack()."),fv(a))),hD=class extends gm{static get type(){return"PropertyNode"}constructor(a,b=null,c=!1){super(a),this.name=b,this.varying=c,this.isPropertyNode=!0,this.global=!0}customCacheKey(){return f8(this.type+":"+(this.name||"")+":"+(this.varying?"1":"0"))}getHash(a){return this.name||super.getHash(a)}generate(a){let b;return!0===this.varying?(b=a.getVaryingFromNode(this,this.name)).needsInterpolation=!0:b=a.getVarFromNode(this,this.name),a.getPropertyName(b)}},hE=(a,b)=>g0(new hD(a,b)),hF=(a,b)=>g0(new hD(a,b,!0)),hG=g5(hD,"vec4","DiffuseColor"),hH=g5(hD,"vec3","EmissiveColor"),hI=g5(hD,"float","Roughness"),hJ=g5(hD,"float","Metalness"),hK=g5(hD,"float","Clearcoat"),hL=g5(hD,"float","ClearcoatRoughness"),hM=g5(hD,"vec3","Sheen"),hN=g5(hD,"float","SheenRoughness"),hO=g5(hD,"float","Iridescence"),hP=g5(hD,"float","IridescenceIOR"),hQ=g5(hD,"float","IridescenceThickness"),hR=g5(hD,"float","AlphaT"),hS=g5(hD,"float","Anisotropy"),hT=g5(hD,"vec3","AnisotropyT"),hU=g5(hD,"vec3","AnisotropyB"),hV=g5(hD,"color","SpecularColor"),hW=g5(hD,"float","SpecularF90"),hX=g5(hD,"float","Shininess"),hY=g5(hD,"vec4","Output"),hZ=g5(hD,"float","dashSize"),h$=g5(hD,"float","gapSize"),h_=g5(hD,"float","pointWidth"),h0=g5(hD,"float","IOR"),h1=g5(hD,"float","Transmission"),h2=g5(hD,"float","Thickness"),h3=g5(hD,"float","AttenuationDistance"),h4=g5(hD,"color","AttenuationColor"),h5=g5(hD,"float","Dispersion"),h6=class extends gm{static get type(){return"UniformGroupNode"}constructor(a,b=!1,c=1){super("string"),this.name=a,this.shared=b,this.order=c,this.isUniformGroup=!0}serialize(a){super.serialize(a),a.name=this.name,a.version=this.version,a.shared=this.shared}deserialize(a){super.deserialize(a),this.name=a.name,this.version=a.version,this.shared=a.shared}},h7=a=>new h6(a),h9=(h8=(a,b=0)=>new h6(a,!0,b))("frame"),ia=h8("render"),ib=h7("object"),ic=class extends gv{static get type(){return"UniformNode"}constructor(a,b=null){super(a,b),this.isUniformNode=!0,this.name="",this.groupNode=ib}setName(a){return this.name=a,this}label(a){return I('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(a)}setGroup(a){return this.groupNode=a,this}getGroup(){return this.groupNode}getUniformHash(a){return this.getHash(a)}onUpdate(a,b){return a=a.bind(this),super.onUpdate(b=>{let c=a(b,this);void 0!==c&&(this.value=c)},b)}getInputType(a){let b=super.getInputType(a);return"bool"===b&&(b="uint"),b}generate(a,b){let c=this.getNodeType(a),d=this.getUniformHash(a),e=a.getNodeFromHash(d);void 0===e&&(a.setHashNode(this,d),e=this);let f=e.getInputType(a),g=a.getUniformFromNode(e,f,a.shaderStage,this.name||a.context.nodeName),h=a.getPropertyName(g);void 0!==a.context.nodeName&&delete a.context.nodeName;let i=h;if("bool"===c){let b=a.getDataFromNode(this),d=b.propertyName;if(void 0===d){let e=a.getVarFromNode(this,null,"bool");b.propertyName=d=a.getPropertyName(e),i=a.format(h,f,c),a.addLineFlowCode(`${d} = ${i}`,this)}i=d}return a.format(i,c,b)}},id=(a,b)=>{let c=g_(b||a);return c===a&&(a=fn(c)),a=a&&!0===a.isNode?a.node&&a.node.value||a.value:a,g0(new ic(a,c))},ie=class extends gp{static get type(){return"ArrayNode"}constructor(a,b,c=null){super(a),this.count=b,this.values=c,this.isArrayNode=!0}getArrayCount(){return this.count}getNodeType(a){return null===this.nodeType&&(this.nodeType=this.values[0].getNodeType(a)),this.nodeType}getElementType(a){return this.getNodeType(a)}generate(a){let b=this.getNodeType(a);return a.generateArray(b,this.count,this.values)}},ig=(...a)=>{let b;if(1===a.length){let c=a[0];b=new ie(null,c.length,c)}else b=new ie(a[0],a[1]);return g0(b)},fr("toArray",(a,b)=>ig(Array(b).fill(a))),fr("assign",ih=g4(class extends gp{static get type(){return"AssignNode"}constructor(a,b){super(),this.targetNode=a,this.sourceNode=b,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(a,b){return"void"===b?"void":this.targetNode.getNodeType(a)}needsSplitAssign(a){let{targetNode:b}=this;if(!1===a.isAvailable("swizzleAssign")&&b.isSplitNode&&b.components.length>1){let c=a.getTypeLength(b.node.getNodeType(a));return gj.join("").slice(0,c)!==b.components}return!1}setup(a){let{targetNode:b,sourceNode:c}=this,d=b.getScope();a.getNodeProperties(d).assign=!0;let e=a.getNodeProperties(this);e.sourceNode=c,e.targetNode=b.context({assign:!0})}generate(a,b){let{targetNode:c,sourceNode:d}=a.getNodeProperties(this),e=this.needsSplitAssign(a),f=c.build(a),g=c.getNodeType(a),h=d.build(a,g),i=d.getNodeType(a),j=a.getDataFromNode(this),k;if(!0===j.initialized)"void"!==b&&(k=f);else if(e){let d=a.getVarFromNode(this,null,g),e=a.getPropertyName(d);a.addLineFlowCode(`${e} = ${h}`,this);let i=c.node,j=i.node.context({assign:!0}).build(a);for(let b=0;b<i.components.length;b++){let c=i.components[b];a.addLineFlowCode(`${j}.${c} = ${e}[ ${b} ]`,this)}"void"!==b&&(k=f)}else k=`${f} = ${h}`,("void"===b||"void"===i)&&(a.addLineFlowCode(k,this),"void"!==b&&(k=f));return j.initialized=!0,a.format(k,g,b)}}).setParameterLength(2)),ii=class extends gp{static get type(){return"FunctionCallNode"}constructor(a=null,b={}){super(),this.functionNode=a,this.parameters=b}setParameters(a){return this.parameters=a,this}getParameters(){return this.parameters}getNodeType(a){return this.functionNode.getNodeType(a)}getMemberType(a,b){return this.functionNode.getMemberType(a,b)}generate(a){let b=[],c=this.functionNode,d=c.getInputs(a),e=this.parameters,f=(b,c)=>{let d=c.type;return"pointer"===d?"&"+b.build(a):b.build(a,d)};if(Array.isArray(e)){if(e.length>d.length)J("TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),e.length=d.length;else if(e.length<d.length)for(J("TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");e.length<d.length;)e.push(he(0));for(let a=0;a<e.length;a++)b.push(f(e[a],d[a]))}else for(let a of d){let c=e[a.name];void 0===c?(J(`TSL: Input '${a.name}' not found in 'Fn()'.`),b.push(f(he(0),a))):b.push(f(c,a))}return`${c.build(a,"property")}( ${b.join(", ")} )`}},fr("call",ij=(a,...b)=>(b=b.length>1||b[0]&&!0===b[0].isNode?g3(b):g2(b[0]),new ii(g0(a),b))),ik={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"},im=g6(il=class a extends gp{static get type(){return"OperatorNode"}constructor(b,c,d,...e){if(super(),e.length>0){let f=new a(b,c,d);for(let c=0;c<e.length-1;c++)f=new a(b,f,e[c]);c=f,d=e[e.length-1]}this.op=b,this.aNode=c,this.bNode=d,this.isOperatorNode=!0}getOperatorMethod(a,b){return a.getMethod(ik[this.op],b)}getNodeType(a,b=null){let c=this.op,d=this.aNode,e=this.bNode,f=d.getNodeType(a),g=e?e.getNodeType(a):null;if("void"===f||"void"===g)return b||"void";if("%"===c)return f;if("~"===c||"&"===c||"|"===c||"^"===c||">>"===c||"<<"===c)return a.getIntegerType(f);if("!"===c||"&&"===c||"||"===c||"^^"===c)return"bool";if("=="===c||"!="===c||"<"===c||">"===c||"<="===c||">="===c){let b=Math.max(a.getTypeLength(f),a.getTypeLength(g));return b>1?`bvec${b}`:"bool"}if(a.isMatrix(f)){if("float"===g)return f;if(a.isVector(g))return a.getVectorFromMatrix(f);if(a.isMatrix(g))return f}else if(a.isMatrix(g)){if("float"===f)return g;if(a.isVector(f))return a.getVectorFromMatrix(g)}return a.getTypeLength(g)>a.getTypeLength(f)?g:f}generate(a,b){let c=this.op,{aNode:d,bNode:e}=this,f=this.getNodeType(a,b),g=null,h=null;"void"===f?g=h=f:(g=d.getNodeType(a),h=e?e.getNodeType(a):null,"<"===c||">"===c||"<="===c||">="===c||"=="===c||"!="===c?a.isVector(g)?h=g:a.isVector(h)?g=h:g!==h&&(g=h="float"):">>"===c||"<<"===c?(g=f,h=a.changeComponentType(h,"uint")):"%"===c?(g=f,h=a.isInteger(g)&&a.isInteger(h)?h:g):a.isMatrix(g)?"float"===h?h="float":a.isVector(h)?h=a.getVectorFromMatrix(g):a.isMatrix(h)||(g=h=f):g=a.isMatrix(h)?"float"===g?"float":a.isVector(g)?a.getVectorFromMatrix(h):h=f:h=f);let i=d.build(a,g),j=e?e.build(a,h):null,k=a.getFunctionOperator(c);if("void"!==b){let d=a.renderer.coordinateSystem===bD;if("=="===c||"!="===c||"<"===c||">"===c||"<="===c||">="===c)return d&&a.isVector(g)?a.format(`${this.getOperatorMethod(a,b)}( ${i}, ${j} )`,f,b):a.format(`( ${i} ${c} ${j} )`,f,b);if("%"===c)return a.isInteger(h)?a.format(`( ${i} % ${j} )`,f,b):a.format(`${this.getOperatorMethod(a,f)}( ${i}, ${j} )`,f,b);if("!"===c||"~"===c)return a.format(`(${c}${i})`,g,b);if(k)return a.format(`${k}( ${i}, ${j} )`,f,b);if(a.isMatrix(g)&&"float"===h)return a.format(`( ${j} ${c} ${i} )`,f,b);if("float"===g&&a.isMatrix(h))return a.format(`${i} ${c} ${j}`,f,b);{let e=`( ${i} ${c} ${j} )`;return!d&&"bool"===f&&a.isVector(g)&&a.isVector(h)&&(e=`all${e}`),a.format(e,f,b)}}if("void"!==g)return k?a.format(`${k}( ${i}, ${j} )`,f,b):a.isMatrix(g)&&"float"===h?a.format(`${j} ${c} ${i}`,f,b):a.format(`${i} ${c} ${j}`,f,b)}serialize(a){super.serialize(a),a.op=this.op}deserialize(a){super.deserialize(a),this.op=a.op}},"+").setParameterLength(2,1/0).setName("add"),io=g6(il,"-").setParameterLength(2,1/0).setName("sub"),ip=g6(il,"*").setParameterLength(2,1/0).setName("mul"),iq=g6(il,"/").setParameterLength(2,1/0).setName("div"),ir=g6(il,"%").setParameterLength(2).setName("mod"),is=g6(il,"==").setParameterLength(2).setName("equal"),it=g6(il,"!=").setParameterLength(2).setName("notEqual"),iu=g6(il,"<").setParameterLength(2).setName("lessThan"),iv=g6(il,">").setParameterLength(2).setName("greaterThan"),iw=g6(il,"<=").setParameterLength(2).setName("lessThanEqual"),ix=g6(il,">=").setParameterLength(2).setName("greaterThanEqual"),iy=g6(il,"&&").setParameterLength(2,1/0).setName("and"),iz=g6(il,"||").setParameterLength(2,1/0).setName("or"),iA=g6(il,"!").setParameterLength(1).setName("not"),iB=g6(il,"^^").setParameterLength(2).setName("xor"),iC=g6(il,"&").setParameterLength(2).setName("bitAnd"),iD=g6(il,"~").setParameterLength(1).setName("bitNot"),iE=g6(il,"|").setParameterLength(2).setName("bitOr"),iF=g6(il,"^").setParameterLength(2).setName("bitXor"),iG=g6(il,"<<").setParameterLength(2).setName("shiftLeft"),iH=g6(il,">>").setParameterLength(2).setName("shiftRight"),iI=fu(([a])=>(a.addAssign(1),a)),iJ=fu(([a])=>(a.subAssign(1),a)),iK=fu(([a])=>{let b=hf(a).toConst();return a.addAssign(1),b}),iL=fu(([a])=>{let b=hf(a).toConst();return a.subAssign(1),b}),fr("add",im),fr("sub",io),fr("mul",ip),fr("div",iq),fr("mod",ir),fr("equal",is),fr("notEqual",it),fr("lessThan",iu),fr("greaterThan",iv),fr("lessThanEqual",iw),fr("greaterThanEqual",ix),fr("and",iy),fr("or",iz),fr("not",iA),fr("xor",iB),fr("bitAnd",iC),fr("bitNot",iD),fr("bitOr",iE),fr("bitXor",iF),fr("shiftLeft",iG),fr("shiftRight",iH),fr("incrementBefore",iI),fr("decrementBefore",iJ),fr("increment",iK),fr("decrement",iL),fr("modInt",iM=(a,b)=>(I('TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),ir(hf(a),hf(b)))),(iN=class a extends gp{static get type(){return"MathNode"}constructor(b,c,d=null,e=null){if(super(),(b===a.MAX||b===a.MIN)&&arguments.length>3){let f=new a(b,c,d);for(let c=2;c<arguments.length-1;c++)f=new a(b,f,arguments[c]);c=f,d=arguments[arguments.length-1],e=null}this.method=b,this.aNode=c,this.bNode=d,this.cNode=e,this.isMathNode=!0}getInputType(a){let b=this.aNode.getNodeType(a),c=this.bNode?this.bNode.getNodeType(a):null,d=this.cNode?this.cNode.getNodeType(a):null,e=a.isMatrix(b)?0:a.getTypeLength(b),f=a.isMatrix(c)?0:a.getTypeLength(c),g=a.isMatrix(d)?0:a.getTypeLength(d);return e>f&&e>g?b:f>g?c:g>e?d:b}getNodeType(b){let c=this.method;return c===a.LENGTH||c===a.DISTANCE||c===a.DOT?"float":c===a.CROSS?"vec3":c===a.ALL||c===a.ANY?"bool":c===a.EQUALS?b.changeComponentType(this.aNode.getNodeType(b),"bool"):this.getInputType(b)}setup(b){let{aNode:c,bNode:d,method:e}=this,f=null;if(e===a.ONE_MINUS)f=io(1,c);else if(e===a.RECIPROCAL)f=iq(1,c);else if(e===a.DIFFERENCE)f=jc(io(c,d));else if(e===a.TRANSFORM_DIRECTION){let a=c,e=d;b.isMatrix(a.getNodeType(b))?e=hq(hm(e),0):a=hq(hm(a),0);let g=ip(a,e).xyz;f=i4(g)}return null===f?super.setup(b):f}generate(b,c){if(b.getNodeProperties(this).outputNode)return super.generate(b,c);let d=this.method,e=this.getNodeType(b),f=this.getInputType(b),g=this.aNode,h=this.bNode,i=this.cNode,j=b.renderer.coordinateSystem;if(d===a.NEGATE)return b.format("( - "+g.build(b,f)+" )",e,c);{let k=[];return d===a.CROSS?k.push(g.build(b,e),h.build(b,e)):2e3===j&&d===a.STEP?k.push(g.build(b,1===b.getTypeLength(g.getNodeType(b))?"float":f),h.build(b,f)):2e3===j&&(d===a.MIN||d===a.MAX)?k.push(g.build(b,f),h.build(b,1===b.getTypeLength(h.getNodeType(b))?"float":f)):d===a.REFRACT?k.push(g.build(b,f),h.build(b,f),i.build(b,"float")):d===a.MIX?k.push(g.build(b,f),h.build(b,f),i.build(b,1===b.getTypeLength(i.getNodeType(b))?"float":f)):(2001===j&&d===a.ATAN&&null!==h&&(d="atan2"),"fragment"!==b.shaderStage&&(d===a.DFDX||d===a.DFDY)&&(I(`TSL: '${d}' is not supported in the ${b.shaderStage} stage.`),d="/*"+d+"*/"),k.push(g.build(b,f)),null!==h&&k.push(h.build(b,f)),null!==i&&k.push(i.build(b,f))),b.format(`${b.getMethod(d,e)}( ${k.join(", ")} )`,e,c)}}serialize(a){super.serialize(a),a.method=this.method}deserialize(a){super.deserialize(a),this.method=a.method}}).ALL="all",iN.ANY="any",iN.RADIANS="radians",iN.DEGREES="degrees",iN.EXP="exp",iN.EXP2="exp2",iN.LOG="log",iN.LOG2="log2",iN.SQRT="sqrt",iN.INVERSE_SQRT="inversesqrt",iN.FLOOR="floor",iN.CEIL="ceil",iN.NORMALIZE="normalize",iN.FRACT="fract",iN.SIN="sin",iN.COS="cos",iN.TAN="tan",iN.ASIN="asin",iN.ACOS="acos",iN.ATAN="atan",iN.ABS="abs",iN.SIGN="sign",iN.LENGTH="length",iN.NEGATE="negate",iN.ONE_MINUS="oneMinus",iN.DFDX="dFdx",iN.DFDY="dFdy",iN.ROUND="round",iN.RECIPROCAL="reciprocal",iN.TRUNC="trunc",iN.FWIDTH="fwidth",iN.TRANSPOSE="transpose",iN.DETERMINANT="determinant",iN.INVERSE="inverse",iN.EQUALS="equals",iN.MIN="min",iN.MAX="max",iN.STEP="step",iN.REFLECT="reflect",iN.DISTANCE="distance",iN.DIFFERENCE="difference",iN.DOT="dot",iN.CROSS="cross",iN.POW="pow",iN.TRANSFORM_DIRECTION="transformDirection",iN.MIX="mix",iN.CLAMP="clamp",iN.REFRACT="refract",iN.SMOOTHSTEP="smoothstep",iN.FACEFORWARD="faceforward",iO=he(1e-6),iP=he(1e6),iQ=he(Math.PI),iR=he(2*Math.PI),iS=he(2*Math.PI),iT=he(.5*Math.PI),iU=g6(iN,iN.ALL).setParameterLength(1),iV=g6(iN,iN.ANY).setParameterLength(1),iW=g6(iN,iN.RADIANS).setParameterLength(1),iX=g6(iN,iN.DEGREES).setParameterLength(1),iY=g6(iN,iN.EXP).setParameterLength(1),iZ=g6(iN,iN.EXP2).setParameterLength(1),i$=g6(iN,iN.LOG).setParameterLength(1),i_=g6(iN,iN.LOG2).setParameterLength(1),i0=g6(iN,iN.SQRT).setParameterLength(1),i1=g6(iN,iN.INVERSE_SQRT).setParameterLength(1),i2=g6(iN,iN.FLOOR).setParameterLength(1),i3=g6(iN,iN.CEIL).setParameterLength(1),i4=g6(iN,iN.NORMALIZE).setParameterLength(1),i5=g6(iN,iN.FRACT).setParameterLength(1),i6=g6(iN,iN.SIN).setParameterLength(1),i7=g6(iN,iN.COS).setParameterLength(1),i8=g6(iN,iN.TAN).setParameterLength(1),i9=g6(iN,iN.ASIN).setParameterLength(1),ja=g6(iN,iN.ACOS).setParameterLength(1),jb=g6(iN,iN.ATAN).setParameterLength(1,2),jc=g6(iN,iN.ABS).setParameterLength(1),jd=g6(iN,iN.SIGN).setParameterLength(1),je=g6(iN,iN.LENGTH).setParameterLength(1),jf=g6(iN,iN.NEGATE).setParameterLength(1),jg=g6(iN,iN.ONE_MINUS).setParameterLength(1),jh=g6(iN,iN.DFDX).setParameterLength(1),ji=g6(iN,iN.DFDY).setParameterLength(1),jj=g6(iN,iN.ROUND).setParameterLength(1),jk=g6(iN,iN.RECIPROCAL).setParameterLength(1),jl=g6(iN,iN.TRUNC).setParameterLength(1),jm=g6(iN,iN.FWIDTH).setParameterLength(1),jn=g6(iN,iN.TRANSPOSE).setParameterLength(1),jo=g6(iN,iN.DETERMINANT).setParameterLength(1),jp=g6(iN,iN.INVERSE).setParameterLength(1),jq=(a,b)=>(I('TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),is(a,b)),jr=g6(iN,iN.MIN).setParameterLength(2,1/0),js=g6(iN,iN.MAX).setParameterLength(2,1/0),jt=g6(iN,iN.STEP).setParameterLength(2),ju=g6(iN,iN.REFLECT).setParameterLength(2),jv=g6(iN,iN.DISTANCE).setParameterLength(2),jw=g6(iN,iN.DIFFERENCE).setParameterLength(2),jx=g6(iN,iN.DOT).setParameterLength(2),jy=g6(iN,iN.CROSS).setParameterLength(2),jz=g6(iN,iN.POW).setParameterLength(2),jA=a=>ip(a,a),jB=a=>ip(a,a,a),jC=a=>ip(a,a,a,a),jD=g6(iN,iN.TRANSFORM_DIRECTION).setParameterLength(2),jE=a=>ip(jd(a),jz(jc(a),1/3)),jF=a=>jx(a,a),jG=g6(iN,iN.MIX).setParameterLength(3),jH=(a,b=0,c=1)=>g0(new iN(iN.CLAMP,g0(a),g0(b),g0(c))),jI=a=>jH(a),jJ=g6(iN,iN.REFRACT).setParameterLength(3),jK=g6(iN,iN.SMOOTHSTEP).setParameterLength(3),jL=g6(iN,iN.FACEFORWARD).setParameterLength(3),jM=fu(([a])=>i5(i6(ir(jx(a.xy,hi(12.9898,78.233)),iQ)).mul(43758.5453))),jN=(a,b,c)=>jG(b,c,a),jO=(a,b,c)=>jK(b,c,a),jP=(a,b)=>jt(b,a),jQ=(a,b)=>(I('TSL: "atan2" is overloaded. Use "atan" instead.'),jb(a,b)),jR=jL,jS=i1,fr("all",iU),fr("any",iV),fr("equals",jq),fr("radians",iW),fr("degrees",iX),fr("exp",iY),fr("exp2",iZ),fr("log",i$),fr("log2",i_),fr("sqrt",i0),fr("inverseSqrt",i1),fr("floor",i2),fr("ceil",i3),fr("normalize",i4),fr("fract",i5),fr("sin",i6),fr("cos",i7),fr("tan",i8),fr("asin",i9),fr("acos",ja),fr("atan",jb),fr("abs",jc),fr("sign",jd),fr("length",je),fr("lengthSq",jF),fr("negate",jf),fr("oneMinus",jg),fr("dFdx",jh),fr("dFdy",ji),fr("round",jj),fr("reciprocal",jk),fr("trunc",jl),fr("fwidth",jm),fr("atan2",jQ),fr("min",jr),fr("max",js),fr("step",jP),fr("reflect",ju),fr("distance",jv),fr("dot",jx),fr("cross",jy),fr("pow",jz),fr("pow2",jA),fr("pow3",jB),fr("pow4",jC),fr("transformDirection",jD),fr("mix",jN),fr("clamp",jH),fr("refract",jJ),fr("smoothstep",jO),fr("faceForward",jL),fr("difference",jw),fr("saturate",jI),fr("cbrt",jE),fr("transpose",jn),fr("determinant",jo),fr("inverse",jp),fr("rand",jM),fr("select",jT=g4(class extends gm{static get type(){return"ConditionalNode"}constructor(a,b,c=null){super(),this.condNode=a,this.ifNode=b,this.elseNode=c}getNodeType(a){let{ifNode:b,elseNode:c}=a.getNodeProperties(this);if(void 0===b)return a.flowBuildStage(this,"setup"),this.getNodeType(a);let d=b.getNodeType(a);if(null!==c){let b=c.getNodeType(a);if(a.getTypeLength(b)>a.getTypeLength(d))return b}return d}setup(a){let b=this.condNode,c=this.ifNode.isolate(),d=this.elseNode?this.elseNode.isolate():null,e=a.context.nodeBlock;a.getDataFromNode(c).parentNodeBlock=e,null!==d&&(a.getDataFromNode(d).parentNodeBlock=e);let f=a.context.uniformFlow,g=a.getNodeProperties(this);g.condNode=b,g.ifNode=f?c:c.context({nodeBlock:c}),g.elseNode=d?f?d:d.context({nodeBlock:d}):null}generate(a,b){let c=this.getNodeType(a),d=a.getDataFromNode(this);if(void 0!==d.nodeProperty)return d.nodeProperty;let{condNode:e,ifNode:f,elseNode:g}=a.getNodeProperties(this),h=a.currentFunctionNode,i="void"!==b,j=i?hE(c).build(a):"";d.nodeProperty=j;let k=e.build(a,"bool");if(a.context.uniformFlow&&null!==g){let d=f.build(a,c),e=g.build(a,c),h=a.getTernary(k,d,e);return a.format(h,c,b)}a.addFlowCode(`
${a.tab}if ( ${k} ) {

`).addFlowTab();let l=f.build(a,c);if(l&&(i?l=j+" = "+l+";":(l="return "+l+";",null===h&&(I("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),l="// "+l))),a.removeFlowTab().addFlowCode(a.tab+"	"+l+`

`+a.tab+"}"),null!==g){a.addFlowCode(` else {

`).addFlowTab();let b=g.build(a,c);b&&(i?b=j+" = "+b+";":(b="return "+b+";",null===h&&(I("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),b="// "+b))),a.removeFlowTab().addFlowCode(a.tab+"	"+b+`

`+a.tab+`}

`)}else a.addFlowCode(`

`);return a.format(j,c,b)}}).setParameterLength(2,3)),jU=class extends gm{static get type(){return"ContextNode"}constructor(a,b={}){super(),this.isContextNode=!0,this.node=a,this.value=b}getScope(){return this.node.getScope()}getNodeType(a){return this.node.getNodeType(a)}getMemberType(a,b){return this.node.getMemberType(a,b)}analyze(a){let b=a.addContext(this.value);this.node.build(a),a.setContext(b)}setup(a){let b=a.addContext(this.value);this.node.build(a),a.setContext(b)}generate(a,b){let c=a.addContext(this.value),d=this.node.build(a,b);return a.setContext(c),d}},jV=g4(jU).setParameterLength(1,2),jW=a=>jV(a,{uniformFlow:!0}),jX=(a,b)=>jV(a,{nodeName:b}),fr("context",jV),fr("label",fw),fr("uniformFlow",jW),fr("setName",jX),jZ=g4(jY=class extends gm{static get type(){return"VarNode"}constructor(a,b=null,c=!1){super(),this.node=a,this.name=b,this.global=!0,this.isVarNode=!0,this.readOnly=c,this.parents=!0,this.intent=!1}setIntent(a){return this.intent=a,this}getIntent(){return this.intent}getMemberType(a,b){return this.node.getMemberType(a,b)}getElementType(a){return this.node.getElementType(a)}getNodeType(a){return this.node.getNodeType(a)}getArrayCount(a){return this.node.getArrayCount(a)}isAssign(a){let b=a.getNodeProperties(this).assign;return!0!==b&&this.node.isShaderCallNodeInternal&&null===this.node.shaderNode.getLayout()&&a.fnCall&&a.fnCall.shaderNode&&a.getDataFromNode(this.node.shaderNode).hasLoop&&(b=!0),b}build(...a){let b=a[0];return!1===this._hasStack(b)&&"setup"===b.buildStage&&(b.context.nodeLoop||b.context.nodeBlock)&&b.getBaseStack().addToStack(this),!0===this.intent&&!0!==this.isAssign(b)?this.node.build(...a):super.build(...a)}generate(a){let{node:b,name:c,readOnly:d}=this,{renderer:e}=a,f=!0===e.backend.isWebGPUBackend,g=!1,h=!1;d&&(g=a.isDeterministic(b),h=f?d:g);let i=this.getNodeType(a);if("void"==i)return!0!==this.intent&&J('TSL: ".toVar()" can not be used with void type.'),b.build(a);let j=a.getVectorType(i),k=b.build(a,j),l=a.getVarFromNode(this,c,j,void 0,h),m=a.getPropertyName(l),n=m;if(h)if(f)n=g?`const ${m}`:`let ${m}`;else{let c=b.getArrayCount(a);n=`const ${a.getVar(l.type,m,c)}`}return a.addLineFlowCode(`${n} = ${k}`,this),m}_hasStack(a){return void 0!==a.getDataFromNode(this).stack}}),j$=(a,b=null)=>jZ(a,b).toStack(),j_=(a,b=null)=>jZ(a,b,!0).toStack(),j0=a=>jZ(a).setIntent(!0).toStack(),fr("toVar",j$),fr("toConst",j_),fr("toVarIntent",j0),j1=class extends gm{static get type(){return"SubBuild"}constructor(a,b,c=null){super(c),this.node=a,this.name=b,this.isSubBuildNode=!0}getNodeType(a){if(null!==this.nodeType)return this.nodeType;a.addSubBuild(this.name);let b=this.node.getNodeType(a);return a.removeSubBuild(),b}build(a,...b){a.addSubBuild(this.name);let c=this.node.build(a,...b);return a.removeSubBuild(),c}},j2=(a,b,c=null)=>g0(new j1(g0(a),b,c)),j3=g4(class extends gm{static get type(){return"VaryingNode"}constructor(a,b=null){super(),this.node=a,this.name=b,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(a,b=null){return this.interpolationType=a,this.interpolationSampling=b,this}getHash(a){return this.name||super.getHash(a)}getNodeType(a){return this.node.getNodeType(a)}setupVarying(a){let b=a.getNodeProperties(this),c=b.varying;if(void 0===c){let d=this.name,e=this.getNodeType(a),f=this.interpolationType,g=this.interpolationSampling;b.varying=c=a.getVaryingFromNode(this,d,e,f,g),b.node=j2(this.node,"VERTEX")}return c.needsInterpolation||(c.needsInterpolation="fragment"===a.shaderStage),c}setup(a){this.setupVarying(a),a.flowNodeFromShaderStage(gc.VERTEX,this.node)}analyze(a){this.setupVarying(a),a.flowNodeFromShaderStage(gc.VERTEX,this.node)}generate(a){let b=a.getSubBuildProperty("property",a.currentStack),c=a.getNodeProperties(this),d=this.setupVarying(a);if(void 0===c[b]){let e=this.getNodeType(a),f=a.getPropertyName(d,gc.VERTEX);a.flowNodeFromShaderStage(gc.VERTEX,c.node,e,f),c[b]=f}return a.getPropertyName(d)}}).setParameterLength(1,2),j4=a=>j3(a),fr("toVarying",j3),fr("toVertexStage",j4),fr("varying",(...a)=>(I("TSL: .varying() has been renamed to .toVarying()."),j3(...a))),fr("vertexStage",(...a)=>(I("TSL: .vertexStage() has been renamed to .toVertexStage()."),j3(...a))),j5=fu(([a])=>jG(a.mul(.9478672986).add(.0521327014).pow(2.4),a.mul(.0773993808),a.lessThanEqual(.04045))).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),j6=fu(([a])=>jG(a.pow(.41666).mul(1.055).sub(.055),a.mul(12.92),a.lessThanEqual(.0031308))).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),j7="WorkingColorSpace",j8=class extends gp{static get type(){return"ColorSpaceNode"}constructor(a,b,c){super("vec4"),this.colorNode=a,this.source=b,this.target=c}resolveColorSpace(a,b){return b===j7?bX.workingColorSpace:"OutputColorSpace"===b?a.context.outputColorSpace||a.renderer.outputColorSpace:b}setup(a){let{colorNode:b}=this,c=this.resolveColorSpace(a,this.source),d=this.resolveColorSpace(a,this.target),e=b;return!1!==bX.enabled&&c!==d&&c&&d&&("srgb"===bX.getTransfer(c)&&(e=hq(j5(e.rgb),e.a)),bX.getPrimaries(c)!==bX.getPrimaries(d)&&(e=hq(hv(bX._getMatrix(new bT,c,d)).mul(e.rgb),e.a)),"srgb"===bX.getTransfer(d)&&(e=hq(j6(e.rgb),e.a))),e}},j9=(a,b)=>g0(new j8(g0(a),j7,b)),ka=(a,b)=>g0(new j8(g0(a),b,j7)),kb=(a,b,c)=>g0(new j8(g0(a),b,c)),fr("workingToColorSpace",j9),fr("colorSpaceToWorking",ka),kc=class extends gn{static get type(){return"ReferenceElementNode"}constructor(a,b){super(a,b),this.referenceNode=a,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(a){let b=super.generate(a),c=this.referenceNode.getNodeType(),d=this.getNodeType();return a.format(b,c,d)}},kd=class extends gm{static get type(){return"ReferenceBaseNode"}constructor(a,b,c=null,d=null){super(),this.property=a,this.uniformType=b,this.object=c,this.count=d,this.properties=a.split("."),this.reference=c,this.node=null,this.group=null,this.updateType=gd.OBJECT}setGroup(a){return this.group=a,this}element(a){return g0(new kc(this,g0(a)))}setNodeType(a){let b=id(null,a);null!==this.group&&b.setGroup(this.group),this.node=b}getNodeType(a){return null===this.node&&(this.updateReference(a),this.updateValue()),this.node.getNodeType(a)}getValueFromReference(a=this.reference){let{properties:b}=this,c=a[b[0]];for(let a=1;a<b.length;a++)c=c[b[a]];return c}updateReference(a){return this.reference=null===this.object?a.object:this.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){null===this.node&&this.setNodeType(this.uniformType);let a=this.getValueFromReference();Array.isArray(a)?this.node.array=a:this.node.value=a}},ke=class extends kd{static get type(){return"RendererReferenceNode"}constructor(a,b,c=null){super(a,b,c),this.renderer=c,this.setGroup(ia)}updateReference(a){return this.reference=null===this.renderer?a.renderer:this.renderer,this.reference}},kf=(a,b,c=null)=>g0(new ke(a,b,c)),kg=class extends gp{static get type(){return"ToneMappingNode"}constructor(a,b=ki,c=null){super("vec3"),this._toneMapping=a,this.exposureNode=b,this.colorNode=c}customCacheKey(){return((...a)=>fj(a))(this._toneMapping)}setToneMapping(a){return this._toneMapping=a,this}getToneMapping(){return this._toneMapping}setup(a){let b=this.colorNode||a.context.color,c=this._toneMapping;if(0===c)return b;let d=null,e=a.renderer.library.getToneMappingFunction(c);return null===e?(J("ToneMappingNode: Unsupported Tone Mapping configuration.",c),d=b):d=hq(e(b.rgb,this.exposureNode),b.a),d}},kh=(a,b,c)=>g0(new kg(a,g0(b),g0(c))),ki=kf("toneMappingExposure","float"),fr("toneMapping",(a,b,c)=>kh(b,c,a)),kj=class extends gv{static get type(){return"BufferAttributeNode"}constructor(a,b=null,c=0,d=0){super(a,b),this.isBufferNode=!0,this.bufferType=b,this.bufferStride=c,this.bufferOffset=d,this.usage=bB,this.instanced=!1,this.attribute=null,this.global=!0,a&&!0===a.isBufferAttribute&&(this.attribute=a,this.usage=a.usage,this.instanced=a.isInstancedBufferAttribute)}getHash(a){if(0===this.bufferStride&&0===this.bufferOffset){let b=a.globalCache.getData(this.value);return void 0===b&&(b={node:this},a.globalCache.setData(this.value,b)),b.node.uuid}return this.uuid}getNodeType(a){return null===this.bufferType&&(this.bufferType=a.getTypeFromAttribute(this.attribute)),this.bufferType}setup(a){if(null!==this.attribute)return;let b=this.getNodeType(a),c=this.value,d=a.getTypeLength(b),e=this.bufferStride||d,f=this.bufferOffset,g=!0===c.isInterleavedBuffer?c:new d1(c,e),h=new d3(g,d,f);g.setUsage(this.usage),this.attribute=h,this.attribute.isInstancedBufferAttribute=this.instanced}generate(a){let b=this.getNodeType(a),c=a.getBufferAttributeFromNode(this,b),d=a.getPropertyName(c),e=null;return"vertex"===a.shaderStage||"compute"===a.shaderStage?(this.name=d,e=d):e=j3(this).build(a,b),e}getInputType(){return"bufferAttribute"}setUsage(a){return this.usage=a,this.attribute&&!0===this.attribute.isBufferAttribute&&(this.attribute.usage=a),this}setInstanced(a){return this.instanced=a,this}},kk=(a,b=null,c=0,d=0)=>g0(new kj(a,b,c,d)),kl=(a,b=null,c=0,d=0)=>kk(a,b,c,d).setUsage(bC),km=(a,b=null,c=0,d=0)=>kk(a,b,c,d).setInstanced(!0),kn=(a,b=null,c=0,d=0)=>kl(a,b,c,d).setInstanced(!0),fr("toAttribute",a=>kk(a.value)),ko=class extends gm{static get type(){return"ComputeNode"}constructor(a,b){super("void"),this.isComputeNode=!0,this.computeNode=a,this.workgroupSize=b,this.count=null,this.version=1,this.name="",this.updateBeforeType=gd.OBJECT,this.onInitFunction=null}setCount(a){return this.count=a,this}getCount(){return this.count}dispose(){this.dispatchEvent({type:"dispose"})}setName(a){return this.name=a,this}label(a){return I('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(a)}onInit(a){return this.onInitFunction=a,this}updateBefore({renderer:a}){a.compute(this)}setup(a){let b=this.computeNode.build(a);return b&&(a.getNodeProperties(this).outputComputeNode=b.outputNode,b.outputNode=null),b}generate(a,b){let{shaderStage:c}=a;if("compute"===c){let b=this.computeNode.build(a,"void");""!==b&&a.addLineFlowCode(b,this)}else{let c=a.getNodeProperties(this).outputComputeNode;if(c)return c.build(a,b)}}},kp=(a,b=[64])=>{(0===b.length||b.length>3)&&J("TSL: compute() workgroupSize must have 1, 2, or 3 elements");for(let a=0;a<b.length;a++){let c=b[a];("number"!=typeof c||c<=0||!Number.isInteger(c))&&J(`TSL: compute() workgroupSize element at index [ ${a} ] must be a positive integer`)}for(;b.length<3;)b.push(1);return g0(new ko(g0(a),b))},fr("compute",kq=(a,b,c)=>kp(a,c).setCount(b)),fr("computeKernel",kp),kr=class extends gm{static get type(){return"IsolateNode"}constructor(a,b=!0){super(),this.node=a,this.parent=b,this.isIsolateNode=!0}getNodeType(a){let b=a.getCache(),c=a.getCacheFromNode(this,this.parent);a.setCache(c);let d=this.node.getNodeType(a);return a.setCache(b),d}build(a,...b){let c=a.getCache(),d=a.getCacheFromNode(this,this.parent);a.setCache(d);let e=this.node.build(a,...b);return a.setCache(c),e}setParent(a){return this.parent=a,this}getParent(){return this.parent}},ks=a=>new kr(g0(a)),fr("cache",fx),fr("isolate",ks),fr("bypass",kt=g4(class extends gm{static get type(){return"BypassNode"}constructor(a,b){super(),this.isBypassNode=!0,this.outputNode=a,this.callNode=b}getNodeType(a){return this.outputNode.getNodeType(a)}generate(a){let b=this.callNode.build(a,"void");return""!==b&&a.addLineFlowCode(b,this),this.outputNode.build(a)}}).setParameterLength(2)),kv=g4(ku=class extends gm{static get type(){return"RemapNode"}constructor(a,b,c,d=he(0),e=he(1)){super(),this.node=a,this.inLowNode=b,this.inHighNode=c,this.outLowNode=d,this.outHighNode=e,this.doClamp=!0}setup(){let{node:a,inLowNode:b,inHighNode:c,outLowNode:d,outHighNode:e,doClamp:f}=this,g=a.sub(b).div(c.sub(b));return!0===f&&(g=g.clamp()),g.mul(e.sub(d)).add(d)}},null,null,{doClamp:!1}).setParameterLength(3,5),kw=g4(ku).setParameterLength(3,5),fr("remap",kv),fr("remapClamp",kw),ky=g4(kx=class extends gm{static get type(){return"ExpressionNode"}constructor(a="",b="void"){super(b),this.snippet=a}generate(a,b){let c=this.getNodeType(a),d=this.snippet;if("void"!==c)return a.format(d,c,b);a.addLineFlowCode(d,this)}}).setParameterLength(1,2),kz=a=>(a?jT(a,ky("discard")):ky("discard")).toStack(),kA=()=>ky("return").toStack(),fr("discard",kz),kB=class extends gp{static get type(){return"RenderOutputNode"}constructor(a,b,c){super("vec4"),this.colorNode=a,this._toneMapping=b,this.outputColorSpace=c,this.isRenderOutputNode=!0}setToneMapping(a){return this._toneMapping=a,this}getToneMapping(){return this._toneMapping}setup({context:a}){let b=this.colorNode||a.color,c=(null===this._toneMapping?a.toneMapping:this._toneMapping)||0,d=(null===this.outputColorSpace?a.outputColorSpace:this.outputColorSpace)||"";return 0!==c&&(b=b.toneMapping(c)),""!==d&&d!==bX.workingColorSpace&&(b=b.workingToColorSpace(d)),b}},fr("renderOutput",kC=(a,b=null,c=null)=>g0(new kB(g0(a),b,c))),kD=class extends gp{static get type(){return"DebugNode"}constructor(a,b=null){super(),this.node=a,this.callback=b}getNodeType(a){return this.node.getNodeType(a)}setup(a){return this.node.build(a)}analyze(a){return this.node.build(a)}generate(a){let b=this.callback,c=this.node.build(a),d="--- TSL debug - "+a.shaderStage+" shader ---",e="-".repeat(d.length),f="";return f+="// #"+d+`#
`+a.flow.code.replace(/^\t/gm,"")+`
`+("/* ... */ "+c)+` /* ... */
`+("// #"+e)+`#
`,null===b?H(f):b(a,f),c}},fr("debug",kE=(a,b=null)=>g0(new kD(g0(a),b)).toStack()),kF=class{constructor(){this._renderer=null,this.currentFrame=null}get nodeFrame(){return this._renderer._nodes.nodeFrame}setRenderer(a){return this._renderer=a,this}getRenderer(){return this._renderer}init(){}begin(){}finish(){}inspect(){}computeAsync(){}beginCompute(){}finishCompute(){}beginRender(){}finishRender(){}copyTextureToTexture(){}copyFramebufferToTexture(){}},kG=class extends gm{static get type(){return"InspectorNode"}constructor(a,b="",c=null){super(),this.node=a,this.name=b,this.callback=c,this.updateType=gd.FRAME,this.isInspectorNode=!0}getName(){return this.name||this.node.name}update(a){a.renderer.inspector.inspect(this)}getNodeType(a){return this.node.getNodeType(a)}setup(a){let b=this.node;return!0===a.context.inspector&&null!==this.callback&&(b=this.callback(b)),!0!==a.renderer.backend.isWebGPUBackend&&a.renderer.inspector.constructor!==kF&&K('TSL: ".toInspector()" is only available with WebGPU.'),b}},fr("toInspector",fy),kH=class extends gm{static get type(){return"AttributeNode"}constructor(a,b=null){super(b),this.global=!0,this._attributeName=a}getHash(a){return this.getAttributeName(a)}getNodeType(a){let b=this.nodeType;if(null===b){let c=this.getAttributeName(a);if(a.hasGeometryAttribute(c)){let d=a.geometry.getAttribute(c);b=a.getTypeFromAttribute(d)}else b="float"}return b}setAttributeName(a){return this._attributeName=a,this}getAttributeName(){return this._attributeName}generate(a){let b=this.getAttributeName(a),c=this.getNodeType(a);if(!0!==a.hasGeometryAttribute(b))return I(`AttributeNode: Vertex attribute "${b}" not found on geometry.`),a.generateConst(c);{let d=a.geometry.getAttribute(b),e=a.getTypeFromAttribute(d),f=a.getAttribute(b,e);return"vertex"===a.shaderStage?a.format(f.name,e,c):j3(this).build(a,c)}}serialize(a){super.serialize(a),a.global=this.global,a._attributeName=this._attributeName}deserialize(a){super.deserialize(a),this.global=a.global,this._attributeName=a._attributeName}},kI=(a,b=null)=>g0(new kH(a,b)),kJ=(a=0)=>kI("uv"+(a>0?a:""),"vec2"),kK=g4(class extends gm{static get type(){return"TextureSizeNode"}constructor(a,b=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=a,this.levelNode=b}generate(a,b){let c=this.textureNode.build(a,"property"),d=null===this.levelNode?"0":this.levelNode.build(a,"int");return a.format(`${a.getMethod("textureDimensions")}( ${c}, ${d} )`,this.getNodeType(a),b)}}).setParameterLength(1,2),kL=g4(class extends ic{static get type(){return"MaxMipLevelNode"}constructor(a){super(0),this._textureNode=a,this.updateType=gd.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){let a=this.texture,b=a.images,c=b&&b.length>0?b[0]&&b[0].image||b[0]:a.image;if(c&&void 0!==c.width){let{width:a,height:b}=c;this.value=Math.log2(Math.max(a,b))}}}).setParameterLength(1),kM=new b2,kN=class extends ic{static get type(){return"TextureNode"}constructor(a=kM,b=null,c=null,d=null){super(a),this.isTextureNode=!0,this.uvNode=b,this.levelNode=c,this.biasNode=d,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.offsetNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=gd.NONE,this.referenceNode=null,this._value=a,this._matrixUniform=null,this._flipYUniform=null,this.setUpdateMatrix(null===b)}set value(a){this.referenceNode?this.referenceNode.value=a:this._value=a}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return!0===this.value.isDepthTexture?"float":1014===this.value.type?"uvec4":1013===this.value.type?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return kJ(this.value.channel)}updateReference(){return this.value}getTransformedUV(a){return null===this._matrixUniform&&(this._matrixUniform=id(this.value.matrix)),this._matrixUniform.mul(hm(a,1)).xy}setUpdateMatrix(a){return this.updateMatrix=a,this}setupUV(a,b){return a.isFlipY()&&(null===this._flipYUniform&&(this._flipYUniform=id(!1)),b=b.toVar(),b=this.sampler?this._flipYUniform.select(b.flipY(),b):this._flipYUniform.select(b.setY(hf(kK(this,this.levelNode).y).sub(b.y).sub(1)),b)),b}setup(a){let b=a.getNodeProperties(this);b.referenceNode=this.referenceNode;let c=this.value;if(!c||!0!==c.isTexture)throw Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");let d=fu(()=>{let b=this.uvNode;return(null===b||!0===a.context.forceUVContext)&&a.context.getUV&&(b=a.context.getUV(this,a)),b||(b=this.getDefaultUV()),!0===this.updateMatrix&&(b=this.getTransformedUV(b)),b=this.setupUV(a,b),this.updateType=null!==this._matrixUniform||null!==this._flipYUniform?gd.OBJECT:gd.NONE,b})(),e=this.levelNode;null===e&&a.context.getTextureLevel&&(e=a.context.getTextureLevel(this)),b.uvNode=d,b.levelNode=e,b.biasNode=this.biasNode,b.compareNode=this.compareNode,b.gradNode=this.gradNode,b.depthNode=this.depthNode,b.offsetNode=this.offsetNode}generateUV(a,b){return b.build(a,!0===this.sampler?"vec2":"ivec2")}generateOffset(a,b){return b.build(a,"ivec2")}generateSnippet(a,b,c,d,e,f,g,h,i){let j=this.value;return e?a.generateTextureBias(j,b,c,e,f,i):h?a.generateTextureGrad(j,b,c,h,f,i):g?a.generateTextureCompare(j,b,c,g,f,i):!1===this.sampler?a.generateTextureLoad(j,b,c,d,f,i):d?a.generateTextureLevel(j,b,c,d,f,i):a.generateTexture(j,b,c,f,i)}generate(a,b){let c=this.value,d=a.getNodeProperties(this),e=super.generate(a,"property");if(/^sampler/.test(b))return e+"_sampler";if(a.isReference(b))return e;{let f=a.getDataFromNode(this),g=f.propertyName;if(void 0===g){let{uvNode:b,levelNode:c,biasNode:h,compareNode:i,depthNode:j,gradNode:k,offsetNode:l}=d,m=this.generateUV(a,b),n=c?c.build(a,"float"):null,o=h?h.build(a,"float"):null,p=j?j.build(a,"int"):null,q=i?i.build(a,"float"):null,r=k?[k[0].build(a,"vec2"),k[1].build(a,"vec2")]:null,s=l?this.generateOffset(a,l):null,t=a.getVarFromNode(this);g=a.getPropertyName(t);let u=this.generateSnippet(a,e,m,n,o,p,q,r,s);a.addLineFlowCode(`${g} = ${u}`,this),f.snippet=u,f.propertyName=g}let h=g,i=this.getNodeType(a);return a.needsToWorkingColorSpace(c)&&(h=ka(ky(h,i),c.colorSpace).setup(a).build(a,i)),a.format(h,i,b)}}setSampler(a){return this.sampler=a,this}getSampler(){return this.sampler}uv(a){return I("TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(a)}sample(a){let b=this.clone();return b.uvNode=g0(a),b.referenceNode=this.getBase(),g0(b)}load(a){return this.sample(a).setSampler(!1)}blur(a){let b=this.clone();b.biasNode=g0(a).mul(kL(b)),b.referenceNode=this.getBase();let c=b.value;return!1===b.generateMipmaps&&(c&&!1===c.generateMipmaps||1003===c.minFilter||1003===c.magFilter)&&(I("TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),b.biasNode=null),g0(b)}level(a){let b=this.clone();return b.levelNode=g0(a),b.referenceNode=this.getBase(),g0(b)}size(a){return kK(this,a)}bias(a){let b=this.clone();return b.biasNode=g0(a),b.referenceNode=this.getBase(),g0(b)}getBase(){return this.referenceNode?this.referenceNode.getBase():this}compare(a){let b=this.clone();return b.compareNode=g0(a),b.referenceNode=this.getBase(),g0(b)}grad(a,b){let c=this.clone();return c.gradNode=[g0(a),g0(b)],c.referenceNode=this.getBase(),g0(c)}depth(a){let b=this.clone();return b.depthNode=g0(a),b.referenceNode=this.getBase(),g0(b)}offset(a){let b=this.clone();return b.offsetNode=g0(a),b.referenceNode=this.getBase(),g0(b)}serialize(a){super.serialize(a),a.value=this.value.toJSON(a.meta).uuid,a.sampler=this.sampler,a.updateMatrix=this.updateMatrix,a.updateType=this.updateType}deserialize(a){super.deserialize(a),this.value=a.meta.textures[a.value],this.sampler=a.sampler,this.updateMatrix=a.updateMatrix,this.updateType=a.updateType}update(){let a=this.value,b=this._matrixUniform;null!==b&&(b.value=a.matrix),!0===a.matrixAutoUpdate&&a.updateMatrix();let c=this._flipYUniform;null!==c&&(c.value=a.image instanceof ImageBitmap&&!0===a.flipY||!0===a.isRenderTargetTexture||!0===a.isFramebufferTexture||!0===a.isDepthTexture)}clone(){let a=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return a.sampler=this.sampler,a.depthNode=this.depthNode,a.compareNode=this.compareNode,a.gradNode=this.gradNode,a.offsetNode=this.offsetNode,a}},kO=g4(kN).setParameterLength(1,4).setName("texture"),kP=(a=kM,b=null,c=null,d=null)=>{let e;return a&&!0===a.isTextureNode?((e=g0(a.clone())).referenceNode=a.getBase(),null!==b&&(e.uvNode=g0(b)),null!==c&&(e.levelNode=g0(c)),null!==d&&(e.biasNode=g0(d))):e=kO(a,b,c,d),e},kQ=(a=kM)=>kP(a),kR=(...a)=>kP(...a).setSampler(!1),kS=(a,b,c)=>kP(a,b).level(c),kT=a=>(!0===a.isNode?a:kP(a)).convert("sampler"),kU=a=>(!0===a.isNode?a:kP(a)).convert("samplerComparison"),kV=class extends ic{static get type(){return"BufferNode"}constructor(a,b,c=0){super(a,b),this.isBufferNode=!0,this.bufferType=b,this.bufferCount=c}getElementType(a){return this.getNodeType(a)}getInputType(){return"buffer"}},kW=(a,b,c)=>g0(new kV(a,b,c)),kX=class extends gn{static get type(){return"UniformArrayElementNode"}constructor(a,b){super(a,b),this.isArrayBufferElementNode=!0}generate(a){let b=super.generate(a),c=this.getNodeType(),d=this.node.getPaddedType();return a.format(b,d,c)}},kY=class extends kV{static get type(){return"UniformArrayNode"}constructor(a,b=null){super(null),this.array=a,this.elementType=null===b?fm(a[0]):b,this.paddedType=this.getPaddedType(),this.updateType=gd.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){let a=this.elementType,b="vec4";return"mat2"===a?b="mat2":!0===/mat/.test(a)?b="mat4":"i"===a.charAt(0)?b="ivec4":"u"===a.charAt(0)&&(b="uvec4"),b}update(){let{array:a,value:b}=this,c=this.elementType;if("float"===c||"int"===c||"uint"===c)for(let c=0;c<a.length;c++)b[4*c]=a[c];else if("color"===c)for(let c=0;c<a.length;c++){let d=4*c,e=a[c];b[d]=e.r,b[d+1]=e.g,b[d+2]=e.b||0}else if("mat2"===c)for(let c=0;c<a.length;c++){let d=4*c,e=a[c];b[d]=e.elements[0],b[d+1]=e.elements[1],b[d+2]=e.elements[2],b[d+3]=e.elements[3]}else if("mat3"===c)for(let c=0;c<a.length;c++){let d=16*c,e=a[c];b[d]=e.elements[0],b[d+1]=e.elements[1],b[d+2]=e.elements[2],b[d+4]=e.elements[3],b[d+5]=e.elements[4],b[d+6]=e.elements[5],b[d+8]=e.elements[6],b[d+9]=e.elements[7],b[d+10]=e.elements[8],b[d+15]=1}else if("mat4"===c)for(let c=0;c<a.length;c++){let d=16*c,e=a[c];for(let a=0;a<e.elements.length;a++)b[d+a]=e.elements[a]}else for(let c=0;c<a.length;c++){let d=4*c,e=a[c];b[d]=e.x,b[d+1]=e.y,b[d+2]=e.z||0,b[d+3]=e.w||0}}setup(a){let b=this.array.length,c=this.elementType,d=Float32Array,e=this.paddedType,f=a.getTypeLength(e);return"i"===c.charAt(0)&&(d=Int32Array),"u"===c.charAt(0)&&(d=Uint32Array),this.value=new d(b*f),this.bufferCount=b,this.bufferType=e,super.setup(a)}element(a){return g0(new kX(this,g0(a)))}},kZ=(a,b)=>g0(new kY(a,b)),k$=g4(class extends gm{constructor(a){super("float"),this.name=a,this.isBuiltinNode=!0}generate(){return this.name}}).setParameterLength(1),(k1=class a extends gm{static get type(){return"ScreenNode"}constructor(a){super(),this.scope=a,this._output=null,this.isViewportNode=!0}getNodeType(){return this.scope===a.DPR?"float":this.scope===a.VIEWPORT?"vec4":"vec2"}getUpdateType(){let b=gd.NONE;return(this.scope===a.SIZE||this.scope===a.VIEWPORT||this.scope===a.DPR)&&(b=gd.RENDER),this.updateType=b,b}update({renderer:b}){let c=b.getRenderTarget();this.scope===a.VIEWPORT?null===c?(b.getViewport(k0),k0.multiplyScalar(b.getPixelRatio())):k0.copy(c.viewport):this.scope===a.DPR?this._output.value=b.getPixelRatio():null===c?b.getDrawingBufferSize(k_):(k_.width=c.width,k_.height=c.height)}setup(){let b=this.scope,c=null;return c=b===a.SIZE?id(k_||(k_=new bO)):b===a.VIEWPORT?id(k0||(k0=new b3)):b===a.DPR?id(1):hi(k5.div(k4)),this._output=c,c}generate(b){if(this.scope===a.COORDINATE){let a=b.getFragCoord();if(b.isFlipY()){let c=b.getNodeProperties(k4).outputNode.build(b);a=`${b.getType("vec2")}( ${a}.x, ${c}.y - ${a}.y )`}return a}return super.generate(b)}}).COORDINATE="coordinate",k1.VIEWPORT="viewport",k1.SIZE="size",k1.UV="uv",k1.DPR="dpr",k2=g5(k1,k1.DPR),k3=g5(k1,k1.UV),k4=g5(k1,k1.SIZE),k5=g5(k1,k1.COORDINATE),k7=(k6=g5(k1,k1.VIEWPORT)).zw,k9=(k8=k5.sub(k6.xy)).div(k7),la=fu(()=>(I('TSL: "viewportResolution" is deprecated. Use "screenSize" instead.'),k4),"vec2").once()(),lb=id(0,"uint").setName("u_cameraIndex").setGroup(h8("cameraIndex")).toVarying("v_cameraIndex"),lc=id("float").setName("cameraNear").setGroup(ia).onRenderUpdate(({camera:a})=>a.near),ld=id("float").setName("cameraFar").setGroup(ia).onRenderUpdate(({camera:a})=>a.far),le=fu(({camera:a})=>{let b;if(a.isArrayCamera&&a.cameras.length>0){let c=[];for(let b of a.cameras)c.push(b.projectionMatrix);b=kZ(c).setGroup(ia).setName("cameraProjectionMatrices").element(a.isMultiViewCamera?k$("gl_ViewID_OVR"):lb).toConst("cameraProjectionMatrix")}else b=id("mat4").setName("cameraProjectionMatrix").setGroup(ia).onRenderUpdate(({camera:a})=>a.projectionMatrix);return b}).once()(),lf=fu(({camera:a})=>{let b;if(a.isArrayCamera&&a.cameras.length>0){let c=[];for(let b of a.cameras)c.push(b.projectionMatrixInverse);b=kZ(c).setGroup(ia).setName("cameraProjectionMatricesInverse").element(a.isMultiViewCamera?k$("gl_ViewID_OVR"):lb).toConst("cameraProjectionMatrixInverse")}else b=id("mat4").setName("cameraProjectionMatrixInverse").setGroup(ia).onRenderUpdate(({camera:a})=>a.projectionMatrixInverse);return b}).once()(),lg=fu(({camera:a})=>{let b;if(a.isArrayCamera&&a.cameras.length>0){let c=[];for(let b of a.cameras)c.push(b.matrixWorldInverse);b=kZ(c).setGroup(ia).setName("cameraViewMatrices").element(a.isMultiViewCamera?k$("gl_ViewID_OVR"):lb).toConst("cameraViewMatrix")}else b=id("mat4").setName("cameraViewMatrix").setGroup(ia).onRenderUpdate(({camera:a})=>a.matrixWorldInverse);return b}).once()(),lh=fu(({camera:a})=>{let b;if(a.isArrayCamera&&a.cameras.length>0){let c=[];for(let b of a.cameras)c.push(b.matrixWorld);b=kZ(c).setGroup(ia).setName("cameraWorldMatrices").element(a.isMultiViewCamera?k$("gl_ViewID_OVR"):lb).toConst("cameraWorldMatrix")}else b=id("mat4").setName("cameraWorldMatrix").setGroup(ia).onRenderUpdate(({camera:a})=>a.matrixWorld);return b}).once()(),li=fu(({camera:a})=>{let b;if(a.isArrayCamera&&a.cameras.length>0){let c=[];for(let b of a.cameras)c.push(b.normalMatrix);b=kZ(c).setGroup(ia).setName("cameraNormalMatrices").element(a.isMultiViewCamera?k$("gl_ViewID_OVR"):lb).toConst("cameraNormalMatrix")}else b=id("mat3").setName("cameraNormalMatrix").setGroup(ia).onRenderUpdate(({camera:a})=>a.normalMatrix);return b}).once()(),lj=fu(({camera:a})=>{let b;if(a.isArrayCamera&&a.cameras.length>0){let c=[];for(let b=0,d=a.cameras.length;b<d;b++)c.push(new bQ);b=kZ(c).setGroup(ia).setName("cameraPositions").onRenderUpdate(({camera:a},b)=>{let c=a.cameras,d=b.array;for(let a=0,b=c.length;a<b;a++)d[a].setFromMatrixPosition(c[a].matrixWorld)}).element(a.isMultiViewCamera?k$("gl_ViewID_OVR"):lb).toConst("cameraPosition")}else b=id(new bQ).setName("cameraPosition").setGroup(ia).onRenderUpdate(({camera:a},b)=>b.value.setFromMatrixPosition(a.matrixWorld));return b}).once()(),lk=fu(({camera:a})=>{let b;if(a.isArrayCamera&&a.cameras.length>0){let c=[];for(let b of a.cameras)c.push(b.viewport);b=kZ(c,"vec4").setGroup(ia).setName("cameraViewports").element(lb).toConst("cameraViewport")}else b=hq(0,0,k4.x,k4.y).toConst("cameraViewport");return b}).once()(),ll=new co,lm=class a extends gm{static get type(){return"Object3DNode"}constructor(a,b=null){super(),this.scope=a,this.object3d=b,this.updateType=gd.OBJECT,this.uniformNode=new ic(null)}getNodeType(){let b=this.scope;return b===a.WORLD_MATRIX?"mat4":b===a.POSITION||b===a.VIEW_POSITION||b===a.DIRECTION||b===a.SCALE?"vec3":b===a.RADIUS?"float":void 0}update(b){let c=this.object3d,d=this.uniformNode,e=this.scope;if(e===a.WORLD_MATRIX)d.value=c.matrixWorld;else if(e===a.POSITION)d.value=d.value||new bQ,d.value.setFromMatrixPosition(c.matrixWorld);else if(e===a.SCALE)d.value=d.value||new bQ,d.value.setFromMatrixScale(c.matrixWorld);else if(e===a.DIRECTION)d.value=d.value||new bQ,c.getWorldDirection(d.value);else if(e===a.VIEW_POSITION){let a=b.camera;d.value=d.value||new bQ,d.value.setFromMatrixPosition(c.matrixWorld),d.value.applyMatrix4(a.matrixWorldInverse)}else if(e===a.RADIUS){let a=b.object.geometry;null===a.boundingSphere&&a.computeBoundingSphere(),ll.copy(a.boundingSphere).applyMatrix4(c.matrixWorld),d.value=ll.radius}}generate(b){let c=this.scope;return c===a.WORLD_MATRIX?this.uniformNode.nodeType="mat4":c===a.POSITION||c===a.VIEW_POSITION||c===a.DIRECTION||c===a.SCALE?this.uniformNode.nodeType="vec3":c===a.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(b)}serialize(a){super.serialize(a),a.scope=this.scope}deserialize(a){super.deserialize(a),this.scope=a.scope}},lm.WORLD_MATRIX="worldMatrix",lm.POSITION="position",lm.SCALE="scale",lm.VIEW_POSITION="viewPosition",lm.DIRECTION="direction",lm.RADIUS="radius",ln=g4(lm,lm.DIRECTION).setParameterLength(1),lo=g4(lm,lm.WORLD_MATRIX).setParameterLength(1),lp=g4(lm,lm.POSITION).setParameterLength(1),lq=g4(lm,lm.SCALE).setParameterLength(1),lr=g4(lm,lm.VIEW_POSITION).setParameterLength(1),ls=g4(lm,lm.RADIUS).setParameterLength(1),lu=g5(lt=class extends lm{static get type(){return"ModelNode"}constructor(a){super(a)}update(a){this.object3d=a.object,super.update(a)}},lt.DIRECTION),lv=g5(lt,lt.WORLD_MATRIX),lw=g5(lt,lt.POSITION),lx=g5(lt,lt.SCALE),ly=g5(lt,lt.VIEW_POSITION),lz=g5(lt,lt.RADIUS),lA=id(new bT).onObjectUpdate(({object:a},b)=>b.value.getNormalMatrix(a.matrixWorld)),lB=id(new cx).onObjectUpdate(({object:a},b)=>b.value.copy(a.matrixWorld).invert()),lC=fu(a=>a.renderer.overrideNodes.modelViewMatrix||lD).once()().toVar("modelViewMatrix"),lD=lg.mul(lv),lE=fu(a=>(a.context.isHighPrecisionModelViewMatrix=!0,id("mat4").onObjectUpdate(({object:a,camera:b})=>a.modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,a.matrixWorld)))).once()().toVar("highpModelViewMatrix"),lF=fu(a=>{let b=a.context.isHighPrecisionModelViewMatrix;return id("mat3").onObjectUpdate(({object:a,camera:c})=>(!0!==b&&a.modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,a.matrixWorld),a.normalMatrix.getNormalMatrix(a.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix"),lH=(lG=kI("position","vec3")).toVarying("positionLocal"),lI=lG.toVarying("positionPrevious"),lJ=fu(a=>lv.mul(lH).xyz.toVarying(a.getSubBuildProperty("v_positionWorld")),"vec3").once(["POSITION"])(),lK=fu(()=>lH.transformDirection(lv).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),"vec3").once(["POSITION"])(),lL=fu(a=>a.context.setupPositionView().toVarying("v_positionView"),"vec3").once(["POSITION"])(),lM=fu(a=>(a.camera.isOrthographicCamera?hm(0,0,1):lL.negate().toVarying("v_positionViewDirection").normalize()).toVar("positionViewDirection"),"vec3").once(["POSITION"])(),lO=he(lN=g5(class extends gm{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(a){if("fragment"!==a.shaderStage)return"true";let{material:b}=a;return 1===b.side?"false":a.getFrontFacing()}})).mul(2).sub(1),lP=fu(([a],{material:b})=>{let c=b.side;return 1===c?a=a.mul(-1):2===c&&(a=a.mul(lO)),a}),lQ=kI("normal","vec3"),lR=fu(a=>!1===a.geometry.hasAttribute("normal")?(I('TSL: Vertex attribute "normal" not found on geometry.'),hm(0,1,0)):lQ,"vec3").once()().toVar("normalLocal"),lS=lL.dFdx().cross(lL.dFdy()).normalize().toVar("normalFlat"),lT=fu(a=>!0===a.material.flatShading?lS:lZ(lR).toVarying("v_normalViewGeometry").normalize(),"vec3").once()().toVar("normalViewGeometry"),lU=fu(a=>{let b=lT.transformDirection(lg);return!0!==a.material.flatShading&&(b=b.toVarying("v_normalWorldGeometry")),b.normalize().toVar("normalWorldGeometry")},"vec3").once()(),lV=fu(({subBuildFn:a,material:b,context:c})=>{let d;return"NORMAL"===a||"VERTEX"===a?(d=lT,!0!==b.flatShading&&(d=lP(d))):d=c.setupNormal().context({getUV:null}),d},"vec3").once(["NORMAL","VERTEX"])().toVar("normalView"),lW=lV.transformDirection(lg).toVar("normalWorld"),lX=fu(({subBuildFn:a,context:b})=>"NORMAL"===a||"VERTEX"===a?lV:b.setupClearcoatNormal().context({getUV:null}),"vec3").once(["NORMAL","VERTEX"])().toVar("clearcoatNormalView"),lY=fu(([a,b=lv])=>{let c=hv(b),d=a.div(hm(c[0].dot(c[0]),c[1].dot(c[1]),c[2].dot(c[2])));return c.mul(d).xyz}),lZ=fu(([a],b)=>{let c=b.renderer.overrideNodes.modelNormalViewMatrix;if(null!==c)return c.transformDirection(a);let d=lA.mul(a);return lg.transformDirection(d)}),l$=fu(()=>(I('TSL: "transformedNormalView" is deprecated. Use "normalView" instead.'),lV)).once(["NORMAL","VERTEX"])(),l_=fu(()=>(I('TSL: "transformedNormalWorld" is deprecated. Use "normalWorld" instead.'),lW)).once(["NORMAL","VERTEX"])(),l0=fu(()=>(I('TSL: "transformedClearcoatNormalView" is deprecated. Use "clearcoatNormalView" instead.'),lX)).once(["NORMAL","VERTEX"])(),l1=new cH,l2=new cx,l3=id(0).onReference(({material:a})=>a).onObjectUpdate(({material:a})=>a.refractionRatio),l4=id(1).onReference(({material:a})=>a).onObjectUpdate(function({material:a,scene:b}){return a.envMap?a.envMapIntensity:b.environmentIntensity}),l5=id(new cx).onReference(function(a){return a.material}).onObjectUpdate(function({material:a,scene:b}){let c=null!==b.environment&&null===a.envMap?b.environmentRotation:a.envMapRotation;return c?(l1.copy(c),l2.makeRotationFromEuler(l1)):l2.identity(),l2}),l6=lM.negate().reflect(lV),l7=lM.negate().refract(lV,l3),l8=l6.transformDirection(lg).toVar("reflectVector"),l9=l7.transformDirection(lg).toVar("reflectVector"),ma=new dX,mb=g4(class extends kN{static get type(){return"CubeTextureNode"}constructor(a,b=null,c=null,d=null){super(a,b,c,d),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){let a=this.value;return 301===a.mapping?l8:302===a.mapping?l9:(J('CubeTextureNode: Mapping "%s" not supported.',a.mapping),hm(0,0,0))}setUpdateMatrix(){}setupUV(a,b){let c=this.value;return 2001!==a.renderer.coordinateSystem&&c.isRenderTargetTexture||(b=hm(b.x.negate(),b.yz)),l5.mul(b)}generateUV(a,b){return b.build(a,!0===this.sampler?"vec3":"ivec3")}}).setParameterLength(1,4).setName("cubeTexture"),mc=(a=ma,b=null,c=null,d=null)=>{let e;return a&&!0===a.isCubeTextureNode?((e=g0(a.clone())).referenceNode=a,null!==b&&(e.uvNode=g0(b)),null!==c&&(e.levelNode=g0(c)),null!==d&&(e.biasNode=g0(d))):e=mb(a,b,c,d),e},md=(a=ma)=>mb(a),me=class extends gn{static get type(){return"ReferenceElementNode"}constructor(a,b){super(a,b),this.referenceNode=a,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(a){let b=super.generate(a),c=this.referenceNode.getNodeType(),d=this.getNodeType();return a.format(b,c,d)}},mf=class extends gm{static get type(){return"ReferenceNode"}constructor(a,b,c=null,d=null){super(),this.property=a,this.uniformType=b,this.object=c,this.count=d,this.properties=a.split("."),this.reference=c,this.node=null,this.group=null,this.name=null,this.updateType=gd.OBJECT}element(a){return g0(new me(this,g0(a)))}setGroup(a){return this.group=a,this}setName(a){return this.name=a,this}label(a){return I('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(a)}setNodeType(a){let b=null;b=null===this.count?Array.isArray(this.getValueFromReference())?kZ(null,a):"texture"===a?kP(null):"cubeTexture"===a?mc(null):id(null,a):kW(null,a,this.count),null!==this.group&&b.setGroup(this.group),null!==this.name&&b.setName(this.name),this.node=b}getNodeType(a){return null===this.node&&(this.updateReference(a),this.updateValue()),this.node.getNodeType(a)}getValueFromReference(a=this.reference){let{properties:b}=this,c=a[b[0]];for(let a=1;a<b.length;a++)c=c[b[a]];return c}updateReference(a){return this.reference=null===this.object?a.object:this.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){null===this.node&&this.setNodeType(this.uniformType);let a=this.getValueFromReference();Array.isArray(a)?this.node.array=a:this.node.value=a}},mg=(a,b,c)=>g0(new mf(a,b,c)),mh=(a,b,c,d)=>g0(new mf(a,b,d,c)),mi=class extends mf{static get type(){return"MaterialReferenceNode"}constructor(a,b,c=null){super(a,b,c),this.material=c,this.isMaterialReferenceNode=!0}updateReference(a){return this.reference=null===this.material?a.material:this.material,this.reference}},mj=(a,b,c=null)=>g0(new mi(a,b,c)),mk=kJ(),ml=lL.dFdx(),mm=lL.dFdy(),mn=mk.dFdx(),mo=mk.dFdy(),mp=lV,mq=mm.cross(mp),mr=mp.cross(ml),ms=mq.mul(mn.x).add(mr.mul(mo.x)),mt=mq.mul(mn.y).add(mr.mul(mo.y)),mv=(mu=ms.dot(ms).max(mt.dot(mt))).equal(0).select(0,mu.inverseSqrt()),mw=ms.mul(mv).toVar("tangentViewFrame"),mx=mt.mul(mv).toVar("bitangentViewFrame"),mz=(my=fu(a=>(!1===a.geometry.hasAttribute("tangent")&&a.geometry.computeTangents(),kI("tangent","vec4")))()).xyz.toVar("tangentLocal"),mB=(mA=fu(({subBuildFn:a,geometry:b,material:c})=>{let d;return d="VERTEX"===a||b.hasAttribute("tangent")?lC.mul(hq(mz,0)).xyz.toVarying("v_tangentView").normalize():mw,!0!==c.flatShading&&(d=lP(d)),d},"vec3").once(["NORMAL","VERTEX"])().toVar("tangentView")).transformDirection(lg).toVarying("v_tangentWorld").normalize().toVar("tangentWorld"),mD=(mC=fu(([a,b],{subBuildFn:c,material:d})=>{let e=a.mul(my.w).xyz;return"NORMAL"===c&&!0!==d.flatShading&&(e=e.toVarying(b)),e}).once(["NORMAL"]))(lQ.cross(my),"v_bitangentGeometry").normalize().toVar("bitangentGeometry"),mE=mC(lR.cross(mz),"v_bitangentLocal").normalize().toVar("bitangentLocal"),mF=fu(({subBuildFn:a,geometry:b,material:c})=>{let d;return d="VERTEX"===a||b.hasAttribute("tangent")?mC(lV.cross(mA),"v_bitangentView").normalize():mx,!0!==c.flatShading&&(d=lP(d)),d},"vec3").once(["NORMAL","VERTEX"])().toVar("bitangentView"),mG=mC(lW.cross(mB),"v_bitangentWorld").normalize().toVar("bitangentWorld"),mH=hv(mA,mF,lV).toVar("TBNViewMatrix"),mI=lM.mul(mH),mJ=(a,b)=>a.sub(mI.mul(b)),mK=fu(()=>{let a=hU.cross(lM);return jG(a=a.cross(hU).normalize(),lV,hS.mul(hI.oneMinus()).oneMinus().pow2().pow2()).normalize()}).once()(),mL=g4(class extends gp{static get type(){return"NormalMapNode"}constructor(a,b=null){super("vec3"),this.node=a,this.scaleNode=b,this.normalMapType=0}setup({material:a}){let{normalMapType:b,scaleNode:c}=this,d=this.node.mul(2).sub(1);if(null!==c){let b=c;!0===a.flatShading&&(b=lP(b)),d=hm(d.xy.mul(b),d.z)}let e=null;return 1===b?e=lZ(d):0===b?e=mH.mul(d).normalize():(J(`NodeMaterial: Unsupported normal map type: ${b}`),e=lV),e}}).setParameterLength(1,2),mM=fu(({textureNode:a,bumpScale:b})=>{let c=b=>a.isolate().context({getUV:a=>b(a.uvNode||kJ()),forceUVContext:!0}),d=he(c(a=>a));return hi(he(c(a=>a.add(a.dFdx()))).sub(d),he(c(a=>a.add(a.dFdy()))).sub(d)).mul(b)}),mN=fu(a=>{let{surf_pos:b,surf_norm:c,dHdxy:d}=a,e=b.dFdx().normalize(),f=b.dFdy().normalize().cross(c),g=c.cross(e),h=e.dot(f).mul(lO),i=h.sign().mul(d.x.mul(f).add(d.y.mul(g)));return h.abs().mul(c).sub(i).normalize()}),mO=g4(class extends gp{static get type(){return"BumpMapNode"}constructor(a,b=null){super("vec3"),this.textureNode=a,this.scaleNode=b}setup(){let a=null===this.scaleNode?1:this.scaleNode;return mN({surf_pos:lL,surf_norm:lV,dHdxy:mM({textureNode:this.textureNode,bumpScale:a})})}}).setParameterLength(1,2),mP=new Map,(mQ=class a extends gm{static get type(){return"MaterialNode"}constructor(a){super(),this.scope=a}getCache(a,b){let c=mP.get(a);return void 0===c&&(c=mj(a,b),mP.set(a,c)),c}getFloat(a){return this.getCache(a,"float")}getColor(a){return this.getCache(a,"color")}getTexture(a){return this.getCache("map"===a?"map":a+"Map","texture")}setup(b){let c=b.context.material,d=this.scope,e=null;if(d===a.COLOR){let a=void 0===c.color?hm():this.getColor(d);e=c.map&&!0===c.map.isTexture?a.mul(this.getTexture("map")):a}else if(d===a.OPACITY){let a=this.getFloat(d);e=c.alphaMap&&!0===c.alphaMap.isTexture?a.mul(this.getTexture("alpha")):a}else if(d===a.SPECULAR_STRENGTH)e=c.specularMap&&!0===c.specularMap.isTexture?this.getTexture("specular").r:he(1);else if(d===a.SPECULAR_INTENSITY){let a=this.getFloat(d);e=c.specularIntensityMap&&!0===c.specularIntensityMap.isTexture?a.mul(this.getTexture(d).a):a}else if(d===a.SPECULAR_COLOR){let a=this.getColor(d);e=c.specularColorMap&&!0===c.specularColorMap.isTexture?a.mul(this.getTexture(d).rgb):a}else if(d===a.ROUGHNESS){let a=this.getFloat(d);e=c.roughnessMap&&!0===c.roughnessMap.isTexture?a.mul(this.getTexture(d).g):a}else if(d===a.METALNESS){let a=this.getFloat(d);e=c.metalnessMap&&!0===c.metalnessMap.isTexture?a.mul(this.getTexture(d).b):a}else if(d===a.EMISSIVE){let a=this.getFloat("emissiveIntensity"),b=this.getColor(d).mul(a);e=c.emissiveMap&&!0===c.emissiveMap.isTexture?b.mul(this.getTexture(d)):b}else if(d===a.NORMAL)c.normalMap?(e=mL(this.getTexture("normal"),this.getCache("normalScale","vec2"))).normalMapType=c.normalMapType:e=c.bumpMap?mO(this.getTexture("bump").r,this.getFloat("bumpScale")):lV;else if(d===a.CLEARCOAT){let a=this.getFloat(d);e=c.clearcoatMap&&!0===c.clearcoatMap.isTexture?a.mul(this.getTexture(d).r):a}else if(d===a.CLEARCOAT_ROUGHNESS){let a=this.getFloat(d);e=c.clearcoatRoughnessMap&&!0===c.clearcoatRoughnessMap.isTexture?a.mul(this.getTexture(d).r):a}else if(d===a.CLEARCOAT_NORMAL)e=c.clearcoatNormalMap?mL(this.getTexture(d),this.getCache(d+"Scale","vec2")):lV;else if(d===a.SHEEN){let a=this.getColor("sheenColor").mul(this.getFloat("sheen"));e=c.sheenColorMap&&!0===c.sheenColorMap.isTexture?a.mul(this.getTexture("sheenColor").rgb):a}else if(d===a.SHEEN_ROUGHNESS){let a=this.getFloat(d);e=(e=c.sheenRoughnessMap&&!0===c.sheenRoughnessMap.isTexture?a.mul(this.getTexture(d).a):a).clamp(.07,1)}else if(d===a.ANISOTROPY)if(c.anisotropyMap&&!0===c.anisotropyMap.isTexture){let a=this.getTexture(d);e=hu(nq.x,nq.y,nq.y.negate(),nq.x).mul(a.rg.mul(2).sub(hi(1)).normalize().mul(a.b))}else e=nq;else if(d===a.IRIDESCENCE_THICKNESS){let a=mg("1","float",c.iridescenceThicknessRange);if(c.iridescenceThicknessMap){let b=mg("0","float",c.iridescenceThicknessRange);e=a.sub(b).mul(this.getTexture(d).g).add(b)}else e=a}else if(d===a.TRANSMISSION){let a=this.getFloat(d);e=c.transmissionMap?a.mul(this.getTexture(d).r):a}else if(d===a.THICKNESS){let a=this.getFloat(d);e=c.thicknessMap?a.mul(this.getTexture(d).g):a}else if(d===a.IOR)e=this.getFloat(d);else if(d===a.LIGHT_MAP)e=this.getTexture(d).rgb.mul(this.getFloat("lightMapIntensity"));else if(d===a.AO)e=this.getTexture(d).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(d===a.LINE_DASH_OFFSET)e=c.dashOffset?this.getFloat(d):he(0);else{let a=this.getNodeType(b);e=this.getCache(d,a)}return e}}).ALPHA_TEST="alphaTest",mQ.COLOR="color",mQ.OPACITY="opacity",mQ.SHININESS="shininess",mQ.SPECULAR="specular",mQ.SPECULAR_STRENGTH="specularStrength",mQ.SPECULAR_INTENSITY="specularIntensity",mQ.SPECULAR_COLOR="specularColor",mQ.REFLECTIVITY="reflectivity",mQ.ROUGHNESS="roughness",mQ.METALNESS="metalness",mQ.NORMAL="normal",mQ.CLEARCOAT="clearcoat",mQ.CLEARCOAT_ROUGHNESS="clearcoatRoughness",mQ.CLEARCOAT_NORMAL="clearcoatNormal",mQ.EMISSIVE="emissive",mQ.ROTATION="rotation",mQ.SHEEN="sheen",mQ.SHEEN_ROUGHNESS="sheenRoughness",mQ.ANISOTROPY="anisotropy",mQ.IRIDESCENCE="iridescence",mQ.IRIDESCENCE_IOR="iridescenceIOR",mQ.IRIDESCENCE_THICKNESS="iridescenceThickness",mQ.IOR="ior",mQ.TRANSMISSION="transmission",mQ.THICKNESS="thickness",mQ.ATTENUATION_DISTANCE="attenuationDistance",mQ.ATTENUATION_COLOR="attenuationColor",mQ.LINE_SCALE="scale",mQ.LINE_DASH_SIZE="dashSize",mQ.LINE_GAP_SIZE="gapSize",mQ.LINE_WIDTH="linewidth",mQ.LINE_DASH_OFFSET="dashOffset",mQ.POINT_SIZE="size",mQ.DISPERSION="dispersion",mQ.LIGHT_MAP="light",mQ.AO="ao",mR=g5(mQ,mQ.ALPHA_TEST),mS=g5(mQ,mQ.COLOR),mT=g5(mQ,mQ.SHININESS),mU=g5(mQ,mQ.EMISSIVE),mV=g5(mQ,mQ.OPACITY),mW=g5(mQ,mQ.SPECULAR),mX=g5(mQ,mQ.SPECULAR_INTENSITY),mY=g5(mQ,mQ.SPECULAR_COLOR),mZ=g5(mQ,mQ.SPECULAR_STRENGTH),m$=g5(mQ,mQ.REFLECTIVITY),m_=g5(mQ,mQ.ROUGHNESS),m0=g5(mQ,mQ.METALNESS),m1=g5(mQ,mQ.NORMAL),m2=g5(mQ,mQ.CLEARCOAT),m3=g5(mQ,mQ.CLEARCOAT_ROUGHNESS),m4=g5(mQ,mQ.CLEARCOAT_NORMAL),m5=g5(mQ,mQ.ROTATION),m6=g5(mQ,mQ.SHEEN),m7=g5(mQ,mQ.SHEEN_ROUGHNESS),m8=g5(mQ,mQ.ANISOTROPY),m9=g5(mQ,mQ.IRIDESCENCE),na=g5(mQ,mQ.IRIDESCENCE_IOR),nb=g5(mQ,mQ.IRIDESCENCE_THICKNESS),nc=g5(mQ,mQ.TRANSMISSION),nd=g5(mQ,mQ.THICKNESS),ne=g5(mQ,mQ.IOR),nf=g5(mQ,mQ.ATTENUATION_DISTANCE),ng=g5(mQ,mQ.ATTENUATION_COLOR),nh=g5(mQ,mQ.LINE_SCALE),ni=g5(mQ,mQ.LINE_DASH_SIZE),nj=g5(mQ,mQ.LINE_GAP_SIZE),nk=g5(mQ,mQ.LINE_WIDTH),nl=g5(mQ,mQ.LINE_DASH_OFFSET),nm=g5(mQ,mQ.POINT_SIZE),nn=g5(mQ,mQ.DISPERSION),no=g5(mQ,mQ.LIGHT_MAP),np=g5(mQ,mQ.AO),nq=id(new bO).onReference(function(a){return a.material}).onRenderUpdate(function({material:a}){this.value.set(a.anisotropy*Math.cos(a.anisotropyRotation),a.anisotropy*Math.sin(a.anisotropyRotation))}),nr=fu(a=>a.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection"),(ns=class a extends gm{static get type(){return"IndexNode"}constructor(a){super("uint"),this.scope=a,this.isIndexNode=!0}generate(b){let c=this.getNodeType(b),d=this.scope,e;if(d===a.VERTEX)e=b.getVertexIndex();else if(d===a.INSTANCE)e=b.getInstanceIndex();else if(d===a.DRAW)e=b.getDrawIndex();else if(d===a.INVOCATION_LOCAL)e=b.getInvocationLocalIndex();else if(d===a.INVOCATION_SUBGROUP)e=b.getInvocationSubgroupIndex();else if(d===a.SUBGROUP)e=b.getSubgroupIndex();else throw Error("THREE.IndexNode: Unknown scope: "+d);return"vertex"===b.shaderStage||"compute"===b.shaderStage?e:j3(this).build(b,c)}}).VERTEX="vertex",ns.INSTANCE="instance",ns.SUBGROUP="subgroup",ns.INVOCATION_LOCAL="invocationLocal",ns.INVOCATION_SUBGROUP="invocationSubgroup",ns.DRAW="draw",nt=g5(ns,ns.VERTEX),nu=g5(ns,ns.INSTANCE),nv=g5(ns,ns.SUBGROUP),nw=g5(ns,ns.INVOCATION_SUBGROUP),nx=g5(ns,ns.INVOCATION_LOCAL),ny=g5(ns,ns.DRAW),nz=class extends gm{static get type(){return"InstanceNode"}constructor(a,b,c=null){super("void"),this.count=a,this.instanceMatrix=b,this.instanceColor=c,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=gd.FRAME,this.buffer=null,this.bufferColor=null}setup(a){let{instanceMatrix:b,instanceColor:c}=this,{count:d}=b,{instanceMatrixNode:e,instanceColorNode:f}=this;if(null===e){if(d<=1e3)e=kW(b.array,"mat4",Math.max(d,1)).element(nu);else{let a=new fg(b.array,16,1);this.buffer=a;let c=35048===b.usage?kn:km;e=hw(c(a,"vec4",16,0),c(a,"vec4",16,4),c(a,"vec4",16,8),c(a,"vec4",16,12))}this.instanceMatrixNode=e}if(c&&null===f){let a=new d6(c.array,3),b=35048===c.usage?kn:km;this.bufferColor=a,f=hm(b(a,"vec3",3,0)),this.instanceColorNode=f}let g=e.mul(lH).xyz;if(lH.assign(g),a.hasGeometryAttribute("normal")){let a=lY(lR,e);lR.assign(a)}null!==this.instanceColorNode&&hF("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){null!==this.buffer&&(this.buffer.clearUpdateRanges(),this.buffer.updateRanges.push(...this.instanceMatrix.updateRanges),35048!==this.instanceMatrix.usage&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version)),this.instanceColor&&null!==this.bufferColor&&(this.bufferColor.clearUpdateRanges(),this.bufferColor.updateRanges.push(...this.instanceColor.updateRanges),35048!==this.instanceColor.usage&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version))}},nA=g4(nz).setParameterLength(2,3),nB=g4(class extends nz{static get type(){return"InstancedMeshNode"}constructor(a){let{count:b,instanceMatrix:c,instanceColor:d}=a;super(b,c,d),this.instancedMesh=a}}).setParameterLength(1),nC=g4(class extends gm{static get type(){return"BatchNode"}constructor(a){super("void"),this.batchMesh=a,this.batchingIdNode=null}setup(a){null===this.batchingIdNode&&(null===a.getDrawIndex()?this.batchingIdNode=nu:this.batchingIdNode=ny);let b=fu(([a])=>{let b=hf(kK(kR(this.batchMesh._indirectTexture),0).x),c=hf(a).mod(b),d=hf(a).div(b);return kR(this.batchMesh._indirectTexture,hj(c,d)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(hf(this.batchingIdNode)),c=this.batchMesh._matricesTexture,d=hf(kK(kR(c),0).x),e=he(b).mul(4).toInt().toVar(),f=e.mod(d),g=e.div(d),h=hw(kR(c,hj(f,g)),kR(c,hj(f.add(1),g)),kR(c,hj(f.add(2),g)),kR(c,hj(f.add(3),g))),i=this.batchMesh._colorsTexture;if(null!==i){let a=fu(([a])=>{let b=hf(kK(kR(i),0).x);return kR(i,hj(a.mod(b),a.div(b))).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(b);hF("vec3","vBatchColor").assign(a)}let j=hv(h);lH.assign(h.mul(lH));let k=lR.div(hm(j[0].dot(j[0]),j[1].dot(j[1]),j[2].dot(j[2]))),l=j.mul(k).xyz;lR.assign(l),a.hasGeometryAttribute("tangent")&&mz.mulAssign(j)}}).setParameterLength(1),nD=g4(class extends gn{static get type(){return"StorageArrayElementNode"}constructor(a,b){super(a,b),this.isStorageArrayElementNode=!0}set storageBufferNode(a){this.node=a}get storageBufferNode(){return this.node}getMemberType(a,b){let c=this.storageBufferNode.structTypeNode;return c?c.getMemberType(a,b):"void"}setup(a){return!1===a.isAvailable("storageBuffer")&&!0===this.node.isPBO&&a.setupPBO(this.node),super.setup(a)}generate(a,b){let c,d=a.context.assign;if(c=!1===a.isAvailable("storageBuffer")?!0===this.node.isPBO&&!0!==d&&(this.node.value.isInstancedBufferAttribute||"compute"!==a.shaderStage)?a.generatePBO(this):this.node.build(a):super.generate(a),!0!==d){let d=this.getNodeType(a);c=a.format(c,d,b)}return c}}).setParameterLength(2),nE=class extends kV{static get type(){return"StorageBufferNode"}constructor(a,b=null,c=0){var d;let e,f=null;b&&b.isStruct?(e="struct",f=b.layout,(a.isStorageBufferAttribute||a.isStorageInstancedBufferAttribute)&&(c=a.count)):null===b&&(a.isStorageBufferAttribute||a.isStorageInstancedBufferAttribute)?(d=a.itemSize,e=ga.get(d),c=a.count):e=b,super(a,e,c),this.isStorageBufferNode=!0,this.structTypeNode=f,this.access=gf.READ_WRITE,this.isAtomic=!1,this.isPBO=!1,this._attribute=null,this._varying=null,this.global=!0,!0!==a.isStorageBufferAttribute&&!0!==a.isStorageInstancedBufferAttribute&&(a.isInstancedBufferAttribute?a.isStorageInstancedBufferAttribute=!0:a.isStorageBufferAttribute=!0)}getHash(a){if(0===this.bufferCount){let b=a.globalCache.getData(this.value);return void 0===b&&(b={node:this},a.globalCache.setData(this.value,b)),b.node.uuid}return this.uuid}getInputType(){return this.value.isIndirectStorageBufferAttribute?"indirectStorageBuffer":"storageBuffer"}element(a){return nD(this,a)}setPBO(a){return this.isPBO=a,this}getPBO(){return this.isPBO}setAccess(a){return this.access=a,this}toReadOnly(){return this.setAccess(gf.READ_ONLY)}setAtomic(a){return this.isAtomic=a,this}toAtomic(){return this.setAtomic(!0)}getAttributeData(){return null===this._attribute&&(this._attribute=kk(this.value),this._varying=j3(this._attribute)),{attribute:this._attribute,varying:this._varying}}getNodeType(a){if(null!==this.structTypeNode)return this.structTypeNode.getNodeType(a);if(a.isAvailable("storageBuffer")||a.isAvailable("indirectStorageBuffer"))return super.getNodeType(a);let{attribute:b}=this.getAttributeData();return b.getNodeType(a)}getMemberType(a,b){return null===this.structTypeNode?"void":this.structTypeNode.getMemberType(a,b)}generate(a){if(null!==this.structTypeNode&&this.structTypeNode.build(a),a.isAvailable("storageBuffer")||a.isAvailable("indirectStorageBuffer"))return super.generate(a);let{attribute:b,varying:c}=this.getAttributeData(),d=c.build(a);return a.registerTransform(d,b),d}},nF=(a,b=null,c=0)=>g0(new nE(a,b,c)),nG=(a,b,c)=>(I('TSL: "storageObject()" is deprecated. Use "storage().setPBO( true )" instead.'),nF(a,b,c).setPBO(!0)),nH=new WeakMap,nI=class extends gm{static get type(){return"SkinningNode"}constructor(a){super("void"),this.skinnedMesh=a,this.updateType=gd.OBJECT,this.skinIndexNode=kI("skinIndex","uvec4"),this.skinWeightNode=kI("skinWeight","vec4"),this.bindMatrixNode=mg("bindMatrix","mat4"),this.bindMatrixInverseNode=mg("bindMatrixInverse","mat4"),this.boneMatricesNode=mh("skeleton.boneMatrices","mat4",a.skeleton.bones.length),this.positionNode=lH,this.toPositionNode=lH,this.previousBoneMatricesNode=null}getSkinnedPosition(a=this.boneMatricesNode,b=this.positionNode){let{skinIndexNode:c,skinWeightNode:d,bindMatrixNode:e,bindMatrixInverseNode:f}=this,g=a.element(c.x),h=a.element(c.y),i=a.element(c.z),j=a.element(c.w),k=e.mul(b),l=im(g.mul(d.x).mul(k),h.mul(d.y).mul(k),i.mul(d.z).mul(k),j.mul(d.w).mul(k));return f.mul(l).xyz}getSkinnedNormal(a=this.boneMatricesNode,b=lR){let{skinIndexNode:c,skinWeightNode:d,bindMatrixNode:e,bindMatrixInverseNode:f}=this,g=a.element(c.x),h=a.element(c.y),i=a.element(c.z),j=a.element(c.w),k=im(d.x.mul(g),d.y.mul(h),d.z.mul(i),d.w.mul(j));return(k=f.mul(k).mul(e)).transformDirection(b).xyz}getPreviousSkinnedPosition(a){let b=a.object;return null===this.previousBoneMatricesNode&&(b.skeleton.previousBoneMatrices=new Float32Array(b.skeleton.boneMatrices),this.previousBoneMatricesNode=mh("skeleton.previousBoneMatrices","mat4",b.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,lI)}needsPreviousBoneMatrices(a){let b=a.renderer.getMRT();return b&&b.has("velocity")||!0===fo(a.object).useVelocity}setup(a){this.needsPreviousBoneMatrices(a)&&lI.assign(this.getPreviousSkinnedPosition(a));let b=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(b),a.hasGeometryAttribute("normal")){let b=this.getSkinnedNormal();lR.assign(b),a.hasGeometryAttribute("tangent")&&mz.assign(b)}return b}generate(a,b){if("void"!==b)return super.generate(a,b)}update(a){let b=a.object&&a.object.skeleton?a.object.skeleton:this.skinnedMesh.skeleton;nH.get(b)!==a.frameId&&(nH.set(b,a.frameId),null!==this.previousBoneMatricesNode&&b.previousBoneMatrices.set(b.boneMatrices),b.update())}},nJ=a=>g0(new nI(a)),nK=(a,b=null)=>{let c=new nI(a);return c.positionNode=nF(new d6(a.geometry.getAttribute("position").array,3),"vec3").setPBO(!0).toReadOnly().element(nu).toVar(),c.skinIndexNode=nF(new d6(new Uint32Array(a.geometry.getAttribute("skinIndex").array),4),"uvec4").setPBO(!0).toReadOnly().element(nu).toVar(),c.skinWeightNode=nF(new d6(a.geometry.getAttribute("skinWeight").array,4),"vec4").setPBO(!0).toReadOnly().element(nu).toVar(),c.bindMatrixNode=id(a.bindMatrix,"mat4"),c.bindMatrixInverseNode=id(a.bindMatrixInverse,"mat4"),c.boneMatricesNode=kW(a.skeleton.boneMatrices,"mat4",a.skeleton.bones.length),c.toPositionNode=b,g0(c)},nL=class extends gm{static get type(){return"LoopNode"}constructor(a=[]){super("void"),this.params=a}getVarName(a){return String.fromCharCode(105+a)}getProperties(a){let b=a.getNodeProperties(this);if(void 0!==b.stackNode)return b;let c={};for(let a=0,b=this.params.length-1;a<b;a++){let b=this.params[a],d=!0!==b.isNode&&b.name||this.getVarName(a);c[d]=ky(d,!0!==b.isNode&&b.type||"int")}let d=a.addStack(),e=this.params[this.params.length-1](c);b.returnsNode=e.context({nodeLoop:e}),b.stackNode=d;let f=this.params[0];if(!0!==f.isNode&&"function"==typeof f.update){let a=fu(this.params[0].update)(c);b.updateNode=a.context({nodeLoop:a})}return a.removeStack(),b}setup(a){this.getProperties(a),a.fnCall&&(a.getDataFromNode(a.fnCall.shaderNode).hasLoop=!0)}generate(a){let b=this.getProperties(a),c=this.params,d=b.stackNode;for(let d=0,e=c.length-1;d<e;d++){let e,f=c[d],g=!1,h=null,i=null,j=null,k=null,l=null,m=null;if(f.isNode?"bool"===f.getNodeType(a)?(g=!0,k="bool",i=f.build(a,k)):(k="int",j=this.getVarName(d),h="0",i=f.build(a,k),l="<"):(k=f.type||"int",j=f.name||this.getVarName(d),h=f.start,i=f.end,l=f.condition,m=f.update,"number"==typeof h?h=a.generateConst(k,h):h&&h.isNode&&(h=h.build(a,k)),"number"==typeof i?i=a.generateConst(k,i):i&&i.isNode&&(i=i.build(a,k)),void 0!==h&&void 0===i?(h+=" - 1",i="0",l=">="):void 0!==i&&void 0===h&&(h="0",l="<"),void 0===l&&(l=Number(h)>Number(i)?">=":"<")),g)e=`while ( ${i} )`;else{let c=h,d=i,f,g=()=>l.includes("<")?"+=":"-=";if(null!=m)switch(typeof m){case"function":f=a.flowStagesNode(b.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":f=j+" "+g()+" "+a.generateConst(k,m);break;case"string":f=j+" "+m;break;default:m.isNode?f=j+" "+g()+" "+m.build(a):(J("TSL: 'Loop( { update: ... } )' is not a function, string or number."),f="break /* invalid update */")}else f=j+" "+(m="int"===k||"uint"===k?l.includes("<")?"++":"--":g()+" 1.");e=`for ( ${a.getVar(k,j)+" = "+c}; ${j+" "+l+" "+d}; ${f} )`}a.addFlowCode((0===d?`
`:"")+a.tab+e+` {

`).addFlowTab()}let e=d.build(a,"void");b.returnsNode.build(a,"void"),a.removeFlowTab().addFlowCode(`
`+a.tab+e);for(let b=0,c=this.params.length-1;b<c;b++)a.addFlowCode((0===b?"":a.tab)+`}

`).removeFlowTab();a.addFlowTab()}},nM=(...a)=>new nL(g3(a,"int")).toStack(),nN=()=>ky("continue").toStack(),nO=()=>ky("break").toStack(),nP=new WeakMap,nQ=new b3,nR=fu(({bufferMap:a,influence:b,stride:c,width:d,depth:e,offset:f})=>{let g=hf(nt).mul(c).add(f),h=g.div(d);return kR(a,hj(g.sub(h.mul(d)),h)).depth(e).xyz.mul(b)}),nS=g4(class extends gm{static get type(){return"MorphNode"}constructor(a){super("void"),this.mesh=a,this.morphBaseInfluence=id(1),this.updateType=gd.OBJECT}setup(a){let{geometry:b}=a,c=void 0!==b.morphAttributes.position,d=b.hasAttribute("normal")&&void 0!==b.morphAttributes.normal,e=b.morphAttributes.position||b.morphAttributes.normal||b.morphAttributes.color,f=void 0===e?0:e.length,{texture:g,stride:h,size:i}=function(a){let b=void 0!==a.morphAttributes.position,c=void 0!==a.morphAttributes.normal,d=void 0!==a.morphAttributes.color,e=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,f=void 0===e?0:e.length,g=nP.get(a);if(void 0===g||g.count!==f){let e=function(){o.dispose(),nP.delete(a),a.removeEventListener("dispose",e)};void 0!==g&&g.texture.dispose();let h=a.morphAttributes.position||[],i=a.morphAttributes.normal||[],j=a.morphAttributes.color||[],k=0;!0===b&&(k=1),!0===c&&(k=2),!0===d&&(k=3);let l=a.attributes.position.count*k,m=1;l>4096&&(m=Math.ceil(l/4096),l=4096);let n=new Float32Array(l*m*4*f),o=new b6(n,l,m,f);o.type=aF,o.needsUpdate=!0;let p=4*k;for(let a=0;a<f;a++){let e=h[a],f=i[a],g=j[a],k=l*m*4*a;for(let a=0;a<e.count;a++){let h=a*p;!0===b&&(nQ.fromBufferAttribute(e,a),n[k+h+0]=nQ.x,n[k+h+1]=nQ.y,n[k+h+2]=nQ.z,n[k+h+3]=0),!0===c&&(nQ.fromBufferAttribute(f,a),n[k+h+4]=nQ.x,n[k+h+5]=nQ.y,n[k+h+6]=nQ.z,n[k+h+7]=0),!0===d&&(nQ.fromBufferAttribute(g,a),n[k+h+8]=nQ.x,n[k+h+9]=nQ.y,n[k+h+10]=nQ.z,n[k+h+11]=4===g.itemSize?nQ.w:1)}}g={count:f,texture:o,stride:k,size:new bO(l,m)},nP.set(a,g),a.addEventListener("dispose",e)}return g}(b);!0===c&&lH.mulAssign(this.morphBaseInfluence),!0===d&&lR.mulAssign(this.morphBaseInfluence);let j=hf(i.width);nM(f,({i:a})=>{let b=he(0).toVar();this.mesh.count>1&&null!==this.mesh.morphTexture&&void 0!==this.mesh.morphTexture?b.assign(kR(this.mesh.morphTexture,hj(hf(a).add(1),hf(nu))).r):b.assign(mg("morphTargetInfluences","float").element(a).toVar()),hb(b.notEqual(0),()=>{!0===c&&lH.addAssign(nR({bufferMap:g,influence:b,stride:h,width:j,depth:a,offset:hf(0)})),!0===d&&lR.addAssign(nR({bufferMap:g,influence:b,stride:h,width:j,depth:a,offset:hf(1)}))})})}update(){let a=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?a.value=1:a.value=1-this.mesh.morphTargetInfluences.reduce((a,b)=>a+b,0)}}).setParameterLength(1),nT=class extends gm{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}},nU=class extends nT{static get type(){return"AONode"}constructor(a=null){super(),this.aoNode=a}setup(a){a.context.ambientOcclusion.mulAssign(this.aoNode)}},nV=g4(class extends jU{static get type(){return"LightingContextNode"}constructor(a,b=null,c=null,d=null){super(a),this.lightingModel=b,this.backdropNode=c,this.backdropAlphaNode=d,this._value=null}getContext(){let{backdropNode:a,backdropAlphaNode:b}=this,c={directDiffuse:hm().toVar("directDiffuse"),directSpecular:hm().toVar("directSpecular"),indirectDiffuse:hm().toVar("indirectDiffuse"),indirectSpecular:hm().toVar("indirectSpecular")};return{radiance:hm().toVar("radiance"),irradiance:hm().toVar("irradiance"),iblIrradiance:hm().toVar("iblIrradiance"),ambientOcclusion:he(1).toVar("ambientOcclusion"),reflectedLight:c,backdrop:a,backdropAlpha:b}}setup(a){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||a.context.lightingModel,super.setup(a)}}),nW=class extends nT{static get type(){return"IrradianceNode"}constructor(a){super(),this.node=a}setup(a){a.context.irradiance.addAssign(this.node)}},nX=new bO,nY=class extends kN{static get type(){return"ViewportTextureNode"}constructor(a=k3,b=null,c=null){let d=null;null===c?((d=new ek).minFilter=ax,c=d):d=c,super(c,a,b),this.generateMipmaps=!1,this.defaultFramebuffer=d,this.isOutputTextureNode=!0,this.updateBeforeType=gd.FRAME,this._cacheTextures=new WeakMap}getTextureForReference(a=null){let b,c;if(this.referenceNode?(b=this.referenceNode.defaultFramebuffer,c=this.referenceNode._cacheTextures):(b=this.defaultFramebuffer,c=this._cacheTextures),null===a)return b;if(!1===c.has(a)){let d=b.clone();c.set(a,d)}return c.get(a)}updateReference(a){let b=a.renderer.getRenderTarget();return this.value=this.getTextureForReference(b),this.value}updateBefore(a){let b=a.renderer,c=b.getRenderTarget();null===c?b.getDrawingBufferSize(nX):nX.set(c.width,c.height);let d=this.getTextureForReference(c);(d.image.width!==nX.width||d.image.height!==nX.height)&&(d.image.width=nX.width,d.image.height=nX.height,d.needsUpdate=!0);let e=d.generateMipmaps;d.generateMipmaps=this.generateMipmaps,b.copyFramebufferToTexture(d),d.generateMipmaps=e}clone(){let a=new this.constructor(this.uvNode,this.levelNode,this.value);return a.generateMipmaps=this.generateMipmaps,a}},nZ=g4(nY).setParameterLength(0,3),n$=g4(nY,null,null,{generateMipmaps:!0}).setParameterLength(0,3),n_=null,n0=g4(class extends nY{static get type(){return"ViewportDepthTextureNode"}constructor(a=k3,b=null){null===n_&&(n_=new el),super(a,b,n_)}getTextureForReference(){return n_}}).setParameterLength(0,2),(n1=class a extends gm{static get type(){return"ViewportDepthNode"}constructor(a,b=null){super("float"),this.scope=a,this.valueNode=b,this.isViewportDepthNode=!0}generate(b){let{scope:c}=this;return c===a.DEPTH_BASE?b.getFragDepth():super.generate(b)}setup({camera:b}){let{scope:c}=this,d=this.valueNode,e=null;return c===a.DEPTH_BASE?null!==d&&(e=n8().assign(d)):c===a.DEPTH?e=b.isPerspectiveCamera?n4(lL.z,lc,ld):n2(lL.z,lc,ld):c===a.LINEAR_DEPTH&&(e=null===d?n2(lL.z,lc,ld):b.isPerspectiveCamera?n2(n5(d,lc,ld),lc,ld):d),e}}).DEPTH_BASE="depthBase",n1.DEPTH="depth",n1.LINEAR_DEPTH="linearDepth",n2=(a,b,c)=>a.add(b).div(b.sub(c)),n3=(a,b,c)=>b.sub(c).mul(a).sub(b),n4=(a,b,c)=>b.add(a).mul(c).div(c.sub(b).mul(a)),n5=(a,b,c)=>b.mul(c).div(c.sub(b).mul(a).sub(c)),n6=(a,b,c)=>{b=b.max(1e-6).toVar();let d=i_(a.negate().div(b)),e=i_(c.div(b));return d.div(e)},n7=(a,b,c)=>{let d=a.mul(i$(c.div(b)));return he(Math.E).pow(d).mul(b).negate()},n8=g4(n1,n1.DEPTH_BASE),n9=g5(n1,n1.DEPTH),ob=(oa=g4(n1,n1.LINEAR_DEPTH).setParameterLength(0,1))(n0()),n9.assign=a=>n8(a),(oc=class a extends gm{static get type(){return"ClippingNode"}constructor(b=a.DEFAULT){super(),this.scope=b}setup(b){super.setup(b);let{intersectionPlanes:c,unionPlanes:d}=b.clippingContext;return this.hardwareClipping=b.material.hardwareClipping,this.scope===a.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(c,d):this.scope===a.HARDWARE?this.setupHardwareClipping(d,b):this.setupDefault(c,d)}setupAlphaToCoverage(a,b){return fu(()=>{let c=he().toVar("distanceToPlane"),d=he().toVar("distanceToGradient"),e=he(1).toVar("clipOpacity"),f=b.length;if(!1===this.hardwareClipping&&f>0){let a=kZ(b).setGroup(ia);nM(f,({i:b})=>{let f=a.element(b);c.assign(lL.dot(f.xyz).negate().add(f.w)),d.assign(c.fwidth().div(2)),e.mulAssign(jK(d.negate(),d,c))})}let g=a.length;if(g>0){let b=kZ(a).setGroup(ia),f=he(1).toVar("intersectionClipOpacity");nM(g,({i:a})=>{let e=b.element(a);c.assign(lL.dot(e.xyz).negate().add(e.w)),d.assign(c.fwidth().div(2)),f.mulAssign(jK(d.negate(),d,c).oneMinus())}),e.mulAssign(f.oneMinus())}hG.a.mulAssign(e),hG.a.equal(0).discard()})()}setupDefault(a,b){return fu(()=>{let c=b.length;if(!1===this.hardwareClipping&&c>0){let a=kZ(b).setGroup(ia);nM(c,({i:b})=>{let c=a.element(b);lL.dot(c.xyz).greaterThan(c.w).discard()})}let d=a.length;if(d>0){let b=kZ(a).setGroup(ia),c=hh(!0).toVar("clipped");nM(d,({i:a})=>{let d=b.element(a);c.assign(lL.dot(d.xyz).greaterThan(d.w).and(c))}),c.discard()}})()}setupHardwareClipping(a,b){let c=a.length;return b.enableHardwareClipping(c),fu(()=>{let d=kZ(a).setGroup(ia),e=k$(b.getClipDistance());nM(c,({i:a})=>{let b=d.element(a),c=lL.dot(b.xyz).sub(b.w).negate();e.element(a).assign(c)})})()}}).ALPHA_TO_COVERAGE="alphaToCoverage",oc.DEFAULT="default",oc.HARDWARE="hardware",od=fu(([a])=>i5(ip(1e4,i6(ip(17,a.x).add(ip(.1,a.y)))).mul(im(.1,jc(i6(ip(13,a.y).add(a.x))))))),oe=fu(([a])=>od(hi(od(a.xy),a.z))),of=fu(([a])=>{let b=js(je(jh(a.xyz)),je(ji(a.xyz))),c=he(1).div(he(.05).mul(b)).toVar("pixScale"),d=hi(iZ(i2(i_(c))),iZ(i3(i_(c)))),e=hi(oe(i2(d.x.mul(a.xyz))),oe(i2(d.y.mul(a.xyz)))),f=i5(i_(c)),g=im(ip(f.oneMinus(),e.x),ip(f,e.y)),h=jr(f,f.oneMinus()),i=hm(g.mul(g).div(ip(2,h).mul(io(1,h))),g.sub(ip(.5,h)).div(io(1,h)),io(1,io(1,g).mul(io(1,g)).div(ip(2,h).mul(io(1,h)))));return jH(g.lessThan(h.oneMinus()).select(g.lessThan(h).select(i.x,i.y),i.z),1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]}),og=class extends kH{static get type(){return"VertexColorNode"}constructor(a){super(null,"vec4"),this.isVertexColorNode=!0,this.index=a}getAttributeName(){let a=this.index;return"color"+(a>0?a:"")}generate(a){let b=this.getAttributeName(a);return!0===a.hasGeometryAttribute(b)?super.generate(a):a.generateConst(this.nodeType,new b3(1,1,1,1))}serialize(a){super.serialize(a),a.index=this.index}deserialize(a){super.deserialize(a),this.index=a.index}},oh=(a=0)=>g0(new og(a)),oi=fu(([a,b])=>jr(1,a.oneMinus().div(b)).oneMinus()).setLayout({name:"blendBurn",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),oj=fu(([a,b])=>jr(a.div(b.oneMinus()),1)).setLayout({name:"blendDodge",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),ok=fu(([a,b])=>a.oneMinus().mul(b.oneMinus()).oneMinus()).setLayout({name:"blendScreen",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),ol=fu(([a,b])=>jG(a.mul(2).mul(b),a.oneMinus().mul(2).mul(b.oneMinus()).oneMinus(),jt(.5,a))).setLayout({name:"blendOverlay",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),om=fu(([a,b])=>{let c=b.a.add(a.a.mul(b.a.oneMinus()));return hq(b.rgb.mul(b.a).add(a.rgb.mul(a.a).mul(b.a.oneMinus())).div(c),c)}).setLayout({name:"blendColor",type:"vec4",inputs:[{name:"base",type:"vec4"},{name:"blend",type:"vec4"}]}),on=fu(([a])=>hq(a.rgb.mul(a.a),a.a),{color:"vec4",return:"vec4"}),oo=fu(([a])=>(hb(a.a.equal(0),()=>hq(0)),hq(a.rgb.div(a.a),a.a)),{color:"vec4",return:"vec4"}),op=(...a)=>(I('TSL: "burn" has been renamed. Use "blendBurn" instead.'),oi(a)),oq=(...a)=>(I('TSL: "dodge" has been renamed. Use "blendDodge" instead.'),oj(a)),or=(...a)=>(I('TSL: "screen" has been renamed. Use "blendScreen" instead.'),ok(a)),os=(...a)=>(I('TSL: "overlay" has been renamed. Use "blendOverlay" instead.'),ol(a)),ot=class extends dh{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(a){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,Object.defineProperty(this,"shadowPositionNode",{get:()=>this.receivedShadowPositionNode,set:a=>{I('NodeMaterial: ".shadowPositionNode" was renamed to ".receivedShadowPositionNode".'),this.receivedShadowPositionNode=a}})}_getNodeChildren(){let a=[];for(let b of Object.getOwnPropertyNames(this)){if(!0===b.startsWith("_"))continue;let c=this[b];c&&!0===c.isNode&&a.push({property:b,childNode:c})}return a}customProgramCacheKey(){let a=[];for(let{property:b,childNode:c}of this._getNodeChildren())a.push(f8(b.slice(0,-4)),c.getCacheKey());return this.type+f9(a)}build(a){this.setup(a)}setupObserver(a){return new f7(a)}setup(a){a.context.setupNormal=()=>j2(this.setupNormal(a),"NORMAL","vec3"),a.context.setupPositionView=()=>this.setupPositionView(a),a.context.setupModelViewProjection=()=>this.setupModelViewProjection(a);let b=a.renderer,c=b.getRenderTarget();a.addStack();let d=j2(this.setupVertex(a),"VERTEX"),e=this.vertexNode||d;a.stack.outputNode=e,this.setupHardwareClipping(a),null!==this.geometryNode&&(a.stack.outputNode=a.stack.outputNode.bypass(this.geometryNode)),a.addFlow("vertex",a.removeStack()),a.addStack();let f,g=this.setupClipping(a);if((!0===this.depthWrite||!0===this.depthTest)&&(null===c?!0===b.depth&&this.setupDepth(a):!0===c.depthBuffer&&this.setupDepth(a)),null===this.fragmentNode){this.setupDiffuseColor(a),this.setupVariants(a);let d=this.setupLighting(a);null!==g&&a.stack.addToStack(g);let e=hq(d,hG.a).max(0);f=this.setupOutput(a,e),hY.assign(f);let h=null!==this.outputNode;if(h&&(f=this.outputNode),null!==c){let a=b.getMRT(),c=this.mrtNode;null===a?null!==c&&(f=c):(h&&hY.assign(f),f=a,null!==c&&(f=a.merge(c)))}}else{let b=this.fragmentNode;!0!==b.isOutputStructNode&&(b=hq(b)),f=this.setupOutput(a,b)}a.stack.outputNode=f,a.addFlow("fragment",a.removeStack()),a.observer=this.setupObserver(a)}setupClipping(a){if(null===a.clippingContext)return null;let{unionPlanes:b,intersectionPlanes:c}=a.clippingContext,d=null;if(b.length>0||c.length>0){let b=a.renderer.currentSamples;this.alphaToCoverage&&b>1?d=g0(new oc(oc.ALPHA_TO_COVERAGE)):a.stack.addToStack(g0(new oc))}return d}setupHardwareClipping(a){if(this.hardwareClipping=!1,null===a.clippingContext)return;let b=a.clippingContext.unionPlanes.length;b>0&&b<=8&&a.isAvailable("clipDistance")&&(a.stack.addToStack(g0(new oc(oc.HARDWARE))),this.hardwareClipping=!0)}setupDepth(a){let{renderer:b,camera:c}=a,d=this.depthNode;if(null===d){let a=b.getMRT();a&&a.has("depth")?d=a.get("depth"):!0===b.logarithmicDepthBuffer&&(d=c.isPerspectiveCamera?n6(lL.z,lc,ld):n2(lL.z,lc,ld))}null!==d&&n9.assign(d).toStack()}setupPositionView(){return lC.mul(lH).xyz}setupModelViewProjection(){return le.mul(lL)}setupVertex(a){return a.addStack(),this.setupPosition(a),a.context.vertex=a.removeStack(),nr}setupPosition(a){let{object:b,geometry:c}=a;if((c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color)&&nS(b).toStack(),!0===b.isSkinnedMesh&&nJ(b).toStack(),this.displacementMap){let a=mj("displacementMap","texture"),b=mj("displacementScale","float"),c=mj("displacementBias","float");lH.addAssign(lR.normalize().mul(a.x.mul(b).add(c)))}return b.isBatchedMesh&&nC(b).toStack(),b.isInstancedMesh&&b.instanceMatrix&&!0===b.instanceMatrix.isInstancedBufferAttribute&&nB(b).toStack(),null!==this.positionNode&&lH.assign(j2(this.positionNode,"POSITION","vec3")),lH}setupDiffuseColor(a){let{object:b,geometry:c}=a;null!==this.maskNode&&hh(this.maskNode).not().discard();let d=this.colorNode?hq(this.colorNode):mS;!0===this.vertexColors&&c.hasAttribute("color")&&(d=d.mul(oh())),b.instanceColor&&(d=hF("vec3","vInstanceColor").mul(d)),b.isBatchedMesh&&b._colorsTexture&&(d=hF("vec3","vBatchColor").mul(d)),hG.assign(d);let e=this.opacityNode?he(this.opacityNode):mV;hG.a.assign(hG.a.mul(e));let f=null;(null!==this.alphaTestNode||this.alphaTest>0)&&(f=null===this.alphaTestNode?mR:he(this.alphaTestNode),!0===this.alphaToCoverage?(hG.a=jK(f,f.add(jm(hG.a)),hG.a),hG.a.lessThanEqual(0).discard()):hG.a.lessThanEqual(f).discard()),!0===this.alphaHash&&hG.a.lessThan(of(lH)).discard(),a.isOpaque()&&hG.a.assign(1)}setupVariants(){}setupOutgoingLight(){return!0===this.lights?hm(0):hG.rgb}setupNormal(){return this.normalNode?hm(this.normalNode):m1}setupEnvironment(){let a=null;return this.envNode?a=this.envNode:this.envMap&&(a=this.envMap.isCubeTexture?mj("envMap","cubeTexture"):mj("envMap","texture")),a}setupLightMap(a){let b=null;return a.material.lightMap&&(b=new nW(no)),b}setupLights(a){let b=[],c=this.setupEnvironment(a);c&&c.isLightingNode&&b.push(c);let d=this.setupLightMap(a);if(d&&d.isLightingNode&&b.push(d),null!==this.aoNode||a.material.aoMap){let a=null===this.aoNode?np:this.aoNode;b.push(new nU(a))}let e=this.lightsNode||a.lightsNode;return b.length>0&&(e=a.renderer.lighting.createNode([...e.getLights(),...b])),e}setupLightingModel(){}setupLighting(a){let{material:b}=a,{backdropNode:c,backdropAlphaNode:d,emissiveNode:e}=this,f=!0===this.lights||null!==this.lightsNode?this.setupLights(a):null,g=this.setupOutgoingLight(a);return f&&f.getScope().hasLights?g=nV(f,this.setupLightingModel(a)||null,c,d):null!==c&&(g=hm(null===d?c:jG(g,c,d))),(e&&!0===e.isNode||b.emissive&&!0===b.emissive.isColor)&&(hH.assign(hm(e||mU)),g=g.add(hH)),g}setupFog(a,b){let c=a.fogNode;return c&&(hY.assign(b),b=hq(c.toVar())),b}setupPremultipliedAlpha(a,b){return on(b)}setupOutput(a,b){return!0===this.fog&&(b=this.setupFog(a,b)),!0===this.premultipliedAlpha&&(b=this.setupPremultipliedAlpha(a,b)),b}setDefaultValues(a){for(let b in a){let c=a[b];void 0===this[b]&&(this[b]=c,c&&c.clone&&(this[b]=c.clone()))}let b=Object.getOwnPropertyDescriptors(a.constructor.prototype);for(let a in b)void 0===Object.getOwnPropertyDescriptor(this.constructor.prototype,a)&&void 0!==b[a].get&&Object.defineProperty(this.constructor.prototype,a,b[a])}toJSON(a){let b=void 0===a||"string"==typeof a;b&&(a={textures:{},images:{},nodes:{}});let c=dh.prototype.toJSON.call(this,a);for(let{property:b,childNode:d}of(c.inputNodes={},this._getNodeChildren()))c.inputNodes[b]=d.toJSON(a).uuid;function d(a){let b=[];for(let c in a){let d=a[c];delete d.metadata,b.push(d)}return b}if(b){let b=d(a.textures),e=d(a.images),f=d(a.nodes);b.length>0&&(c.textures=b),e.length>0&&(c.images=e),f.length>0&&(c.nodes=f)}return c}copy(a){return this.lightsNode=a.lightsNode,this.envNode=a.envNode,this.aoNode=a.aoNode,this.colorNode=a.colorNode,this.normalNode=a.normalNode,this.opacityNode=a.opacityNode,this.backdropNode=a.backdropNode,this.backdropAlphaNode=a.backdropAlphaNode,this.alphaTestNode=a.alphaTestNode,this.maskNode=a.maskNode,this.positionNode=a.positionNode,this.geometryNode=a.geometryNode,this.depthNode=a.depthNode,this.receivedShadowPositionNode=a.receivedShadowPositionNode,this.castShadowPositionNode=a.castShadowPositionNode,this.receivedShadowNode=a.receivedShadowNode,this.castShadowNode=a.castShadowNode,this.outputNode=a.outputNode,this.mrtNode=a.mrtNode,this.fragmentNode=a.fragmentNode,this.vertexNode=a.vertexNode,super.copy(a)}},ou=new ei,ov=class extends ot{static get type(){return"LineBasicNodeMaterial"}constructor(a){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(ou),this.setValues(a)}},ow=new ex,ox=class extends ot{static get type(){return"LineDashedNodeMaterial"}constructor(a){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(ow),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(a)}setupVariants(){let a=this.offsetNode?he(this.offsetNode):nl,b=this.dashScaleNode?he(this.dashScaleNode):nh,c=this.dashSizeNode?he(this.dashSizeNode):ni,d=this.gapSizeNode?he(this.gapSizeNode):nj;hZ.assign(c),h$.assign(d);let e=j3(kI("lineDistance").mul(b));(a?e.add(a):e).mod(hZ.add(h$)).greaterThan(hZ).discard()}},oy=null,oz=g4(class extends nY{static get type(){return"ViewportSharedTextureNode"}constructor(a=k3,b=null){null===oy&&(oy=new ek),super(a,b,oy)}getTextureForReference(){return oy}updateReference(){return this}}).setParameterLength(0,2),oA=a=>g0(a).mul(.5).add(.5),oB=a=>g0(a).mul(2).sub(1),oC=new eu,oD=class extends ot{static get type(){return"MeshNormalNodeMaterial"}constructor(a){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(oC),this.setValues(a)}setupDiffuseColor(){let a=this.opacityNode?he(this.opacityNode):mV;hG.assign(ka(hq(oA(lV),a),br))}},oE=fu(([a=lK])=>hi(a.z.atan(a.x).mul(1/(2*Math.PI)).add(.5),a.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5))),oF=class extends dY{constructor(a=1,b={}){super(a,b),this.isCubeRenderTarget=!0}fromEquirectangularTexture(a,b){let c=b.minFilter,d=b.generateMipmaps;b.generateMipmaps=!0,this.texture.type=b.type,this.texture.colorSpace=b.colorSpace,this.texture.generateMipmaps=b.generateMipmaps,this.texture.minFilter=b.minFilter,this.texture.magFilter=b.magFilter;let e=new dN(5,5,5),f=oE(lK),g=new ot;g.colorNode=kP(b,f,0),g.side=1,g.blending=0;let h=new dM(e,g),i=new d0;i.add(h),1008===b.minFilter&&(b.minFilter=av);let j=new dW(1,10,this),k=a.getMRT();return a.setMRT(null),j.update(a,i),a.setMRT(k),b.minFilter=c,b.currentGenerateMipmaps=d,h.geometry.dispose(),h.material.dispose(),this}},oG=new WeakMap,oH=g4(class extends gp{static get type(){return"CubeMapNode"}constructor(a){super("vec3"),this.envNode=a,this._cubeTexture=null,this._cubeTextureNode=mc(null);let b=new dX;b.isRenderTargetTexture=!0,this._defaultTexture=b,this.updateBeforeType=gd.RENDER}updateBefore(a){let{renderer:b,material:c}=a,d=this.envNode;if(d.isTextureNode||d.isMaterialReferenceNode){let a=d.isTextureNode?d.value:c[d.property];if(a&&a.isTexture){let c=a.mapping;if(303===c||304===c){if(oG.has(a)){let b=oG.get(a);fB(b,a.mapping),this._cubeTexture=b}else{let c=a.image;if(null!=c&&c.height>0){let d=new oF(c.height);d.fromEquirectangularTexture(b,a),fB(d.texture,a.mapping),this._cubeTexture=d.texture,oG.set(a,d.texture),a.addEventListener("dispose",fA)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(a){return this.updateBefore(a),this._cubeTextureNode}}).setParameterLength(1),oI=class extends nT{static get type(){return"BasicEnvironmentNode"}constructor(a=null){super(),this.envNode=a}setup(a){a.context.environment=oH(this.envNode)}},oJ=class extends nT{static get type(){return"BasicLightMapNode"}constructor(a=null){super(),this.lightMapNode=a}setup(a){let b=he(1/Math.PI);a.context.irradianceLightMap=this.lightMapNode.mul(b)}},oK=class{start(a){a.lightsNode.setupLights(a,a.lightsNode.getLightNodes(a)),this.indirect(a)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}},oL=class extends oK{constructor(){super()}indirect({context:a}){let b=a.ambientOcclusion,c=a.reflectedLight,d=a.irradianceLightMap;c.indirectDiffuse.assign(hq(0)),d?c.indirectDiffuse.addAssign(d):c.indirectDiffuse.addAssign(hq(1,1,1,0)),c.indirectDiffuse.mulAssign(b),c.indirectDiffuse.mulAssign(hG.rgb)}finish(a){let{material:b,context:c}=a,d=c.outgoingLight,e=a.context.environment;if(e)switch(b.combine){case 0:d.rgb.assign(jG(d.rgb,d.rgb.mul(e.rgb),mZ.mul(m$)));break;case 1:d.rgb.assign(jG(d.rgb,e.rgb,mZ.mul(m$)));break;case 2:d.rgb.addAssign(e.rgb.mul(mZ.mul(m$)));break;default:I("BasicLightingModel: Unsupported .combine value:",b.combine)}}},oM=new di,oN=class extends ot{static get type(){return"MeshBasicNodeMaterial"}constructor(a){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(oM),this.setValues(a)}setupNormal(){return lP(lT)}setupEnvironment(a){let b=super.setupEnvironment(a);return b?new oI(b):null}setupLightMap(a){let b=null;return a.material.lightMap&&(b=new oJ(no)),b}setupOutgoingLight(){return hG.rgb}setupLightingModel(){return new oL}},oO=fu(({f0:a,f90:b,dotVH:c})=>{let d=c.mul(-5.55473).sub(6.98316).mul(c).exp2();return a.mul(d.oneMinus()).add(b.mul(d))}),oP=fu(a=>a.diffuseColor.mul(1/Math.PI)),oQ=fu(({dotNH:a})=>hX.mul(he(.5)).add(1).mul(he(1/Math.PI)).mul(a.pow(hX))),oR=fu(({lightDirection:a})=>{let b=a.add(lM).normalize(),c=lV.dot(b).clamp(),d=oO({f0:hV,f90:1,dotVH:lM.dot(b).clamp()}),e=he(.25),f=oQ({dotNH:c});return d.mul(e).mul(f)}),oS=class extends oL{constructor(a=!0){super(),this.specular=a}direct({lightDirection:a,lightColor:b,reflectedLight:c}){let d=lV.dot(a).clamp().mul(b);c.directDiffuse.addAssign(d.mul(oP({diffuseColor:hG.rgb}))),!0===this.specular&&c.directSpecular.addAssign(d.mul(oR({lightDirection:a})).mul(mZ))}indirect(a){let{ambientOcclusion:b,irradiance:c,reflectedLight:d}=a.context;d.indirectDiffuse.addAssign(c.mul(oP({diffuseColor:hG}))),d.indirectDiffuse.mulAssign(b)}},oT=new ev,oU=class extends ot{static get type(){return"MeshLambertNodeMaterial"}constructor(a){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(oT),this.setValues(a)}setupEnvironment(a){let b=super.setupEnvironment(a);return b?new oI(b):null}setupLightingModel(){return new oS(!1)}},oV=new es,oW=class extends ot{static get type(){return"MeshPhongNodeMaterial"}constructor(a){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(oV),this.setValues(a)}setupEnvironment(a){let b=super.setupEnvironment(a);return b?new oI(b):null}setupLightingModel(){return new oS}setupVariants(){let a=(this.shininessNode?he(this.shininessNode):mT).max(1e-4);hX.assign(a);let b=this.specularNode||mW;hV.assign(b)}copy(a){return this.shininessNode=a.shininessNode,this.specularNode=a.specularNode,super.copy(a)}},oX=fu(a=>{if(!1===a.geometry.hasAttribute("normal"))return he(0);let b=lT.dFdx().abs().max(lT.dFdy().abs());return b.x.max(b.y).max(b.z)}),oY=fu(a=>{let{roughness:b}=a,c=oX(),d=b.max(.0525);return(d=d.add(c)).min(1)}),oZ=fu(({alpha:a,dotNL:b,dotNV:c})=>{let d=a.pow2(),e=b.mul(d.add(d.oneMinus().mul(c.pow2())).sqrt()),f=c.mul(d.add(d.oneMinus().mul(b.pow2())).sqrt());return iq(.5,e.add(f).max(iO))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),o$=fu(({alphaT:a,alphaB:b,dotTV:c,dotBV:d,dotTL:e,dotBL:f,dotNV:g,dotNL:h})=>{let i=h.mul(hm(a.mul(c),b.mul(d),g).length()),j=g.mul(hm(a.mul(e),b.mul(f),h).length());return iq(.5,i.add(j)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),o_=fu(({alpha:a,dotNH:b})=>{let c=a.pow2(),d=b.pow2().mul(c.oneMinus()).oneMinus();return c.div(d.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),o0=he(1/Math.PI),o1=fu(({alphaT:a,alphaB:b,dotNH:c,dotTH:d,dotBH:e})=>{let f=a.mul(b),g=hm(b.mul(d),a.mul(e),f.mul(c)),h=g.dot(g),i=f.div(h);return o0.mul(f.mul(i.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),o2=fu(({lightDirection:a,f0:b,f90:c,roughness:d,f:e,normalView:f=lV,USE_IRIDESCENCE:g,USE_ANISOTROPY:h})=>{let i=d.pow2(),j=a.add(lM).normalize(),k=f.dot(a).clamp(),l=f.dot(lM).clamp(),m=f.dot(j).clamp(),n=oO({f0:b,f90:c,dotVH:lM.dot(j).clamp()}),o,p;if(g$(g)&&(n=hO.mix(n,e)),g$(h)){let b=hT.dot(a),c=hT.dot(lM),d=hT.dot(j),e=hU.dot(a),f=hU.dot(lM),g=hU.dot(j);o=o$({alphaT:hR,alphaB:i,dotTV:c,dotBV:f,dotTL:b,dotBL:e,dotNV:l,dotNL:k}),p=o1({alphaT:hR,alphaB:i,dotNH:m,dotTH:d,dotBH:g})}else o=oZ({alpha:i,dotNL:k,dotNV:l}),p=o_({alpha:i,dotNH:m});return n.mul(o).mul(p)}),o3=new Uint16Array([11481,15204,11534,15171,11808,15015,12385,14843,12894,14716,13396,14600,13693,14483,13976,14366,14237,14171,14405,13961,14511,13770,14605,13598,14687,13444,14760,13305,14822,13066,14876,12857,14923,12675,14963,12517,14997,12379,15025,12230,15049,12023,15070,11843,15086,11687,15100,11551,15111,11433,15120,11330,15127,11217,15132,11060,15135,10922,15138,10801,15139,10695,15139,10600,13012,14923,13020,14917,13064,14886,13176,14800,13349,14666,13513,14526,13724,14398,13960,14230,14200,14020,14383,13827,14488,13651,14583,13491,14667,13348,14740,13132,14803,12908,14856,12713,14901,12542,14938,12394,14968,12241,14992,12017,15010,11822,15024,11654,15034,11507,15041,11380,15044,11269,15044,11081,15042,10913,15037,10764,15031,10635,15023,10520,15014,10419,15003,10330,13657,14676,13658,14673,13670,14660,13698,14622,13750,14547,13834,14442,13956,14317,14112,14093,14291,13889,14407,13704,14499,13538,14586,13389,14664,13201,14733,12966,14792,12758,14842,12577,14882,12418,14915,12272,14940,12033,14959,11826,14972,11646,14980,11490,14983,11355,14983,11212,14979,11008,14971,10830,14961,10675,14950,10540,14936,10420,14923,10315,14909,10204,14894,10041,14089,14460,14090,14459,14096,14452,14112,14431,14141,14388,14186,14305,14252,14130,14341,13941,14399,13756,14467,13585,14539,13430,14610,13272,14677,13026,14737,12808,14790,12617,14833,12449,14869,12303,14896,12065,14916,11845,14929,11655,14937,11490,14939,11347,14936,11184,14930,10970,14921,10783,14912,10621,14900,10480,14885,10356,14867,10247,14848,10062,14827,9894,14805,9745,14400,14208,14400,14206,14402,14198,14406,14174,14415,14122,14427,14035,14444,13913,14469,13767,14504,13613,14548,13463,14598,13324,14651,13082,14704,12858,14752,12658,14795,12483,14831,12330,14860,12106,14881,11875,14895,11675,14903,11501,14905,11351,14903,11178,14900,10953,14892,10757,14880,10589,14865,10442,14847,10313,14827,10162,14805,9965,14782,9792,14757,9642,14731,9507,14562,13883,14562,13883,14563,13877,14566,13862,14570,13830,14576,13773,14584,13689,14595,13582,14613,13461,14637,13336,14668,13120,14704,12897,14741,12695,14776,12516,14808,12358,14835,12150,14856,11910,14870,11701,14878,11519,14882,11361,14884,11187,14880,10951,14871,10748,14858,10572,14842,10418,14823,10286,14801,10099,14777,9897,14751,9722,14725,9567,14696,9430,14666,9309,14702,13604,14702,13604,14702,13600,14703,13591,14705,13570,14707,13533,14709,13477,14712,13400,14718,13305,14727,13106,14743,12907,14762,12716,14784,12539,14807,12380,14827,12190,14844,11943,14855,11727,14863,11539,14870,11376,14871,11204,14868,10960,14858,10748,14845,10565,14829,10406,14809,10269,14786,10058,14761,9852,14734,9671,14705,9512,14674,9374,14641,9253,14608,9076,14821,13366,14821,13365,14821,13364,14821,13358,14821,13344,14821,13320,14819,13252,14817,13145,14815,13011,14814,12858,14817,12698,14823,12539,14832,12389,14841,12214,14850,11968,14856,11750,14861,11558,14866,11390,14867,11226,14862,10972,14853,10754,14840,10565,14823,10401,14803,10259,14780,10032,14754,9820,14725,9635,14694,9473,14661,9333,14627,9203,14593,8988,14557,8798,14923,13014,14922,13014,14922,13012,14922,13004,14920,12987,14919,12957,14915,12907,14909,12834,14902,12738,14894,12623,14888,12498,14883,12370,14880,12203,14878,11970,14875,11759,14873,11569,14874,11401,14872,11243,14865,10986,14855,10762,14842,10568,14825,10401,14804,10255,14781,10017,14754,9799,14725,9611,14692,9445,14658,9301,14623,9139,14587,8920,14548,8729,14509,8562,15008,12672,15008,12672,15008,12671,15007,12667,15005,12656,15001,12637,14997,12605,14989,12556,14978,12490,14966,12407,14953,12313,14940,12136,14927,11934,14914,11742,14903,11563,14896,11401,14889,11247,14879,10992,14866,10767,14851,10570,14833,10400,14812,10252,14789,10007,14761,9784,14731,9592,14698,9424,14663,9279,14627,9088,14588,8868,14548,8676,14508,8508,14467,8360,15080,12386,15080,12386,15079,12385,15078,12383,15076,12378,15072,12367,15066,12347,15057,12315,15045,12253,15030,12138,15012,11998,14993,11845,14972,11685,14951,11530,14935,11383,14920,11228,14904,10981,14887,10762,14870,10567,14850,10397,14827,10248,14803,9997,14774,9771,14743,9578,14710,9407,14674,9259,14637,9048,14596,8826,14555,8632,14514,8464,14471,8317,14427,8182,15139,12008,15139,12008,15138,12008,15137,12007,15135,12003,15130,11990,15124,11969,15115,11929,15102,11872,15086,11794,15064,11693,15041,11581,15013,11459,14987,11336,14966,11170,14944,10944,14921,10738,14898,10552,14875,10387,14850,10239,14824,9983,14794,9758,14762,9563,14728,9392,14692,9244,14653,9014,14611,8791,14569,8597,14526,8427,14481,8281,14436,8110,14391,7885,15188,11617,15188,11617,15187,11617,15186,11618,15183,11617,15179,11612,15173,11601,15163,11581,15150,11546,15133,11495,15110,11427,15083,11346,15051,11246,15024,11057,14996,10868,14967,10687,14938,10517,14911,10362,14882,10206,14853,9956,14821,9737,14787,9543,14752,9375,14715,9228,14675,8980,14632,8760,14589,8565,14544,8395,14498,8248,14451,8049,14404,7824,14357,7630,15228,11298,15228,11298,15227,11299,15226,11301,15223,11303,15219,11302,15213,11299,15204,11290,15191,11271,15174,11217,15150,11129,15119,11015,15087,10886,15057,10744,15024,10599,14990,10455,14957,10318,14924,10143,14891,9911,14856,9701,14820,9516,14782,9352,14744,9200,14703,8946,14659,8725,14615,8533,14568,8366,14521,8220,14472,7992,14423,7770,14374,7578,14315,7408,15260,10819,15260,10819,15259,10822,15258,10826,15256,10832,15251,10836,15246,10841,15237,10838,15225,10821,15207,10788,15183,10734,15151,10660,15120,10571,15087,10469,15049,10359,15012,10249,14974,10041,14937,9837,14900,9647,14860,9475,14820,9320,14779,9147,14736,8902,14691,8688,14646,8499,14598,8335,14549,8189,14499,7940,14448,7720,14397,7529,14347,7363,14256,7218,15285,10410,15285,10411,15285,10413,15284,10418,15282,10425,15278,10434,15272,10442,15264,10449,15252,10445,15235,10433,15210,10403,15179,10358,15149,10301,15113,10218,15073,10059,15033,9894,14991,9726,14951,9565,14909,9413,14865,9273,14822,9073,14777,8845,14730,8641,14682,8459,14633,8300,14583,8129,14531,7883,14479,7670,14426,7482,14373,7321,14305,7176,14201,6939,15305,9939,15305,9940,15305,9945,15304,9955,15302,9967,15298,9989,15293,10010,15286,10033,15274,10044,15258,10045,15233,10022,15205,9975,15174,9903,15136,9808,15095,9697,15053,9578,15009,9451,14965,9327,14918,9198,14871,8973,14825,8766,14775,8579,14725,8408,14675,8259,14622,8058,14569,7821,14515,7615,14460,7435,14405,7276,14350,7108,14256,6866,14149,6653,15321,9444,15321,9445,15321,9448,15320,9458,15317,9470,15314,9490,15310,9515,15302,9540,15292,9562,15276,9579,15251,9577,15226,9559,15195,9519,15156,9463,15116,9389,15071,9304,15025,9208,14978,9023,14927,8838,14878,8661,14827,8496,14774,8344,14722,8206,14667,7973,14612,7749,14556,7555,14499,7382,14443,7229,14385,7025,14322,6791,14210,6588,14100,6409,15333,8920,15333,8921,15332,8927,15332,8943,15329,8965,15326,9002,15322,9048,15316,9106,15307,9162,15291,9204,15267,9221,15244,9221,15212,9196,15175,9134,15133,9043,15088,8930,15040,8801,14990,8665,14938,8526,14886,8391,14830,8261,14775,8087,14719,7866,14661,7664,14603,7482,14544,7322,14485,7178,14426,6936,14367,6713,14281,6517,14166,6348,14054,6198,15341,8360,15341,8361,15341,8366,15341,8379,15339,8399,15336,8431,15332,8473,15326,8527,15318,8585,15302,8632,15281,8670,15258,8690,15227,8690,15191,8664,15149,8612,15104,8543,15055,8456,15001,8360,14948,8259,14892,8122,14834,7923,14776,7734,14716,7558,14656,7397,14595,7250,14534,7070,14472,6835,14410,6628,14350,6443,14243,6283,14125,6135,14010,5889,15348,7715,15348,7717,15348,7725,15347,7745,15345,7780,15343,7836,15339,7905,15334,8e3,15326,8103,15310,8193,15293,8239,15270,8270,15240,8287,15204,8283,15163,8260,15118,8223,15067,8143,15014,8014,14958,7873,14899,7723,14839,7573,14778,7430,14715,7293,14652,7164,14588,6931,14524,6720,14460,6531,14396,6362,14330,6210,14207,6015,14086,5781,13969,5576,15352,7114,15352,7116,15352,7128,15352,7159,15350,7195,15348,7237,15345,7299,15340,7374,15332,7457,15317,7544,15301,7633,15280,7703,15251,7754,15216,7775,15176,7767,15131,7733,15079,7670,15026,7588,14967,7492,14906,7387,14844,7278,14779,7171,14714,6965,14648,6770,14581,6587,14515,6420,14448,6269,14382,6123,14299,5881,14172,5665,14049,5477,13929,5310,15355,6329,15355,6330,15355,6339,15355,6362,15353,6410,15351,6472,15349,6572,15344,6688,15337,6835,15323,6985,15309,7142,15287,7220,15260,7277,15226,7310,15188,7326,15142,7318,15090,7285,15036,7239,14976,7177,14914,7045,14849,6892,14782,6736,14714,6581,14645,6433,14576,6293,14506,6164,14438,5946,14369,5733,14270,5540,14140,5369,14014,5216,13892,5043,15357,5483,15357,5484,15357,5496,15357,5528,15356,5597,15354,5692,15351,5835,15347,6011,15339,6195,15328,6317,15314,6446,15293,6566,15268,6668,15235,6746,15197,6796,15152,6811,15101,6790,15046,6748,14985,6673,14921,6583,14854,6479,14785,6371,14714,6259,14643,6149,14571,5946,14499,5750,14428,5567,14358,5401,14242,5250,14109,5111,13980,4870,13856,4657,15359,4555,15359,4557,15358,4573,15358,4633,15357,4715,15355,4841,15353,5061,15349,5216,15342,5391,15331,5577,15318,5770,15299,5967,15274,6150,15243,6223,15206,6280,15161,6310,15111,6317,15055,6300,14994,6262,14928,6208,14860,6141,14788,5994,14715,5838,14641,5684,14566,5529,14492,5384,14418,5247,14346,5121,14216,4892,14079,4682,13948,4496,13822,4330,15359,3498,15359,3501,15359,3520,15359,3598,15358,3719,15356,3860,15355,4137,15351,4305,15344,4563,15334,4809,15321,5116,15303,5273,15280,5418,15250,5547,15214,5653,15170,5722,15120,5761,15064,5763,15002,5733,14935,5673,14865,5597,14792,5504,14716,5400,14640,5294,14563,5185,14486,5041,14410,4841,14335,4655,14191,4482,14051,4325,13918,4183,13790,4012,15360,2282,15360,2285,15360,2306,15360,2401,15359,2547,15357,2748,15355,3103,15352,3349,15345,3675,15336,4020,15324,4272,15307,4496,15285,4716,15255,4908,15220,5086,15178,5170,15128,5214,15072,5234,15010,5231,14943,5206,14871,5166,14796,5102,14718,4971,14639,4833,14559,4687,14480,4541,14402,4401,14315,4268,14167,4142,14025,3958,13888,3747,13759,3556,15360,923,15360,925,15360,946,15360,1052,15359,1214,15357,1494,15356,1892,15352,2274,15346,2663,15338,3099,15326,3393,15309,3679,15288,3980,15260,4183,15226,4325,15185,4437,15136,4517,15080,4570,15018,4591,14950,4581,14877,4545,14800,4485,14720,4411,14638,4325,14556,4231,14475,4136,14395,3988,14297,3803,14145,3628,13999,3465,13861,3314,13729,3177,15360,263,15360,264,15360,272,15360,325,15359,407,15358,548,15356,780,15352,1144,15347,1580,15339,2099,15328,2425,15312,2795,15292,3133,15264,3329,15232,3517,15191,3689,15143,3819,15088,3923,15025,3978,14956,3999,14882,3979,14804,3931,14722,3855,14639,3756,14554,3645,14470,3529,14388,3409,14279,3289,14124,3173,13975,3055,13834,2848,13701,2658,15360,49,15360,49,15360,52,15360,75,15359,111,15358,201,15356,283,15353,519,15348,726,15340,1045,15329,1415,15314,1795,15295,2173,15269,2410,15237,2649,15197,2866,15150,3054,15095,3140,15032,3196,14963,3228,14888,3236,14808,3224,14725,3191,14639,3146,14553,3088,14466,2976,14382,2836,14262,2692,14103,2549,13952,2409,13808,2278,13674,2154,15360,4,15360,4,15360,4,15360,13,15359,33,15358,59,15357,112,15353,199,15348,302,15341,456,15331,628,15316,827,15297,1082,15272,1332,15241,1601,15202,1851,15156,2069,15101,2172,15039,2256,14970,2314,14894,2348,14813,2358,14728,2344,14640,2311,14551,2263,14463,2203,14376,2133,14247,2059,14084,1915,13930,1761,13784,1609,13648,1464,15360,0,15360,0,15360,0,15360,3,15359,18,15358,26,15357,53,15354,80,15348,97,15341,165,15332,238,15318,326,15299,427,15275,529,15245,654,15207,771,15161,885,15108,994,15046,1089,14976,1170,14900,1229,14817,1266,14731,1284,14641,1282,14550,1260,14460,1223,14370,1174,14232,1116,14066,1050,13909,981,13761,910,13623,839]),o4=null,o5=fu(({roughness:a,dotNV:b})=>{null===o4&&((o4=new d5(o3,32,32,aT,aG)).minFilter=av,o4.magFilter=av,o4.wrapS=aq,o4.wrapT=aq,o4.generateMipmaps=!1,o4.needsUpdate=!0);let c=hi(a,b);return kP(o4,c).rg}),o6=fu(({lightDirection:a,f0:b,f90:c,roughness:d,f:e,USE_IRIDESCENCE:f,USE_ANISOTROPY:g})=>{let h=o2({lightDirection:a,f0:b,f90:c,roughness:d,f:e,USE_IRIDESCENCE:f,USE_ANISOTROPY:g}),i=lV.dot(a).clamp(),j=o5({roughness:d,dotNV:lV.dot(lM).clamp()}),k=o5({roughness:d,dotNV:i}),l=b.mul(j.x).add(c.mul(j.y)),m=b.mul(k.x).add(c.mul(k.y)),n=j.x.add(j.y),o=k.x.add(k.y),p=he(1).sub(n),q=he(1).sub(o),r=b.add(b.oneMinus().mul(.047619)),s=l.mul(m).mul(r).div(he(1).sub(p.mul(q).mul(r).mul(r)).add(iO)),t=p.mul(q),u=s.mul(t);return h.add(u)}),o7=fu(a=>{let{dotNV:b,specularColor:c,specularF90:d,roughness:e}=a,f=o5({dotNV:b,roughness:e});return c.mul(f.x).add(d.mul(f.y))}),o8=fu(({f:a,f90:b,dotVH:c})=>{let d=c.oneMinus().saturate(),e=d.mul(d),f=d.mul(e,e).clamp(0,.9999);return a.sub(hm(b).mul(f)).div(f.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),o9=fu(({roughness:a,dotNH:b})=>{let c=a.pow2(),d=he(1).div(c),e=b.pow2().oneMinus().max(.0078125);return he(2).add(d).mul(e.pow(d.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),pa=fu(({dotNV:a,dotNL:b})=>he(1).div(he(4).mul(b.add(a).sub(b.mul(a))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),pb=fu(({lightDirection:a})=>{let b=a.add(lM).normalize(),c=lV.dot(a).clamp(),d=lV.dot(lM).clamp(),e=o9({roughness:hN,dotNH:lV.dot(b).clamp()}),f=pa({dotNV:d,dotNL:c});return hM.mul(e).mul(f)}),pc=fu(({N:a,V:b,roughness:c})=>{let d=hi(c,a.dot(b).saturate().oneMinus().sqrt());return d.assign(d.mul(.984375).add(.0078125)),d}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),pd=fu(({f:a})=>{let b=a.length();return js(b.mul(b).add(a.z).div(b.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),pe=fu(({v1:a,v2:b})=>{let c=a.dot(b),d=c.abs().toVar(),e=d.mul(.0145206).add(.4965155).mul(d).add(.8543985).toVar(),f=d.add(4.1616724).mul(d).add(3.417594).toVar(),g=e.div(f),h=c.greaterThan(0).select(g,js(c.mul(c).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(g));return a.cross(b).mul(h)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),pf=fu(({N:a,V:b,P:c,mInv:d,p0:e,p1:f,p2:g,p3:h})=>{let i=f.sub(e).toVar(),j=h.sub(e).toVar(),k=i.cross(j),l=hm().toVar();return hb(k.dot(c.sub(e)).greaterThanEqual(0),()=>{let i=b.sub(a.mul(b.dot(a))).normalize(),j=a.cross(i).negate(),k=d.mul(hv(i,j,a).transpose()).toVar(),m=k.mul(e.sub(c)).normalize().toVar(),n=k.mul(f.sub(c)).normalize().toVar(),o=k.mul(g.sub(c)).normalize().toVar(),p=k.mul(h.sub(c)).normalize().toVar(),q=hm(0).toVar();q.addAssign(pe({v1:m,v2:n})),q.addAssign(pe({v1:n,v2:o})),q.addAssign(pe({v1:o,v2:p})),q.addAssign(pe({v1:p,v2:m})),l.assign(hm(pd({f:q})))}),l}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),pg=1/6,ph=a=>ip(pg,ip(a,ip(a,a.negate().add(3)).sub(3)).add(1)),pi=a=>ip(pg,ip(a,ip(a,ip(3,a).sub(6))).add(4)),pj=a=>ip(pg,ip(a,ip(a,ip(-3,a).add(3)).add(3)).add(1)),pk=a=>ip(pg,jz(a,3)),pl=a=>ph(a).add(pi(a)),pm=a=>pj(a).add(pk(a)),pn=a=>im(-1,pi(a).div(ph(a).add(pi(a)))),po=a=>im(1,pk(a).div(pj(a).add(pk(a)))),pp=(a,b,c)=>{let d=ip(a.uvNode,b.zw).add(.5),e=i2(d),f=i5(d),g=pl(f.x),h=pm(f.x),i=pn(f.x),j=po(f.x),k=pn(f.y),l=po(f.y),m=hi(e.x.add(i),e.y.add(k)).sub(.5).mul(b.xy),n=hi(e.x.add(j),e.y.add(k)).sub(.5).mul(b.xy),o=hi(e.x.add(i),e.y.add(l)).sub(.5).mul(b.xy),p=hi(e.x.add(j),e.y.add(l)).sub(.5).mul(b.xy),q=pl(f.y).mul(im(g.mul(a.sample(m).level(c)),h.mul(a.sample(n).level(c)))),r=pm(f.y).mul(im(g.mul(a.sample(o).level(c)),h.mul(a.sample(p).level(c))));return q.add(r)},pq=fu(([a,b])=>{let c=hi(a.size(hf(b))),d=hi(a.size(hf(b.add(1)))),e=iq(1,c),f=iq(1,d),g=pp(a,hq(e,c),i2(b)),h=pp(a,hq(f,d),i3(b));return i5(b).mix(g,h)}),pr=fu(([a,b])=>pq(a,b.mul(kL(a)))),ps=fu(([a,b,c,d,e])=>{let f=hm(jJ(b.negate(),i4(a),iq(1,d))),g=hm(je(e[0].xyz),je(e[1].xyz),je(e[2].xyz));return i4(f).mul(c.mul(g))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),pt=fu(([a,b])=>a.mul(jH(b.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),pu=n$(),pv=n$(),pw=fu(([a,b,c],{material:d})=>pq((1===d.side?pu:pv).sample(a),i_(k4.x).mul(pt(b,c)))),px=fu(([a,b,c])=>(hb(c.notEqual(0),()=>iY(i$(b).negate().div(c).negate().mul(a))),hm(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),py=fu(([a,b,c,d,e,f,g,h,i,j,k,l,m,n,o])=>{let p,q;if(o){p=hq().toVar(),q=hm().toVar();let e=k.sub(1).mul(o.mul(.025)),f=hm(k.sub(e),k,k.add(e));nM({start:0,end:3},({i:e})=>{let k=f.element(e),o=ps(a,b,l,k,h),r=g.add(o),s=j.mul(i.mul(hq(r,1))),t=hi(s.xy.div(s.w)).toVar();t.addAssign(1),t.divAssign(2),t.assign(hi(t.x,t.y.oneMinus()));let u=pw(t,c,k);p.element(e).assign(u.element(e)),p.a.addAssign(u.a),q.element(e).assign(d.element(e).mul(px(je(o),m,n).element(e)))}),p.a.divAssign(3)}else{let e=ps(a,b,l,k,h),f=g.add(e),o=j.mul(i.mul(hq(f,1))),r=hi(o.xy.div(o.w)).toVar();r.addAssign(1),r.divAssign(2),r.assign(hi(r.x,r.y.oneMinus())),p=pw(r,c,k),q=d.mul(px(je(e),m,n))}let r=q.rgb.mul(p.rgb),s=hm(o7({dotNV:a.dot(b).clamp(),specularColor:e,specularF90:f,roughness:c})),t=q.r.add(q.g,q.b).div(3);return hq(s.oneMinus().mul(r),p.a.oneMinus().mul(t).oneMinus())}),pz=hv(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),pA=(a,b)=>a.sub(b).div(a.add(b)).pow2(),pB=fu(({outsideIOR:a,eta2:b,cosTheta1:c,thinFilmThickness:d,baseF0:e})=>{let f,g=jG(a,b,jK(0,.03,d)),h=a.div(g).pow2().mul(c.pow2().oneMinus()).oneMinus();hb(h.lessThan(0),()=>hm(1));let i=h.sqrt(),j=oO({f0:pA(g,a),f90:1,dotVH:c}),k=j.oneMinus(),l=g.lessThan(a).select(Math.PI,0),m=he(Math.PI).sub(l),n=(f=e.clamp(0,.9999).sqrt(),hm(1).add(f).div(hm(1).sub(f))),o=oO({f0:pA(n,g.toVec3()),f90:1,dotVH:i}),p=hm(n.x.lessThan(g).select(Math.PI,0),n.y.lessThan(g).select(Math.PI,0),n.z.lessThan(g).select(Math.PI,0)),q=g.mul(d,i,2),r=hm(m).add(p),s=j.mul(o).clamp(1e-5,.9999),t=s.sqrt(),u=k.pow2().mul(o).div(hm(1).sub(s)),v=j.add(u).toVar(),w=u.sub(k).toVar();return nM({start:1,end:2,condition:"<=",name:"m"},({m:a})=>{var b,c;let d,e,f,g,h,i;w.mulAssign(t);let j=(b=he(a).mul(q),c=he(a).mul(r),d=b.mul(2*Math.PI*1e-9),e=hm(54856e-17,44201e-17,52481e-17),f=hm(1681e3,1795300,2208400),g=hm(43278e5,93046e5,66121e5),h=he(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(d.mul(2239900).add(c.x).cos()).mul(d.pow2().mul(-45282e5).exp()),i=hm((i=e.mul(g.mul(2*Math.PI).sqrt()).mul(f.mul(d).add(c).cos()).mul(d.pow2().negate().mul(g).exp())).x.add(h),i.y,i.z).div(10685e-11),pz.mul(i)).mul(2);v.addAssign(w.mul(j))}),v.max(hm(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),pC=fu(({normal:a,viewDir:b,roughness:c})=>{let d=a.dot(b).saturate(),e=c.pow2(),f=jT(c.lessThan(.25),he(-339.2).mul(e).add(he(161.4).mul(c)).sub(25.9),he(-8.48).mul(e).add(he(14.3).mul(c)).sub(9.95)),g=jT(c.lessThan(.25),he(44).mul(e).sub(he(23.7).mul(c)).add(3.26),he(1.97).mul(e).sub(he(3.27).mul(c)).add(.72));return jT(c.lessThan(.25),0,he(.1).mul(c).sub(.025)).add(f.mul(d).add(g).exp()).mul(1/Math.PI).saturate()}),pD=hm(.04),pE=he(1),pF=class extends oK{constructor(a=!1,b=!1,c=!1,d=!1,e=!1,f=!1){super(),this.clearcoat=a,this.sheen=b,this.iridescence=c,this.anisotropy=d,this.transmission=e,this.dispersion=f,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(a){if(!0===this.clearcoat&&(this.clearcoatRadiance=hm().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=hm().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=hm().toVar("clearcoatSpecularIndirect")),!0===this.sheen&&(this.sheenSpecularDirect=hm().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=hm().toVar("sheenSpecularIndirect")),!0===this.iridescence){let a=lV.dot(lM).clamp();this.iridescenceFresnel=pB({outsideIOR:he(1),eta2:hP,cosTheta1:a,thinFilmThickness:hQ,baseF0:hV}),this.iridescenceF0=o8({f:this.iridescenceFresnel,f90:1,dotVH:a})}if(!0===this.transmission){let b=lJ,c=lj.sub(lJ).normalize(),d=a.context;d.backdrop=py(lW,c,hI,hG,hV,hW,b,lv,lg,le,h0,h2,h4,h3,this.dispersion?h5:null),d.backdropAlpha=h1,hG.a.mulAssign(jG(1,d.backdrop.a,h1))}super.start(a)}computeMultiscattering(a,b,c){let d=o5({roughness:hI,dotNV:lV.dot(lM).clamp()}),e=this.iridescenceF0?hO.mix(hV,this.iridescenceF0):hV,f=e.mul(d.x).add(c.mul(d.y)),g=d.x.add(d.y).oneMinus(),h=e.add(e.oneMinus().mul(.047619)),i=f.mul(h).div(g.mul(h).oneMinus());a.addAssign(f),b.addAssign(i.mul(g))}direct({lightDirection:a,lightColor:b,reflectedLight:c}){let d=lV.dot(a).clamp().mul(b);if(!0===this.sheen&&this.sheenSpecularDirect.addAssign(d.mul(pb({lightDirection:a}))),!0===this.clearcoat){let c=lX.dot(a).clamp().mul(b);this.clearcoatSpecularDirect.addAssign(c.mul(o2({lightDirection:a,f0:pD,f90:pE,roughness:hL,normalView:lX})))}c.directDiffuse.addAssign(d.mul(oP({diffuseColor:hG.rgb}))),c.directSpecular.addAssign(d.mul(o6({lightDirection:a,f0:hV,f90:1,roughness:hI,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:a,lightPosition:b,halfWidth:c,halfHeight:d,reflectedLight:e,ltc_1:f,ltc_2:g}){let h=b.add(c).sub(d),i=b.sub(c).sub(d),j=b.sub(c).add(d),k=b.add(c).add(d),l=lL.toVar(),m=pc({N:lV,V:lM,roughness:hI}),n=f.sample(m).toVar(),o=g.sample(m).toVar(),p=hv(hm(n.x,0,n.y),hm(0,1,0),hm(n.z,0,n.w)).toVar(),q=hV.mul(o.x).add(hV.oneMinus().mul(o.y)).toVar();e.directSpecular.addAssign(a.mul(q).mul(pf({N:lV,V:lM,P:l,mInv:p,p0:h,p1:i,p2:j,p3:k}))),e.directDiffuse.addAssign(a.mul(hG).mul(pf({N:lV,V:lM,P:l,mInv:hv(1,0,0,0,1,0,0,0,1),p0:h,p1:i,p2:j,p3:k})))}indirect(a){this.indirectDiffuse(a),this.indirectSpecular(a),this.ambientOcclusion(a)}indirectDiffuse(a){let{irradiance:b,reflectedLight:c}=a.context;c.indirectDiffuse.addAssign(b.mul(oP({diffuseColor:hG})))}indirectSpecular(a){let{radiance:b,iblIrradiance:c,reflectedLight:d}=a.context;if(!0===this.sheen&&this.sheenSpecularIndirect.addAssign(c.mul(hM,pC({normal:lV,viewDir:lM,roughness:hN}))),!0===this.clearcoat){let a=o7({dotNV:lX.dot(lM).clamp(),specularColor:pD,specularF90:pE,roughness:hL});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(a))}let e=hm().toVar("singleScattering"),f=hm().toVar("multiScattering"),g=c.mul(1/Math.PI);this.computeMultiscattering(e,f,hW);let h=e.add(f),i=hG.mul(h.r.max(h.g).max(h.b).oneMinus());d.indirectSpecular.addAssign(b.mul(e)),d.indirectSpecular.addAssign(f.mul(g)),d.indirectDiffuse.addAssign(i.mul(g))}ambientOcclusion(a){let{ambientOcclusion:b,reflectedLight:c}=a.context,d=lV.dot(lM).clamp().add(b),e=hI.mul(-16).oneMinus().negate().exp2(),f=b.sub(d.pow(e).oneMinus()).clamp();!0===this.clearcoat&&this.clearcoatSpecularIndirect.mulAssign(b),!0===this.sheen&&this.sheenSpecularIndirect.mulAssign(b),c.indirectDiffuse.mulAssign(b),c.indirectSpecular.mulAssign(f)}finish({context:a}){let{outgoingLight:b}=a;if(!0===this.clearcoat){let a=oO({dotVH:lX.dot(lM).clamp(),f0:pD,f90:pE}),c=b.mul(hK.mul(a).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(hK));b.assign(c)}if(!0===this.sheen){let a=hM.r.max(hM.g).max(hM.b).mul(.157).oneMinus(),c=b.mul(a).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);b.assign(c)}}},pG=he(1),pH=he(-2),pI=he(.8),pJ=he(-1),pK=he(.4),pL=he(2),pM=he(.305),pN=he(3),pO=he(.21),pP=he(4),pQ=he(4),pR=he(16),pS=fu(([a])=>{let b=hm(jc(a)).toVar(),c=he(-1).toVar();return hb(b.x.greaterThan(b.z),()=>{hb(b.x.greaterThan(b.y),()=>{c.assign(jT(a.x.greaterThan(0),0,3))}).Else(()=>{c.assign(jT(a.y.greaterThan(0),1,4))})}).Else(()=>{hb(b.z.greaterThan(b.y),()=>{c.assign(jT(a.z.greaterThan(0),2,5))}).Else(()=>{c.assign(jT(a.y.greaterThan(0),1,4))})}),c}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),pT=fu(([a,b])=>{let c=hi().toVar();return hb(b.equal(0),()=>{c.assign(hi(a.z,a.y).div(jc(a.x)))}).ElseIf(b.equal(1),()=>{c.assign(hi(a.x.negate(),a.z.negate()).div(jc(a.y)))}).ElseIf(b.equal(2),()=>{c.assign(hi(a.x.negate(),a.y).div(jc(a.z)))}).ElseIf(b.equal(3),()=>{c.assign(hi(a.z.negate(),a.y).div(jc(a.x)))}).ElseIf(b.equal(4),()=>{c.assign(hi(a.x.negate(),a.z).div(jc(a.y)))}).Else(()=>{c.assign(hi(a.x,a.y).div(jc(a.z)))}),ip(.5,c.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),pU=fu(([a])=>{let b=he(0).toVar();return hb(a.greaterThanEqual(pI),()=>{b.assign(pG.sub(a).mul(pJ.sub(pH)).div(pG.sub(pI)).add(pH))}).ElseIf(a.greaterThanEqual(pK),()=>{b.assign(pI.sub(a).mul(pL.sub(pJ)).div(pI.sub(pK)).add(pJ))}).ElseIf(a.greaterThanEqual(pM),()=>{b.assign(pK.sub(a).mul(pN.sub(pL)).div(pK.sub(pM)).add(pL))}).ElseIf(a.greaterThanEqual(pO),()=>{b.assign(pM.sub(a).mul(pP.sub(pN)).div(pM.sub(pO)).add(pN))}).Else(()=>{b.assign(he(-2).mul(i_(ip(1.16,a))))}),b}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),pV=fu(([a,b])=>{let c=a.toVar();c.assign(ip(2,c).sub(1));let d=hm(c,1).toVar();return hb(b.equal(0),()=>{d.assign(d.zyx)}).ElseIf(b.equal(1),()=>{d.assign(d.xzy),d.xz.mulAssign(-1)}).ElseIf(b.equal(2),()=>{d.x.mulAssign(-1)}).ElseIf(b.equal(3),()=>{d.assign(d.zyx),d.xz.mulAssign(-1)}).ElseIf(b.equal(4),()=>{d.assign(d.xzy),d.xy.mulAssign(-1)}).ElseIf(b.equal(5),()=>{d.z.mulAssign(-1)}),d}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),pW=fu(([a,b,c,d,e,f])=>{let g=he(c),h=hm(b),i=jH(pU(g),pH,f),j=i5(i),k=i2(i),l=hm(pX(a,h,k,d,e,f)).toVar();return hb(j.notEqual(0),()=>{let b=hm(pX(a,h,k.add(1),d,e,f)).toVar();l.assign(jG(l,b,j))}),l}),pX=fu(([a,b,c,d,e,f])=>{let g=he(c).toVar(),h=hm(b),i=he(pS(h)).toVar(),j=he(js(pQ.sub(g),0)).toVar();g.assign(js(g,pQ));let k=he(iZ(g)).toVar(),l=hi(pT(h,i).mul(k.sub(2)).add(1)).toVar();return hb(i.greaterThan(2),()=>{l.y.addAssign(k),i.subAssign(3)}),l.x.addAssign(i.mul(k)),l.x.addAssign(j.mul(ip(3,pR))),l.y.addAssign(ip(4,iZ(f).sub(k))),l.x.mulAssign(d),l.y.mulAssign(e),a.sample(l).grad(hi(),hi())}),pY=fu(({envMap:a,mipInt:b,outputDirection:c,theta:d,axis:e,CUBEUV_TEXEL_WIDTH:f,CUBEUV_TEXEL_HEIGHT:g,CUBEUV_MAX_MIP:h})=>{let i=i7(d);return pX(a,c.mul(i).add(e.cross(c).mul(i6(d))).add(e.mul(e.dot(c).mul(i.oneMinus()))),b,f,g,h)}),pZ=fu(({n:a,latitudinal:b,poleAxis:c,outputDirection:d,weights:e,samples:f,dTheta:g,mipInt:h,envMap:i,CUBEUV_TEXEL_WIDTH:j,CUBEUV_TEXEL_HEIGHT:k,CUBEUV_MAX_MIP:l})=>{let m=hm(jT(b,c,jy(c,d))).toVar();hb(m.equal(hm(0)),()=>{m.assign(hm(d.z,0,d.x.negate()))}),m.assign(i4(m));let n=hm().toVar();return n.addAssign(e.element(0).mul(pY({theta:0,axis:m,outputDirection:d,mipInt:h,envMap:i,CUBEUV_TEXEL_WIDTH:j,CUBEUV_TEXEL_HEIGHT:k,CUBEUV_MAX_MIP:l}))),nM({start:hf(1),end:a},({i:a})=>{hb(a.greaterThanEqual(f),()=>{nO()});let b=he(g.mul(he(a))).toVar();n.addAssign(e.element(a).mul(pY({theta:b.mul(-1),axis:m,outputDirection:d,mipInt:h,envMap:i,CUBEUV_TEXEL_WIDTH:j,CUBEUV_TEXEL_HEIGHT:k,CUBEUV_MAX_MIP:l}))),n.addAssign(e.element(a).mul(pY({theta:b,axis:m,outputDirection:d,mipInt:h,envMap:i,CUBEUV_TEXEL_WIDTH:j,CUBEUV_TEXEL_HEIGHT:k,CUBEUV_MAX_MIP:l})))}),hq(n,1)}),p$=fu(([a])=>{let b=hg(a).toVar();return b.assign(b.shiftLeft(hg(16)).bitOr(b.shiftRight(hg(16)))),b.assign(b.bitAnd(hg(0x55555555)).shiftLeft(hg(1)).bitOr(b.bitAnd(hg(0xaaaaaaaa)).shiftRight(hg(1)))),b.assign(b.bitAnd(hg(0x33333333)).shiftLeft(hg(2)).bitOr(b.bitAnd(hg(0xcccccccc)).shiftRight(hg(2)))),b.assign(b.bitAnd(hg(0xf0f0f0f)).shiftLeft(hg(4)).bitOr(b.bitAnd(hg(0xf0f0f0f0)).shiftRight(hg(4)))),b.assign(b.bitAnd(hg(0xff00ff)).shiftLeft(hg(8)).bitOr(b.bitAnd(hg(0xff00ff00)).shiftRight(hg(8)))),he(b).mul(23283064365386963e-26)}),p_=fu(([a,b])=>hi(he(a).div(he(b)),p$(a))),p0=fu(([a,b,c])=>{let d=hm(b).toVar(),e=he(c),f=e.mul(e).toVar(),g=i4(hm(f.mul(d.x),f.mul(d.y),d.z)).toVar(),h=g.x.mul(g.x).add(g.y.mul(g.y)),i=jT(h.greaterThan(0),hm(g.y.negate(),g.x,0).div(i0(h)),hm(1,0,0)).toVar(),j=jy(g,i).toVar(),k=i0(a.x),l=ip(2,3.14159265359).mul(a.y),m=k.mul(i7(l)).toVar(),n=k.mul(i6(l)).toVar(),o=ip(.5,g.z.add(1));n.assign(o.oneMinus().mul(i0(m.mul(m).oneMinus())).add(o.mul(n)));let p=i.mul(m).add(j.mul(n)).add(g.mul(i0(js(0,m.mul(m).add(n.mul(n)).oneMinus()))));return i4(hm(f.mul(p.x),f.mul(p.y),js(0,p.z)))}),p1=fu(({roughness:a,mipInt:b,envMap:c,N_immutable:d,GGX_SAMPLES:e,CUBEUV_TEXEL_WIDTH:f,CUBEUV_TEXEL_HEIGHT:g,CUBEUV_MAX_MIP:h})=>{let i=hm(d).toVar(),j=hm(0).toVar(),k=he(0).toVar();return hb(a.lessThan(.001),()=>{j.assign(pX(c,i,b,f,g,h))}).Else(()=>{let d=i4(jy(jT(jc(i.z).lessThan(.999),hm(0,0,1),hm(1,0,0)),i)).toVar(),l=jy(i,d).toVar();nM({start:hg(0),end:e},({i:m})=>{let n=p0(p_(m,e),hm(0,0,1),a),o=i4(d.mul(n.x).add(l.mul(n.y)).add(i.mul(n.z))),p=i4(o.mul(jx(i,o).mul(2)).sub(i)),q=js(jx(i,p),0);hb(q.greaterThan(0),()=>{let a=pX(c,p,b,f,g,h);j.addAssign(a.mul(q)),k.addAssign(q)})}),hb(k.greaterThan(0),()=>{j.assign(j.div(k))})}),hq(j,1)}),p2=[.125,.215,.35,.446,.526,.582],p3=new e$(-1,1,1,-1,0,1),p4=new dV(90,1),p5=new de,p6=null,p7=0,p8=0,p9=new bQ,qa=new WeakMap,qb=[3,1,5,0,4,2],qd=hm((qc=pV(kJ(),kI("faceIndex")).normalize()).x,qc.y,qc.z),qe=class{constructor(a){this._renderer=a,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._ggxMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(a,b=0,c=.1,d=100,e={}){let{size:f=256,position:g=p9,renderTarget:h=null}=e;if(this._setSize(f),!1===this._hasInitialized){I('PMREMGenerator: ".fromScene()" called before the backend is initialized. Try using "await renderer.init()" instead.');let f=h||this._allocateTarget();return e.renderTarget=f,this.fromSceneAsync(a,b,c,d,e),f}p6=this._renderer.getRenderTarget(),p7=this._renderer.getActiveCubeFace(),p8=this._renderer.getActiveMipmapLevel();let i=h||this._allocateTarget();return i.depthBuffer=!0,this._init(i),this._sceneToCubeUV(a,c,d,i,g),b>0&&this._blur(i,0,0,b),this._applyPMREM(i),this._cleanup(i),i}async fromSceneAsync(a,b=0,c=.1,d=100,e={}){return K('PMREMGenerator: ".fromSceneAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this.fromScene(a,b,c,d,e)}fromEquirectangular(a,b=null){if(!1===this._hasInitialized){I('PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using "await renderer.init()" instead.'),this._setSizeFromTexture(a);let c=b||this._allocateTarget();return this.fromEquirectangularAsync(a,c),c}return this._fromTexture(a,b)}async fromEquirectangularAsync(a,b=null){return K('PMREMGenerator: ".fromEquirectangularAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(a,b)}fromCubemap(a,b=null){if(!1===this._hasInitialized){I("PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(a);let c=b||this._allocateTarget();return this.fromCubemapAsync(a,b),c}return this._fromTexture(a,b)}async fromCubemapAsync(a,b=null){return K('PMREMGenerator: ".fromCubemapAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(a,b)}async compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=fF(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=fG(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose(),null!==this._backgroundBox&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(a){301===a.mapping||302===a.mapping?this._setSize(0===a.image.length?16:a.image[0].width||a.image[0].image.width):this._setSize(a.image.width/4)}_setSize(a){this._lodMax=Math.floor(Math.log2(a)),this._cubeSize=2**this._lodMax}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._ggxMaterial&&this._ggxMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let a=0;a<this._lodMeshes.length;a++)this._lodMeshes[a].geometry.dispose()}_cleanup(a){this._renderer.setRenderTarget(p6,p7,p8),a.scissorTest=!1,fD(a,0,0,a.width,a.height)}_fromTexture(a,b){this._setSizeFromTexture(a),p6=this._renderer.getRenderTarget(),p7=this._renderer.getActiveCubeFace(),p8=this._renderer.getActiveMipmapLevel();let c=b||this._allocateTarget();return this._init(c),this._textureToCubeUV(a,c),this._applyPMREM(c),this._cleanup(c),c}_allocateTarget(){return fC(3*Math.max(this._cubeSize,112),4*this._cubeSize)}_init(a){if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==a.width||this._pingPongRenderTarget.height!==a.height){var b,c;let d,e,f,g,h,i;null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=fC(a.width,a.height);let{_lodMax:j}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=function(a){let b=[],c=[],d=[],e=a,f=a-4+1+p2.length;for(let g=0;g<f;g++){let f=2**e;b.push(f);let h=1/f;g>a-4?h=p2[g-a+4-1]:0===g&&(h=0),c.push(h);let i=1/(f-2),j=-i,k=1+i,l=[j,j,k,j,k,k,j,j,k,k,j,k],m=new Float32Array(108),n=new Float32Array(72),o=new Float32Array(36);for(let a=0;a<6;a++){let b=a%3*2/3-1,c=a>2?0:-1,d=[b,c,0,b+2/3,c,0,b+2/3,c+1,0,b,c,0,b+2/3,c+1,0,b,c+1,0],e=qb[a];m.set(d,18*e),n.set(l,12*e);let f=[e,e,e,e,e,e];o.set(f,6*e)}let p=new dA;p.setAttribute("position",new dn(m,3)),p.setAttribute("uv",new dn(n,2)),p.setAttribute("faceIndex",new dn(o,1)),d.push(new dM(p,null)),e>4&&e--}return{lodMeshes:d,sizeLods:b,sigmas:c}}(j)),this._blurMaterial=(b=a.width,c=a.height,d=kZ(Array(20).fill(0)),e=id(new bQ(0,1,0)),f=id(0),h={n:he(20),latitudinal:g=id(0),weights:d,poleAxis:e,outputDirection:qd,dTheta:f,samples:id(1),envMap:kP(),mipInt:id(0),CUBEUV_TEXEL_WIDTH:he(1/b),CUBEUV_TEXEL_HEIGHT:he(1/c),CUBEUV_MAX_MIP:he(j)},(i=fE("blur")).fragmentNode=pZ({...h,latitudinal:g.equal(1)}),qa.set(i,h),i)}}async _compileMaterial(a){let b=new dM(new dA,a);await this._renderer.compile(b,p3)}_sceneToCubeUV(a,b,c,d,e){p4.near=b,p4.far=c;let f=[1,1,1,1,-1,1],g=[1,-1,1,-1,1,-1],h=this._renderer,i=h.autoClear;h.getClearColor(p5),h.autoClear=!1,null===this._backgroundBox&&(this._backgroundBox=new dM(new dN,new di({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1})));let j=this._backgroundBox,k=j.material,l=!1,m=a.background;m?m.isColor&&(k.color.copy(m),a.background=null,l=!0):(k.color.copy(p5),l=!0),h.setRenderTarget(d),h.clear(),l&&h.render(j,p4);for(let b=0;b<6;b++){let c=b%3;0===c?(p4.up.set(0,f[b],0),p4.position.set(e.x,e.y,e.z),p4.lookAt(e.x+g[b],e.y,e.z)):1===c?(p4.up.set(0,0,f[b]),p4.position.set(e.x,e.y,e.z),p4.lookAt(e.x,e.y+g[b],e.z)):(p4.up.set(0,f[b],0),p4.position.set(e.x,e.y,e.z),p4.lookAt(e.x,e.y,e.z+g[b]));let i=this._cubeSize;fD(d,c*i,b>2?i:0,i,i),h.render(a,p4)}h.autoClear=i,a.background=m}_textureToCubeUV(a,b){let c=this._renderer,d=301===a.mapping||302===a.mapping;d?null===this._cubemapMaterial&&(this._cubemapMaterial=fF(a)):null===this._equirectMaterial&&(this._equirectMaterial=fG(a));let e=d?this._cubemapMaterial:this._equirectMaterial;e.fragmentNode.value=a;let f=this._lodMeshes[0];f.material=e;let g=this._cubeSize;fD(b,0,0,3*g,2*g),c.setRenderTarget(b),c.render(f,p3)}_applyPMREM(a){let b=this._renderer,c=b.autoClear;b.autoClear=!1;let d=this._lodMeshes.length;for(let b=1;b<d;b++)this._applyGGXFilter(a,b-1,b);b.autoClear=c}_applyGGXFilter(a,b,c){var d,e,f;let g,h,i=this._renderer,j=this._pingPongRenderTarget;null===this._ggxMaterial&&(this._ggxMaterial=(d=this._lodMax,e=this._pingPongRenderTarget.width,f=this._pingPongRenderTarget.height,g={envMap:kP(),roughness:id(0),mipInt:id(0),CUBEUV_TEXEL_WIDTH:he(1/e),CUBEUV_TEXEL_HEIGHT:he(1/f),CUBEUV_MAX_MIP:he(d)},(h=fE("ggx")).fragmentNode=p1({...g,N_immutable:qd,GGX_SAMPLES:hg(512)}),qa.set(h,g),h));let k=this._ggxMaterial,l=this._lodMeshes[c];l.material=k;let m=qa.get(k),n=c/(this._lodMeshes.length-1),o=b/(this._lodMeshes.length-1),p=Math.sqrt(n*n-o*o)*(.05+.95*n),{_lodMax:q}=this,r=this._sizeLods[c],s=3*r*(c>q-4?c-q+4:0),t=4*(this._cubeSize-r);a.texture.frame=(a.texture.frame||0)+1,m.envMap.value=a.texture,m.roughness.value=p,m.mipInt.value=q-b,fD(j,s,t,3*r,2*r),i.setRenderTarget(j),i.render(l,p3),j.texture.frame=(j.texture.frame||0)+1,m.envMap.value=j.texture,m.roughness.value=0,m.mipInt.value=q-c,fD(a,s,t,3*r,2*r),i.setRenderTarget(a),i.render(l,p3)}_blur(a,b,c,d,e){let f=this._pingPongRenderTarget;this._halfBlur(a,f,b,c,d,"latitudinal",e),this._halfBlur(f,a,c,c,d,"longitudinal",e)}_halfBlur(a,b,c,d,e,f,g){let h=this._renderer,i=this._blurMaterial;"latitudinal"!==f&&"longitudinal"!==f&&J("blur direction must be either latitudinal or longitudinal!");let j=this._lodMeshes[d];j.material=i;let k=qa.get(i),l=this._sizeLods[c]-1,m=isFinite(e)?Math.PI/(2*l):2*Math.PI/39,n=e/m,o=isFinite(e)?1+Math.floor(3*n):20;o>20&&I(`sigmaRadians, ${e}, is too large and will clip, as it requested ${o} samples when the maximum is set to 20`);let p=[],q=0;for(let a=0;a<20;++a){let b=a/n,c=Math.exp(-b*b/2);p.push(c),0===a?q+=c:a<o&&(q+=2*c)}for(let a=0;a<p.length;a++)p[a]=p[a]/q;a.texture.frame=(a.texture.frame||0)+1,k.envMap.value=a.texture,k.samples.value=o,k.weights.array=p,k.latitudinal.value=+("latitudinal"===f),g&&(k.poleAxis.value=g);let{_lodMax:r}=this;k.dTheta.value=m,k.mipInt.value=r-c;let s=this._sizeLods[d];fD(b,3*s*(d>r-4?d-r+4:0),4*(this._cubeSize-s),3*s,2*s),h.setRenderTarget(b),h.render(j,p3)}},qf=new WeakMap,qg=g4(class extends gp{static get type(){return"PMREMNode"}constructor(a,b=null,c=null){super("vec3"),this._value=a,this._pmrem=null,this.uvNode=b,this.levelNode=c,this._generator=null;let d=new b2;d.isRenderTargetTexture=!0,this._texture=kP(d),this._width=id(0),this._height=id(0),this._maxMip=id(0),this.updateBeforeType=gd.RENDER}set value(a){this._value=a,this._pmrem=null}get value(){return this._value}updateFromTexture(a){var b;let c,d=(c=Math.log2(b=a.image.height)-2,{texelWidth:1/(3*Math.max(2**c,112)),texelHeight:1/b,maxMip:c});this._texture.value=a,this._width.value=d.texelWidth,this._height.value=d.texelHeight,this._maxMip.value=d.maxMip}updateBefore(a){let b=this._pmrem,c=b?b.pmremVersion:-1,d=this._value;c!==d.pmremVersion&&null!==(b=!0===d.isPMREMTexture?d:function(a,b,c){var d,e;let f,g=(d=b,void 0===(f=qf.get(d))&&(f=new WeakMap,qf.set(d,f)),f),h=g.get(a);if((void 0===h?-1:h.pmremVersion)!==a.pmremVersion){let b=a.image;if(a.isCubeTexture)if(!function(a){if(null==a)return!1;let b=0;for(let c=0;c<6;c++)void 0!==a[c]&&b++;return 6===b}(b))return null;else h=c.fromCubemap(a,h);else{if(!(null!=(e=b)&&e.height>0))return null;h=c.fromEquirectangular(a,h)}h.pmremVersion=a.pmremVersion,g.set(a,h)}return h.texture}(d,a.renderer,this._generator))&&(this._pmrem=b,this.updateFromTexture(b))}setup(a){null===this._generator&&(this._generator=new qe(a.renderer)),this.updateBefore(a);let b=this.uvNode;null===b&&a.context.getUV&&(b=a.context.getUV(this)),b=l5.mul(hm(b.x,b.y.negate(),b.z));let c=this.levelNode;return null===c&&a.context.getTextureLevel&&(c=a.context.getTextureLevel(this)),pW(this._texture,b,c,this._width,this._height,this._maxMip)}dispose(){super.dispose(),null!==this._generator&&this._generator.dispose()}}).setParameterLength(1,3),qh=new WeakMap,qi=class extends nT{static get type(){return"EnvironmentNode"}constructor(a=null){super(),this.envNode=a}setup(a){let{material:b}=a,c=this.envNode;if(c.isTextureNode||c.isMaterialReferenceNode){let a=c.isTextureNode?c.value:b[c.property],d=qh.get(a);void 0===d&&(d=qg(a),qh.set(a,d)),c=d}let d=!0===b.useAnisotropy||b.anisotropy>0?mK:lV,e=c.context(qj(hI,d)).mul(l4),f=c.context(qk(lW)).mul(Math.PI).mul(l4),g=ks(e),h=ks(f);a.context.radiance.addAssign(g),a.context.iblIrradiance.addAssign(h);let i=a.context.lightingModel.clearcoatRadiance;if(i){let a=ks(c.context(qj(hL,lX)).mul(l4));i.addAssign(a)}}},qj=(a,b)=>{let c=null;return{getUV:()=>(null===c&&(c=lM.negate().reflect(b),c=(c=jC(a).mix(c,b).normalize()).transformDirection(lg)),c),getTextureLevel:()=>a}},qk=a=>({getUV:()=>a,getTextureLevel:()=>he(1)}),ql=new eq,qm=class extends ot{static get type(){return"MeshStandardNodeMaterial"}constructor(a){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(ql),this.setValues(a)}setupEnvironment(a){let b=super.setupEnvironment(a);return null===b&&a.environmentNode&&(b=a.environmentNode),b?new qi(b):null}setupLightingModel(){return new pF}setupSpecular(){let a=jG(hm(.04),hG.rgb,hJ);hV.assign(a),hW.assign(1)}setupVariants(){let a=this.metalnessNode?he(this.metalnessNode):m0;hJ.assign(a);let b=this.roughnessNode?he(this.roughnessNode):m_;b=oY({roughness:b}),hI.assign(b),this.setupSpecular(),hG.assign(hq(hG.rgb.mul(a.oneMinus()),hG.a))}copy(a){return this.emissiveNode=a.emissiveNode,this.metalnessNode=a.metalnessNode,this.roughnessNode=a.roughnessNode,super.copy(a)}},qn=new er,qo=class extends qm{static get type(){return"MeshPhysicalNodeMaterial"}constructor(a){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(qn),this.setValues(a)}get useClearcoat(){return this.clearcoat>0||null!==this.clearcoatNode}get useIridescence(){return this.iridescence>0||null!==this.iridescenceNode}get useSheen(){return this.sheen>0||null!==this.sheenNode}get useAnisotropy(){return this.anisotropy>0||null!==this.anisotropyNode}get useTransmission(){return this.transmission>0||null!==this.transmissionNode}get useDispersion(){return this.dispersion>0||null!==this.dispersionNode}setupSpecular(){let a=this.iorNode?he(this.iorNode):ne;h0.assign(a),hV.assign(jG(jr(jA(h0.sub(1).div(h0.add(1))).mul(mY),hm(1)).mul(mX),hG.rgb,hJ)),hW.assign(jG(mX,1,hJ))}setupLightingModel(){return new pF(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(a){if(super.setupVariants(a),this.useClearcoat){let a=this.clearcoatNode?he(this.clearcoatNode):m2,b=this.clearcoatRoughnessNode?he(this.clearcoatRoughnessNode):m3;hK.assign(a),hL.assign(oY({roughness:b}))}if(this.useSheen){let a=this.sheenNode?hm(this.sheenNode):m6,b=this.sheenRoughnessNode?he(this.sheenRoughnessNode):m7;hM.assign(a),hN.assign(b)}if(this.useIridescence){let a=this.iridescenceNode?he(this.iridescenceNode):m9,b=this.iridescenceIORNode?he(this.iridescenceIORNode):na,c=this.iridescenceThicknessNode?he(this.iridescenceThicknessNode):nb;hO.assign(a),hP.assign(b),hQ.assign(c)}if(this.useAnisotropy){let a=(this.anisotropyNode?hi(this.anisotropyNode):m8).toVar();hS.assign(a.length()),hb(hS.equal(0),()=>{a.assign(hi(1,0))}).Else(()=>{a.divAssign(hi(hS)),hS.assign(hS.saturate())}),hR.assign(hS.pow2().mix(hI.pow2(),1)),hT.assign(mH[0].mul(a.x).add(mH[1].mul(a.y))),hU.assign(mH[1].mul(a.x).sub(mH[0].mul(a.y)))}if(this.useTransmission){let a=this.transmissionNode?he(this.transmissionNode):nc,b=this.thicknessNode?he(this.thicknessNode):nd,c=this.attenuationDistanceNode?he(this.attenuationDistanceNode):nf,d=this.attenuationColorNode?hm(this.attenuationColorNode):ng;if(h1.assign(a),h2.assign(b),h3.assign(c),h4.assign(d),this.useDispersion){let a=this.dispersionNode?he(this.dispersionNode):nn;h5.assign(a)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?hm(this.clearcoatNormalNode):m4}setup(a){a.context.setupClearcoatNormal=()=>j2(this.setupClearcoatNormal(a),"NORMAL","vec3"),super.setup(a)}copy(a){return this.clearcoatNode=a.clearcoatNode,this.clearcoatRoughnessNode=a.clearcoatRoughnessNode,this.clearcoatNormalNode=a.clearcoatNormalNode,this.sheenNode=a.sheenNode,this.sheenRoughnessNode=a.sheenRoughnessNode,this.iridescenceNode=a.iridescenceNode,this.iridescenceIORNode=a.iridescenceIORNode,this.iridescenceThicknessNode=a.iridescenceThicknessNode,this.specularIntensityNode=a.specularIntensityNode,this.specularColorNode=a.specularColorNode,this.transmissionNode=a.transmissionNode,this.thicknessNode=a.thicknessNode,this.attenuationDistanceNode=a.attenuationDistanceNode,this.attenuationColorNode=a.attenuationColorNode,this.dispersionNode=a.dispersionNode,this.anisotropyNode=a.anisotropyNode,super.copy(a)}},qp=fu(({normal:a,lightDirection:b,builder:c})=>{let d=hi(a.dot(b).mul(.5).add(.5),0);if(c.material.gradientMap)return hm(mj("gradientMap","texture").context({getUV:()=>d}).r);{let a=d.fwidth().mul(.5);return jG(hm(.7),hm(1),jK(he(.7).sub(a.x),he(.7).add(a.x),d.x))}}),qq=class extends oK{direct({lightDirection:a,lightColor:b,reflectedLight:c},d){let e=qp({normal:lQ,lightDirection:a,builder:d}).mul(b);c.directDiffuse.addAssign(e.mul(oP({diffuseColor:hG.rgb})))}indirect(a){let{ambientOcclusion:b,irradiance:c,reflectedLight:d}=a.context;d.indirectDiffuse.addAssign(c.mul(oP({diffuseColor:hG}))),d.indirectDiffuse.mulAssign(b)}},qr=new et,qs=class extends ot{static get type(){return"MeshToonNodeMaterial"}constructor(a){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(qr),this.setValues(a)}setupLightingModel(){return new qq}},qt=fu(()=>{let a=hm(lM.z,0,lM.x.negate()).normalize(),b=lM.cross(a);return hi(a.dot(lV),b.dot(lV)).mul(.495).add(.5)}).once(["NORMAL","VERTEX"])().toVar("matcapUV"),qu=new ew,qv=class extends ot{static get type(){return"MeshMatcapNodeMaterial"}constructor(a){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(qu),this.setValues(a)}setupVariants(a){let b;b=a.material.matcap?mj("matcap","texture").context({getUV:()=>qt}):hm(jG(.2,.8,qt.y)),hG.rgb.mulAssign(b.rgb)}},qw=g4(class extends gp{static get type(){return"RotateNode"}constructor(a,b){super(),this.positionNode=a,this.rotationNode=b}getNodeType(a){return this.positionNode.getNodeType(a)}setup(a){let{rotationNode:b,positionNode:c}=this;if("vec2"===this.getNodeType(a)){let a=b.cos(),d=b.sin();return hu(a,d,d.negate(),a).mul(c)}{let a=hw(hq(1,0,0,0),hq(0,i7(b.x),i6(b.x).negate(),0),hq(0,i6(b.x),i7(b.x),0),hq(0,0,0,1)),d=hw(hq(i7(b.y),0,i6(b.y),0),hq(0,1,0,0),hq(i6(b.y).negate(),0,i7(b.y),0),hq(0,0,0,1)),e=hw(hq(i7(b.z),i6(b.z).negate(),0,0),hq(i6(b.z),i7(b.z),0,0),hq(0,0,1,0),hq(0,0,0,1));return a.mul(d).mul(e).mul(hq(c,1)).xyz}}}).setParameterLength(2),qx=new d4,qy=class extends ot{static get type(){return"SpriteNodeMaterial"}constructor(a){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(qx),this.setValues(a)}setupPositionView(a){let{object:b,camera:c}=a,{positionNode:d,rotationNode:e,scaleNode:f,sizeAttenuation:g}=this,h=lC.mul(hm(d||0)),i=hi(lv[0].xyz.length(),lv[1].xyz.length());null!==f&&(i=i.mul(hi(f))),c.isPerspectiveCamera&&!1===g&&(i=i.mul(h.z.negate()));let j=lG.xy;if(b.center&&!0===b.center.isVector2){let a=g0(new kd("center","vec2",b));j=j.sub(a.sub(.5))}let k=qw(j=j.mul(i),he(e||m5));return hq(h.xy.add(k),h.zw)}copy(a){return this.positionNode=a.positionNode,this.rotationNode=a.rotationNode,this.scaleNode=a.scaleNode,super.copy(a)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(a){this._useSizeAttenuation!==a&&(this._useSizeAttenuation=a,this.needsUpdate=!0)}},qz=new ej,qA=new bO,qB=class extends qy{static get type(){return"PointsNodeMaterial"}constructor(a){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(qz),this.setValues(a)}setupPositionView(){let{positionNode:a}=this;return lC.mul(hm(a||lH)).xyz}setupVertexSprite(a){let{material:b,camera:c}=a,{rotationNode:d,scaleNode:e,sizeNode:f,sizeAttenuation:g}=this,h=super.setupVertex(a);if(!0!==b.isNodeMaterial)return h;let i=null===f?nm:hi(f);i=i.mul(k2),c.isPerspectiveCamera&&!0===g&&(i=i.mul(qC.div(lL.z.negate()))),e&&e.isNode&&(i=i.mul(hi(e)));let j=lG.xy;return d&&d.isNode&&(j=qw(j,he(d))),j=(j=(j=j.mul(i)).div(k7.div(2))).mul(h.w),h=h.add(hq(j,0,0))}setupVertex(a){return a.object.isPoints?super.setupVertex(a):this.setupVertexSprite(a)}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(a){this._useAlphaToCoverage!==a&&(this._useAlphaToCoverage=a,this.needsUpdate=!0)}},qC=id(1).onFrameUpdate(function({renderer:a}){this.value=.5*a.getSize(qA).y}),qD=class extends oK{constructor(){super(),this.shadowNode=he(1).toVar("shadowMask")}direct({lightNode:a}){null!==a.shadowNode&&this.shadowNode.mulAssign(a.shadowNode)}finish({context:a}){hG.a.mulAssign(this.shadowNode.oneMinus()),a.outgoingLight.rgb.assign(hG.rgb)}},qE=new ep,qF=class extends ot{static get type(){return"ShadowNodeMaterial"}constructor(a){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(qE),this.setValues(a)}setupLightingModel(){return new qD}},hE("vec3"),hE("vec3"),hE("vec3"),qG=class{constructor(a,b,c){this.renderer=a,this.nodes=b,this.info=c,this._context="u">typeof self?self:null,this._animationLoop=null,this._requestId=null}start(){let a=(b,c)=>{this._requestId=this._context.requestAnimationFrame(a),!0===this.info.autoReset&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this.renderer._inspector.begin(),null!==this._animationLoop&&this._animationLoop(b,c),this.renderer._inspector.finish()};a()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(a){this._animationLoop=a}getContext(){return this._context}setContext(a){this._context=a}dispose(){this.stop()}},qH=class{constructor(){this.weakMap=new WeakMap}get(a){let b=this.weakMap;for(let c=0;c<a.length-1;c++)if(void 0===(b=b.get(a[c])))return;return b.get(a[a.length-1])}set(a,b){let c=this.weakMap;for(let b=0;b<a.length-1;b++){let d=a[b];!1===c.has(d)&&c.set(d,new WeakMap),c=c.get(d)}return c.set(a[a.length-1],b),this}delete(a){let b=this.weakMap;for(let c=0;c<a.length-1;c++)if(void 0===(b=b.get(a[c])))return!1;return b.delete(a[a.length-1])}},qI=0,qJ=class{constructor(a,b,c,d,e,f,g,h,i,j){this.id=qI++,this._nodes=a,this._geometries=b,this.renderer=c,this.object=d,this.material=e,this.scene=f,this.camera=g,this.lightsNode=h,this.context=i,this.geometry=d.geometry,this.version=e.version,this.drawRange=null,this.attributes=null,this.attributesId=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=j,this.clippingContextCacheKey=null===j?"":j.cacheKey,this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.onGeometryDispose=()=>{this.attributes=null,this.attributesId=null},this.material.addEventListener("dispose",this.onMaterialDispose),this.geometry.addEventListener("dispose",this.onGeometryDispose)}updateClipping(a){this.clippingContext=a}get clippingNeedsUpdate(){return null!==this.clippingContext&&this.clippingContext.cacheKey!==this.clippingContextCacheKey&&(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return!0===this.material.hardwareClipping?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(a){for(let b of this.getBindings())if(b.name===a)return b}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(a){this.geometry=a,this.attributes=null,this.attributesId=null}getAttributes(){if(null!==this.attributes)return this.attributes;let a=this.getNodeBuilderState().nodeAttributes,b=this.geometry,c=[],d=new Set,e={};for(let f of a){let a;if(f.node&&f.node.attribute?a=f.node.attribute:(a=b.getAttribute(f.name),e[f.name]=a.version),void 0===a)continue;c.push(a);let g=a.isInterleavedBufferAttribute?a.data:a;d.add(g)}return this.attributes=c,this.attributesId=e,this.vertexBuffers=Array.from(d.values()),c}getVertexBuffers(){return null===this.vertexBuffers&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){let{object:a,material:b,geometry:c,group:d,drawRange:e}=this,f=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),g=this.getIndex(),h=null!==g,i=1;if(!0===c.isInstancedBufferGeometry?i=c.instanceCount:void 0!==a.count&&(i=Math.max(0,a.count)),0===i)return null;if(f.instanceCount=i,!0===a.isBatchedMesh)return f;let j=1;!0!==b.wireframe||a.isPoints||a.isLineSegments||a.isLine||a.isLineLoop||(j=2);let k=e.start*j,l=(e.start+e.count)*j;null!==d&&(k=Math.max(k,d.start*j),l=Math.min(l,(d.start+d.count)*j));let m=c.attributes.position,n=1/0;h?n=g.count:null!=m&&(n=m.count),k=Math.max(k,0);let o=(l=Math.min(l,n))-k;return o<0||o===1/0?null:(f.vertexCount=o,f.firstVertex=k,f)}getGeometryCacheKey(){let{geometry:a}=this,b="";for(let c of Object.keys(a.attributes).sort()){let d=a.attributes[c];b+=c+",",d.data&&(b+=d.data.stride+","),d.offset&&(b+=d.offset+","),d.itemSize&&(b+=d.itemSize+","),d.normalized&&(b+="n,")}for(let c of Object.keys(a.morphAttributes).sort()){let d=a.morphAttributes[c];b+="morph-"+c+",";for(let a=0,c=d.length;a<c;a++)b+=d[a].id+","}return a.index&&(b+="index,"),b}getMaterialCacheKey(){let{object:a,material:b,renderer:c}=this,d=b.customProgramCacheKey();for(let a of function(a){let b=Object.keys(a),c=Object.getPrototypeOf(a);for(;c;){let a=Object.getOwnPropertyDescriptors(c);for(let c in a)if(void 0!==a[c]){let d=a[c];d&&"function"==typeof d.get&&b.push(c)}c=Object.getPrototypeOf(c)}return b}(b)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(a))continue;let e=b[a],f;if(null!==e){let a=typeof e;"number"===a?f=0===e?"0":"1":"object"===a?(f="{",e.isTexture&&(f+=e.mapping,!0===c.backend.isWebGPUBackend&&(f+=e.magFilter,f+=e.minFilter,f+=e.wrapS,f+=e.wrapT,f+=e.wrapR)),f+="}"):f=String(e)}else f=String(e);d+=f+","}return d+=this.clippingContextCacheKey+",",a.geometry&&(d+=this.getGeometryCacheKey()),a.skeleton&&(d+=a.skeleton.bones.length+","),a.isBatchedMesh&&(d+=a._matricesTexture.uuid+",",null!==a._colorsTexture&&(d+=a._colorsTexture.uuid+",")),(a.isInstancedMesh||a.count>1||Array.isArray(a.morphTargetInfluences))&&(d+=a.uuid+","),f8(d+=a.receiveShadow+",")}get needsGeometryUpdate(){if(this.geometry.id!==this.object.geometry.id)return!0;if(null!==this.attributes){let a=this.attributesId;for(let b in a){let c=this.geometry.getAttribute(b);if(void 0===c||a[b]!==c.id)return!0}}return!1}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let a=0;return!0!==this.material.isShadowPassMaterial&&(a=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(a=((...a)=>fj(a))(a,this.camera.cameras.length)),this.object.receiveShadow&&(a=((...a)=>fj(a))(a,1)),a=((...a)=>fj(a))(a,this.camera.id)}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.geometry.removeEventListener("dispose",this.onGeometryDispose),this.onDispose()}},qK=[],qL=class{constructor(a,b,c,d,e,f){this.renderer=a,this.nodes=b,this.geometries=c,this.pipelines=d,this.bindings=e,this.info=f,this.chainMaps={}}get(a,b,c,d,e,f,g,h){let i=this.getChainMap(h);qK[0]=a,qK[1]=b,qK[2]=f,qK[3]=e;let j=i.get(qK);return void 0===j?(j=this.createRenderObject(this.nodes,this.geometries,this.renderer,a,b,c,d,e,f,g,h),i.set(qK,j)):(j.updateClipping(g),j.needsGeometryUpdate&&j.setGeometry(a.geometry),(j.version!==b.version||j.needsUpdate)&&(j.initialCacheKey===j.getCacheKey()?j.version=b.version:(j.dispose(),j=this.get(a,b,c,d,e,f,g,h)))),qK.length=0,j}getChainMap(a="default"){return this.chainMaps[a]||(this.chainMaps[a]=new qH)}dispose(){this.chainMaps={}}createRenderObject(a,b,c,d,e,f,g,h,i,j,k){let l=this.getChainMap(k),m=new qJ(a,b,c,d,e,f,g,h,i,j);return m.onDispose=()=>{this.pipelines.delete(m),this.bindings.deleteForRender(m),this.nodes.delete(m),l.delete(m.getChainArray())},m}},qM=class{constructor(){this.data=new WeakMap}get(a){let b=this.data.get(a);return void 0===b&&(b={},this.data.set(a,b)),b}delete(a){let b=null;return this.data.has(a)&&(b=this.data.get(a),this.data.delete(a)),b}has(a){return this.data.has(a)}dispose(){this.data=new WeakMap}},qN={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},qO=class extends qM{constructor(a){super(),this.backend=a}delete(a){let b=super.delete(a);return null!==b&&this.backend.destroyAttribute(a),b}update(a,b){let c=this.get(a);if(void 0===c.version)b===qN.VERTEX?this.backend.createAttribute(a):b===qN.INDEX?this.backend.createIndexAttribute(a):b===qN.STORAGE?this.backend.createStorageAttribute(a):b===qN.INDIRECT&&this.backend.createIndirectStorageAttribute(a),c.version=this._getBufferAttribute(a).version;else{let b=this._getBufferAttribute(a);(c.version<b.version||35048===b.usage)&&(this.backend.updateAttribute(a),c.version=b.version)}}_getBufferAttribute(a){return a.isInterleavedBufferAttribute&&(a=a.data),a}},qP=class extends qM{constructor(a,b){super(),this.attributes=a,this.info=b,this.wireframes=new WeakMap,this.attributeCall=new WeakMap,this._geometryDisposeListeners=new Map}has(a){let b=a.geometry;return super.has(b)&&!0===this.get(b).initialized}updateForRender(a){!1===this.has(a)&&this.initGeometry(a),this.updateAttributes(a)}initGeometry(a){let b=a.geometry;this.get(b).initialized=!0,this.info.memory.geometries++;let c=()=>{this.info.memory.geometries--;let d=b.index,e=a.getAttributes();for(let a of(null!==d&&this.attributes.delete(d),e))this.attributes.delete(a);let f=this.wireframes.get(b);void 0!==f&&this.attributes.delete(f),b.removeEventListener("dispose",c),this._geometryDisposeListeners.delete(b)};b.addEventListener("dispose",c),this._geometryDisposeListeners.set(b,c)}updateAttributes(a){for(let b of a.getAttributes())b.isStorageBufferAttribute||b.isStorageInstancedBufferAttribute?this.updateAttribute(b,qN.STORAGE):this.updateAttribute(b,qN.VERTEX);let b=this.getIndex(a);null!==b&&this.updateAttribute(b,qN.INDEX);let c=a.geometry.indirect;null!==c&&this.updateAttribute(c,qN.INDIRECT)}updateAttribute(a,b){let c=this.info.render.calls;a.isInterleavedBufferAttribute?void 0===this.attributeCall.get(a)?(this.attributes.update(a,b),this.attributeCall.set(a,c)):this.attributeCall.get(a.data)!==c&&(this.attributes.update(a,b),this.attributeCall.set(a.data,c),this.attributeCall.set(a,c)):this.attributeCall.get(a)!==c&&(this.attributes.update(a,b),this.attributeCall.set(a,c))}getIndirect(a){return a.geometry.indirect}getIndex(a){let{geometry:b,material:c}=a,d=b.index;if(!0===c.wireframe){let a=this.wireframes,c=a.get(b);void 0===c?(c=fI(b),a.set(b,c)):c.version!==fH(b)&&(this.attributes.delete(c),c=fI(b),a.set(b,c)),d=c}return d}dispose(){for(let[a,b]of this._geometryDisposeListeners.entries())a.removeEventListener("dispose",b);this._geometryDisposeListeners.clear()}},qQ=class{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(a,b,c){this.render.drawCalls++,a.isMesh||a.isSprite?this.render.triangles+=b/3*c:a.isPoints?this.render.points+=c*b:a.isLineSegments?this.render.lines+=b/2*c:a.isLine?this.render.lines+=c*(b-1):J("WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}},qR=class{constructor(a){this.cacheKey=a,this.usedTimes=0}},qS=class extends qR{constructor(a,b,c){super(a),this.vertexProgram=b,this.fragmentProgram=c}},qT=class extends qR{constructor(a,b){super(a),this.computeProgram=b,this.isComputePipeline=!0}},qU=0,qV=class{constructor(a,b,c,d=null,e=null){this.id=qU++,this.code=a,this.stage=b,this.name=c,this.transforms=d,this.attributes=e,this.usedTimes=0}},qW=class extends qM{constructor(a,b){super(),this.backend=a,this.nodes=b,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(a,b){let{backend:c}=this,d=this.get(a);if(this._needsComputeUpdate(a)){let e=d.pipeline;e&&(e.usedTimes--,e.computeProgram.usedTimes--);let f=this.nodes.getForCompute(a),g=this.programs.compute.get(f.computeShader);void 0===g&&(e&&0===e.computeProgram.usedTimes&&this._releaseProgram(e.computeProgram),g=new qV(f.computeShader,"compute",a.name,f.transforms,f.nodeAttributes),this.programs.compute.set(f.computeShader,g),c.createProgram(g));let h=this._getComputeCacheKey(a,g),i=this.caches.get(h);void 0===i&&(e&&0===e.usedTimes&&this._releasePipeline(e),i=this._getComputePipeline(a,g,h,b)),i.usedTimes++,g.usedTimes++,d.version=a.version,d.pipeline=i}return d.pipeline}getForRender(a,b=null){let{backend:c}=this,d=this.get(a);if(this._needsRenderUpdate(a)){let e=d.pipeline;e&&(e.usedTimes--,e.vertexProgram.usedTimes--,e.fragmentProgram.usedTimes--);let f=a.getNodeBuilderState(),g=a.material?a.material.name:"",h=this.programs.vertex.get(f.vertexShader);void 0===h&&(e&&0===e.vertexProgram.usedTimes&&this._releaseProgram(e.vertexProgram),h=new qV(f.vertexShader,"vertex",g),this.programs.vertex.set(f.vertexShader,h),c.createProgram(h));let i=this.programs.fragment.get(f.fragmentShader);void 0===i&&(e&&0===e.fragmentProgram.usedTimes&&this._releaseProgram(e.fragmentProgram),i=new qV(f.fragmentShader,"fragment",g),this.programs.fragment.set(f.fragmentShader,i),c.createProgram(i));let j=this._getRenderCacheKey(a,h,i),k=this.caches.get(j);void 0===k?(e&&0===e.usedTimes&&this._releasePipeline(e),k=this._getRenderPipeline(a,h,i,j,b)):a.pipeline=k,k.usedTimes++,h.usedTimes++,i.usedTimes++,d.pipeline=k}return d.pipeline}delete(a){let b=this.get(a).pipeline;return b&&(b.usedTimes--,0===b.usedTimes&&this._releasePipeline(b),b.isComputePipeline?(b.computeProgram.usedTimes--,0===b.computeProgram.usedTimes&&this._releaseProgram(b.computeProgram)):(b.fragmentProgram.usedTimes--,b.vertexProgram.usedTimes--,0===b.vertexProgram.usedTimes&&this._releaseProgram(b.vertexProgram),0===b.fragmentProgram.usedTimes&&this._releaseProgram(b.fragmentProgram))),super.delete(a)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(a){this.getForRender(a)}_getComputePipeline(a,b,c,d){c||(c=this._getComputeCacheKey(a,b));let e=this.caches.get(c);return void 0===e&&(e=new qT(c,b),this.caches.set(c,e),this.backend.createComputePipeline(e,d)),e}_getRenderPipeline(a,b,c,d,e){d||(d=this._getRenderCacheKey(a,b,c));let f=this.caches.get(d);return void 0===f&&(f=new qS(d,b,c),this.caches.set(d,f),a.pipeline=f,this.backend.createRenderPipeline(a,e)),f}_getComputeCacheKey(a,b){return a.id+","+b.id}_getRenderCacheKey(a,b,c){return b.id+","+c.id+","+this.backend.getRenderCacheKey(a)}_releasePipeline(a){this.caches.delete(a.cacheKey)}_releaseProgram(a){let b=a.code,c=a.stage;this.programs[c].delete(b)}_needsComputeUpdate(a){let b=this.get(a);return void 0===b.pipeline||b.version!==a.version}_needsRenderUpdate(a){return void 0===this.get(a).pipeline||this.backend.needsRenderUpdate(a)}},qX=class extends qM{constructor(a,b,c,d,e,f){super(),this.backend=a,this.textures=c,this.pipelines=e,this.attributes=d,this.nodes=b,this.info=f,this.pipelines.bindings=this}getForRender(a){let b=a.getBindings();for(let a of b){let c=this.get(a);void 0===c.bindGroup&&(this._init(a),this.backend.createBindings(a,b,0),c.bindGroup=a)}return b}getForCompute(a){let b=this.nodes.getForCompute(a).bindings;for(let a of b){let c=this.get(a);void 0===c.bindGroup&&(this._init(a),this.backend.createBindings(a,b,0),c.bindGroup=a)}return b}updateForCompute(a){this._updateBindings(this.getForCompute(a))}updateForRender(a){this._updateBindings(this.getForRender(a))}deleteForCompute(a){for(let b of this.nodes.getForCompute(a).bindings)this.delete(b)}deleteForRender(a){for(let b of a.getBindings())this.delete(b)}_updateBindings(a){for(let b of a)this._update(b,a)}_init(a){for(let b of a.bindings)if(b.isSampledTexture)this.textures.updateTexture(b.texture);else if(b.isSampler)this.textures.updateSampler(b.texture);else if(b.isStorageBuffer){let a=b.attribute,c=a.isIndirectStorageBufferAttribute?qN.INDIRECT:qN.STORAGE;this.attributes.update(a,c)}}_update(a,b){let{backend:c}=this,d=!1,e=!0,f=0,g=0;for(let b of a.bindings)if(!(b.isNodeUniformsGroup&&!1===this.nodes.updateGroup(b))){if(b.isStorageBuffer){let a=b.attribute,c=a.isIndirectStorageBufferAttribute?qN.INDIRECT:qN.STORAGE;this.attributes.update(a,c)}if(b.isUniformBuffer)b.update()&&c.updateBinding(b);else if(b.isSampledTexture){let a=b.update(),h=b.texture,i=this.textures.get(h);if(a&&(this.textures.updateTexture(h),b.generation!==i.generation&&(b.generation=i.generation,d=!0,e=!1)),void 0!==c.get(h).externalTexture||i.isDefaultTexture?e=!1:(f=10*f+h.id,g+=h.version),!0===h.isStorageTexture&&!0===h.mipmapsAutoUpdate){let a=this.get(h);!0===b.store?a.needsMipmap=!0:this.textures.needsMipmaps(h)&&!0===a.needsMipmap&&(this.backend.generateMipmaps(h),a.needsMipmap=!1)}}else if(b.isSampler&&b.update()){let a=this.textures.updateSampler(b.texture);b.samplerKey!==a&&(b.samplerKey=a,d=!0,e=!1)}}!0===d&&this.backend.updateBindings(a,b,e?f:0,g)}},qY=class{constructor(a,b,c){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=a.getNode(b,c),this.lightsArray=[],this.scene=b,this.camera=c,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(a,b,c,d,e,f,g){let h=this.renderItems[this.renderItemsIndex];return void 0===h?(h={id:a.id,object:a,geometry:b,material:c,groupOrder:d,renderOrder:a.renderOrder,z:e,group:f,clippingContext:g},this.renderItems[this.renderItemsIndex]=h):(h.id=a.id,h.object=a,h.geometry=b,h.material=c,h.groupOrder=d,h.renderOrder=a.renderOrder,h.z=e,h.group=f,h.clippingContext=g),this.renderItemsIndex++,h}push(a,b,c,d,e,f,g){let h=this.getNextRenderItem(a,b,c,d,e,f,g);!0===a.occlusionTest&&this.occlusionQueryCount++,!0===c.transparent||c.transmission>0||c.transmissionNode&&c.transmissionNode.isNode||c.backdropNode&&c.backdropNode.isNode?(fL(c)&&this.transparentDoublePass.push(h),this.transparent.push(h)):this.opaque.push(h)}unshift(a,b,c,d,e,f,g){let h=this.getNextRenderItem(a,b,c,d,e,f,g);!0===c.transparent||c.transmission>0||c.transmissionNode&&c.transmissionNode.isNode||c.backdropNode&&c.backdropNode.isNode?(fL(c)&&this.transparentDoublePass.unshift(h),this.transparent.unshift(h)):this.opaque.unshift(h)}pushBundle(a){this.bundles.push(a)}pushLight(a){this.lightsArray.push(a)}sort(a,b){this.opaque.length>1&&this.opaque.sort(a||fJ),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(b||fK),this.transparent.length>1&&this.transparent.sort(b||fK)}finish(){this.lightsNode.setLights(this.lightsArray);for(let a=this.renderItemsIndex,b=this.renderItems.length;a<b;a++){let b=this.renderItems[a];if(null===b.id)break;b.id=null,b.object=null,b.geometry=null,b.material=null,b.groupOrder=null,b.renderOrder=null,b.z=null,b.group=null,b.clippingContext=null}}},qZ=[],q$=class{constructor(a){this.lighting=a,this.lists=new qH}get(a,b){let c=this.lists;qZ[0]=a,qZ[1]=b;let d=c.get(qZ);return void 0===d&&(d=new qY(this.lighting,a,b),c.set(qZ,d)),qZ.length=0,d}dispose(){this.lists=new qH}},q_=0,q0=class{constructor(){this.id=q_++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new b3,this.scissor=!1,this.scissorValue=new b3,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return fM(this)}},q1=[],q2=new d0,q3=new dR,q4=class{constructor(){this.chainMaps={}}get(a,b,c=null){let d;if(q1[0]=a,q1[1]=b,null===c)d="default";else{let a=c.texture.format;d=`${c.textures.length}:${a}:${c.samples}:${c.depthBuffer}:${c.stencilBuffer}`}let e=this._getChainMap(d),f=e.get(q1);return void 0===f&&(f=new q0,e.set(q1,f)),q1.length=0,null!==c&&(f.sampleCount=0===c.samples?1:c.samples),f}getForClear(a=null){return this.get(q2,q3,a)}_getChainMap(a){return this.chainMaps[a]||(this.chainMaps[a]=new qH)}dispose(){this.chainMaps={}}},q5=new bQ,q6=class extends qM{constructor(a,b,c){super(),this.renderer=a,this.backend=b,this.info=c}updateRenderTarget(a,b=0){let c=this.get(a),d=0===a.samples?1:a.samples,e=c.depthTextureMips||(c.depthTextureMips={}),f=a.textures,g=this.getSize(f[0]),h=g.width>>b,i=g.height>>b,j=a.depthTexture||e[b],k=!0===a.depthBuffer||!0===a.stencilBuffer,l=!1;void 0===j&&k&&((j=new el).format=a.stencilBuffer?aQ:aP,j.type=a.stencilBuffer?aJ:aE,j.image.width=h,j.image.height=i,j.image.depth=g.depth,j.renderTarget=a,j.isArrayTexture=!0===a.multiview&&g.depth>1,e[b]=j),(c.width!==g.width||g.height!==c.height)&&(l=!0,j&&(j.needsUpdate=!0,j.image.width=h,j.image.height=i,j.image.depth=j.isArrayTexture?j.image.depth:1)),c.width=g.width,c.height=g.height,c.textures=f,c.depthTexture=j||null,c.depth=a.depthBuffer,c.stencil=a.stencilBuffer,c.renderTarget=a,c.sampleCount!==d&&(l=!0,j&&(j.needsUpdate=!0),c.sampleCount=d);let m={sampleCount:d};if(!0!==a.isXRRenderTarget){for(let a=0;a<f.length;a++){let b=f[a];l&&(b.needsUpdate=!0),this.updateTexture(b,m)}j&&this.updateTexture(j,m)}!0!==c.initialized&&(c.initialized=!0,c.onDispose=()=>{this._destroyRenderTarget(a)},a.addEventListener("dispose",c.onDispose))}updateTexture(a,b={}){let c=this.get(a);if(!0===c.initialized&&c.version===a.version)return;let d=a.isRenderTargetTexture||a.isDepthTexture||a.isFramebufferTexture,e=this.backend;if(d&&!0===c.initialized&&e.destroyTexture(a),a.isFramebufferTexture){let b=this.renderer.getRenderTarget();b?a.type=b.texture.type:a.type=az}let{width:f,height:g,depth:h}=this.getSize(a);if(b.width=f,b.height=g,b.depth=h,b.needsMipmaps=this.needsMipmaps(a),b.levels=b.needsMipmaps?this.getMipLevels(a,f,g):1,a.isCubeTexture&&a.mipmaps.length>0&&b.levels++,d||!0===a.isStorageTexture||!0===a.isExternalTexture)e.createTexture(a,b),c.generation=a.version;else if(a.version>0){let d=a.image;if(void 0===d)I("Renderer: Texture marked for update but image is undefined.");else if(!1===d.complete)I("Renderer: Texture marked for update but image is incomplete.");else{if(a.images){let c=[];for(let b of a.images)c.push(b);b.images=c}else b.image=d;(void 0===c.isDefaultTexture||!0===c.isDefaultTexture)&&(e.createTexture(a,b),c.isDefaultTexture=!1,c.generation=a.version),!0===a.source.dataReady&&e.updateTexture(a,b);let f=!0===a.isStorageTexture&&!1===a.mipmapsAutoUpdate;b.needsMipmaps&&0===a.mipmaps.length&&!f&&e.generateMipmaps(a),a.onUpdate&&a.onUpdate(a)}}else e.createDefaultTexture(a),c.isDefaultTexture=!0,c.generation=a.version;!0!==c.initialized&&(c.initialized=!0,c.generation=a.version,this.info.memory.textures++,a.isVideoTexture&&"srgb"!==bX.getTransfer(a.colorSpace)&&I("WebGPURenderer: Video textures must use a color space with a sRGB transfer function, e.g. SRGBColorSpace."),c.onDispose=()=>{this._destroyTexture(a)},a.addEventListener("dispose",c.onDispose)),c.version=a.version}updateSampler(a){return this.backend.updateSampler(a)}getSize(a,b=q5){let c=a.images?a.images[0]:a.image;return c?(void 0!==c.image&&(c=c.image),"u">typeof HTMLVideoElement&&c instanceof HTMLVideoElement?(b.width=c.videoWidth||1,b.height=c.videoHeight||1,b.depth=1):"u">typeof VideoFrame&&c instanceof VideoFrame?(b.width=c.displayWidth||1,b.height=c.displayHeight||1,b.depth=1):(b.width=c.width||1,b.height=c.height||1,b.depth=a.isCubeTexture?6:c.depth||1)):b.width=b.height=b.depth=1,b}getMipLevels(a,b,c){return a.mipmaps.length>0?a.mipmaps.length:!0===a.isCompressedTexture?1:Math.floor(Math.log2(Math.max(b,c)))+1}needsMipmaps(a){return!0===a.generateMipmaps||a.mipmaps.length>0}_destroyRenderTarget(a){if(!0===this.has(a)){let b=this.get(a),c=b.textures,d=b.depthTexture;a.removeEventListener("dispose",b.onDispose);for(let a=0;a<c.length;a++)this._destroyTexture(c[a]);d&&this._destroyTexture(d),this.delete(a),this.backend.delete(a)}}_destroyTexture(a){if(!0===this.has(a)){let b=this.get(a);a.removeEventListener("dispose",b.onDispose);let c=b.isDefaultTexture;this.backend.destroyTexture(a,c),this.delete(a),this.info.memory.textures--}}},q7=class extends de{constructor(a,b,c,d=1){super(a,b,c),this.a=d}set(a,b,c,d=1){return this.a=d,super.set(a,b,c)}copy(a){return void 0!==a.a&&(this.a=a.a),super.copy(a)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}},q8=class extends hD{static get type(){return"ParameterNode"}constructor(a,b=null){super(a,b),this.isParameterNode=!0}getMemberType(a,b){let c=this.getNodeType(a),d=a.getStructTypeNode(c),e;return null===d?(J(`TSL: Member "${b}" not found in struct "${c}".`),e="float"):e=d.getMemberType(a,b),e}getHash(){return this.uuid}generate(){return this.name}},q9=(a,b)=>g0(new q8(a,b)),ra=g4(class extends gm{static get type(){return"StackNode"}constructor(a=null){super(),this.nodes=[],this.outputNode=null,this.parent=a,this._currentCond=null,this._expressionNode=null,this.isStackNode=!0}getElementType(a){return this.hasOutput?this.outputNode.getElementType(a):"void"}getNodeType(a){return this.hasOutput?this.outputNode.getNodeType(a):"void"}getMemberType(a,b){return this.hasOutput?this.outputNode.getMemberType(a,b):"void"}addToStack(a){return!0===a.isNode?this.nodes.push(a):J("TSL: Invalid node added to stack."),this}If(a,b){return this._currentCond=jT(a,new ft(b)),this.addToStack(this._currentCond)}ElseIf(a,b){let c=jT(a,new ft(b));return this._currentCond.elseNode=c,this._currentCond=c,this}Else(a){return this._currentCond.elseNode=new ft(a),this}Switch(a){return this._expressionNode=g0(a),this}Case(...a){let b=[];if(a.length>=2)for(let c=0;c<a.length-1;c++)b.push(this._expressionNode.equal(g0(a[c])));else J("TSL: Invalid parameter length. Case() requires at least two parameters.");let c=new ft(a[a.length-1]),d=b[0];for(let a=1;a<b.length;a++)d=d.or(b[a]);let e=jT(d,c);return null===this._currentCond?(this._currentCond=e,this.addToStack(this._currentCond)):(this._currentCond.elseNode=e,this._currentCond=e,this)}Default(a){return this.Else(a),this}setup(a){let b=a.getNodeProperties(this),c=0;for(let d of this.getChildren())d.isVarNode&&!0===d.intent&&!0!==d.isAssign(a)||(b["node"+c++]=d);return b.outputNode||null}get hasOutput(){return this.outputNode&&this.outputNode.isNode}build(a,...b){let c,d=ha();g9(this),a.setActiveStack(this);let e=a.buildStage;for(let b of this.nodes)if(!(b.isVarNode&&!0===b.intent&&!0!==b.isAssign(a))){if("setup"===e)b.build(a);else if("analyze"===e)b.build(a,this);else if("generate"===e){let c=a.getDataFromNode(b,"any").stages,d=c&&c[a.shaderStage];if(b.isVarNode&&d&&1===d.length&&d[0]&&d[0].isStackNode)continue;b.build(a,"void")}}return c=this.hasOutput?this.outputNode.build(a,...b):super.build(a,...b),g9(d),a.removeActiveStack(this),c}}).setParameterLength(0,1),rb=class extends gm{static get type(){return"StructTypeNode"}constructor(a,b=null){super("struct"),this.membersLayout=Object.entries(a).map(([a,b])=>"string"==typeof b?{name:a,type:b,atomic:!1}:{name:a,type:b.type,atomic:b.atomic||!1}),this.name=b,this.isStructLayoutNode=!0}getLength(){let a=Float32Array.BYTES_PER_ELEMENT,b=0;for(let c of this.membersLayout){let d=c.type,e=(/float|int|uint/.test(d)?1:/vec2/.test(d)?2:/vec3/.test(d)?3:/vec4/.test(d)||/mat2/.test(d)?4:/mat3/.test(d)?12:/mat4/.test(d)?16:void J("TSL: Unsupported type:",d))*a,f=/float|int|uint/.test(d)?4:/vec2/.test(d)?8:/vec3/.test(d)||/vec4/.test(d)?16:/mat2/.test(d)?8:/mat3/.test(d)?48:/mat4/.test(d)?64:void J("TSL: Unsupported type:",d),g=b%8,h=g%f,i=g+h;b+=h,0!==i&&8-i<e&&(b+=8-i),b+=e}return 8*Math.ceil(b/8)/a}getMemberType(a,b){let c=this.membersLayout.find(a=>a.name===b);return c?c.type:"void"}getNodeType(a){return a.getStructTypeFromNode(this,this.membersLayout,this.name).name}setup(a){a.getStructTypeFromNode(this,this.membersLayout,this.name),a.addInclude(this)}generate(a){return this.getNodeType(a)}},rc=class extends gm{static get type(){return"StructNode"}constructor(a,b){super("vec3"),this.structTypeNode=a,this.values=b,this.isStructNode=!0}getNodeType(a){return this.structTypeNode.getNodeType(a)}getMemberType(a,b){return this.structTypeNode.getMemberType(a,b)}generate(a){let b=a.getVarFromNode(this),c=b.type,d=a.getPropertyName(b);return a.addLineFlowCode(`${d} = ${a.generateStruct(c,this.structTypeNode.membersLayout,this.values)}`,this),b.name}},rd=(a,b=null)=>{let c=new rb(a,b),d=(...b)=>{let d=null;if(b.length>0)if(b[0].isNode){d={};let c=Object.keys(a);for(let a=0;a<b.length;a++)d[c[a]]=b[a]}else d=b[0];return g0(new rc(c,d))};return d.layout=c,d.isStruct=!0,d},re=class extends gm{static get type(){return"OutputStructNode"}constructor(...a){super(),this.members=a,this.isOutputStructNode=!0}getNodeType(a){let b=a.getNodeProperties(this);if(void 0===b.membersLayout){let c=this.members,d=[];for(let b=0;b<c.length;b++){let e="m"+b,f=c[b].getNodeType(a);d.push({name:e,type:f,index:b})}b.membersLayout=d,b.structType=a.getOutputStructTypeFromNode(this,b.membersLayout)}return b.structType.name}generate(a){let b=a.getOutputStructName(),c=this.members,d=""===b?"":b+".";for(let b=0;b<c.length;b++){let e=c[b].build(a);a.addLineFlowCode(`${d}m${b} = ${e}`,this)}return b}},rf=g4(re),rg=g4(class extends re{static get type(){return"MRTNode"}constructor(a){super(),this.outputNodes=a,this.isMRTNode=!0}has(a){return void 0!==this.outputNodes[a]}get(a){return this.outputNodes[a]}merge(a){return rg({...this.outputNodes,...a.outputNodes})}setup(a){let b=this.outputNodes,c=a.renderer.getRenderTarget(),d=[],e=c.textures;for(let a in b)d[fN(e,a)]=hq(b[a]);return this.members=d,super.setup(a)}}),ri=g6(rh=class extends gp{static get type(){return"BitcastNode"}constructor(a,b,c=null){super(),this.valueNode=a,this.conversionType=b,this.inputType=c,this.isBitcastNode=!0}getNodeType(a){if(null!==this.inputType){let b=this.valueNode.getNodeType(a),c=a.getTypeLength(b);return a.getTypeFromLength(c,this.conversionType)}return this.conversionType}generate(a){let b=this.getNodeType(a),c="";if(null!==this.inputType){let b=this.valueNode.getNodeType(a);c=1===a.getTypeLength(b)?this.inputType:a.changeComponentType(b,this.inputType)}else c=this.valueNode.getNodeType(a);return`${a.getBitcastMethod(b,c)}( ${this.valueNode.build(a,c)} )`}}).setParameterLength(2),rj=a=>new rh(a,"int","float"),rk=a=>new rh(a,"uint","float"),rl=a=>new rh(a,"float","int"),rm=a=>new rh(a,"float","uint"),rn=fu(([a])=>{let b=a.toUint().mul(0x2c9277b5).add(0xac564b05),c=b.shiftRight(b.shiftRight(28).add(4)).bitXor(b).mul(0x108ef2d9);return c.shiftRight(22).bitXor(c).toFloat().mul(1/0x100000000)}),ro=(a,b)=>jz(ip(4,a.mul(io(1,a))),b),rp=(a,b)=>a.lessThan(.5)?ro(a.mul(2),b).div(2):io(1,ro(ip(io(1,a),2),b).div(2)),rq=(a,b,c)=>jz(iq(jz(a,b),im(jz(a,b),jz(io(1,a),c))),1/b),rr=(a,b)=>i6(iQ.mul(b.mul(a).sub(1))).div(iQ.mul(b.mul(a).sub(1))),rs=fu(([a])=>a.fract().sub(.5).abs()).setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]}),rt=fu(([a])=>hm(rs(a.z.add(rs(a.y.mul(1)))),rs(a.z.add(rs(a.x.mul(1)))),rs(a.y.add(rs(a.x.mul(1)))))).setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),ru=fu(([a,b,c])=>{let d=hm(a).toVar(),e=he(1.4).toVar(),f=he(0).toVar(),g=hm(d).toVar();return nM({start:he(0),end:he(3),type:"float",condition:"<="},()=>{let a=hm(rt(g.mul(2))).toVar();d.addAssign(a.add(c.mul(he(.1).mul(b)))),g.mulAssign(1.8),e.mulAssign(1.5),d.mulAssign(1.2);let h=he(rs(d.z.add(rs(d.x.add(rs(d.y)))))).toVar();f.addAssign(h.div(e)),g.addAssign(.14)}),f}).setLayout({name:"triNoise3D",type:"float",inputs:[{name:"position",type:"vec3"},{name:"speed",type:"float"},{name:"time",type:"float"}]}),rv=g4(class extends gm{static get type(){return"FunctionOverloadingNode"}constructor(a=[],...b){super(),this.functionNodes=a,this.parametersNodes=b,this._candidateFn=null,this.global=!0}getNodeType(a){return this.getCandidateFn(a).shaderNode.layout.type}getCandidateFn(a){let b=this.parametersNodes,c=this._candidateFn;if(null===c){let d=null,e=-1;for(let c of this.functionNodes){let f=c.shaderNode.layout;if(null===f)throw Error("FunctionOverloadingNode: FunctionNode must be a layout.");let g=f.inputs;if(b.length===g.length){let f=0;for(let c=0;c<b.length;c++){let d=b[c],e=g[c];d.getNodeType(a)===e.type&&f++}f>e&&(d=c,e=f)}}this._candidateFn=c=d}return c}setup(a){return this.getCandidateFn(a)(...this.parametersNodes)}}),rw=a=>(...b)=>rv(a,...b),rx=id(0).setGroup(ia).onRenderUpdate(a=>a.time),ry=id(0).setGroup(ia).onRenderUpdate(a=>a.deltaTime),rz=id(0,"uint").setGroup(ia).onRenderUpdate(a=>a.frameId),rA=(a=rx)=>a.add(.75).mul(2*Math.PI).sin().mul(.5).add(.5),rB=(a=rx)=>a.fract().round(),rC=(a=rx)=>a.add(.5).fract().mul(2).sub(1).abs(),rD=(a=rx)=>a.fract(),rE=fu(([a,b,c=hi(.5)])=>qw(a.sub(c),b).add(c)),rF=fu(([a,b,c=hi(.5)])=>{let d=a.sub(c),e=d.dot(d),f=e.mul(e).mul(b);return a.add(d.mul(f))}),rG=fu(({position:a=null,horizontal:b=!0,vertical:c=!1})=>{let d;null===a?d=lv:((d=lv.toVar())[3][0]=a.x,d[3][1]=a.y,d[3][2]=a.z);let e=lg.mul(d);return g$(b)&&(e[0][0]=lv[0].length(),e[0][1]=0,e[0][2]=0),g$(c)&&(e[1][0]=0,e[1][1]=lv[1].length(),e[1][2]=0),e[2][0]=0,e[2][1]=0,e[2][2]=1,le.mul(e).mul(lH)}),rH=fu(([a=null])=>{let b=oa();return oa(n0(a)).sub(b).lessThan(0).select(k3,a)}),rI=g4(class extends gm{static get type(){return"SpriteSheetUVNode"}constructor(a,b=kJ(),c=he(0)){super("vec2"),this.countNode=a,this.uvNode=b,this.frameNode=c}setup(){let{frameNode:a,uvNode:b,countNode:c}=this,{width:d,height:e}=c,f=a.mod(d.mul(e)).floor(),g=f.mod(d),h=e.sub(f.add(1).div(d).ceil()),i=c.reciprocal(),j=hi(g,h);return b.add(j).mul(i)}}).setParameterLength(3),rJ=fu(([a,b=null,c=null,d=he(1),e=lH,f=lR])=>{let g=f.abs().normalize();g=g.div(g.dot(hm(1)));let h=e.yz.mul(d),i=e.zx.mul(d),j=e.xy.mul(d),k=a.value,l=null===b?k:b.value,m=null===c?k:c.value;return im(kP(k,h).mul(g.x),kP(l,i).mul(g.y),kP(m,j).mul(g.z))}),rK=(...a)=>rJ(...a),rL=new ea,rM=new bQ,rN=new bQ,rO=new bQ,rP=new cx,rQ=new bQ(0,0,-1),rR=new b3,rS=new bQ,rT=new bQ,rU=new b3,rV=new bO,rW=new b4,rX=k3.flipX(),rW.depthTexture=new el(1,1),rY=!1,rZ=class a extends kN{static get type(){return"ReflectorNode"}constructor(a={}){super(a.defaultTexture||rW.texture,rX),this._reflectorBaseNode=a.reflector||new r$(this,a),this._depthNode=null,this.setUpdateMatrix(!1)}get reflector(){return this._reflectorBaseNode}get target(){return this._reflectorBaseNode.target}getDepthNode(){if(null===this._depthNode){if(!0!==this._reflectorBaseNode.depth)throw Error("THREE.ReflectorNode: Depth node can only be requested when the reflector is created with { depth: true }. ");this._depthNode=g0(new a({defaultTexture:rW.depthTexture,reflector:this._reflectorBaseNode}))}return this._depthNode}setup(a){return a.object.isQuadMesh||this._reflectorBaseNode.build(a),super.setup(a)}clone(){let a=new this.constructor(this.reflectorNode);return a.uvNode=this.uvNode,a.levelNode=this.levelNode,a.biasNode=this.biasNode,a.sampler=this.sampler,a.depthNode=this.depthNode,a.compareNode=this.compareNode,a.gradNode=this.gradNode,a.offsetNode=this.offsetNode,a._reflectorBaseNode=this._reflectorBaseNode,a}dispose(){super.dispose(),this._reflectorBaseNode.dispose()}},r$=class extends gm{static get type(){return"ReflectorBaseNode"}constructor(a,b={}){super();let{target:c=new cY,resolutionScale:d=1,generateMipmaps:e=!1,bounces:f=!0,depth:g=!1,samples:h=0}=b;this.textureNode=a,this.target=c,this.resolutionScale=d,void 0!==b.resolution&&(K('ReflectorNode: The "resolution" parameter has been renamed to "resolutionScale".'),this.resolutionScale=b.resolution),this.generateMipmaps=e,this.bounces=f,this.depth=g,this.samples=h,this.updateBeforeType=f?gd.RENDER:gd.FRAME,this.virtualCameras=new WeakMap,this.renderTargets=new Map,this.forceUpdate=!1,this.hasOutput=!1}_updateResolution(a,b){let c=this.resolutionScale;b.getDrawingBufferSize(rV),a.setSize(Math.round(rV.width*c),Math.round(rV.height*c))}setup(a){return this._updateResolution(rW,a.renderer),super.setup(a)}dispose(){for(let a of(super.dispose(),this.renderTargets.values()))a.dispose()}getVirtualCamera(a){let b=this.virtualCameras.get(a);return void 0===b&&(b=a.clone(),this.virtualCameras.set(a,b)),b}getRenderTarget(a){let b=this.renderTargets.get(a);return void 0===b&&(b=new b4(0,0,{type:aG,samples:this.samples}),!0===this.generateMipmaps&&(b.texture.minFilter=ay,b.texture.generateMipmaps=!0),!0===this.depth&&(b.depthTexture=new el),this.renderTargets.set(a,b)),b}updateBefore(a){if(!1===this.bounces&&rY)return!1;rY=!0;let{scene:b,camera:c,renderer:d,material:e}=a,{target:f}=this,g=this.getVirtualCamera(c),h=this.getRenderTarget(g);d.getDrawingBufferSize(rV),this._updateResolution(h,d),rN.setFromMatrixPosition(f.matrixWorld),rO.setFromMatrixPosition(c.matrixWorld),rP.extractRotation(f.matrixWorld),rM.set(0,0,1),rM.applyMatrix4(rP),rS.subVectors(rN,rO);let i=rS.dot(rM)>0,j=!1;if(!0===i&&!1===this.forceUpdate){if(!1===this.hasOutput){rY=!1;return}j=!0}rS.reflect(rM).negate(),rS.add(rN),rP.extractRotation(c.matrixWorld),rQ.set(0,0,-1),rQ.applyMatrix4(rP),rQ.add(rO),rT.subVectors(rN,rQ),rT.reflect(rM).negate(),rT.add(rN),g.coordinateSystem=c.coordinateSystem,g.position.copy(rS),g.up.set(0,1,0),g.up.applyMatrix4(rP),g.up.reflect(rM),g.lookAt(rT),g.near=c.near,g.far=c.far,g.updateMatrixWorld(),g.projectionMatrix.copy(c.projectionMatrix),rL.setFromNormalAndCoplanarPoint(rM,rN),rL.applyMatrix4(g.matrixWorldInverse),rR.set(rL.normal.x,rL.normal.y,rL.normal.z,rL.constant);let k=g.projectionMatrix;rU.x=(Math.sign(rR.x)+k.elements[8])/k.elements[0],rU.y=(Math.sign(rR.y)+k.elements[9])/k.elements[5],rU.z=-1,rU.w=(1+k.elements[10])/k.elements[14],rR.multiplyScalar(1/rR.dot(rU)),k.elements[2]=rR.x,k.elements[6]=rR.y,k.elements[10]=2001===d.coordinateSystem?rR.z-0:rR.z+1-0,k.elements[14]=rR.w,this.textureNode.value=h.texture,!0===this.depth&&(this.textureNode.getDepthNode().value=h.depthTexture),e.visible=!1;let l=d.getRenderTarget(),m=d.getMRT(),n=d.autoClear;d.setMRT(null),d.setRenderTarget(h),d.autoClear=!0;let o=b.name;b.name=(b.name||"Scene")+" [ Reflector ]",j?(d.clear(),this.hasOutput=!1):(d.render(b,g),this.hasOutput=!0),b.name=o,d.setMRT(m),d.setRenderTarget(l),d.autoClear=n,e.visible=!0,rY=!1,this.forceUpdate=!1}get resolution(){return K('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale}set resolution(a){K('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale=a}},r_=a=>g0(new rZ(a)),r0=new e$(-1,1,1,-1,0,1),r1=new class extends dA{constructor(a=!1){super(),this.setAttribute("position",new ds([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new ds(!1===a?[0,-1,0,1,2,1]:[0,2,0,0,2,0],2))}},r2=class extends dM{constructor(a=null){super(r1,a),this.camera=r0,this.isQuadMesh=!0}async renderAsync(a){K('QuadMesh: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await a.init(),a.render(this,r0)}render(a){a.render(this,r0)}},r3=new bO,r4=class extends kN{static get type(){return"RTTNode"}constructor(a,b=null,c=null,d={type:aG}){let e=new b4(b,c,d);super(e.texture,kJ()),this.isRTTNode=!0,this.node=a,this.width=b,this.height=c,this.pixelRatio=1,this.renderTarget=e,this.textureNeedsUpdate=!0,this.autoUpdate=!0,this._rttNode=null,this._quadMesh=new r2(new ot),this.updateBeforeType=gd.RENDER}get autoResize(){return null===this.width}setup(a){return this._rttNode=this.node.context(a.getSharedContext()),this._quadMesh.material.name="RTT",this._quadMesh.material.needsUpdate=!0,super.setup(a)}setSize(a,b){this.width=a,this.height=b;let c=a*this.pixelRatio,d=b*this.pixelRatio;this.renderTarget.setSize(c,d),this.textureNeedsUpdate=!0}setPixelRatio(a){this.pixelRatio=a,this.setSize(this.width,this.height)}updateBefore({renderer:a}){if(!1===this.textureNeedsUpdate&&!1===this.autoUpdate)return;if(this.textureNeedsUpdate=!1,!0===this.autoResize){let b=a.getPixelRatio(),c=a.getSize(r3),d=Math.floor(c.width*b),e=Math.floor(c.height*b);(d!==this.renderTarget.width||e!==this.renderTarget.height)&&(this.renderTarget.setSize(d,e),this.textureNeedsUpdate=!0)}let b="RTT";this.node.name&&(b=this.node.name+" [ "+b+" ]"),this._quadMesh.material.fragmentNode=this._rttNode,this._quadMesh.name=b;let c=a.getRenderTarget();a.setRenderTarget(this.renderTarget),this._quadMesh.render(a),a.setRenderTarget(c)}clone(){let a=new kN(this.value,this.uvNode,this.levelNode);return a.sampler=this.sampler,a.referenceNode=this,a}},r5=(a,...b)=>g0(new r4(g0(a),...b)),r6=(a,...b)=>a.isSampleNode||a.isTextureNode?a:a.isPassNode?a.getTextureNode():r5(a,...b),r7=fu(([a,b,c],d)=>{let e;e=2001===d.renderer.coordinateSystem?hq(hm(a=hi(a.x,a.y.oneMinus()).mul(2).sub(1),b),1):hq(hm(a.x,a.y.oneMinus(),b).mul(2).sub(1),1);let f=hq(c.mul(e));return f.xyz.div(f.w)}),r8=fu(([a,b])=>{let c=b.mul(hq(a,1)),d=c.xy.div(c.w).mul(.5).add(.5).toVar();return hi(d.x,d.y.oneMinus())}),r9=fu(([a,b,c])=>{let d=kK(kR(b)),e=hj(a.mul(d)).toVar(),f=kR(b,e).toVar(),g=kR(b,e.sub(hj(2,0))).toVar(),h=kR(b,e.sub(hj(1,0))).toVar(),i=kR(b,e.add(hj(1,0))).toVar(),j=kR(b,e.add(hj(2,0))).toVar(),k=kR(b,e.add(hj(0,2))).toVar(),l=kR(b,e.add(hj(0,1))).toVar(),m=kR(b,e.sub(hj(0,1))).toVar(),n=kR(b,e.sub(hj(0,2))).toVar(),o=jc(io(he(2).mul(h).sub(g),f)).toVar(),p=jc(io(he(2).mul(i).sub(j),f)).toVar(),q=jc(io(he(2).mul(l).sub(k),f)).toVar(),r=jc(io(he(2).mul(m).sub(n),f)).toVar(),s=r7(a,f,c).toVar();return i4(jy(o.lessThan(p).select(s.sub(r7(a.sub(hi(he(1).div(d.x),0)),h,c)),s.negate().add(r7(a.add(hi(he(1).div(d.x),0)),i,c))),q.lessThan(r).select(s.sub(r7(a.add(hi(0,he(1).div(d.y))),l,c)),s.negate().add(r7(a.sub(hi(0,he(1).div(d.y))),m,c)))))}),sa=fu(([a])=>i5(he(52.9829189).mul(i5(jx(a,hi(.06711056,.00583715)))))).setLayout({name:"interleavedGradientNoise",type:"float",inputs:[{name:"position",type:"vec2"}]}),sb=class extends gm{static get type(){return"SampleNode"}constructor(a,b=null){super(),this.callback=a,this.uvNode=b,this.isSampleNode=!0}setup(){return this.sample(kJ())}sample(a){return this.callback(a)}},sc=(a,b=null)=>g0(new sb(a,g0(b))),(sd=class a extends gm{static get type(){return"EventNode"}constructor(b,c){super("void"),this.eventType=b,this.callback=c,b===a.OBJECT?this.updateType=gd.OBJECT:b===a.MATERIAL?this.updateType=gd.RENDER:b===a.BEFORE_OBJECT?this.updateBeforeType=gd.OBJECT:b===a.BEFORE_MATERIAL&&(this.updateBeforeType=gd.RENDER)}update(a){this.callback(a)}updateBefore(a){this.callback(a)}}).OBJECT="object",sd.MATERIAL="material",sd.BEFORE_OBJECT="beforeObject",sd.BEFORE_MATERIAL="beforeMaterial",se=(a,b)=>g0(new sd(a,b)).toStack(),sf=a=>se(sd.OBJECT,a),sg=a=>se(sd.MATERIAL,a),sh=a=>se(sd.BEFORE_OBJECT,a),si=a=>se(sd.BEFORE_MATERIAL,a),sj=class extends d6{constructor(a,b,c=Float32Array){super(ArrayBuffer.isView(a)?a:new c(a*b),b),this.isStorageInstancedBufferAttribute=!0}},sk=class extends dn{constructor(a,b,c=Float32Array){super(ArrayBuffer.isView(a)?a:new c(a*b),b),this.isStorageBufferAttribute=!0}},sl=(a,b="float")=>{let c,d;return!0===b.isStruct?(c=b.layout.getLength(),d=fk("float")):(c=fl(b),d=fk(b)),nF(new sk(a,c,d),b,a)},sm=(a,b="float")=>{let c,d;return!0===b.isStruct?(c=b.layout.getLength(),d=fk("float")):(c=fl(b),d=fk(b)),nF(new sj(a,c,d),b,a)},sn=g5(class extends gm{static get type(){return"PointUVNode"}constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}),so=new cH,sp=new cx,(sq=class a extends gm{static get type(){return"SceneNode"}constructor(b=a.BACKGROUND_BLURRINESS,c=null){super(),this.scope=b,this.scene=c}setup(b){let c=this.scope,d=null===this.scene?b.scene:this.scene,e;return c===a.BACKGROUND_BLURRINESS?e=mg("backgroundBlurriness","float",d):c===a.BACKGROUND_INTENSITY?e=mg("backgroundIntensity","float",d):c===a.BACKGROUND_ROTATION?e=id("mat4").setName("backgroundRotation").setGroup(ia).onRenderUpdate(()=>{let a=d.background;return null!==a&&a.isTexture&&300!==a.mapping?(so.copy(d.backgroundRotation),so.x*=-1,so.y*=-1,so.z*=-1,sp.makeRotationFromEuler(so)):sp.identity(),sp}):J("SceneNode: Unknown scope:",c),e}}).BACKGROUND_BLURRINESS="backgroundBlurriness",sq.BACKGROUND_INTENSITY="backgroundIntensity",sq.BACKGROUND_ROTATION="backgroundRotation",sr=g5(sq,sq.BACKGROUND_BLURRINESS),ss=g5(sq,sq.BACKGROUND_INTENSITY),st=g5(sq,sq.BACKGROUND_ROTATION),su=g4(class extends kN{static get type(){return"StorageTextureNode"}constructor(a,b,c=null){super(a,b),this.storeNode=c,this.mipLevel=0,this.isStorageTextureNode=!0,this.access=gf.WRITE_ONLY}getInputType(){return"storageTexture"}setup(a){super.setup(a);let b=a.getNodeProperties(this);return b.storeNode=this.storeNode,b}setAccess(a){return this.access=a,this}setMipLevel(a){return this.mipLevel=a,this}generate(a,b){return null===this.storeNode?super.generate(a,b):this.generateStore(a)}toReadWrite(){return this.setAccess(gf.READ_WRITE)}toReadOnly(){return this.setAccess(gf.READ_ONLY)}toWriteOnly(){return this.setAccess(gf.WRITE_ONLY)}generateStore(a){let{uvNode:b,storeNode:c,depthNode:d}=a.getNodeProperties(this),e=super.generate(a,"property"),f=b.build(a,!0===this.value.is3DTexture?"uvec3":"uvec2"),g=c.build(a,"vec4"),h=d?d.build(a,"int"):null,i=a.generateTextureStore(a,e,f,h,g);a.addLineFlowCode(i,this)}clone(){let a=super.clone();return a.storeNode=this.storeNode,a.mipLevel=this.mipLevel,a}}).setParameterLength(1,3),sv=(a,b,c)=>{let d=su(a,b,c);return null!==c&&d.toStack(),d},sw=fu(({texture:a,uv:b})=>{let c=hm().toVar();return hb(b.x.lessThan(1e-4),()=>{c.assign(hm(1,0,0))}).ElseIf(b.y.lessThan(1e-4),()=>{c.assign(hm(0,1,0))}).ElseIf(b.z.lessThan(1e-4),()=>{c.assign(hm(0,0,1))}).ElseIf(b.x.greaterThan(.9999),()=>{c.assign(hm(-1,0,0))}).ElseIf(b.y.greaterThan(.9999),()=>{c.assign(hm(0,-1,0))}).ElseIf(b.z.greaterThan(.9999),()=>{c.assign(hm(0,0,-1))}).Else(()=>{let d=a.sample(b.add(hm(-.01,0,0))).r.sub(a.sample(b.add(hm(.01,0,0))).r),e=a.sample(b.add(hm(0,-.01,0))).r.sub(a.sample(b.add(hm(0,.01,0))).r),f=a.sample(b.add(hm(0,0,-.01))).r.sub(a.sample(b.add(hm(0,0,.01))).r);c.assign(hm(d,e,f))}),c.normalize()}),sx=g4(class extends kN{static get type(){return"Texture3DNode"}constructor(a,b=null,c=null){super(a,b,c),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return hm(.5,.5,.5)}setUpdateMatrix(){}setupUV(a,b){let c=this.value;return a.isFlipY()&&(!0===c.isRenderTargetTexture||!0===c.isFramebufferTexture)&&(b=this.sampler?b.flipY():b.setY(hf(kK(this,this.levelNode).y).sub(b.y).sub(1))),b}generateUV(a,b){return b.build(a,!0===this.sampler?"vec3":"ivec3")}generateOffset(a,b){return b.build(a,"ivec3")}normal(a){return sw({texture:this,uv:a})}}).setParameterLength(1,3),sy=class extends mf{static get type(){return"UserDataNode"}constructor(a,b,c=null){super(a,b,c),this.userData=c}updateReference(a){return this.reference=null===this.userData?a.object.userData:this.userData,this.reference}},sz=(a,b,c)=>g0(new sy(a,b,c)),sA=new WeakMap,sB=g5(class extends gp{static get type(){return"VelocityNode"}constructor(){super("vec2"),this.projectionMatrix=null,this.updateType=gd.OBJECT,this.updateAfterType=gd.OBJECT,this.previousModelWorldMatrix=id(new cx),this.previousProjectionMatrix=id(new cx).setGroup(ia),this.previousCameraViewMatrix=id(new cx)}setProjectionMatrix(a){this.projectionMatrix=a}update({frameId:a,camera:b,object:c}){let d=fP(c);this.previousModelWorldMatrix.value.copy(d);let e=fO(b);e.frameId!==a&&(e.frameId=a,void 0===e.previousProjectionMatrix?(e.previousProjectionMatrix=new cx,e.previousCameraViewMatrix=new cx,e.currentProjectionMatrix=new cx,e.currentCameraViewMatrix=new cx,e.previousProjectionMatrix.copy(this.projectionMatrix||b.projectionMatrix),e.previousCameraViewMatrix.copy(b.matrixWorldInverse)):(e.previousProjectionMatrix.copy(e.currentProjectionMatrix),e.previousCameraViewMatrix.copy(e.currentCameraViewMatrix)),e.currentProjectionMatrix.copy(this.projectionMatrix||b.projectionMatrix),e.currentCameraViewMatrix.copy(b.matrixWorldInverse),this.previousProjectionMatrix.value.copy(e.previousProjectionMatrix),this.previousCameraViewMatrix.value.copy(e.previousCameraViewMatrix))}updateAfter({object:a}){fP(a).copy(a.matrixWorld)}setup(){let a=null===this.projectionMatrix?le:id(this.projectionMatrix),b=this.previousCameraViewMatrix.mul(this.previousModelWorldMatrix),c=a.mul(lC).mul(lH),d=this.previousProjectionMatrix.mul(b).mul(lI);return io(c.xy.div(c.w),d.xy.div(d.w))}}),sC=fu(([a])=>sG(a.rgb)),sD=fu(([a,b=he(1)])=>b.mix(sG(a.rgb),a.rgb)),sE=fu(([a,b=he(1)])=>{let c=im(a.r,a.g,a.b).div(3),d=a.r.max(a.g.max(a.b)),e=d.sub(c).mul(b).mul(-3);return jG(a.rgb,d,e)}),sF=fu(([a,b=he(1)])=>{let c=hm(.57735,.57735,.57735),d=b.cos();return hm(a.rgb.mul(d).add(c.cross(a.rgb).mul(b.sin()).add(c.mul(jx(c,a.rgb).mul(d.oneMinus())))))}),sG=(a,b=hm(bX.getLuminanceCoefficients(new bQ)))=>jx(a,b),sH=fu(([a,b=hm(1),c=hm(0),d=hm(1),e=he(1),f=hm(bX.getLuminanceCoefficients(new bQ,bs))])=>{let g=a.rgb.dot(hm(f)),h=js(a.rgb.mul(b).add(c),0).toVar(),i=h.pow(d).toVar();return hb(h.r.greaterThan(0),()=>{h.r.assign(i.r)}),hb(h.g.greaterThan(0),()=>{h.g.assign(i.g)}),hb(h.b.greaterThan(0),()=>{h.b.assign(i.b)}),h.assign(g.add(h.sub(g).mul(e))),hq(h.rgb,a.a)}),sI=g4(class extends gp{static get type(){return"PosterizeNode"}constructor(a,b){super(),this.sourceNode=a,this.stepsNode=b}setup(){let{sourceNode:a,stepsNode:b}=this;return a.mul(b).floor().div(b)}}).setParameterLength(2),sJ=new bO,sK=class extends kN{static get type(){return"PassTextureNode"}constructor(a,b){super(b),this.passNode=a,this.setUpdateMatrix(!1)}setup(a){return this.passNode.build(a),super.setup(a)}clone(){return new this.constructor(this.passNode,this.value)}},sL=class extends sK{static get type(){return"PassMultipleTextureNode"}constructor(a,b,c=!1){super(a,null),this.textureName=b,this.previousTexture=c}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(a){return this.updateTexture(),super.setup(a)}clone(){let a=new this.constructor(this.passNode,this.textureName,this.previousTexture);return a.uvNode=this.uvNode,a.levelNode=this.levelNode,a.biasNode=this.biasNode,a.sampler=this.sampler,a.depthNode=this.depthNode,a.compareNode=this.compareNode,a.gradNode=this.gradNode,a.offsetNode=this.offsetNode,a}},sM=class a extends gp{static get type(){return"PassNode"}constructor(a,b,c,d={}){super("vec4"),this.scope=a,this.scene=b,this.camera=c,this.options=d,this._pixelRatio=1,this._width=1,this._height=1;let e=new el;e.isRenderTargetTexture=!0,e.name="depth";let f=new b4(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:aG,...d});f.texture.name="output",f.depthTexture=e,this.renderTarget=f,this._textures={output:f.texture,depth:e},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=id(0),this._cameraFar=id(0),this._mrt=null,this._layers=null,this._resolutionScale=1,this._viewport=null,this._scissor=null,this.isPassNode=!0,this.updateBeforeType=gd.FRAME,this.global=!0}setResolutionScale(a){return this._resolutionScale=a,this}getResolutionScale(){return this._resolutionScale}setResolution(a){return I("PassNode: .setResolution() is deprecated. Use .setResolutionScale() instead."),this.setResolutionScale(a)}getResolution(){return I("PassNode: .getResolution() is deprecated. Use .getResolutionScale() instead."),this.getResolutionScale()}setLayers(a){return this._layers=a,this}getLayers(){return this._layers}setMRT(a){return this._mrt=a,this}getMRT(){return this._mrt}getTexture(a){let b=this._textures[a];return void 0===b&&((b=this.renderTarget.texture.clone()).name=a,this._textures[a]=b,this.renderTarget.textures.push(b)),b}getPreviousTexture(a){let b=this._previousTextures[a];return void 0===b&&(b=this.getTexture(a).clone(),this._previousTextures[a]=b),b}toggleTexture(a){let b=this._previousTextures[a];if(void 0!==b){let c=this._textures[a],d=this.renderTarget.textures.indexOf(c);this.renderTarget.textures[d]=b,this._textures[a]=b,this._previousTextures[a]=c,this._textureNodes[a].updateTexture(),this._previousTextureNodes[a].updateTexture()}}getTextureNode(a="output"){let b=this._textureNodes[a];return void 0===b&&((b=g0(new sL(this,a))).updateTexture(),this._textureNodes[a]=b),b}getPreviousTextureNode(a="output"){let b=this._previousTextureNodes[a];return void 0===b&&(void 0===this._textureNodes[a]&&this.getTextureNode(a),(b=g0(new sL(this,a,!0))).updateTexture(),this._previousTextureNodes[a]=b),b}getViewZNode(a="depth"){let b=this._viewZNodes[a];if(void 0===b){let c=this._cameraNear,d=this._cameraFar;this._viewZNodes[a]=b=n5(this.getTextureNode(a),c,d)}return b}getLinearDepthNode(a="depth"){let b=this._linearDepthNodes[a];if(void 0===b){let c=this._cameraNear,d=this._cameraFar,e=this.getViewZNode(a);this._linearDepthNodes[a]=b=n2(e,c,d)}return b}async compileAsync(a){let b=a.getRenderTarget(),c=a.getMRT();a.setRenderTarget(this.renderTarget),a.setMRT(this._mrt),await a.compileAsync(this.scene,this.camera),a.setRenderTarget(b),a.setMRT(c)}setup({renderer:b}){return this.renderTarget.samples=void 0===this.options.samples?b.samples:this.options.samples,this.renderTarget.texture.type=b.getColorBufferType(),this.scope===a.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(a){let{renderer:b}=a,{scene:c}=this,d,e,f=b.getOutputRenderTarget();f&&!0===f.isXRRenderTarget?(e=1,d=b.xr.getCamera(),b.xr.updateCamera(d),sJ.set(f.width,f.height)):(d=this.camera,e=b.getPixelRatio(),b.getSize(sJ)),this._pixelRatio=e,this.setSize(sJ.width,sJ.height);let g=b.getRenderTarget(),h=b.getMRT(),i=b.autoClear,j=d.layers.mask;for(let a in this._cameraNear.value=d.near,this._cameraFar.value=d.far,null!==this._layers&&(d.layers.mask=this._layers.mask),this._previousTextures)this.toggleTexture(a);b.setRenderTarget(this.renderTarget),b.setMRT(this._mrt),b.autoClear=!0;let k=c.name;c.name=this.name?this.name:c.name,b.render(c,d),c.name=k,b.setRenderTarget(g),b.setMRT(h),b.autoClear=i,d.layers.mask=j}setSize(a,b){this._width=a,this._height=b;let c=Math.floor(this._width*this._pixelRatio*this._resolutionScale),d=Math.floor(this._height*this._pixelRatio*this._resolutionScale);this.renderTarget.setSize(c,d),null!==this._scissor&&this.renderTarget.scissor.copy(this._scissor),null!==this._viewport&&this.renderTarget.viewport.copy(this._viewport)}setScissor(a,b,c,d){null===a?this._scissor=null:(null===this._scissor&&(this._scissor=new b3),a.isVector4?this._scissor.copy(a):this._scissor.set(a,b,c,d),this._scissor.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setViewport(a,b,c,d){null===a?this._viewport=null:(null===this._viewport&&(this._viewport=new b3),a.isVector4?this._viewport.copy(a):this._viewport.set(a,b,c,d),this._viewport.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setPixelRatio(a){this._pixelRatio=a,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}},sM.COLOR="color",sM.DEPTH="depth",sN=(a,b,c)=>g0(new sM(sM.COLOR,a,b,c)),sO=(a,b)=>g0(new sK(a,b)),sP=(a,b,c)=>g0(new sM(sM.DEPTH,a,b,c)),sQ=class extends sM{static get type(){return"ToonOutlinePassNode"}constructor(a,b,c,d,e){super(sM.COLOR,a,b),this.colorNode=c,this.thicknessNode=d,this.alphaNode=e,this._materialCache=new WeakMap,this.name="Outline Pass"}updateBefore(a){let{renderer:b}=a,c=b.getRenderObjectFunction();b.setRenderObjectFunction((a,c,d,e,f,g,h,i)=>{if((f.isMeshToonMaterial||f.isMeshToonNodeMaterial)&&!1===f.wireframe){let j=this._getOutlineMaterial(f);b.renderObject(a,c,d,e,j,g,h,i)}b.renderObject(a,c,d,e,f,g,h,i)}),super.updateBefore(a),b.setRenderObjectFunction(c)}_createMaterial(){let a=new ot;a.isMeshToonOutlineMaterial=!0,a.name="Toon_Outline",a.side=1;let b=lR.negate(),c=le.mul(lC),d=he(1),e=c.mul(hq(lH,1)),f=c.mul(hq(lH.add(b),1)),g=i4(e.sub(f));return a.vertexNode=e.add(g.mul(this.thicknessNode).mul(e.w).mul(d)),a.colorNode=hq(this.colorNode,this.alphaNode),a}_getOutlineMaterial(a){let b=this._materialCache.get(a);return void 0===b&&(b=this._createMaterial(),this._materialCache.set(a,b)),b}},sR=(a,b,c=new de(0,0,0),d=.003,e=1)=>g0(new sQ(a,b,g0(c),g0(d),g0(e))),sS=fu(([a,b])=>a.mul(b).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),sT=fu(([a,b])=>(a=a.mul(b)).div(a.add(1)).clamp()).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),sU=fu(([a,b])=>{let c=(a=(a=a.mul(b)).sub(.004).max(0)).mul(a.mul(6.2).add(.5)),d=a.mul(a.mul(6.2).add(1.7)).add(.06);return c.div(d).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),sV=fu(([a])=>{let b=a.mul(a.add(.0245786)).sub(90537e-9),c=a.mul(a.add(.432951).mul(.983729)).add(.238081);return b.div(c)}),sW=fu(([a,b])=>{let c=hv(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),d=hv(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return a=a.mul(b).div(.6),a=sV(a=c.mul(a)),(a=d.mul(a)).clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),sX=hv(hm(1.6605,-.1246,-.0182),hm(-.5876,1.1329,-.1006),hm(-.0728,-.0083,1.1187)),sY=hv(hm(.6274,.0691,.0164),hm(.3293,.9195,.088),hm(.0433,.0113,.8956)),sZ=fu(([a])=>{let b=hm(a).toVar(),c=hm(b.mul(b)).toVar(),d=hm(c.mul(c)).toVar();return he(15.5).mul(d.mul(c)).sub(ip(40.14,d.mul(b))).add(ip(31.96,d).sub(ip(6.868,c.mul(b))).add(ip(.4298,c).add(ip(.1191,b).sub(.00232))))}),s$=fu(([a,b])=>{let c=hm(a).toVar(),d=hv(hm(.856627153315983,.137318972929847,.11189821299995),hm(.0951212405381588,.761241990602591,.0767994186031903),hm(.0482516061458583,.101439036467562,.811302368396859)),e=hv(hm(1.1271005818144368,-.1413297634984383,-.14132976349843826),hm(-.11060664309660323,1.157823702216272,-.11060664309660294),hm(-.016493938717834573,-.016493938717834257,1.2519364065950405)),f=he(-12.47393),g=he(4.026069);return c.mulAssign(b),c.assign(sY.mul(c)),c.assign(d.mul(c)),c.assign(js(c,1e-10)),c.assign(i_(c)),c.assign(c.sub(f).div(g.sub(f))),c.assign(jH(c,0,1)),c.assign(sZ(c)),c.assign(e.mul(c)),c.assign(jz(js(hm(0),c),hm(2.2))),c.assign(sX.mul(c)),c.assign(jH(c,0,1)),c}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),s_=fu(([a,b])=>{let c=he(.76),d=he(.15),e=jr((a=a.mul(b)).r,jr(a.g,a.b)),f=jT(e.lessThan(.08),e.sub(ip(6.25,e.mul(e))),.04);a.subAssign(f);let g=js(a.r,js(a.g,a.b));hb(g.lessThan(c),()=>a);let h=io(1,c),i=io(1,h.mul(h).div(g.add(h.sub(c))));a.mulAssign(i.div(g));let j=io(1,iq(1,d.mul(g.sub(i)).add(1)));return jG(a,hm(i),j)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),s0=class extends gm{static get type(){return"CodeNode"}constructor(a="",b=[],c=""){super("code"),this.isCodeNode=!0,this.global=!0,this.code=a,this.includes=b,this.language=c}setIncludes(a){return this.includes=a,this}getIncludes(){return this.includes}generate(a){for(let b of this.getIncludes(a))b.build(a);let b=a.getCodeFromNode(this,this.getNodeType(a));return b.code=this.code,b.code}serialize(a){super.serialize(a),a.code=this.code,a.language=this.language}deserialize(a){super.deserialize(a),this.code=a.code,this.language=a.language}},s1=g4(s0).setParameterLength(1,3),s2=(a,b)=>s1(a,b,"js"),s3=(a,b)=>s1(a,b,"wgsl"),s4=(a,b)=>s1(a,b,"glsl"),s5=class extends s0{static get type(){return"FunctionNode"}constructor(a="",b=[],c=""){super(a,b,c)}getNodeType(a){return this.getNodeFunction(a).type}getMemberType(a,b){let c=this.getNodeType(a);return a.getStructTypeNode(c).getMemberType(a,b)}getInputs(a){return this.getNodeFunction(a).inputs}getNodeFunction(a){let b=a.getDataFromNode(this),c=b.nodeFunction;return void 0===c&&(b.nodeFunction=c=a.parser.parseFunction(this.code)),c}generate(a,b){super.generate(a);let c=this.getNodeFunction(a),d=c.name,e=c.type,f=a.getCodeFromNode(this,e);""!==d&&(f.name=d);let g=a.getPropertyName(f);return f.code=this.getNodeFunction(a).getCode(g)+`
`,"property"===b?g:a.format(`${g}()`,e,b)}},s6=(a,b=[],c="")=>{for(let a=0;a<b.length;a++){let c=b[a];"function"==typeof c&&(b[a]=c.functionNode)}let d=g0(new s5(a,b,c)),e=(...a)=>d.call(...a);return e.functionNode=d,e},s7=(a,b)=>s6(a,b,"glsl"),s8=(a,b)=>s6(a,b,"wgsl"),s9=g4(class extends gm{static get type(){return"ScriptableValueNode"}constructor(a=null){super(),this._value=a,this._cache=null,this.inputType=null,this.outputType=null,this.events=new bI,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return null!==this.outputType}set value(a){this._value!==a&&(this._cache&&"URL"===this.inputType&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=a,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){let a=this.value;if(a&&null===this._cache&&"URL"===this.inputType&&a.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([a.value]));else if(a&&null!==a.value&&void 0!==a.value&&(("URL"===this.inputType||"String"===this.inputType)&&"string"==typeof a.value||"Number"===this.inputType&&"number"==typeof a.value||"Vector2"===this.inputType&&a.value.isVector2||"Vector3"===this.inputType&&a.value.isVector3||"Vector4"===this.inputType&&a.value.isVector4||"Color"===this.inputType&&a.value.isColor||"Matrix3"===this.inputType&&a.value.isMatrix3||"Matrix4"===this.inputType&&a.value.isMatrix4))return a.value;return this._cache||a}getNodeType(a){return this.value&&this.value.isNode?this.value.getNodeType(a):"float"}setup(){return this.value&&this.value.isNode?this.value:he()}serialize(a){super.serialize(a),null===this.value?a.value=null:"ArrayBuffer"===this.inputType?a.value=fp(this.value):a.value=this.value?this.value.toJSON(a.meta).uuid:null,a.inputType=this.inputType,a.outputType=this.outputType}deserialize(a){super.deserialize(a);let b=null;null!==a.value&&(b="ArrayBuffer"===a.inputType?fq(a.value):"Texture"===a.inputType?a.meta.textures[a.value]:a.meta.nodes[a.value]||null),this.value=b,this.inputType=a.inputType,this.outputType=a.outputType}}).setParameterLength(1),ta=class extends Map{get(a,b=null,...c){if(this.has(a))return super.get(a);if(null!==b){let d=b(...c);return this.set(a,d),d}}},tb=class{constructor(a){this.scriptableNode=a}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(a){return this.scriptableNode.getInputLayout(a)}get(a){let b=this.parameters[a];return b?b.getValue():null}},tc=new ta,td=g4(class extends gm{static get type(){return"ScriptableNode"}constructor(a=null,b={}){super(),this.codeNode=a,this.parameters=b,this._local=new ta,this._output=s9(null),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(a,b){return this._local.set(a,b)}getLocal(a){return this._local.get(a)}onRefresh(){this._refresh()}getInputLayout(a){for(let b of this.getLayout())if(b.inputType&&(b.id===a||b.name===a))return b}getOutputLayout(a){for(let b of this.getLayout())if(b.outputType&&(b.id===a||b.name===a))return b}setOutput(a,b){let c=this._outputs;return void 0===c[a]?c[a]=s9(b):c[a].value=b,this}getOutput(a){return this._outputs[a]}getParameter(a){return this.parameters[a]}setParameter(a,b){let c=this.parameters;return b&&b.isScriptableNode?(this.deleteParameter(a),c[a]=b,c[a].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):b&&b.isScriptableValueNode?(this.deleteParameter(a),c[a]=b,c[a].events.addEventListener("refresh",this.onRefresh)):void 0===c[a]?(c[a]=s9(b),c[a].events.addEventListener("refresh",this.onRefresh)):c[a].value=b,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(a){let b=this.parameters[a];return b&&(b.isScriptableNode&&(b=b.getDefaultOutput()),b.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(let a of Object.keys(this.parameters))this.deleteParameter(a);return this.needsUpdate=!0,this}call(a,...b){let c=this.getObject()[a];if("function"==typeof c)return c(...b)}async callAsync(a,...b){let c=this.getObject()[a];if("function"==typeof c)return"AsyncFunction"===c.constructor.name?await c(...b):c(...b)}getNodeType(a){return this.getDefaultOutputNode().getNodeType(a)}refresh(a=null){null===a?this._refresh():this.getOutput(a).refresh()}getObject(){if(this.needsUpdate&&this.dispose(),null!==this._object)return this._object;let a=()=>this.refresh(),b=(a,b)=>this.setOutput(a,b),c=new tb(this),d=tc.get("THREE"),e=tc.get("TSL");this._object=this.getMethod()(c,this._local,tc,a,b,d,e);let f=this._object.layout;if(f&&(!1===f.cache&&this._local.clear(),this._output.outputType=f.outputType||null,Array.isArray(f.elements)))for(let a of f.elements){let b=a.id||a.name;a.inputType&&(void 0===this.getParameter(b)&&this.setParameter(b,null),this.getParameter(b).inputType=a.inputType),a.outputType&&(void 0===this.getOutput(b)&&this.setOutput(b,null),this.getOutput(b).outputType=a.outputType)}return this._object}deserialize(a){for(let b in super.deserialize(a),this.parameters){let a=this.parameters[b];a.isScriptableNode&&(a=a.getDefaultOutput()),a.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){let a=this.getDefaultOutput().value;return a&&a.isNode?a:he()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),null!==this._method)return this._method;let a="layout, init, main, dispose",b="var "+a+`; var output = {};
`,c=`
return { ...output, `+a+" };",d=b+this.codeNode.code+c;return this._method=Function("parameters","local","global","refresh","setOutput","THREE","TSL",d),this._method}dispose(){null!==this._method&&(this._object&&"function"==typeof this._object.dispose&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}getCacheKey(a){let b=[f8(this.source),this.getDefaultOutputNode().getCacheKey(a)];for(let c in this.parameters)b.push(this.parameters[c].getCacheKey(a));return f9(b)}set needsUpdate(a){!0===a&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return null===this.codeNode||(!0===this._needsOutputUpdate&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value),this}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}).setParameterLength(1,2),te=fu(([a,b],c)=>jK(a,b,fQ(c))),tf=fu(([a],b)=>{let c=fQ(b);return a.mul(a,c,c).negate().exp().oneMinus()}),tg=fu(([a,b])=>hq(b.toFloat().mix(hY.rgb,a.toVec3()),hY.a)),th=null,ti=null,tj=g4(class extends gm{static get type(){return"RangeNode"}constructor(a=he(),b=he()){super(),this.minNode=a,this.maxNode=b}getVectorLength(a){let b=this.getConstNode(this.minNode),c=this.getConstNode(this.maxNode),d=a.getTypeLength(fm(b.value)),e=a.getTypeLength(fm(c.value));return d>e?d:e}getNodeType(a){return a.object.count>1?a.getTypeFromLength(this.getVectorLength(a)):"float"}getConstNode(a){let b=null;if(a.traverse(a=>{!0===a.isConstNode&&(b=a)}),null===b)throw Error('THREE.TSL: No "ConstNode" found in node graph.');return b}setup(a){let b=a.object,c=null;if(b.count>1){let d=this.getConstNode(this.minNode),e=this.getConstNode(this.maxNode),f=d.value,g=e.value,h=a.getTypeLength(fm(f)),i=a.getTypeLength(fm(g));th||(th=new b3),ti||(ti=new b3),th.setScalar(0),ti.setScalar(0),1===h?th.setScalar(f):f.isColor?th.set(f.r,f.g,f.b,1):th.set(f.x,f.y,f.z||0,f.w||0),1===i?ti.setScalar(g):g.isColor?ti.set(g.r,g.g,g.b,1):ti.set(g.x,g.y,g.z||0,g.w||0);let j=4*b.count,k=new Float32Array(j);for(let a=0;a<j;a++){let b=a%4,c=th.getComponent(b),d=ti.getComponent(b);k[a]=bN.lerp(c,d,Math.random())}let l=this.getNodeType(a);if(b.count<=4096)c=kW(k,"vec4",b.count).element(nu).convert(l);else{let b=new d6(k,4);a.geometry.setAttribute("__range"+this.id,b),c=km(b).convert(l)}}else c=he(0);return c}}).setParameterLength(2),tk=class extends gm{static get type(){return"ComputeBuiltinNode"}constructor(a,b){super(b),this._builtinName=a}getHash(a){return this.getBuiltinName(a)}getNodeType(){return this.nodeType}setBuiltinName(a){return this._builtinName=a,this}getBuiltinName(){return this._builtinName}hasBuiltin(a){return a.hasBuiltin(this._builtinName)}generate(a,b){let c=this.getBuiltinName(a),d=this.getNodeType(a);return"compute"===a.shaderStage?a.format(c,d,b):(I(`ComputeBuiltinNode: Compute built-in value ${c} can not be accessed in the ${a.shaderStage} stage`),a.generateConst(d))}serialize(a){super.serialize(a),a.global=this.global,a._builtinName=this._builtinName}deserialize(a){super.deserialize(a),this.global=a.global,this._builtinName=a._builtinName}},tm=(tl=(a,b)=>g0(new tk(a,b)))("numWorkgroups","uvec3"),tn=tl("workgroupId","uvec3"),to=tl("globalId","uvec3"),tp=tl("localId","uvec3"),tq=tl("subgroupSize","uint"),tr=g4(class extends gm{constructor(a){super(),this.scope=a}generate(a){let{scope:b}=this,{renderer:c}=a;!0===c.backend.isWebGLBackend?a.addFlowCode(`	// ${b}Barrier 
`):a.addLineFlowCode(`${b}Barrier()`,this)}}),ts=()=>tr("workgroup").toStack(),tt=()=>tr("storage").toStack(),tu=()=>tr("texture").toStack(),tv=class extends gn{constructor(a,b){super(a,b),this.isWorkgroupInfoElementNode=!0}generate(a,b){let c,d=a.context.assign;if(c=super.generate(a),!0!==d){let d=this.getNodeType(a);c=a.format(c,d,b)}return c}},tw=class extends gm{constructor(a,b,c=0){super(b),this.bufferType=b,this.bufferCount=c,this.isWorkgroupInfoNode=!0,this.elementType=b,this.scope=a,this.name=""}setName(a){return this.name=a,this}label(a){return I('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(a)}setScope(a){return this.scope=a,this}getElementType(){return this.elementType}getInputType(){return`${this.scope}Array`}element(a){return g0(new tv(this,a))}generate(a){let b=""===this.name?`${this.scope}Array_${this.id}`:this.name;return a.getScopedArray(b,this.scope.toLowerCase(),this.bufferType,this.bufferCount)}},tx=(a,b)=>g0(new tw("Workgroup",a,b)),(ty=class extends gm{static get type(){return"AtomicFunctionNode"}constructor(a,b,c){super("uint"),this.method=a,this.pointerNode=b,this.valueNode=c,this.parents=!0}getInputType(a){return this.pointerNode.getNodeType(a)}getNodeType(a){return this.getInputType(a)}generate(a){let b=a.getNodeProperties(this),c=b.parents,d=this.method,e=this.getNodeType(a),f=this.getInputType(a),g=this.pointerNode,h=this.valueNode,i=[];i.push(`&${g.build(a,f)}`),null!==h&&i.push(h.build(a,f));let j=`${a.getMethod(d,e)}( ${i.join(", ")} )`;if(!c||1!==c.length||!0!==c[0].isStackNode)return void 0===b.constNode&&(b.constNode=ky(j,e).toConst()),b.constNode.build(a);a.addLineFlowCode(j,this)}}).ATOMIC_LOAD="atomicLoad",ty.ATOMIC_STORE="atomicStore",ty.ATOMIC_ADD="atomicAdd",ty.ATOMIC_SUB="atomicSub",ty.ATOMIC_MAX="atomicMax",ty.ATOMIC_MIN="atomicMin",ty.ATOMIC_AND="atomicAnd",ty.ATOMIC_OR="atomicOr",ty.ATOMIC_XOR="atomicXor",tz=g4(ty),tA=(a,b,c)=>tz(a,b,c).toStack(),tB=a=>tA(ty.ATOMIC_LOAD,a,null),tC=(a,b)=>tA(ty.ATOMIC_STORE,a,b),tD=(a,b)=>tA(ty.ATOMIC_ADD,a,b),tE=(a,b)=>tA(ty.ATOMIC_SUB,a,b),tF=(a,b)=>tA(ty.ATOMIC_MAX,a,b),tG=(a,b)=>tA(ty.ATOMIC_MIN,a,b),tH=(a,b)=>tA(ty.ATOMIC_AND,a,b),tI=(a,b)=>tA(ty.ATOMIC_OR,a,b),tJ=(a,b)=>tA(ty.ATOMIC_XOR,a,b),(tK=class a extends gp{static get type(){return"SubgroupFunctionNode"}constructor(a,b=null,c=null){super(),this.method=a,this.aNode=b,this.bNode=c}getInputType(a){let b=this.aNode?this.aNode.getNodeType(a):null,c=this.bNode?this.bNode.getNodeType(a):null;return(a.isMatrix(b)?0:a.getTypeLength(b))>(a.isMatrix(c)?0:a.getTypeLength(c))?b:c}getNodeType(b){let c=this.method;return c===a.SUBGROUP_ELECT?"bool":c===a.SUBGROUP_BALLOT?"uvec4":this.getInputType(b)}generate(b,c){let d=this.method,e=this.getNodeType(b),f=this.getInputType(b),g=this.aNode,h=this.bNode,i=[];if(d===a.SUBGROUP_BROADCAST||d===a.SUBGROUP_SHUFFLE||d===a.QUAD_BROADCAST){let a=h.getNodeType(b);i.push(g.build(b,e),h.build(b,"float"===a?"int":e))}else d===a.SUBGROUP_SHUFFLE_XOR||d===a.SUBGROUP_SHUFFLE_DOWN||d===a.SUBGROUP_SHUFFLE_UP?i.push(g.build(b,e),h.build(b,"uint")):(null!==g&&i.push(g.build(b,f)),null!==h&&i.push(h.build(b,f)));let j=0===i.length?"()":`( ${i.join(", ")} )`;return b.format(`${b.getMethod(d,e)}${j}`,e,c)}serialize(a){super.serialize(a),a.method=this.method}deserialize(a){super.deserialize(a),this.method=a.method}}).SUBGROUP_ELECT="subgroupElect",tK.SUBGROUP_BALLOT="subgroupBallot",tK.SUBGROUP_ADD="subgroupAdd",tK.SUBGROUP_INCLUSIVE_ADD="subgroupInclusiveAdd",tK.SUBGROUP_EXCLUSIVE_AND="subgroupExclusiveAdd",tK.SUBGROUP_MUL="subgroupMul",tK.SUBGROUP_INCLUSIVE_MUL="subgroupInclusiveMul",tK.SUBGROUP_EXCLUSIVE_MUL="subgroupExclusiveMul",tK.SUBGROUP_AND="subgroupAnd",tK.SUBGROUP_OR="subgroupOr",tK.SUBGROUP_XOR="subgroupXor",tK.SUBGROUP_MIN="subgroupMin",tK.SUBGROUP_MAX="subgroupMax",tK.SUBGROUP_ALL="subgroupAll",tK.SUBGROUP_ANY="subgroupAny",tK.SUBGROUP_BROADCAST_FIRST="subgroupBroadcastFirst",tK.QUAD_SWAP_X="quadSwapX",tK.QUAD_SWAP_Y="quadSwapY",tK.QUAD_SWAP_DIAGONAL="quadSwapDiagonal",tK.SUBGROUP_BROADCAST="subgroupBroadcast",tK.SUBGROUP_SHUFFLE="subgroupShuffle",tK.SUBGROUP_SHUFFLE_XOR="subgroupShuffleXor",tK.SUBGROUP_SHUFFLE_UP="subgroupShuffleUp",tK.SUBGROUP_SHUFFLE_DOWN="subgroupShuffleDown",tK.QUAD_BROADCAST="quadBroadcast",tL=g6(tK,tK.SUBGROUP_ELECT).setParameterLength(0),tM=g6(tK,tK.SUBGROUP_BALLOT).setParameterLength(1),tN=g6(tK,tK.SUBGROUP_ADD).setParameterLength(1),tO=g6(tK,tK.SUBGROUP_INCLUSIVE_ADD).setParameterLength(1),tP=g6(tK,tK.SUBGROUP_EXCLUSIVE_AND).setParameterLength(1),tQ=g6(tK,tK.SUBGROUP_MUL).setParameterLength(1),tR=g6(tK,tK.SUBGROUP_INCLUSIVE_MUL).setParameterLength(1),tS=g6(tK,tK.SUBGROUP_EXCLUSIVE_MUL).setParameterLength(1),tT=g6(tK,tK.SUBGROUP_AND).setParameterLength(1),tU=g6(tK,tK.SUBGROUP_OR).setParameterLength(1),tV=g6(tK,tK.SUBGROUP_XOR).setParameterLength(1),tW=g6(tK,tK.SUBGROUP_MIN).setParameterLength(1),tX=g6(tK,tK.SUBGROUP_MAX).setParameterLength(1),tY=g6(tK,tK.SUBGROUP_ALL).setParameterLength(0),tZ=g6(tK,tK.SUBGROUP_ANY).setParameterLength(0),t$=g6(tK,tK.SUBGROUP_BROADCAST_FIRST).setParameterLength(2),t_=g6(tK,tK.QUAD_SWAP_X).setParameterLength(1),t0=g6(tK,tK.QUAD_SWAP_Y).setParameterLength(1),t1=g6(tK,tK.QUAD_SWAP_DIAGONAL).setParameterLength(1),t2=g6(tK,tK.SUBGROUP_BROADCAST).setParameterLength(2),t3=g6(tK,tK.SUBGROUP_SHUFFLE).setParameterLength(2),t4=g6(tK,tK.SUBGROUP_SHUFFLE_XOR).setParameterLength(2),t5=g6(tK,tK.SUBGROUP_SHUFFLE_UP).setParameterLength(2),t6=g6(tK,tK.SUBGROUP_SHUFFLE_DOWN).setParameterLength(2),t7=g6(tK,tK.QUAD_BROADCAST).setParameterLength(1),t9=a=>lg.transformDirection(fW(a).sub(fX(a))),ua=(a,b)=>{for(let c of b)if(c.isAnalyticLightNode&&c.light.id===a)return c;return null},ub=new WeakMap,uc=[],ud=class extends gm{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=hE("vec3","totalDiffuse"),this.totalSpecularNode=hE("vec3","totalSpecular"),this.outgoingLightNode=hE("vec3","outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){let a=this._lights;for(let b=0;b<a.length;b++){let c=a[b];if(uc.push(c.id),uc.push(+!!c.castShadow),!0===c.isSpotLight){let a=null===c.map?-1:c.map.id,b=c.colorNode?c.colorNode.getCacheKey():-1;uc.push(a,b)}}let b=f9(uc);return uc.length=0,b}getHash(a){if(null===this._lightNodesHash){null===this._lightNodes&&this.setupLightsNode(a);let b=[];for(let a of this._lightNodes)b.push(a.getHash());this._lightNodesHash="lights-"+b.join(",")}return this._lightNodesHash}analyze(a){let b=a.getNodeProperties(this);for(let c of b.nodes)c.build(a);b.outputNode.build(a)}setupLightsNode(a){let b=[],c=this._lightNodes,d=this._lights.sort((a,b)=>a.id-b.id),e=a.renderer.library;for(let a of d)if(a.isNode)b.push(g0(a));else{let d=null;if(null!==c&&(d=ua(a.id,c)),null===d){let c=e.getLightNodeClass(a.constructor);if(null===c){I(`LightsNode.setupNodeLights: Light node not found for ${a.constructor.name}`);continue}let d=null;ub.has(a)?d=ub.get(a):(d=g0(new c(a)),ub.set(a,d)),b.push(d)}}this._lightNodes=b}setupDirectLight(a,b,c){let{lightingModel:d,reflectedLight:e}=a.context;d.direct({...c,lightNode:b,reflectedLight:e},a)}setupDirectRectAreaLight(a,b,c){let{lightingModel:d,reflectedLight:e}=a.context;d.directRectArea({...c,lightNode:b,reflectedLight:e},a)}setupLights(a,b){for(let c of b)c.build(a)}getLightNodes(a){return null===this._lightNodes&&this.setupLightsNode(a),this._lightNodes}setup(a){let b=a.lightsNode;a.lightsNode=this;let c=this.outgoingLightNode,d=a.context,e=d.lightingModel,f=a.getNodeProperties(this);if(e){let{totalDiffuseNode:b,totalSpecularNode:g}=this;d.outgoingLight=c,f.nodes=a.addStack().nodes,e.start(a);let{backdrop:h,backdropAlpha:i}=d,{directDiffuse:j,directSpecular:k,indirectDiffuse:l,indirectSpecular:m}=d.reflectedLight,n=j.add(l);null!==h&&(n=hm(null===i?h:i.mix(n,h))),b.assign(n),g.assign(k.add(m)),c.assign(b.add(g)),e.finish(a),c=c.bypass(a.removeStack())}else f.nodes=[];return a.lightsNode=b,c}setLights(a){return this._lights=a,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}},ue=(a=[])=>g0(new ud).setLights(a),uf=class extends gm{static get type(){return"ShadowBaseNode"}constructor(a){super(),this.light=a,this.updateBeforeType=gd.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:a,material:b}){ug.assign(b.receivedShadowPositionNode||a.shadowPositionWorld||lJ)}},ug=hE("vec3","shadowPositionWorld"),uh=new WeakMap,ui=fu(({depthTexture:a,shadowCoord:b,depthLayer:c})=>{let d=kP(a,b.xy).setName("t_basic");return a.isArrayTexture&&(d=d.depth(c)),d.compare(b.z)}),uj=fu(({depthTexture:a,shadowCoord:b,shadow:c,depthLayer:d})=>{let e=(b,c)=>{let e=kP(a,b);return a.isArrayTexture&&(e=e.depth(d)),e.compare(c)},f=mg("mapSize","vec2",c).setGroup(ia),g=mg("radius","float",c).setGroup(ia),h=hi(1).div(f),i=h.x.negate().mul(g),j=h.y.negate().mul(g),k=h.x.mul(g),l=h.y.mul(g),m=i.div(2),n=j.div(2),o=k.div(2),p=l.div(2);return im(e(b.xy.add(hi(i,j)),b.z),e(b.xy.add(hi(0,j)),b.z),e(b.xy.add(hi(k,j)),b.z),e(b.xy.add(hi(m,n)),b.z),e(b.xy.add(hi(0,n)),b.z),e(b.xy.add(hi(o,n)),b.z),e(b.xy.add(hi(i,0)),b.z),e(b.xy.add(hi(m,0)),b.z),e(b.xy,b.z),e(b.xy.add(hi(o,0)),b.z),e(b.xy.add(hi(k,0)),b.z),e(b.xy.add(hi(m,p)),b.z),e(b.xy.add(hi(0,p)),b.z),e(b.xy.add(hi(o,p)),b.z),e(b.xy.add(hi(i,l)),b.z),e(b.xy.add(hi(0,l)),b.z),e(b.xy.add(hi(k,l)),b.z)).mul(1/17)}),uk=fu(({depthTexture:a,shadowCoord:b,shadow:c,depthLayer:d})=>{let e=(b,c)=>{let e=kP(a,b);return a.isArrayTexture&&(e=e.depth(d)),e.compare(c)},f=mg("mapSize","vec2",c).setGroup(ia),g=hi(1).div(f),h=g.x,i=g.y,j=b.xy,k=i5(j.mul(f).add(.5));return j.subAssign(k.mul(g)),im(e(j,b.z),e(j.add(hi(h,0)),b.z),e(j.add(hi(0,i)),b.z),e(j.add(g),b.z),jG(e(j.add(hi(h.negate(),0)),b.z),e(j.add(hi(h.mul(2),0)),b.z),k.x),jG(e(j.add(hi(h.negate(),i)),b.z),e(j.add(hi(h.mul(2),i)),b.z),k.x),jG(e(j.add(hi(0,i.negate())),b.z),e(j.add(hi(0,i.mul(2))),b.z),k.y),jG(e(j.add(hi(h,i.negate())),b.z),e(j.add(hi(h,i.mul(2))),b.z),k.y),jG(jG(e(j.add(hi(h.negate(),i.negate())),b.z),e(j.add(hi(h.mul(2),i.negate())),b.z),k.x),jG(e(j.add(hi(h.negate(),i.mul(2))),b.z),e(j.add(hi(h.mul(2),i.mul(2))),b.z),k.x),k.y)).mul(1/9)}),ul=fu(({depthTexture:a,shadowCoord:b,depthLayer:c})=>{let d=he(1).toVar(),e=kP(a).sample(b.xy);a.isArrayTexture&&(e=e.depth(c)),e=e.rg;let f=jt(b.z,e.x);return hb(f.notEqual(he(1)),()=>{let a=b.z.sub(e.x),c=js(0,e.y.mul(e.y)),g=c.div(c.add(a.mul(a)));g=jH(io(g,.3).div(.6499999999999999)),d.assign(jH(js(f,g)))}),d}),um=fu(([a,b,c])=>{let d=lJ.sub(a).length();return(d=d.sub(b).div(c.sub(b))).saturate()}),un=a=>{let b=uh.get(a);if(void 0===b){var c;let d,e,f,g=a.isPointLight?(e=mg("near","float",d=(c=a).shadow.camera).setGroup(ia),f=mg("far","float",d).setGroup(ia),um(lp(c),e,f)):null;(b=new ot).colorNode=hq(0,0,0,1),b.depthNode=g,b.isShadowPassMaterial=!0,b.name="ShadowMaterial",b.fog=!1,uh.set(a,b)}return b},uo=new qH,up=[],uq=(a,b,c,d)=>{up[0]=a,up[1]=b;let e=uo.get(up);return(void 0===e||e.shadowType!==c||e.useVelocity!==d)&&((e=(e,f,g,h,i,j,...k)=>{(!0===e.castShadow||e.receiveShadow&&3===c)&&(d&&(fo(e).useVelocity=!0),e.onBeforeShadow(a,e,g,b.camera,h,f.overrideMaterial,j),a.renderObject(e,f,g,h,i,j,...k),e.onAfterShadow(a,e,g,b.camera,h,f.overrideMaterial,j))}).shadowType=c,e.useVelocity=d,uo.set(up,e)),up[0]=null,up[1]=null,e},ur=fu(({samples:a,radius:b,size:c,shadowPass:d,depthLayer:e})=>{let f=he(0).toVar("meanVertical"),g=he(0).toVar("squareMeanVertical"),h=a.lessThanEqual(he(1)).select(he(0),he(2).div(a.sub(1))),i=a.lessThanEqual(he(1)).select(he(0),he(-1));return nM({start:hf(0),end:hf(a),type:"int",condition:"<"},({i:a})=>{let j=i.add(he(a).mul(h)),k=d.sample(im(k5.xy,hi(0,j).mul(b)).div(c));d.value.isArrayTexture&&(k=k.depth(e)),k=k.x,f.addAssign(k),g.addAssign(k.mul(k))}),f.divAssign(a),g.divAssign(a),hi(f,i0(g.sub(f.mul(f))))}),us=fu(({samples:a,radius:b,size:c,shadowPass:d,depthLayer:e})=>{let f=he(0).toVar("meanHorizontal"),g=he(0).toVar("squareMeanHorizontal"),h=a.lessThanEqual(he(1)).select(he(0),he(2).div(a.sub(1))),i=a.lessThanEqual(he(1)).select(he(0),he(-1));return nM({start:hf(0),end:hf(a),type:"int",condition:"<"},({i:a})=>{let j=i.add(he(a).mul(h)),k=d.sample(im(k5.xy,hi(j,0).mul(b)).div(c));d.value.isArrayTexture&&(k=k.depth(e)),f.addAssign(k.x),g.addAssign(im(k.y.mul(k.y),k.x.mul(k.x)))}),f.divAssign(a),g.divAssign(a),hi(f,i0(g.sub(f.mul(f))))}),ut=[ui,uj,uk,ul],uv=new r2,uw=class extends uf{static get type(){return"ShadowNode"}constructor(a,b=null){super(a),this.shadow=b||a.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._currentShadowType=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0,this.depthLayer=0}setupShadowFilter(a,{filterFn:b,depthTexture:c,shadowCoord:d,shadow:e,depthLayer:f}){let g=d.x.greaterThanEqual(0).and(d.x.lessThanEqual(1)).and(d.y.greaterThanEqual(0)).and(d.y.lessThanEqual(1)).and(d.z.lessThanEqual(1)),h=b({depthTexture:c,shadowCoord:d,shadow:e,depthLayer:f});return g.select(h,he(1))}setupShadowCoord(a,b){let{shadow:c}=this,{renderer:d}=a,e=mg("bias","float",c).setGroup(ia),f=b,g;if(c.camera.isOrthographicCamera||!0!==d.logarithmicDepthBuffer)g=(f=f.xyz.div(f.w)).z,2001===d.coordinateSystem&&(g=g.mul(2).sub(1));else{let a=f.w;f=f.xy.div(a);let b=mg("near","float",c.camera).setGroup(ia),d=mg("far","float",c.camera).setGroup(ia);g=n6(a.negate(),b,d)}return hm(f.x,f.y.oneMinus(),g.add(e))}getShadowFilterFn(a){return ut[a]}setupRenderTarget(a,b){let c=new el(a.mapSize.width,a.mapSize.height);c.name="ShadowDepthTexture",c.compareFunction=513;let d=b.createRenderTarget(a.mapSize.width,a.mapSize.height);return d.texture.name="ShadowMap",d.texture.type=a.mapType,d.depthTexture=c,{shadowMap:d,depthTexture:c}}setupShadow(a){let{renderer:b,camera:c}=a,{light:d,shadow:e}=this,f=b.shadowMap.type,{depthTexture:g,shadowMap:h}=this.setupRenderTarget(e,a);if(e.camera.coordinateSystem=c.coordinateSystem,e.camera.updateProjectionMatrix(),3===f&&!0!==e.isPointLightShadow){g.compareFunction=null,h.depth>1?(h._vsmShadowMapVertical||(h._vsmShadowMapVertical=a.createRenderTarget(e.mapSize.width,e.mapSize.height,{format:aT,type:aG,depth:h.depth,depthBuffer:!1}),h._vsmShadowMapVertical.texture.name="VSMVertical"),this.vsmShadowMapVertical=h._vsmShadowMapVertical,h._vsmShadowMapHorizontal||(h._vsmShadowMapHorizontal=a.createRenderTarget(e.mapSize.width,e.mapSize.height,{format:aT,type:aG,depth:h.depth,depthBuffer:!1}),h._vsmShadowMapHorizontal.texture.name="VSMHorizontal"),this.vsmShadowMapHorizontal=h._vsmShadowMapHorizontal):(this.vsmShadowMapVertical=a.createRenderTarget(e.mapSize.width,e.mapSize.height,{format:aT,type:aG,depthBuffer:!1}),this.vsmShadowMapHorizontal=a.createRenderTarget(e.mapSize.width,e.mapSize.height,{format:aT,type:aG,depthBuffer:!1}));let b=kP(g);g.isArrayTexture&&(b=b.depth(this.depthLayer));let c=kP(this.vsmShadowMapVertical.texture);g.isArrayTexture&&(c=c.depth(this.depthLayer));let d=mg("blurSamples","float",e).setGroup(ia),f=mg("radius","float",e).setGroup(ia),i=mg("mapSize","vec2",e).setGroup(ia),j=this.vsmMaterialVertical||(this.vsmMaterialVertical=new ot);j.fragmentNode=ur({samples:d,radius:f,size:i,shadowPass:b,depthLayer:this.depthLayer}).context(a.getSharedContext()),j.name="VSMVertical",(j=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new ot)).fragmentNode=us({samples:d,radius:f,size:i,shadowPass:c,depthLayer:this.depthLayer}).context(a.getSharedContext()),j.name="VSMHorizontal"}let i=mg("intensity","float",e).setGroup(ia),j=mg("normalBias","float",e).setGroup(ia),k=fU(d).mul(ug.add(lW.mul(j))),l=this.setupShadowCoord(a,k),m=e.filterNode||this.getShadowFilterFn(b.shadowMap.type)||null;if(null===m)throw Error("THREE.WebGPURenderer: Shadow map type not supported yet.");let n=3===f&&!0!==e.isPointLightShadow?this.vsmShadowMapHorizontal.texture:g,o=this.setupShadowFilter(a,{filterFn:m,shadowTexture:h.texture,depthTexture:n,shadowCoord:l,shadow:e,depthLayer:this.depthLayer}),p=kP(h.texture,l);g.isArrayTexture&&(p=p.depth(this.depthLayer));let q=jG(1,o.rgb.mix(p,1),i.mul(p.a)).toVar();this.shadowMap=h,this.shadow.map=h;let r=`${this.light.type} Shadow [ ${this.light.name||"ID: "+this.light.id} ]`;return q.toInspector(`${r} / Color`,()=>kP(this.shadowMap.texture)).toInspector(`${r} / Depth`,()=>kR(this.shadowMap.depthTexture,kJ().mul(kK(kP(this.shadowMap.depthTexture)))).x.oneMinus())}setup(a){if(!1!==a.renderer.shadowMap.enabled)return fu(()=>{let b=a.renderer.shadowMap.type;this._currentShadowType!==b&&(this._reset(),this._node=null);let c=this._node;return this.setupShadowPosition(a),null===c&&(this._node=c=this.setupShadow(a),this._currentShadowType=b),a.material.shadowNode&&I('NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),a.material.receivedShadowNode&&(c=a.material.receivedShadowNode(c)),c})()}renderShadow(a){let{shadow:b,shadowMap:c,light:d}=this,{renderer:e,scene:f}=a;b.updateMatrices(d),c.setSize(b.mapSize.width,b.mapSize.height,c.depth);let g=f.name;f.name=`Shadow Map [ ${d.name||"ID: "+d.id} ]`,e.render(f,b.camera),f.name=g}updateShadow(a){var b,c,d,e;let{shadowMap:f,light:g,shadow:h}=this,{renderer:i,scene:j,camera:k}=a,l=i.shadowMap.type;this._depthVersionCached=f.depthTexture.version;let m=h.camera.layers.mask;0xfffffffe&h.camera.layers.mask||(h.camera.layers.mask=k.layers.mask);let n=i.getRenderObjectFunction(),o=i.getMRT(),p=!!o&&o.has("velocity");c=function(a,b={}){return b.toneMapping=a.toneMapping,b.toneMappingExposure=a.toneMappingExposure,b.outputColorSpace=a.outputColorSpace,b.renderTarget=a.getRenderTarget(),b.activeCubeFace=a.getActiveCubeFace(),b.activeMipmapLevel=a.getActiveMipmapLevel(),b.renderObjectFunction=a.getRenderObjectFunction(),b.pixelRatio=a.getPixelRatio(),b.mrt=a.getMRT(),b.clearColor=a.getClearColor(b.clearColor||new de),b.clearAlpha=a.getClearAlpha(),b.autoClear=a.autoClear,b.scissorTest=a.getScissorTest(),b}(i,c=b=uu),i.setMRT(null),i.setRenderObjectFunction(null),i.setClearColor(0,1),i.autoClear=!0,d=function(a,b={}){return b.background=a.background,b.backgroundNode=a.backgroundNode,b.overrideMaterial=a.overrideMaterial,b}(j,d=b=c),j.background=null,j.backgroundNode=null,j.overrideMaterial=null,uu=b=d,j.overrideMaterial=un(g),i.setRenderObjectFunction(uq(i,h,l,p)),i.setClearColor(0,0),i.setRenderTarget(f),this.renderShadow(a),i.setRenderObjectFunction(n),3===l&&!0!==h.isPointLightShadow&&this.vsmPass(i),h.camera.layers.mask=m,i.toneMapping=(e=uu).toneMapping,i.toneMappingExposure=e.toneMappingExposure,i.outputColorSpace=e.outputColorSpace,i.setRenderTarget(e.renderTarget,e.activeCubeFace,e.activeMipmapLevel),i.setRenderObjectFunction(e.renderObjectFunction),i.setPixelRatio(e.pixelRatio),i.setMRT(e.mrt),i.setClearColor(e.clearColor,e.clearAlpha),i.autoClear=e.autoClear,i.setScissorTest(e.scissorTest),j.background=e.background,j.backgroundNode=e.backgroundNode,j.overrideMaterial=e.overrideMaterial}vsmPass(a){let{shadow:b}=this,c=this.shadowMap.depth;this.vsmShadowMapVertical.setSize(b.mapSize.width,b.mapSize.height,c),this.vsmShadowMapHorizontal.setSize(b.mapSize.width,b.mapSize.height,c),a.setRenderTarget(this.vsmShadowMapVertical),uv.material=this.vsmMaterialVertical,uv.render(a),a.setRenderTarget(this.vsmShadowMapHorizontal),uv.material=this.vsmMaterialHorizontal,uv.render(a)}dispose(){this._reset(),super.dispose()}_reset(){this._currentShadowType=null,this.shadowMap&&(this.shadowMap=(this.shadowMap.dispose(),null)),null!==this.vsmShadowMapVertical&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),null!==this.vsmShadowMapHorizontal&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null)}updateBefore(a){let{shadow:b}=this,c=b.needsUpdate||b.autoUpdate;c&&(this._cameraFrameId[a.camera]===a.frameId&&(c=!1),this._cameraFrameId[a.camera]=a.frameId),c&&(this.updateShadow(a),this.shadowMap.depthTexture.version===this._depthVersionCached&&(b.needsUpdate=!1))}},ux=(a,b)=>g0(new uw(a,b)),uy=new de,uz=fu(([a,b])=>{let c=a.toVar(),d=jc(c),e=iq(1,js(d.x,js(d.y,d.z)));d.mulAssign(e),c.mulAssign(e.mul(b.mul(2).oneMinus()));let f=hi(c.xy).toVar(),g=b.mul(1.5).oneMinus();return hb(d.z.greaterThanEqual(g),()=>{hb(c.z.greaterThan(0),()=>{f.x.assign(io(4,c.x))})}).ElseIf(d.x.greaterThanEqual(g),()=>{let a=jd(c.x);f.x.assign(c.z.mul(a).add(a.mul(2)))}).ElseIf(d.y.greaterThanEqual(g),()=>{let a=jd(c.y);f.x.assign(c.x.add(a.mul(2)).add(2)),f.y.assign(c.z.mul(a).sub(2))}),hi(.125,.25).mul(f).add(hi(.375,.75)).flipY()}).setLayout({name:"cubeToUV",type:"vec2",inputs:[{name:"pos",type:"vec3"},{name:"texelSizeY",type:"float"}]}),uA=fu(({depthTexture:a,bd3D:b,dp:c,texelSize:d})=>kP(a,uz(b,d.y)).compare(c)),uB=fu(({depthTexture:a,bd3D:b,dp:c,texelSize:d,shadow:e})=>{let f=mg("radius","float",e).setGroup(ia),g=hi(-1,1).mul(f).mul(d.y);return kP(a,uz(b.add(g.xyy),d.y)).compare(c).add(kP(a,uz(b.add(g.yyy),d.y)).compare(c)).add(kP(a,uz(b.add(g.xyx),d.y)).compare(c)).add(kP(a,uz(b.add(g.yyx),d.y)).compare(c)).add(kP(a,uz(b,d.y)).compare(c)).add(kP(a,uz(b.add(g.xxy),d.y)).compare(c)).add(kP(a,uz(b.add(g.yxy),d.y)).compare(c)).add(kP(a,uz(b.add(g.xxx),d.y)).compare(c)).add(kP(a,uz(b.add(g.yxx),d.y)).compare(c)).mul(1/9)}),uC=fu(({filterFn:a,depthTexture:b,shadowCoord:c,shadow:d})=>{let e=c.xyz.toVar(),f=e.length(),g=id("float").setGroup(ia).onRenderUpdate(()=>d.camera.near),h=id("float").setGroup(ia).onRenderUpdate(()=>d.camera.far),i=mg("bias","float",d).setGroup(ia),j=id(d.mapSize).setGroup(ia),k=he(1).toVar();return hb(f.sub(h).lessThanEqual(0).and(f.sub(g).greaterThanEqual(0)),()=>{let c=f.sub(g).div(h.sub(g)).toVar();c.addAssign(i);let l=e.normalize(),m=hi(1).div(j.mul(hi(4,2)));k.assign(a({depthTexture:b,bd3D:l,dp:c,texelSize:m,shadow:d}))}),k}),uD=new b3,uE=new bO,uF=new bO,uG=class extends uw{static get type(){return"PointShadowNode"}constructor(a,b=null){super(a,b)}getShadowFilterFn(a){return 0===a?uA:uB}setupShadowCoord(a,b){return b}setupShadowFilter(a,{filterFn:b,shadowTexture:c,depthTexture:d,shadowCoord:e,shadow:f}){return uC({filterFn:b,shadowTexture:c,depthTexture:d,shadowCoord:e,shadow:f})}renderShadow(a){let{shadow:b,shadowMap:c,light:d}=this,{renderer:e,scene:f}=a,g=b.getFrameExtents();uF.copy(b.mapSize),uF.multiply(g),c.setSize(uF.width,uF.height),uE.copy(b.mapSize);let h=e.autoClear,i=e.getClearColor(uy),j=e.getClearAlpha();e.autoClear=!1,e.setClearColor(b.clearColor,b.clearAlpha),e.clear();let k=b.getViewportCount();for(let a=0;a<k;a++){let g=b.getViewport(a),h=uE.x*g.x,i=uF.y-uE.y-uE.y*g.y;uD.set(h,i,uE.x*g.z,uE.y*g.w),c.viewport.copy(uD),b.updateMatrices(d,a);let j=f.name;f.name=`Point Light Shadow [ ${d.name||"ID: "+d.id} ] - Face ${a+1}`,e.render(f,b.camera),f.name=j}e.autoClear=h,e.setClearColor(i,j)}},uH=(a,b)=>g0(new uG(a,b)),uI=class extends nT{static get type(){return"AnalyticLightNode"}constructor(a=null){super(),this.light=a,this.color=new de,this.colorNode=a&&a.colorNode||id(this.color).setGroup(ia),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=gd.FRAME}getHash(){return this.light.uuid}getLightVector(a){return fY(this.light).sub(a.context.positionView||lL)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return ux(this.light)}setupShadow(a){let{renderer:b}=a;if(!1===b.shadowMap.enabled)return;let c=this.shadowColorNode;if(null===c){let a=this.light.shadow.shadowNode,b;b=void 0===a?this.setupShadowNode():g0(a),this.shadowNode=b,this.shadowColorNode=c=this.colorNode.mul(b),this.baseColorNode=this.colorNode}this.colorNode=c}setup(a){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?a.object.receiveShadow&&this.setupShadow(a):null!==this.shadowNode&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);let b=this.setupDirect(a),c=this.setupDirectRectArea(a);b&&a.lightsNode.setupDirectLight(a,this,b),c&&a.lightsNode.setupDirectRectAreaLight(a,this,c)}update(){let{light:a}=this;this.color.copy(a.color).multiplyScalar(a.intensity)}},uJ=fu(({lightDistance:a,cutoffDistance:b,decayExponent:c})=>{let d=a.pow(c).max(.01).reciprocal();return b.greaterThan(0).select(d.mul(a.div(b).pow4().oneMinus().clamp().pow2()),d)}),uK=({color:a,lightVector:b,cutoffDistance:c,decayExponent:d})=>{let e=b.normalize(),f=uJ({lightDistance:b.length(),cutoffDistance:c,decayExponent:d});return{lightDirection:e,lightColor:a.mul(f)}},uL=class extends uI{static get type(){return"PointLightNode"}constructor(a=null){super(a),this.cutoffDistanceNode=id(0).setGroup(ia),this.decayExponentNode=id(2).setGroup(ia)}update(a){let{light:b}=this;super.update(a),this.cutoffDistanceNode.value=b.distance,this.decayExponentNode.value=b.decay}setupShadowNode(){return uH(this.light)}setupDirect(a){return uK({color:this.colorNode,lightVector:this.getLightVector(a),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}},uM=fu(([a=kJ()])=>{let b=a.mul(2),c=b.x.floor(),d=b.y.floor();return c.add(d).mod(2).sign()}),uN=fu(([a=kJ()],{renderer:b,material:c})=>{let d=jF(a.mul(2).sub(1)),e;if(c.alphaToCoverage&&b.currentSamples>0){let a=he(d.fwidth()).toVar();e=jK(a.oneMinus(),a.add(1),d).oneMinus()}else e=jT(d.greaterThan(1),0,1);return e}),uO=fu(([a,b,c])=>{let d=he(c).toVar(),e=he(b).toVar();return jT(hh(a).toVar(),e,d)}).setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]}),uP=fu(([a,b])=>{let c=hh(b).toVar(),d=he(a).toVar();return jT(c,d.negate(),d)}).setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]}),uQ=fu(([a])=>hf(i2(he(a).toVar()))).setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]}),uR=fu(([a,b])=>{let c=he(a).toVar();return b.assign(uQ(c)),c.sub(he(b))}),uS=rw([fu(([a,b,c,d,e,f])=>{let g=he(f).toVar(),h=he(e).toVar(),i=he(d).toVar(),j=he(c).toVar(),k=he(b).toVar(),l=he(a).toVar(),m=he(io(1,h)).toVar();return io(1,g).mul(l.mul(m).add(k.mul(h))).add(g.mul(j.mul(m).add(i.mul(h))))}).setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]}),fu(([a,b,c,d,e,f])=>{let g=he(f).toVar(),h=he(e).toVar(),i=hm(d).toVar(),j=hm(c).toVar(),k=hm(b).toVar(),l=hm(a).toVar(),m=he(io(1,h)).toVar();return io(1,g).mul(l.mul(m).add(k.mul(h))).add(g.mul(j.mul(m).add(i.mul(h))))}).setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]})]),uT=rw([fu(([a,b,c,d,e,f,g,h,i,j,k])=>{let l=he(k).toVar(),m=he(j).toVar(),n=he(i).toVar(),o=he(h).toVar(),p=he(g).toVar(),q=he(f).toVar(),r=he(e).toVar(),s=he(d).toVar(),t=he(c).toVar(),u=he(b).toVar(),v=he(a).toVar(),w=he(io(1,n)).toVar(),x=he(io(1,m)).toVar();return he(io(1,l)).toVar().mul(x.mul(v.mul(w).add(u.mul(n))).add(m.mul(t.mul(w).add(s.mul(n))))).add(l.mul(x.mul(r.mul(w).add(q.mul(n))).add(m.mul(p.mul(w).add(o.mul(n))))))}).setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),fu(([a,b,c,d,e,f,g,h,i,j,k])=>{let l=he(k).toVar(),m=he(j).toVar(),n=he(i).toVar(),o=hm(h).toVar(),p=hm(g).toVar(),q=hm(f).toVar(),r=hm(e).toVar(),s=hm(d).toVar(),t=hm(c).toVar(),u=hm(b).toVar(),v=hm(a).toVar(),w=he(io(1,n)).toVar(),x=he(io(1,m)).toVar();return he(io(1,l)).toVar().mul(x.mul(v.mul(w).add(u.mul(n))).add(m.mul(t.mul(w).add(s.mul(n))))).add(l.mul(x.mul(r.mul(w).add(q.mul(n))).add(m.mul(p.mul(w).add(o.mul(n))))))}).setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]})]),uU=rw([fu(([a,b,c])=>{let d=he(c).toVar(),e=he(b).toVar(),f=hg(hg(a).toVar().bitAnd(hg(7))).toVar(),g=he(uO(f.lessThan(hg(4)),e,d)).toVar(),h=he(ip(2,uO(f.lessThan(hg(4)),d,e))).toVar();return uP(g,hh(f.bitAnd(hg(1)))).add(uP(h,hh(f.bitAnd(hg(2)))))}).setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]}),fu(([a,b,c,d])=>{let e=he(d).toVar(),f=he(c).toVar(),g=he(b).toVar(),h=hg(hg(a).toVar().bitAnd(hg(15))).toVar(),i=he(uO(h.lessThan(hg(8)),g,f)).toVar(),j=he(uO(h.lessThan(hg(4)),f,uO(h.equal(hg(12)).or(h.equal(hg(14))),g,e))).toVar();return uP(i,hh(h.bitAnd(hg(1)))).add(uP(j,hh(h.bitAnd(hg(2)))))}).setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]})]),uV=rw([fu(([a,b,c])=>{let d=he(c).toVar(),e=he(b).toVar(),f=ho(a).toVar();return hm(uU(f.x,e,d),uU(f.y,e,d),uU(f.z,e,d))}).setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]}),fu(([a,b,c,d])=>{let e=he(d).toVar(),f=he(c).toVar(),g=he(b).toVar(),h=ho(a).toVar();return hm(uU(h.x,g,f,e),uU(h.y,g,f,e),uU(h.z,g,f,e))}).setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]})]),uW=fu(([a])=>ip(.6616,he(a).toVar())).setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]}),uX=fu(([a])=>ip(.982,he(a).toVar())).setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]}),uY=rw([uW,fu(([a])=>ip(.6616,hm(a).toVar())).setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]})]),uZ=rw([uX,fu(([a])=>ip(.982,hm(a).toVar())).setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]})]),u$=fu(([a,b])=>{let c=hf(b).toVar(),d=hg(a).toVar();return d.shiftLeft(c).bitOr(d.shiftRight(hf(32).sub(c)))}).setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]}),u_=fu(([a,b,c])=>{a.subAssign(c),a.bitXorAssign(u$(c,hf(4))),c.addAssign(b),b.subAssign(a),b.bitXorAssign(u$(a,hf(6))),a.addAssign(c),c.subAssign(b),c.bitXorAssign(u$(b,hf(8))),b.addAssign(a),a.subAssign(c),a.bitXorAssign(u$(c,hf(16))),c.addAssign(b),b.subAssign(a),b.bitXorAssign(u$(a,hf(19))),a.addAssign(c),c.subAssign(b),c.bitXorAssign(u$(b,hf(4))),b.addAssign(a)}),u0=fu(([a,b,c])=>{let d=hg(c).toVar(),e=hg(b).toVar(),f=hg(a).toVar();return d.bitXorAssign(e),d.subAssign(u$(e,hf(14))),f.bitXorAssign(d),f.subAssign(u$(d,hf(11))),e.bitXorAssign(f),e.subAssign(u$(f,hf(25))),d.bitXorAssign(e),d.subAssign(u$(e,hf(16))),f.bitXorAssign(d),f.subAssign(u$(d,hf(4))),e.bitXorAssign(f),e.subAssign(u$(f,hf(14))),d.bitXorAssign(e),d.subAssign(u$(e,hf(24))),d}).setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]}),u1=fu(([a])=>he(hg(a).toVar()).div(he(hg(hf(0xffffffff))))).setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]}),u2=fu(([a])=>{let b=he(a).toVar();return b.mul(b).mul(b).mul(b.mul(b.mul(6).sub(15)).add(10))}).setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]}),u3=rw([fu(([a])=>{let b=hf(a).toVar(),c=hg(hg(1)).toVar(),d=hg(hg(hf(0xdeadbeef)).add(c.shiftLeft(hg(2))).add(hg(13))).toVar();return u0(d.add(hg(b)),d,d)}).setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]}),fu(([a,b])=>{let c=hf(b).toVar(),d=hf(a).toVar(),e=hg(hg(2)).toVar(),f=hg().toVar(),g=hg().toVar(),h=hg().toVar();return f.assign(g.assign(h.assign(hg(hf(0xdeadbeef)).add(e.shiftLeft(hg(2))).add(hg(13))))),f.addAssign(hg(d)),g.addAssign(hg(c)),u0(f,g,h)}).setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),fu(([a,b,c])=>{let d=hf(c).toVar(),e=hf(b).toVar(),f=hf(a).toVar(),g=hg(hg(3)).toVar(),h=hg().toVar(),i=hg().toVar(),j=hg().toVar();return h.assign(i.assign(j.assign(hg(hf(0xdeadbeef)).add(g.shiftLeft(hg(2))).add(hg(13))))),h.addAssign(hg(f)),i.addAssign(hg(e)),j.addAssign(hg(d)),u0(h,i,j)}).setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),fu(([a,b,c,d])=>{let e=hf(d).toVar(),f=hf(c).toVar(),g=hf(b).toVar(),h=hf(a).toVar(),i=hg(hg(4)).toVar(),j=hg().toVar(),k=hg().toVar(),l=hg().toVar();return j.assign(k.assign(l.assign(hg(hf(0xdeadbeef)).add(i.shiftLeft(hg(2))).add(hg(13))))),j.addAssign(hg(h)),k.addAssign(hg(g)),l.addAssign(hg(f)),u_(j,k,l),j.addAssign(hg(e)),u0(j,k,l)}).setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]}),fu(([a,b,c,d,e])=>{let f=hf(e).toVar(),g=hf(d).toVar(),h=hf(c).toVar(),i=hf(b).toVar(),j=hf(a).toVar(),k=hg(hg(5)).toVar(),l=hg().toVar(),m=hg().toVar(),n=hg().toVar();return l.assign(m.assign(n.assign(hg(hf(0xdeadbeef)).add(k.shiftLeft(hg(2))).add(hg(13))))),l.addAssign(hg(j)),m.addAssign(hg(i)),n.addAssign(hg(h)),u_(l,m,n),l.addAssign(hg(g)),m.addAssign(hg(f)),u0(l,m,n)}).setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]})]),u4=rw([fu(([a,b])=>{let c=hf(b).toVar(),d=hg(u3(hf(a).toVar(),c)).toVar(),e=ho().toVar();return e.x.assign(d.bitAnd(hf(255))),e.y.assign(d.shiftRight(hf(8)).bitAnd(hf(255))),e.z.assign(d.shiftRight(hf(16)).bitAnd(hf(255))),e}).setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),fu(([a,b,c])=>{let d=hf(c).toVar(),e=hf(b).toVar(),f=hg(u3(hf(a).toVar(),e,d)).toVar(),g=ho().toVar();return g.x.assign(f.bitAnd(hf(255))),g.y.assign(f.shiftRight(hf(8)).bitAnd(hf(255))),g.z.assign(f.shiftRight(hf(16)).bitAnd(hf(255))),g}).setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]})]),u5=rw([fu(([a])=>{let b=hi(a).toVar(),c=hf().toVar(),d=hf().toVar(),e=he(uR(b.x,c)).toVar(),f=he(uR(b.y,d)).toVar(),g=he(u2(e)).toVar(),h=he(u2(f)).toVar();return uY(he(uS(uU(u3(c,d),e,f),uU(u3(c.add(hf(1)),d),e.sub(1),f),uU(u3(c,d.add(hf(1))),e,f.sub(1)),uU(u3(c.add(hf(1)),d.add(hf(1))),e.sub(1),f.sub(1)),g,h)).toVar())}).setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]}),fu(([a])=>{let b=hm(a).toVar(),c=hf().toVar(),d=hf().toVar(),e=hf().toVar(),f=he(uR(b.x,c)).toVar(),g=he(uR(b.y,d)).toVar(),h=he(uR(b.z,e)).toVar(),i=he(u2(f)).toVar(),j=he(u2(g)).toVar(),k=he(u2(h)).toVar();return uZ(he(uT(uU(u3(c,d,e),f,g,h),uU(u3(c.add(hf(1)),d,e),f.sub(1),g,h),uU(u3(c,d.add(hf(1)),e),f,g.sub(1),h),uU(u3(c.add(hf(1)),d.add(hf(1)),e),f.sub(1),g.sub(1),h),uU(u3(c,d,e.add(hf(1))),f,g,h.sub(1)),uU(u3(c.add(hf(1)),d,e.add(hf(1))),f.sub(1),g,h.sub(1)),uU(u3(c,d.add(hf(1)),e.add(hf(1))),f,g.sub(1),h.sub(1)),uU(u3(c.add(hf(1)),d.add(hf(1)),e.add(hf(1))),f.sub(1),g.sub(1),h.sub(1)),i,j,k)).toVar())}).setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]})]),u6=rw([fu(([a])=>{let b=hi(a).toVar(),c=hf().toVar(),d=hf().toVar(),e=he(uR(b.x,c)).toVar(),f=he(uR(b.y,d)).toVar(),g=he(u2(e)).toVar(),h=he(u2(f)).toVar();return uY(hm(uS(uV(u4(c,d),e,f),uV(u4(c.add(hf(1)),d),e.sub(1),f),uV(u4(c,d.add(hf(1))),e,f.sub(1)),uV(u4(c.add(hf(1)),d.add(hf(1))),e.sub(1),f.sub(1)),g,h)).toVar())}).setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),fu(([a])=>{let b=hm(a).toVar(),c=hf().toVar(),d=hf().toVar(),e=hf().toVar(),f=he(uR(b.x,c)).toVar(),g=he(uR(b.y,d)).toVar(),h=he(uR(b.z,e)).toVar(),i=he(u2(f)).toVar(),j=he(u2(g)).toVar(),k=he(u2(h)).toVar();return uZ(hm(uT(uV(u4(c,d,e),f,g,h),uV(u4(c.add(hf(1)),d,e),f.sub(1),g,h),uV(u4(c,d.add(hf(1)),e),f,g.sub(1),h),uV(u4(c.add(hf(1)),d.add(hf(1)),e),f.sub(1),g.sub(1),h),uV(u4(c,d,e.add(hf(1))),f,g,h.sub(1)),uV(u4(c.add(hf(1)),d,e.add(hf(1))),f.sub(1),g,h.sub(1)),uV(u4(c,d.add(hf(1)),e.add(hf(1))),f,g.sub(1),h.sub(1)),uV(u4(c.add(hf(1)),d.add(hf(1)),e.add(hf(1))),f.sub(1),g.sub(1),h.sub(1)),i,j,k)).toVar())}).setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]})]),u7=rw([fu(([a])=>u1(u3(hf(uQ(he(a).toVar())).toVar()))).setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]}),fu(([a])=>{let b=hi(a).toVar();return u1(u3(hf(uQ(b.x)).toVar(),hf(uQ(b.y)).toVar()))}).setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]}),fu(([a])=>{let b=hm(a).toVar();return u1(u3(hf(uQ(b.x)).toVar(),hf(uQ(b.y)).toVar(),hf(uQ(b.z)).toVar()))}).setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]}),fu(([a])=>{let b=hq(a).toVar();return u1(u3(hf(uQ(b.x)).toVar(),hf(uQ(b.y)).toVar(),hf(uQ(b.z)).toVar(),hf(uQ(b.w)).toVar()))}).setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]})]),u8=rw([fu(([a])=>{let b=hf(uQ(he(a).toVar())).toVar();return hm(u1(u3(b,hf(0))),u1(u3(b,hf(1))),u1(u3(b,hf(2))))}).setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]}),fu(([a])=>{let b=hi(a).toVar(),c=hf(uQ(b.x)).toVar(),d=hf(uQ(b.y)).toVar();return hm(u1(u3(c,d,hf(0))),u1(u3(c,d,hf(1))),u1(u3(c,d,hf(2))))}).setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),fu(([a])=>{let b=hm(a).toVar(),c=hf(uQ(b.x)).toVar(),d=hf(uQ(b.y)).toVar(),e=hf(uQ(b.z)).toVar();return hm(u1(u3(c,d,e,hf(0))),u1(u3(c,d,e,hf(1))),u1(u3(c,d,e,hf(2))))}).setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),fu(([a])=>{let b=hq(a).toVar(),c=hf(uQ(b.x)).toVar(),d=hf(uQ(b.y)).toVar(),e=hf(uQ(b.z)).toVar(),f=hf(uQ(b.w)).toVar();return hm(u1(u3(c,d,e,f,hf(0))),u1(u3(c,d,e,f,hf(1))),u1(u3(c,d,e,f,hf(2))))}).setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]})]),u9=fu(([a,b,c,d])=>{let e=he(d).toVar(),f=he(c).toVar(),g=hf(b).toVar(),h=hm(a).toVar(),i=he(0).toVar(),j=he(1).toVar();return nM(g,()=>{i.addAssign(j.mul(u5(h))),j.mulAssign(e),h.mulAssign(f)}),i}).setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),va=fu(([a,b,c,d])=>{let e=he(d).toVar(),f=he(c).toVar(),g=hf(b).toVar(),h=hm(a).toVar(),i=hm(0).toVar(),j=he(1).toVar();return nM(g,()=>{i.addAssign(j.mul(u6(h))),j.mulAssign(e),h.mulAssign(f)}),i}).setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),vb=fu(([a,b,c,d])=>{let e=he(d).toVar(),f=he(c).toVar(),g=hf(b).toVar(),h=hm(a).toVar();return hi(u9(h,g,f,e),u9(h.add(hm(hf(19),hf(193),hf(17))),g,f,e))}).setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),vc=fu(([a,b,c,d])=>{let e=he(d).toVar(),f=he(c).toVar(),g=hf(b).toVar(),h=hm(a).toVar();return hq(hm(va(h,g,f,e)).toVar(),he(u9(h.add(hm(hf(19),hf(193),hf(17))),g,f,e)).toVar())}).setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),vd=rw([fu(([a,b,c,d,e,f,g])=>{let h=hf(g).toVar(),i=he(f).toVar(),j=hf(e).toVar(),k=hf(d).toVar(),l=hf(c).toVar(),m=hf(b).toVar(),n=hi(a).toVar(),o=hm(u8(hi(m.add(k),l.add(j)))).toVar(),p=hi(o.x,o.y).toVar();p.subAssign(.5),p.mulAssign(i),p.addAssign(.5);let q=hi(hi(hi(he(m),he(l)).add(p)).toVar().sub(n)).toVar();return hb(h.equal(hf(2)),()=>jc(q.x).add(jc(q.y))),hb(h.equal(hf(3)),()=>js(jc(q.x),jc(q.y))),jx(q,q)}).setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),fu(([a,b,c,d,e,f,g,h,i])=>{let j=hf(i).toVar(),k=he(h).toVar(),l=hf(g).toVar(),m=hf(f).toVar(),n=hf(e).toVar(),o=hf(d).toVar(),p=hf(c).toVar(),q=hf(b).toVar(),r=hm(a).toVar(),s=hm(u8(hm(q.add(n),p.add(m),o.add(l)))).toVar();s.subAssign(.5),s.mulAssign(k),s.addAssign(.5);let t=hm(hm(hm(he(q),he(p),he(o)).add(s)).toVar().sub(r)).toVar();return hb(j.equal(hf(2)),()=>jc(t.x).add(jc(t.y)).add(jc(t.z))),hb(j.equal(hf(3)),()=>js(jc(t.x),jc(t.y),jc(t.z))),jx(t,t)}).setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]})]),ve=fu(([a,b,c])=>{let d=hf(c).toVar(),e=he(b).toVar(),f=hi(a).toVar(),g=hf().toVar(),h=hf().toVar(),i=hi(uR(f.x,g),uR(f.y,h)).toVar(),j=he(1e6).toVar();return nM({start:-1,end:hf(1),name:"x",condition:"<="},({x:a})=>{nM({start:-1,end:hf(1),name:"y",condition:"<="},({y:b})=>{let c=he(vd(i,a,b,g,h,e,d)).toVar();j.assign(jr(j,c))})}),hb(d.equal(hf(0)),()=>{j.assign(i0(j))}),j}).setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),vf=fu(([a,b,c])=>{let d=hf(c).toVar(),e=he(b).toVar(),f=hi(a).toVar(),g=hf().toVar(),h=hf().toVar(),i=hi(uR(f.x,g),uR(f.y,h)).toVar(),j=hi(1e6,1e6).toVar();return nM({start:-1,end:hf(1),name:"x",condition:"<="},({x:a})=>{nM({start:-1,end:hf(1),name:"y",condition:"<="},({y:b})=>{let c=he(vd(i,a,b,g,h,e,d)).toVar();hb(c.lessThan(j.x),()=>{j.y.assign(j.x),j.x.assign(c)}).ElseIf(c.lessThan(j.y),()=>{j.y.assign(c)})})}),hb(d.equal(hf(0)),()=>{j.assign(i0(j))}),j}).setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),vg=fu(([a,b,c])=>{let d=hf(c).toVar(),e=he(b).toVar(),f=hi(a).toVar(),g=hf().toVar(),h=hf().toVar(),i=hi(uR(f.x,g),uR(f.y,h)).toVar(),j=hm(1e6,1e6,1e6).toVar();return nM({start:-1,end:hf(1),name:"x",condition:"<="},({x:a})=>{nM({start:-1,end:hf(1),name:"y",condition:"<="},({y:b})=>{let c=he(vd(i,a,b,g,h,e,d)).toVar();hb(c.lessThan(j.x),()=>{j.z.assign(j.y),j.y.assign(j.x),j.x.assign(c)}).ElseIf(c.lessThan(j.y),()=>{j.z.assign(j.y),j.y.assign(c)}).ElseIf(c.lessThan(j.z),()=>{j.z.assign(c)})})}),hb(d.equal(hf(0)),()=>{j.assign(i0(j))}),j}).setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),vh=rw([ve,fu(([a,b,c])=>{let d=hf(c).toVar(),e=he(b).toVar(),f=hm(a).toVar(),g=hf().toVar(),h=hf().toVar(),i=hf().toVar(),j=hm(uR(f.x,g),uR(f.y,h),uR(f.z,i)).toVar(),k=he(1e6).toVar();return nM({start:-1,end:hf(1),name:"x",condition:"<="},({x:a})=>{nM({start:-1,end:hf(1),name:"y",condition:"<="},({y:b})=>{nM({start:-1,end:hf(1),name:"z",condition:"<="},({z:c})=>{let f=he(vd(j,a,b,c,g,h,i,e,d)).toVar();k.assign(jr(k,f))})})}),hb(d.equal(hf(0)),()=>{k.assign(i0(k))}),k}).setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]})]),vi=rw([vf,fu(([a,b,c])=>{let d=hf(c).toVar(),e=he(b).toVar(),f=hm(a).toVar(),g=hf().toVar(),h=hf().toVar(),i=hf().toVar(),j=hm(uR(f.x,g),uR(f.y,h),uR(f.z,i)).toVar(),k=hi(1e6,1e6).toVar();return nM({start:-1,end:hf(1),name:"x",condition:"<="},({x:a})=>{nM({start:-1,end:hf(1),name:"y",condition:"<="},({y:b})=>{nM({start:-1,end:hf(1),name:"z",condition:"<="},({z:c})=>{let f=he(vd(j,a,b,c,g,h,i,e,d)).toVar();hb(f.lessThan(k.x),()=>{k.y.assign(k.x),k.x.assign(f)}).ElseIf(f.lessThan(k.y),()=>{k.y.assign(f)})})})}),hb(d.equal(hf(0)),()=>{k.assign(i0(k))}),k}).setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]})]),vj=rw([vg,fu(([a,b,c])=>{let d=hf(c).toVar(),e=he(b).toVar(),f=hm(a).toVar(),g=hf().toVar(),h=hf().toVar(),i=hf().toVar(),j=hm(uR(f.x,g),uR(f.y,h),uR(f.z,i)).toVar(),k=hm(1e6,1e6,1e6).toVar();return nM({start:-1,end:hf(1),name:"x",condition:"<="},({x:a})=>{nM({start:-1,end:hf(1),name:"y",condition:"<="},({y:b})=>{nM({start:-1,end:hf(1),name:"z",condition:"<="},({z:c})=>{let f=he(vd(j,a,b,c,g,h,i,e,d)).toVar();hb(f.lessThan(k.x),()=>{k.z.assign(k.y),k.y.assign(k.x),k.x.assign(f)}).ElseIf(f.lessThan(k.y),()=>{k.z.assign(k.y),k.y.assign(f)}).ElseIf(f.lessThan(k.z),()=>{k.z.assign(f)})})})}),hb(d.equal(hf(0)),()=>{k.assign(i0(k))}),k}).setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]})]),vk=fu(([a,b,c,d,e,f,g,h,i,j,k])=>{let l=hf(a).toVar(),m=hi(b).toVar(),n=hi(c).toVar(),o=hi(d).toVar(),p=he(e).toVar(),q=he(f).toVar(),r=he(g).toVar(),s=hh(h).toVar(),t=hf(i).toVar(),u=he(j).toVar(),v=he(k).toVar(),w=m.mul(n).add(o),x=he(0).toVar();return hb(l.equal(hf(0)),()=>{x.assign(u6(w))}),hb(l.equal(hf(1)),()=>{x.assign(u8(w))}),hb(l.equal(hf(2)),()=>{x.assign(vj(w,p,hf(0)))}),hb(l.equal(hf(3)),()=>{x.assign(va(hm(w,0),t,u,v))}),x.assign(x.mul(r.sub(q)).add(q)),hb(s,()=>{x.assign(jH(x,q,r))}),x}).setLayout({name:"mx_unifiednoise2d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"texcoord",type:"vec2"},{name:"freq",type:"vec2"},{name:"offset",type:"vec2"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),vl=fu(([a,b,c,d,e,f,g,h,i,j,k])=>{let l=hf(a).toVar(),m=hm(b).toVar(),n=hm(c).toVar(),o=hm(d).toVar(),p=he(e).toVar(),q=he(f).toVar(),r=he(g).toVar(),s=hh(h).toVar(),t=hf(i).toVar(),u=he(j).toVar(),v=he(k).toVar(),w=m.mul(n).add(o),x=he(0).toVar();return hb(l.equal(hf(0)),()=>{x.assign(u6(w))}),hb(l.equal(hf(1)),()=>{x.assign(u8(w))}),hb(l.equal(hf(2)),()=>{x.assign(vj(w,p,hf(0)))}),hb(l.equal(hf(3)),()=>{x.assign(va(w,t,u,v))}),x.assign(x.mul(r.sub(q)).add(q)),hb(s,()=>{x.assign(jH(x,q,r))}),x}).setLayout({name:"mx_unifiednoise3d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"position",type:"vec3"},{name:"freq",type:"vec3"},{name:"offset",type:"vec3"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),vm=fu(([a])=>{let b=a.y,c=a.z,d=hm().toVar();return hb(b.lessThan(1e-4),()=>{d.assign(hm(c,c,c))}).Else(()=>{let e=a.x,f=hf(jl(e=e.sub(i2(e)).mul(6).toVar())),g=e.sub(he(f)),h=c.mul(b.oneMinus()),i=c.mul(b.mul(g).oneMinus()),j=c.mul(b.mul(g.oneMinus()).oneMinus());hb(f.equal(hf(0)),()=>{d.assign(hm(c,j,h))}).ElseIf(f.equal(hf(1)),()=>{d.assign(hm(i,c,h))}).ElseIf(f.equal(hf(2)),()=>{d.assign(hm(h,c,j))}).ElseIf(f.equal(hf(3)),()=>{d.assign(hm(h,i,c))}).ElseIf(f.equal(hf(4)),()=>{d.assign(hm(j,h,c))}).Else(()=>{d.assign(hm(c,h,i))})}),d}).setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]}),vn=fu(([a])=>{let b=hm(a).toVar(),c=he(b.x).toVar(),d=he(b.y).toVar(),e=he(b.z).toVar(),f=he(jr(c,jr(d,e))).toVar(),g=he(js(c,js(d,e))).toVar(),h=he(g.sub(f)).toVar(),i=he().toVar(),j=he().toVar(),k=he().toVar();return k.assign(g),hb(g.greaterThan(0),()=>{j.assign(h.div(g))}).Else(()=>{j.assign(0)}),hb(j.lessThanEqual(0),()=>{i.assign(0)}).Else(()=>{hb(c.greaterThanEqual(g),()=>{i.assign(d.sub(e).div(h))}).ElseIf(d.greaterThanEqual(g),()=>{i.assign(im(2,e.sub(c).div(h)))}).Else(()=>{i.assign(im(4,c.sub(d).div(h)))}),i.mulAssign(1/6),hb(i.lessThan(0),()=>{i.addAssign(1)})}),hm(i,j,k)}).setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]}),vo=fu(([a])=>{let b=hm(a).toVar(),c=hp(iv(b,hm(.04045))).toVar();return jG(hm(b.div(12.92)).toVar(),hm(jz(js(b.add(hm(.055)),hm(0)).div(1.055),hm(2.4))).toVar(),c)}).setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),vp=(a,b)=>{a=he(a);let c=hi((b=he(b)).dFdx(),b.dFdy()).length().mul(.7071067811865476);return jK(a.sub(c),a.add(c),b)},vq=(a,b,c,d)=>jG(a,b,c[d].clamp()),vr=(a,b,c=kJ())=>vq(a,b,c,"x"),vs=(a,b,c=kJ())=>vq(a,b,c,"y"),vt=(a,b,c,d,e=kJ())=>{let f=e.x.clamp(),g=e.y.clamp();return jG(jG(a,b,f),jG(c,d,f),g)},vu=(a,b,c,d,e)=>jG(a,b,vp(c,d[e])),vv=(a,b,c,d=kJ())=>vu(a,b,c,d,"x"),vw=(a,b,c,d=kJ())=>vu(a,b,c,d,"y"),vx=(a=1,b=0,c=kJ())=>c.mul(a).add(b),vy=(a,b=1)=>(a=he(a)).abs().pow(b).mul(a.sign()),vz=(a,b=1,c=.5)=>he(a).sub(c).mul(b).add(c),vA=(a=kJ(),b=1,c=0)=>u5(a.convert("vec2|vec3")).mul(b).add(c),vB=(a=kJ(),b=1,c=0)=>u6(a.convert("vec2|vec3")).mul(b).add(c),vC=(a=kJ(),b=1,c=0)=>hq(u6(a=a.convert("vec2|vec3")),u5(a.add(hi(19,73)))).mul(b).add(c),vD=(a,b=kJ(),c=hi(1,1),d=hi(0,0),e=1,f=0,g=1,h=!1,i=1,j=2,k=.5)=>vk(a,b.convert("vec2|vec3"),c,d,e,f,g,h,i,j,k),vE=(a,b=kJ(),c=hi(1,1),d=hi(0,0),e=1,f=0,g=1,h=!1,i=1,j=2,k=.5)=>vl(a,b.convert("vec2|vec3"),c,d,e,f,g,h,i,j,k),vF=(a=kJ(),b=1)=>vh(a.convert("vec2|vec3"),b,hf(1)),vG=(a=kJ(),b=1)=>vi(a.convert("vec2|vec3"),b,hf(1)),vH=(a=kJ(),b=1)=>vj(a.convert("vec2|vec3"),b,hf(1)),vI=(a=kJ())=>u7(a.convert("vec2|vec3")),vJ=(a=kJ(),b=3,c=2,d=.5,e=1)=>u9(a,hf(b),c,d).mul(e),vK=(a=kJ(),b=3,c=2,d=.5,e=1)=>vb(a,hf(b),c,d).mul(e),vL=(a=kJ(),b=3,c=2,d=.5,e=1)=>va(a,hf(b),c,d).mul(e),vM=(a=kJ(),b=3,c=2,d=.5,e=1)=>vc(a,hf(b),c,d).mul(e),vN=(a,b=he(0))=>im(a,b),vO=(a,b=he(0))=>io(a,b),vP=(a,b=he(1))=>ip(a,b),vQ=(a,b=he(1))=>iq(a,b),vR=(a,b=he(1))=>ir(a,b),vS=(a,b=he(1))=>jz(a,b),vT=(a=he(0),b=he(1))=>jb(a,b),vU=()=>rx,vV=()=>rz,vW=(a,b=he(1))=>io(b,a),vX=(a,b,c,d)=>a.greaterThan(b).mix(c,d),vY=(a,b,c,d)=>a.greaterThanEqual(b).mix(c,d),vZ=(a,b,c,d)=>a.equal(b).mix(c,d),v$=(a,b=null)=>{if("string"==typeof b){let c={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3},d=b.replace(/^out/,"").toLowerCase();if(void 0!==c[d])return a.element(c[d])}if("number"==typeof b)return a.element(b);if("string"==typeof b&&1===b.length){let c={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3};if(void 0!==c[b])return a.element(c[b])}return a},v_=(a,b=hi(.5,.5),c=hi(1,1),d=he(0),e=hi(0,0))=>{let f=a;if(b&&(f=f.sub(b)),c&&(f=f.mul(c)),d){let a=d.mul(Math.PI/180),b=a.cos(),c=a.sin();f=hi(f.x.mul(b).sub(f.y.mul(c)),f.x.mul(c).add(f.y.mul(b)))}return b&&(f=f.add(b)),e&&(f=f.add(e)),f},v0=(a,b)=>qw(a=hi(a),(b=he(b)).mul(Math.PI/180)),v1=(a,b,c)=>{a=hm(a),b=he(b),c=hm(c);let d=b.mul(Math.PI/180),e=c.normalize(),f=d.cos(),g=d.sin(),h=he(1).sub(f);return a.mul(f).add(e.cross(a).mul(g)).add(e.mul(e.dot(a)).mul(h))},v2=(a,b)=>mO(a=hm(a),b=he(b)),v3=fu(([a,b,c])=>{let d=i4(a).toVar(),e=io(he(.5).mul(b.sub(c)),lJ).div(d).toVar(),f=io(he(-.5).mul(b.sub(c)),lJ).div(d).toVar(),g=hm().toVar();g.x=d.x.greaterThan(he(0)).select(e.x,f.x),g.y=d.y.greaterThan(he(0)).select(e.y,f.y),g.z=d.z.greaterThan(he(0)).select(e.z,f.z);let h=jr(g.x,g.y,g.z).toVar();return lJ.add(d.mul(h)).toVar().sub(c)}),v4=fu(([a,b])=>{let c=a.x,d=a.y,e=a.z,f=b.element(0).mul(.886227);return(f=(f=(f=(f=(f=(f=(f=f.add(b.element(1).mul(1.023328).mul(d))).add(b.element(2).mul(1.023328).mul(e))).add(b.element(3).mul(1.023328).mul(c))).add(b.element(4).mul(.858086).mul(c).mul(d))).add(b.element(5).mul(.858086).mul(d).mul(e))).add(b.element(6).mul(e.mul(e).mul(.743125).sub(.247708)))).add(b.element(7).mul(.858086).mul(c).mul(e))).add(b.element(8).mul(.429043).mul(ip(c,c).sub(ip(d,d))))}),v5=Object.freeze({__proto__:null,BRDF_GGX:o2,BRDF_Lambert:oP,BasicPointShadowFilter:uA,BasicShadowFilter:ui,Break:nO,Const:j_,Continue:nN,DFGApprox:o5,D_GGX:o_,Discard:kz,EPSILON:iO,F_Schlick:oO,Fn:fu,HALF_PI:iT,INFINITY:iP,If:hb,Loop:nM,NodeAccess:gf,NodeShaderStage:gc,NodeType:ge,NodeUpdateType:gd,OnBeforeMaterialUpdate:si,OnBeforeObjectUpdate:sh,OnMaterialUpdate:sg,OnObjectUpdate:sf,PCFShadowFilter:uj,PCFSoftShadowFilter:uk,PI:iQ,PI2:iR,PointShadowFilter:uB,Return:kA,Schlick_to_F0:o8,ScriptableNodeResources:tc,ShaderNode:ft,Stack:fv,Switch:hc,TBNViewMatrix:mH,TWO_PI:iS,VSMShadowFilter:ul,V_GGX_SmithCorrelated:oZ,Var:j$,VarIntent:j0,abs:jc,acesFilmicToneMapping:sW,acos:ja,add:im,addMethodChaining:fr,addNodeElement:fz,agxToneMapping:s$,all:iU,alphaT:hR,and:iy,anisotropy:hS,anisotropyB:hU,anisotropyT:hT,any:iV,append:hC,array:ig,arrayBuffer:hy,asin:i9,assign:ih,atan:jb,atan2:jQ,atomicAdd:tD,atomicAnd:tH,atomicFunc:tA,atomicLoad:tB,atomicMax:tF,atomicMin:tG,atomicOr:tI,atomicStore:tC,atomicSub:tE,atomicXor:tJ,attenuationColor:h4,attenuationDistance:h3,attribute:kI,attributeArray:sl,backgroundBlurriness:sr,backgroundIntensity:ss,backgroundRotation:st,batch:nC,bentNormalView:mK,billboarding:rG,bitAnd:iC,bitNot:iD,bitOr:iE,bitXor:iF,bitangentGeometry:mD,bitangentLocal:mE,bitangentView:mF,bitangentWorld:mG,bitcast:ri,blendBurn:oi,blendColor:om,blendDodge:oj,blendOverlay:ol,blendScreen:ok,blur:pZ,bool:hh,buffer:kW,bufferAttribute:kk,builtin:k$,bumpMap:mO,burn:op,bvec2:hl,bvec3:hp,bvec4:ht,bypass:kt,cache:fx,call:ij,cameraFar:ld,cameraIndex:lb,cameraNear:lc,cameraNormalMatrix:li,cameraPosition:lj,cameraProjectionMatrix:le,cameraProjectionMatrixInverse:lf,cameraViewMatrix:lg,cameraViewport:lk,cameraWorldMatrix:lh,cbrt:jE,cdl:sH,ceil:i3,checker:uM,cineonToneMapping:sU,clamp:jH,clearcoat:hK,clearcoatNormalView:lX,clearcoatRoughness:hL,code:s1,color:hd,colorSpaceToWorking:ka,colorToDirection:oB,compute:kq,computeKernel:kp,computeSkinning:nK,context:jV,convert:hA,convertColorSpace:kb,convertToTexture:r6,cos:i7,cross:jy,cubeTexture:mc,cubeTextureBase:mb,cubeToUV:uz,dFdx:jh,dFdy:ji,dashSize:hZ,debug:kE,decrement:iL,decrementBefore:iJ,defaultBuildStages:gh,defaultShaderStages:gg,defined:g$,degrees:iX,deltaTime:ry,densityFog:fS,densityFogFactor:tf,depth:n9,depthPass:sP,determinant:jo,difference:jw,diffuseColor:hG,directPointLight:uK,directionToColor:oA,directionToFaceDirection:lP,dispersion:h5,distance:jv,div:iq,dodge:oq,dot:jx,drawIndex:ny,dynamicBufferAttribute:kl,element:hz,emissive:hH,equal:is,equals:jq,equirectUV:oE,exp:iY,exp2:iZ,expression:ky,faceDirection:lO,faceForward:jL,faceforward:jR,float:he,floatBitsToInt:rj,floatBitsToUint:rk,floor:i2,fog:tg,fract:i5,frameGroup:h9,frameId:rz,frontFacing:lN,fwidth:jm,gain:rp,gapSize:h$,getConstNodeType:g_,getCurrentStack:ha,getDirection:pV,getDistanceAttenuation:uJ,getGeometryRoughness:oX,getNormalFromDepth:r9,getParallaxCorrectNormal:v3,getRoughness:oY,getScreenPosition:r8,getShIrradianceAt:v4,getShadowMaterial:un,getShadowRenderObjectFunction:uq,getTextureIndex:fN,getViewPosition:r7,ggxConvolution:p1,globalId:to,glsl:s4,glslFn:s7,grayscale:sC,greaterThan:iv,greaterThanEqual:ix,hash:rn,highpModelNormalViewMatrix:lF,highpModelViewMatrix:lE,hue:sF,increment:iK,incrementBefore:iI,inspector:fy,instance:nA,instanceIndex:nu,instancedArray:sm,instancedBufferAttribute:km,instancedDynamicBufferAttribute:kn,instancedMesh:nB,int:hf,intBitsToFloat:rl,interleavedGradientNoise:sa,inverse:jp,inverseSqrt:i1,inversesqrt:jS,invocationLocalIndex:nx,invocationSubgroupIndex:nw,ior:h0,iridescence:hO,iridescenceIOR:hP,iridescenceThickness:hQ,isolate:ks,ivec2:hj,ivec3:hn,ivec4:hr,js:s2,label:fw,length:je,lengthSq:jF,lessThan:iu,lessThanEqual:iw,lightPosition:fW,lightProjectionUV:fV,lightShadowMatrix:fU,lightTargetDirection:t9,lightTargetPosition:fX,lightViewPosition:fY,lightingContext:nV,lights:ue,linearDepth:oa,linearToneMapping:sS,localId:tp,log:i$,log2:i_,logarithmicDepthToViewZ:n7,luminance:sG,mat2:hu,mat3:hv,mat4:hw,matcapUV:qt,materialAO:np,materialAlphaTest:mR,materialAnisotropy:m8,materialAnisotropyVector:nq,materialAttenuationColor:ng,materialAttenuationDistance:nf,materialClearcoat:m2,materialClearcoatNormal:m4,materialClearcoatRoughness:m3,materialColor:mS,materialDispersion:nn,materialEmissive:mU,materialEnvIntensity:l4,materialEnvRotation:l5,materialIOR:ne,materialIridescence:m9,materialIridescenceIOR:na,materialIridescenceThickness:nb,materialLightMap:no,materialLineDashOffset:nl,materialLineDashSize:ni,materialLineGapSize:nj,materialLineScale:nh,materialLineWidth:nk,materialMetalness:m0,materialNormal:m1,materialOpacity:mV,materialPointSize:nm,materialReference:mj,materialReflectivity:m$,materialRefractionRatio:l3,materialRotation:m5,materialRoughness:m_,materialSheen:m6,materialSheenRoughness:m7,materialShininess:mT,materialSpecular:mW,materialSpecularColor:mY,materialSpecularIntensity:mX,materialSpecularStrength:mZ,materialThickness:nd,materialTransmission:nc,max:js,maxMipLevel:kL,mediumpModelViewMatrix:lD,metalness:hJ,min:jr,mix:jG,mixElement:jN,mod:ir,modInt:iM,modelDirection:lu,modelNormalMatrix:lA,modelPosition:lw,modelRadius:lz,modelScale:lx,modelViewMatrix:lC,modelViewPosition:ly,modelViewProjection:nr,modelWorldMatrix:lv,modelWorldMatrixInverse:lB,morphReference:nS,mrt:rg,mul:ip,mx_aastep:vp,mx_add:vN,mx_atan2:vT,mx_cell_noise_float:vI,mx_contrast:vz,mx_divide:vQ,mx_fractal_noise_float:vJ,mx_fractal_noise_vec2:vK,mx_fractal_noise_vec3:vL,mx_fractal_noise_vec4:vM,mx_frame:vV,mx_heighttonormal:v2,mx_hsvtorgb:vm,mx_ifequal:vZ,mx_ifgreater:vX,mx_ifgreatereq:vY,mx_invert:vW,mx_modulo:vR,mx_multiply:vP,mx_noise_float:vA,mx_noise_vec3:vB,mx_noise_vec4:vC,mx_place2d:v_,mx_power:vS,mx_ramp4:vt,mx_ramplr:vr,mx_ramptb:vs,mx_rgbtohsv:vn,mx_rotate2d:v0,mx_rotate3d:v1,mx_safepower:vy,mx_separate:v$,mx_splitlr:vv,mx_splittb:vw,mx_srgb_texture_to_lin_rec709:vo,mx_subtract:vO,mx_timer:vU,mx_transform_uv:vx,mx_unifiednoise2d:vD,mx_unifiednoise3d:vE,mx_worley_noise_float:vF,mx_worley_noise_vec2:vG,mx_worley_noise_vec3:vH,negate:jf,neutralToneMapping:s_,nodeArray:g3,nodeImmutable:g5,nodeObject:g0,nodeObjectIntent:g1,nodeObjects:g2,nodeProxy:g4,nodeProxyIntent:g6,normalFlat:lS,normalGeometry:lQ,normalLocal:lR,normalMap:mL,normalView:lV,normalViewGeometry:lT,normalWorld:lW,normalWorldGeometry:lU,normalize:i4,not:iA,notEqual:it,numWorkgroups:tm,objectDirection:ln,objectGroup:ib,objectPosition:lp,objectRadius:ls,objectScale:lq,objectViewPosition:lr,objectWorldMatrix:lo,oneMinus:jg,or:iz,orthographicDepthToViewZ:n3,oscSawtooth:rD,oscSine:rA,oscSquare:rB,oscTriangle:rC,output:hY,outputStruct:rf,overlay:os,overloadingFn:rw,parabola:ro,parallaxDirection:mI,parallaxUV:mJ,parameter:q9,pass:sN,passTexture:sO,pcurve:rq,perspectiveDepthToViewZ:n5,pmremTexture:qg,pointShadow:uH,pointUV:sn,pointWidth:h_,positionGeometry:lG,positionLocal:lH,positionPrevious:lI,positionView:lL,positionViewDirection:lM,positionWorld:lJ,positionWorldDirection:lK,posterize:sI,pow:jz,pow2:jA,pow3:jB,pow4:jC,premultiplyAlpha:on,property:hE,quadBroadcast:t7,quadSwapDiagonal:t1,quadSwapX:t_,quadSwapY:t0,radians:iW,rand:jM,range:tj,rangeFog:fR,rangeFogFactor:te,reciprocal:jk,reference:mg,referenceBuffer:mh,reflect:ju,reflectVector:l8,reflectView:l6,reflector:r_,refract:jJ,refractVector:l9,refractView:l7,reinhardToneMapping:sT,remap:kv,remapClamp:kw,renderGroup:ia,renderOutput:kC,rendererReference:kf,rotate:qw,rotateUV:rE,roughness:hI,round:jj,rtt:r5,sRGBTransferEOTF:j5,sRGBTransferOETF:j6,sample:sc,sampler:kT,samplerComparison:kU,saturate:jI,saturation:sD,screen:or,screenCoordinate:k5,screenDPR:k2,screenSize:k4,screenUV:k3,scriptable:td,scriptableValue:s9,select:jT,setCurrentStack:g9,setName:jX,shaderStages:gi,shadow:ux,shadowPositionWorld:ug,shapeCircle:uN,sharedUniformGroup:h8,sheen:hM,sheenRoughness:hN,shiftLeft:iG,shiftRight:iH,shininess:hX,sign:jd,sin:i6,sinc:rr,skinning:nJ,smoothstep:jK,smoothstepElement:jO,specularColor:hV,specularF90:hW,spherizeUV:rF,split:hB,spritesheetUV:rI,sqrt:i0,stack:ra,step:jt,stepElement:jP,storage:nF,storageBarrier:tt,storageObject:nG,storageTexture:su,string:hx,struct:rd,sub:io,subBuild:j2,subgroupAdd:tN,subgroupAll:tY,subgroupAnd:tT,subgroupAny:tZ,subgroupBallot:tM,subgroupBroadcast:t2,subgroupBroadcastFirst:t$,subgroupElect:tL,subgroupExclusiveAdd:tP,subgroupExclusiveMul:tS,subgroupInclusiveAdd:tO,subgroupInclusiveMul:tR,subgroupIndex:nv,subgroupMax:tX,subgroupMin:tW,subgroupMul:tQ,subgroupOr:tU,subgroupShuffle:t3,subgroupShuffleDown:t6,subgroupShuffleUp:t5,subgroupShuffleXor:t4,subgroupSize:tq,subgroupXor:tV,tan:i8,tangentGeometry:my,tangentLocal:mz,tangentView:mA,tangentWorld:mB,texture:kP,texture3D:sx,textureBarrier:tu,textureBicubic:pr,textureBicubicLevel:pq,textureCubeUV:pW,textureLevel:kS,textureLoad:kR,textureSize:kK,textureStore:sv,thickness:h2,time:rx,toneMapping:kh,toneMappingExposure:ki,toonOutlinePass:sR,transformDirection:jD,transformNormal:lY,transformNormalToView:lZ,transformedClearcoatNormalView:l0,transformedNormalView:l$,transformedNormalWorld:l_,transmission:h1,transpose:jn,triNoise3D:ru,triplanarTexture:rK,triplanarTextures:rJ,trunc:jl,uint:hg,uintBitsToFloat:rm,uniform:id,uniformArray:kZ,uniformCubeTexture:md,uniformFlow:jW,uniformGroup:h7,uniformTexture:kQ,unpremultiplyAlpha:oo,userData:sz,uv:kJ,uvec2:hk,uvec3:ho,uvec4:hs,varying:j3,varyingProperty:hF,vec2:hi,vec3:hm,vec4:hq,vectorComponents:gj,velocity:sB,vertexColor:oh,vertexIndex:nt,vertexStage:j4,vibrance:sE,viewZToLogarithmicDepth:n6,viewZToOrthographicDepth:n2,viewZToPerspectiveDepth:n4,viewport:k6,viewportCoordinate:k8,viewportDepthTexture:n0,viewportLinearDepth:ob,viewportMipTexture:n$,viewportResolution:la,viewportSafeUV:rH,viewportSharedTexture:oz,viewportSize:k7,viewportTexture:nZ,viewportUV:k9,wgsl:s3,wgslFn:s8,workgroupArray:tx,workgroupBarrier:ts,workgroupId:tn,workingToColorSpace:j9,xor:iB}),v6=new q7,v7=class extends qM{constructor(a,b){super(),this.renderer=a,this.nodes=b}update(a,b,c){let d=this.renderer,e=this.nodes.getBackgroundNode(a)||a.background,f=!1;if(null===e)d._clearColor.getRGB(v6),v6.a=d._clearColor.a;else if(!0===e.isColor)e.getRGB(v6),v6.a=1,f=!0;else if(!0===e.isNode){let c=this.get(a);v6.copy(d._clearColor);let f=c.backgroundMesh;if(void 0===f){let a=function(){e.removeEventListener("dispose",a),f.material.dispose(),f.geometry.dispose()},b=jV(hq(e).mul(ss),{getUV:()=>st.mul(lU),getTextureLevel:()=>sr}),d=nr;d=d.setZ(d.w);let g=new ot;g.name="Background.material",g.side=1,g.depthTest=!1,g.depthWrite=!1,g.allowOverride=!1,g.fog=!1,g.lights=!1,g.vertexNode=d,g.colorNode=b,c.backgroundMeshNode=b,c.backgroundMesh=f=new dM(new eo(1,32,32),g),f.frustumCulled=!1,f.name="Background.mesh",f.onBeforeRender=function(a,b,c){this.matrixWorld.copyPosition(c.matrixWorld)},e.addEventListener("dispose",a)}let g=e.getCacheKey();c.backgroundCacheKey!==g&&(c.backgroundMeshNode.node=hq(e).mul(ss),c.backgroundMeshNode.needsUpdate=!0,f.material.needsUpdate=!0,c.backgroundCacheKey=g),b.unshift(f,f.geometry,f.material,0,0,null,null)}else J("Renderer: Unsupported background configuration.",e);let g=d.xr.getEnvironmentBlendMode();if("additive"===g?v6.set(0,0,0,1):"alpha-blend"===g&&v6.set(0,0,0,0),!0===d.autoClear||!0===f){let a=c.clearColorValue;a.r=v6.r,a.g=v6.g,a.b=v6.b,a.a=v6.a,(!0===d.backend.isWebGLBackend||!0===d.alpha)&&(a.r*=a.a,a.g*=a.a,a.b*=a.a),c.depthClearValue=d._clearDepth,c.stencilClearValue=d._clearStencil,c.clearColor=!0===d.autoClearColor,c.clearDepth=!0===d.autoClearDepth,c.clearStencil=!0===d.autoClearStencil}else c.clearColor=!1,c.clearDepth=!1,c.clearStencil=!1}},v8=0,v9=class{constructor(a="",b=[],c=0,d=[]){this.name=a,this.bindings=b,this.index=c,this.bindingsReference=d,this.id=v8++}},wa=class{constructor(a,b,c,d,e,f,g,h,i,j=[]){this.vertexShader=a,this.fragmentShader=b,this.computeShader=c,this.transforms=j,this.nodeAttributes=d,this.bindings=e,this.updateNodes=f,this.updateBeforeNodes=g,this.updateAfterNodes=h,this.observer=i,this.usedTimes=0}createBindings(){let a=[];for(let b of this.bindings)if(!0!==b.bindings[0].groupNode.shared){let c=new v9(b.name,[],b.index,b.bindingsReference);for(let d of(a.push(c),b.bindings))c.bindings.push(d.clone())}else a.push(b);return a}},wb=class{constructor(a,b,c=null){this.isNodeAttribute=!0,this.name=a,this.type=b,this.node=c}},wc=class{constructor(a,b,c){this.isNodeUniform=!0,this.name=a,this.type=b,this.node=c}get value(){return this.node.value}set value(a){this.node.value=a}get id(){return this.node.id}get groupNode(){return this.node.groupNode}},wd=class{constructor(a,b,c=!1,d=null){this.isNodeVar=!0,this.name=a,this.type=b,this.readOnly=c,this.count=d}},we=class extends wd{constructor(a,b,c=null,d=null){super(a,b),this.needsInterpolation=!1,this.isNodeVarying=!0,this.interpolationType=c,this.interpolationSampling=d}},wf=class{constructor(a,b,c=""){this.name=a,this.type=b,this.code=c,Object.defineProperty(this,"isNodeCode",{value:!0})}},wg=0,wh=class{constructor(a=null){this.id=wg++,this.nodesData=new WeakMap,this.parent=a}getData(a){let b=this.nodesData.get(a);return void 0===b&&null!==this.parent&&(b=this.parent.getData(a)),b}setData(a,b){this.nodesData.set(a,b)}},wi=class{constructor(a,b){this.name=a,this.members=b,this.output=!1}},wj=class{constructor(a,b){this.name=a,this.value=b,this.boundary=0,this.itemSize=0,this.offset=0}setValue(a){this.value=a}getValue(){return this.value}},wk=class extends wj{constructor(a,b=0){super(a,b),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}},wl=class extends wj{constructor(a,b=new bO){super(a,b),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}},wm=class extends wj{constructor(a,b=new bQ){super(a,b),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}},wn=class extends wj{constructor(a,b=new b3){super(a,b),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}},wo=class extends wj{constructor(a,b=new de){super(a,b),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}},wp=class extends wj{constructor(a,b=new fh){super(a,b),this.isMatrix2Uniform=!0,this.boundary=8,this.itemSize=4}},wq=class extends wj{constructor(a,b=new bT){super(a,b),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}},wr=class extends wj{constructor(a,b=new cx){super(a,b),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}},ws=class extends wk{constructor(a){super(a.name,a.value),this.nodeUniform=a}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}},wt=class extends wl{constructor(a){super(a.name,a.value),this.nodeUniform=a}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}},wu=class extends wm{constructor(a){super(a.name,a.value),this.nodeUniform=a}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}},wv=class extends wn{constructor(a){super(a.name,a.value),this.nodeUniform=a}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}},ww=class extends wo{constructor(a){super(a.name,a.value),this.nodeUniform=a}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}},wx=class extends wp{constructor(a){super(a.name,a.value),this.nodeUniform=a}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}},wy=class extends wq{constructor(a){super(a.name,a.value),this.nodeUniform=a}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}},wz=class extends wr{constructor(a){super(a.name,a.value),this.nodeUniform=a}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}},wA=0,wB=new WeakMap,wC=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),wD=a=>/e/g.test(a)?String(a).replace(/\+/g,""):(a=Number(a))+(a%1?"":".0"),wE=class{constructor(a,b,c){this.object=a,this.material=a&&a.material||null,this.geometry=a&&a.geometry||null,this.renderer=b,this.parser=c,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.types={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=ra(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new wh,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.subBuildLayers=[],this.activeStacks=[],this.subBuildFn=null,this.fnCall=null,Object.defineProperty(this,"id",{value:wA++})}isOpaque(){let a=this.material;return!1===a.transparent&&1===a.blending&&!1===a.alphaToCoverage}getBindGroupsCache(){let a=wB.get(this.renderer);return void 0===a&&(a=new qH,wB.set(this.renderer,a)),a}createRenderTarget(a,b,c){return new b4(a,b,c)}createCubeRenderTarget(a,b){return new oF(a,b)}includes(a){return this.nodes.includes(a)}getOutputStructName(){}_getBindGroup(a,b){let c,d=this.getBindGroupsCache(),e=[],f=!0;for(let a of b)e.push(a),f&&(f=!0!==a.groupNode.shared);return f?void 0===(c=d.get(e))&&(c=new v9(a,e,this.bindingsIndexes[a].group,e),d.set(e,c)):c=new v9(a,e,this.bindingsIndexes[a].group,e),c}getBindGroupArray(a,b){let c=this.bindings[b],d=c[a];return void 0===d&&(void 0===this.bindingsIndexes[a]&&(this.bindingsIndexes[a]={binding:0,group:Object.keys(this.bindingsIndexes).length}),c[a]=d=[]),d}getBindings(){let a=this.bindGroups;if(null===a){let b={},c=this.bindings;for(let a of gi)for(let d in c[a]){let e=c[a][d];(b[d]||(b[d]=[])).push(...e)}for(let c in a=[],b){let d=b[c],e=this._getBindGroup(c,d);a.push(e)}this.bindGroups=a}return a}sortBindingGroups(){let a=this.getBindings();a.sort((a,b)=>a.bindings[0].groupNode.order-b.bindings[0].groupNode.order);for(let b=0;b<a.length;b++){let c=a[b];this.bindingsIndexes[c.name].group=b,c.index=b}}setHashNode(a,b){this.hashNodes[b]=a}addNode(a){!1===this.nodes.includes(a)&&(this.nodes.push(a),this.setHashNode(a,a.getHash(this)))}addSequentialNode(a){!1===this.sequentialNodes.includes(a)&&this.sequentialNodes.push(a)}buildUpdateNodes(){for(let a of this.nodes)a.getUpdateType()!==gd.NONE&&this.updateNodes.push(a);for(let a of this.sequentialNodes){let b=a.getUpdateBeforeType(),c=a.getUpdateAfterType();b!==gd.NONE&&this.updateBeforeNodes.push(a),c!==gd.NONE&&this.updateAfterNodes.push(a)}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(a){return 1006===a.magFilter||1007===a.magFilter||1005===a.magFilter||1008===a.magFilter||1006===a.minFilter||1007===a.minFilter||1005===a.minFilter||1008===a.minFilter}addChain(a){this.chaining.push(a)}removeChain(a){if(this.chaining.pop()!==a)throw Error("NodeBuilder: Invalid node chaining!")}getMethod(a){return a}getTernary(){return null}getNodeFromHash(a){return this.hashNodes[a]}addFlow(a,b){return this.flowNodes[a].push(b),b}setContext(a){this.context=a}getContext(){return this.context}addContext(a){let b=this.getContext();return this.setContext({...this.context,...a}),b}getSharedContext(){return{...this.context},this.context}setCache(a){this.cache=a}getCache(){return this.cache}getCacheFromNode(a,b=!0){let c=this.getDataFromNode(a);return void 0===c.cache&&(c.cache=new wh(b?this.getCache():null)),c.cache}isAvailable(){return!1}getVertexIndex(){I("Abstract function.")}getInstanceIndex(){I("Abstract function.")}getDrawIndex(){I("Abstract function.")}getFrontFacing(){I("Abstract function.")}getFragCoord(){I("Abstract function.")}isFlipY(){return!1}increaseUsage(a){let b=this.getDataFromNode(a);return b.usageCount=void 0===b.usageCount?1:b.usageCount+1,b.usageCount}generateTexture(){I("Abstract function.")}generateTextureLod(){I("Abstract function.")}generateArrayDeclaration(a,b){return this.getType(a)+"[ "+b+" ]"}generateArray(a,b,c=null){let d=this.generateArrayDeclaration(a,b)+"( ";for(let e=0;e<b;e++){let f=c?c[e]:null;null===f?d+=this.generateConst(a):d+=f.build(this,a),e<b-1&&(d+=", ")}return d+" )"}generateStruct(a,b,c=null){let d=[];for(let a of b){let{name:b,type:e}=a;c&&c[b]&&c[b].isNode?d.push(c[b].build(this,e)):d.push(this.generateConst(e))}return a+"( "+d.join(", ")+" )"}generateConst(a,b=null){if(null===b&&("float"===a||"int"===a||"uint"===a?b=0:"bool"===a?b=!1:"color"===a?b=new de:"vec2"===a?b=new bO:"vec3"===a?b=new bQ:"vec4"===a&&(b=new b3)),"float"===a)return wD(b);if("int"===a)return`${Math.round(b)}`;if("uint"===a)return b>=0?`${Math.round(b)}u`:"0u";if("bool"===a)return b?"true":"false";if("color"===a)return`${this.getType("vec3")}( ${wD(b.r)}, ${wD(b.g)}, ${wD(b.b)} )`;let c=this.getTypeLength(a),d=this.getComponentType(a),e=a=>this.generateConst(d,a);if(2===c)return`${this.getType(a)}( ${e(b.x)}, ${e(b.y)} )`;if(3===c)return`${this.getType(a)}( ${e(b.x)}, ${e(b.y)}, ${e(b.z)} )`;if(4===c&&"mat2"!==a)return`${this.getType(a)}( ${e(b.x)}, ${e(b.y)}, ${e(b.z)}, ${e(b.w)} )`;if(c>=4&&b&&(b.isMatrix2||b.isMatrix3||b.isMatrix4))return`${this.getType(a)}( ${b.elements.map(e).join(", ")} )`;if(c>4)return`${this.getType(a)}()`;throw Error(`NodeBuilder: Type '${a}' not found in generate constant attempt.`)}getType(a){return"color"===a?"vec3":a}hasGeometryAttribute(a){return this.geometry&&void 0!==this.geometry.getAttribute(a)}getAttribute(a,b){let c=this.attributes;for(let b of c)if(b.name===a)return b;let d=new wb(a,b);return this.registerDeclaration(d),c.push(d),d}getPropertyName(a){return a.name}isVector(a){return/vec\d/.test(a)}isMatrix(a){return/mat\d/.test(a)}isReference(a){return"void"===a||"property"===a||"sampler"===a||"samplerComparison"===a||"texture"===a||"cubeTexture"===a||"storageTexture"===a||"depthTexture"===a||"texture3D"===a}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(a){let b=a.type;if(a.isDataTexture){if(1013===b)return"int";if(1014===b)return"uint"}return"float"}getElementType(a){return"mat2"===a?"vec2":"mat3"===a?"vec3":"mat4"===a?"vec4":this.getComponentType(a)}getComponentType(a){if("float"===(a=this.getVectorType(a))||"bool"===a||"int"===a||"uint"===a)return a;let b=/(b|i|u|)(vec|mat)([2-4])/.exec(a);return null===b?null:"b"===b[1]?"bool":"i"===b[1]?"int":"u"===b[1]?"uint":"float"}getVectorType(a){return"color"===a?"vec3":"texture"===a||"cubeTexture"===a||"storageTexture"===a||"texture3D"===a?"vec4":a}getTypeFromLength(a,b="float"){if(1===a)return b;let c=ga.get(a),d="float"===b?"":b[0];return!0===/mat2/.test(b)&&(c=c.replace("vec","mat")),d+c}getTypeFromArray(a){return wC.get(a.constructor)}isInteger(a){return/int|uint|(i|u)vec/.test(a)}getTypeFromAttribute(a){let b=a;a.isInterleavedBufferAttribute&&(b=a.data);let c=b.array,d=a.itemSize,e=a.normalized,f;return a instanceof dr||!0===e||(f=this.getTypeFromArray(c)),this.getTypeFromLength(d,f)}getTypeLength(a){let b=this.getVectorType(a),c=/vec([2-4])/.exec(b);return null===c?"float"===b||"bool"===b||"int"===b||"uint"===b?1:!0===/mat2/.test(a)?4:!0===/mat3/.test(a)?9:16*(!0===/mat4/.test(a)):Number(c[1])}getVectorFromMatrix(a){return a.replace("mat","vec")}changeComponentType(a,b){return this.getTypeFromLength(this.getTypeLength(a),b)}getIntegerType(a){let b=this.getComponentType(a);return"int"===b||"uint"===b?a:this.changeComponentType(a,"int")}setActiveStack(a){this.activeStacks.push(a)}removeActiveStack(a){if(this.activeStacks[this.activeStacks.length-1]===a)this.activeStacks.pop();else throw Error("NodeBuilder: Invalid active stack removal.")}getActiveStack(){return this.activeStacks[this.activeStacks.length-1]}getBaseStack(){return this.activeStacks[0]}addStack(){this.stack=ra(this.stack);let a=ha();return this.stacks.push(a),g9(this.stack),this.stack}removeStack(){let a=this.stack;for(let b of a.nodes)this.getDataFromNode(b).stack=a;return this.stack=a.parent,g9(this.stacks.pop()),a}getDataFromNode(a,b=this.shaderStage,c=null){let d=(c=null===c?a.isGlobal(this)?this.globalCache:this.cache:c).getData(a);void 0===d&&(d={},c.setData(a,d)),void 0===d[b]&&(d[b]={});let e=d[b],f=d.any?d.any.subBuilds:null,g=this.getClosestSubBuild(f);return g&&(void 0===e.subBuildsCache&&(e.subBuildsCache={}),(e=e.subBuildsCache[g]||(e.subBuildsCache[g]={})).subBuilds=f),e}getNodeProperties(a,b="any"){let c=this.getDataFromNode(a,b);return c.properties||(c.properties={outputNode:null})}getBufferAttributeFromNode(a,b){let c=this.getDataFromNode(a),d=c.bufferAttribute;return void 0===d&&(d=new wb("nodeAttribute"+this.uniforms.index++,b,a),this.bufferAttributes.push(d),c.bufferAttribute=d),d}getStructTypeNode(a,b=this.shaderStage){return this.types[b][a]||null}getStructTypeFromNode(a,b,c=null,d=this.shaderStage){let e=this.getDataFromNode(a,d,this.globalCache),f=e.structType;if(void 0===f){let g=this.structs.index++;null===c&&(c="StructType"+g),f=new wi(c,b),this.structs[d].push(f),this.types[d][c]=a,e.structType=f}return f}getOutputStructTypeFromNode(a,b){let c=this.getStructTypeFromNode(a,b,"OutputType","fragment");return c.output=!0,c}getUniformFromNode(a,b,c=this.shaderStage,d=null){let e=this.getDataFromNode(a,c,this.globalCache),f=e.uniform;if(void 0===f){let g=this.uniforms.index++;f=new wc(d||"nodeUniform"+g,b,a),this.uniforms[c].push(f),this.registerDeclaration(f),e.uniform=f}return f}getVarFromNode(a,b=null,c=a.getNodeType(this),d=this.shaderStage,e=!1){let f=this.getDataFromNode(a,d),g=this.getSubBuildProperty("variable",f.subBuilds),h=f[g];if(void 0===h){let i=e?"_const":"_var",j=this.vars[d]||(this.vars[d]=[]),k=this.vars[i]||(this.vars[i]=0);null===b&&(b=(e?"nodeConst":"nodeVar")+k,this.vars[i]++),"variable"!==g&&(b=this.getSubBuildProperty(b,f.subBuilds));let l=a.getArrayCount(this);h=new wd(b,c,e,l),e||j.push(h),this.registerDeclaration(h),f[g]=h}return h}isDeterministic(a){if(a.isMathNode)return this.isDeterministic(a.aNode)&&(!a.bNode||this.isDeterministic(a.bNode))&&(!a.cNode||this.isDeterministic(a.cNode));if(a.isOperatorNode)return this.isDeterministic(a.aNode)&&(!a.bNode||this.isDeterministic(a.bNode));if(a.isArrayNode){if(null!==a.values){for(let b of a.values)if(!this.isDeterministic(b))return!1}return!0}return!!a.isConstNode}getVaryingFromNode(a,b=null,c=a.getNodeType(this),d=null,e=null){let f=this.getDataFromNode(a,"any"),g=this.getSubBuildProperty("varying",f.subBuilds),h=f[g];if(void 0===h){let a=this.varyings,i=a.length;null===b&&(b="nodeVarying"+i),"varying"!==g&&(b=this.getSubBuildProperty(b,f.subBuilds)),h=new we(b,c,d,e),a.push(h),this.registerDeclaration(h),f[g]=h}return h}registerDeclaration(a){let b=this.shaderStage,c=this.declarations[b]||(this.declarations[b]={}),d=this.getPropertyName(a),e=1,f=d;for(;void 0!==c[f];)f=d+"_"+e++;e>1&&(a.name=f,I(`TSL: Declaration name '${d}' of '${a.type}' already in use. Renamed to '${f}'.`)),c[f]=a}getCodeFromNode(a,b,c=this.shaderStage){let d=this.getDataFromNode(a),e=d.code;if(void 0===e){let a=this.codes[c]||(this.codes[c]=[]);e=new wf("nodeCode"+a.length,b),a.push(e),d.code=e}return e}addFlowCodeHierarchy(a,b){let{flowCodes:c,flowCodeBlock:d}=this.getDataFromNode(a),e=!0,f=b;for(;f;){if(!0===d.get(f)){e=!1;break}f=this.getDataFromNode(f).parentNodeBlock}if(e)for(let a of c)this.addLineFlowCode(a)}addLineFlowCodeBlock(a,b,c){let d=this.getDataFromNode(a),e=d.flowCodes||(d.flowCodes=[]),f=d.flowCodeBlock||(d.flowCodeBlock=new WeakMap);e.push(b),f.set(c,!0)}addLineFlowCode(a,b=null){return""===a||(null!==b&&this.context.nodeBlock&&this.addLineFlowCodeBlock(b,a,this.context.nodeBlock),a=this.tab+a,/;\s*$/.test(a)||(a+=`;
`),this.flow.code+=a),this}addFlowCode(a){return this.flow.code+=a,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(a){return this.flowsData.get(a)}flowNode(a){let b=a.getNodeType(this),c=this.flowChildNode(a,b);return this.flowsData.set(a,c),c}addInclude(a){null!==this.currentFunctionNode&&this.currentFunctionNode.includes.push(a)}buildFunctionNode(a){let b=new s5,c=this.currentFunctionNode;return this.currentFunctionNode=b,b.code=this.buildFunctionCode(a),this.currentFunctionNode=c,b}flowShaderNode(a){let b=a.layout,c={[Symbol.iterator](){let a=0,b=Object.values(this);return{next:()=>({value:b[a],done:a++>=b.length})}}};for(let a of b.inputs)c[a.name]=new q8(a.type,a.name);a.layout=null;let d=a.call(c),e=this.flowStagesNode(d,b.type);return a.layout=b,e}flowBuildStage(a,b,c=null){let d=this.getBuildStage();this.setBuildStage(b);let e=a.build(this,c);return this.setBuildStage(d),e}flowStagesNode(a,b=null){let c=this.flow,d=this.vars,e=this.declarations,f=this.cache,g=this.buildStage,h=this.stack,i={code:""};for(let c of(this.flow=i,this.vars={},this.declarations={},this.cache=new wh,this.stack=ra(),gh))this.setBuildStage(c),i.result=a.build(this,b);return i.vars=this.getVars(this.shaderStage),this.flow=c,this.vars=d,this.declarations=e,this.cache=f,this.stack=h,this.setBuildStage(g),i}getFunctionOperator(){return null}buildFunctionCode(){I("Abstract function.")}flowChildNode(a,b=null){let c=this.flow,d={code:""};return this.flow=d,d.result=a.build(this,b),this.flow=c,d}flowNodeFromShaderStage(a,b,c=null,d=null){let e=this.tab,f=this.cache,g=this.shaderStage,h=this.context;this.setShaderStage(a);let i={...this.context};delete i.nodeBlock,this.cache=this.globalCache,this.tab="	",this.context=i;let j=null;if("generate"===this.buildStage){let e=this.flowChildNode(b,c);null!==d&&(e.code+=`${this.tab+d} = ${e.result};
`),this.flowCode[a]=this.flowCode[a]+e.code,j=e}else j=b.build(this);return this.setShaderStage(g),this.cache=f,this.tab=e,this.context=h,j}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){I("Abstract function.")}getVaryings(){I("Abstract function.")}getVar(a,b,c=null){return`${null===c?this.getType(a):this.generateArrayDeclaration(a,c)} ${b}`}getVars(a){let b="",c=this.vars[a];if(void 0!==c)for(let a of c)b+=`${this.getVar(a.type,a.name)}; `;return b}getUniforms(){I("Abstract function.")}getCodes(a){let b=this.codes[a],c="";if(void 0!==b)for(let a of b)c+=a.code+`
`;return c}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(a){this.shaderStage=a}getShaderStage(){return this.shaderStage}setBuildStage(a){this.buildStage=a}getBuildStage(){return this.buildStage}buildCode(){I("Abstract function.")}get subBuild(){return this.subBuildLayers[this.subBuildLayers.length-1]||null}addSubBuild(a){this.subBuildLayers.push(a)}removeSubBuild(){return this.subBuildLayers.pop()}getClosestSubBuild(a){let b;if(!(b=a&&a.isNode?a.isShaderCallNodeInternal?a.shaderNode.subBuilds:a.isStackNode?[a.subBuild]:this.getDataFromNode(a,"any").subBuilds:a instanceof Set?[...a]:a))return null;let c=this.subBuildLayers;for(let a=b.length-1;a>=0;a--){let d=b[a];if(c.includes(d))return d}return null}getSubBuildOutput(a){return this.getSubBuildProperty("outputNode",a)}getSubBuildProperty(a="",b=null){let c;return(c=null===b?this.subBuildFn:this.getClosestSubBuild(b))?a?c+"_"+a:c:a}build(){let{object:a,material:b,renderer:c}=this;if(null!==b){let a=c.library.fromMaterial(b);null===a&&(J(`NodeMaterial: Material "${b.type}" is not compatible.`),a=new ot),a.build(this)}else this.addFlow("compute",a);for(let a of gh)for(let b of(this.setBuildStage(a),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex),gi))for(let c of(this.setShaderStage(b),this.flowNodes[b]))"generate"===a?this.flowNode(c):c.build(this);return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(a,b){if("float"===b||"int"===b||"uint"===b)return new ws(a);if("vec2"===b||"ivec2"===b||"uvec2"===b)return new wt(a);if("vec3"===b||"ivec3"===b||"uvec3"===b)return new wu(a);if("vec4"===b||"ivec4"===b||"uvec4"===b)return new wv(a);if("color"===b)return new ww(a);if("mat2"===b)return new wx(a);if("mat3"===b)return new wy(a);if("mat4"===b)return new wz(a);throw Error(`Uniform "${b}" not declared.`)}format(a,b,c){if(b=this.getVectorType(b),c=this.getVectorType(c),b===c||null===c||this.isReference(c))return a;let d=this.getTypeLength(b),e=this.getTypeLength(c);return 16===d&&9===e?`${this.getType(c)}( ${a}[ 0 ].xyz, ${a}[ 1 ].xyz, ${a}[ 2 ].xyz )`:9===d&&4===e?`${this.getType(c)}( ${a}[ 0 ].xy, ${a}[ 1 ].xy )`:d>4||e>4||0===e?a:d===e?`${this.getType(c)}( ${a} )`:d>e?(a="bool"===c?`all( ${a} )`:`${a}.${"xyz".slice(0,e)}`,this.format(a,this.getTypeFromLength(e,this.getComponentType(b)),c)):4===e&&d>1?`${this.getType(c)}( ${this.format(a,b,"vec3")}, 1.0 )`:2===d?`${this.getType(c)}( ${this.format(a,b,"vec2")}, 0.0 )`:(1===d&&e>1&&b!==this.getComponentType(c)&&(a=`${this.getType(this.getComponentType(c))}( ${a} )`),`${this.getType(c)}( ${a} )`)}getSignature(){return`// Three.js r181 - Node System
`}},wF=class{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(a,b){let c=a.get(b);return void 0===c&&(c={renderId:0,frameId:0},a.set(b,c)),c}updateBeforeNode(a){let b=a.getUpdateBeforeType(),c=a.updateReference(this);if(b===gd.FRAME){let b=this._getMaps(this.updateBeforeMap,c);b.frameId!==this.frameId&&!1!==a.updateBefore(this)&&(b.frameId=this.frameId)}else if(b===gd.RENDER){let b=this._getMaps(this.updateBeforeMap,c);b.renderId!==this.renderId&&!1!==a.updateBefore(this)&&(b.renderId=this.renderId)}else b===gd.OBJECT&&a.updateBefore(this)}updateAfterNode(a){let b=a.getUpdateAfterType(),c=a.updateReference(this);if(b===gd.FRAME){let b=this._getMaps(this.updateAfterMap,c);b.frameId!==this.frameId&&!1!==a.updateAfter(this)&&(b.frameId=this.frameId)}else if(b===gd.RENDER){let b=this._getMaps(this.updateAfterMap,c);b.renderId!==this.renderId&&!1!==a.updateAfter(this)&&(b.renderId=this.renderId)}else b===gd.OBJECT&&a.updateAfter(this)}updateNode(a){let b=a.getUpdateType(),c=a.updateReference(this);if(b===gd.FRAME){let b=this._getMaps(this.updateMap,c);b.frameId!==this.frameId&&!1!==a.update(this)&&(b.frameId=this.frameId)}else if(b===gd.RENDER){let b=this._getMaps(this.updateMap,c);b.renderId!==this.renderId&&!1!==a.update(this)&&(b.renderId=this.renderId)}else b===gd.OBJECT&&a.update(this)}update(){this.frameId++,void 0===this.lastTime&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}},(wG=class{constructor(a,b,c=null,d="",e=!1){this.type=a,this.name=b,this.count=c,this.qualifier=d,this.isConst=e}}).isNodeFunctionInput=!0,wH=class extends uI{static get type(){return"DirectionalLightNode"}constructor(a=null){super(a)}setupDirect(){let a=this.colorNode;return{lightDirection:t9(this.light),lightColor:a}}},wI=new cx,wJ=new cx,wK=null,wL=class extends uI{static get type(){return"RectAreaLightNode"}constructor(a=null){super(a),this.halfHeight=id(new bQ).setGroup(ia),this.halfWidth=id(new bQ).setGroup(ia),this.updateType=gd.RENDER}update(a){super.update(a);let{light:b}=this,c=a.camera.matrixWorldInverse;wJ.identity(),wI.copy(b.matrixWorld),wI.premultiply(c),wJ.extractRotation(wI),this.halfWidth.value.set(.5*b.width,0,0),this.halfHeight.value.set(0,.5*b.height,0),this.halfWidth.value.applyMatrix4(wJ),this.halfHeight.value.applyMatrix4(wJ)}setupDirectRectArea(a){let b,c;a.isAvailable("float32Filterable")?(b=kP(wK.LTC_FLOAT_1),c=kP(wK.LTC_FLOAT_2)):(b=kP(wK.LTC_HALF_1),c=kP(wK.LTC_HALF_2));let{colorNode:d,light:e}=this;return{lightColor:d,lightPosition:fY(e),halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:b,ltc_2:c}}static setLTC(a){wK=a}},wM=class extends uI{static get type(){return"SpotLightNode"}constructor(a=null){super(a),this.coneCosNode=id(0).setGroup(ia),this.penumbraCosNode=id(0).setGroup(ia),this.cutoffDistanceNode=id(0).setGroup(ia),this.decayExponentNode=id(0).setGroup(ia),this.colorNode=id(this.color).setGroup(ia)}update(a){super.update(a);let{light:b}=this;this.coneCosNode.value=Math.cos(b.angle),this.penumbraCosNode.value=Math.cos(b.angle*(1-b.penumbra)),this.cutoffDistanceNode.value=b.distance,this.decayExponentNode.value=b.decay}getSpotAttenuation(a,b){let{coneCosNode:c,penumbraCosNode:d}=this;return jK(c,d,b)}getLightCoord(a){let b=a.getNodeProperties(this),c=b.projectionUV;return void 0===c&&(b.projectionUV=c=fV(this.light,a.context.positionWorld)),c}setupDirect(a){let{colorNode:b,cutoffDistanceNode:c,decayExponentNode:d,light:e}=this,f=this.getLightVector(a),g=f.normalize(),h=g.dot(t9(e)),i=this.getSpotAttenuation(a,h),j=uJ({lightDistance:f.length(),cutoffDistance:c,decayExponent:d}),k=b.mul(i).mul(j),l,m;return e.colorNode?(m=this.getLightCoord(a),l=e.colorNode(m)):e.map&&(m=this.getLightCoord(a),l=kP(e.map,m.xy).onRenderUpdate(()=>e.map)),l&&(k=m.mul(2).sub(1).abs().lessThan(1).all().select(k.mul(l),k)),{lightColor:k,lightDirection:g}}},wN=class extends wM{static get type(){return"IESSpotLightNode"}getSpotAttenuation(a,b){let c=this.light.iesMap;return c&&!0===c.isTexture?kP(c,hi(b.acos().mul(1/Math.PI),0),0).r:super.getSpotAttenuation(b)}},wO=fu(([a,b])=>{let c=a.abs().sub(b);return je(js(c,0)).add(jr(js(c.x,c.y),0))}),wP=class extends wM{static get type(){return"ProjectorLightNode"}update(a){super.update(a);let b=this.light;if(this.penumbraCosNode.value=Math.min(Math.cos(b.angle*(1-b.penumbra)),.99999),null===b.aspect){let a=1;null!==b.map&&(a=b.map.width/b.map.height),b.shadow.aspect=a}else b.shadow.aspect=b.aspect}getSpotAttenuation(a){let b=he(0),c=this.penumbraCosNode,d=fU(this.light).mul(a.context.positionWorld||lJ);return hb(d.w.greaterThan(0),()=>{let a=wO(d.xyz.div(d.w).xy.sub(hi(.5)),hi(.5)),e=iq(-1,io(1,ja(c)).sub(1));b.assign(jI(a.mul(-2).mul(e)))}),b}},wQ=class extends uI{static get type(){return"AmbientLightNode"}constructor(a=null){super(a)}setup({context:a}){a.irradiance.addAssign(this.colorNode)}},wR=class extends uI{static get type(){return"HemisphereLightNode"}constructor(a=null){super(a),this.lightPositionNode=fW(a),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=id(new de).setGroup(ia)}update(a){let{light:b}=this;super.update(a),this.lightPositionNode.object3d=b,this.groundColorNode.value.copy(b.groundColor).multiplyScalar(b.intensity)}setup(a){let{colorNode:b,groundColorNode:c,lightDirectionNode:d}=this,e=jG(c,b,lW.dot(d).mul(.5).add(.5));a.context.irradiance.addAssign(e)}},wS=class extends uI{static get type(){return"LightProbeNode"}constructor(a=null){super(a);let b=[];for(let a=0;a<9;a++)b.push(new bQ);this.lightProbe=kZ(b)}update(a){let{light:b}=this;super.update(a);for(let a=0;a<9;a++)this.lightProbe.array[a].copy(b.sh.coefficients[a]).multiplyScalar(b.intensity)}setup(a){let b=v4(lW,this.lightProbe);a.context.irradiance.addAssign(b)}},wT=class{parseFunction(){I("Abstract function.")}},wU=class{constructor(a,b,c="",d=""){this.type=a,this.inputs=b,this.name=c,this.precision=d}getCode(){I("Abstract function.")}},wU.isNodeFunction=!0,wV=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,wW=/[a-z_0-9]+/gi,wX=class extends wU{constructor(a){let{type:b,inputs:c,name:d,precision:e,inputsCode:f,blockCode:g,headerCode:h}=(a=>{let b=(a=a.trim()).indexOf("#pragma main"),c=-1===b?a:a.slice(b+12),d=c.match(wV);if(null!==d&&5===d.length){let e=d[4],f=[],g=null;for(;null!==(g=wW.exec(e));)f.push(g);let h=[],i=0;for(;i<f.length;){let a="const"===f[i][0];!0===a&&i++;let b=f[i][0];"in"===b||"out"===b||"inout"===b?i++:b="";let c=f[i++][0],d=Number.parseInt(f[i][0]);!1===Number.isNaN(d)?i++:d=null;let e=f[i++][0];h.push(new wG(c,e,d,b,a))}let j=c.substring(d[0].length),k=void 0===d[3]?"":d[3];return{type:d[2],inputs:h,name:k,precision:void 0===d[1]?"":d[1],inputsCode:e,blockCode:j,headerCode:-1===b?"":a.slice(0,b)}}throw Error("FunctionNode: Function is not a GLSL code.")})(a);super(b,c,d,e),this.inputsCode=f,this.blockCode=g,this.headerCode=h}getCode(a=this.name){let b,c=this.blockCode;if(""!==c){let{type:d,inputsCode:e,headerCode:f,precision:g}=this,h=`${d} ${a} ( ${e.trim()} )`;""!==g&&(h=`${g} ${h}`),b=f+h+c}else b="";return b}},wY=class extends wT{parseFunction(a){return new wX(a)}},wZ=new WeakMap,w$=[],w_=[],w0=class extends qM{constructor(a,b){super(),this.renderer=a,this.backend=b,this.nodeFrame=new wF,this.nodeBuilderCache=new Map,this.callHashCache=new qH,this.groupsData=new qH,this.cacheLib={}}updateGroup(a){let b=a.groupNode,c=b.name;if(c===ib.name)return!0;if(c===ia.name){let b=this.get(a),c=this.nodeFrame.renderId;return b.renderId!==c&&(b.renderId=c,!0)}if(c===h9.name){let b=this.get(a),c=this.nodeFrame.frameId;return b.frameId!==c&&(b.frameId=c,!0)}w$[0]=b,w$[1]=a;let d=this.groupsData.get(w$);return void 0===d&&this.groupsData.set(w$,d={}),w$.length=0,d.version!==b.version&&(d.version=b.version,!0)}getForRenderCacheKey(a){return a.initialCacheKey}getForRender(a){let b=this.get(a),c=b.nodeBuilderState;if(void 0===c){let{nodeBuilderCache:d}=this,e=this.getForRenderCacheKey(a);if(void 0===(c=d.get(e))){let b=b=>{let c=this.backend.createNodeBuilder(a.object,this.renderer);return c.scene=a.scene,c.material=b,c.camera=a.camera,c.context.material=b,c.lightsNode=a.lightsNode,c.environmentNode=this.getEnvironmentNode(a.scene),c.fogNode=this.getFogNode(a.scene),c.clippingContext=a.clippingContext,this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview&&c.enableMultiview(),c},f=b(a.material);try{f.build()}catch(a){(f=b(new ot)).build(),J("TSL: "+a)}c=this._createNodeBuilderState(f),d.set(e,c)}c.usedTimes++,b.nodeBuilderState=c}return c}delete(a){if(a.isRenderObject){let b=this.get(a).nodeBuilderState;b.usedTimes--,0===b.usedTimes&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(a))}return super.delete(a)}getForCompute(a){let b=this.get(a),c=b.nodeBuilderState;if(void 0===c){let d=this.backend.createNodeBuilder(a,this.renderer);d.build(),b.nodeBuilderState=c=this._createNodeBuilderState(d)}return c}_createNodeBuilderState(a){return new wa(a.vertexShader,a.fragmentShader,a.computeShader,a.getAttributesArray(),a.getBindings(),a.updateNodes,a.updateBeforeNodes,a.updateAfterNodes,a.observer,a.transforms)}getEnvironmentNode(a){this.updateEnvironment(a);let b=null;if(a.environmentNode&&a.environmentNode.isNode)b=a.environmentNode;else{let c=this.get(a);c.environmentNode&&(b=c.environmentNode)}return b}getBackgroundNode(a){this.updateBackground(a);let b=null;if(a.backgroundNode&&a.backgroundNode.isNode)b=a.backgroundNode;else{let c=this.get(a);c.backgroundNode&&(b=c.backgroundNode)}return b}getFogNode(a){return this.updateFog(a),a.fogNode||this.get(a).fogNode||null}getCacheKey(a,b){w$[0]=a,w$[1]=b;let c=this.renderer.info.calls,d=this.callHashCache.get(w$)||{};if(d.callId!==c){let e=this.getEnvironmentNode(a),f=this.getFogNode(a);b&&w_.push(b.getCacheKey(!0)),e&&w_.push(e.getCacheKey()),f&&w_.push(f.getCacheKey()),w_.push(this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview?1:0),w_.push(+!!this.renderer.shadowMap.enabled),w_.push(this.renderer.shadowMap.type),d.callId=c,d.cacheKey=f9(w_),this.callHashCache.set(w$,d),w_.length=0}return w$.length=0,d.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(a){let b=this.get(a),c=a.background;if(c){let d=0===a.backgroundBlurriness&&b.backgroundBlurriness>0||a.backgroundBlurriness>0&&0===b.backgroundBlurriness;(b.background!==c||d)&&(b.backgroundNode=this.getCacheNode("background",c,()=>{if(!0===c.isCubeTexture||303===c.mapping||304===c.mapping||306===c.mapping)return a.backgroundBlurriness>0||306===c.mapping?qg(c):oH(!0===c.isCubeTexture?mc(c):kP(c));if(!0===c.isTexture)return kP(c,k3.flipY()).setUpdateMatrix(!0);!0!==c.isColor&&J("WebGPUNodes: Unsupported background configuration.",c)},d),b.background=c,b.backgroundBlurriness=a.backgroundBlurriness)}else b.backgroundNode&&(delete b.backgroundNode,delete b.background)}getCacheNode(a,b,c,d=!1){let e=this.cacheLib[a]||(this.cacheLib[a]=new WeakMap),f=e.get(b);return(void 0===f||d)&&(f=c(),e.set(b,f)),f}updateFog(a){let b=this.get(a),c=a.fog;c?b.fog!==c&&(b.fogNode=this.getCacheNode("fog",c,()=>c.isFogExp2?tg(mg("color","color",c).setGroup(ia),tf(mg("density","float",c).setGroup(ia))):c.isFog?tg(mg("color","color",c).setGroup(ia),te(mg("near","float",c).setGroup(ia),mg("far","float",c).setGroup(ia))):void J("Renderer: Unsupported fog configuration.",c)),b.fog=c):(delete b.fogNode,delete b.fog)}updateEnvironment(a){let b=this.get(a),c=a.environment;c?b.environment!==c&&(b.environmentNode=this.getCacheNode("environment",c,()=>!0===c.isCubeTexture?mc(c):!0===c.isTexture?kP(c):void J("Nodes: Unsupported environment configuration.",c)),b.environment=c):b.environmentNode&&(delete b.environmentNode,delete b.environment)}getNodeFrame(a=this.renderer,b=null,c=null,d=null,e=null){let f=this.nodeFrame;return f.renderer=a,f.scene=b,f.object=c,f.camera=d,f.material=e,f}getNodeFrameForRender(a){return this.getNodeFrame(a.renderer,a.scene,a.object,a.camera,a.material)}getOutputCacheKey(){let a=this.renderer;return a.toneMapping+","+a.currentColorSpace+","+a.xr.isPresenting}hasOutputChange(a){return wZ.get(a)!==this.getOutputCacheKey()}getOutputNode(a){let b=this.renderer,c=this.getOutputCacheKey(),d=a.isArrayTexture?sx(a,hm(k3,k$("gl_ViewID_OVR"))).renderOutput(b.toneMapping,b.currentColorSpace):kP(a,k3).renderOutput(b.toneMapping,b.currentColorSpace);return wZ.set(a,c),d}updateBefore(a){for(let b of a.getNodeBuilderState().updateBeforeNodes)this.getNodeFrameForRender(a).updateBeforeNode(b)}updateAfter(a){for(let b of a.getNodeBuilderState().updateAfterNodes)this.getNodeFrameForRender(a).updateAfterNode(b)}updateForCompute(a){let b=this.getNodeFrame();for(let c of this.getForCompute(a).updateNodes)b.updateNode(c)}updateForRender(a){let b=this.getNodeFrameForRender(a);for(let c of a.getNodeBuilderState().updateNodes)b.updateNode(c)}needsRefresh(a){let b=this.getNodeFrameForRender(a);return a.getMonitor().needsRefresh(a,b)}dispose(){super.dispose(),this.nodeFrame=new wF,this.nodeBuilderCache=new Map,this.cacheLib={}}},w1=new ea,w2=class a{constructor(a=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new bT,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,null!==a&&(this.viewNormalMatrix=a.viewNormalMatrix,this.clippingGroupContexts=a.clippingGroupContexts,this.shadowPass=a.shadowPass,this.viewMatrix=a.viewMatrix)}projectPlanes(a,b,c){let d=a.length;for(let e=0;e<d;e++){w1.copy(a[e]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);let d=b[c+e],f=w1.normal;d.x=-f.x,d.y=-f.y,d.z=-f.z,d.w=w1.constant}}updateGlobal(a,b){this.shadowPass=null!==a.overrideMaterial&&a.overrideMaterial.isShadowPassMaterial,this.viewMatrix=b.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(a,b){let c=!1;a.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(a.intersectionPlanes),this.unionPlanes=Array.from(a.unionPlanes),this.parentVersion=a.version),this.clipIntersection!==b.clipIntersection&&(this.clipIntersection=b.clipIntersection,this.clipIntersection?this.unionPlanes.length=a.unionPlanes.length:this.intersectionPlanes.length=a.intersectionPlanes.length);let d=b.clippingPlanes,e=d.length,f,g;if(this.clipIntersection?(f=this.intersectionPlanes,g=a.intersectionPlanes.length):(f=this.unionPlanes,g=a.unionPlanes.length),f.length!==g+e){f.length=g+e;for(let a=0;a<e;a++)f[g+a]=new b3;c=!0}this.projectPlanes(d,f,g),c&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(b){if(this.shadowPass&&!b.clipShadows)return this;let c=this.clippingGroupContexts.get(b);return void 0===c&&(c=new a(this),this.clippingGroupContexts.set(b,c)),c.update(this,b),c}get unionClippingCount(){return this.unionPlanes.length}},w3=class{constructor(a,b){this.bundleGroup=a,this.camera=b}},w4=[],w5=class{constructor(){this.bundles=new qH}get(a,b){let c=this.bundles;w4[0]=a,w4[1]=b;let d=c.get(w4);return void 0===d&&(d=new w3(a,b),c.set(w4,d)),w4.length=0,d}dispose(){this.bundles=new qH}},w6=class{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(a){if(a.isNodeMaterial)return a;let b=null,c=this.getMaterialNodeClass(a.type);if(null!==c)for(let d in b=new c,a)b[d]=a[d];return b}addToneMapping(a,b){this.addType(a,b,this.toneMappingNodes)}getToneMappingFunction(a){return this.toneMappingNodes.get(a)||null}getMaterialNodeClass(a){return this.materialNodes.get(a)||null}addMaterial(a,b){this.addType(a,b,this.materialNodes)}getLightNodeClass(a){return this.lightNodes.get(a)||null}addLight(a,b){this.addClass(a,b,this.lightNodes)}addType(a,b,c){if(c.has(b))return void I(`Redefinition of node ${b}`);if("function"!=typeof a)throw Error(`Node class ${a.name} is not a class.`);if("function"==typeof b||"object"==typeof b)throw Error(`Base class ${b} is not a class.`);c.set(b,a)}addClass(a,b,c){if(c.has(b))return void I(`Redefinition of node ${b.name}`);if("function"!=typeof a)throw Error(`Node class ${a.name} is not a class.`);if("function"!=typeof b)throw Error(`Base class ${b.name} is not a class.`);c.set(b,a)}},w7=new ud,w8=[],w9=class extends qH{constructor(){super()}createNode(a=[]){return new ud().setLights(a)}getNode(a,b){if(a.isQuadMesh)return w7;w8[0]=a,w8[1]=b;let c=this.get(w8);return void 0===c&&(c=this.createNode(),this.set(w8,c)),w8.length=0,c}},xa=class extends b4{constructor(a=1,b=1,c={}){super(a,b,c),this.isXRRenderTarget=!0,this._hasExternalTextures=!1,this._autoAllocateDepthBuffer=!0,this._isOpaqueFramebuffer=!1}copy(a){return super.copy(a),this._hasExternalTextures=a._hasExternalTextures,this._autoAllocateDepthBuffer=a._autoAllocateDepthBuffer,this._isOpaqueFramebuffer=a._isOpaqueFramebuffer,this}},xb=new bQ,xc=new bQ,xd=class extends bI{constructor(a,b=!1){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=a,this._cameraL=new dV,this._cameraL.viewport=new b3,this._cameraR=new dV,this._cameraR.viewport=new b3,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new e5,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._sessionUsesLayers=!1,this._supportsGlBinding="u">typeof XRWebGLBinding,this._frameBufferTargets=null,this._createXRLayer=f1.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new bO,this._onSessionEvent=f$.bind(this),this._onSessionEnd=f_.bind(this),this._onInputSourcesChange=f0.bind(this),this._onAnimationFrame=f2.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._supportsLayers=this._supportsGlBinding&&"createProjectionLayer"in XRWebGLBinding.prototype,this._useMultiviewIfPossible=b,this._useMultiview=!1}getController(a){return this._getController(a).getTargetRaySpace()}getControllerGrip(a){return this._getController(a).getGripSpace()}getHand(a){return this._getController(a).getHandSpace()}getFoveation(){if(null!==this._glProjLayer||null!==this._glBaseLayer)return this._foveation}setFoveation(a){this._foveation=a,null!==this._glProjLayer&&(this._glProjLayer.fixedFoveation=a),null!==this._glBaseLayer&&void 0!==this._glBaseLayer.fixedFoveation&&(this._glBaseLayer.fixedFoveation=a)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(a){this._framebufferScaleFactor=a,!0===this.isPresenting&&I("XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(a){this._referenceSpaceType=a,!0===this.isPresenting&&I("XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(a){this._customReferenceSpace=a}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(null!==this._session)return this._session.environmentBlendMode}getBinding(){return null===this._glBinding&&this._supportsGlBinding&&(this._glBinding=new XRWebGLBinding(this._session,this._gl)),this._glBinding}getFrame(){return this._xrFrame}useMultiview(){return this._useMultiview}createQuadLayer(a,b,c,d,e,f,g,h={}){let i=new en(a,b),j=new xa(e,f,{format:aO,type:az,depthTexture:new el(e,f,h.stencil?aJ:aE,void 0,void 0,void 0,void 0,void 0,void 0,h.stencil?aQ:aP),stencilBuffer:h.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});j._autoAllocateDepthBuffer=!0;let k=new di({color:0xffffff,side:0});k.map=j.texture,k.map.offset.y=1,k.map.repeat.y=-1;let l=new dM(i,k);l.position.copy(c),l.quaternion.copy(d);let m={type:"quad",width:a,height:b,translation:c,quaternion:d,pixelwidth:e,pixelheight:f,plane:l,material:k,rendercall:g,renderTarget:j};if(this._layers.push(m),null!==this._session){m.plane.material=new di({color:0xffffff,side:0}),m.plane.material.blending=5,m.plane.material.blendEquation=100,m.plane.material.blendSrc=200,m.plane.material.blendDst=200,m.xrlayer=this._createXRLayer(m);let a=this._session.renderState.layers;a.unshift(m.xrlayer),this._session.updateRenderState({layers:a})}else j.isXRRenderTarget=!1;return l}createCylinderLayer(a,b,c,d,e,f,g,h,i={}){let j=new em(a,a,a*b/c,64,64,!0,Math.PI-b/2,b),k=new xa(f,g,{format:aO,type:az,depthTexture:new el(f,g,i.stencil?aJ:aE,void 0,void 0,void 0,void 0,void 0,void 0,i.stencil?aQ:aP),stencilBuffer:i.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});k._autoAllocateDepthBuffer=!0;let l=new di({color:0xffffff,side:1});l.map=k.texture,l.map.offset.y=1,l.map.repeat.y=-1;let m=new dM(j,l);m.position.copy(d),m.quaternion.copy(e);let n={type:"cylinder",radius:a,centralAngle:b,aspectratio:c,translation:d,quaternion:e,pixelwidth:f,pixelheight:g,plane:m,material:l,rendercall:h,renderTarget:k};if(this._layers.push(n),null!==this._session){n.plane.material=new di({color:0xffffff,side:1}),n.plane.material.blending=5,n.plane.material.blendEquation=100,n.plane.material.blendSrc=200,n.plane.material.blendDst=200,n.xrlayer=this._createXRLayer(n);let a=this._session.renderState.layers;a.unshift(n.xrlayer),this._session.updateRenderState({layers:a})}else k.isXRRenderTarget=!1;return m}renderLayers(){let a=new bQ,b=new bP,c=this._renderer,d=this.isPresenting,e=c.getOutputRenderTarget(),f=c._frameBufferTarget;this.isPresenting=!1;let g=new bO;c.getSize(g);let h=c._quad;for(let d of this._layers)if(d.renderTarget.isXRRenderTarget=null!==this._session,d.renderTarget._hasExternalTextures=d.renderTarget.isXRRenderTarget,d.renderTarget.isXRRenderTarget&&this._sessionUsesLayers){d.xrlayer.transform=new XRRigidTransform(d.plane.getWorldPosition(a),d.plane.getWorldQuaternion(b));let e=this._glBinding.getSubImage(d.xrlayer,this._xrFrame);c.backend.setXRRenderTargetTextures(d.renderTarget,e.colorTexture,void 0),c._setXRLayerSize(d.renderTarget.width,d.renderTarget.height),c.setOutputRenderTarget(d.renderTarget),c.setRenderTarget(null),c._frameBufferTarget=null,this._frameBufferTargets||(this._frameBufferTargets=new WeakMap);let{frameBufferTarget:f,quad:g}=this._frameBufferTargets.get(d.renderTarget)||{frameBufferTarget:null,quad:null};f?(c._frameBufferTarget=f,c._quad=g):(c._quad=new r2(new ot),this._frameBufferTargets.set(d.renderTarget,{frameBufferTarget:c._getFrameBufferTarget(),quad:c._quad})),d.rendercall(),c._frameBufferTarget=null}else c.setRenderTarget(d.renderTarget),d.rendercall();c.setRenderTarget(null),c.setOutputRenderTarget(e),c._frameBufferTarget=f,c._setXRLayerSize(g.x,g.y),c._quad=h,this.isPresenting=d}getSession(){return this._session}async setSession(a){let b=this._renderer,c=b.backend;this._gl=b.getContext();let d=this._gl,e=d.getContextAttributes();if(this._session=a,null!==a){if(!0===c.isWebGPUBackend)throw Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(a.addEventListener("select",this._onSessionEvent),a.addEventListener("selectstart",this._onSessionEvent),a.addEventListener("selectend",this._onSessionEvent),a.addEventListener("squeeze",this._onSessionEvent),a.addEventListener("squeezestart",this._onSessionEvent),a.addEventListener("squeezeend",this._onSessionEvent),a.addEventListener("end",this._onSessionEnd),a.addEventListener("inputsourceschange",this._onInputSourcesChange),await c.makeXRCompatible(),this._currentPixelRatio=b.getPixelRatio(),b.getSize(this._currentSize),this._currentAnimationContext=b._animation.getContext(),this._currentAnimationLoop=b._animation.getAnimationLoop(),b._animation.stop(),!0===this._supportsLayers){let c=null,f=null,g=null;b.depth&&(g=b.stencil?d.DEPTH24_STENCIL8:d.DEPTH_COMPONENT24,c=b.stencil?aQ:aP,f=b.stencil?aJ:aE);let h={colorFormat:d.RGBA8,depthFormat:g,scaleFactor:this._framebufferScaleFactor,clearOnAccess:!1};this._useMultiviewIfPossible&&b.hasFeature("OVR_multiview2")&&(h.textureType="texture-array",this._useMultiview=!0),this._glBinding=this.getBinding();let i=this._glBinding.createProjectionLayer(h),j=[i];this._glProjLayer=i,b.setPixelRatio(1),b._setXRLayerSize(i.textureWidth,i.textureHeight);let k=this._useMultiview?2:1,l=new el(i.textureWidth,i.textureHeight,f,void 0,void 0,void 0,void 0,void 0,void 0,c,k);if(this._xrRenderTarget=new xa(i.textureWidth,i.textureHeight,{format:aO,type:az,colorSpace:b.outputColorSpace,depthTexture:l,stencilBuffer:b.stencil,samples:4*!!e.antialias,resolveDepthBuffer:!1===i.ignoreDepthValues,resolveStencilBuffer:!1===i.ignoreDepthValues,depth:this._useMultiview?2:1,multiview:this._useMultiview}),this._xrRenderTarget._hasExternalTextures=!0,this._xrRenderTarget.depth=this._useMultiview?2:1,this._sessionUsesLayers=a.enabledFeatures.includes("layers"),this._referenceSpace=await a.requestReferenceSpace(this.getReferenceSpaceType()),this._sessionUsesLayers)for(let a of this._layers)a.plane.material=new di({color:0xffffff,side:+("cylinder"===a.type)}),a.plane.material.blending=5,a.plane.material.blendEquation=100,a.plane.material.blendSrc=200,a.plane.material.blendDst=200,a.xrlayer=this._createXRLayer(a),j.unshift(a.xrlayer);a.updateRenderState({layers:j})}else{let c=new XRWebGLLayer(a,d,{antialias:b.currentSamples>0,alpha:!0,depth:b.depth,stencil:b.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()});this._glBaseLayer=c,a.updateRenderState({baseLayer:c}),b.setPixelRatio(1),b._setXRLayerSize(c.framebufferWidth,c.framebufferHeight),this._xrRenderTarget=new xa(c.framebufferWidth,c.framebufferHeight,{format:aO,type:az,colorSpace:b.outputColorSpace,stencilBuffer:b.stencil,resolveDepthBuffer:!1===c.ignoreDepthValues,resolveStencilBuffer:!1===c.ignoreDepthValues}),this._xrRenderTarget._isOpaqueFramebuffer=!0,this._referenceSpace=await a.requestReferenceSpace(this.getReferenceSpaceType())}this.setFoveation(this.getFoveation()),b._animation.setAnimationLoop(this._onAnimationFrame),b._animation.setContext(a),b._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(a){let b=this._session;if(null===b)return;let c=a.near,d=a.far,e=this._cameraXR,f=this._cameraL,g=this._cameraR;e.near=g.near=f.near=c,e.far=g.far=f.far=d,e.isMultiViewCamera=this._useMultiview,(this._currentDepthNear!==e.near||this._currentDepthFar!==e.far)&&(b.updateRenderState({depthNear:e.near,depthFar:e.far}),this._currentDepthNear=e.near,this._currentDepthFar=e.far),e.layers.mask=6|a.layers.mask,f.layers.mask=3&e.layers.mask,g.layers.mask=5&e.layers.mask;let h=a.parent,i=e.cameras;fZ(e,h);for(let a=0;a<i.length;a++)fZ(i[a],h);2===i.length?function(a,b,c){xb.setFromMatrixPosition(b.matrixWorld),xc.setFromMatrixPosition(c.matrixWorld);let d=xb.distanceTo(xc),e=b.projectionMatrix.elements,f=c.projectionMatrix.elements,g=e[14]/(e[10]-1),h=e[14]/(e[10]+1),i=(e[9]+1)/e[5],j=(e[9]-1)/e[5],k=(e[8]-1)/e[0],l=(f[8]+1)/f[0],m=d/(-k+l),n=-(m*k);if(b.matrixWorld.decompose(a.position,a.quaternion,a.scale),a.translateX(n),a.translateZ(m),a.matrixWorld.compose(a.position,a.quaternion,a.scale),a.matrixWorldInverse.copy(a.matrixWorld).invert(),-1===e[10])a.projectionMatrix.copy(b.projectionMatrix),a.projectionMatrixInverse.copy(b.projectionMatrixInverse);else{let b=g+m,c=h+m;a.projectionMatrix.makePerspective(g*k-n,g*l+(d-n),i*h/c*b,j*h/c*b,b,c),a.projectionMatrixInverse.copy(a.projectionMatrix).invert()}}(e,f,g):e.projectionMatrix.copy(f.projectionMatrix),null===h?a.matrix.copy(e.matrixWorld):(a.matrix.copy(h.matrixWorld),a.matrix.invert(),a.matrix.multiply(e.matrixWorld)),a.matrix.decompose(a.position,a.quaternion,a.scale),a.updateMatrixWorld(!0),a.projectionMatrix.copy(e.projectionMatrix),a.projectionMatrixInverse.copy(e.projectionMatrixInverse),a.isPerspectiveCamera&&(a.fov=2*bM*Math.atan(1/a.projectionMatrix.elements[5]),a.zoom=1)}_getController(a){let b=this._controllers[a];return void 0===b&&(b=new d_,this._controllers[a]=b),b}},xe=class extends bI{constructor(a){super(),this.domElement=a,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new b3(0,0,this._width,this._height),this._scissor=new b3(0,0,this._width,this._height),this._scissorTest=!1,this.colorTexture=new ek,this.depthTexture=new el}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(a){return a.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(a){return a.set(this._width,this._height)}setPixelRatio(a=1){this._pixelRatio!==a&&(this._pixelRatio=a,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(a,b,c){this.xr&&this.xr.isPresenting||(this._width=a,this._height=b,this._pixelRatio=c,this.domElement.width=Math.floor(a*c),this.domElement.height=Math.floor(b*c),this.setViewport(0,0,a,b),this._dispatchResize())}setSize(a,b,c=!0){this.xr&&this.xr.isPresenting||(this._width=a,this._height=b,this.domElement.width=Math.floor(a*this._pixelRatio),this.domElement.height=Math.floor(b*this._pixelRatio),!0===c&&(this.domElement.style.width=a+"px",this.domElement.style.height=b+"px"),this.setViewport(0,0,a,b),this._dispatchResize())}getScissor(a){let b=this._scissor;return a.x=b.x,a.y=b.y,a.width=b.width,a.height=b.height,a}setScissor(a,b,c,d){let e=this._scissor;a.isVector4?e.copy(a):e.set(a,b,c,d)}getScissorTest(){return this._scissorTest}setScissorTest(a){this._scissorTest=a}getViewport(a){return a.copy(this._viewport)}setViewport(a,b,c,d,e=0,f=1){let g=this._viewport;a.isVector4?g.copy(a):g.set(a,b,c,d),g.minDepth=e,g.maxDepth=f}_dispatchResize(){this.dispatchEvent({type:"resize"})}dispose(){this.dispatchEvent({type:"dispose"})}},xf=new d0,xg=new bO,xh=new b3,xi=new ee,xj=new eh,xk=new cx,xl=new b3,xm=class{constructor(a,b={}){this.isRenderer=!0;let{logarithmicDepthBuffer:c=!1,alpha:d=!0,depth:e=!0,stencil:f=!1,antialias:g=!1,samples:h=0,getFallback:i=null,colorBufferType:j=aG,multiview:k=!1}=b;this.backend=a,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=d,this.logarithmicDepthBuffer=c,this.outputColorSpace=br,this.toneMapping=0,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=e,this.stencil=f,this.info=new qQ,this.overrideNodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new w6,this.lighting=new w9,this._samples=h||!0===g?4:0,this._onCanvasTargetResize=this._onCanvasTargetResize.bind(this),this._canvasTarget=new xe(a.getDomElement()),this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize),this._canvasTarget.isDefaultCanvasTarget=!0,this._inspector=new kF,this._inspector.setRenderer(this),this._getFallback=i,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new r2(new ot),this._quad.name="Output Color Transform",this._quad.material.name="outputColorTransform",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null,this._clearColor=new q7(0,0,0,+(!0!==this.alpha)),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._colorBufferType=j,this._cacheShadowNodes=new WeakMap,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:1},this.xr=new xd(this,k),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(a,b,c)=>{await this.compileAsync(a,b);let d=this._renderLists.get(a,b),e=this._renderContexts.get(a,b,this._renderTarget),f=a.overrideMaterial||c.material,{fragmentShader:g,vertexShader:h}=this._objects.get(c,f,a,b,d.lightsNode,e,e.clippingContext).getNodeBuilderState();return{fragmentShader:g,vertexShader:h}}}}async init(){return null===this._initPromise&&(this._initPromise=new Promise(async(a,b)=>{let c=this.backend;try{await c.init(this)}catch(a){if(null===this._getFallback)return void b(a);try{this.backend=c=this._getFallback(a),await c.init(this)}catch(a){b(a);return}}this._nodes=new w0(this,c),this._animation=new qG(this,this._nodes,this.info),this._attributes=new qO(c),this._background=new v7(this,this._nodes),this._geometries=new qP(this._attributes,this.info),this._textures=new q6(this,c,this.info),this._pipelines=new qW(c,this._nodes),this._bindings=new qX(c,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new qL(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new q$(this.lighting),this._bundles=new w5,this._renderContexts=new q4,this._animation.start(),this._initialized=!0,this._inspector.init(),a(this)})),this._initPromise}get domElement(){return this._canvasTarget.domElement}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(a,b,c=null){if(!0===this._isDeviceLost)return;!1===this._initialized&&await this.init();let d=this._nodes.nodeFrame,e=d.renderId,f=this._currentRenderContext,g=this._currentRenderObjectFunction,h=this._compilationPromises,i=!0===a.isScene?a:xf;null===c&&(c=a);let j=this._renderTarget,k=this._renderContexts.get(c,b,j),l=this._activeMipmapLevel,m=[];this._currentRenderContext=k,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=m,d.renderId++,d.update(),k.depth=this.depth,k.stencil=this.stencil,k.clippingContext||(k.clippingContext=new w2),k.clippingContext.updateGlobal(i,b),i.onBeforeRender(this,a,b,j);let n=this._renderLists.get(a,b);if(n.begin(),this._projectObject(a,b,0,n,k.clippingContext),c!==a&&c.traverseVisible(function(a){a.isLight&&a.layers.test(b.layers)&&n.pushLight(a)}),n.finish(),null!==j){this._textures.updateRenderTarget(j,l);let a=this._textures.get(j);k.textures=a.textures,k.depthTexture=a.depthTexture}else k.textures=null,k.depthTexture=null;this._background.update(i,n,k);let o=n.opaque,p=n.transparent,q=n.transparentDoublePass,r=n.lightsNode;!0===this.opaque&&o.length>0&&this._renderObjects(o,b,i,r),!0===this.transparent&&p.length>0&&this._renderTransparents(p,q,b,i,r),d.renderId=e,this._currentRenderContext=f,this._currentRenderObjectFunction=g,this._compilationPromises=h,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(m)}async renderAsync(a,b){K('Renderer: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.render(a,b)}async waitForGPU(){J("Renderer: waitForGPU() has been removed. Read https://github.com/mrdoob/three.js/issues/32012 for more information.")}set inspector(a){null!==this._inspector&&this._inspector.setRenderer(null),this._inspector=a,this._inspector.setRenderer(this)}get inspector(){return this._inspector}set highPrecision(a){!0===a?(this.overrideNodes.modelViewMatrix=lE,this.overrideNodes.modelNormalViewMatrix=lF):this.highPrecision&&(this.overrideNodes.modelViewMatrix=null,this.overrideNodes.modelNormalViewMatrix=null)}get highPrecision(){return this.overrideNodes.modelViewMatrix===lE&&this.overrideNodes.modelNormalViewMatrix===lF}setMRT(a){return this._mrt=a,this}getMRT(){return this._mrt}getColorBufferType(){return this._colorBufferType}_onDeviceLost(a){let b=`THREE.WebGPURenderer: ${a.api} Device Lost:

Message: ${a.message}`;a.reason&&(b+=`
Reason: ${a.reason}`),J(b),this._isDeviceLost=!0}_renderBundle(a,b,c){let{bundleGroup:d,camera:e,renderList:f}=a,g=this._currentRenderContext,h=this._bundles.get(d,e),i=this.backend.get(h);void 0===i.renderContexts&&(i.renderContexts=new Set);let j=d.version!==i.version,k=!1===i.renderContexts.has(g)||j;if(i.renderContexts.add(g),k){this.backend.beginBundle(g),(void 0===i.renderObjects||j)&&(i.renderObjects=[]),this._currentRenderBundle=h;let{transparentDoublePass:a,transparent:k,opaque:l}=f;!0===this.opaque&&l.length>0&&this._renderObjects(l,e,b,c),!0===this.transparent&&k.length>0&&this._renderTransparents(k,a,e,b,c),this._currentRenderBundle=null,this.backend.finishBundle(g,h),i.version=d.version}else{let{renderObjects:a}=i;for(let b=0,c=a.length;b<c;b++){let c=a[b];this._nodes.needsRefresh(c)&&(this._nodes.updateBefore(c),this._nodes.updateForRender(c),this._bindings.updateForRender(c),this._nodes.updateAfter(c))}}this.backend.addBundle(g,h)}render(a,b){if(!1===this._initialized)throw Error('Renderer: .render() called before the backend is initialized. Use "await renderer.init();" before rendering.');this._renderScene(a,b)}get initialized(){return this._initialized}_getFrameBufferTarget(){let{currentToneMapping:a,currentColorSpace:b}=this,c=b!==bX.workingColorSpace;if(!1==(0!==a)&&!1===c)return null;let{width:d,height:e}=this.getDrawingBufferSize(xg),{depth:f,stencil:g}=this,h=this._frameBufferTarget;null===h&&((h=new b4(d,e,{depthBuffer:f,stencilBuffer:g,type:this._colorBufferType,format:aO,colorSpace:bX.workingColorSpace,generateMipmaps:!1,minFilter:av,magFilter:av,samples:this.samples})).isPostProcessingRenderTarget=!0,this._frameBufferTarget=h);let i=this.getOutputRenderTarget();h.depthBuffer=f,h.stencilBuffer=g,null===i?h.setSize(d,e,1):h.setSize(i.width,i.height,i.depth);let j=this._canvasTarget;return h.viewport.copy(j._viewport),h.scissor.copy(j._scissor),h.viewport.multiplyScalar(j._pixelRatio),h.scissor.multiplyScalar(j._pixelRatio),h.scissorTest=j._scissorTest,h.multiview=null!==i&&i.multiview,h.resolveDepthBuffer=null===i||i.resolveDepthBuffer,h._autoAllocateDepthBuffer=null!==i&&i._autoAllocateDepthBuffer,h}_renderScene(a,b,c=!0){if(!0===this._isDeviceLost)return;let d=c?this._getFrameBufferTarget():null,e=this._nodes.nodeFrame,f=e.renderId,g=this._currentRenderContext,h=this._currentRenderObjectFunction,i=!0===a.isScene?a:xf,j=this._renderTarget||this._outputRenderTarget,k=this._activeCubeFace,l=this._activeMipmapLevel,m;null===d?m=j:(m=d,this.setRenderTarget(m));let n=this._renderContexts.get(a,b,m);this._currentRenderContext=n,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,e.renderId=this.info.calls,this.backend.updateTimeStampUID(n),this.inspector.beginRender(this.backend.getTimestampUID(n),a,b,m);let o=this.coordinateSystem,p=this.xr;if(b.coordinateSystem!==o&&!1===p.isPresenting&&(b.coordinateSystem=o,b.updateProjectionMatrix(),b.isArrayCamera))for(let a of b.cameras)a.coordinateSystem=o,a.updateProjectionMatrix();!0===a.matrixWorldAutoUpdate&&a.updateMatrixWorld(),null===b.parent&&!0===b.matrixWorldAutoUpdate&&b.updateMatrixWorld(),!0===p.enabled&&!0===p.isPresenting&&(!0===p.cameraAutoUpdate&&p.updateCamera(b),b=p.getCamera());let q=this._canvasTarget,r=q._viewport,s=q._scissor,t=q._pixelRatio;null!==m&&(r=m.viewport,s=m.scissor,t=1),this.getDrawingBufferSize(xg),xh.set(0,0,xg.width,xg.height);let u=void 0===r.minDepth?0:r.minDepth,v=void 0===r.maxDepth?1:r.maxDepth;n.viewportValue.copy(r).multiplyScalar(t).floor(),n.viewportValue.width>>=l,n.viewportValue.height>>=l,n.viewportValue.minDepth=u,n.viewportValue.maxDepth=v,n.viewport=!1===n.viewportValue.equals(xh),n.scissorValue.copy(s).multiplyScalar(t).floor(),n.scissor=q._scissorTest&&!1===n.scissorValue.equals(xh),n.scissorValue.width>>=l,n.scissorValue.height>>=l,n.clippingContext||(n.clippingContext=new w2),n.clippingContext.updateGlobal(i,b),i.onBeforeRender(this,a,b,m);let w=b.isArrayCamera?xj:xi;b.isArrayCamera||(xk.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse),w.setFromProjectionMatrix(xk,b.coordinateSystem,b.reversedDepth));let x=this._renderLists.get(a,b);if(x.begin(),this._projectObject(a,b,0,x,n.clippingContext),x.finish(),!0===this.sortObjects&&x.sort(this._opaqueSort,this._transparentSort),null!==m){this._textures.updateRenderTarget(m,l);let a=this._textures.get(m);n.textures=a.textures,n.depthTexture=a.depthTexture,n.width=a.width,n.height=a.height,n.renderTarget=m,n.depth=m.depthBuffer,n.stencil=m.stencilBuffer}else n.textures=null,n.depthTexture=null,n.width=xg.width,n.height=xg.height,n.depth=this.depth,n.stencil=this.stencil;n.width>>=l,n.height>>=l,n.activeCubeFace=k,n.activeMipmapLevel=l,n.occlusionQueryCount=x.occlusionQueryCount,n.scissorValue.max(xl.set(0,0,0,0)),n.scissorValue.x+n.scissorValue.width>n.width&&(n.scissorValue.width=Math.max(n.width-n.scissorValue.x,0)),n.scissorValue.y+n.scissorValue.height>n.height&&(n.scissorValue.height=Math.max(n.height-n.scissorValue.y,0)),this._background.update(i,x,n),n.camera=b,this.backend.beginRender(n);let{bundles:y,lightsNode:z,transparentDoublePass:A,transparent:B,opaque:C}=x;return y.length>0&&this._renderBundles(y,i,z),!0===this.opaque&&C.length>0&&this._renderObjects(C,b,i,z),!0===this.transparent&&B.length>0&&this._renderTransparents(B,A,b,i,z),this.backend.finishRender(n),e.renderId=f,this._currentRenderContext=g,this._currentRenderObjectFunction=h,null!==d&&(this.setRenderTarget(j,k,l),this._renderOutput(m)),i.onAfterRender(this,a,b,m),this.inspector.finishRender(this.backend.getTimestampUID(n)),n}_setXRLayerSize(a,b){this._canvasTarget._width=a,this._canvasTarget._height=b,this.setViewport(0,0,a,b)}_renderOutput(a){let b=this._quad;this._nodes.hasOutputChange(a.texture)&&(b.material.fragmentNode=this._nodes.getOutputNode(a.texture),b.material.needsUpdate=!0);let c=this.autoClear,d=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(b,b.camera,!1),this.autoClear=c,this.xr.enabled=d}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(a){!1===this._initialized&&await this.init(),this._animation.setAnimationLoop(a)}getAnimationLoop(){return this._animation.getAnimationLoop()}async getArrayBufferAsync(a){return await this.backend.getArrayBufferAsync(a)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._canvasTarget.getPixelRatio()}getDrawingBufferSize(a){return this._canvasTarget.getDrawingBufferSize(a)}getSize(a){return this._canvasTarget.getSize(a)}setPixelRatio(a=1){this._canvasTarget.setPixelRatio(a)}setDrawingBufferSize(a,b,c){this.xr&&this.xr.isPresenting||this._canvasTarget.setDrawingBufferSize(a,b,c)}setSize(a,b,c=!0){this.xr&&this.xr.isPresenting||this._canvasTarget.setSize(a,b,c)}setOpaqueSort(a){this._opaqueSort=a}setTransparentSort(a){this._transparentSort=a}getScissor(a){return this._canvasTarget.getScissor(a)}setScissor(a,b,c,d){this._canvasTarget.setScissor(a,b,c,d)}getScissorTest(){return this._canvasTarget.getScissorTest()}setScissorTest(a){this._canvasTarget.setScissorTest(a),this.backend.setScissorTest(a)}getViewport(a){return this._canvasTarget.getViewport(a)}setViewport(a,b,c,d,e=0,f=1){this._canvasTarget.setViewport(a,b,c,d,e,f)}getClearColor(a){return a.copy(this._clearColor)}setClearColor(a,b=1){this._clearColor.set(a),this._clearColor.a=b}getClearAlpha(){return this._clearColor.a}setClearAlpha(a){this._clearColor.a=a}getClearDepth(){return this._clearDepth}setClearDepth(a){this._clearDepth=a}getClearStencil(){return this._clearStencil}setClearStencil(a){this._clearStencil=a}isOccluded(a){let b=this._currentRenderContext;return b&&this.backend.isOccluded(b,a)}clear(a=!0,b=!0,c=!0){if(!1===this._initialized)throw Error('Renderer: .clear() called before the backend is initialized. Use "await renderer.init();" before before using this method.');let d=this._renderTarget||this._getFrameBufferTarget(),e=null;if(null!==d){this._textures.updateRenderTarget(d);let a=this._textures.get(d);(e=this._renderContexts.getForClear(d)).textures=a.textures,e.depthTexture=a.depthTexture,e.width=a.width,e.height=a.height,e.renderTarget=d,e.depth=d.depthBuffer,e.stencil=d.stencilBuffer,e.clearColorValue=this.backend.getClearColor(),e.activeCubeFace=this.getActiveCubeFace(),e.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(a,b,c,e),null!==d&&null===this._renderTarget&&this._renderOutput(d)}clearColor(){this.clear(!0,!1,!1)}clearDepth(){this.clear(!1,!0,!1)}clearStencil(){this.clear(!1,!1,!0)}async clearAsync(a=!0,b=!0,c=!0){K('Renderer: "clearAsync()" has been deprecated. Use "clear()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.clear(a,b,c)}async clearColorAsync(){K('Renderer: "clearColorAsync()" has been deprecated. Use "clearColor()" and "await renderer.init();" when creating the renderer.'),this.clear(!0,!1,!1)}async clearDepthAsync(){K('Renderer: "clearDepthAsync()" has been deprecated. Use "clearDepth()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!0,!1)}async clearStencilAsync(){K('Renderer: "clearStencilAsync()" has been deprecated. Use "clearStencil()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!1,!0)}get needsFrameBufferTarget(){let a=0!==this.currentToneMapping,b=this.currentColorSpace!==bX.workingColorSpace;return a||b}get samples(){return this._samples}get currentSamples(){let a=this._samples;return null===this._renderTarget?this.needsFrameBufferTarget&&(a=0):a=this._renderTarget.samples,a}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:0}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:bX.workingColorSpace}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||null===this._renderTarget}dispose(){!0===this._initialized&&(this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._geometries.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),null!==this._frameBufferTarget&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(a=>{null!==a&&a.dispose()})),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(a,b=0,c=0){this._renderTarget=a,this._activeCubeFace=b,this._activeMipmapLevel=c}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(a){this._outputRenderTarget=a}getOutputRenderTarget(){return this._outputRenderTarget}setCanvasTarget(a){this._canvasTarget.removeEventListener("resize",this._onCanvasTargetResize),this._canvasTarget=a,this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize)}getCanvasTarget(){return this._canvasTarget}_resetXRState(){this.backend.setXRTarget(null),this.setOutputRenderTarget(null),this.setRenderTarget(null),this._frameBufferTarget.dispose(),this._frameBufferTarget=null}setRenderObjectFunction(a){this._renderObjectFunction=a}getRenderObjectFunction(){return this._renderObjectFunction}compute(a,b=null){if(!0===this._isDeviceLost)return;if(!1===this._initialized)return I("Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(a,b);let c=this._nodes.nodeFrame,d=c.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,c.renderId=this.info.calls,this.backend.updateTimeStampUID(a),this.inspector.beginCompute(this.backend.getTimestampUID(a),a);let e=this.backend,f=this._pipelines,g=this._bindings,h=this._nodes,i=Array.isArray(a)?a:[a];if(void 0===i[0]||!0!==i[0].isComputeNode)throw Error("THREE.Renderer: .compute() expects a ComputeNode.");for(let c of(e.beginCompute(a),i)){if(!1===f.has(c)){let a=()=>{c.removeEventListener("dispose",a),f.delete(c),g.deleteForCompute(c),h.delete(c)};c.addEventListener("dispose",a);let b=c.onInitFunction;null!==b&&b.call(c,{renderer:this})}h.updateForCompute(c),g.updateForCompute(c);let d=g.getForCompute(c),i=f.getForCompute(c,d);e.compute(a,c,d,i,b)}e.finishCompute(a),c.renderId=d,this.inspector.finishCompute(this.backend.getTimestampUID(a))}async computeAsync(a,b=null){!1===this._initialized&&await this.init(),this.compute(a,b)}async hasFeatureAsync(a){return K('Renderer: "hasFeatureAsync()" has been deprecated. Use "hasFeature()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.hasFeature(a)}async resolveTimestampsAsync(a="render"){return!1===this._initialized&&await this.init(),this.backend.resolveTimestampsAsync(a)}hasFeature(a){if(!1===this._initialized)throw Error('Renderer: .hasFeature() called before the backend is initialized. Use "await renderer.init();" before before using this method.');return this.backend.hasFeature(a)}hasInitialized(){return this._initialized}async initTextureAsync(a){K('Renderer: "initTextureAsync()" has been deprecated. Use "initTexture()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.initTexture(a)}initTexture(a){if(!1===this._initialized)throw Error('Renderer: .initTexture() called before the backend is initialized. Use "await renderer.init();" before before using this method.');this._textures.updateTexture(a)}copyFramebufferToTexture(a,b=null){if(null!==b)if(b.isVector2)b=xl.set(b.x,b.y,a.image.width,a.image.height).floor();else{if(!b.isVector4)return void J("Renderer.copyFramebufferToTexture: Invalid rectangle.");b=xl.copy(b).floor()}else b=xl.set(0,0,a.image.width,a.image.height);let c=this._currentRenderContext,d;null===c?null!==(d=this._renderTarget||this._getFrameBufferTarget())&&(this._textures.updateRenderTarget(d),c=this._textures.get(d)):d=c.renderTarget,this._textures.updateTexture(a,{renderTarget:d}),this.backend.copyFramebufferToTexture(a,c,b),this._inspector.copyFramebufferToTexture(a)}copyTextureToTexture(a,b,c=null,d=null,e=0,f=0){this._textures.updateTexture(a),this._textures.updateTexture(b),this.backend.copyTextureToTexture(a,b,c,d,e,f),this._inspector.copyTextureToTexture(a,b)}async readRenderTargetPixelsAsync(a,b,c,d,e,f=0,g=0){return this.backend.copyTextureToBuffer(a.textures[f],b,c,d,e,g)}_projectObject(a,b,c,d,e){if(!1===a.visible)return;if(a.layers.test(b.layers)){if(a.isGroup)c=a.renderOrder,a.isClippingGroup&&a.enabled&&(e=e.getGroupContext(a));else if(a.isLOD)!0===a.autoUpdate&&a.update(b);else if(a.isLight)d.pushLight(a);else if(a.isSprite){let f=b.isArrayCamera?xj:xi;if(!a.frustumCulled||f.intersectsSprite(a,b)){!0===this.sortObjects&&xl.setFromMatrixPosition(a.matrixWorld).applyMatrix4(xk);let{geometry:b,material:f}=a;f.visible&&d.push(a,b,f,c,xl.z,null,e)}}else if(a.isLineLoop)J("Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if(a.isMesh||a.isLine||a.isPoints){let f=b.isArrayCamera?xj:xi;if(!a.frustumCulled||f.intersectsObject(a,b)){let{geometry:b,material:f}=a;if(!0===this.sortObjects&&(null===b.boundingSphere&&b.computeBoundingSphere(),xl.copy(b.boundingSphere.center).applyMatrix4(a.matrixWorld).applyMatrix4(xk)),Array.isArray(f)){let g=b.groups;for(let h=0,i=g.length;h<i;h++){let i=g[h],j=f[i.materialIndex];j&&j.visible&&d.push(a,b,j,c,xl.z,i,e)}}else f.visible&&d.push(a,b,f,c,xl.z,null,e)}}}if(!0===a.isBundleGroup&&void 0!==this.backend.beginBundle){let c=d;(d=this._renderLists.get(a,b)).begin(),c.pushBundle({bundleGroup:a,camera:b,renderList:d}),d.finish()}let f=a.children;for(let a=0,g=f.length;a<g;a++)this._projectObject(f[a],b,c,d,e)}_renderBundles(a,b,c){for(let d of a)this._renderBundle(d,b,c)}_renderTransparents(a,b,c,d,e){if(b.length>0){for(let{material:a}of b)a.side=1;for(let{material:a}of(this._renderObjects(b,c,d,e,"backSide"),b))a.side=0;for(let{material:f}of(this._renderObjects(a,c,d,e),b))f.side=2}else this._renderObjects(a,c,d,e)}_renderObjects(a,b,c,d,e=null){for(let f=0,g=a.length;f<g;f++){let{object:g,geometry:h,material:i,group:j,clippingContext:k}=a[f];this._currentRenderObjectFunction(g,c,b,h,i,j,d,k,e)}}_getShadowNodes(a){let b=a.version,c=this._cacheShadowNodes.get(a);if(void 0===c||c.version!==b){let d=null!==a.map,e=a.colorNode&&a.colorNode.isNode,f=a.castShadowNode&&a.castShadowNode.isNode,g=null,h=null,i=null;if(d||e||f){let b,c;f?(b=a.castShadowNode.rgb,c=a.castShadowNode.a):(b=hm(0),c=he(1)),d&&(c=c.mul(mg("map","texture",a).a)),e&&(c=c.mul(a.colorNode.a)),h=hq(b,c)}a.depthNode&&a.depthNode.isNode&&(i=a.depthNode),a.castShadowPositionNode&&a.castShadowPositionNode.isNode?g=a.castShadowPositionNode:a.positionNode&&a.positionNode.isNode&&(g=a.positionNode),c={version:b,colorNode:h,depthNode:i,positionNode:g},this._cacheShadowNodes.set(a,c)}return c}renderObject(a,b,c,d,e,f,g,h=null,i=null){let j=!1,k,l,m,n;if(a.onBeforeRender(this,b,c,d,e,f),!0===e.allowOverride&&null!==b.overrideMaterial){let a=b.overrideMaterial;if(j=!0,k=b.overrideMaterial.colorNode,l=b.overrideMaterial.depthNode,m=b.overrideMaterial.positionNode,n=b.overrideMaterial.side,e.positionNode&&e.positionNode.isNode&&(a.positionNode=e.positionNode),a.alphaTest=e.alphaTest,a.alphaMap=e.alphaMap,a.transparent=e.transparent||e.transmission>0||e.transmissionNode&&e.transmissionNode.isNode||e.backdropNode&&e.backdropNode.isNode,a.isShadowPassMaterial){let{colorNode:b,depthNode:c,positionNode:d}=this._getShadowNodes(e);a.side=null===e.shadowSide?e.side:e.shadowSide,null!==b&&(a.colorNode=b),null!==c&&(a.depthNode=c),null!==d&&(a.positionNode=d)}e=a}!0===e.transparent&&2===e.side&&!1===e.forceSinglePass?(e.side=1,this._handleObjectFunction(a,e,b,c,g,f,h,"backSide"),e.side=0,this._handleObjectFunction(a,e,b,c,g,f,h,i),e.side=2):this._handleObjectFunction(a,e,b,c,g,f,h,i),j&&(b.overrideMaterial.colorNode=k,b.overrideMaterial.depthNode=l,b.overrideMaterial.positionNode=m,b.overrideMaterial.side=n),a.onAfterRender(this,b,c,d,e,f)}_renderObjectDirect(a,b,c,d,e,f,g,h){let i=this._objects.get(a,b,c,d,e,this._currentRenderContext,g,h);i.drawRange=a.geometry.drawRange,i.group=f;let j=this._nodes.needsRefresh(i);j&&(this._nodes.updateBefore(i),this._geometries.updateForRender(i),this._nodes.updateForRender(i),this._bindings.updateForRender(i)),this._pipelines.updateForRender(i),null!==this._currentRenderBundle&&(this.backend.get(this._currentRenderBundle).renderObjects.push(i),i.bundle=this._currentRenderBundle.bundleGroup),this.backend.draw(i,this.info),j&&this._nodes.updateAfter(i)}_createObjectPipeline(a,b,c,d,e,f,g,h){let i=this._objects.get(a,b,c,d,e,this._currentRenderContext,g,h);i.drawRange=a.geometry.drawRange,i.group=f,this._nodes.updateBefore(i),this._geometries.updateForRender(i),this._nodes.updateForRender(i),this._bindings.updateForRender(i),this._pipelines.getForRender(i,this._compilationPromises),this._nodes.updateAfter(i)}_onCanvasTargetResize(){this._initialized&&this.backend.updateSize()}get compile(){return this.compileAsync}},xn=class{constructor(a=""){this.name=a,this.visibility=0}setVisibility(a){this.visibility|=a}clone(){return Object.assign(new this.constructor,this)}},xo=class extends xn{constructor(a,b=null){super(a),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=b}get byteLength(){var a;return(a=this._buffer.byteLength)+(16-a%16)%16}get buffer(){return this._buffer}update(){return!0}},xp=class extends xo{constructor(a,b=null){super(a,b),this.isUniformBuffer=!0}},xq=0,xr=class extends xp{constructor(a,b){super("UniformBuffer_"+xq++,a?a.value:null),this.nodeUniform=a,this.groupNode=b}get buffer(){return this.nodeUniform.value}},xs=class extends xp{constructor(a){super(a),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(a){return this.uniforms.push(a),this}removeUniform(a){let b=this.uniforms.indexOf(a);return -1!==b&&this.uniforms.splice(b,1),this}get values(){return null===this._values&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let a=this._buffer;return null===a&&(a=new Float32Array(new ArrayBuffer(this.byteLength)),this._buffer=a),a}get byteLength(){let a=this.bytesPerElement,b=0;for(let c=0,d=this.uniforms.length;c<d;c++){let d=this.uniforms[c],e=d.boundary,f=d.itemSize*a,g=b%16,h=g%e,i=g+h;b+=h,0!==i&&16-i<f&&(b+=16-i),d.offset=b/a,b+=f}return 16*Math.ceil(b/16)}update(){let a=!1;for(let b of this.uniforms)!0===this.updateByType(b)&&(a=!0);return a}updateByType(a){return a.isNumberUniform?this.updateNumber(a):a.isVector2Uniform?this.updateVector2(a):a.isVector3Uniform?this.updateVector3(a):a.isVector4Uniform?this.updateVector4(a):a.isColorUniform?this.updateColor(a):a.isMatrix3Uniform?this.updateMatrix3(a):a.isMatrix4Uniform?this.updateMatrix4(a):void J("WebGPUUniformsGroup: Unsupported uniform type.",a)}updateNumber(a){let b=!1,c=this.values,d=a.getValue(),e=a.offset,f=a.getType();return c[e]!==d&&(this._getBufferForType(f)[e]=c[e]=d,b=!0),b}updateVector2(a){let b=!1,c=this.values,d=a.getValue(),e=a.offset,f=a.getType();if(c[e+0]!==d.x||c[e+1]!==d.y){let a=this._getBufferForType(f);a[e+0]=c[e+0]=d.x,a[e+1]=c[e+1]=d.y,b=!0}return b}updateVector3(a){let b=!1,c=this.values,d=a.getValue(),e=a.offset,f=a.getType();if(c[e+0]!==d.x||c[e+1]!==d.y||c[e+2]!==d.z){let a=this._getBufferForType(f);a[e+0]=c[e+0]=d.x,a[e+1]=c[e+1]=d.y,a[e+2]=c[e+2]=d.z,b=!0}return b}updateVector4(a){let b=!1,c=this.values,d=a.getValue(),e=a.offset,f=a.getType();if(c[e+0]!==d.x||c[e+1]!==d.y||c[e+2]!==d.z||c[e+4]!==d.w){let a=this._getBufferForType(f);a[e+0]=c[e+0]=d.x,a[e+1]=c[e+1]=d.y,a[e+2]=c[e+2]=d.z,a[e+3]=c[e+3]=d.w,b=!0}return b}updateColor(a){let b=!1,c=this.values,d=a.getValue(),e=a.offset;if(c[e+0]!==d.r||c[e+1]!==d.g||c[e+2]!==d.b){let a=this.buffer;a[e+0]=c[e+0]=d.r,a[e+1]=c[e+1]=d.g,a[e+2]=c[e+2]=d.b,b=!0}return b}updateMatrix3(a){let b=!1,c=this.values,d=a.getValue().elements,e=a.offset;if(c[e+0]!==d[0]||c[e+1]!==d[1]||c[e+2]!==d[2]||c[e+4]!==d[3]||c[e+5]!==d[4]||c[e+6]!==d[5]||c[e+8]!==d[6]||c[e+9]!==d[7]||c[e+10]!==d[8]){let a=this.buffer;a[e+0]=c[e+0]=d[0],a[e+1]=c[e+1]=d[1],a[e+2]=c[e+2]=d[2],a[e+4]=c[e+4]=d[3],a[e+5]=c[e+5]=d[4],a[e+6]=c[e+6]=d[5],a[e+8]=c[e+8]=d[6],a[e+9]=c[e+9]=d[7],a[e+10]=c[e+10]=d[8],b=!0}return b}updateMatrix4(a){let b=!1,c=this.values,d=a.getValue().elements,e=a.offset;return!1===function(a,b,c){for(let d=0,e=b.length;d<e;d++)if(a[c+d]!==b[d])return!1;return!0}(c,d,e)&&(this.buffer.set(d,e),function(a,b,c){for(let d=0,e=b.length;d<e;d++)a[c+d]=b[d]}(c,d,e),b=!0),b}_getBufferForType(a){return"int"===a||"ivec2"===a||"ivec3"===a||"ivec4"===a?new Int32Array(this.buffer.buffer):"uint"===a||"uvec2"===a||"uvec3"===a||"uvec4"===a?new Uint32Array(this.buffer.buffer):this.buffer}},xt=0,xu=class extends xs{constructor(a,b){super(a),this.id=xt++,this.groupNode=b,this.isNodeUniformsGroup=!0}},xv=class extends xn{constructor(a,b){super(a),this._texture=null,this._onTextureDispose=()=>{this.generation=null,this.version=0},this.texture=b,this.version=b?b.version:0,this.generation=null,this.samplerKey="",this.isSampler=!0}set texture(a){this._texture!==a&&(this._texture&&this._texture.removeEventListener("dispose",this._onTextureDispose),this._texture=a,this.generation=null,this.version=0,this._texture&&this._texture.addEventListener("dispose",this._onTextureDispose))}get texture(){return this._texture}update(){let{texture:a,version:b}=this;return b!==a.version&&(this.version=a.version,!0)}clone(){let a=super.clone();return a._texture=null,a._onTextureDispose=()=>{a.generation=null,a.version=0},a.texture=this.texture,a}},xw=0,xx=class extends xv{constructor(a,b){super(a,b),this.id=xw++,this.store=!1,this.mipLevel=0,this.isSampledTexture=!0}},xy=class extends xx{constructor(a,b,c,d=null){super(a,b?b.value:null),this.textureNode=b,this.groupNode=c,this.access=d}update(){let{textureNode:a}=this;return this.texture===a.value?super.update():(this.texture=a.value,!0)}},xz=class extends xy{constructor(a,b,c,d=null){super(a,b,c,d),this.isSampledCubeTexture=!0}},xA=class extends xy{constructor(a,b,c,d=null){super(a,b,c,d),this.isSampledTexture3D=!0}},xB={bitcast_int_uint:new s0("uint tsl_bitcast_uint_to_int ( int x ) { return floatBitsToInt( uintBitsToFloat( x ) ); }"),bitcast_uint_int:new s0("uint tsl_bitcast_int_to_uint ( int x ) { return floatBitsToUint( intBitsToFloat ( x ) ); }")},xC={textureDimensions:"textureSize",equals:"equal",bitcast_float_int:"floatBitsToInt",bitcast_int_float:"intBitsToFloat",bitcast_uint_float:"uintBitsToFloat",bitcast_float_uint:"floatBitsToUint",bitcast_uint_int:"tsl_bitcast_uint_to_int",bitcast_int_uint:"tsl_bitcast_int_to_uint"},xD={low:"lowp",medium:"mediump",high:"highp"},xE={swizzleAssign:!0,storageBuffer:!1},xF={perspective:"smooth",linear:"noperspective"},xG={centroid:"centroid"},xH=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
precision lowp sampler2DArrayShadow;
precision lowp samplerCubeShadow;
`,xI=class extends wE{constructor(a,b){super(a,b,new wY),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(a){return!0===a.isVideoTexture&&""!==a.colorSpace}_include(a){let b=xB[a];return b.build(this),this.addInclude(b),b}getMethod(a){return void 0!==xB[a]&&this._include(a),xC[a]||a}getBitcastMethod(a,b){return this.getMethod(`bitcast_${b}_${a}`)}getTernary(a,b,c){return`${a} ? ${b} : ${c}`}getOutputStructName(){return""}buildFunctionCode(a){let b=a.layout,c=this.flowShaderNode(a),d=[];for(let a of b.inputs)d.push(this.getType(a.type)+" "+a.name);return`${this.getType(b.type)} ${b.name}( ${d.join(", ")} ) {

	${c.vars}

${c.code}
	return ${c.result};

}`}setupPBO(a){let b=a.value;if(void 0===b.pbo){let a=b.array,c=b.count*b.itemSize,{itemSize:d}=b,e=b.array.constructor.name.toLowerCase().includes("int"),f=e?aS:aR;2===d?f=e?aU:aT:3===d?f=e?aV:aN:4===d&&(f=e?aW:aO);let g={Float32Array:aF,Uint8Array:az,Uint16Array:aC,Uint32Array:aE,Int8Array:aA,Int16Array:aB,Int32Array:aD,Uint8ClampedArray:az},h=2**Math.ceil(Math.log2(Math.sqrt(c/d))),i=Math.ceil(c/d/h);h*i*d<c&&i++;let j=h*i*d,k=new a.constructor(j);k.set(a,0),b.array=k;let l=new d5(b.array,h,i,f,g[b.array.constructor.name]||1015);l.needsUpdate=!0,l.isPBOTexture=!0;let m=new kN(l,null,null);m.setPrecision("high"),b.pboNode=m,b.pbo=m.value,this.getUniformFromNode(b.pboNode,"texture",this.shaderStage,this.context.nodeName)}}getPropertyName(a,b=this.shaderStage){return a.isNodeUniform&&!0!==a.node.isTextureNode&&!0!==a.node.isBufferNode?b.charAt(0)+"_"+a.name:super.getPropertyName(a,b)}generatePBO(a){let{node:b,indexNode:c}=a,d=b.value;this.renderer.backend.has(d)&&(this.renderer.backend.get(d).pbo=d.pbo);let e=this.getUniformFromNode(d.pboNode,"texture",this.shaderStage,this.context.nodeName),f=this.getPropertyName(e);this.increaseUsage(c);let g=c.build(this,"uint"),h=this.getDataFromNode(a),i=h.propertyName;if(void 0===i){let c=this.getVarFromNode(a);i=this.getPropertyName(c);let e=this.getDataFromNode(b),j=e.propertySizeName;void 0===j&&(j=i+"Size",this.getVarFromNode(b,j,"uint"),this.addLineFlowCode(`${j} = uint( textureSize( ${f}, 0 ).x )`,a),e.propertySizeName=j);let{itemSize:k}=d,l="."+gj.join("").slice(0,k),m=`ivec2(${g} % ${j}, ${g} / ${j})`,n=this.generateTextureLoad(null,f,m,"0",null,null),o="vec4";1014===d.pbo.type?o="uvec4":1013===d.pbo.type&&(o="ivec4"),this.addLineFlowCode(`${i} = ${o}(${n})${l}`,a),h.propertyName=i}return i}generateTextureLoad(a,b,c,d,e,f){let g;return null===d&&(d="0"),g=e?f?`texelFetchOffset( ${b}, ivec3( ${c}, ${e} ), ${d}, ${f} )`:`texelFetch( ${b}, ivec3( ${c}, ${e} ), ${d} )`:f?`texelFetchOffset( ${b}, ${c}, ${d}, ${f} )`:`texelFetch( ${b}, ${c}, ${d} )`,null!==a&&a.isDepthTexture&&(g+=".x"),g}generateTexture(a,b,c,d,e){return d&&(c=`vec3( ${c}, ${d} )`),a.isDepthTexture?e?`textureOffset( ${b}, ${c}, ${e} ).x`:`texture( ${b}, ${c} ).x`:e?`textureOffset( ${b}, ${c}, ${e} )`:`texture( ${b}, ${c} )`}generateTextureLevel(a,b,c,d,e){return e?`textureLodOffset( ${b}, ${c}, ${d}, ${e} )`:`textureLod( ${b}, ${c}, ${d} )`}generateTextureBias(a,b,c,d,e){return e?`textureOffset( ${b}, ${c}, ${e}, ${d} )`:`texture( ${b}, ${c}, ${d} )`}generateTextureGrad(a,b,c,d,e){return e?`textureGradOffset( ${b}, ${c}, ${d[0]}, ${d[1]}, ${e} )`:`textureGrad( ${b}, ${c}, ${d[0]}, ${d[1]} )`}generateTextureCompare(a,b,c,d,e,f,g=this.shaderStage){if("fragment"===g)return e?f?`textureOffset( ${b}, vec4( ${c}, ${e}, ${d} ), ${f} )`:`texture( ${b}, vec4( ${c}, ${e}, ${d} ) )`:f?`textureOffset( ${b}, vec3( ${c}, ${d} ), ${f} )`:`texture( ${b}, vec3( ${c}, ${d} ) )`;J(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${g} shader.`)}getVars(a){let b=[],c=this.vars[a];if(void 0!==c)for(let a of c)b.push(`${this.getVar(a.type,a.name,a.count)};`);return b.join(`
	`)}getUniforms(a){let b=this.uniforms[a],c=[],d={};for(let e of b){let b=null,f=!1;if("texture"===e.type||"texture3D"===e.type){let a=e.node.value,c="";(!0===a.isDataTexture||!0===a.isData3DTexture)&&(1014===a.type?c="u":1013===a.type&&(c="i")),b="texture3D"===e.type&&!1===a.isArrayTexture?`${c}sampler3D ${e.name};`:a.compareFunction?!0===a.isArrayTexture?`sampler2DArrayShadow ${e.name};`:`sampler2DShadow ${e.name};`:!0===a.isArrayTexture||!0===a.isDataArrayTexture||!0===a.isCompressedArrayTexture?`${c}sampler2DArray ${e.name};`:`${c}sampler2D ${e.name};`}else if("cubeTexture"===e.type)b=`samplerCube ${e.name};`;else if("buffer"===e.type){let a=e.node,c=this.getType(a.bufferType),d=a.bufferCount,f=d>0?d:"";b=`${a.name} {
	${c} ${e.name}[${f}];
};
`}else b=`${this.getVectorType(e.type)} ${this.getPropertyName(e,a)};`,f=!0;let g=e.node.precision;if(null!==g&&(b=xD[g]+" "+b),f){b="	"+b;let a=e.groupNode.name;(d[a]||(d[a]=[])).push(b)}else b="uniform "+b,c.push(b)}let e="";for(let b in d){let c=d[b];e+=this._getGLSLUniformStruct(a+"_"+b,c.join(`
`))+`
`}return e+c.join(`
`)}getTypeFromAttribute(a){let b=super.getTypeFromAttribute(a);if(/^[iu]/.test(b)&&1013!==a.gpuType){let c=a;a.isInterleavedBufferAttribute&&(c=a.data);let d=c.array;d instanceof Uint32Array||d instanceof Int32Array||(b=b.slice(1))}return b}getAttributes(a){let b="";if("vertex"===a||"compute"===a){let a=this.getAttributesArray(),c=0;for(let d of a)b+=`layout( location = ${c++} ) in ${d.type} ${d.name};
`}return b}getStructMembers(a){let b=[];for(let c of a.members)b.push(`	${c.type} ${c.name};`);return b.join(`
`)}getStructs(a){let b=[],c=this.structs[a],d=[];for(let a of c)if(a.output)for(let b of a.members)d.push(`layout( location = ${b.index} ) out ${b.type} ${b.name};`);else{let c="struct "+a.name+` {
`;c+=this.getStructMembers(a),c+=`
};
`,b.push(c)}return 0===d.length&&d.push("layout( location = 0 ) out vec4 fragColor;"),`
`+d.join(`
`)+`

`+b.join(`
`)}getVaryings(a){let b="",c=this.varyings;if("vertex"===a||"compute"===a)for(let d of c){"compute"===a&&(d.needsInterpolation=!0);let c=this.getType(d.type);if(d.needsInterpolation)if(d.interpolationType){let a=xF[d.interpolationType]||d.interpolationType,e=xG[d.interpolationSampling]||"";b+=`${a} ${e} out ${c} ${d.name};
`}else{let a=c.includes("int")||c.includes("uv")||c.includes("iv")?"flat ":"";b+=`${a}out ${c} ${d.name};
`}else b+=`${c} ${d.name};
`}else if("fragment"===a){for(let a of c)if(a.needsInterpolation){let c=this.getType(a.type);if(a.interpolationType){let d=xF[a.interpolationType]||a.interpolationType,e=xG[a.interpolationSampling]||"";b+=`${d} ${e} in ${c} ${a.name};
`}else{let d=c.includes("int")||c.includes("uv")||c.includes("iv")?"flat ":"";b+=`${d}in ${c} ${a.name};
`}}}for(let c of this.builtins[a])b+=`${c};
`;return b}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((a,b)=>a*b,1)}u`}getSubgroupSize(){J("GLSLNodeBuilder: WebGLBackend does not support the subgroupSize node")}getInvocationSubgroupIndex(){J("GLSLNodeBuilder: WebGLBackend does not support the invocationSubgroupIndex node")}getSubgroupIndex(){J("GLSLNodeBuilder: WebGLBackend does not support the subgroupIndex node")}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(a,b,c=this.shaderStage){let d=this.extensions[c]||(this.extensions[c]=new Map);!1===d.has(a)&&d.set(a,{name:a,behavior:b})}getExtensions(a){let b=[];if("vertex"===a){let b=this.renderer.backend.extensions;this.object.isBatchedMesh&&b.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",a)}let c=this.extensions[a];if(void 0!==c)for(let{name:a,behavior:d}of c.values())b.push(`#extension ${a} : ${d}`);return b.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(a){let b=xE[a];if(void 0===b){let c;switch(b=!1,a){case"float32Filterable":c="OES_texture_float_linear";break;case"clipDistance":c="WEBGL_clip_cull_distance"}if(void 0!==c){let a=this.renderer.backend.extensions;a.has(c)&&(a.get(c),b=!0)}xE[a]=b}return b}isFlipY(){return!0}enableHardwareClipping(a){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${a} ]`)}enableMultiview(){this.enableExtension("GL_OVR_multiview2","require","fragment"),this.enableExtension("GL_OVR_multiview2","require","vertex"),this.builtins.vertex.push("layout(num_views = 2) in")}registerTransform(a,b){this.transforms.push({varyingName:a,attributeNode:b})}getTransforms(){let a=this.transforms,b="";for(let c=0;c<a.length;c++){let d=a[c],e=this.getPropertyName(d.attributeNode);e&&(b+=`${d.varyingName} = ${e};
	`)}return b}_getGLSLUniformStruct(a,b){return`
layout( std140 ) uniform ${a} {
${b}
};`}_getGLSLVertexCode(a){return`#version 300 es

${this.getSignature()}

// extensions
${a.extensions}

// precision
${xH}

// uniforms
${a.uniforms}

// varyings
${a.varyings}

// attributes
${a.attributes}

// codes
${a.codes}

void main() {

	// vars
	${a.vars}

	// transforms
	${a.transforms}

	// flow
	${a.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(a){return`#version 300 es

${this.getSignature()}

// extensions
${a.extensions}

// precision
${xH}

// structs
${a.structs}

// uniforms
${a.uniforms}

// varyings
${a.varyings}

// codes
${a.codes}

void main() {

	// vars
	${a.vars}

	// flow
	${a.flow}

}
`}buildCode(){let a=null===this.material?{compute:{}}:{fragment:{},vertex:{}};for(let b in this.sortBindingGroups(),a){let c=`// code

`;c+=this.flowCode[b];let d=this.flowNodes[b],e=d[d.length-1];for(let a of d){let d=this.getFlowData(a),f=a.name;f&&(c.length>0&&(c+=`
`),c+=`	// flow -> ${f}
	`),c+=`${d.code}
	`,a===e&&"compute"!==b&&(c+=`// result
	`,"vertex"===b?(c+="gl_Position = ",c+=`${d.result};`):"fragment"===b&&(a.outputNode.isOutputStructNode||(c+="fragColor = ",c+=`${d.result};`)))}let f=a[b];f.extensions=this.getExtensions(b),f.uniforms=this.getUniforms(b),f.attributes=this.getAttributes(b),f.varyings=this.getVaryings(b),f.vars=this.getVars(b),f.structs=this.getStructs(b),f.codes=this.getCodes(b),f.transforms=this.getTransforms(b),f.flow=c}null===this.material?this.computeShader=this._getGLSLVertexCode(a.compute):(this.vertexShader=this._getGLSLVertexCode(a.vertex),this.fragmentShader=this._getGLSLFragmentCode(a.fragment))}getUniformFromNode(a,b,c,d=null){let e=super.getUniformFromNode(a,b,c,d),f=this.getDataFromNode(a,c,this.globalCache),g=f.uniformGPU;if(void 0===g){let d=a.groupNode,h=d.name,i=this.getBindGroupArray(h,c);if("texture"===b)g=new xy(e.name,e.node,d),i.push(g);else if("cubeTexture"===b)g=new xz(e.name,e.node,d),i.push(g);else if("texture3D"===b)g=new xA(e.name,e.node,d),i.push(g);else if("buffer"===b){a.name=`NodeBuffer_${a.id}`,e.name=`buffer${a.id}`;let b=new xr(a,d);b.name=a.name,i.push(b),g=b}else{let a=this.uniformGroups[c]||(this.uniformGroups[c]={}),f=a[h];void 0===f&&(f=new xu(c+"_"+h,d),a[h]=f,i.push(f)),g=this.getNodeUniform(e,b),f.addUniform(g)}f.uniformGPU=g}return e}},xJ=null,xK=null,xL=class{constructor(a={}){this.parameters=Object.assign({},a),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={[bF.RENDER]:null,[bF.COMPUTE]:null},this.trackTimestamp=!0===a.trackTimestamp}async init(a){this.renderer=a}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}updateSampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}updateTimeStampUID(a){let b=this.get(a),c=this.renderer.info.frame;b.timestampUID=(!0===a.isComputeNode?"c:"+this.renderer.info.compute.frameCalls:"r:"+this.renderer.info.render.frameCalls)+":"+a.id+":f"+c}getTimestampUID(a){return this.get(a).timestampUID}getTimestampFrames(a){let b=this.timestampQueryPool[a];return b?b.getTimestampFrames():[]}_getQueryPool(a){let b=a.startsWith("c:")?bF.COMPUTE:bF.RENDER;return this.timestampQueryPool[b]}getTimestamp(a){return this._getQueryPool(a).getTimestamp(a)}hasTimestamp(a){return this._getQueryPool(a).hasTimestamp(a)}isOccluded(){}async resolveTimestampsAsync(a="render"){if(!this.trackTimestamp)return void K("WebGPURenderer: Timestamp tracking is disabled.");let b=this.timestampQueryPool[a];if(!b)return;let c=await b.resolveQueriesAsync();return this.renderer.info[a].timestamp=c,c}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return xJ||(xJ=new bO),this.renderer.getDrawingBufferSize(xJ)}setScissorTest(){}getClearColor(){let a=this.renderer;return xK||(xK=new q7),a.getClearColor(xK),xK.getRGB(xK),xK}getDomElement(){let a,b=this.domElement;return null===b&&("setAttribute"in(b=void 0===this.parameters.canvas?((a=G("canvas")).style.display="block",a):this.parameters.canvas)&&b.setAttribute("data-engine","three.js r181 webgpu"),this.domElement=b),b}set(a,b){this.data.set(a,b)}get(a){let b=this.data.get(a);return void 0===b&&(b={},this.data.set(a,b)),b}has(a){return this.data.has(a)}delete(a){this.data.delete(a)}dispose(){}},xM=0,xN=class{constructor(a,b){this.buffers=[a.bufferGPU,b],this.type=a.type,this.bufferType=a.bufferType,this.pbo=a.pbo,this.byteLength=a.byteLength,this.bytesPerElement=a.BYTES_PER_ELEMENT,this.version=a.version,this.isInteger=a.isInteger,this.activeBufferIndex=0,this.baseId=a.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[1^this.activeBufferIndex]}switchBuffers(){this.activeBufferIndex^=1}},xO=class{constructor(a){this.backend=a}createAttribute(a,b){let c,d=this.backend,{gl:e}=d,f=a.array,g=a.usage||e.STATIC_DRAW,h=a.isInterleavedBufferAttribute?a.data:a,i=d.get(h),j=i.bufferGPU;if(void 0===j&&(i.bufferGPU=j=this._createBuffer(e,b,f,g),i.bufferType=b,i.version=h.version),f instanceof Float32Array)c=e.FLOAT;else if("u">typeof Float16Array&&f instanceof Float16Array)c=e.HALF_FLOAT;else if(f instanceof Uint16Array)c=a.isFloat16BufferAttribute?e.HALF_FLOAT:e.UNSIGNED_SHORT;else if(f instanceof Int16Array)c=e.SHORT;else if(f instanceof Uint32Array)c=e.UNSIGNED_INT;else if(f instanceof Int32Array)c=e.INT;else if(f instanceof Int8Array)c=e.BYTE;else if(f instanceof Uint8Array)c=e.UNSIGNED_BYTE;else if(f instanceof Uint8ClampedArray)c=e.UNSIGNED_BYTE;else throw Error("THREE.WebGLBackend: Unsupported buffer data format: "+f);let k={bufferGPU:j,bufferType:b,type:c,byteLength:f.byteLength,bytesPerElement:f.BYTES_PER_ELEMENT,version:a.version,pbo:a.pbo,isInteger:c===e.INT||c===e.UNSIGNED_INT||1013===a.gpuType,id:xM++};(a.isStorageBufferAttribute||a.isStorageInstancedBufferAttribute)&&(k=new xN(k,this._createBuffer(e,b,f,g))),d.set(a,k)}updateAttribute(a){let b=this.backend,{gl:c}=b,d=a.array,e=a.isInterleavedBufferAttribute?a.data:a,f=b.get(e),g=f.bufferType,h=a.isInterleavedBufferAttribute?a.data.updateRanges:a.updateRanges;if(c.bindBuffer(g,f.bufferGPU),0===h.length)c.bufferSubData(g,0,d);else{for(let a=0,b=h.length;a<b;a++){let b=h[a];c.bufferSubData(g,b.start*d.BYTES_PER_ELEMENT,d,b.start,b.count)}e.clearUpdateRanges()}c.bindBuffer(g,null),f.version=e.version}destroyAttribute(a){let b=this.backend,{gl:c}=b;a.isInterleavedBufferAttribute&&b.delete(a.data);let d=b.get(a);c.deleteBuffer(d.bufferGPU),b.delete(a)}async getArrayBufferAsync(a){let b=this.backend,{gl:c}=b,d=a.isInterleavedBufferAttribute?a.data:a,{bufferGPU:e}=b.get(d),f=a.array,g=f.byteLength;c.bindBuffer(c.COPY_READ_BUFFER,e);let h=c.createBuffer();c.bindBuffer(c.COPY_WRITE_BUFFER,h),c.bufferData(c.COPY_WRITE_BUFFER,g,c.STREAM_READ),c.copyBufferSubData(c.COPY_READ_BUFFER,c.COPY_WRITE_BUFFER,0,0,g),await b.utils._clientWaitAsync();let i=new a.array.constructor(f.length);return c.bindBuffer(c.COPY_WRITE_BUFFER,h),c.getBufferSubData(c.COPY_WRITE_BUFFER,0,i),c.deleteBuffer(h),c.bindBuffer(c.COPY_READ_BUFFER,null),c.bindBuffer(c.COPY_WRITE_BUFFER,null),i.buffer}_createBuffer(a,b,c,d){let e=a.createBuffer();return a.bindBuffer(b,e),a.bufferData(b,c,d),a.bindBuffer(b,null),e}},xR=class{constructor(a){this.backend=a,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){let a=this.gl;xP={100:a.FUNC_ADD,101:a.FUNC_SUBTRACT,102:a.FUNC_REVERSE_SUBTRACT},xQ={200:a.ZERO,201:a.ONE,202:a.SRC_COLOR,204:a.SRC_ALPHA,210:a.SRC_ALPHA_SATURATE,208:a.DST_COLOR,206:a.DST_ALPHA,203:a.ONE_MINUS_SRC_COLOR,205:a.ONE_MINUS_SRC_ALPHA,209:a.ONE_MINUS_DST_COLOR,207:a.ONE_MINUS_DST_ALPHA};let b=a.getParameter(a.SCISSOR_BOX),c=a.getParameter(a.VIEWPORT);this.currentScissor=new b3().fromArray(b),this.currentViewport=new b3().fromArray(c),this._tempVec4=new b3}enable(a){let{enabled:b}=this;!0!==b[a]&&(this.gl.enable(a),b[a]=!0)}disable(a){let{enabled:b}=this;!1!==b[a]&&(this.gl.disable(a),b[a]=!1)}setFlipSided(a){if(this.currentFlipSided!==a){let{gl:b}=this;a?b.frontFace(b.CW):b.frontFace(b.CCW),this.currentFlipSided=a}}setCullFace(a){let{gl:b}=this;0===a?this.disable(b.CULL_FACE):(this.enable(b.CULL_FACE),a!==this.currentCullFace&&(1===a?b.cullFace(b.BACK):2===a?b.cullFace(b.FRONT):b.cullFace(b.FRONT_AND_BACK))),this.currentCullFace=a}setLineWidth(a){let{currentLineWidth:b,gl:c}=this;a!==b&&(c.lineWidth(a),this.currentLineWidth=a)}setBlending(a,b,c,d,e,f,g,h){let{gl:i}=this;if(0===a){!0===this.currentBlendingEnabled&&(this.disable(i.BLEND),this.currentBlendingEnabled=!1);return}if(!1===this.currentBlendingEnabled&&(this.enable(i.BLEND),this.currentBlendingEnabled=!0),5!==a){if(a!==this.currentBlending||h!==this.currentPremultipledAlpha){if((100!==this.currentBlendEquation||100!==this.currentBlendEquationAlpha)&&(i.blendEquation(i.FUNC_ADD),this.currentBlendEquation=100,this.currentBlendEquationAlpha=100),h)switch(a){case 1:i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case 2:i.blendFunc(i.ONE,i.ONE);break;case 3:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case 4:i.blendFuncSeparate(i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA,i.ZERO,i.ONE);break;default:J("WebGLState: Invalid blending: ",a)}else switch(a){case 1:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case 2:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE,i.ONE,i.ONE);break;case 3:J("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case 4:J("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:J("WebGLState: Invalid blending: ",a)}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=a,this.currentPremultipledAlpha=h}return}e||(e=b),f||(f=c),g||(g=d),(b!==this.currentBlendEquation||e!==this.currentBlendEquationAlpha)&&(i.blendEquationSeparate(xP[b],xP[e]),this.currentBlendEquation=b,this.currentBlendEquationAlpha=e),(c!==this.currentBlendSrc||d!==this.currentBlendDst||f!==this.currentBlendSrcAlpha||g!==this.currentBlendDstAlpha)&&(i.blendFuncSeparate(xQ[c],xQ[d],xQ[f],xQ[g]),this.currentBlendSrc=c,this.currentBlendDst=d,this.currentBlendSrcAlpha=f,this.currentBlendDstAlpha=g),this.currentBlending=a,this.currentPremultipledAlpha=!1}setColorMask(a){this.currentColorMask!==a&&(this.gl.colorMask(a,a,a,a),this.currentColorMask=a)}setDepthTest(a){let{gl:b}=this;a?this.enable(b.DEPTH_TEST):this.disable(b.DEPTH_TEST)}setDepthMask(a){this.currentDepthMask!==a&&(this.gl.depthMask(a),this.currentDepthMask=a)}setDepthFunc(a){if(this.currentDepthFunc!==a){let{gl:b}=this;switch(a){case 0:b.depthFunc(b.NEVER);break;case 1:b.depthFunc(b.ALWAYS);break;case 2:b.depthFunc(b.LESS);break;case 3:default:b.depthFunc(b.LEQUAL);break;case 4:b.depthFunc(b.EQUAL);break;case 5:b.depthFunc(b.GEQUAL);break;case 6:b.depthFunc(b.GREATER);break;case 7:b.depthFunc(b.NOTEQUAL)}this.currentDepthFunc=a}}scissor(a,b,c,d){let e=this._tempVec4.set(a,b,c,d);if(!1===this.currentScissor.equals(e)){let{gl:a}=this;a.scissor(e.x,e.y,e.z,e.w),this.currentScissor.copy(e)}}viewport(a,b,c,d){let e=this._tempVec4.set(a,b,c,d);if(!1===this.currentViewport.equals(e)){let{gl:a}=this;a.viewport(e.x,e.y,e.z,e.w),this.currentViewport.copy(e)}}setScissorTest(a){let b=this.gl;a?b.enable(b.SCISSOR_TEST):b.disable(b.SCISSOR_TEST)}setStencilTest(a){let{gl:b}=this;a?this.enable(b.STENCIL_TEST):this.disable(b.STENCIL_TEST)}setStencilMask(a){this.currentStencilMask!==a&&(this.gl.stencilMask(a),this.currentStencilMask=a)}setStencilFunc(a,b,c){(this.currentStencilFunc!==a||this.currentStencilRef!==b||this.currentStencilFuncMask!==c)&&(this.gl.stencilFunc(a,b,c),this.currentStencilFunc=a,this.currentStencilRef=b,this.currentStencilFuncMask=c)}setStencilOp(a,b,c){(this.currentStencilFail!==a||this.currentStencilZFail!==b||this.currentStencilZPass!==c)&&(this.gl.stencilOp(a,b,c),this.currentStencilFail=a,this.currentStencilZFail=b,this.currentStencilZPass=c)}setMaterial(a,b,c){let{gl:d}=this;2===a.side?this.disable(d.CULL_FACE):this.enable(d.CULL_FACE);let e=1===a.side;b&&(e=!e),this.setFlipSided(e),1===a.blending&&!1===a.transparent?this.setBlending(0):this.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst,a.blendEquationAlpha,a.blendSrcAlpha,a.blendDstAlpha,a.premultipliedAlpha),this.setDepthFunc(a.depthFunc),this.setDepthTest(a.depthTest),this.setDepthMask(a.depthWrite),this.setColorMask(a.colorWrite);let f=a.stencilWrite;if(this.setStencilTest(f),f&&(this.setStencilMask(a.stencilWriteMask),this.setStencilFunc(a.stencilFunc,a.stencilRef,a.stencilFuncMask),this.setStencilOp(a.stencilFail,a.stencilZFail,a.stencilZPass)),this.setPolygonOffset(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits),!0===a.alphaToCoverage&&this.backend.renderer.currentSamples>0?this.enable(d.SAMPLE_ALPHA_TO_COVERAGE):this.disable(d.SAMPLE_ALPHA_TO_COVERAGE),c>0&&this.currentClippingPlanes!==c)for(let a=0;a<8;a++)a<c?this.enable(12288+a):this.disable(12288+a)}setPolygonOffset(a,b,c){let{gl:d}=this;a?(this.enable(d.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==b||this.currentPolygonOffsetUnits!==c)&&(d.polygonOffset(b,c),this.currentPolygonOffsetFactor=b,this.currentPolygonOffsetUnits=c)):this.disable(d.POLYGON_OFFSET_FILL)}useProgram(a){return this.currentProgram!==a&&(this.gl.useProgram(a),this.currentProgram=a,!0)}setVertexState(a,b=null){let c=this.gl;return(this.currentVAO!==a||this.currentIndex!==b)&&(c.bindVertexArray(a),null!==b&&c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,b),this.currentVAO=a,this.currentIndex=b,!0)}resetVertexState(){let a=this.gl;a.bindVertexArray(null),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(a,b){let{gl:c,currentBoundFramebuffers:d}=this;return d[a]!==b&&(c.bindFramebuffer(a,b),d[a]=b,a===c.DRAW_FRAMEBUFFER&&(d[c.FRAMEBUFFER]=b),a===c.FRAMEBUFFER&&(d[c.DRAW_FRAMEBUFFER]=b),!0)}drawBuffers(a,b){let{gl:c}=this,d=[],e=!1;if(null!==a.textures){void 0===(d=this.currentDrawbuffers.get(b))&&(d=[],this.currentDrawbuffers.set(b,d));let f=a.textures;if(d.length!==f.length||d[0]!==c.COLOR_ATTACHMENT0){for(let a=0,b=f.length;a<b;a++)d[a]=c.COLOR_ATTACHMENT0+a;d.length=f.length,e=!0}}else d[0]!==c.BACK&&(d[0]=c.BACK,e=!0);e&&c.drawBuffers(d)}activeTexture(a){let{gl:b,currentTextureSlot:c,maxTextures:d}=this;void 0===a&&(a=b.TEXTURE0+d-1),c!==a&&(b.activeTexture(a),this.currentTextureSlot=a)}bindTexture(a,b,c){let{gl:d,currentTextureSlot:e,currentBoundTextures:f,maxTextures:g}=this;void 0===c&&(c=null===e?d.TEXTURE0+g-1:e);let h=f[c];void 0===h&&(h={type:void 0,texture:void 0},f[c]=h),(h.type!==a||h.texture!==b)&&(e!==c&&(d.activeTexture(c),this.currentTextureSlot=c),d.bindTexture(a,b),h.type=a,h.texture=b)}bindBufferBase(a,b,c){let{gl:d}=this,e=`${a}-${b}`;return this.currentBoundBufferBases[e]!==c&&(d.bindBufferBase(a,b,c),this.currentBoundBufferBases[e]=c,!0)}unbindTexture(){let{gl:a,currentTextureSlot:b,currentBoundTextures:c}=this,d=c[b];void 0!==d&&void 0!==d.type&&(a.bindTexture(d.type,null),d.type=void 0,d.texture=void 0)}},xS=class{constructor(a){this.backend=a,this.gl=this.backend.gl,this.extensions=a.extensions}convert(a,b=""){let{gl:c,extensions:d}=this,e,f=bX.getTransfer(b);if(1009===a)return c.UNSIGNED_BYTE;if(1017===a)return c.UNSIGNED_SHORT_4_4_4_4;if(1018===a)return c.UNSIGNED_SHORT_5_5_5_1;if(35902===a)return c.UNSIGNED_INT_5_9_9_9_REV;if(35899===a)return c.UNSIGNED_INT_10F_11F_11F_REV;if(1010===a)return c.BYTE;if(1011===a)return c.SHORT;if(1012===a)return c.UNSIGNED_SHORT;if(1013===a)return c.INT;if(1014===a)return c.UNSIGNED_INT;if(1015===a)return c.FLOAT;if(1016===a)return c.HALF_FLOAT;if(1021===a)return c.ALPHA;if(1022===a)return c.RGB;if(1023===a)return c.RGBA;if(1026===a)return c.DEPTH_COMPONENT;if(1027===a)return c.DEPTH_STENCIL;if(1028===a)return c.RED;if(1029===a)return c.RED_INTEGER;if(1030===a)return c.RG;if(1031===a)return c.RG_INTEGER;if(1033===a)return c.RGBA_INTEGER;if(33776===a||33777===a||33778===a||33779===a)if("srgb"===f)if(null===(e=d.get("WEBGL_compressed_texture_s3tc_srgb")))return null;else{if(33776===a)return e.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(33777===a)return e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(33778===a)return e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(33779===a)return e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(e=d.get("WEBGL_compressed_texture_s3tc")))return null;if(33776===a)return e.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===a)return e.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===a)return e.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===a)return e.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===a||35841===a||35842===a||35843===a)if(null===(e=d.get("WEBGL_compressed_texture_pvrtc")))return null;else{if(35840===a)return e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===a)return e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===a)return e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===a)return e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===a||37492===a||37496===a)if(null===(e=d.get("WEBGL_compressed_texture_etc")))return null;else{if(36196===a||37492===a)return"srgb"===f?e.COMPRESSED_SRGB8_ETC2:e.COMPRESSED_RGB8_ETC2;if(37496===a)return"srgb"===f?e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:e.COMPRESSED_RGBA8_ETC2_EAC}if(37808===a||37809===a||37810===a||37811===a||37812===a||37813===a||37814===a||37815===a||37816===a||37817===a||37818===a||37819===a||37820===a||37821===a)if(null===(e=d.get("WEBGL_compressed_texture_astc")))return null;else{if(37808===a)return"srgb"===f?e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:e.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===a)return"srgb"===f?e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:e.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===a)return"srgb"===f?e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:e.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===a)return"srgb"===f?e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:e.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===a)return"srgb"===f?e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:e.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===a)return"srgb"===f?e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:e.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===a)return"srgb"===f?e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:e.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===a)return"srgb"===f?e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:e.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===a)return"srgb"===f?e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:e.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===a)return"srgb"===f?e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:e.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===a)return"srgb"===f?e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:e.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===a)return"srgb"===f?e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:e.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===a)return"srgb"===f?e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:e.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===a)return"srgb"===f?e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:e.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===a){if(null===(e=d.get("EXT_texture_compression_bptc")))return null;else if(36492===a)return"srgb"===f?e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:e.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(36283===a||36284===a||36285===a||36286===a)if(null===(e=d.get("EXT_texture_compression_rgtc")))return null;else{if(36283===a)return e.COMPRESSED_RED_RGTC1_EXT;if(36284===a)return e.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===a)return e.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===a)return e.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return 1020===a?c.UNSIGNED_INT_24_8:void 0===c[a]?null:c[a]}_clientWaitAsync(){let{gl:a}=this,b=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);return a.flush(),new Promise((c,d)=>{!function e(){let f=a.clientWaitSync(b,a.SYNC_FLUSH_COMMANDS_BIT,0);if(f===a.WAIT_FAILED){a.deleteSync(b),d();return}f===a.TIMEOUT_EXPIRED?requestAnimationFrame(e):(a.deleteSync(b),c())}()})}},xT=!1,xX=class{constructor(a){this.backend=a,this.gl=a.gl,this.extensions=a.extensions,this.defaultTextures={},this._srcFramebuffer=null,this._dstFramebuffer=null,!1===xT&&(this._init(),xT=!0)}_init(){let a=this.gl;xU={[ap]:a.REPEAT,[aq]:a.CLAMP_TO_EDGE,[ar]:a.MIRRORED_REPEAT},xV={[as]:a.NEAREST,[at]:a.NEAREST_MIPMAP_NEAREST,[au]:a.NEAREST_MIPMAP_LINEAR,[av]:a.LINEAR,[aw]:a.LINEAR_MIPMAP_NEAREST,[ax]:a.LINEAR_MIPMAP_LINEAR},xW={512:a.NEVER,519:a.ALWAYS,513:a.LESS,515:a.LEQUAL,514:a.EQUAL,518:a.GEQUAL,516:a.GREATER,517:a.NOTEQUAL}}getGLTextureType(a){let{gl:b}=this;return!0===a.isCubeTexture?b.TEXTURE_CUBE_MAP:!0===a.isArrayTexture||!0===a.isDataArrayTexture||!0===a.isCompressedArrayTexture?b.TEXTURE_2D_ARRAY:!0===a.isData3DTexture?b.TEXTURE_3D:b.TEXTURE_2D}getInternalFormat(a,b,c,d,e=!1){let{gl:f,extensions:g}=this;if(null!==a){if(void 0!==f[a])return f[a];I("WebGLBackend: Attempt to use non-existing WebGL internal format '"+a+"'")}let h=b;if(b===f.RED&&(c===f.FLOAT&&(h=f.R32F),c===f.HALF_FLOAT&&(h=f.R16F),c===f.UNSIGNED_BYTE&&(h=f.R8),c===f.UNSIGNED_SHORT&&(h=f.R16),c===f.UNSIGNED_INT&&(h=f.R32UI),c===f.BYTE&&(h=f.R8I),c===f.SHORT&&(h=f.R16I),c===f.INT&&(h=f.R32I)),b===f.RED_INTEGER&&(c===f.UNSIGNED_BYTE&&(h=f.R8UI),c===f.UNSIGNED_SHORT&&(h=f.R16UI),c===f.UNSIGNED_INT&&(h=f.R32UI),c===f.BYTE&&(h=f.R8I),c===f.SHORT&&(h=f.R16I),c===f.INT&&(h=f.R32I)),b===f.RG&&(c===f.FLOAT&&(h=f.RG32F),c===f.HALF_FLOAT&&(h=f.RG16F),c===f.UNSIGNED_BYTE&&(h=f.RG8),c===f.UNSIGNED_SHORT&&(h=f.RG16),c===f.UNSIGNED_INT&&(h=f.RG32UI),c===f.BYTE&&(h=f.RG8I),c===f.SHORT&&(h=f.RG16I),c===f.INT&&(h=f.RG32I)),b===f.RG_INTEGER&&(c===f.UNSIGNED_BYTE&&(h=f.RG8UI),c===f.UNSIGNED_SHORT&&(h=f.RG16UI),c===f.UNSIGNED_INT&&(h=f.RG32UI),c===f.BYTE&&(h=f.RG8I),c===f.SHORT&&(h=f.RG16I),c===f.INT&&(h=f.RG32I)),b===f.RGB){let a=e?bt:bX.getTransfer(d);c===f.FLOAT&&(h=f.RGB32F),c===f.HALF_FLOAT&&(h=f.RGB16F),c===f.UNSIGNED_BYTE&&(h=f.RGB8),c===f.UNSIGNED_SHORT&&(h=f.RGB16),c===f.UNSIGNED_INT&&(h=f.RGB32UI),c===f.BYTE&&(h=f.RGB8I),c===f.SHORT&&(h=f.RGB16I),c===f.INT&&(h=f.RGB32I),c===f.UNSIGNED_BYTE&&(h="srgb"===a?f.SRGB8:f.RGB8),c===f.UNSIGNED_SHORT_5_6_5&&(h=f.RGB565),c===f.UNSIGNED_SHORT_5_5_5_1&&(h=f.RGB5_A1),c===f.UNSIGNED_SHORT_4_4_4_4&&(h=f.RGB4),c===f.UNSIGNED_INT_5_9_9_9_REV&&(h=f.RGB9_E5),c===f.UNSIGNED_INT_10F_11F_11F_REV&&(h=f.R11F_G11F_B10F)}if(b===f.RGB_INTEGER&&(c===f.UNSIGNED_BYTE&&(h=f.RGB8UI),c===f.UNSIGNED_SHORT&&(h=f.RGB16UI),c===f.UNSIGNED_INT&&(h=f.RGB32UI),c===f.BYTE&&(h=f.RGB8I),c===f.SHORT&&(h=f.RGB16I),c===f.INT&&(h=f.RGB32I)),b===f.RGBA){let a=e?bt:bX.getTransfer(d);c===f.FLOAT&&(h=f.RGBA32F),c===f.HALF_FLOAT&&(h=f.RGBA16F),c===f.UNSIGNED_BYTE&&(h=f.RGBA8),c===f.UNSIGNED_SHORT&&(h=f.RGBA16),c===f.UNSIGNED_INT&&(h=f.RGBA32UI),c===f.BYTE&&(h=f.RGBA8I),c===f.SHORT&&(h=f.RGBA16I),c===f.INT&&(h=f.RGBA32I),c===f.UNSIGNED_BYTE&&(h="srgb"===a?f.SRGB8_ALPHA8:f.RGBA8),c===f.UNSIGNED_SHORT_4_4_4_4&&(h=f.RGBA4),c===f.UNSIGNED_SHORT_5_5_5_1&&(h=f.RGB5_A1)}return b===f.RGBA_INTEGER&&(c===f.UNSIGNED_BYTE&&(h=f.RGBA8UI),c===f.UNSIGNED_SHORT&&(h=f.RGBA16UI),c===f.UNSIGNED_INT&&(h=f.RGBA32UI),c===f.BYTE&&(h=f.RGBA8I),c===f.SHORT&&(h=f.RGBA16I),c===f.INT&&(h=f.RGBA32I)),b===f.DEPTH_COMPONENT&&(c===f.UNSIGNED_SHORT&&(h=f.DEPTH_COMPONENT16),c===f.UNSIGNED_INT&&(h=f.DEPTH_COMPONENT24),c===f.FLOAT&&(h=f.DEPTH_COMPONENT32F)),b===f.DEPTH_STENCIL&&c===f.UNSIGNED_INT_24_8&&(h=f.DEPTH24_STENCIL8),(h===f.R16F||h===f.R32F||h===f.RG16F||h===f.RG32F||h===f.RGBA16F||h===f.RGBA32F)&&g.get("EXT_color_buffer_float"),h}setTextureParameters(a,b){let{gl:c,extensions:d,backend:e}=this,f=bX.getPrimaries(bX.workingColorSpace),g=""===b.colorSpace?null:bX.getPrimaries(b.colorSpace),h=""===b.colorSpace||f===g?c.NONE:c.BROWSER_DEFAULT_WEBGL;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,b.flipY),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlpha),c.pixelStorei(c.UNPACK_ALIGNMENT,b.unpackAlignment),c.pixelStorei(c.UNPACK_COLORSPACE_CONVERSION_WEBGL,h),c.texParameteri(a,c.TEXTURE_WRAP_S,xU[b.wrapS]),c.texParameteri(a,c.TEXTURE_WRAP_T,xU[b.wrapT]),(a===c.TEXTURE_3D||a===c.TEXTURE_2D_ARRAY)&&(b.isArrayTexture||c.texParameteri(a,c.TEXTURE_WRAP_R,xU[b.wrapR])),c.texParameteri(a,c.TEXTURE_MAG_FILTER,xV[b.magFilter]);let i=void 0!==b.mipmaps&&b.mipmaps.length>0,j=1006===b.minFilter&&i?ax:b.minFilter;if(c.texParameteri(a,c.TEXTURE_MIN_FILTER,xV[j]),b.compareFunction&&(c.texParameteri(a,c.TEXTURE_COMPARE_MODE,c.COMPARE_REF_TO_TEXTURE),c.texParameteri(a,c.TEXTURE_COMPARE_FUNC,xW[b.compareFunction])),!0===d.has("EXT_texture_filter_anisotropic")){if(1003===b.magFilter||1005!==b.minFilter&&1008!==b.minFilter||1015===b.type&&!1===d.has("OES_texture_float_linear"))return;if(b.anisotropy>1){let f=d.get("EXT_texture_filter_anisotropic");c.texParameterf(a,f.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(b.anisotropy,e.getMaxAnisotropy()))}}}createDefaultTexture(a){let{gl:b,backend:c,defaultTextures:d}=this,e=this.getGLTextureType(a),f=d[e];void 0===f&&(f=b.createTexture(),c.state.bindTexture(e,f),b.texParameteri(e,b.TEXTURE_MIN_FILTER,b.NEAREST),b.texParameteri(e,b.TEXTURE_MAG_FILTER,b.NEAREST),d[e]=f),c.set(a,{textureGPU:f,glTextureType:e})}createTexture(a,b){let{gl:c,backend:d}=this,{levels:e,width:f,height:g,depth:h}=b,i=d.utils.convert(a.format,a.colorSpace),j=d.utils.convert(a.type),k=this.getInternalFormat(a.internalFormat,i,j,a.colorSpace,a.isVideoTexture),l=c.createTexture(),m=this.getGLTextureType(a);d.state.bindTexture(m,l),this.setTextureParameters(m,a),a.isArrayTexture||a.isDataArrayTexture||a.isCompressedArrayTexture?c.texStorage3D(c.TEXTURE_2D_ARRAY,e,k,f,g,h):a.isData3DTexture?c.texStorage3D(c.TEXTURE_3D,e,k,f,g,h):a.isVideoTexture||c.texStorage2D(m,e,k,f,g),d.set(a,{textureGPU:l,glTextureType:m,glFormat:i,glType:j,glInternalFormat:k})}copyBufferToTexture(a,b){let{gl:c,backend:d}=this,{textureGPU:e,glTextureType:f,glFormat:g,glType:h}=d.get(b),{width:i,height:j}=b.source.data;c.bindBuffer(c.PIXEL_UNPACK_BUFFER,a),d.state.bindTexture(f,e),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,!1),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),c.texSubImage2D(f,0,0,0,i,j,g,h,0),c.bindBuffer(c.PIXEL_UNPACK_BUFFER,null),d.state.unbindTexture()}updateTexture(a,b){let{gl:c}=this,{width:d,height:e}=b,{textureGPU:f,glTextureType:g,glFormat:h,glType:i,glInternalFormat:j}=this.backend.get(a);if(!(a.isRenderTargetTexture||void 0===f))if(this.backend.state.bindTexture(g,f),this.setTextureParameters(g,a),a.isCompressedTexture){let d=a.mipmaps,e=b.image;for(let b=0;b<d.length;b++){let f=d[b];a.isCompressedArrayTexture?a.format===c.RGBA?c.texSubImage3D(c.TEXTURE_2D_ARRAY,b,0,0,0,f.width,f.height,e.depth,h,i,f.data):null===h?I("WebGLBackend: Attempt to load unsupported compressed texture format in .uploadTexture()"):c.compressedTexSubImage3D(c.TEXTURE_2D_ARRAY,b,0,0,0,f.width,f.height,e.depth,h,f.data):null===h?I("WebGLBackend: Unsupported compressed texture format"):c.compressedTexSubImage2D(c.TEXTURE_2D,b,0,0,f.width,f.height,h,f.data)}}else if(a.isCubeTexture){let f=b.images,g=a.mipmaps;for(let a=0;a<6;a++){let b=f3(f[a]);c.texSubImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,0,0,d,e,h,i,b);for(let b=0;b<g.length;b++){let d=f3(g[b].images[a]);c.texSubImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+a,b+1,0,0,d.width,d.height,h,i,d)}}}else if(a.isDataArrayTexture||a.isArrayTexture){let d=b.image;if(a.layerUpdates.size>0){let b=function(a,b,c,d){let e=function(a){switch(a){case az:case aA:return{byteLength:1,components:1};case aC:case aB:case aG:return{byteLength:2,components:1};case aH:case aI:return{byteLength:2,components:4};case aE:case aD:case aF:return{byteLength:4,components:1};case aK:case aL:return{byteLength:4,components:3}}throw Error(`Unknown texture type ${a}.`)}(d);switch(c){case aM:return a*b;case aR:case aS:return a*b/e.components*e.byteLength;case aT:case aU:return a*b*2/e.components*e.byteLength;case aN:return a*b*3/e.components*e.byteLength;case aO:case aW:return a*b*4/e.components*e.byteLength;case aX:case aY:return Math.floor((a+3)/4)*Math.floor((b+3)/4)*8;case aZ:case a$:return Math.floor((a+3)/4)*Math.floor((b+3)/4)*16;case a0:case a2:return Math.max(a,16)*Math.max(b,8)/4;case a_:case a1:return Math.max(a,8)*Math.max(b,8)/2;case a3:case a4:return Math.floor((a+3)/4)*Math.floor((b+3)/4)*8;case a5:case a6:return Math.floor((a+3)/4)*Math.floor((b+3)/4)*16;case a7:return Math.floor((a+4)/5)*Math.floor((b+3)/4)*16;case a8:return Math.floor((a+4)/5)*Math.floor((b+4)/5)*16;case a9:return Math.floor((a+5)/6)*Math.floor((b+4)/5)*16;case ba:return Math.floor((a+5)/6)*Math.floor((b+5)/6)*16;case bb:return Math.floor((a+7)/8)*Math.floor((b+4)/5)*16;case bc:return Math.floor((a+7)/8)*Math.floor((b+5)/6)*16;case bd:return Math.floor((a+7)/8)*Math.floor((b+7)/8)*16;case be:return Math.floor((a+9)/10)*Math.floor((b+4)/5)*16;case bf:return Math.floor((a+9)/10)*Math.floor((b+5)/6)*16;case bg:return Math.floor((a+9)/10)*Math.floor((b+7)/8)*16;case bh:return Math.floor((a+9)/10)*Math.floor((b+9)/10)*16;case bi:return Math.floor((a+11)/12)*Math.floor((b+9)/10)*16;case bj:return Math.floor((a+11)/12)*Math.floor((b+11)/12)*16;case bk:case bl:case bm:return Math.ceil(a/4)*Math.ceil(b/4)*16;case bn:case bo:return Math.ceil(a/4)*Math.ceil(b/4)*8;case bp:case bq:return Math.ceil(a/4)*Math.ceil(b/4)*16}throw Error(`Unable to determine texture byte length for ${c} format.`)}(d.width,d.height,a.format,a.type);for(let e of a.layerUpdates){let a=d.data.subarray(e*b/d.data.BYTES_PER_ELEMENT,(e+1)*b/d.data.BYTES_PER_ELEMENT);c.texSubImage3D(c.TEXTURE_2D_ARRAY,0,0,0,e,d.width,d.height,1,h,i,a)}a.clearLayerUpdates()}else c.texSubImage3D(c.TEXTURE_2D_ARRAY,0,0,0,0,d.width,d.height,d.depth,h,i,d.data)}else if(a.isData3DTexture){let a=b.image;c.texSubImage3D(c.TEXTURE_3D,0,0,0,0,a.width,a.height,a.depth,h,i,a.data)}else if(a.isVideoTexture)a.update(),c.texImage2D(g,0,j,h,i,b.image);else{let f=a.mipmaps;if(f.length>0)for(let a=0,b=f.length;a<b;a++){let b=f[a],d=f3(b);c.texSubImage2D(g,a,0,0,b.width,b.height,h,i,d)}else{let a=f3(b.image);c.texSubImage2D(g,0,0,0,d,e,h,i,a)}}}generateMipmaps(a){let{gl:b,backend:c}=this,{textureGPU:d,glTextureType:e}=c.get(a);c.state.bindTexture(e,d),b.generateMipmap(e)}deallocateRenderBuffers(a){let{gl:b,backend:c}=this;if(a){let d=c.get(a);if(d.renderBufferStorageSetup=void 0,d.framebuffers){for(let a in d.framebuffers)b.deleteFramebuffer(d.framebuffers[a]);delete d.framebuffers}if(d.depthRenderbuffer&&(b.deleteRenderbuffer(d.depthRenderbuffer),delete d.depthRenderbuffer),d.stencilRenderbuffer&&(b.deleteRenderbuffer(d.stencilRenderbuffer),delete d.stencilRenderbuffer),d.msaaFrameBuffer&&(b.deleteFramebuffer(d.msaaFrameBuffer),delete d.msaaFrameBuffer),d.msaaRenderbuffers){for(let a=0;a<d.msaaRenderbuffers.length;a++)b.deleteRenderbuffer(d.msaaRenderbuffers[a]);delete d.msaaRenderbuffers}}}destroyTexture(a,b=!1){let{gl:c,backend:d}=this,{textureGPU:e,renderTarget:f}=d.get(a);this.deallocateRenderBuffers(f),!1===b&&c.deleteTexture(e),d.delete(a)}copyTextureToTexture(a,b,c=null,d=null,e=0,f=0){let{gl:g,backend:h}=this,{state:i}=this.backend,{textureGPU:j,glTextureType:k,glType:l,glFormat:m}=h.get(b);i.bindTexture(k,j);let n,o,p,q,r,s,t,u,v,w=a.isCompressedTexture?a.mipmaps[f]:a.image;if(null!==c)n=c.max.x-c.min.x,o=c.max.y-c.min.y,p=c.isBox3?c.max.z-c.min.z:1,q=c.min.x,r=c.min.y,s=c.isBox3?c.min.z:0;else{let b=2**-e;n=Math.floor(w.width*b),o=Math.floor(w.height*b),p=a.isDataArrayTexture||a.isArrayTexture?w.depth:a.isData3DTexture?Math.floor(w.depth*b):1,q=0,r=0,s=0}null===d?(t=0,u=0,v=0):(t=d.x,u=d.y,v=d.z),g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,b.flipY),g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlpha),g.pixelStorei(g.UNPACK_ALIGNMENT,b.unpackAlignment);let x=g.getParameter(g.UNPACK_ROW_LENGTH),y=g.getParameter(g.UNPACK_IMAGE_HEIGHT),z=g.getParameter(g.UNPACK_SKIP_PIXELS),A=g.getParameter(g.UNPACK_SKIP_ROWS),B=g.getParameter(g.UNPACK_SKIP_IMAGES);g.pixelStorei(g.UNPACK_ROW_LENGTH,w.width),g.pixelStorei(g.UNPACK_IMAGE_HEIGHT,w.height),g.pixelStorei(g.UNPACK_SKIP_PIXELS,q),g.pixelStorei(g.UNPACK_SKIP_ROWS,r),g.pixelStorei(g.UNPACK_SKIP_IMAGES,s);let C=a.isDataArrayTexture||a.isData3DTexture||b.isArrayTexture,D=b.isDataArrayTexture||b.isData3DTexture||b.isArrayTexture;if(a.isDepthTexture){let c=h.get(a),d=h.get(b),k=h.get(c.renderTarget),l=h.get(d.renderTarget),m=k.framebuffers[c.cacheKey],w=l.framebuffers[d.cacheKey];i.bindFramebuffer(g.READ_FRAMEBUFFER,m),i.bindFramebuffer(g.DRAW_FRAMEBUFFER,w);for(let a=0;a<p;a++)C&&(g.framebufferTextureLayer(g.READ_FRAMEBUFFER,g.COLOR_ATTACHMENT0,c.textureGPU,e,s+a),g.framebufferTextureLayer(g.DRAW_FRAMEBUFFER,g.COLOR_ATTACHMENT0,j,f,v+a)),g.blitFramebuffer(q,r,n,o,t,u,n,o,g.DEPTH_BUFFER_BIT,g.NEAREST);i.bindFramebuffer(g.READ_FRAMEBUFFER,null),i.bindFramebuffer(g.DRAW_FRAMEBUFFER,null)}else if(0!==e||a.isRenderTargetTexture||h.has(a)){let b=h.get(a);null===this._srcFramebuffer&&(this._srcFramebuffer=g.createFramebuffer()),null===this._dstFramebuffer&&(this._dstFramebuffer=g.createFramebuffer()),i.bindFramebuffer(g.READ_FRAMEBUFFER,this._srcFramebuffer),i.bindFramebuffer(g.DRAW_FRAMEBUFFER,this._dstFramebuffer);for(let a=0;a<p;a++)C?g.framebufferTextureLayer(g.READ_FRAMEBUFFER,g.COLOR_ATTACHMENT0,b.textureGPU,e,s+a):g.framebufferTexture2D(g.READ_FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,b.textureGPU,e),D?g.framebufferTextureLayer(g.DRAW_FRAMEBUFFER,g.COLOR_ATTACHMENT0,j,f,v+a):g.framebufferTexture2D(g.DRAW_FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,j,f),0===e?D?g.copyTexSubImage3D(k,f,t,u,v+a,q,r,n,o):g.copyTexSubImage2D(k,f,t,u,q,r,n,o):g.blitFramebuffer(q,r,n,o,t,u,n,o,g.COLOR_BUFFER_BIT,g.NEAREST);i.bindFramebuffer(g.READ_FRAMEBUFFER,null),i.bindFramebuffer(g.DRAW_FRAMEBUFFER,null)}else D?a.isDataTexture||a.isData3DTexture?g.texSubImage3D(k,f,t,u,v,n,o,p,m,l,w.data):b.isCompressedArrayTexture?g.compressedTexSubImage3D(k,f,t,u,v,n,o,p,m,w.data):g.texSubImage3D(k,f,t,u,v,n,o,p,m,l,w):a.isDataTexture?g.texSubImage2D(g.TEXTURE_2D,f,t,u,n,o,m,l,w.data):a.isCompressedTexture?g.compressedTexSubImage2D(g.TEXTURE_2D,f,t,u,w.width,w.height,m,w.data):g.texSubImage2D(g.TEXTURE_2D,f,t,u,n,o,m,l,w);g.pixelStorei(g.UNPACK_ROW_LENGTH,x),g.pixelStorei(g.UNPACK_IMAGE_HEIGHT,y),g.pixelStorei(g.UNPACK_SKIP_PIXELS,z),g.pixelStorei(g.UNPACK_SKIP_ROWS,A),g.pixelStorei(g.UNPACK_SKIP_IMAGES,B),0===f&&b.generateMipmaps&&g.generateMipmap(k),i.unbindTexture()}copyFramebufferToTexture(a,b,c){let{gl:d}=this,{state:e}=this.backend,{textureGPU:f}=this.backend.get(a),{x:g,y:h,z:i,w:j}=c,k=!0===a.isDepthTexture||b.renderTarget&&b.renderTarget.samples>0,l=b.renderTarget?b.renderTarget.height:this.backend.getDrawingBufferSize().y;if(k){let c=0!==g||0!==h,k,m;if(!0===a.isDepthTexture?(k=d.DEPTH_BUFFER_BIT,m=d.DEPTH_ATTACHMENT,b.stencil&&(k|=d.STENCIL_BUFFER_BIT)):(k=d.COLOR_BUFFER_BIT,m=d.COLOR_ATTACHMENT0),c){let a=this.backend.get(b.renderTarget),c=a.framebuffers[b.getCacheKey()],m=a.msaaFrameBuffer;e.bindFramebuffer(d.DRAW_FRAMEBUFFER,c),e.bindFramebuffer(d.READ_FRAMEBUFFER,m);let n=l-h-j;d.blitFramebuffer(g,n,g+i,n+j,g,n,g+i,n+j,k,d.NEAREST),e.bindFramebuffer(d.READ_FRAMEBUFFER,c),e.bindTexture(d.TEXTURE_2D,f),d.copyTexSubImage2D(d.TEXTURE_2D,0,0,0,g,n,i,j),e.unbindTexture()}else{let a=d.createFramebuffer();e.bindFramebuffer(d.DRAW_FRAMEBUFFER,a),d.framebufferTexture2D(d.DRAW_FRAMEBUFFER,m,d.TEXTURE_2D,f,0),d.blitFramebuffer(0,0,i,j,0,0,i,j,k,d.NEAREST),d.deleteFramebuffer(a)}}else e.bindTexture(d.TEXTURE_2D,f),d.copyTexSubImage2D(d.TEXTURE_2D,0,0,0,g,l-j-h,i,j),e.unbindTexture();a.generateMipmaps&&this.generateMipmaps(a),this.backend._setFramebuffer(b)}setupRenderBufferStorage(a,b,c,d=!1){let{gl:e}=this,f=b.renderTarget,{depthTexture:g,depthBuffer:h,stencilBuffer:i,width:j,height:k}=f;if(e.bindRenderbuffer(e.RENDERBUFFER,a),h&&!i){let b=e.DEPTH_COMPONENT24;!0===d?this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(e.RENDERBUFFER,f.samples,b,j,k):c>0?(g&&g.isDepthTexture&&g.type===e.FLOAT&&(b=e.DEPTH_COMPONENT32F),e.renderbufferStorageMultisample(e.RENDERBUFFER,c,b,j,k)):e.renderbufferStorage(e.RENDERBUFFER,b,j,k),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,a)}else h&&i&&(c>0?e.renderbufferStorageMultisample(e.RENDERBUFFER,c,e.DEPTH24_STENCIL8,j,k):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,j,k),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,a));e.bindRenderbuffer(e.RENDERBUFFER,null)}async copyTextureToBuffer(a,b,c,d,e,f){let{backend:g,gl:h}=this,{textureGPU:i,glFormat:j,glType:k}=this.backend.get(a),l=h.createFramebuffer();h.bindFramebuffer(h.READ_FRAMEBUFFER,l);let m=a.isCubeTexture?h.TEXTURE_CUBE_MAP_POSITIVE_X+f:h.TEXTURE_2D;h.framebufferTexture2D(h.READ_FRAMEBUFFER,h.COLOR_ATTACHMENT0,m,i,0);let n=this._getTypedArrayType(k),o=d*e*this._getBytesPerTexel(k,j),p=h.createBuffer();h.bindBuffer(h.PIXEL_PACK_BUFFER,p),h.bufferData(h.PIXEL_PACK_BUFFER,o,h.STREAM_READ),h.readPixels(b,c,d,e,j,k,0),h.bindBuffer(h.PIXEL_PACK_BUFFER,null),await g.utils._clientWaitAsync();let q=new n(o/n.BYTES_PER_ELEMENT);return h.bindBuffer(h.PIXEL_PACK_BUFFER,p),h.getBufferSubData(h.PIXEL_PACK_BUFFER,0,q),h.bindBuffer(h.PIXEL_PACK_BUFFER,null),h.deleteFramebuffer(l),q}_getTypedArrayType(a){let{gl:b}=this;if(a===b.UNSIGNED_BYTE)return Uint8Array;if(a===b.UNSIGNED_SHORT_4_4_4_4||a===b.UNSIGNED_SHORT_5_5_5_1||a===b.UNSIGNED_SHORT_5_6_5||a===b.UNSIGNED_SHORT)return Uint16Array;if(a===b.UNSIGNED_INT)return Uint32Array;if(a===b.HALF_FLOAT)return Uint16Array;if(a===b.FLOAT)return Float32Array;throw Error(`Unsupported WebGL type: ${a}`)}_getBytesPerTexel(a,b){let{gl:c}=this,d=0;return(a===c.UNSIGNED_BYTE&&(d=1),(a===c.UNSIGNED_SHORT_4_4_4_4||a===c.UNSIGNED_SHORT_5_5_5_1||a===c.UNSIGNED_SHORT_5_6_5||a===c.UNSIGNED_SHORT||a===c.HALF_FLOAT)&&(d=2),(a===c.UNSIGNED_INT||a===c.FLOAT)&&(d=4),b===c.RGBA)?4*d:b===c.RGB?3*d:b===c.ALPHA?d:void 0}dispose(){let{gl:a}=this;null!==this._srcFramebuffer&&a.deleteFramebuffer(this._srcFramebuffer),null!==this._dstFramebuffer&&a.deleteFramebuffer(this._dstFramebuffer)}},xY=class{constructor(a){this.backend=a,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(a){let b=this.extensions[a];return void 0===b&&(b=this.gl.getExtension(a),this.extensions[a]=b),b}has(a){return this.availableExtensions.includes(a)}},xZ=class{constructor(a){this.backend=a,this.maxAnisotropy=null}getMaxAnisotropy(){if(null!==this.maxAnisotropy)return this.maxAnisotropy;let a=this.backend.gl,b=this.backend.extensions;if(!0===b.has("EXT_texture_filter_anisotropic")){let c=b.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=a.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}},x$={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-s3tc",EXT_texture_compression_bptc:"texture-compression-bc",EXT_disjoint_timer_query_webgl2:"timestamp-query",OVR_multiview2:"OVR_multiview2"},x_=class{constructor(a){this.gl=a.gl,this.extensions=a.extensions,this.info=a.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(a,b){let{gl:c,mode:d,object:e,type:f,info:g,index:h}=this;0===h?c.drawArrays(d,a,b):c.drawElements(d,b,f,a),g.update(e,b,1)}renderInstances(a,b,c){let{gl:d,mode:e,type:f,index:g,object:h,info:i}=this;0!==c&&(0===g?d.drawArraysInstanced(e,a,b,c):d.drawElementsInstanced(e,b,f,a,c),i.update(h,b,c))}renderMultiDraw(a,b,c){let{extensions:d,mode:e,object:f,info:g}=this;if(0===c)return;let h=d.get("WEBGL_multi_draw");if(null===h)for(let d=0;d<c;d++)this.render(a[d],b[d]);else{0===this.index?h.multiDrawArraysWEBGL(e,a,0,b,0,c):h.multiDrawElementsWEBGL(e,b,0,this.type,a,0,c);let d=0;for(let a=0;a<c;a++)d+=b[a];g.update(f,d,1)}}renderMultiDrawInstances(a,b,c,d){let{extensions:e,mode:f,object:g,info:h}=this;if(0===c)return;let i=e.get("WEBGL_multi_draw");if(null===i)for(let e=0;e<c;e++)this.renderInstances(a[e],b[e],d[e]);else{0===this.index?i.multiDrawArraysInstancedWEBGL(f,a,0,b,0,d,0,c):i.multiDrawElementsInstancedWEBGL(f,b,0,this.type,a,0,d,0,c);let e=0;for(let a=0;a<c;a++)e+=b[a]*d[a];h.update(g,e,1)}}},x0=class{constructor(a=256){this.trackTimestamp=!0,this.maxQueries=a,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.frames=[],this.pendingResolve=!1,this.timestamps=new Map}getTimestampFrames(){return this.frames}getTimestamp(a){let b=this.timestamps.get(a);return void 0===b&&(I(`TimestampQueryPool: No timestamp available for uid ${a}.`),b=0),b}hasTimestamp(a){return this.timestamps.has(a)}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}},x1=class extends x0{constructor(a,b,c=2048){if(super(c),this.gl=a,this.type=b,this.ext=a.getExtension("EXT_disjoint_timer_query_webgl2")||a.getExtension("EXT_disjoint_timer_query"),!this.ext){I("EXT_disjoint_timer_query not supported; timestamps will be disabled."),this.trackTimestamp=!1;return}this.queries=[];for(let b=0;b<this.maxQueries;b++)this.queries.push(a.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(a){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return K(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;let b=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(b,"inactive"),this.queryOffsets.set(a,b),b}beginQuery(a){if(!this.trackTimestamp||this.isDisposed)return;let b=this.queryOffsets.get(a);if(null==b||null!==this.activeQuery)return;let c=this.queries[b];if(c)try{"inactive"===this.queryStates.get(b)&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,c),this.activeQuery=b,this.queryStates.set(b,"started"))}catch(a){a("Error in beginQuery:",a),this.activeQuery=null,this.queryStates.set(b,"inactive")}}endQuery(a){if(!this.trackTimestamp||this.isDisposed)return;let b=this.queryOffsets.get(a);if(null!=b&&this.activeQuery===b)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(b,"ended"),this.activeQuery=null}catch(a){a("Error in endQuery:",a),this.queryStates.set(b,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{let a=new Map;for(let[b,c]of this.queryOffsets)if("ended"===this.queryStates.get(c)){let d=this.queries[c];a.set(b,this.resolveQuery(d))}if(0===a.size)return this.lastValue;let b={},c=[];for(let[d,e]of a){let a=d.match(/^(.*):f(\d+)$/),f=parseInt(a[2]);!1===c.includes(f)&&c.push(f),void 0===b[f]&&(b[f]=0);let g=await e;this.timestamps.set(d,g),b[f]+=g}let d=b[c[c.length-1]];return this.lastValue=d,this.frames=c,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,d}catch(a){return a("Error resolving queries:",a),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(a){return new Promise(b=>{if(this.isDisposed)return void b(this.lastValue);let c,d=!1,e=a=>{d||(d=!0,c&&(clearTimeout(c),c=null),b(a))},f=()=>{if(this.isDisposed)return void e(this.lastValue);try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT))return void e(this.lastValue);if(!this.gl.getQueryParameter(a,this.gl.QUERY_RESULT_AVAILABLE)){c=setTimeout(f,1);return}let d=this.gl.getQueryParameter(a,this.gl.QUERY_RESULT);b(Number(d)/1e6)}catch(a){a("Error checking query:",a),b(this.lastValue)}};f()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,this.trackTimestamp)){for(let a of this.queries)this.gl.deleteQuery(a);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}},x2=class extends xL{constructor(a={}){super(a),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer=!(typeof navigator>"u")&&/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(a){super.init(a);let b=this.parameters,c={antialias:a.currentSamples>0,alpha:!0,depth:a.depth,stencil:a.stencil},d=void 0===b.context?a.domElement.getContext("webgl2",c):b.context;function e(b){b.preventDefault();let c={api:"WebGL",message:b.statusMessage||"Unknown reason",reason:null,originalEvent:b};a.onDeviceLost(c)}this._onContextLost=e,a.domElement.addEventListener("webglcontextlost",e,!1),this.gl=d,this.extensions=new xY(this),this.capabilities=new xZ(this),this.attributeUtils=new xO(this),this.textureUtils=new xX(this),this.bufferRenderer=new x_(this),this.state=new xR(this),this.utils=new xS(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.extensions.get("OVR_multiview2"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile")}get coordinateSystem(){return bD}async getArrayBufferAsync(a){return await this.attributeUtils.getArrayBufferAsync(a)}async makeXRCompatible(){!0!==this.gl.getContextAttributes().xrCompatible&&await this.gl.makeXRCompatible()}setXRTarget(a){this._xrFramebuffer=a}setXRRenderTargetTextures(a,b,c=null){let d=this.gl;if(this.set(a.texture,{textureGPU:b,glInternalFormat:d.RGBA8}),null!==c){let b=a.stencilBuffer?d.DEPTH24_STENCIL8:d.DEPTH_COMPONENT24;this.set(a.depthTexture,{textureGPU:c,glInternalFormat:b}),!0===this.extensions.has("WEBGL_multisampled_render_to_texture")&&!0===a._autoAllocateDepthBuffer&&!1===a.multiview&&I("WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),a._autoAllocateDepthBuffer=!1}}initTimestampQuery(a,b){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[a]||(this.timestampQueryPool[a]=new x1(this.gl,a,2048));let c=this.timestampQueryPool[a];null!==c.allocateQueriesForContext(b)&&c.beginQuery(b)}prepareTimestampBuffer(a,b){this.disjoint&&this.trackTimestamp&&this.timestampQueryPool[a].endQuery(b)}getContext(){return this.gl}beginRender(a){let{state:b}=this,c=this.get(a);if(a.viewport)this.updateViewport(a);else{let{width:a,height:c}=this.getDrawingBufferSize();b.viewport(0,0,a,c)}if(a.scissor){let{x:c,y:d,width:e,height:f}=a.scissorValue;b.scissor(c,a.height-f-d,e,f)}this.initTimestampQuery(bF.RENDER,this.getTimestampUID(a)),c.previousContext=this._currentContext,this._currentContext=a,this._setFramebuffer(a),this.clear(a.clearColor,a.clearDepth,a.clearStencil,a,!1);let d=a.occlusionQueryCount;d>0&&(c.currentOcclusionQueries=c.occlusionQueries,c.currentOcclusionQueryObjects=c.occlusionQueryObjects,c.lastOcclusionObject=null,c.occlusionQueries=Array(d),c.occlusionQueryObjects=Array(d),c.occlusionQueryIndex=0)}finishRender(a){let{gl:b,state:c}=this,d=this.get(a),e=d.previousContext;c.resetVertexState();let f=a.occlusionQueryCount;f>0&&(f>d.occlusionQueryIndex&&b.endQuery(b.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(a));let g=a.textures;if(null!==g)for(let a=0;a<g.length;a++){let b=g[a];b.generateMipmaps&&this.generateMipmaps(b)}if(this._currentContext=e,this._resolveRenderTarget(a),null!==e)if(this._setFramebuffer(e),e.viewport)this.updateViewport(e);else{let{width:a,height:b}=this.getDrawingBufferSize();c.viewport(0,0,a,b)}this.prepareTimestampBuffer(bF.RENDER,this.getTimestampUID(a))}resolveOccludedAsync(a){let b=this.get(a),{currentOcclusionQueries:c,currentOcclusionQueryObjects:d}=b;if(c&&d){let a=new WeakSet,{gl:e}=this;b.currentOcclusionQueryObjects=null,b.currentOcclusionQueries=null;let f=()=>{let g=0;for(let b=0;b<c.length;b++){let f=c[b];null!==f&&e.getQueryParameter(f,e.QUERY_RESULT_AVAILABLE)&&(0===e.getQueryParameter(f,e.QUERY_RESULT)&&a.add(d[b]),c[b]=null,e.deleteQuery(f),g++)}g<c.length?requestAnimationFrame(f):b.occluded=a};f()}}isOccluded(a,b){let c=this.get(a);return c.occluded&&c.occluded.has(b)}updateViewport(a){let{state:b}=this,{x:c,y:d,width:e,height:f}=a.viewportValue;b.viewport(c,a.height-f-d,e,f)}setScissorTest(a){this.state.setScissorTest(a)}getClearColor(){let a=super.getClearColor();return a.r*=a.a,a.g*=a.a,a.b*=a.a,a}clear(a,b,c,d=null,e=!0,f=!0){let{gl:g,renderer:h}=this;null===d&&(d={textures:null,clearColorValue:this.getClearColor()});let i=0;if(a&&(i|=g.COLOR_BUFFER_BIT),b&&(i|=g.DEPTH_BUFFER_BIT),c&&(i|=g.STENCIL_BUFFER_BIT),0!==i){let j;j=d.clearColorValue?d.clearColorValue:this.getClearColor();let k=h.getClearDepth(),l=h.getClearStencil();if(b&&this.state.setDepthMask(!0),null===d.textures)g.clearColor(j.r,j.g,j.b,j.a),g.clear(i);else{if(e&&this._setFramebuffer(d),a)for(let a=0;a<d.textures.length;a++)0===a?g.clearBufferfv(g.COLOR,a,[j.r,j.g,j.b,j.a]):g.clearBufferfv(g.COLOR,a,[0,0,0,1]);b&&c?g.clearBufferfi(g.DEPTH_STENCIL,0,k,l):b?g.clearBufferfv(g.DEPTH,0,[k]):c&&g.clearBufferiv(g.STENCIL,0,[l]),e&&f&&this._resolveRenderTarget(d)}}}beginCompute(a){let{state:b,gl:c}=this;b.bindFramebuffer(c.FRAMEBUFFER,null),this.initTimestampQuery(bF.COMPUTE,this.getTimestampUID(a))}compute(a,b,c,d,e=null){let{state:f,gl:g}=this;!1===this.discard&&(g.enable(g.RASTERIZER_DISCARD),this.discard=!0);let{programGPU:h,transformBuffers:i,attributes:j}=this.get(d),k=this._getVaoKey(j),l=this.vaoCache[k];void 0===l?this.vaoCache[k]=this._createVao(j):f.setVertexState(l),f.useProgram(h),this._bindUniforms(c);let m=this._getTransformFeedback(i);g.bindTransformFeedback(g.TRANSFORM_FEEDBACK,m),g.beginTransformFeedback(g.POINTS),Array.isArray(e=null===e?b.count:e)?(K("WebGLBackend.compute(): The count parameter must be a single number, not an array."),e=e[0]):e&&"object"==typeof e&&e.isIndirectStorageBufferAttribute&&(K("WebGLBackend.compute(): The count parameter must be a single number, not IndirectStorageBufferAttribute"),e=b.count),j[0].isStorageInstancedBufferAttribute?g.drawArraysInstanced(g.POINTS,0,1,e):g.drawArrays(g.POINTS,0,e),g.endTransformFeedback(),g.bindTransformFeedback(g.TRANSFORM_FEEDBACK,null);for(let a=0;a<i.length;a++){let b=i[a];b.pbo&&this.has(b.pbo)&&this.textureUtils.copyBufferToTexture(b.transformBuffer,b.pbo),b.switchBuffers()}}finishCompute(a){let b=this.gl;this.discard=!1,b.disable(b.RASTERIZER_DISCARD),this.prepareTimestampBuffer(bF.COMPUTE,this.getTimestampUID(a)),this._currentContext&&this._setFramebuffer(this._currentContext)}_isRenderCameraDepthArray(a){return a.depthTexture&&a.depthTexture.isArrayTexture&&a.camera.isArrayCamera}draw(a){let{object:b,pipeline:c,material:d,context:e,hardwareClippingPlanes:f}=a,{programGPU:g}=this.get(c),{gl:h,state:i}=this,j=this.get(e),k=a.getDrawParameters();if(null===k)return;this._bindUniforms(a.getBindings());let l=b.isMesh&&0>b.matrixWorld.determinant();i.setMaterial(d,l,f),i.useProgram(g);let m=a.getAttributes(),n=this.get(m),o=n.vaoGPU;if(void 0===o){let a=this._getVaoKey(m);void 0===(o=this.vaoCache[a])&&(o=this._createVao(m),this.vaoCache[a]=o,n.vaoGPU=o)}let p=a.getIndex(),q=null===p?null:this.get(p).bufferGPU;i.setVertexState(o,q);let r=j.lastOcclusionObject;if(r!==b&&void 0!==r){if(null!==r&&!0===r.occlusionTest&&(h.endQuery(h.ANY_SAMPLES_PASSED),j.occlusionQueryIndex++),!0===b.occlusionTest){let a=h.createQuery();h.beginQuery(h.ANY_SAMPLES_PASSED,a),j.occlusionQueries[j.occlusionQueryIndex]=a,j.occlusionQueryObjects[j.occlusionQueryIndex]=b}j.lastOcclusionObject=b}let s=this.bufferRenderer;b.isPoints?s.mode=h.POINTS:b.isLineSegments?s.mode=h.LINES:b.isLine?s.mode=h.LINE_STRIP:b.isLineLoop?s.mode=h.LINE_LOOP:!0===d.wireframe?(i.setLineWidth(d.wireframeLinewidth*this.renderer.getPixelRatio()),s.mode=h.LINES):s.mode=h.TRIANGLES;let{vertexCount:t,instanceCount:u}=k,{firstVertex:v}=k;if(s.object=b,null!==p){v*=p.array.BYTES_PER_ELEMENT;let a=this.get(p);s.index=p.count,s.type=a.type}else s.index=0;let w=()=>{b.isBatchedMesh?null===b._multiDrawInstances?this.hasFeature("WEBGL_multi_draw")?s.renderMultiDraw(b._multiDrawStarts,b._multiDrawCounts,b._multiDrawCount):K("WebGLBackend: WEBGL_multi_draw not supported."):(K("WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),s.renderMultiDrawInstances(b._multiDrawStarts,b._multiDrawCounts,b._multiDrawCount,b._multiDrawInstances)):u>1?s.renderInstances(v,t,u):s.render(v,t)};if(!0===a.camera.isArrayCamera&&a.camera.cameras.length>0&&!1===a.camera.isMultiViewCamera){let c=this.get(a.camera),d=a.camera.cameras,e=a.getBindingGroup("cameraIndex").bindings[0];if(void 0===c.indexesGPU||c.indexesGPU.length!==d.length){let a=new Uint32Array([0,0,0,0]),b=[];for(let c=0,e=d.length;c<e;c++){let d=h.createBuffer();a[0]=c,h.bindBuffer(h.UNIFORM_BUFFER,d),h.bufferData(h.UNIFORM_BUFFER,a,h.STATIC_DRAW),b.push(d)}c.indexesGPU=b}let f=this.get(e),g=this.renderer.getPixelRatio(),j=this._currentContext.renderTarget,k=this._isRenderCameraDepthArray(this._currentContext),l=this._currentContext.activeCubeFace;if(k){let a=this.get(j.depthTexture);if(a.clearedRenderId!==this.renderer._nodes.nodeFrame.renderId){a.clearedRenderId=this.renderer._nodes.nodeFrame.renderId;let{stencilBuffer:b}=j;for(let a=0,c=d.length;a<c;a++)this.renderer._activeCubeFace=a,this._currentContext.activeCubeFace=a,this._setFramebuffer(this._currentContext),this.clear(!1,!0,b,this._currentContext,!1,!1);this.renderer._activeCubeFace=l,this._currentContext.activeCubeFace=l}}for(let e=0,j=d.length;e<j;e++){let j=d[e];if(b.layers.test(j.layers)){k&&(this.renderer._activeCubeFace=e,this._currentContext.activeCubeFace=e,this._setFramebuffer(this._currentContext));let b=j.viewport;if(void 0!==b){let c=b.x*g,d=b.y*g,e=b.width*g,f=b.height*g;i.viewport(Math.floor(c),Math.floor(a.context.height-f-d),Math.floor(e),Math.floor(f))}i.bindBufferBase(h.UNIFORM_BUFFER,f.index,c.indexesGPU[e]),w()}this._currentContext.activeCubeFace=l,this.renderer._activeCubeFace=l}}else w()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(a){this.textureUtils.createDefaultTexture(a)}createTexture(a,b){this.textureUtils.createTexture(a,b)}updateTexture(a,b){this.textureUtils.updateTexture(a,b)}generateMipmaps(a){this.textureUtils.generateMipmaps(a)}destroyTexture(a,b=!1){this.textureUtils.destroyTexture(a,b)}async copyTextureToBuffer(a,b,c,d,e,f){return this.textureUtils.copyTextureToBuffer(a,b,c,d,e,f)}updateSampler(){return""}createNodeBuilder(a,b){return new xI(a,b)}createProgram(a){let b=this.gl,{stage:c,code:d}=a,e="fragment"===c?b.createShader(b.FRAGMENT_SHADER):b.createShader(b.VERTEX_SHADER);b.shaderSource(e,d),b.compileShader(e),this.set(a,{shaderGPU:e})}destroyProgram(a){this.delete(a)}createRenderPipeline(a,b){let c=this.gl,d=a.pipeline,{fragmentProgram:e,vertexProgram:f}=d,g=c.createProgram(),h=this.get(e).shaderGPU,i=this.get(f).shaderGPU;if(c.attachShader(g,h),c.attachShader(g,i),c.linkProgram(g),this.set(d,{programGPU:g,fragmentShader:h,vertexShader:i}),null!==b&&this.parallel){let e=new Promise(b=>{let e=this.parallel,f=()=>{c.getProgramParameter(g,e.COMPLETION_STATUS_KHR)?(this._completeCompile(a,d),b()):requestAnimationFrame(f)};f()});b.push(e);return}this._completeCompile(a,d)}_handleSource(a,b){let c=a.split(`
`),d=[],e=Math.max(b-6,0),f=Math.min(b+6,c.length);for(let a=e;a<f;a++){let e=a+1;d.push(`${e===b?">":" "} ${e}: ${c[a]}`)}return d.join(`
`)}_getShaderErrors(a,b,c){let d=a.getShaderParameter(b,a.COMPILE_STATUS),e=(a.getShaderInfoLog(b)||"").trim();if(d&&""===e)return"";let f=/ERROR: 0:(\d+)/.exec(e);if(!f)return e;{let d=parseInt(f[1]);return c.toUpperCase()+`

`+e+`

`+this._handleSource(a.getShaderSource(b),d)}}_logProgramError(a,b,c){if(this.renderer.debug.checkShaderErrors){let d=this.gl,e=(d.getProgramInfoLog(a)||"").trim();if(!1===d.getProgramParameter(a,d.LINK_STATUS))if("function"==typeof this.renderer.debug.onShaderError)this.renderer.debug.onShaderError(d,a,c,b);else{let f=this._getShaderErrors(d,c,"vertex"),g=this._getShaderErrors(d,b,"fragment");J("THREE.WebGLProgram: Shader Error "+d.getError()+" - VALIDATE_STATUS "+d.getProgramParameter(a,d.VALIDATE_STATUS)+`

Program Info Log: `+e+`
`+f+`
`+g)}else""!==e&&I("WebGLProgram: Program Info Log:",e)}}_completeCompile(a,b){let{state:c,gl:d}=this,{programGPU:e,fragmentShader:f,vertexShader:g}=this.get(b);!1===d.getProgramParameter(e,d.LINK_STATUS)&&this._logProgramError(e,f,g),c.useProgram(e);let h=a.getBindings();this._setupBindings(h,e),this.set(b,{programGPU:e})}createComputePipeline(a,b){let{state:c,gl:d}=this,e={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(e);let{computeProgram:f}=a,g=d.createProgram(),h=this.get(e).shaderGPU,i=this.get(f).shaderGPU,j=f.transforms,k=[],l=[];for(let a=0;a<j.length;a++){let b=j[a];k.push(b.varyingName),l.push(b.attributeNode)}d.attachShader(g,h),d.attachShader(g,i),d.transformFeedbackVaryings(g,k,d.SEPARATE_ATTRIBS),d.linkProgram(g),!1===d.getProgramParameter(g,d.LINK_STATUS)&&this._logProgramError(g,h,i),c.useProgram(g),this._setupBindings(b,g);let m=f.attributes,n=[],o=[];for(let a=0;a<m.length;a++){let b=m[a].node.attribute;n.push(b),this.has(b)||this.attributeUtils.createAttribute(b,d.ARRAY_BUFFER)}for(let a=0;a<l.length;a++){let b=l[a].attribute;this.has(b)||this.attributeUtils.createAttribute(b,d.ARRAY_BUFFER);let c=this.get(b);o.push(c)}this.set(a,{programGPU:g,transformBuffers:o,attributes:n})}createBindings(a,b){if(!1===this._knownBindings.has(b)){this._knownBindings.add(b);let a=0,c=0;for(let d of b)for(let b of(this.set(d,{textures:c,uniformBuffers:a}),d.bindings))b.isUniformBuffer&&a++,b.isSampledTexture&&c++}this.updateBindings(a,b)}updateBindings(a){let{gl:b}=this,c=this.get(a),d=c.uniformBuffers,e=c.textures;for(let c of a.bindings){let a=this.get(c);if(c.isUniformsGroup||c.isUniformBuffer){let e=c.buffer,{bufferGPU:f}=this.get(e);void 0===f?(f=b.createBuffer(),b.bindBuffer(b.UNIFORM_BUFFER,f),b.bufferData(b.UNIFORM_BUFFER,e,b.DYNAMIC_DRAW),this.set(e,{bufferGPU:f})):(b.bindBuffer(b.UNIFORM_BUFFER,f),b.bufferSubData(b.UNIFORM_BUFFER,0,e)),a.index=d++,a.bufferGPU=f,this.set(c,a)}else if(c.isSampledTexture){let{textureGPU:b,glTextureType:d}=this.get(c.texture);a.index=e++,a.textureGPU=b,a.glTextureType=d,this.set(c,a)}}}updateBinding(a){let b=this.gl;if(a.isUniformsGroup||a.isUniformBuffer){let c=this.get(a).bufferGPU,d=a.buffer;b.bindBuffer(b.UNIFORM_BUFFER,c),b.bufferData(b.UNIFORM_BUFFER,d,b.DYNAMIC_DRAW)}}createIndexAttribute(a){let b=this.gl;this.attributeUtils.createAttribute(a,b.ELEMENT_ARRAY_BUFFER)}createAttribute(a){if(this.has(a))return;let b=this.gl;this.attributeUtils.createAttribute(a,b.ARRAY_BUFFER)}createStorageAttribute(a){if(this.has(a))return;let b=this.gl;this.attributeUtils.createAttribute(a,b.ARRAY_BUFFER)}updateAttribute(a){this.attributeUtils.updateAttribute(a)}destroyAttribute(a){this.attributeUtils.destroyAttribute(a)}hasFeature(a){let b=Object.keys(x$).filter(b=>x$[b]===a),c=this.extensions;for(let a=0;a<b.length;a++)if(c.has(b[a]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(a,b,c=null,d=null,e=0,f=0){this.textureUtils.copyTextureToTexture(a,b,c,d,e,f)}copyFramebufferToTexture(a,b,c){this.textureUtils.copyFramebufferToTexture(a,b,c)}_setFramebuffer(a){let{gl:b,state:c}=this,d=null;if(null!==a.textures){let e=a.renderTarget,f=this.get(e),{samples:g,depthBuffer:h,stencilBuffer:i}=e,j=!0===e.isWebGLCubeRenderTarget,k=!0===e.isRenderTarget3D,l=e.depth>1,m=!0===e.isXRRenderTarget,n=!0===m&&!0===e._hasExternalTextures,o=f.msaaFrameBuffer,p=f.depthRenderbuffer,q=this.extensions.get("WEBGL_multisampled_render_to_texture"),r=this.extensions.get("OVR_multiview2"),s=this._useMultisampledExtension(e),t=fM(a),u;if(j?(f.cubeFramebuffers||(f.cubeFramebuffers={}),u=f.cubeFramebuffers[t]):m&&!1===n?u=this._xrFramebuffer:(f.framebuffers||(f.framebuffers={}),u=f.framebuffers[t]),void 0===u){u=b.createFramebuffer(),c.bindFramebuffer(b.FRAMEBUFFER,u);let d=a.textures,h=[];if(j){f.cubeFramebuffers[t]=u;let{textureGPU:a}=this.get(d[0]),c=this.renderer._activeCubeFace,e=this.renderer._activeMipmapLevel;b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+c,a,e)}else{f.framebuffers[t]=u;for(let c=0;c<d.length;c++){let f=d[c],h=this.get(f);h.renderTarget=a.renderTarget,h.cacheKey=t;let i=b.COLOR_ATTACHMENT0+c;if(e.multiview)r.framebufferTextureMultisampleMultiviewOVR(b.FRAMEBUFFER,i,h.textureGPU,0,g,0,2);else if(k||l){let a=this.renderer._activeCubeFace,c=this.renderer._activeMipmapLevel;b.framebufferTextureLayer(b.FRAMEBUFFER,i,h.textureGPU,c,a)}else if(s)q.framebufferTexture2DMultisampleEXT(b.FRAMEBUFFER,i,b.TEXTURE_2D,h.textureGPU,0,g);else{let a=this.renderer._activeMipmapLevel;b.framebufferTexture2D(b.FRAMEBUFFER,i,b.TEXTURE_2D,h.textureGPU,a)}}}let m=i?b.DEPTH_STENCIL_ATTACHMENT:b.DEPTH_ATTACHMENT;if(!0===e._autoAllocateDepthBuffer){let c=b.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(c,a,0,s),f.xrDepthRenderbuffer=c,h.push(i?b.DEPTH_STENCIL_ATTACHMENT:b.DEPTH_ATTACHMENT),b.bindRenderbuffer(b.RENDERBUFFER,c),b.framebufferRenderbuffer(b.FRAMEBUFFER,m,b.RENDERBUFFER,c)}else if(null!==a.depthTexture){h.push(i?b.DEPTH_STENCIL_ATTACHMENT:b.DEPTH_ATTACHMENT);let c=this.get(a.depthTexture);if(c.renderTarget=a.renderTarget,c.cacheKey=t,e.multiview)r.framebufferTextureMultisampleMultiviewOVR(b.FRAMEBUFFER,m,c.textureGPU,0,g,0,2);else if(n&&s)q.framebufferTexture2DMultisampleEXT(b.FRAMEBUFFER,m,b.TEXTURE_2D,c.textureGPU,0,g);else if(a.depthTexture.isArrayTexture){let a=this.renderer._activeCubeFace;b.framebufferTextureLayer(b.FRAMEBUFFER,m,c.textureGPU,0,a)}else b.framebufferTexture2D(b.FRAMEBUFFER,m,b.TEXTURE_2D,c.textureGPU,0)}f.depthInvalidationArray=h}else{if(this._isRenderCameraDepthArray(a)){c.bindFramebuffer(b.FRAMEBUFFER,u);let d=this.renderer._activeCubeFace,e=this.get(a.depthTexture),f=i?b.DEPTH_STENCIL_ATTACHMENT:b.DEPTH_ATTACHMENT;b.framebufferTextureLayer(b.FRAMEBUFFER,f,e.textureGPU,0,d)}if((m||s||e.multiview)&&!0!==e._isOpaqueFramebuffer){c.bindFramebuffer(b.FRAMEBUFFER,u);let d=this.get(a.textures[0]);e.multiview?r.framebufferTextureMultisampleMultiviewOVR(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,d.textureGPU,0,g,0,2):s?q.framebufferTexture2DMultisampleEXT(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,d.textureGPU,0,g):b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,d.textureGPU,0);let h=i?b.DEPTH_STENCIL_ATTACHMENT:b.DEPTH_ATTACHMENT;if(!0===e._autoAllocateDepthBuffer){let a=f.xrDepthRenderbuffer;b.bindRenderbuffer(b.RENDERBUFFER,a),b.framebufferRenderbuffer(b.FRAMEBUFFER,h,b.RENDERBUFFER,a)}else{let c=this.get(a.depthTexture);e.multiview?r.framebufferTextureMultisampleMultiviewOVR(b.FRAMEBUFFER,h,c.textureGPU,0,g,0,2):s?q.framebufferTexture2DMultisampleEXT(b.FRAMEBUFFER,h,b.TEXTURE_2D,c.textureGPU,0,g):b.framebufferTexture2D(b.FRAMEBUFFER,h,b.TEXTURE_2D,c.textureGPU,0)}}}if(g>0&&!1===s&&!e.multiview){if(void 0===o){let d=[];o=b.createFramebuffer(),c.bindFramebuffer(b.FRAMEBUFFER,o);let e=[],j=a.textures;for(let c=0;c<j.length;c++){e[c]=b.createRenderbuffer(),b.bindRenderbuffer(b.RENDERBUFFER,e[c]),d.push(b.COLOR_ATTACHMENT0+c);let f=a.textures[c],h=this.get(f);b.renderbufferStorageMultisample(b.RENDERBUFFER,g,h.glInternalFormat,a.width,a.height),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0+c,b.RENDERBUFFER,e[c])}if(b.bindRenderbuffer(b.RENDERBUFFER,null),f.msaaFrameBuffer=o,f.msaaRenderbuffers=e,h&&void 0===p){p=b.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(p,a,g),f.depthRenderbuffer=p;let c=i?b.DEPTH_STENCIL_ATTACHMENT:b.DEPTH_ATTACHMENT;d.push(c)}f.invalidationArray=d}d=f.msaaFrameBuffer}else d=u;c.drawBuffers(a,u)}c.bindFramebuffer(b.FRAMEBUFFER,d)}_getVaoKey(a){let b="";for(let c=0;c<a.length;c++)b+=":"+this.get(a[c]).id;return b}_createVao(a){let{gl:b}=this,c=b.createVertexArray();b.bindVertexArray(c);for(let c=0;c<a.length;c++){let d,e,f=a[c],g=this.get(f);b.bindBuffer(b.ARRAY_BUFFER,g.bufferGPU),b.enableVertexAttribArray(c),!0===f.isInterleavedBufferAttribute?(d=f.data.stride*g.bytesPerElement,e=f.offset*g.bytesPerElement):(d=0,e=0),g.isInteger?b.vertexAttribIPointer(c,f.itemSize,g.type,d,e):b.vertexAttribPointer(c,f.itemSize,g.type,f.normalized,d,e),f.isInstancedBufferAttribute&&!f.isInterleavedBufferAttribute?b.vertexAttribDivisor(c,f.meshPerAttribute):f.isInterleavedBufferAttribute&&f.data.isInstancedInterleavedBuffer&&b.vertexAttribDivisor(c,f.data.meshPerAttribute)}return b.bindBuffer(b.ARRAY_BUFFER,null),c}_getTransformFeedback(a){let b="";for(let c=0;c<a.length;c++)b+=":"+a[c].id;let c=this.transformFeedbackCache[b];if(void 0!==c)return c;let{gl:d}=this;c=d.createTransformFeedback(),d.bindTransformFeedback(d.TRANSFORM_FEEDBACK,c);for(let b=0;b<a.length;b++){let c=a[b];d.bindBufferBase(d.TRANSFORM_FEEDBACK_BUFFER,b,c.transformBuffer)}return d.bindTransformFeedback(d.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[b]=c,c}_setupBindings(a,b){let c=this.gl;for(let d of a)for(let a of d.bindings){let d=this.get(a).index;if(a.isUniformsGroup||a.isUniformBuffer){let e=c.getUniformBlockIndex(b,a.name);c.uniformBlockBinding(b,e,d)}else if(a.isSampledTexture){let e=c.getUniformLocation(b,a.name);c.uniform1i(e,d)}}}_bindUniforms(a){let{gl:b,state:c}=this;for(let d of a)for(let a of d.bindings){let d=this.get(a),e=d.index;a.isUniformsGroup||a.isUniformBuffer?c.bindBufferBase(b.UNIFORM_BUFFER,e,d.bufferGPU):a.isSampledTexture&&c.bindTexture(d.glTextureType,d.textureGPU,b.TEXTURE0+e)}}_resolveRenderTarget(a){let{gl:b,state:c}=this,d=a.renderTarget;if(null!==a.textures&&d){let e=this.get(d);if(d.samples>0&&!1===this._useMultisampledExtension(d)){let f=e.framebuffers[a.getCacheKey()],g=b.COLOR_BUFFER_BIT;d.resolveDepthBuffer&&(d.depthBuffer&&(g|=b.DEPTH_BUFFER_BIT),d.stencilBuffer&&d.resolveStencilBuffer&&(g|=b.STENCIL_BUFFER_BIT));let h=e.msaaFrameBuffer,i=e.msaaRenderbuffers,j=a.textures,k=j.length>1;if(c.bindFramebuffer(b.READ_FRAMEBUFFER,h),c.bindFramebuffer(b.DRAW_FRAMEBUFFER,f),k)for(let a=0;a<j.length;a++)b.framebufferRenderbuffer(b.READ_FRAMEBUFFER,b.COLOR_ATTACHMENT0+a,b.RENDERBUFFER,null),b.framebufferTexture2D(b.DRAW_FRAMEBUFFER,b.COLOR_ATTACHMENT0+a,b.TEXTURE_2D,null,0);for(let c=0;c<j.length;c++){if(k){let{textureGPU:a}=this.get(j[c]);b.framebufferRenderbuffer(b.READ_FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.RENDERBUFFER,i[c]),b.framebufferTexture2D(b.DRAW_FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,a,0)}if(a.scissor){let{x:c,y:d,width:e,height:f}=a.scissorValue,h=a.height-f-d;b.blitFramebuffer(c,h,c+e,h+f,c,h,c+e,h+f,g,b.NEAREST)}else b.blitFramebuffer(0,0,a.width,a.height,0,0,a.width,a.height,g,b.NEAREST)}if(k)for(let a=0;a<j.length;a++){let{textureGPU:c}=this.get(j[a]);b.framebufferRenderbuffer(b.READ_FRAMEBUFFER,b.COLOR_ATTACHMENT0+a,b.RENDERBUFFER,i[a]),b.framebufferTexture2D(b.DRAW_FRAMEBUFFER,b.COLOR_ATTACHMENT0+a,b.TEXTURE_2D,c,0)}!0===this._supportsInvalidateFramebuffer&&b.invalidateFramebuffer(b.READ_FRAMEBUFFER,e.invalidationArray)}else if(!1===d.resolveDepthBuffer&&e.framebuffers){let d=e.framebuffers[a.getCacheKey()];c.bindFramebuffer(b.DRAW_FRAMEBUFFER,d),b.invalidateFramebuffer(b.DRAW_FRAMEBUFFER,e.depthInvalidationArray)}}}_useMultisampledExtension(a){return!0===a.multiview||a.samples>0&&!0===this.extensions.has("WEBGL_multisampled_render_to_texture")&&!1!==a._autoAllocateDepthBuffer}dispose(){null!==this.textureUtils&&this.textureUtils.dispose();let a=this.extensions.get("WEBGL_lose_context");a&&a.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}},x3={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},x4={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},x5={Store:"store"},x6={Load:"load",Clear:"clear"},x7={CCW:"ccw",CW:"cw"},x8={None:"none",Back:"back"},x9={Uint16:"uint16",Uint32:"uint32"},ya={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10UFloat:"rg11b10ufloat",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-unorm-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},yb={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},yc={Linear:"linear",Nearest:"nearest"},yd={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDst:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},ye={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},yf={None:0,All:15},yg={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},yh={Storage:"storage",ReadOnlyStorage:"read-only-storage"},yi={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},yj={NonFiltering:"non-filtering",Comparison:"comparison"},yk={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},yl={TwoD:"2d",ThreeD:"3d"},ym={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},yn={All:"all"},yo={Vertex:"vertex",Instance:"instance"},yp={CoreFeaturesAndLimits:"core-features-and-limits",DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionBCSliced3D:"texture-compression-bc-sliced-3d",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TextureCompressionASTCSliced3D:"texture-compression-astc-sliced-3d",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",Float32Blendable:"float32-blendable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups",TextureFormatsTier1:"texture-formats-tier1",TextureFormatsTier2:"texture-formats-tier2"},yq={"texture-compression-s3tc":"texture-compression-bc","texture-compression-etc1":"texture-compression-etc2"},yr=class extends xv{constructor(a,b,c){super(a,b?b.value:null),this.textureNode=b,this.groupNode=c}update(){let{textureNode:a}=this;return this.texture===a.value?super.update():(this.texture=a.value,!0)}},ys=class extends xo{constructor(a,b){super(a,b?b.array:null),this.attribute=b,this.isStorageBuffer=!0}},yt=0,yu=class extends ys{constructor(a,b){super("StorageBuffer_"+yt++,a?a.value:null),this.nodeUniform=a,this.access=a?a.access:gf.READ_WRITE,this.groupNode=b}get buffer(){return this.nodeUniform.value}},yv=class extends qM{constructor(a){super(),this.device=a,this.mipmapSampler=a.createSampler({minFilter:yc.Linear}),this.flipYSampler=a.createSampler({minFilter:yc.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=a.createShaderModule({label:"mipmapVertex",code:`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`}),this.mipmapFragmentShaderModule=a.createShaderModule({label:"mipmapFragment",code:`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`}),this.flipYFragmentShaderModule=a.createShaderModule({label:"flipYFragment",code:`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`})}getTransferPipeline(a){let b=this.transferPipelines[a];return void 0===b&&(b=this.device.createRenderPipeline({label:`mipmap-${a}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:a}]},primitive:{topology:x3.TriangleStrip,stripIndexFormat:x9.Uint32},layout:"auto"}),this.transferPipelines[a]=b),b}getFlipYPipeline(a){let b=this.flipYPipelines[a];return void 0===b&&(b=this.device.createRenderPipeline({label:`flipY-${a}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:a}]},primitive:{topology:x3.TriangleStrip,stripIndexFormat:x9.Uint32},layout:"auto"}),this.flipYPipelines[a]=b),b}flipY(a,b,c=0){let d=b.format,{width:e,height:f}=b.size,g=this.getTransferPipeline(d),h=this.getFlipYPipeline(d),i=this.device.createTexture({size:{width:e,height:f,depthOrArrayLayers:1},format:d,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),j=a.createView({baseMipLevel:0,mipLevelCount:1,dimension:ym.TwoD,baseArrayLayer:c}),k=i.createView({baseMipLevel:0,mipLevelCount:1,dimension:ym.TwoD,baseArrayLayer:0}),l=this.device.createCommandEncoder({}),m=(a,b,c)=>{let d=a.getBindGroupLayout(0),e=this.device.createBindGroup({layout:d,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:b}]}),f=l.beginRenderPass({colorAttachments:[{view:c,loadOp:x6.Clear,storeOp:x5.Store,clearValue:[0,0,0,0]}]});f.setPipeline(a),f.setBindGroup(0,e),f.draw(4,1,0,0),f.end()};m(g,j,k),m(h,k,j),this.device.queue.submit([l.finish()]),i.destroy()}generateMipmaps(a,b,c=0,d=null){let e=this.get(a);void 0===e.layers&&(e.layers=[]);let f=e.layers[c]||this._mipmapCreateBundles(a,b,c),g=d||this.device.createCommandEncoder({label:"mipmapEncoder"});this._mipmapRunBundles(g,f),null===d&&this.device.queue.submit([g.finish()]),e.layers[c]=f}_mipmapCreateBundles(a,b,c){let d=this.getTransferPipeline(b.format),e=d.getBindGroupLayout(0),f=a.createView({baseMipLevel:0,mipLevelCount:1,dimension:ym.TwoD,baseArrayLayer:c}),g=[];for(let h=1;h<b.mipLevelCount;h++){let i=this.device.createBindGroup({layout:e,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:f}]}),j=a.createView({baseMipLevel:h,mipLevelCount:1,dimension:ym.TwoD,baseArrayLayer:c}),k={colorAttachments:[{view:j,loadOp:x6.Clear,storeOp:x5.Store,clearValue:[0,0,0,0]}]},l=this.device.createRenderBundleEncoder({colorFormats:[b.format]});l.setPipeline(d),l.setBindGroup(0,i),l.draw(4,1,0,0),g.push({renderBundles:[l.finish()],passDescriptor:k}),f=j}return g}_mipmapRunBundles(a,b){let c=b.length;for(let d=0;d<c;d++){let c=b[d],e=a.beginRenderPass(c.passDescriptor);e.executeBundles(c.renderBundles),e.end()}}},yw={512:"never",513:"less",514:"equal",515:"less-equal",516:"greater",518:"greater-equal",519:"always",517:"not-equal"},yx=[0,1,3,2,4,5],yy=class{constructor(a){this.backend=a,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this._samplerCache=new Map}updateSampler(a){let b=this.backend,c=a.minFilter+"-"+a.magFilter+"-"+a.wrapS+"-"+a.wrapT+"-"+(a.wrapR||"0")+"-"+a.anisotropy+"-"+(a.compareFunction||0),d=this._samplerCache.get(c);if(void 0===d){let e={addressModeU:this._convertAddressMode(a.wrapS),addressModeV:this._convertAddressMode(a.wrapT),addressModeW:this._convertAddressMode(a.wrapR),magFilter:this._convertFilterMode(a.magFilter),minFilter:this._convertFilterMode(a.minFilter),mipmapFilter:this._convertFilterMode(a.minFilter),maxAnisotropy:1};e.magFilter===yc.Linear&&e.minFilter===yc.Linear&&e.mipmapFilter===yc.Linear&&(e.maxAnisotropy=a.anisotropy),a.isDepthTexture&&null!==a.compareFunction&&(e.compare=yw[a.compareFunction]),d={sampler:b.device.createSampler(e),usedTimes:0},this._samplerCache.set(c,d)}let e=b.get(a);if(e.sampler!==d.sampler){if(void 0!==e.sampler){let a=this._samplerCache.get(e.samplerKey);a.usedTimes--,0===a.usedTimes&&this._samplerCache.delete(e.samplerKey)}e.samplerKey=c,e.sampler=d.sampler,d.usedTimes++}return c}createDefaultTexture(a){let b,c=f4(a);b=a.isCubeTexture?this._getDefaultCubeTextureGPU(c):this._getDefaultTextureGPU(c),this.backend.get(a).texture=b}createTexture(a,b={}){let c=this.backend,d=c.get(a);if(d.initialized)throw Error("WebGPUTextureUtils: Texture already initialized.");if(a.isExternalTexture){d.texture=a.sourceTexture,d.initialized=!0;return}void 0===b.needsMipmaps&&(b.needsMipmaps=!1),void 0===b.levels&&(b.levels=1),void 0===b.depth&&(b.depth=1);let{width:e,height:f,depth:g,levels:h}=b;a.isFramebufferTexture&&(b.renderTarget?b.format=this.backend.utils.getCurrentColorFormat(b.renderTarget):b.format=this.backend.utils.getPreferredCanvasFormat());let i=this._getDimension(a),j=a.internalFormat||b.format||f4(a,c.device);d.format=j;let{samples:k,primarySamples:l,isMSAA:m}=c.utils.getTextureSampleData(a),n=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;!0===a.isStorageTexture&&(n|=GPUTextureUsage.STORAGE_BINDING),!0!==a.isCompressedTexture&&!0!==a.isCompressedArrayTexture&&j!==ya.RGB9E5UFloat&&(n|=GPUTextureUsage.RENDER_ATTACHMENT);let o={label:a.name,size:{width:e,height:f,depthOrArrayLayers:g},mipLevelCount:h,sampleCount:l,dimension:i,format:j,usage:n};if(void 0===j){I("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(a);return}if(a.isCubeTexture&&(o.textureBindingViewDimension=ym.Cube),d.texture=c.device.createTexture(o),m){let a=Object.assign({},o);a.label+="-msaa",a.sampleCount=k,a.mipLevelCount=1,d.msaaTexture=c.device.createTexture(a)}d.initialized=!0,d.textureDescriptorGPU=o}destroyTexture(a,b=!1){let c=this.backend,d=c.get(a);void 0!==d.texture&&!1===b&&d.texture.destroy(),void 0!==d.msaaTexture&&d.msaaTexture.destroy(),c.delete(a)}generateMipmaps(a,b=null){let c=this.backend.get(a);if(a.isCubeTexture)for(let a=0;a<6;a++)this._generateMipmaps(c.texture,c.textureDescriptorGPU,a,b);else{let d=a.image.depth||1;for(let a=0;a<d;a++)this._generateMipmaps(c.texture,c.textureDescriptorGPU,a,b)}}getColorBuffer(){let a=this.backend,b=a.renderer.getCanvasTarget(),{width:c,height:d}=a.getDrawingBufferSize(),e=a.renderer.currentSamples,f=b.colorTexture,g=a.get(f);if(f.width===c&&f.height===d&&f.samples===e)return g.texture;let h=g.texture;return h&&h.destroy(),h=a.device.createTexture({label:"colorBuffer",size:{width:c,height:d,depthOrArrayLayers:1},sampleCount:a.utils.getSampleCount(a.renderer.currentSamples),format:a.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),f.source.width=c,f.source.height=d,f.samples=e,g.texture=h,h}getDepthBuffer(a=!0,b=!1){let c=this.backend,d=c.renderer.getCanvasTarget(),{width:e,height:f}=c.getDrawingBufferSize(),g=c.renderer.currentSamples,h=d.depthTexture;if(h.width===e&&h.height===f&&h.samples===g&&h.depth===a&&h.stencil===b)return c.get(h).texture;let i=c.get(h).texture,j,k;if(b?(j=aQ,k=aJ):a&&(j=aP,k=aE),void 0!==i){if(h.image.width===e&&h.image.height===f&&h.format===j&&h.type===k&&h.samples===g)return i;this.destroyTexture(h)}return h.name="depthBuffer",h.format=j,h.type=k,h.image.width=e,h.image.height=f,h.samples=g,this.createTexture(h,{width:e,height:f}),c.get(h).texture}updateTexture(a,b){let c=this.backend.get(a),d=a.mipmaps,{textureDescriptorGPU:e}=c;if(!(a.isRenderTargetTexture||void 0===e)){if(a.isDataTexture)if(d.length>0)for(let b=0,f=d.length;b<f;b++){let f=d[b];this._copyBufferToTexture(f,c.texture,e,0,a.flipY,0,b)}else this._copyBufferToTexture(b.image,c.texture,e,0,a.flipY);else if(a.isArrayTexture||a.isDataArrayTexture||a.isData3DTexture)for(let d=0;d<b.image.depth;d++)this._copyBufferToTexture(b.image,c.texture,e,d,a.flipY,d);else if(a.isCompressedTexture||a.isCompressedArrayTexture)this._copyCompressedBufferToTexture(a.mipmaps,c.texture,e);else if(a.isCubeTexture)this._copyCubeMapToTexture(a,c.texture,e);else if(d.length>0)for(let b=0,f=d.length;b<f;b++){let f=d[b];this._copyImageToTexture(f,c.texture,e,0,a.flipY,a.premultiplyAlpha,b)}else this._copyImageToTexture(b.image,c.texture,e,0,a.flipY,a.premultiplyAlpha);c.version=a.version}}async copyTextureToBuffer(a,b,c,d,e,f){let g=this.backend.device,h=this.backend.get(a),i=h.texture,j=h.textureDescriptorGPU.format,k=this._getBytesPerTexel(j),l=d*k;l=256*Math.ceil(l/256);let m=g.createBuffer({size:(e-1)*l+d*k,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),n=g.createCommandEncoder();n.copyTextureToBuffer({texture:i,origin:{x:b,y:c,z:f}},{buffer:m,bytesPerRow:l},{width:d,height:e});let o=this._getTypedArrayType(j);return g.queue.submit([n.finish()]),await m.mapAsync(GPUMapMode.READ),new o(m.getMappedRange())}dispose(){this._samplerCache.clear()}_getDefaultTextureGPU(a){let b=this.defaultTexture[a];if(void 0===b){let c=new b2;c.minFilter=as,c.magFilter=as,this.createTexture(c,{width:1,height:1,format:a}),this.defaultTexture[a]=b=c}return this.backend.get(b).texture}_getDefaultCubeTextureGPU(a){let b=this.defaultTexture[a];if(void 0===b){let c=new dX;c.minFilter=as,c.magFilter=as,this.createTexture(c,{width:1,height:1,depth:6}),this.defaultCubeTexture[a]=b=c}return this.backend.get(b).texture}_copyCubeMapToTexture(a,b,c){let d=a.images,e=a.mipmaps;for(let f=0;f<6;f++){let g=d[f],h=!0===a.flipY?yx[f]:f;g.isDataTexture?this._copyBufferToTexture(g.image,b,c,h,a.flipY):this._copyImageToTexture(g,b,c,h,a.flipY,a.premultiplyAlpha);for(let d=0;d<e.length;d++){let g=e[d].images[f];g.isDataTexture?this._copyBufferToTexture(g.image,b,c,h,a.flipY,0,d+1):this._copyImageToTexture(g,b,c,h,a.flipY,a.premultiplyAlpha,d+1)}}}_copyImageToTexture(a,b,c,d,e,f,g=0){let h=this.backend.device,i=g>0?a.width:c.size.width,j=g>0?a.height:c.size.height;h.queue.copyExternalImageToTexture({source:a,flipY:e},{texture:b,mipLevel:g,origin:{x:0,y:0,z:d},premultipliedAlpha:f},{width:i,height:j,depthOrArrayLayers:1})}_getPassUtils(){let a=this._passUtils;return null===a&&(this._passUtils=a=new yv(this.backend.device)),a}_generateMipmaps(a,b,c=0,d=null){this._getPassUtils().generateMipmaps(a,b,c,d)}_flipY(a,b,c=0){this._getPassUtils().flipY(a,b,c)}_copyBufferToTexture(a,b,c,d,e,f=0,g=0){let h=this.backend.device,i=a.data,j=this._getBytesPerTexel(c.format),k=a.width*j;h.queue.writeTexture({texture:b,mipLevel:g,origin:{x:0,y:0,z:d}},i,{offset:a.width*a.height*j*f,bytesPerRow:k},{width:a.width,height:a.height,depthOrArrayLayers:1}),!0===e&&this._flipY(b,c,d)}_copyCompressedBufferToTexture(a,b,c){let d=this.backend.device,e=this._getBlockData(c.format),f=c.size.depthOrArrayLayers>1;for(let g=0;g<a.length;g++){let h=a[g],i=h.width,j=h.height,k=f?c.size.depthOrArrayLayers:1,l=Math.ceil(i/e.width)*e.byteLength,m=l*Math.ceil(j/e.height);for(let a=0;a<k;a++)d.queue.writeTexture({texture:b,mipLevel:g,origin:{x:0,y:0,z:a}},h.data,{offset:a*m,bytesPerRow:l,rowsPerImage:Math.ceil(j/e.height)},{width:Math.ceil(i/e.width)*e.width,height:Math.ceil(j/e.height)*e.height,depthOrArrayLayers:1})}}_getBlockData(a){return a===ya.BC1RGBAUnorm||a===ya.BC1RGBAUnormSRGB?{byteLength:8,width:4,height:4}:a===ya.BC2RGBAUnorm||a===ya.BC2RGBAUnormSRGB||a===ya.BC3RGBAUnorm||a===ya.BC3RGBAUnormSRGB?{byteLength:16,width:4,height:4}:a===ya.BC4RUnorm||a===ya.BC4RSnorm?{byteLength:8,width:4,height:4}:a===ya.BC5RGUnorm||a===ya.BC5RGSnorm||a===ya.BC6HRGBUFloat||a===ya.BC6HRGBFloat||a===ya.BC7RGBAUnorm||a===ya.BC7RGBAUnormSRGB?{byteLength:16,width:4,height:4}:a===ya.ETC2RGB8Unorm||a===ya.ETC2RGB8UnormSRGB||a===ya.ETC2RGB8A1Unorm||a===ya.ETC2RGB8A1UnormSRGB?{byteLength:8,width:4,height:4}:a===ya.ETC2RGBA8Unorm||a===ya.ETC2RGBA8UnormSRGB?{byteLength:16,width:4,height:4}:a===ya.EACR11Unorm||a===ya.EACR11Snorm?{byteLength:8,width:4,height:4}:a===ya.EACRG11Unorm||a===ya.EACRG11Snorm||a===ya.ASTC4x4Unorm||a===ya.ASTC4x4UnormSRGB?{byteLength:16,width:4,height:4}:a===ya.ASTC5x4Unorm||a===ya.ASTC5x4UnormSRGB?{byteLength:16,width:5,height:4}:a===ya.ASTC5x5Unorm||a===ya.ASTC5x5UnormSRGB?{byteLength:16,width:5,height:5}:a===ya.ASTC6x5Unorm||a===ya.ASTC6x5UnormSRGB?{byteLength:16,width:6,height:5}:a===ya.ASTC6x6Unorm||a===ya.ASTC6x6UnormSRGB?{byteLength:16,width:6,height:6}:a===ya.ASTC8x5Unorm||a===ya.ASTC8x5UnormSRGB?{byteLength:16,width:8,height:5}:a===ya.ASTC8x6Unorm||a===ya.ASTC8x6UnormSRGB?{byteLength:16,width:8,height:6}:a===ya.ASTC8x8Unorm||a===ya.ASTC8x8UnormSRGB?{byteLength:16,width:8,height:8}:a===ya.ASTC10x5Unorm||a===ya.ASTC10x5UnormSRGB?{byteLength:16,width:10,height:5}:a===ya.ASTC10x6Unorm||a===ya.ASTC10x6UnormSRGB?{byteLength:16,width:10,height:6}:a===ya.ASTC10x8Unorm||a===ya.ASTC10x8UnormSRGB?{byteLength:16,width:10,height:8}:a===ya.ASTC10x10Unorm||a===ya.ASTC10x10UnormSRGB?{byteLength:16,width:10,height:10}:a===ya.ASTC12x10Unorm||a===ya.ASTC12x10UnormSRGB?{byteLength:16,width:12,height:10}:a===ya.ASTC12x12Unorm||a===ya.ASTC12x12UnormSRGB?{byteLength:16,width:12,height:12}:void 0}_convertAddressMode(a){let b=yb.ClampToEdge;return 1e3===a?b=yb.Repeat:1002===a&&(b=yb.MirrorRepeat),b}_convertFilterMode(a){let b=yc.Linear;return(1003===a||1004===a||1005===a)&&(b=yc.Nearest),b}_getBytesPerTexel(a){return a===ya.R8Unorm||a===ya.R8Snorm||a===ya.R8Uint||a===ya.R8Sint?1:a===ya.R16Uint||a===ya.R16Sint||a===ya.R16Float||a===ya.RG8Unorm||a===ya.RG8Snorm||a===ya.RG8Uint||a===ya.RG8Sint?2:a===ya.R32Uint||a===ya.R32Sint||a===ya.R32Float||a===ya.RG16Uint||a===ya.RG16Sint||a===ya.RG16Float||a===ya.RGBA8Unorm||a===ya.RGBA8UnormSRGB||a===ya.RGBA8Snorm||a===ya.RGBA8Uint||a===ya.RGBA8Sint||a===ya.BGRA8Unorm||a===ya.BGRA8UnormSRGB||a===ya.RGB9E5UFloat||a===ya.RGB10A2Unorm||a===ya.RG11B10UFloat||a===ya.Depth32Float||a===ya.Depth24Plus||a===ya.Depth24PlusStencil8||a===ya.Depth32FloatStencil8?4:a===ya.RG32Uint||a===ya.RG32Sint||a===ya.RG32Float||a===ya.RGBA16Uint||a===ya.RGBA16Sint||a===ya.RGBA16Float?8:a===ya.RGBA32Uint||a===ya.RGBA32Sint||a===ya.RGBA32Float?16:void 0}_getTypedArrayType(a){return a===ya.R8Uint?Uint8Array:a===ya.R8Sint?Int8Array:a===ya.R8Unorm?Uint8Array:a===ya.R8Snorm?Int8Array:a===ya.RG8Uint?Uint8Array:a===ya.RG8Sint?Int8Array:a===ya.RG8Unorm?Uint8Array:a===ya.RG8Snorm?Int8Array:a===ya.RGBA8Uint?Uint8Array:a===ya.RGBA8Sint?Int8Array:a===ya.RGBA8Unorm||a===ya.RGBA8UnormSRGB?Uint8Array:a===ya.RGBA8Snorm?Int8Array:a===ya.R16Uint?Uint16Array:a===ya.R16Sint?Int16Array:a===ya.RG16Uint?Uint16Array:a===ya.RG16Sint?Int16Array:a===ya.RGBA16Uint?Uint16Array:a===ya.RGBA16Sint?Int16Array:a===ya.R16Float||a===ya.RG16Float||a===ya.RGBA16Float?Uint16Array:a===ya.R32Uint?Uint32Array:a===ya.R32Sint?Int32Array:a===ya.R32Float?Float32Array:a===ya.RG32Uint?Uint32Array:a===ya.RG32Sint?Int32Array:a===ya.RG32Float?Float32Array:a===ya.RGBA32Uint?Uint32Array:a===ya.RGBA32Sint?Int32Array:a===ya.RGBA32Float?Float32Array:a===ya.BGRA8Unorm||a===ya.BGRA8UnormSRGB?Uint8Array:a===ya.RGB10A2Unorm||a===ya.RGB9E5UFloat||a===ya.RG11B10UFloat?Uint32Array:a===ya.Depth32Float?Float32Array:a===ya.Depth24Plus||a===ya.Depth24PlusStencil8?Uint32Array:a===ya.Depth32FloatStencil8?Float32Array:void 0}_getDimension(a){return a.is3DTexture||a.isData3DTexture?yl.ThreeD:yl.TwoD}},yz=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,yA=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/gi,yB={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_2d_array:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_depth_cube:"depthTexture",texture_depth_cube_array:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},yC=class extends wU{constructor(a){let{type:b,inputs:c,name:d,inputsCode:e,blockCode:f,outputType:g}=(a=>{let b=(a=a.trim()).match(yz);if(null!==b&&4===b.length){let c=b[2],d=[],e=null;for(;null!==(e=yA.exec(c));)d.push({name:e[1],type:e[2]});let f=[];for(let a=0;a<d.length;a++){let{name:b,type:c}=d[a],e=c;e.startsWith("ptr")?e="pointer":(e.startsWith("texture")&&(e=c.split("<")[0]),e=yB[e]),f.push(new wG(e,b))}let g=a.substring(b[0].length),h=b[3]||"void",i=void 0===b[1]?"":b[1];return{type:yB[h]||h,inputs:f,name:i,inputsCode:c,blockCode:g,outputType:h}}throw Error("FunctionNode: Function is not a WGSL code.")})(a);super(b,c,d),this.inputsCode=e,this.blockCode=f,this.outputType=g}getCode(a=this.name){let b="void"===this.outputType?"":"-> "+this.outputType;return`fn ${a} ( ${this.inputsCode.trim()} ) ${b}`+this.blockCode}},yD=class extends wT{parseFunction(a){return new yC(a)}},yE="u">typeof self?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},yF={[gf.READ_ONLY]:"read",[gf.WRITE_ONLY]:"write",[gf.READ_WRITE]:"read_write"},yG={[ap]:"repeat",[aq]:"clamp",[ar]:"mirror"},yH={vertex:yE?yE.VERTEX:1,fragment:yE?yE.FRAGMENT:2,compute:yE?yE.COMPUTE:4},yI={instance:!0,swizzleAssign:!1,storageBuffer:!0},yJ={"^^":"tsl_xor"},yK={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},yL={},yM={tsl_xor:new s0("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new s0("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new s0("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new s0("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new s0("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new s0("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new s0("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new s0("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new s0("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new s0("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new s0("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new s0("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new s0(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},yN={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"},yO="",("u">typeof navigator&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(yO+=`diagnostic( off, derivative_uniformity );
`),yP=class extends wE{constructor(a,b){super(a,b,new yD),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}_generateTextureSample(a,b,c,d,e,f=this.shaderStage){return"fragment"===f?d?e?`textureSample( ${b}, ${b}_sampler, ${c}, ${d}, ${e} )`:`textureSample( ${b}, ${b}_sampler, ${c}, ${d} )`:e?`textureSample( ${b}, ${b}_sampler, ${c}, ${e} )`:`textureSample( ${b}, ${b}_sampler, ${c} )`:this.generateTextureSampleLevel(a,b,c,"0",d)}generateTextureSampleLevel(a,b,c,d,e,f){return!1===this.isUnfilterable(a)?f?`textureSampleLevel( ${b}, ${b}_sampler, ${c}, ${d}, ${f} )`:`textureSampleLevel( ${b}, ${b}_sampler, ${c}, ${d} )`:this.isFilteredTexture(a)?this.generateFilteredTexture(a,b,c,f,d):this.generateTextureLod(a,b,c,e,f,d)}generateWrapFunction(a){let b=`tsl_coord_${yG[a.wrapS]}S_${yG[a.wrapT]}_${a.isData3DTexture?"3d":"2d"}T`,c=yL[b];if(void 0===c){let d=[],e=a.isData3DTexture?"vec3f":"vec2f",f=`fn ${b}( coord : ${e} ) -> ${e} {

	return ${e}(
`,g=(a,b)=>{1e3===a?(d.push(yM.repeatWrapping_float),f+=`		tsl_repeatWrapping_float( coord.${b} )`):1001===a?(d.push(yM.clampWrapping_float),f+=`		tsl_clampWrapping_float( coord.${b} )`):1002===a?(d.push(yM.mirrorWrapping_float),f+=`		tsl_mirrorWrapping_float( coord.${b} )`):(f+=`		coord.${b}`,I(`WebGPURenderer: Unsupported texture wrap type "${a}" for vertex shader.`))};g(a.wrapS,"x"),f+=`,
`,g(a.wrapT,"y"),a.isData3DTexture&&(f+=`,
`,g(a.wrapR,"z")),f+=`
	);

}
`,yL[b]=c=new s0(f,d)}return c.build(this),b}generateArrayDeclaration(a,b){return`array< ${this.getType(a)}, ${b} >`}generateTextureDimension(a,b,c){let d=this.getDataFromNode(a,this.shaderStage,this.globalCache);void 0===d.dimensionsSnippet&&(d.dimensionsSnippet={});let e=d.dimensionsSnippet[c];if(void 0===d.dimensionsSnippet[c]){let f,g,{primarySamples:h}=this.renderer.backend.utils.getTextureSampleData(a);g=a.isData3DTexture?"vec3<u32>":"vec2<u32>",f=h>1||a.isStorageTexture?b:`${b}${c?`, u32( ${c} )`:""}`,e=new jY(new kx(`textureDimensions( ${f} )`,g)),d.dimensionsSnippet[c]=e,(a.isArrayTexture||a.isDataArrayTexture||a.isData3DTexture)&&(d.arrayLayerCount=new jY(new kx(`textureNumLayers(${b})`,"u32"))),a.isTextureCube&&(d.cubeFaceCount=new jY(new kx("6u","u32")))}return e.build(this)}generateFilteredTexture(a,b,c,d,e="0u"){this._include("biquadraticTexture");let f=this.generateWrapFunction(a),g=this.generateTextureDimension(a,b,e);return d&&(c=`${c} + vec2<f32>(${d}) / ${g}`),`tsl_biquadraticTexture( ${b}, ${f}( ${c} ), ${g}, u32( ${e} ) )`}generateTextureLod(a,b,c,d,e,f="0u"){let g=this.generateWrapFunction(a),h=this.generateTextureDimension(a,b,f),i=a.isData3DTexture?"vec3":"vec2";e&&(c=`${c} + ${i}<f32>(${e}) / ${i}<f32>( ${h} )`);let j=`${i}<u32>( ${g}( ${c} ) * ${i}<f32>( ${h} ) )`;return this.generateTextureLoad(a,b,j,f,d,null)}generateTextureLoad(a,b,c,d,e,f){let g;return null===d&&(d="0u"),f&&(c=`${c} + ${f}`),e?g=`textureLoad( ${b}, ${c}, ${e}, u32( ${d} ) )`:(g=`textureLoad( ${b}, ${c}, u32( ${d} ) )`,this.renderer.backend.compatibilityMode&&a.isDepthTexture&&(g+=".x")),g}generateTextureStore(a,b,c,d,e){return d?`textureStore( ${b}, ${c}, ${d}, ${e} )`:`textureStore( ${b}, ${c}, ${e} )`}isSampleCompare(a){return!0===a.isDepthTexture&&null!==a.compareFunction}isUnfilterable(a){return"float"!==this.getComponentTypeFromTexture(a)||!this.isAvailable("float32Filterable")&&!0===a.isDataTexture&&1015===a.type||!1===this.isSampleCompare(a)&&1003===a.minFilter&&1003===a.magFilter||this.renderer.backend.utils.getTextureSampleData(a).primarySamples>1}generateTexture(a,b,c,d,e,f=this.shaderStage){return this.isUnfilterable(a)?this.generateTextureLod(a,b,c,d,e,"0",f):this._generateTextureSample(a,b,c,d,e,f)}generateTextureGrad(a,b,c,d,e,f,g=this.shaderStage){if("fragment"===g)return f?`textureSampleGrad( ${b}, ${b}_sampler, ${c},  ${d[0]}, ${d[1]}, ${f} )`:`textureSampleGrad( ${b}, ${b}_sampler, ${c},  ${d[0]}, ${d[1]} )`;J(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${g} shader.`)}generateTextureCompare(a,b,c,d,e,f,g=this.shaderStage){if("fragment"===g)return!0===a.isDepthTexture&&!0===a.isArrayTexture?f?`textureSampleCompare( ${b}, ${b}_sampler, ${c}, ${e}, ${d}, ${f} )`:`textureSampleCompare( ${b}, ${b}_sampler, ${c}, ${e}, ${d} )`:f?`textureSampleCompare( ${b}, ${b}_sampler, ${c}, ${d}, ${f} )`:`textureSampleCompare( ${b}, ${b}_sampler, ${c}, ${d} )`;J(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${g} shader.`)}generateTextureLevel(a,b,c,d,e,f){return!1===this.isUnfilterable(a)?f?`textureSampleLevel( ${b}, ${b}_sampler, ${c}, ${d}, ${f} )`:`textureSampleLevel( ${b}, ${b}_sampler, ${c}, ${d} )`:this.isFilteredTexture(a)?this.generateFilteredTexture(a,b,c,f,d):this.generateTextureLod(a,b,c,e,f,d)}generateTextureBias(a,b,c,d,e,f,g=this.shaderStage){if("fragment"===g)return f?`textureSampleBias( ${b}, ${b}_sampler, ${c}, ${d}, ${f} )`:`textureSampleBias( ${b}, ${b}_sampler, ${c}, ${d} )`;J(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${g} shader.`)}getPropertyName(a,b=this.shaderStage){if(!0===a.isNodeVarying&&!0===a.needsInterpolation){if("vertex"===b)return`varyings.${a.name}`}else if(!0===a.isNodeUniform){let b=a.name,c=a.type;return"texture"===c||"cubeTexture"===c||"storageTexture"===c||"texture3D"===c?b:"buffer"===c||"storageBuffer"===c||"indirectStorageBuffer"===c?this.isCustomStruct(a)?b:b+".value":a.groupNode.name+"."+b}return super.getPropertyName(a)}getOutputStructName(){return"output"}getFunctionOperator(a){let b=yJ[a];return void 0===b?null:(this._include(b),b)}getNodeAccess(a,b){return"compute"===b?a.access:!0===a.isAtomic?(I("WebGPURenderer: Atomic operations are only supported in compute shaders."),gf.READ_WRITE):gf.READ_ONLY}getStorageAccess(a,b){return yF[this.getNodeAccess(a,b)]}getUniformFromNode(a,b,c,d=null){let e=super.getUniformFromNode(a,b,c,d),f=this.getDataFromNode(a,c,this.globalCache);if(void 0===f.uniformGPU){let g,h=a.groupNode,i=h.name,j=this.getBindGroupArray(i,c);if("texture"===b||"cubeTexture"===b||"storageTexture"===b||"texture3D"===b){let d=null,f=this.getNodeAccess(a,c);if("texture"===b||"storageTexture"===b?d=!0===a.value.is3DTexture?new xA(e.name,e.node,h,f):new xy(e.name,e.node,h,f):"cubeTexture"===b?d=new xz(e.name,e.node,h,f):"texture3D"===b&&(d=new xA(e.name,e.node,h,f)),d.store=!0===a.isStorageTextureNode,d.mipLevel=d.store?a.mipLevel:0,d.setVisibility(yH[c]),!1===this.isUnfilterable(a.value)&&!1===d.store){let a=new yr(`${e.name}_sampler`,e.node,h);a.setVisibility(yH[c]),j.push(a,d),g=[a,d]}else j.push(d),g=[d]}else if("buffer"===b||"storageBuffer"===b||"indirectStorageBuffer"===b){let f=new("buffer"===b?xr:yu)(a,h);f.setVisibility(yH[c]),j.push(f),g=f,e.name=d||"NodeBuffer_"+e.id}else{let a=this.uniformGroups[c]||(this.uniformGroups[c]={}),d=a[i];void 0===d&&((d=new xu(i,h)).setVisibility(yH[c]),a[i]=d,j.push(d)),g=this.getNodeUniform(e,b),d.addUniform(g)}f.uniformGPU=g}return e}getBuiltin(a,b,c,d=this.shaderStage){let e=this.builtins[d]||(this.builtins[d]=new Map);return!1===e.has(a)&&e.set(a,{name:a,property:b,type:c}),b}hasBuiltin(a,b=this.shaderStage){return void 0!==this.builtins[b]&&this.builtins[b].has(a)}getVertexIndex(){return"vertex"===this.shaderStage?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(a){let b=a.layout,c=this.flowShaderNode(a),d=[];for(let a of b.inputs)d.push(a.name+" : "+this.getType(a.type));let e=`fn ${b.name}( ${d.join(", ")} ) -> ${this.getType(b.type)} {
${c.vars}
${c.code}
`;return c.result&&(e+=`	return ${c.result};
`),e+=`
}
`}getInstanceIndex(){return"vertex"===this.shaderStage?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(a,b=this.shaderStage){(this.directives[b]||(this.directives[b]=new Set)).add(a)}getDirectives(a){let b=[],c=this.directives[a];if(void 0!==c)for(let a of c)b.push(`enable ${a};`);return b.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(a){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${a} >`,"vertex")}getBuiltins(a){let b=[],c=this.builtins[a];if(void 0!==c)for(let{name:a,property:d,type:e}of c.values())b.push(`@builtin( ${a} ) ${d} : ${e}`);return b.join(`,
	`)}getScopedArray(a,b,c,d){return!1===this.scopedArrays.has(a)&&this.scopedArrays.set(a,{name:a,scope:b,bufferType:c,bufferCount:d}),a}getScopedArrays(a){if("compute"!==a)return;let b=[];for(let{name:a,scope:c,bufferType:d,bufferCount:e}of this.scopedArrays.values()){let f=this.getType(d);b.push(`var<${c}> ${a}: array< ${f}, ${e} >;`)}return b.join(`
`)}getAttributes(a){let b=[];if("compute"===a&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",a),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),"vertex"===a||"compute"===a){let a=this.getBuiltins("attribute");a&&b.push(a);let c=this.getAttributesArray();for(let a=0,d=c.length;a<d;a++){let d=c[a],e=d.name,f=this.getType(d.type);b.push(`@location( ${a} ) ${e} : ${f}`)}}return b.join(`,
	`)}getStructMembers(a){let b=[];for(let c of a.members){let d=a.output?"@location( "+c.index+" ) ":"",e=this.getType(c.type);c.atomic&&(e="atomic< "+e+" >"),b.push(`	${d+c.name} : ${e}`)}return a.output&&b.push(`	${this.getBuiltins("output")}`),b.join(`,
`)}getStructs(a){let b="",c=this.structs[a];if(c.length>0){let a=[];for(let b of c){let c=`struct ${b.name} {
`;c+=this.getStructMembers(b),c+=`
};`,a.push(c)}b=`
`+a.join(`

`)+`
`}return b}getVar(a,b,c=null){let d=`var ${b} : `;return null===c?d+=this.getType(a):d+=this.generateArrayDeclaration(a,c),d}getVars(a){let b=[],c=this.vars[a];if(void 0!==c)for(let a of c)b.push(`	${this.getVar(a.type,a.name,a.count)};`);return`
${b.join(`
`)}
`}getVaryings(a){let b=[];if("vertex"===a&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),"vertex"===a||"fragment"===a){let c=this.varyings,d=this.vars[a];for(let e=0;e<c.length;e++){let f=c[e];if(f.needsInterpolation){let a=`@location( ${e} )`;if(f.interpolationType){let b=null===f.interpolationSampling?" )":`, ${f.interpolationSampling} )`;a+=` @interpolate( ${f.interpolationType}${b}`}else/^(int|uint|ivec|uvec)/.test(f.type)&&(a+=` @interpolate( ${this.renderer.backend.compatibilityMode?"flat, either":"flat"} )`);b.push(`${a} ${f.name} : ${this.getType(f.type)}`)}else"vertex"===a&&!1===d.includes(f)&&d.push(f)}}let c=this.getBuiltins(a);c&&b.push(c);let d=b.join(`,
	`);return"vertex"===a?this._getWGSLStruct("VaryingsStruct","	"+d):d}isCustomStruct(a){let b=a.value,c=a.node,d=(b.isBufferAttribute||b.isInstancedBufferAttribute)&&null!==c.structTypeNode,e=c.value&&c.value.array&&"number"==typeof c.value.itemSize&&c.value.array.length>c.value.itemSize;return d&&!e}getUniforms(a){let b=this.uniforms[a],c=[],d=[],e=[],f={};for(let e of b){let b=e.groupNode.name,g=this.bindingsIndexes[b];if("texture"===e.type||"cubeTexture"===e.type||"storageTexture"===e.type||"texture3D"===e.type){let b=e.node.value;!1===this.isUnfilterable(b)&&!0!==e.node.isStorageTextureNode&&(this.isSampleCompare(b)?c.push(`@binding( ${g.binding++} ) @group( ${g.group} ) var ${e.name}_sampler : sampler_comparison;`):c.push(`@binding( ${g.binding++} ) @group( ${g.group} ) var ${e.name}_sampler : sampler;`));let d,f="",{primarySamples:h}=this.renderer.backend.utils.getTextureSampleData(b);if(h>1&&(f="_multisampled"),!0===b.isCubeTexture)d="texture_cube<f32>";else if(!0===b.isDepthTexture)d=this.renderer.backend.compatibilityMode&&null===b.compareFunction?`texture${f}_2d<f32>`:`texture_depth${f}_2d${!0===b.isArrayTexture?"_array":""}`;else if(!0===e.node.isStorageTextureNode){let c=f4(b),f=this.getStorageAccess(e.node,a),g=e.node.value.is3DTexture,h=e.node.value.isArrayTexture;d=`texture_storage_${g?"3d":`2d${h?"_array":""}`}<${c}, ${f}>`}else if(!0===b.isArrayTexture||!0===b.isDataArrayTexture||!0===b.isCompressedArrayTexture)d="texture_2d_array<f32>";else if(!0===b.is3DTexture||!0===b.isData3DTexture)d="texture_3d<f32>";else{let a=this.getComponentTypeFromTexture(b).charAt(0);d=`texture${f}_2d<${a}32>`}c.push(`@binding( ${g.binding++} ) @group( ${g.group} ) var ${e.name} : ${d};`)}else if("buffer"===e.type||"storageBuffer"===e.type||"indirectStorageBuffer"===e.type){let b=e.node,c=this.getType(b.getNodeType(this)),f=b.bufferCount,h=f>0&&"buffer"===e.type?", "+f:"",i=b.isStorageBufferNode?`storage, ${this.getStorageAccess(b,a)}`:"uniform";if(this.isCustomStruct(e))d.push(`@binding( ${g.binding++} ) @group( ${g.group} ) var<${i}> ${e.name} : ${c};`);else{let a=`	value : array< ${b.isAtomic?`atomic<${c}>`:`${c}`}${h} >`;d.push(this._getWGSLStructBinding(e.name,a,i,g.binding++,g.group))}}else{let a=this.getType(this.getVectorType(e.type)),b=e.groupNode.name;(f[b]||(f[b]={index:g.binding++,id:g.group,snippets:[]})).snippets.push(`	${e.name} : ${a}`)}}for(let a in f){let b=f[a];e.push(this._getWGSLStructBinding(a,b.snippets.join(`,
`),"uniform",b.index,b.id))}let g=c.join(`
`);return g+=d.join(`
`),g+=e.join(`
`)}buildCode(){let a=null===this.material?{compute:{}}:{fragment:{},vertex:{}};for(let b in this.sortBindingGroups(),a){this.shaderStage=b;let c=a[b];c.uniforms=this.getUniforms(b),c.attributes=this.getAttributes(b),c.varyings=this.getVaryings(b),c.structs=this.getStructs(b),c.vars=this.getVars(b),c.codes=this.getCodes(b),c.directives=this.getDirectives(b),c.scopedArrays=this.getScopedArrays(b);let d=`// code

`;d+=this.flowCode[b];let e=this.flowNodes[b],f=e[e.length-1],g=f.outputNode,h=void 0!==g&&!0===g.isOutputStructNode;for(let a of e){let e=this.getFlowData(a),i=a.name;if(i&&(d.length>0&&(d+=`
`),d+=`	// flow -> ${i}
`),d+=`${e.code}
	`,a===f&&"compute"!==b){if(d+=`// result

	`,"vertex"===b)d+=`varyings.Vertex = ${e.result};`;else if("fragment"===b)if(h)c.returnType=g.getNodeType(this),c.structs+="var<private> output : "+c.returnType+";",d+=`return ${e.result};`;else{let a="	@location(0) color: vec4<f32>",b=this.getBuiltins("output");b&&(a+=`,
	`+b),c.returnType="OutputStruct",c.structs+=this._getWGSLStruct("OutputStruct",a),c.structs+=`
var<private> output : OutputStruct;`,d+=`output.color = ${e.result};

	return output;`}}}c.flow=d}if(this.shaderStage=null,null!==this.material)this.vertexShader=this._getWGSLVertexCode(a.vertex),this.fragmentShader=this._getWGSLFragmentCode(a.fragment);else{let b=this.object.workgroupSize;this.computeShader=this._getWGSLComputeCode(a.compute,b)}}getMethod(a,b=null){let c;return null!==b&&(c=this._getWGSLMethod(a+"_"+b)),void 0===c&&(c=this._getWGSLMethod(a)),c||a}getBitcastMethod(a){return`bitcast<${this.getType(a)}>`}getTernary(a,b,c){return`select( ${c}, ${b}, ${a} )`}getType(a){return yK[a]||a}isAvailable(a){let b=yI[a];return void 0===b&&("float32Filterable"===a?b=this.renderer.hasFeature("float32-filterable"):"clipDistance"===a&&(b=this.renderer.hasFeature("clip-distances")),yI[a]=b),b}_getWGSLMethod(a){return void 0!==yM[a]&&this._include(a),yN[a]}_include(a){let b=yM[a];return b.build(this),this.addInclude(b),b}_getWGSLVertexCode(a){return`${this.getSignature()}
// directives
${a.directives}

// structs
${a.structs}

// uniforms
${a.uniforms}

// varyings
${a.varyings}
var<private> varyings : VaryingsStruct;

// codes
${a.codes}

@vertex
fn main( ${a.attributes} ) -> VaryingsStruct {

	// vars
	${a.vars}

	// flow
	${a.flow}

	return varyings;

}
`}_getWGSLFragmentCode(a){return`${this.getSignature()}
// global
${yO}

// structs
${a.structs}

// uniforms
${a.uniforms}

// codes
${a.codes}

@fragment
fn main( ${a.varyings} ) -> ${a.returnType} {

	// vars
	${a.vars}

	// flow
	${a.flow}

}
`}_getWGSLComputeCode(a,b){let[c,d,e]=b;return`${this.getSignature()}
// directives
${a.directives}

// system
var<private> instanceIndex : u32;

// locals
${a.scopedArrays}

// structs
${a.structs}

// uniforms
${a.uniforms}

// codes
${a.codes}

@compute @workgroup_size( ${c}, ${d}, ${e} )
fn main( ${a.attributes} ) {

	// system
	instanceIndex = globalId.x
		+ globalId.y * ( ${c} * numWorkgroups.x )
		+ globalId.z * ( ${c} * numWorkgroups.x ) * ( ${d} * numWorkgroups.y );

	// vars
	${a.vars}

	// flow
	${a.flow}

}
`}_getWGSLStruct(a,b){return`
struct ${a} {
${b}
};`}_getWGSLStructBinding(a,b,c,d=0,e=0){let f=a+"Struct";return`${this._getWGSLStruct(f,b)}
@binding( ${d} ) @group( ${e} )
var<${c}> ${a} : ${f};`}},yQ=class{constructor(a){this.backend=a}getCurrentDepthStencilFormat(a){let b;return null===a.depthTexture?a.depth&&a.stencil?b=ya.Depth24PlusStencil8:a.depth&&(b=ya.Depth24Plus):b=this.getTextureFormatGPU(a.depthTexture),b}getTextureFormatGPU(a){return this.backend.get(a).format}getTextureSampleData(a){let b;if(a.isFramebufferTexture)b=1;else if(a.isDepthTexture&&!a.renderTarget){let a=this.backend.renderer,c=a.getRenderTarget();b=c?c.samples:a.currentSamples}else a.renderTarget&&(b=a.renderTarget.samples);b||(b=1);let c=b>1&&null!==a.renderTarget&&!0!==a.isDepthTexture&&!0!==a.isFramebufferTexture;return{samples:b,primarySamples:c?1:b,isMSAA:c}}getCurrentColorFormat(a){return null===a.textures?this.getPreferredCanvasFormat():this.getTextureFormatGPU(a.textures[0])}getCurrentColorFormats(a){return null===a.textures?[this.getPreferredCanvasFormat()]:a.textures.map(a=>this.getTextureFormatGPU(a))}getCurrentColorSpace(a){return null===a.textures?this.backend.renderer.outputColorSpace:a.textures[0].colorSpace}getPrimitiveTopology(a,b){return a.isPoints?x3.PointList:a.isLineSegments||a.isMesh&&!0===b.wireframe?x3.LineList:a.isLine?x3.LineStrip:a.isMesh?x3.TriangleList:void 0}getSampleCount(a){return a>=4?4:1}getSampleCountRenderContext(a){return null===a.textures?this.getSampleCount(this.backend.renderer.currentSamples):this.getSampleCount(a.sampleCount)}getPreferredCanvasFormat(){let a=this.backend.parameters.outputType;if(void 0===a)return navigator.gpu.getPreferredCanvasFormat();if(1009===a)return ya.BGRA8Unorm;if(1016===a)return ya.RGBA16Float;throw Error("Unsupported outputType")}},yR=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]),"u">typeof Float16Array&&yR.set(Float16Array,["float16"]),yS=new Map([[dr,["float16"]]]),yT=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]),yU=class{constructor(a){this.backend=a}createAttribute(a,b){let c=this._getBufferAttribute(a),d=this.backend,e=d.get(c),f=e.buffer;if(void 0===f){let g=d.device,h=c.array;if(!1===a.normalized){if(h.constructor===Int16Array||h.constructor===Int8Array)h=new Int32Array(h);else if((h.constructor===Uint16Array||h.constructor===Uint8Array)&&(h=new Uint32Array(h),b&GPUBufferUsage.INDEX))for(let a=0;a<h.length;a++)65535===h[a]&&(h[a]=0xffffffff)}if(c.array=h,(c.isStorageBufferAttribute||c.isStorageInstancedBufferAttribute)&&3===c.itemSize){h=new h.constructor(4*c.count);for(let a=0;a<c.count;a++)h.set(c.array.subarray(3*a,3*a+3),4*a);c.itemSize=4,c.array=h,e._force3to4BytesAlignment=!0}let i=h.byteLength;f=g.createBuffer({label:c.name,size:i+(4-i%4)%4,usage:b,mappedAtCreation:!0}),new h.constructor(f.getMappedRange()).set(h),f.unmap(),e.buffer=f}}updateAttribute(a){let b=this._getBufferAttribute(a),c=this.backend,d=c.device,e=c.get(b),f=c.get(b).buffer,g=b.array;if(!0===e._force3to4BytesAlignment){g=new g.constructor(4*b.count);for(let a=0;a<b.count;a++)g.set(b.array.subarray(3*a,3*a+3),4*a);b.array=g}let h=this._isTypedArray(g),i=b.updateRanges;if(0===i.length)d.queue.writeBuffer(f,0,g,0);else{let a=h?1:g.BYTES_PER_ELEMENT;for(let b=0,c=i.length;b<c;b++){let c=i[b],j,k;if(!0===e._force3to4BytesAlignment){let b=Math.floor(c.start/3),d=Math.ceil(c.count/3);j=4*b*a,k=4*d*a}else j=c.start*a,k=c.count*a;let l=j*(h?g.BYTES_PER_ELEMENT:1);d.queue.writeBuffer(f,l,g,j,k)}b.clearUpdateRanges()}}createShaderVertexBuffers(a){let b=a.getAttributes(),c=new Map;for(let a=0;a<b.length;a++){let d=b[a],e=d.array.BYTES_PER_ELEMENT,f=this._getBufferAttribute(d),g=c.get(f);if(void 0===g){let a,b;!0===d.isInterleavedBufferAttribute?(a=d.data.stride*e,b=d.data.isInstancedInterleavedBuffer?yo.Instance:yo.Vertex):(a=d.itemSize*e,b=d.isInstancedBufferAttribute?yo.Instance:yo.Vertex),!1===d.normalized&&(d.array.constructor===Int16Array||d.array.constructor===Uint16Array)&&(a=4),g={arrayStride:a,attributes:[],stepMode:b},c.set(f,g)}let h=this._getVertexFormat(d),i=!0===d.isInterleavedBufferAttribute?d.offset*e:0;g.attributes.push({shaderLocation:a,offset:i,format:h})}return Array.from(c.values())}destroyAttribute(a){let b=this.backend;b.get(this._getBufferAttribute(a)).buffer.destroy(),b.delete(a)}async getArrayBufferAsync(a){let b=this.backend,c=b.device,d=b.get(this._getBufferAttribute(a)).buffer,e=d.size,f=c.createBuffer({label:`${a.name}_readback`,size:e,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),g=c.createCommandEncoder({label:`readback_encoder_${a.name}`});g.copyBufferToBuffer(d,0,f,0,e);let h=g.finish();c.queue.submit([h]),await f.mapAsync(GPUMapMode.READ);let i=f.getMappedRange(),j=new a.array.constructor(i.slice(0));return f.unmap(),j.buffer}_getVertexFormat(a){let{itemSize:b,normalized:c}=a,d=a.array.constructor,e=a.constructor,f;if(1===b)f=yT.get(d);else{let a=(yS.get(e)||yR.get(d))[+!!c];if(a){let c=4*Math.floor((d.BYTES_PER_ELEMENT*b+3)/4)/d.BYTES_PER_ELEMENT;if(c%1)throw Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");f=`${a}x${c}`}}return f||J("WebGPUAttributeUtils: Vertex format not supported yet."),f}_isTypedArray(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)}_getBufferAttribute(a){return a.isInterleavedBufferAttribute&&(a=a.data),a}},yV=class{constructor(a){this.backend=a,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(a){let b=this.backend,c=b.device,d=[],e=0;for(let c of a.bindings){let a={binding:e++,visibility:c.visibility};if(c.isUniformBuffer||c.isStorageBuffer){let b={};c.isStorageBuffer&&(4&c.visibility&&(c.access===gf.READ_WRITE||c.access===gf.WRITE_ONLY)?b.type=yh.Storage:b.type=yh.ReadOnlyStorage),a.buffer=b}else if(c.isSampledTexture&&c.store){let b={};b.format=this.backend.get(c.texture).texture.format;let d=c.access;d===gf.READ_WRITE?b.access=yi.ReadWrite:d===gf.WRITE_ONLY?b.access=yi.WriteOnly:b.access=yi.ReadOnly,c.texture.isArrayTexture?b.viewDimension=ym.TwoDArray:c.texture.is3DTexture&&(b.viewDimension=ym.ThreeD),a.storageTexture=b}else if(c.isSampledTexture){let d={},{primarySamples:e}=b.utils.getTextureSampleData(c.texture);if(e>1&&(d.multisampled=!0,c.texture.isDepthTexture||(d.sampleType=yk.UnfilterableFloat)),c.texture.isDepthTexture)b.compatibilityMode&&null===c.texture.compareFunction?d.sampleType=yk.UnfilterableFloat:d.sampleType=yk.Depth;else if(c.texture.isDataTexture||c.texture.isDataArrayTexture||c.texture.isData3DTexture){let a=c.texture.type;1013===a?d.sampleType=yk.SInt:1014===a?d.sampleType=yk.UInt:1015===a&&(this.backend.hasFeature("float32-filterable")?d.sampleType=yk.Float:d.sampleType=yk.UnfilterableFloat)}c.isSampledCubeTexture?d.viewDimension=ym.Cube:c.texture.isArrayTexture||c.texture.isDataArrayTexture||c.texture.isCompressedArrayTexture?d.viewDimension=ym.TwoDArray:c.isSampledTexture3D&&(d.viewDimension=ym.ThreeD),a.texture=d}else if(c.isSampler){let d={};c.texture.isDepthTexture&&(null===c.texture.compareFunction?b.compatibilityMode&&(d.type=yj.NonFiltering):d.type=yj.Comparison),a.sampler=d}else J(`WebGPUBindingUtils: Unsupported binding "${c}".`);d.push(a)}return c.createBindGroupLayout({entries:d})}createBindings(a,b,c,d=0){let e,{backend:f,bindGroupLayoutCache:g}=this,h=f.get(a),i=g.get(a.bindingsReference);void 0===i&&(i=this.createBindingsLayout(a),g.set(a.bindingsReference,i)),c>0&&(void 0===h.groups&&(h.groups=[],h.versions=[]),h.versions[c]===d&&(e=h.groups[c])),void 0===e&&(e=this.createBindGroup(a,i),c>0&&(h.groups[c]=e,h.versions[c]=d)),h.group=e,h.layout=i}updateBinding(a){let b=this.backend,c=b.device,d=a.buffer,e=b.get(a).buffer;c.queue.writeBuffer(e,0,d,0)}createBindGroupIndex(a,b){let c=this.backend.device,d=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,e=a[0],f=c.createBuffer({label:"bindingCameraIndex_"+e,size:16,usage:d});c.queue.writeBuffer(f,0,a,0);let g=[{binding:0,resource:{buffer:f}}];return c.createBindGroup({label:"bindGroupCameraIndex_"+e,layout:b,entries:g})}createBindGroup(a,b){let c=this.backend,d=c.device,e=0,f=[];for(let b of a.bindings){if(b.isUniformBuffer){let a=c.get(b);if(void 0===a.buffer){let c=b.byteLength,e=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST;a.buffer=d.createBuffer({label:"bindingBuffer_"+b.name,size:c,usage:e})}f.push({binding:e,resource:{buffer:a.buffer}})}else if(b.isStorageBuffer){let a=c.get(b);if(void 0===a.buffer){let d=b.attribute;a.buffer=c.get(d).buffer}f.push({binding:e,resource:{buffer:a.buffer}})}else if(b.isSampledTexture){let a=c.get(b.texture),g;if(void 0!==a.externalTexture)g=d.importExternalTexture({source:a.externalTexture});else{let c=b.store?1:a.texture.mipLevelCount,d=b.store?b.mipLevel:0,e=`view-${a.texture.width}-${a.texture.height}`;if(a.texture.depthOrArrayLayers>1&&(e+=`-${a.texture.depthOrArrayLayers}`),e+=`-${c}-${d}`,void 0===(g=a[e])){let f=yn.All,h;h=b.isSampledCubeTexture?ym.Cube:b.isSampledTexture3D?ym.ThreeD:b.texture.isArrayTexture||b.texture.isDataArrayTexture||b.texture.isCompressedArrayTexture?ym.TwoDArray:ym.TwoD,g=a[e]=a.texture.createView({aspect:f,dimension:h,mipLevelCount:c,baseMipLevel:d})}}f.push({binding:e,resource:g})}else if(b.isSampler){let a=c.get(b.texture);f.push({binding:e,resource:a.sampler})}e++}return d.createBindGroup({label:"bindGroup_"+a.name,layout:b,entries:f})}},yW=class{constructor(a){this.backend=a,this._activePipelines=new WeakMap}setPipeline(a,b){this._activePipelines.get(a)!==b&&(a.setPipeline(b),this._activePipelines.set(a,b))}_getSampleCount(a){return this.backend.utils.getSampleCountRenderContext(a)}createRenderPipeline(a,b){let{object:c,material:d,geometry:e,pipeline:f}=a,{vertexProgram:g,fragmentProgram:h}=f,i=this.backend,j=i.device,k=i.utils,l=i.get(f),m=[];for(let b of a.getBindings()){let a=i.get(b);m.push(a.layout)}let n=i.attributeUtils.createShaderVertexBuffers(a),o;0!==d.blending&&(1!==d.blending||!1!==d.transparent)&&(o=this._getBlending(d));let p={};!0===d.stencilWrite&&(p={compare:this._getStencilCompare(d),failOp:this._getStencilOperation(d.stencilFail),depthFailOp:this._getStencilOperation(d.stencilZFail),passOp:this._getStencilOperation(d.stencilZPass)});let q=this._getColorWriteMask(d),r=[];if(null!==a.context.textures){let b=a.context.textures;for(let a=0;a<b.length;a++){let c=k.getTextureFormatGPU(b[a]);r.push({format:c,blend:o,writeMask:q})}}else{let b=k.getCurrentColorFormat(a.context);r.push({format:b,blend:o,writeMask:q})}let s=i.get(g).module,t=i.get(h).module,u=this._getPrimitiveState(c,e,d),v=this._getDepthCompare(d),w=k.getCurrentDepthStencilFormat(a.context),x=this._getSampleCount(a.context),y={label:`renderPipeline_${d.name||d.type}_${d.id}`,vertex:Object.assign({},s,{buffers:n}),fragment:Object.assign({},t,{targets:r}),primitive:u,multisample:{count:x,alphaToCoverageEnabled:d.alphaToCoverage&&x>1},layout:j.createPipelineLayout({bindGroupLayouts:m})},z={},A=a.context.depth,B=a.context.stencil;if((!0===A||!0===B)&&(!0===A&&(z.format=w,z.depthWriteEnabled=d.depthWrite,z.depthCompare=v),!0===B&&(z.stencilFront=p,z.stencilBack={},z.stencilReadMask=d.stencilFuncMask,z.stencilWriteMask=d.stencilWriteMask),!0===d.polygonOffset&&(z.depthBias=d.polygonOffsetUnits,z.depthBiasSlopeScale=d.polygonOffsetFactor,z.depthBiasClamp=0),y.depthStencil=z),j.pushErrorScope("validation"),null===b)l.pipeline=j.createRenderPipeline(y),j.popErrorScope().then(a=>{null!==a&&(l.error=!0,J(a.message))});else{let a=new Promise(async a=>{try{l.pipeline=await j.createRenderPipelineAsync(y)}catch{}let b=await j.popErrorScope();null!==b&&(l.error=!0,J(b.message)),a()});b.push(a)}}createBundleEncoder(a,b="renderBundleEncoder"){let{utils:c,device:d}=this.backend,e=c.getCurrentDepthStencilFormat(a),f={label:b,colorFormats:c.getCurrentColorFormats(a),depthStencilFormat:e,sampleCount:this._getSampleCount(a)};return d.createRenderBundleEncoder(f)}createComputePipeline(a,b){let c=this.backend,d=c.device,e=c.get(a.computeProgram).module,f=c.get(a),g=[];for(let a of b){let b=c.get(a);g.push(b.layout)}f.pipeline=d.createComputePipeline({compute:e,layout:d.createPipelineLayout({bindGroupLayouts:g})})}_getBlending(a){let b,c,d=a.blending,e=a.blendSrc,f=a.blendDst,g=a.blendEquation;if(5===d){let d=null===a.blendSrcAlpha?e:a.blendSrcAlpha,h=null===a.blendDstAlpha?f:a.blendDstAlpha,i=null===a.blendEquationAlpha?g:a.blendEquationAlpha;b={srcFactor:this._getBlendFactor(e),dstFactor:this._getBlendFactor(f),operation:this._getBlendOperation(g)},c={srcFactor:this._getBlendFactor(d),dstFactor:this._getBlendFactor(h),operation:this._getBlendOperation(i)}}else{let e=a.premultipliedAlpha,f=(a,d,e,f)=>{b={srcFactor:a,dstFactor:d,operation:ye.Add},c={srcFactor:e,dstFactor:f,operation:ye.Add}};if(e)switch(d){case 1:f(yd.One,yd.OneMinusSrcAlpha,yd.One,yd.OneMinusSrcAlpha);break;case 2:f(yd.One,yd.One,yd.One,yd.One);break;case 3:f(yd.Zero,yd.OneMinusSrc,yd.Zero,yd.One);break;case 4:f(yd.Dst,yd.OneMinusSrcAlpha,yd.Zero,yd.One)}else switch(d){case 1:f(yd.SrcAlpha,yd.OneMinusSrcAlpha,yd.One,yd.OneMinusSrcAlpha);break;case 2:f(yd.SrcAlpha,yd.One,yd.One,yd.One);break;case 3:J("WebGPURenderer: SubtractiveBlending requires material.premultipliedAlpha = true");break;case 4:J("WebGPURenderer: MultiplyBlending requires material.premultipliedAlpha = true")}}if(void 0!==b&&void 0!==c)return{color:b,alpha:c};J("WebGPURenderer: Invalid blending: ",d)}_getBlendFactor(a){let b;switch(a){case 200:b=yd.Zero;break;case 201:b=yd.One;break;case 202:b=yd.Src;break;case 203:b=yd.OneMinusSrc;break;case 204:b=yd.SrcAlpha;break;case 205:b=yd.OneMinusSrcAlpha;break;case 208:b=yd.Dst;break;case 209:b=yd.OneMinusDst;break;case 206:b=yd.DstAlpha;break;case 207:b=yd.OneMinusDstAlpha;break;case 210:b=yd.SrcAlphaSaturated;break;case 211:b=yd.Constant;break;case 212:b=yd.OneMinusConstant;break;default:J("WebGPURenderer: Blend factor not supported.",a)}return b}_getStencilCompare(a){let b,c=a.stencilFunc;switch(c){case 512:b=x4.Never;break;case 519:b=x4.Always;break;case 513:b=x4.Less;break;case 515:b=x4.LessEqual;break;case 514:b=x4.Equal;break;case 518:b=x4.GreaterEqual;break;case 516:b=x4.Greater;break;case 517:b=x4.NotEqual;break;default:J("WebGPURenderer: Invalid stencil function.",c)}return b}_getStencilOperation(a){let b;switch(a){case bu:b=yg.Keep;break;case 0:b=yg.Zero;break;case bv:b=yg.Replace;break;case bA:b=yg.Invert;break;case bw:b=yg.IncrementClamp;break;case bx:b=yg.DecrementClamp;break;case by:b=yg.IncrementWrap;break;case bz:b=yg.DecrementWrap;break;default:J("WebGPURenderer: Invalid stencil operation.",b)}return b}_getBlendOperation(a){let b;switch(a){case 100:b=ye.Add;break;case 101:b=ye.Subtract;break;case 102:b=ye.ReverseSubtract;break;case 103:b=ye.Min;break;case 104:b=ye.Max;break;default:J("WebGPUPipelineUtils: Blend equation not supported.",a)}return b}_getPrimitiveState(a,b,c){let d={};d.topology=this.backend.utils.getPrimitiveTopology(a,c),null!==b.index&&!0===a.isLine&&!0!==a.isLineSegments&&(d.stripIndexFormat=b.index.array instanceof Uint16Array?x9.Uint16:x9.Uint32);let e=1===c.side;return a.isMesh&&0>a.matrixWorld.determinant()&&(e=!e),d.frontFace=!0===e?x7.CW:x7.CCW,d.cullMode=2===c.side?x8.None:x8.Back,d}_getColorWriteMask(a){return!0===a.colorWrite?yf.All:yf.None}_getDepthCompare(a){let b;if(!1===a.depthTest)b=x4.Always;else{let c=a.depthFunc;switch(c){case 0:b=x4.Never;break;case 1:b=x4.Always;break;case 2:b=x4.Less;break;case 3:b=x4.LessEqual;break;case 4:b=x4.Equal;break;case 5:b=x4.GreaterEqual;break;case 6:b=x4.Greater;break;case 7:b=x4.NotEqual;break;default:J("WebGPUPipelineUtils: Invalid depth function.",c)}}return b}},yX=class extends x0{constructor(a,b,c=2048){super(c),this.device=a,this.type=b,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${b}`});let d=8*this.maxQueries;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${b}`,size:d,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${b}`,size:d,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(a){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return K(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;let b=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(a,b),b}async resolveQueriesAsync(){if(!this.trackTimestamp||0===this.currentQueryIndex||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if("unmapped"!==this.resultBuffer.mapState)return this.lastValue;let a=new Map(this.queryOffsets),b=this.currentQueryIndex,c=8*b;this.currentQueryIndex=0,this.queryOffsets.clear();let d=this.device.createCommandEncoder();d.resolveQuerySet(this.querySet,0,b,this.resolveBuffer,0),d.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,c);let e=d.finish();if(this.device.queue.submit([e]),"unmapped"!==this.resultBuffer.mapState)return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,c),this.isDisposed)return"mapped"===this.resultBuffer.mapState&&this.resultBuffer.unmap(),this.lastValue;let f=new BigUint64Array(this.resultBuffer.getMappedRange(0,c)),g={},h=[];for(let[b,c]of a){let a=b.match(/^(.*):f(\d+)$/),d=parseInt(a[2]);!1===h.includes(d)&&h.push(d),void 0===g[d]&&(g[d]=0);let e=f[c],i=f[c+1],j=Number(i-e)/1e6;this.timestamps.set(b,j),g[d]+=j}let i=g[h[h.length-1]];return this.resultBuffer.unmap(),this.lastValue=i,this.frames=h,i}catch(a){return a("Error resolving queries:",a),"mapped"===this.resultBuffer.mapState&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(a){a("Error waiting for pending resolve:",a)}if(this.resultBuffer&&"mapped"===this.resultBuffer.mapState)try{this.resultBuffer.unmap()}catch(a){a("Error unmapping buffer:",a)}this.querySet&&(this.querySet=(this.querySet.destroy(),null)),this.resolveBuffer&&(this.resolveBuffer=(this.resolveBuffer.destroy(),null)),this.resultBuffer&&(this.resultBuffer=(this.resultBuffer.destroy(),null)),this.queryOffsets.clear(),this.pendingResolve=null}}},yY=class extends xL{constructor(a={}){super(a),this.isWebGPUBackend=!0,this.parameters.alpha=void 0===a.alpha||a.alpha,this.parameters.compatibilityMode=void 0!==a.compatibilityMode&&a.compatibilityMode,this.parameters.requiredLimits=void 0===a.requiredLimits?{}:a.requiredLimits,this.compatibilityMode=this.parameters.compatibilityMode,this.device=null,this.defaultRenderPassdescriptor=null,this.utils=new yQ(this),this.attributeUtils=new yU(this),this.bindingUtils=new yV(this),this.pipelineUtils=new yW(this),this.textureUtils=new yy(this),this.occludedResolveCache=new Map}async init(a){await super.init(a);let b=this.parameters,c;if(void 0===b.device){let a={powerPreference:b.powerPreference,featureLevel:b.compatibilityMode?"compatibility":void 0},d="u">typeof navigator?await navigator.gpu.requestAdapter(a):null;if(null===d)throw Error("WebGPUBackend: Unable to create WebGPU adapter.");let e=Object.values(yp),f=[];for(let a of e)d.features.has(a)&&f.push(a);let g={requiredFeatures:f,requiredLimits:b.requiredLimits};c=await d.requestDevice(g)}else c=b.device;c.lost.then(b=>{let c={api:"WebGPU",message:b.message||"Unknown reason",reason:b.reason||null,originalEvent:b};a.onDeviceLost(c)}),this.device=c,this.trackTimestamp=this.trackTimestamp&&this.hasFeature(yp.TimestampQuery),this.updateSize()}get context(){let a=this.renderer.getCanvasTarget(),b=this.get(a),c=b.context;if(void 0===c){let d=this.parameters;c=!0===a.isDefaultCanvasTarget&&void 0!==d.context?d.context:a.domElement.getContext("webgpu"),"setAttribute"in a.domElement&&a.domElement.setAttribute("data-engine","three.js r181 webgpu");let e=d.alpha?"premultiplied":"opaque",f=1016===d.outputType?"extended":"standard";c.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:e,toneMapping:{mode:f}}),b.context=c}return c}get coordinateSystem(){return bE}async getArrayBufferAsync(a){return await this.attributeUtils.getArrayBufferAsync(a)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){let a=this.renderer,b=a.getCanvasTarget(),c=this.get(b),d=a.currentSamples,e=c.descriptor;if(void 0===e||c.samples!==d){e={colorAttachments:[{view:null}]},(!0===a.depth||!0===a.stencil)&&(e.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(a.depth,a.stencil).createView()});let b=e.colorAttachments[0];d>0?b.view=this.textureUtils.getColorBuffer().createView():b.resolveTarget=void 0,c.descriptor=e,c.samples=d}let f=e.colorAttachments[0];return d>0?f.resolveTarget=this.context.getCurrentTexture().createView():f.view=this.context.getCurrentTexture().createView(),e}_isRenderCameraDepthArray(a){return a.depthTexture&&a.depthTexture.image.depth>1&&a.camera.isArrayCamera}_getRenderPassDescriptor(a,b={}){let c=a.renderTarget,d=this.get(c),e=d.descriptors;(void 0===e||d.width!==c.width||d.height!==c.height||d.samples!==c.samples)&&(d.descriptors=e={});let f=a.getCacheKey(),g=e[f];if(void 0===g){let b=a.textures,h=[],i,j=this._isRenderCameraDepthArray(a);for(let d=0;d<b.length;d++){let e=this.get(b[d]),f={label:`colorAttachment_${d}`,baseMipLevel:a.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:a.activeCubeFace,arrayLayerCount:1,dimension:ym.TwoD};if(c.isRenderTarget3D)i=a.activeCubeFace,f.baseArrayLayer=0,f.dimension=ym.ThreeD,f.depthOrArrayLayers=b[d].image.depth;else if(c.isRenderTarget&&b[d].image.depth>1)if(!0===j){let b=a.camera.cameras;for(let a=0;a<b.length;a++){let b={...f,baseArrayLayer:a,arrayLayerCount:1,dimension:ym.TwoD},c=e.texture.createView(b);h.push({view:c,resolveTarget:void 0,depthSlice:void 0})}}else f.dimension=ym.TwoDArray,f.depthOrArrayLayers=b[d].image.depth;if(!0!==j){let a=e.texture.createView(f),b,c;void 0===e.msaaTexture?(b=a,c=void 0):(b=e.msaaTexture.createView(),c=a),h.push({view:b,resolveTarget:c,depthSlice:i})}}if(g={textureViews:h},a.depth){let b=this.get(a.depthTexture),c={};a.depthTexture.isArrayTexture&&(c.dimension=ym.TwoD,c.arrayLayerCount=1,c.baseArrayLayer=a.activeCubeFace),g.depthStencilView=b.texture.createView(c)}e[f]=g,d.width=c.width,d.height=c.height,d.samples=c.samples,d.activeMipmapLevel=a.activeMipmapLevel,d.activeCubeFace=a.activeCubeFace}let h={colorAttachments:[]};for(let a=0;a<g.textureViews.length;a++){let c=g.textureViews[a],d={r:0,g:0,b:0,a:1};0===a&&b.clearValue&&(d=b.clearValue),h.colorAttachments.push({view:c.view,depthSlice:c.depthSlice,resolveTarget:c.resolveTarget,loadOp:b.loadOp||x6.Load,storeOp:b.storeOp||x5.Store,clearValue:d})}return g.depthStencilView&&(h.depthStencilAttachment={view:g.depthStencilView}),h}beginRender(a){let b,c=this.get(a),d=this.device,e=a.occlusionQueryCount,f;e>0&&(c.currentOcclusionQuerySet&&c.currentOcclusionQuerySet.destroy(),c.currentOcclusionQueryBuffer&&c.currentOcclusionQueryBuffer.destroy(),c.currentOcclusionQuerySet=c.occlusionQuerySet,c.currentOcclusionQueryBuffer=c.occlusionQueryBuffer,c.currentOcclusionQueryObjects=c.occlusionQueryObjects,c.occlusionQuerySet=f=d.createQuerySet({type:"occlusion",count:e,label:`occlusionQuerySet_${a.id}`}),c.occlusionQueryIndex=0,c.occlusionQueryObjects=Array(e),c.lastOcclusionObject=null),b=null===a.textures?this._getDefaultRenderPassDescriptor():this._getRenderPassDescriptor(a,{loadOp:x6.Load}),this.initTimestampQuery(bF.RENDER,this.getTimestampUID(a),b),b.occlusionQuerySet=f;let g=b.depthStencilAttachment;if(null!==a.textures){let c=b.colorAttachments;for(let b=0;b<c.length;b++){let d=c[b];a.clearColor?(d.clearValue=0===b?a.clearColorValue:{r:0,g:0,b:0,a:1},d.loadOp=x6.Clear):d.loadOp=x6.Load,d.storeOp=x5.Store}}else{let c=b.colorAttachments[0];a.clearColor?(c.clearValue=a.clearColorValue,c.loadOp=x6.Clear):c.loadOp=x6.Load,c.storeOp=x5.Store}a.depth&&(a.clearDepth?(g.depthClearValue=a.clearDepthValue,g.depthLoadOp=x6.Clear):g.depthLoadOp=x6.Load,g.depthStoreOp=x5.Store),a.stencil&&(a.clearStencil?(g.stencilClearValue=a.clearStencilValue,g.stencilLoadOp=x6.Clear):g.stencilLoadOp=x6.Load,g.stencilStoreOp=x5.Store);let h=d.createCommandEncoder({label:"renderContext_"+a.id});if(!0===this._isRenderCameraDepthArray(a)){let d=a.camera.cameras;c.layerDescriptors&&c.layerDescriptors.length===d.length?this._updateDepthLayerDescriptors(a,c,d):this._createDepthLayerDescriptors(a,c,b,d),c.bundleEncoders=[],c.bundleSets=[];for(let b=0;b<d.length;b++){let d=this.pipelineUtils.createBundleEncoder(a,"renderBundleArrayCamera_"+b);c.bundleEncoders.push(d),c.bundleSets.push({attributes:{},bindingGroups:[],pipeline:null,index:null})}c.currentPass=null}else c.currentPass=h.beginRenderPass(b),a.viewport&&this.updateViewport(a),a.scissor&&this.updateScissor(a);c.descriptor=b,c.encoder=h,c.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},c.renderBundles=[]}_createDepthLayerDescriptors(a,b,c,d){let e=c.depthStencilAttachment;b.layerDescriptors=[];let f=this.get(a.depthTexture);f.viewCache||(f.viewCache=[]);for(let g=0;g<d.length;g++){let d={...c,colorAttachments:[{...c.colorAttachments[0],view:c.colorAttachments[g].view}]};if(c.depthStencilAttachment){let b=g;f.viewCache[b]||(f.viewCache[b]=f.texture.createView({dimension:ym.TwoD,baseArrayLayer:g,arrayLayerCount:1})),d.depthStencilAttachment={view:f.viewCache[b],depthLoadOp:e.depthLoadOp||x6.Clear,depthStoreOp:e.depthStoreOp||x5.Store,depthClearValue:e.depthClearValue||1},a.stencil&&(d.depthStencilAttachment.stencilLoadOp=e.stencilLoadOp,d.depthStencilAttachment.stencilStoreOp=e.stencilStoreOp,d.depthStencilAttachment.stencilClearValue=e.stencilClearValue)}else d.depthStencilAttachment={...e};b.layerDescriptors.push(d)}}_updateDepthLayerDescriptors(a,b,c){for(let d=0;d<c.length;d++){let c=b.layerDescriptors[d];if(c.depthStencilAttachment){let b=c.depthStencilAttachment;a.depth&&(a.clearDepth?(b.depthClearValue=a.clearDepthValue,b.depthLoadOp=x6.Clear):b.depthLoadOp=x6.Load),a.stencil&&(a.clearStencil?(b.stencilClearValue=a.clearStencilValue,b.stencilLoadOp=x6.Clear):b.stencilLoadOp=x6.Load)}}}finishRender(a){let b=this.get(a),c=a.occlusionQueryCount;b.renderBundles.length>0&&b.currentPass.executeBundles(b.renderBundles),c>b.occlusionQueryIndex&&b.currentPass.endOcclusionQuery();let d=b.encoder;if(!0===this._isRenderCameraDepthArray(a)){let c=[];for(let a=0;a<b.bundleEncoders.length;a++){let d=b.bundleEncoders[a];c.push(d.finish())}for(let e=0;e<b.layerDescriptors.length;e++)if(e<c.length){let f=b.layerDescriptors[e],g=d.beginRenderPass(f);if(a.viewport){let{x:b,y:c,width:d,height:e,minDepth:f,maxDepth:h}=a.viewportValue;g.setViewport(b,c,d,e,f,h)}if(a.scissor){let{x:b,y:c,width:d,height:e}=a.scissorValue;g.setScissorRect(b,c,d,e)}g.executeBundles([c[e]]),g.end()}}else b.currentPass&&b.currentPass.end();if(c>0){let d=8*c,e=this.occludedResolveCache.get(d);void 0===e&&(e=this.device.createBuffer({size:d,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(d,e));let f=this.device.createBuffer({size:d,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});b.encoder.resolveQuerySet(b.occlusionQuerySet,0,c,e,0),b.encoder.copyBufferToBuffer(e,0,f,0,d),b.occlusionQueryBuffer=f,this.resolveOccludedAsync(a)}if(this.device.queue.submit([b.encoder.finish()]),null!==a.textures){let b=a.textures;for(let a=0;a<b.length;a++){let c=b[a];!0===c.generateMipmaps&&this.textureUtils.generateMipmaps(c)}}}isOccluded(a,b){let c=this.get(a);return c.occluded&&c.occluded.has(b)}async resolveOccludedAsync(a){let b=this.get(a),{currentOcclusionQueryBuffer:c,currentOcclusionQueryObjects:d}=b;if(c&&d){let a=new WeakSet;b.currentOcclusionQueryObjects=null,b.currentOcclusionQueryBuffer=null,await c.mapAsync(GPUMapMode.READ);let e=new BigUint64Array(c.getMappedRange());for(let b=0;b<d.length;b++)e[b]===BigInt(0)&&a.add(d[b]);c.destroy(),b.occluded=a}}updateViewport(a){let{currentPass:b}=this.get(a),{x:c,y:d,width:e,height:f,minDepth:g,maxDepth:h}=a.viewportValue;b.setViewport(c,d,e,f,g,h)}updateScissor(a){let{currentPass:b}=this.get(a),{x:c,y:d,width:e,height:f}=a.scissorValue;b.setScissorRect(c,d,e,f)}getClearColor(){let a=super.getClearColor();return!0===this.renderer.alpha&&(a.r*=a.a,a.g*=a.a,a.b*=a.a),a}clear(a,b,c,d=null){let e=this.device,f=this.renderer,g=[],h,i,j,k;if(a){let a=this.getClearColor();i={r:a.r,g:a.g,b:a.b,a:a.a}}if(null===d){j=f.depth,k=f.stencil;let b=this._getDefaultRenderPassDescriptor();if(a){let a=(g=b.colorAttachments)[0];a.clearValue=i,a.loadOp=x6.Clear,a.storeOp=x5.Store}(j||k)&&(h=b.depthStencilAttachment)}else{j=d.depth,k=d.stencil;let e={loadOp:a?x6.Clear:x6.Load,clearValue:a?i:void 0};j&&(e.depthLoadOp=b?x6.Clear:x6.Load,e.depthClearValue=b?f.getClearDepth():void 0,e.depthStoreOp=x5.Store),k&&(e.stencilLoadOp=c?x6.Clear:x6.Load,e.stencilClearValue=c?f.getClearStencil():void 0,e.stencilStoreOp=x5.Store);let l=this._getRenderPassDescriptor(d,e);g=l.colorAttachments,h=l.depthStencilAttachment}j&&h&&(b?(h.depthLoadOp=x6.Clear,h.depthClearValue=f.getClearDepth()):h.depthLoadOp=x6.Load,h.depthStoreOp=x5.Store),k&&h&&(c?(h.stencilLoadOp=x6.Clear,h.stencilClearValue=f.getClearStencil()):h.stencilLoadOp=x6.Load,h.stencilStoreOp=x5.Store);let l=e.createCommandEncoder({label:"clear"});l.beginRenderPass({colorAttachments:g,depthStencilAttachment:h}).end(),e.queue.submit([l.finish()])}beginCompute(a){let b=this.get(a),c={label:"computeGroup_"+a.id};this.initTimestampQuery(bF.COMPUTE,this.getTimestampUID(a),c),b.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+a.id}),b.passEncoderGPU=b.cmdEncoderGPU.beginComputePass(c)}compute(a,b,c,d,e=null){let f=this.get(b),{passEncoderGPU:g}=this.get(a),h=this.get(d).pipeline;this.pipelineUtils.setPipeline(g,h);for(let a=0,b=c.length;a<b;a++){let b=c[a],d=this.get(b);g.setBindGroup(a,d.group)}if(null===e&&(e=b.count),e&&"object"==typeof e&&e.isIndirectStorageBufferAttribute){let a=this.get(e).buffer;g.dispatchWorkgroupsIndirect(a,0);return}if("number"==typeof e){let a=e;if(void 0===f.dispatchSize||f.count!==a){f.dispatchSize=[0,1,1],f.count=a;let c=b.workgroupSize,d=c[0];for(let a=1;a<c.length;a++)d*=c[a];let g=Math.ceil(a/d),h=this.device.limits.maxComputeWorkgroupsPerDimension;e=[g,1,1],g>h&&(e[0]=Math.min(g,h),e[1]=Math.ceil(g/h)),f.dispatchSize=e}e=f.dispatchSize}g.dispatchWorkgroups(e[0],e[1]||1,e[2]||1)}finishCompute(a){let b=this.get(a);b.passEncoderGPU.end(),this.device.queue.submit([b.cmdEncoderGPU.finish()])}draw(a,b){let{object:c,material:d,context:e,pipeline:f}=a,g=a.getBindings(),h=this.get(e),i=this.get(f),j=i.pipeline;if(!0===i.error)return;let k=a.getIndex(),l=null!==k,m=a.getDrawParameters();if(null===m)return;let n=(b,c)=>{this.pipelineUtils.setPipeline(b,j),c.pipeline=j;let f=c.bindingGroups;for(let a=0,c=g.length;a<c;a++){let c=g[a],d=this.get(c);f[c.index]!==c.id&&(b.setBindGroup(c.index,d.group),f[c.index]=c.id)}if(!0===l&&c.index!==k){let a=this.get(k).buffer,d=k.array instanceof Uint16Array?x9.Uint16:x9.Uint32;b.setIndexBuffer(a,d),c.index=k}let i=a.getVertexBuffers();for(let a=0,d=i.length;a<d;a++){let d=i[a];if(c.attributes[a]!==d){let e=this.get(d).buffer;b.setVertexBuffer(a,e),c.attributes[a]=d}}!0===e.stencil&&!0===d.stencilWrite&&h.currentStencilRef!==d.stencilRef&&(b.setStencilReference(d.stencilRef),h.currentStencilRef=d.stencilRef)},o=(d,e)=>{if(n(d,e),!0===c.isBatchedMesh){let a=c._multiDrawStarts,e=c._multiDrawCounts,f=c._multiDrawCount,g=c._multiDrawInstances;null!==g&&K("WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");for(let h=0;h<f;h++){let f=g?g[h]:1,i=f>1?0:h;!0===l?d.drawIndexed(e[h],f,a[h]/k.array.BYTES_PER_ELEMENT,0,i):d.draw(e[h],f,a[h],i),b.update(c,e[h],f)}}else if(!0===l){let{vertexCount:e,instanceCount:f,firstVertex:g}=m,h=a.getIndirect();if(null!==h){let a=this.get(h).buffer;d.drawIndexedIndirect(a,0)}else d.drawIndexed(e,f,g,0,0);b.update(c,e,f)}else{let{vertexCount:e,instanceCount:f,firstVertex:g}=m,h=a.getIndirect();if(null!==h){let a=this.get(h).buffer;d.drawIndirect(a,0)}else d.draw(e,f,g,0);b.update(c,e,f)}};if(a.camera.isArrayCamera&&a.camera.cameras.length>0){let b=this.get(a.camera),d=a.camera.cameras,f=a.getBindingGroup("cameraIndex");if(void 0===b.indexesGPU||b.indexesGPU.length!==d.length){let a=this.get(f),c=[],e=new Uint32Array([0,0,0,0]);for(let b=0,f=d.length;b<f;b++){e[0]=b;let d=this.bindingUtils.createBindGroupIndex(e,a.layout);c.push(d)}b.indexesGPU=c}let g=this.renderer.getPixelRatio();for(let a=0,i=d.length;a<i;a++){let i=d[a];if(c.layers.test(i.layers)){let c=i.viewport,d=h.currentPass,j=h.currentSets;if(h.bundleEncoders){let b=h.bundleEncoders[a],c=h.bundleSets[a];d=b,j=c}c&&d.setViewport(Math.floor(c.x*g),Math.floor(c.y*g),Math.floor(c.width*g),Math.floor(c.height*g),e.viewportValue.minDepth,e.viewportValue.maxDepth),f&&b.indexesGPU&&(d.setBindGroup(f.index,b.indexesGPU[a]),j.bindingGroups[f.index]=f.id),o(d,j)}}}else if(h.currentPass){if(void 0!==h.occlusionQuerySet){let a=h.lastOcclusionObject;a!==c&&(null!==a&&!0===a.occlusionTest&&(h.currentPass.endOcclusionQuery(),h.occlusionQueryIndex++),!0===c.occlusionTest&&(h.currentPass.beginOcclusionQuery(h.occlusionQueryIndex),h.occlusionQueryObjects[h.occlusionQueryIndex]=c),h.lastOcclusionObject=c)}o(h.currentPass,h.currentSets)}}needsRenderUpdate(a){let b=this.get(a),{object:c,material:d}=a,e=this.utils,f=e.getSampleCountRenderContext(a.context),g=e.getCurrentColorSpace(a.context),h=e.getCurrentColorFormat(a.context),i=e.getCurrentDepthStencilFormat(a.context),j=e.getPrimitiveTopology(c,d),k=!1;return(b.material!==d||b.materialVersion!==d.version||b.transparent!==d.transparent||b.blending!==d.blending||b.premultipliedAlpha!==d.premultipliedAlpha||b.blendSrc!==d.blendSrc||b.blendDst!==d.blendDst||b.blendEquation!==d.blendEquation||b.blendSrcAlpha!==d.blendSrcAlpha||b.blendDstAlpha!==d.blendDstAlpha||b.blendEquationAlpha!==d.blendEquationAlpha||b.colorWrite!==d.colorWrite||b.depthWrite!==d.depthWrite||b.depthTest!==d.depthTest||b.depthFunc!==d.depthFunc||b.stencilWrite!==d.stencilWrite||b.stencilFunc!==d.stencilFunc||b.stencilFail!==d.stencilFail||b.stencilZFail!==d.stencilZFail||b.stencilZPass!==d.stencilZPass||b.stencilFuncMask!==d.stencilFuncMask||b.stencilWriteMask!==d.stencilWriteMask||b.side!==d.side||b.alphaToCoverage!==d.alphaToCoverage||b.sampleCount!==f||b.colorSpace!==g||b.colorFormat!==h||b.depthStencilFormat!==i||b.primitiveTopology!==j||b.clippingContextCacheKey!==a.clippingContextCacheKey)&&(b.material=d,b.materialVersion=d.version,b.transparent=d.transparent,b.blending=d.blending,b.premultipliedAlpha=d.premultipliedAlpha,b.blendSrc=d.blendSrc,b.blendDst=d.blendDst,b.blendEquation=d.blendEquation,b.blendSrcAlpha=d.blendSrcAlpha,b.blendDstAlpha=d.blendDstAlpha,b.blendEquationAlpha=d.blendEquationAlpha,b.colorWrite=d.colorWrite,b.depthWrite=d.depthWrite,b.depthTest=d.depthTest,b.depthFunc=d.depthFunc,b.stencilWrite=d.stencilWrite,b.stencilFunc=d.stencilFunc,b.stencilFail=d.stencilFail,b.stencilZFail=d.stencilZFail,b.stencilZPass=d.stencilZPass,b.stencilFuncMask=d.stencilFuncMask,b.stencilWriteMask=d.stencilWriteMask,b.side=d.side,b.alphaToCoverage=d.alphaToCoverage,b.sampleCount=f,b.colorSpace=g,b.colorFormat=h,b.depthStencilFormat=i,b.primitiveTopology=j,b.clippingContextCacheKey=a.clippingContextCacheKey,k=!0),k}getRenderCacheKey(a){let{object:b,material:c}=a,d=this.utils,e=a.context,f=b.isMesh&&0>b.matrixWorld.determinant();return[c.transparent,c.blending,c.premultipliedAlpha,c.blendSrc,c.blendDst,c.blendEquation,c.blendSrcAlpha,c.blendDstAlpha,c.blendEquationAlpha,c.colorWrite,c.depthWrite,c.depthTest,c.depthFunc,c.stencilWrite,c.stencilFunc,c.stencilFail,c.stencilZFail,c.stencilZPass,c.stencilFuncMask,c.stencilWriteMask,c.side,f,d.getSampleCountRenderContext(e),d.getCurrentColorSpace(e),d.getCurrentColorFormat(e),d.getCurrentDepthStencilFormat(e),d.getPrimitiveTopology(b,c),a.getGeometryCacheKey(),a.clippingContextCacheKey].join()}updateSampler(a){return this.textureUtils.updateSampler(a)}createDefaultTexture(a){return this.textureUtils.createDefaultTexture(a)}createTexture(a,b){this.textureUtils.createTexture(a,b)}updateTexture(a,b){this.textureUtils.updateTexture(a,b)}generateMipmaps(a){this.textureUtils.generateMipmaps(a)}destroyTexture(a,b=!1){this.textureUtils.destroyTexture(a,b)}async copyTextureToBuffer(a,b,c,d,e,f){return this.textureUtils.copyTextureToBuffer(a,b,c,d,e,f)}initTimestampQuery(a,b,c){if(!this.trackTimestamp)return;this.timestampQueryPool[a]||(this.timestampQueryPool[a]=new yX(this.device,a,2048));let d=this.timestampQueryPool[a],e=d.allocateQueriesForContext(b);c.timestampWrites={querySet:d.querySet,beginningOfPassWriteIndex:e,endOfPassWriteIndex:e+1}}createNodeBuilder(a,b){return new yP(a,b)}createProgram(a){this.get(a).module={module:this.device.createShaderModule({code:a.code,label:a.stage+(""===a.name?"":`_${a.name}`)}),entryPoint:"main"}}destroyProgram(a){this.delete(a)}createRenderPipeline(a,b){this.pipelineUtils.createRenderPipeline(a,b)}createComputePipeline(a,b){this.pipelineUtils.createComputePipeline(a,b)}beginBundle(a){let b=this.get(a);b._currentPass=b.currentPass,b._currentSets=b.currentSets,b.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},b.currentPass=this.pipelineUtils.createBundleEncoder(a)}finishBundle(a,b){let c=this.get(a),d=c.currentPass.finish();this.get(b).bundleGPU=d,c.currentSets=c._currentSets,c.currentPass=c._currentPass}addBundle(a,b){this.get(a).renderBundles.push(this.get(b).bundleGPU)}createBindings(a,b,c,d){this.bindingUtils.createBindings(a,b,c,d)}updateBindings(a,b,c,d){this.bindingUtils.createBindings(a,b,c,d)}updateBinding(a){this.bindingUtils.updateBinding(a)}createIndexAttribute(a){let b=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST;(a.isStorageBufferAttribute||a.isStorageInstancedBufferAttribute)&&(b|=GPUBufferUsage.STORAGE),this.attributeUtils.createAttribute(a,b)}createAttribute(a){this.attributeUtils.createAttribute(a,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(a){this.attributeUtils.createAttribute(a,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(a){this.attributeUtils.createAttribute(a,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(a){this.attributeUtils.updateAttribute(a)}destroyAttribute(a){this.attributeUtils.destroyAttribute(a)}updateSize(){this.delete(this.renderer.getCanvasTarget())}getMaxAnisotropy(){return 16}hasFeature(a){return void 0!==yq[a]&&(a=yq[a]),this.device.features.has(a)}copyTextureToTexture(a,b,c=null,d=null,e=0,f=0){let g=0,h=0,i=0,j=0,k=0,l=0,m=a.image.width,n=a.image.height,o=1;null!==c&&(!0===c.isBox3?(j=c.min.x,k=c.min.y,l=c.min.z,m=c.max.x-c.min.x,n=c.max.y-c.min.y,o=c.max.z-c.min.z):(j=c.min.x,k=c.min.y,m=c.max.x-c.min.x,n=c.max.y-c.min.y,o=1)),null!==d&&(g=d.x,h=d.y,i=d.z||0);let p=this.device.createCommandEncoder({label:"copyTextureToTexture_"+a.id+"_"+b.id}),q=this.get(a).texture,r=this.get(b).texture;p.copyTextureToTexture({texture:q,mipLevel:e,origin:{x:j,y:k,z:l}},{texture:r,mipLevel:f,origin:{x:g,y:h,z:i}},[m,n,o]),this.device.queue.submit([p.finish()]),0===f&&b.generateMipmaps&&this.textureUtils.generateMipmaps(b)}copyFramebufferToTexture(a,b,c){let d,e=this.get(b),f=null;f=b.renderTarget?a.isDepthTexture?this.get(b.depthTexture).texture:this.get(b.textures[0]).texture:a.isDepthTexture?this.textureUtils.getDepthBuffer(b.depth,b.stencil):this.context.getCurrentTexture();let g=this.get(a).texture;if(f.format!==g.format)return void J("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",f.format,g.format);if(e.currentPass?(e.currentPass.end(),d=e.encoder):d=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+a.id}),d.copyTextureToTexture({texture:f,origin:[c.x,c.y,0]},{texture:g},[c.z,c.w]),a.generateMipmaps&&this.textureUtils.generateMipmaps(a,d),e.currentPass){let{descriptor:a}=e;for(let b=0;b<a.colorAttachments.length;b++)a.colorAttachments[b].loadOp=x6.Load;b.depth&&(a.depthStencilAttachment.depthLoadOp=x6.Load),b.stencil&&(a.depthStencilAttachment.stencilLoadOp=x6.Load),e.currentPass=d.beginRenderPass(a),e.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},b.viewport&&this.updateViewport(b),b.scissor&&this.updateScissor(b)}else this.device.queue.submit([d.finish()])}dispose(){this.textureUtils.dispose()}},yZ=class extends eU{constructor(a,b,c,d,e,f){super(a,b,c,d,e,f),this.iesMap=null}copy(a,b){return super.copy(a,b),this.iesMap=a.iesMap,this}},y$=class extends eU{constructor(a,b,c,d,e,f){super(a,b,c,d,e,f),this.aspect=null}copy(a,b){return super.copy(a,b),this.aspect=a.aspect,this}},y_=class extends w6{constructor(){super(),this.addMaterial(oW,"MeshPhongMaterial"),this.addMaterial(qm,"MeshStandardMaterial"),this.addMaterial(qo,"MeshPhysicalMaterial"),this.addMaterial(qs,"MeshToonMaterial"),this.addMaterial(oN,"MeshBasicMaterial"),this.addMaterial(oU,"MeshLambertMaterial"),this.addMaterial(oD,"MeshNormalMaterial"),this.addMaterial(qv,"MeshMatcapMaterial"),this.addMaterial(ov,"LineBasicMaterial"),this.addMaterial(ox,"LineDashedMaterial"),this.addMaterial(qB,"PointsMaterial"),this.addMaterial(qy,"SpriteMaterial"),this.addMaterial(qF,"ShadowMaterial"),this.addLight(uL,eZ),this.addLight(wH,e0),this.addLight(wL,e2),this.addLight(wM,eU),this.addLight(wQ,e1),this.addLight(wR,eO),this.addLight(wS,e4),this.addLight(wN,yZ),this.addLight(wP,y$),this.addToneMapping(sS,1),this.addToneMapping(sT,2),this.addToneMapping(sU,3),this.addToneMapping(sW,4),this.addToneMapping(s$,6),this.addToneMapping(s_,7)}},y0=class extends xm{constructor(a={}){let b;a.forceWebGL?b=x2:(b=yY,a.getFallback=()=>(I("WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new x2(a))),super(new b(a),a),this.library=new y_,this.isWebGPURenderer=!0,"u">typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}}),IH=E({BRDF_GGX:()=>y1,BRDF_Lambert:()=>y2,BasicPointShadowFilter:()=>y3,BasicShadowFilter:()=>y4,Break:()=>y5,Const:()=>y6,Continue:()=>y7,DFGApprox:()=>y8,D_GGX:()=>y9,Discard:()=>za,EPSILON:()=>zb,F_Schlick:()=>zc,Fn:()=>zd,HALF_PI:()=>zq,INFINITY:()=>ze,If:()=>zf,Loop:()=>zg,NodeAccess:()=>zh,NodeShaderStage:()=>zi,NodeType:()=>zj,NodeUpdateType:()=>zk,OnBeforeMaterialUpdate:()=>Fh,OnBeforeObjectUpdate:()=>Fg,OnMaterialUpdate:()=>Fj,OnObjectUpdate:()=>Fi,PCFShadowFilter:()=>zl,PCFSoftShadowFilter:()=>zm,PI:()=>zn,PI2:()=>zo,PointShadowFilter:()=>zr,Return:()=>zs,Schlick_to_F0:()=>zt,ScriptableNodeResources:()=>zu,ShaderNode:()=>zv,Stack:()=>zw,Switch:()=>zx,TBNViewMatrix:()=>zy,TWO_PI:()=>zp,VSMShadowFilter:()=>zz,V_GGX_SmithCorrelated:()=>zA,Var:()=>zB,VarIntent:()=>zC,abs:()=>zD,acesFilmicToneMapping:()=>zE,acos:()=>zF,add:()=>zG,addMethodChaining:()=>zH,addNodeElement:()=>zI,agxToneMapping:()=>zJ,all:()=>zK,alphaT:()=>zL,and:()=>zM,anisotropy:()=>zN,anisotropyB:()=>zO,anisotropyT:()=>zP,any:()=>zQ,append:()=>zR,array:()=>zS,arrayBuffer:()=>zT,asin:()=>zU,assign:()=>zV,atan:()=>zW,atan2:()=>zX,atomicAdd:()=>zY,atomicAnd:()=>zZ,atomicFunc:()=>z$,atomicLoad:()=>z_,atomicMax:()=>z0,atomicMin:()=>z1,atomicOr:()=>z2,atomicStore:()=>z3,atomicSub:()=>z4,atomicXor:()=>z5,attenuationColor:()=>z6,attenuationDistance:()=>z7,attribute:()=>z8,attributeArray:()=>z9,backgroundBlurriness:()=>Aa,backgroundIntensity:()=>Ab,backgroundRotation:()=>Ac,batch:()=>Ad,bentNormalView:()=>Ae,billboarding:()=>Af,bitAnd:()=>Ag,bitNot:()=>Ah,bitOr:()=>Ai,bitXor:()=>Aj,bitangentGeometry:()=>Ak,bitangentLocal:()=>Al,bitangentView:()=>Am,bitangentWorld:()=>An,bitcast:()=>Ao,blendBurn:()=>Ap,blendColor:()=>Aq,blendDodge:()=>Ar,blendOverlay:()=>As,blendScreen:()=>At,blur:()=>Au,bool:()=>Av,buffer:()=>Aw,bufferAttribute:()=>Ax,builtin:()=>AA,bumpMap:()=>Ay,burn:()=>Az,bvec2:()=>AB,bvec3:()=>AC,bvec4:()=>AD,bypass:()=>AE,cache:()=>AF,call:()=>AG,cameraFar:()=>AH,cameraIndex:()=>AI,cameraNear:()=>AJ,cameraNormalMatrix:()=>AK,cameraPosition:()=>AL,cameraProjectionMatrix:()=>AM,cameraProjectionMatrixInverse:()=>AN,cameraViewMatrix:()=>AO,cameraViewport:()=>AP,cameraWorldMatrix:()=>AQ,cbrt:()=>AR,cdl:()=>AS,ceil:()=>AT,checker:()=>AU,cineonToneMapping:()=>AV,clamp:()=>AW,clearcoat:()=>AX,clearcoatNormalView:()=>AY,clearcoatRoughness:()=>AZ,code:()=>A$,color:()=>A_,colorSpaceToWorking:()=>A0,colorToDirection:()=>A1,compute:()=>A2,computeKernel:()=>A3,computeSkinning:()=>A4,context:()=>A5,convert:()=>A6,convertColorSpace:()=>A7,convertToTexture:()=>A8,cos:()=>A9,cross:()=>Ba,cubeTexture:()=>Bb,cubeTextureBase:()=>Bc,cubeToUV:()=>Bd,dFdx:()=>Be,dFdy:()=>Bf,dashSize:()=>Bg,debug:()=>Bh,decrement:()=>Bi,decrementBefore:()=>Bj,defaultBuildStages:()=>Bk,defaultShaderStages:()=>Bl,defined:()=>Bm,degrees:()=>Bn,deltaTime:()=>Bo,densityFog:()=>Bp,densityFogFactor:()=>Bq,depth:()=>Br,depthPass:()=>Bs,determinant:()=>Bt,difference:()=>Bu,diffuseColor:()=>Bv,directPointLight:()=>Bw,directionToColor:()=>Bx,directionToFaceDirection:()=>By,dispersion:()=>Bz,distance:()=>BA,div:()=>BB,dodge:()=>BC,dot:()=>BD,drawIndex:()=>BE,dynamicBufferAttribute:()=>BF,element:()=>BG,emissive:()=>BH,equal:()=>BI,equals:()=>BJ,equirectUV:()=>BK,exp:()=>BL,exp2:()=>BM,expression:()=>BN,faceDirection:()=>BO,faceForward:()=>BP,faceforward:()=>BQ,float:()=>BR,floatBitsToInt:()=>BS,floatBitsToUint:()=>BT,floor:()=>BU,fog:()=>BV,fract:()=>BW,frameGroup:()=>BX,frameId:()=>BY,frontFacing:()=>BZ,fwidth:()=>B$,gain:()=>B_,gapSize:()=>B0,getConstNodeType:()=>B1,getCurrentStack:()=>B2,getDirection:()=>B3,getDistanceAttenuation:()=>B4,getGeometryRoughness:()=>B5,getNormalFromDepth:()=>B6,getParallaxCorrectNormal:()=>B8,getRoughness:()=>B9,getScreenPosition:()=>Ca,getShIrradianceAt:()=>Cb,getShadowMaterial:()=>Cc,getShadowRenderObjectFunction:()=>Cd,getTextureIndex:()=>Ce,getViewPosition:()=>Cf,globalId:()=>Cg,glsl:()=>Ch,glslFn:()=>Ci,grayscale:()=>Cj,greaterThan:()=>Ck,greaterThanEqual:()=>Cl,hash:()=>Cm,highpModelNormalViewMatrix:()=>Cn,highpModelViewMatrix:()=>Co,hue:()=>Cp,increment:()=>Cq,incrementBefore:()=>Cr,instance:()=>Cs,instanceIndex:()=>Ct,instancedArray:()=>Cu,instancedBufferAttribute:()=>Cv,instancedDynamicBufferAttribute:()=>Cw,instancedMesh:()=>Cx,int:()=>Cy,intBitsToFloat:()=>Cz,interleavedGradientNoise:()=>B7,inverse:()=>CA,inverseSqrt:()=>CB,inversesqrt:()=>CC,invocationLocalIndex:()=>CD,invocationSubgroupIndex:()=>CE,ior:()=>CF,iridescence:()=>CG,iridescenceIOR:()=>CH,iridescenceThickness:()=>CI,ivec2:()=>CJ,ivec3:()=>CK,ivec4:()=>CL,js:()=>CM,label:()=>CN,length:()=>CO,lengthSq:()=>CP,lessThan:()=>CQ,lessThanEqual:()=>CR,lightPosition:()=>CS,lightProjectionUV:()=>CT,lightShadowMatrix:()=>CU,lightTargetDirection:()=>CV,lightTargetPosition:()=>CW,lightViewPosition:()=>CX,lightingContext:()=>CY,lights:()=>CZ,linearDepth:()=>C$,linearToneMapping:()=>C_,localId:()=>C0,log:()=>C1,log2:()=>C2,logarithmicDepthToViewZ:()=>C3,luminance:()=>C4,mat2:()=>C5,mat3:()=>C6,mat4:()=>C7,matcapUV:()=>C8,materialAO:()=>C9,materialAlphaTest:()=>Da,materialAnisotropy:()=>Db,materialAnisotropyVector:()=>Dc,materialAttenuationColor:()=>Dd,materialAttenuationDistance:()=>De,materialClearcoat:()=>Df,materialClearcoatNormal:()=>Dg,materialClearcoatRoughness:()=>Dh,materialColor:()=>Di,materialDispersion:()=>Dj,materialEmissive:()=>Dk,materialEnvIntensity:()=>Dl,materialEnvRotation:()=>Dm,materialIOR:()=>Dn,materialIridescence:()=>Do,materialIridescenceIOR:()=>Dp,materialIridescenceThickness:()=>Dq,materialLightMap:()=>Dr,materialLineDashOffset:()=>Ds,materialLineDashSize:()=>Dt,materialLineGapSize:()=>Du,materialLineScale:()=>Dv,materialLineWidth:()=>Dw,materialMetalness:()=>Dx,materialNormal:()=>Dy,materialOpacity:()=>Dz,materialPointSize:()=>DA,materialReference:()=>DB,materialReflectivity:()=>DC,materialRefractionRatio:()=>DD,materialRotation:()=>DE,materialRoughness:()=>DF,materialSheen:()=>DG,materialSheenRoughness:()=>DH,materialShininess:()=>DI,materialSpecular:()=>DJ,materialSpecularColor:()=>DK,materialSpecularIntensity:()=>DL,materialSpecularStrength:()=>DM,materialThickness:()=>DN,materialTransmission:()=>DO,max:()=>DP,maxMipLevel:()=>DQ,mediumpModelViewMatrix:()=>DR,metalness:()=>DS,min:()=>DT,mix:()=>DU,mixElement:()=>DV,mod:()=>DW,modInt:()=>DX,modelDirection:()=>DY,modelNormalMatrix:()=>DZ,modelPosition:()=>D$,modelRadius:()=>D_,modelScale:()=>D0,modelViewMatrix:()=>D1,modelViewPosition:()=>D2,modelViewProjection:()=>D3,modelWorldMatrix:()=>D4,modelWorldMatrixInverse:()=>D5,morphReference:()=>D6,mrt:()=>D7,mul:()=>D8,mx_aastep:()=>D9,mx_add:()=>Ea,mx_atan2:()=>Eb,mx_cell_noise_float:()=>Ec,mx_contrast:()=>Ed,mx_divide:()=>Ee,mx_fractal_noise_float:()=>Ef,mx_fractal_noise_vec2:()=>Eg,mx_fractal_noise_vec3:()=>Eh,mx_fractal_noise_vec4:()=>Ei,mx_frame:()=>Ej,mx_heighttonormal:()=>Ek,mx_hsvtorgb:()=>El,mx_ifequal:()=>Em,mx_ifgreater:()=>En,mx_ifgreatereq:()=>Eo,mx_invert:()=>Ep,mx_modulo:()=>Eq,mx_multiply:()=>Er,mx_noise_float:()=>Es,mx_noise_vec3:()=>Et,mx_noise_vec4:()=>Eu,mx_place2d:()=>Ev,mx_power:()=>Ew,mx_ramp4:()=>Ex,mx_ramplr:()=>Ey,mx_ramptb:()=>Ez,mx_rgbtohsv:()=>EA,mx_rotate2d:()=>EB,mx_rotate3d:()=>EC,mx_safepower:()=>ED,mx_separate:()=>EE,mx_splitlr:()=>EF,mx_splittb:()=>EG,mx_srgb_texture_to_lin_rec709:()=>EH,mx_subtract:()=>EI,mx_timer:()=>EJ,mx_transform_uv:()=>EK,mx_unifiednoise2d:()=>EL,mx_unifiednoise3d:()=>EM,mx_worley_noise_float:()=>EN,mx_worley_noise_vec2:()=>EO,mx_worley_noise_vec3:()=>EP,negate:()=>EQ,neutralToneMapping:()=>ER,nodeArray:()=>ES,nodeImmutable:()=>ET,nodeObject:()=>EU,nodeObjectIntent:()=>EV,nodeObjects:()=>EW,nodeProxy:()=>EX,nodeProxyIntent:()=>EY,normalFlat:()=>EZ,normalGeometry:()=>E$,normalLocal:()=>E_,normalMap:()=>E0,normalView:()=>E1,normalViewGeometry:()=>E2,normalWorld:()=>E3,normalWorldGeometry:()=>E4,normalize:()=>E5,not:()=>E6,notEqual:()=>E7,numWorkgroups:()=>E8,objectDirection:()=>E9,objectGroup:()=>Fa,objectPosition:()=>Fb,objectRadius:()=>Fc,objectScale:()=>Fd,objectViewPosition:()=>Fe,objectWorldMatrix:()=>Ff,oneMinus:()=>Fk,or:()=>Fl,orthographicDepthToViewZ:()=>Fm,oscSawtooth:()=>Fn,oscSine:()=>Fo,oscSquare:()=>Fp,oscTriangle:()=>Fq,output:()=>Fr,outputStruct:()=>Fs,overlay:()=>Ft,overloadingFn:()=>Fu,parabola:()=>Fv,parallaxDirection:()=>Fw,parallaxUV:()=>Fx,parameter:()=>Fy,pass:()=>Fz,passTexture:()=>FA,pcurve:()=>FB,perspectiveDepthToViewZ:()=>FC,pmremTexture:()=>FD,pointShadow:()=>FE,pointUV:()=>FF,pointWidth:()=>FG,positionGeometry:()=>FH,positionLocal:()=>FI,positionPrevious:()=>FJ,positionView:()=>FK,positionViewDirection:()=>FL,positionWorld:()=>FM,positionWorldDirection:()=>FN,posterize:()=>FO,pow:()=>FP,pow2:()=>FQ,pow3:()=>FR,pow4:()=>FS,premultiplyAlpha:()=>FT,property:()=>FU,radians:()=>FV,rand:()=>FW,range:()=>FX,rangeFog:()=>FY,rangeFogFactor:()=>FZ,reciprocal:()=>F$,reference:()=>F_,referenceBuffer:()=>F0,reflect:()=>F1,reflectVector:()=>F2,reflectView:()=>F3,reflector:()=>F4,refract:()=>F5,refractVector:()=>F6,refractView:()=>F7,reinhardToneMapping:()=>F8,remap:()=>F9,remapClamp:()=>Ga,renderGroup:()=>Gb,renderOutput:()=>Gc,rendererReference:()=>Gd,rotate:()=>Ge,rotateUV:()=>Gf,roughness:()=>Gg,round:()=>Gh,rtt:()=>Gi,sRGBTransferEOTF:()=>Gj,sRGBTransferOETF:()=>Gk,sample:()=>Gl,sampler:()=>Gm,samplerComparison:()=>Gn,saturate:()=>Go,saturation:()=>Gp,screen:()=>Gq,screenCoordinate:()=>Gr,screenDPR:()=>Gs,screenSize:()=>Gt,screenUV:()=>Gu,scriptable:()=>Gv,scriptableValue:()=>Gw,select:()=>Gx,setCurrentStack:()=>Gy,setName:()=>Gz,shaderStages:()=>GA,shadow:()=>GB,shadowPositionWorld:()=>GC,shapeCircle:()=>GD,sharedUniformGroup:()=>GE,sheen:()=>GF,sheenRoughness:()=>GG,shiftLeft:()=>GH,shiftRight:()=>GI,shininess:()=>GJ,sign:()=>GK,sin:()=>GL,sinc:()=>GM,skinning:()=>GN,smoothstep:()=>GO,smoothstepElement:()=>GP,specularColor:()=>GQ,specularF90:()=>GR,spherizeUV:()=>GS,split:()=>GT,spritesheetUV:()=>GU,sqrt:()=>GV,stack:()=>GW,step:()=>GX,stepElement:()=>GY,storage:()=>GZ,storageBarrier:()=>G$,storageObject:()=>G_,storageTexture:()=>G0,string:()=>G1,struct:()=>G2,sub:()=>G3,subBuild:()=>Hb,subgroupAdd:()=>G4,subgroupAll:()=>G5,subgroupAnd:()=>G6,subgroupAny:()=>G7,subgroupBallot:()=>G8,subgroupBroadcast:()=>G9,subgroupBroadcastFirst:()=>Ha,subgroupElect:()=>Hc,subgroupExclusiveAdd:()=>Hd,subgroupExclusiveMul:()=>He,subgroupInclusiveAdd:()=>Hf,subgroupInclusiveMul:()=>Hg,subgroupIndex:()=>Hh,subgroupMax:()=>Hi,subgroupMin:()=>Hj,subgroupMul:()=>Hk,subgroupOr:()=>Hl,subgroupShuffle:()=>Hm,subgroupShuffleDown:()=>Hn,subgroupShuffleUp:()=>Ho,subgroupShuffleXor:()=>Hp,subgroupSize:()=>Hq,subgroupXor:()=>Hr,tan:()=>Hs,tangentGeometry:()=>Ht,tangentLocal:()=>Hu,tangentView:()=>Hv,tangentWorld:()=>Hw,texture:()=>Hx,texture3D:()=>Hy,textureBarrier:()=>Hz,textureBicubic:()=>HA,textureBicubicLevel:()=>HB,textureCubeUV:()=>HC,textureLevel:()=>HF,textureLoad:()=>HD,textureSize:()=>HE,textureStore:()=>HG,thickness:()=>HH,time:()=>HI,toneMapping:()=>HJ,toneMappingExposure:()=>HK,toonOutlinePass:()=>HL,transformDirection:()=>HM,transformNormal:()=>HN,transformNormalToView:()=>HO,transformedClearcoatNormalView:()=>HP,transformedNormalView:()=>HQ,transformedNormalWorld:()=>HR,transmission:()=>HS,transpose:()=>HT,triNoise3D:()=>HU,triplanarTexture:()=>HV,triplanarTextures:()=>HW,trunc:()=>HX,uint:()=>HY,uintBitsToFloat:()=>HZ,uniform:()=>H$,uniformArray:()=>H_,uniformCubeTexture:()=>H0,uniformFlow:()=>H2,uniformGroup:()=>H1,uniformTexture:()=>H3,unpremultiplyAlpha:()=>H4,userData:()=>H5,uv:()=>H6,uvec2:()=>H7,uvec3:()=>H8,uvec4:()=>H9,varying:()=>Ia,varyingProperty:()=>Ib,vec2:()=>Ic,vec3:()=>Id,vec4:()=>Ie,vectorComponents:()=>If,velocity:()=>Ig,vertexColor:()=>Ih,vertexIndex:()=>Ii,vertexStage:()=>Ij,vibrance:()=>Ik,viewZToLogarithmicDepth:()=>Il,viewZToOrthographicDepth:()=>Im,viewZToPerspectiveDepth:()=>In,viewport:()=>Io,viewportCoordinate:()=>Ip,viewportDepthTexture:()=>Iq,viewportLinearDepth:()=>Ir,viewportMipTexture:()=>Is,viewportResolution:()=>It,viewportSafeUV:()=>Iu,viewportSharedTexture:()=>Iv,viewportSize:()=>Iw,viewportTexture:()=>Ix,viewportUV:()=>Iy,wgsl:()=>Iz,wgslFn:()=>IA,workgroupArray:()=>IB,workgroupBarrier:()=>IC,workgroupId:()=>ID,workingToColorSpace:()=>IE,xor:()=>IF}),II=D(()=>{IG(),y1=v5.BRDF_GGX,y2=v5.BRDF_Lambert,y3=v5.BasicPointShadowFilter,y4=v5.BasicShadowFilter,y5=v5.Break,y6=v5.Const,y7=v5.Continue,y8=v5.DFGApprox,y9=v5.D_GGX,za=v5.Discard,zb=v5.EPSILON,zc=v5.F_Schlick,zd=v5.Fn,ze=v5.INFINITY,zf=v5.If,zg=v5.Loop,zh=v5.NodeAccess,zi=v5.NodeShaderStage,zj=v5.NodeType,zk=v5.NodeUpdateType,zl=v5.PCFShadowFilter,zm=v5.PCFSoftShadowFilter,zn=v5.PI,zo=v5.PI2,zp=v5.TWO_PI,zq=v5.HALF_PI,zr=v5.PointShadowFilter,zs=v5.Return,zt=v5.Schlick_to_F0,zu=v5.ScriptableNodeResources,zv=v5.ShaderNode,zw=v5.Stack,zx=v5.Switch,zy=v5.TBNViewMatrix,zz=v5.VSMShadowFilter,zA=v5.V_GGX_SmithCorrelated,zB=v5.Var,zC=v5.VarIntent,zD=v5.abs,zE=v5.acesFilmicToneMapping,zF=v5.acos,zG=v5.add,zH=v5.addMethodChaining,zI=v5.addNodeElement,zJ=v5.agxToneMapping,zK=v5.all,zL=v5.alphaT,zM=v5.and,zN=v5.anisotropy,zO=v5.anisotropyB,zP=v5.anisotropyT,zQ=v5.any,zR=v5.append,zS=v5.array,zT=v5.arrayBuffer,zU=v5.asin,zV=v5.assign,zW=v5.atan,zX=v5.atan2,zY=v5.atomicAdd,zZ=v5.atomicAnd,z$=v5.atomicFunc,z_=v5.atomicLoad,z0=v5.atomicMax,z1=v5.atomicMin,z2=v5.atomicOr,z3=v5.atomicStore,z4=v5.atomicSub,z5=v5.atomicXor,z6=v5.attenuationColor,z7=v5.attenuationDistance,z8=v5.attribute,z9=v5.attributeArray,Aa=v5.backgroundBlurriness,Ab=v5.backgroundIntensity,Ac=v5.backgroundRotation,Ad=v5.batch,Ae=v5.bentNormalView,Af=v5.billboarding,Ag=v5.bitAnd,Ah=v5.bitNot,Ai=v5.bitOr,Aj=v5.bitXor,Ak=v5.bitangentGeometry,Al=v5.bitangentLocal,Am=v5.bitangentView,An=v5.bitangentWorld,Ao=v5.bitcast,Ap=v5.blendBurn,Aq=v5.blendColor,Ar=v5.blendDodge,As=v5.blendOverlay,At=v5.blendScreen,Au=v5.blur,Av=v5.bool,Aw=v5.buffer,Ax=v5.bufferAttribute,Ay=v5.bumpMap,Az=v5.burn,AA=v5.builtin,AB=v5.bvec2,AC=v5.bvec3,AD=v5.bvec4,AE=v5.bypass,AF=v5.cache,AG=v5.call,AH=v5.cameraFar,AI=v5.cameraIndex,AJ=v5.cameraNear,AK=v5.cameraNormalMatrix,AL=v5.cameraPosition,AM=v5.cameraProjectionMatrix,AN=v5.cameraProjectionMatrixInverse,AO=v5.cameraViewMatrix,AP=v5.cameraViewport,AQ=v5.cameraWorldMatrix,AR=v5.cbrt,AS=v5.cdl,AT=v5.ceil,AU=v5.checker,AV=v5.cineonToneMapping,AW=v5.clamp,AX=v5.clearcoat,AY=v5.clearcoatNormalView,AZ=v5.clearcoatRoughness,A$=v5.code,A_=v5.color,A0=v5.colorSpaceToWorking,A1=v5.colorToDirection,A2=v5.compute,A3=v5.computeKernel,A4=v5.computeSkinning,A5=v5.context,A6=v5.convert,A7=v5.convertColorSpace,A8=v5.convertToTexture,A9=v5.cos,Ba=v5.cross,Bb=v5.cubeTexture,Bc=v5.cubeTextureBase,Bd=v5.cubeToUV,Be=v5.dFdx,Bf=v5.dFdy,Bg=v5.dashSize,Bh=v5.debug,Bi=v5.decrement,Bj=v5.decrementBefore,Bk=v5.defaultBuildStages,Bl=v5.defaultShaderStages,Bm=v5.defined,Bn=v5.degrees,Bo=v5.deltaTime,Bp=v5.densityFog,Bq=v5.densityFogFactor,Br=v5.depth,Bs=v5.depthPass,Bt=v5.determinant,Bu=v5.difference,Bv=v5.diffuseColor,Bw=v5.directPointLight,Bx=v5.directionToColor,By=v5.directionToFaceDirection,Bz=v5.dispersion,BA=v5.distance,BB=v5.div,BC=v5.dodge,BD=v5.dot,BE=v5.drawIndex,BF=v5.dynamicBufferAttribute,BG=v5.element,BH=v5.emissive,BI=v5.equal,BJ=v5.equals,BK=v5.equirectUV,BL=v5.exp,BM=v5.exp2,BN=v5.expression,BO=v5.faceDirection,BP=v5.faceForward,BQ=v5.faceforward,BR=v5.float,BS=v5.floatBitsToInt,BT=v5.floatBitsToUint,BU=v5.floor,BV=v5.fog,BW=v5.fract,BX=v5.frameGroup,BY=v5.frameId,BZ=v5.frontFacing,B$=v5.fwidth,B_=v5.gain,B0=v5.gapSize,B1=v5.getConstNodeType,B2=v5.getCurrentStack,B3=v5.getDirection,B4=v5.getDistanceAttenuation,B5=v5.getGeometryRoughness,B6=v5.getNormalFromDepth,B7=v5.interleavedGradientNoise,B8=v5.getParallaxCorrectNormal,B9=v5.getRoughness,Ca=v5.getScreenPosition,Cb=v5.getShIrradianceAt,Cc=v5.getShadowMaterial,Cd=v5.getShadowRenderObjectFunction,Ce=v5.getTextureIndex,Cf=v5.getViewPosition,Cg=v5.globalId,Ch=v5.glsl,Ci=v5.glslFn,Cj=v5.grayscale,Ck=v5.greaterThan,Cl=v5.greaterThanEqual,Cm=v5.hash,Cn=v5.highpModelNormalViewMatrix,Co=v5.highpModelViewMatrix,Cp=v5.hue,Cq=v5.increment,Cr=v5.incrementBefore,Cs=v5.instance,Ct=v5.instanceIndex,Cu=v5.instancedArray,Cv=v5.instancedBufferAttribute,Cw=v5.instancedDynamicBufferAttribute,Cx=v5.instancedMesh,Cy=v5.int,Cz=v5.intBitsToFloat,CA=v5.inverse,CB=v5.inverseSqrt,CC=v5.inversesqrt,CD=v5.invocationLocalIndex,CE=v5.invocationSubgroupIndex,CF=v5.ior,CG=v5.iridescence,CH=v5.iridescenceIOR,CI=v5.iridescenceThickness,CJ=v5.ivec2,CK=v5.ivec3,CL=v5.ivec4,CM=v5.js,CN=v5.label,CO=v5.length,CP=v5.lengthSq,CQ=v5.lessThan,CR=v5.lessThanEqual,CS=v5.lightPosition,CT=v5.lightProjectionUV,CU=v5.lightShadowMatrix,CV=v5.lightTargetDirection,CW=v5.lightTargetPosition,CX=v5.lightViewPosition,CY=v5.lightingContext,CZ=v5.lights,C$=v5.linearDepth,C_=v5.linearToneMapping,C0=v5.localId,C1=v5.log,C2=v5.log2,C3=v5.logarithmicDepthToViewZ,C4=v5.luminance,C5=v5.mat2,C6=v5.mat3,C7=v5.mat4,C8=v5.matcapUV,C9=v5.materialAO,Da=v5.materialAlphaTest,Db=v5.materialAnisotropy,Dc=v5.materialAnisotropyVector,Dd=v5.materialAttenuationColor,De=v5.materialAttenuationDistance,Df=v5.materialClearcoat,Dg=v5.materialClearcoatNormal,Dh=v5.materialClearcoatRoughness,Di=v5.materialColor,Dj=v5.materialDispersion,Dk=v5.materialEmissive,Dl=v5.materialEnvIntensity,Dm=v5.materialEnvRotation,Dn=v5.materialIOR,Do=v5.materialIridescence,Dp=v5.materialIridescenceIOR,Dq=v5.materialIridescenceThickness,Dr=v5.materialLightMap,Ds=v5.materialLineDashOffset,Dt=v5.materialLineDashSize,Du=v5.materialLineGapSize,Dv=v5.materialLineScale,Dw=v5.materialLineWidth,Dx=v5.materialMetalness,Dy=v5.materialNormal,Dz=v5.materialOpacity,DA=v5.materialPointSize,DB=v5.materialReference,DC=v5.materialReflectivity,DD=v5.materialRefractionRatio,DE=v5.materialRotation,DF=v5.materialRoughness,DG=v5.materialSheen,DH=v5.materialSheenRoughness,DI=v5.materialShininess,DJ=v5.materialSpecular,DK=v5.materialSpecularColor,DL=v5.materialSpecularIntensity,DM=v5.materialSpecularStrength,DN=v5.materialThickness,DO=v5.materialTransmission,DP=v5.max,DQ=v5.maxMipLevel,DR=v5.mediumpModelViewMatrix,DS=v5.metalness,DT=v5.min,DU=v5.mix,DV=v5.mixElement,DW=v5.mod,DX=v5.modInt,DY=v5.modelDirection,DZ=v5.modelNormalMatrix,D$=v5.modelPosition,D_=v5.modelRadius,D0=v5.modelScale,D1=v5.modelViewMatrix,D2=v5.modelViewPosition,D3=v5.modelViewProjection,D4=v5.modelWorldMatrix,D5=v5.modelWorldMatrixInverse,D6=v5.morphReference,D7=v5.mrt,D8=v5.mul,D9=v5.mx_aastep,Ea=v5.mx_add,Eb=v5.mx_atan2,Ec=v5.mx_cell_noise_float,Ed=v5.mx_contrast,Ee=v5.mx_divide,Ef=v5.mx_fractal_noise_float,Eg=v5.mx_fractal_noise_vec2,Eh=v5.mx_fractal_noise_vec3,Ei=v5.mx_fractal_noise_vec4,Ej=v5.mx_frame,Ek=v5.mx_heighttonormal,El=v5.mx_hsvtorgb,Em=v5.mx_ifequal,En=v5.mx_ifgreater,Eo=v5.mx_ifgreatereq,Ep=v5.mx_invert,Eq=v5.mx_modulo,Er=v5.mx_multiply,Es=v5.mx_noise_float,Et=v5.mx_noise_vec3,Eu=v5.mx_noise_vec4,Ev=v5.mx_place2d,Ew=v5.mx_power,Ex=v5.mx_ramp4,Ey=v5.mx_ramplr,Ez=v5.mx_ramptb,EA=v5.mx_rgbtohsv,EB=v5.mx_rotate2d,EC=v5.mx_rotate3d,ED=v5.mx_safepower,EE=v5.mx_separate,EF=v5.mx_splitlr,EG=v5.mx_splittb,EH=v5.mx_srgb_texture_to_lin_rec709,EI=v5.mx_subtract,EJ=v5.mx_timer,EK=v5.mx_transform_uv,EL=v5.mx_unifiednoise2d,EM=v5.mx_unifiednoise3d,EN=v5.mx_worley_noise_float,EO=v5.mx_worley_noise_vec2,EP=v5.mx_worley_noise_vec3,EQ=v5.negate,ER=v5.neutralToneMapping,ES=v5.nodeArray,ET=v5.nodeImmutable,EU=v5.nodeObject,EV=v5.nodeObjectIntent,EW=v5.nodeObjects,EX=v5.nodeProxy,EY=v5.nodeProxyIntent,EZ=v5.normalFlat,E$=v5.normalGeometry,E_=v5.normalLocal,E0=v5.normalMap,E1=v5.normalView,E2=v5.normalViewGeometry,E3=v5.normalWorld,E4=v5.normalWorldGeometry,E5=v5.normalize,E6=v5.not,E7=v5.notEqual,E8=v5.numWorkgroups,E9=v5.objectDirection,Fa=v5.objectGroup,Fb=v5.objectPosition,Fc=v5.objectRadius,Fd=v5.objectScale,Fe=v5.objectViewPosition,Ff=v5.objectWorldMatrix,Fg=v5.OnBeforeObjectUpdate,Fh=v5.OnBeforeMaterialUpdate,Fi=v5.OnObjectUpdate,Fj=v5.OnMaterialUpdate,Fk=v5.oneMinus,Fl=v5.or,Fm=v5.orthographicDepthToViewZ,Fn=v5.oscSawtooth,Fo=v5.oscSine,Fp=v5.oscSquare,Fq=v5.oscTriangle,Fr=v5.output,Fs=v5.outputStruct,Ft=v5.overlay,Fu=v5.overloadingFn,Fv=v5.parabola,Fw=v5.parallaxDirection,Fx=v5.parallaxUV,Fy=v5.parameter,Fz=v5.pass,FA=v5.passTexture,FB=v5.pcurve,FC=v5.perspectiveDepthToViewZ,FD=v5.pmremTexture,FE=v5.pointShadow,FF=v5.pointUV,FG=v5.pointWidth,FH=v5.positionGeometry,FI=v5.positionLocal,FJ=v5.positionPrevious,FK=v5.positionView,FL=v5.positionViewDirection,FM=v5.positionWorld,FN=v5.positionWorldDirection,FO=v5.posterize,FP=v5.pow,FQ=v5.pow2,FR=v5.pow3,FS=v5.pow4,FT=v5.premultiplyAlpha,FU=v5.property,FV=v5.radians,FW=v5.rand,FX=v5.range,FY=v5.rangeFog,FZ=v5.rangeFogFactor,F$=v5.reciprocal,F_=v5.reference,F0=v5.referenceBuffer,F1=v5.reflect,F2=v5.reflectVector,F3=v5.reflectView,F4=v5.reflector,F5=v5.refract,F6=v5.refractVector,F7=v5.refractView,F8=v5.reinhardToneMapping,F9=v5.remap,Ga=v5.remapClamp,Gb=v5.renderGroup,Gc=v5.renderOutput,Gd=v5.rendererReference,Ge=v5.rotate,Gf=v5.rotateUV,Gg=v5.roughness,Gh=v5.round,Gi=v5.rtt,Gj=v5.sRGBTransferEOTF,Gk=v5.sRGBTransferOETF,Gl=v5.sample,Gm=v5.sampler,Gn=v5.samplerComparison,Go=v5.saturate,Gp=v5.saturation,Gq=v5.screen,Gr=v5.screenCoordinate,Gs=v5.screenDPR,Gt=v5.screenSize,Gu=v5.screenUV,Gv=v5.scriptable,Gw=v5.scriptableValue,Gx=v5.select,Gy=v5.setCurrentStack,Gz=v5.setName,GA=v5.shaderStages,GB=v5.shadow,GC=v5.shadowPositionWorld,GD=v5.shapeCircle,GE=v5.sharedUniformGroup,GF=v5.sheen,GG=v5.sheenRoughness,GH=v5.shiftLeft,GI=v5.shiftRight,GJ=v5.shininess,GK=v5.sign,GL=v5.sin,GM=v5.sinc,GN=v5.skinning,GO=v5.smoothstep,GP=v5.smoothstepElement,GQ=v5.specularColor,GR=v5.specularF90,GS=v5.spherizeUV,GT=v5.split,GU=v5.spritesheetUV,GV=v5.sqrt,GW=v5.stack,GX=v5.step,GY=v5.stepElement,GZ=v5.storage,G$=v5.storageBarrier,G_=v5.storageObject,G0=v5.storageTexture,G1=v5.string,G2=v5.struct,G3=v5.sub,G4=v5.subgroupAdd,G5=v5.subgroupAll,G6=v5.subgroupAnd,G7=v5.subgroupAny,G8=v5.subgroupBallot,G9=v5.subgroupBroadcast,Ha=v5.subgroupBroadcastFirst,Hb=v5.subBuild,Hc=v5.subgroupElect,Hd=v5.subgroupExclusiveAdd,He=v5.subgroupExclusiveMul,Hf=v5.subgroupInclusiveAdd,Hg=v5.subgroupInclusiveMul,Hh=v5.subgroupIndex,Hi=v5.subgroupMax,Hj=v5.subgroupMin,Hk=v5.subgroupMul,Hl=v5.subgroupOr,Hm=v5.subgroupShuffle,Hn=v5.subgroupShuffleDown,Ho=v5.subgroupShuffleUp,Hp=v5.subgroupShuffleXor,Hq=v5.subgroupSize,Hr=v5.subgroupXor,Hs=v5.tan,Ht=v5.tangentGeometry,Hu=v5.tangentLocal,Hv=v5.tangentView,Hw=v5.tangentWorld,Hx=v5.texture,Hy=v5.texture3D,Hz=v5.textureBarrier,HA=v5.textureBicubic,HB=v5.textureBicubicLevel,HC=v5.textureCubeUV,HD=v5.textureLoad,HE=v5.textureSize,HF=v5.textureLevel,HG=v5.textureStore,HH=v5.thickness,HI=v5.time,HJ=v5.toneMapping,HK=v5.toneMappingExposure,HL=v5.toonOutlinePass,HM=v5.transformDirection,HN=v5.transformNormal,HO=v5.transformNormalToView,HP=v5.transformedClearcoatNormalView,HQ=v5.transformedNormalView,HR=v5.transformedNormalWorld,HS=v5.transmission,HT=v5.transpose,HU=v5.triNoise3D,HV=v5.triplanarTexture,HW=v5.triplanarTextures,HX=v5.trunc,HY=v5.uint,HZ=v5.uintBitsToFloat,H$=v5.uniform,H_=v5.uniformArray,H0=v5.uniformCubeTexture,H1=v5.uniformGroup,H2=v5.uniformFlow,H3=v5.uniformTexture,H4=v5.unpremultiplyAlpha,H5=v5.userData,H6=v5.uv,H7=v5.uvec2,H8=v5.uvec3,H9=v5.uvec4,Ia=v5.varying,Ib=v5.varyingProperty,Ic=v5.vec2,Id=v5.vec3,Ie=v5.vec4,If=v5.vectorComponents,Ig=v5.velocity,Ih=v5.vertexColor,Ii=v5.vertexIndex,Ij=v5.vertexStage,Ik=v5.vibrance,Il=v5.viewZToLogarithmicDepth,Im=v5.viewZToOrthographicDepth,In=v5.viewZToPerspectiveDepth,Io=v5.viewport,Ip=v5.viewportCoordinate,Iq=v5.viewportDepthTexture,Ir=v5.viewportLinearDepth,Is=v5.viewportMipTexture,It=v5.viewportResolution,Iu=v5.viewportSafeUV,Iv=v5.viewportSharedTexture,Iw=v5.viewportSize,Ix=v5.viewportTexture,Iy=v5.viewportUV,Iz=v5.wgsl,IA=v5.wgslFn,IB=v5.workgroupArray,IC=v5.workgroupBarrier,ID=v5.workgroupId,IE=v5.workingToColorSpace,IF=v5.xor});II();var{vec2:IJ,vec4:IK,step:IL,abs:IM,mod:IN,fract:IO,float:IP,select:IQ}=IH;let IR=(a,b,c,d)=>{let e=IL(IP(0),a.x).mul(IL(a.x,IP(1))),f=IL(IP(0),a.y).mul(IL(a.y,IP(1))),g=e.mul(f),h=IK(b.rgb,b.a.mul(g)),i=IN(IM(a.x),IP(2)),j=IN(IM(a.y),IP(2)),k=IJ(IQ(IL(IP(1),i),IP(2).sub(i),i),IQ(IL(IP(1),j),IP(2).sub(j),j)),l=c.sample(k),m=IJ(IO(a.x),IO(a.y)),n=c.sample(m);return IQ(IL(IP(.5),d),IQ(IL(IP(1.5),d),IQ(IL(IP(2.5),d),n,l),h),b)};II();let IS=(a,b,c)=>{let d=H$(0);return a.onBeforeRender(({deltaTime:a})=>{d.value+=a*b.uniform.value}),c?d.add(c.uniform):d},IT="srgb",IU="srgb-linear",IV="linear",IW="srgb",IX="300 es";function IY(a){for(let b=a.length-1;b>=0;--b)if(a[b]>=65535)return!0;return!1}function IZ(a){return document.createElementNS("http://www.w3.org/1999/xhtml",a)}let I$={};function I_(...a){console.log("THREE."+a.shift(),...a)}function I0(...a){console.warn("THREE."+a.shift(),...a)}function I1(...a){console.error("THREE."+a.shift(),...a)}function I2(...a){let b=a.join(" ");b in I$||(I$[b]=!0,I0(...a))}let I3=class{addEventListener(a,b){void 0===this._listeners&&(this._listeners={});let c=this._listeners;void 0===c[a]&&(c[a]=[]),-1===c[a].indexOf(b)&&c[a].push(b)}hasEventListener(a,b){let c=this._listeners;return void 0!==c&&void 0!==c[a]&&-1!==c[a].indexOf(b)}removeEventListener(a,b){let c=this._listeners;if(void 0===c)return;let d=c[a];if(void 0!==d){let a=d.indexOf(b);-1!==a&&d.splice(a,1)}}dispatchEvent(a){let b=this._listeners;if(void 0===b)return;let c=b[a.type];if(void 0!==c){a.target=this;let b=c.slice(0);for(let c=0,d=b.length;c<d;c++)b[c].call(this,a);a.target=null}}},I4=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],I5=Math.PI/180,I6=180/Math.PI;function I7(){let a=0xffffffff*Math.random()|0,b=0xffffffff*Math.random()|0,c=0xffffffff*Math.random()|0,d=0xffffffff*Math.random()|0;return(I4[255&a]+I4[a>>8&255]+I4[a>>16&255]+I4[a>>24&255]+"-"+I4[255&b]+I4[b>>8&255]+"-"+I4[b>>16&15|64]+I4[b>>24&255]+"-"+I4[63&c|128]+I4[c>>8&255]+"-"+I4[c>>16&255]+I4[c>>24&255]+I4[255&d]+I4[d>>8&255]+I4[d>>16&255]+I4[d>>24&255]).toLowerCase()}function I8(a,b,c){return Math.max(b,Math.min(c,a))}function I9(a,b,c){return(1-c)*a+c*b}function Ja(a,b){switch(b.constructor){case Float32Array:return a;case Uint32Array:return a/0xffffffff;case Uint16Array:return a/65535;case Uint8Array:return a/255;case Int32Array:return Math.max(a/0x7fffffff,-1);case Int16Array:return Math.max(a/32767,-1);case Int8Array:return Math.max(a/127,-1);default:throw Error("Invalid component type.")}}function Jb(a,b){switch(b.constructor){case Float32Array:return a;case Uint32Array:return Math.round(0xffffffff*a);case Uint16Array:return Math.round(65535*a);case Uint8Array:return Math.round(255*a);case Int32Array:return Math.round(0x7fffffff*a);case Int16Array:return Math.round(32767*a);case Int8Array:return Math.round(127*a);default:throw Error("Invalid component type.")}}let Jc=class a{constructor(b=0,c=0){a.prototype.isVector2=!0,this.x=b,this.y=c}get width(){return this.x}set width(a){this.x=a}get height(){return this.y}set height(a){this.y=a}set(a,b){return this.x=a,this.y=b,this}setScalar(a){return this.x=a,this.y=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setComponent(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y)}copy(a){return this.x=a.x,this.y=a.y,this}add(a){return this.x+=a.x,this.y+=a.y,this}addScalar(a){return this.x+=a,this.y+=a,this}addVectors(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this}addScaledVector(a,b){return this.x+=a.x*b,this.y+=a.y*b,this}sub(a){return this.x-=a.x,this.y-=a.y,this}subScalar(a){return this.x-=a,this.y-=a,this}subVectors(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this}multiply(a){return this.x*=a.x,this.y*=a.y,this}multiplyScalar(a){return this.x*=a,this.y*=a,this}divide(a){return this.x/=a.x,this.y/=a.y,this}divideScalar(a){return this.multiplyScalar(1/a)}applyMatrix3(a){let b=this.x,c=this.y,d=a.elements;return this.x=d[0]*b+d[3]*c+d[6],this.y=d[1]*b+d[4]*c+d[7],this}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this}clamp(a,b){return this.x=I8(this.x,a.x,b.x),this.y=I8(this.y,a.y,b.y),this}clampScalar(a,b){return this.x=I8(this.x,a,b),this.y=I8(this.y,a,b),this}clampLength(a,b){let c=this.length();return this.divideScalar(c||1).multiplyScalar(I8(c,a,b))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(a){return this.x*a.x+this.y*a.y}cross(a){return this.x*a.y-this.y*a.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(a){let b=Math.sqrt(this.lengthSq()*a.lengthSq());return 0===b?Math.PI/2:Math.acos(I8(this.dot(a)/b,-1,1))}distanceTo(a){return Math.sqrt(this.distanceToSquared(a))}distanceToSquared(a){let b=this.x-a.x,c=this.y-a.y;return b*b+c*c}manhattanDistanceTo(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this}lerpVectors(a,b,c){return this.x=a.x+(b.x-a.x)*c,this.y=a.y+(b.y-a.y)*c,this}equals(a){return a.x===this.x&&a.y===this.y}fromArray(a,b=0){return this.x=a[b],this.y=a[b+1],this}toArray(a=[],b=0){return a[b]=this.x,a[b+1]=this.y,a}fromBufferAttribute(a,b){return this.x=a.getX(b),this.y=a.getY(b),this}rotateAround(a,b){let c=Math.cos(b),d=Math.sin(b),e=this.x-a.x,f=this.y-a.y;return this.x=e*c-f*d+a.x,this.y=e*d+f*c+a.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Jd=class{constructor(a=0,b=0,c=0,d=1){this.isQuaternion=!0,this._x=a,this._y=b,this._z=c,this._w=d}static slerpFlat(a,b,c,d,e,f,g){let h=c[d+0],i=c[d+1],j=c[d+2],k=c[d+3],l=e[f+0],m=e[f+1],n=e[f+2],o=e[f+3];if(g<=0){a[b+0]=h,a[b+1]=i,a[b+2]=j,a[b+3]=k;return}if(g>=1){a[b+0]=l,a[b+1]=m,a[b+2]=n,a[b+3]=o;return}if(k!==o||h!==l||i!==m||j!==n){let a=h*l+i*m+j*n+k*o;a<0&&(l=-l,m=-m,n=-n,o=-o,a=-a);let b=1-g;if(a<.9995){let c=Math.acos(a),d=Math.sin(c);h=h*(b=Math.sin(b*c)/d)+l*(g=Math.sin(g*c)/d),i=i*b+m*g,j=j*b+n*g,k=k*b+o*g}else{h=h*b+l*g,i=i*b+m*g;let a=1/Math.sqrt(h*h+i*i+(j=j*b+n*g)*j+(k=k*b+o*g)*k);h*=a,i*=a,j*=a,k*=a}}a[b]=h,a[b+1]=i,a[b+2]=j,a[b+3]=k}static multiplyQuaternionsFlat(a,b,c,d,e,f){let g=c[d],h=c[d+1],i=c[d+2],j=c[d+3],k=e[f],l=e[f+1],m=e[f+2],n=e[f+3];return a[b]=g*n+j*k+h*m-i*l,a[b+1]=h*n+j*l+i*k-g*m,a[b+2]=i*n+j*m+g*l-h*k,a[b+3]=j*n-g*k-h*l-i*m,a}get x(){return this._x}set x(a){this._x=a,this._onChangeCallback()}get y(){return this._y}set y(a){this._y=a,this._onChangeCallback()}get z(){return this._z}set z(a){this._z=a,this._onChangeCallback()}get w(){return this._w}set w(a){this._w=a,this._onChangeCallback()}set(a,b,c,d){return this._x=a,this._y=b,this._z=c,this._w=d,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(a){return this._x=a.x,this._y=a.y,this._z=a.z,this._w=a.w,this._onChangeCallback(),this}setFromEuler(a,b=!0){let c=a._x,d=a._y,e=a._z,f=a._order,g=Math.cos,h=Math.sin,i=g(c/2),j=g(d/2),k=g(e/2),l=h(c/2),m=h(d/2),n=h(e/2);switch(f){case"XYZ":this._x=l*j*k+i*m*n,this._y=i*m*k-l*j*n,this._z=i*j*n+l*m*k,this._w=i*j*k-l*m*n;break;case"YXZ":this._x=l*j*k+i*m*n,this._y=i*m*k-l*j*n,this._z=i*j*n-l*m*k,this._w=i*j*k+l*m*n;break;case"ZXY":this._x=l*j*k-i*m*n,this._y=i*m*k+l*j*n,this._z=i*j*n+l*m*k,this._w=i*j*k-l*m*n;break;case"ZYX":this._x=l*j*k-i*m*n,this._y=i*m*k+l*j*n,this._z=i*j*n-l*m*k,this._w=i*j*k+l*m*n;break;case"YZX":this._x=l*j*k+i*m*n,this._y=i*m*k+l*j*n,this._z=i*j*n-l*m*k,this._w=i*j*k-l*m*n;break;case"XZY":this._x=l*j*k-i*m*n,this._y=i*m*k-l*j*n,this._z=i*j*n+l*m*k,this._w=i*j*k+l*m*n;break;default:I0("Quaternion: .setFromEuler() encountered an unknown order: "+f)}return!0===b&&this._onChangeCallback(),this}setFromAxisAngle(a,b){let c=b/2,d=Math.sin(c);return this._x=a.x*d,this._y=a.y*d,this._z=a.z*d,this._w=Math.cos(c),this._onChangeCallback(),this}setFromRotationMatrix(a){let b=a.elements,c=b[0],d=b[4],e=b[8],f=b[1],g=b[5],h=b[9],i=b[2],j=b[6],k=b[10],l=c+g+k;if(l>0){let a=.5/Math.sqrt(l+1);this._w=.25/a,this._x=(j-h)*a,this._y=(e-i)*a,this._z=(f-d)*a}else if(c>g&&c>k){let a=2*Math.sqrt(1+c-g-k);this._w=(j-h)/a,this._x=.25*a,this._y=(d+f)/a,this._z=(e+i)/a}else if(g>k){let a=2*Math.sqrt(1+g-c-k);this._w=(e-i)/a,this._x=(d+f)/a,this._y=.25*a,this._z=(h+j)/a}else{let a=2*Math.sqrt(1+k-c-g);this._w=(f-d)/a,this._x=(e+i)/a,this._y=(h+j)/a,this._z=.25*a}return this._onChangeCallback(),this}setFromUnitVectors(a,b){let c=a.dot(b)+1;return c<1e-8?(c=0,Math.abs(a.x)>Math.abs(a.z)?(this._x=-a.y,this._y=a.x,this._z=0):(this._x=0,this._y=-a.z,this._z=a.y)):(this._x=a.y*b.z-a.z*b.y,this._y=a.z*b.x-a.x*b.z,this._z=a.x*b.y-a.y*b.x),this._w=c,this.normalize()}angleTo(a){return 2*Math.acos(Math.abs(I8(this.dot(a),-1,1)))}rotateTowards(a,b){let c=this.angleTo(a);if(0===c)return this;let d=Math.min(1,b/c);return this.slerp(a,d),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let a=this.length();return 0===a?(this._x=0,this._y=0,this._z=0,this._w=1):(a=1/a,this._x=this._x*a,this._y=this._y*a,this._z=this._z*a,this._w=this._w*a),this._onChangeCallback(),this}multiply(a){return this.multiplyQuaternions(this,a)}premultiply(a){return this.multiplyQuaternions(a,this)}multiplyQuaternions(a,b){let c=a._x,d=a._y,e=a._z,f=a._w,g=b._x,h=b._y,i=b._z,j=b._w;return this._x=c*j+f*g+d*i-e*h,this._y=d*j+f*h+e*g-c*i,this._z=e*j+f*i+c*h-d*g,this._w=f*j-c*g-d*h-e*i,this._onChangeCallback(),this}slerp(a,b){if(b<=0)return this;if(b>=1)return this.copy(a);let c=a._x,d=a._y,e=a._z,f=a._w,g=this.dot(a);g<0&&(c=-c,d=-d,e=-e,f=-f,g=-g);let h=1-b;if(g<.9995){let a=Math.acos(g),i=Math.sin(a);h=Math.sin(h*a)/i,b=Math.sin(b*a)/i,this._x=this._x*h+c*b,this._y=this._y*h+d*b,this._z=this._z*h+e*b,this._w=this._w*h+f*b,this._onChangeCallback()}else this._x=this._x*h+c*b,this._y=this._y*h+d*b,this._z=this._z*h+e*b,this._w=this._w*h+f*b,this.normalize();return this}slerpQuaternions(a,b,c){return this.copy(a).slerp(b,c)}random(){let a=2*Math.PI*Math.random(),b=2*Math.PI*Math.random(),c=Math.random(),d=Math.sqrt(1-c),e=Math.sqrt(c);return this.set(d*Math.sin(a),d*Math.cos(a),e*Math.sin(b),e*Math.cos(b))}equals(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w}fromArray(a,b=0){return this._x=a[b],this._y=a[b+1],this._z=a[b+2],this._w=a[b+3],this._onChangeCallback(),this}toArray(a=[],b=0){return a[b]=this._x,a[b+1]=this._y,a[b+2]=this._z,a[b+3]=this._w,a}fromBufferAttribute(a,b){return this._x=a.getX(b),this._y=a.getY(b),this._z=a.getZ(b),this._w=a.getW(b),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(a){return this._onChangeCallback=a,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},Je=class a{constructor(b=0,c=0,d=0){a.prototype.isVector3=!0,this.x=b,this.y=c,this.z=d}set(a,b,c){return void 0===c&&(c=this.z),this.x=a,this.y=b,this.z=c,this}setScalar(a){return this.x=a,this.y=a,this.z=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setZ(a){return this.z=a,this}setComponent(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(a){return this.x=a.x,this.y=a.y,this.z=a.z,this}add(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this}addScalar(a){return this.x+=a,this.y+=a,this.z+=a,this}addVectors(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this}addScaledVector(a,b){return this.x+=a.x*b,this.y+=a.y*b,this.z+=a.z*b,this}sub(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this}subScalar(a){return this.x-=a,this.y-=a,this.z-=a,this}subVectors(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this}multiply(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this}multiplyScalar(a){return this.x*=a,this.y*=a,this.z*=a,this}multiplyVectors(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this}applyEuler(a){return this.applyQuaternion(Jg.setFromEuler(a))}applyAxisAngle(a,b){return this.applyQuaternion(Jg.setFromAxisAngle(a,b))}applyMatrix3(a){let b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[3]*c+e[6]*d,this.y=e[1]*b+e[4]*c+e[7]*d,this.z=e[2]*b+e[5]*c+e[8]*d,this}applyNormalMatrix(a){return this.applyMatrix3(a).normalize()}applyMatrix4(a){let b=this.x,c=this.y,d=this.z,e=a.elements,f=1/(e[3]*b+e[7]*c+e[11]*d+e[15]);return this.x=(e[0]*b+e[4]*c+e[8]*d+e[12])*f,this.y=(e[1]*b+e[5]*c+e[9]*d+e[13])*f,this.z=(e[2]*b+e[6]*c+e[10]*d+e[14])*f,this}applyQuaternion(a){let b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z,h=a.w,i=2*(f*d-g*c),j=2*(g*b-e*d),k=2*(e*c-f*b);return this.x=b+h*i+f*k-g*j,this.y=c+h*j+g*i-e*k,this.z=d+h*k+e*j-f*i,this}project(a){return this.applyMatrix4(a.matrixWorldInverse).applyMatrix4(a.projectionMatrix)}unproject(a){return this.applyMatrix4(a.projectionMatrixInverse).applyMatrix4(a.matrixWorld)}transformDirection(a){let b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d,this.y=e[1]*b+e[5]*c+e[9]*d,this.z=e[2]*b+e[6]*c+e[10]*d,this.normalize()}divide(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this}divideScalar(a){return this.multiplyScalar(1/a)}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this.z=Math.max(this.z,a.z),this}clamp(a,b){return this.x=I8(this.x,a.x,b.x),this.y=I8(this.y,a.y,b.y),this.z=I8(this.z,a.z,b.z),this}clampScalar(a,b){return this.x=I8(this.x,a,b),this.y=I8(this.y,a,b),this.z=I8(this.z,a,b),this}clampLength(a,b){let c=this.length();return this.divideScalar(c||1).multiplyScalar(I8(c,a,b))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this}lerpVectors(a,b,c){return this.x=a.x+(b.x-a.x)*c,this.y=a.y+(b.y-a.y)*c,this.z=a.z+(b.z-a.z)*c,this}cross(a){return this.crossVectors(this,a)}crossVectors(a,b){let c=a.x,d=a.y,e=a.z,f=b.x,g=b.y,h=b.z;return this.x=d*h-e*g,this.y=e*f-c*h,this.z=c*g-d*f,this}projectOnVector(a){let b=a.lengthSq();if(0===b)return this.set(0,0,0);let c=a.dot(this)/b;return this.copy(a).multiplyScalar(c)}projectOnPlane(a){return Jf.copy(this).projectOnVector(a),this.sub(Jf)}reflect(a){return this.sub(Jf.copy(a).multiplyScalar(2*this.dot(a)))}angleTo(a){let b=Math.sqrt(this.lengthSq()*a.lengthSq());return 0===b?Math.PI/2:Math.acos(I8(this.dot(a)/b,-1,1))}distanceTo(a){return Math.sqrt(this.distanceToSquared(a))}distanceToSquared(a){let b=this.x-a.x,c=this.y-a.y,d=this.z-a.z;return b*b+c*c+d*d}manhattanDistanceTo(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)}setFromSpherical(a){return this.setFromSphericalCoords(a.radius,a.phi,a.theta)}setFromSphericalCoords(a,b,c){let d=Math.sin(b)*a;return this.x=d*Math.sin(c),this.y=Math.cos(b)*a,this.z=d*Math.cos(c),this}setFromCylindrical(a){return this.setFromCylindricalCoords(a.radius,a.theta,a.y)}setFromCylindricalCoords(a,b,c){return this.x=a*Math.sin(b),this.y=c,this.z=a*Math.cos(b),this}setFromMatrixPosition(a){let b=a.elements;return this.x=b[12],this.y=b[13],this.z=b[14],this}setFromMatrixScale(a){let b=this.setFromMatrixColumn(a,0).length(),c=this.setFromMatrixColumn(a,1).length(),d=this.setFromMatrixColumn(a,2).length();return this.x=b,this.y=c,this.z=d,this}setFromMatrixColumn(a,b){return this.fromArray(a.elements,4*b)}setFromMatrix3Column(a,b){return this.fromArray(a.elements,3*b)}setFromEuler(a){return this.x=a._x,this.y=a._y,this.z=a._z,this}setFromColor(a){return this.x=a.r,this.y=a.g,this.z=a.b,this}equals(a){return a.x===this.x&&a.y===this.y&&a.z===this.z}fromArray(a,b=0){return this.x=a[b],this.y=a[b+1],this.z=a[b+2],this}toArray(a=[],b=0){return a[b]=this.x,a[b+1]=this.y,a[b+2]=this.z,a}fromBufferAttribute(a,b){return this.x=a.getX(b),this.y=a.getY(b),this.z=a.getZ(b),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let a=Math.random()*Math.PI*2,b=2*Math.random()-1,c=Math.sqrt(1-b*b);return this.x=c*Math.cos(a),this.y=b,this.z=c*Math.sin(a),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},Jf=new Je,Jg=new Jd,Jh=class a{constructor(b,c,d,e,f,g,h,i,j){a.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==b&&this.set(b,c,d,e,f,g,h,i,j)}set(a,b,c,d,e,f,g,h,i){let j=this.elements;return j[0]=a,j[1]=d,j[2]=g,j[3]=b,j[4]=e,j[5]=h,j[6]=c,j[7]=f,j[8]=i,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(a){let b=this.elements,c=a.elements;return b[0]=c[0],b[1]=c[1],b[2]=c[2],b[3]=c[3],b[4]=c[4],b[5]=c[5],b[6]=c[6],b[7]=c[7],b[8]=c[8],this}extractBasis(a,b,c){return a.setFromMatrix3Column(this,0),b.setFromMatrix3Column(this,1),c.setFromMatrix3Column(this,2),this}setFromMatrix4(a){let b=a.elements;return this.set(b[0],b[4],b[8],b[1],b[5],b[9],b[2],b[6],b[10]),this}multiply(a){return this.multiplyMatrices(this,a)}premultiply(a){return this.multiplyMatrices(a,this)}multiplyMatrices(a,b){let c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[3],h=c[6],i=c[1],j=c[4],k=c[7],l=c[2],m=c[5],n=c[8],o=d[0],p=d[3],q=d[6],r=d[1],s=d[4],t=d[7],u=d[2],v=d[5],w=d[8];return e[0]=f*o+g*r+h*u,e[3]=f*p+g*s+h*v,e[6]=f*q+g*t+h*w,e[1]=i*o+j*r+k*u,e[4]=i*p+j*s+k*v,e[7]=i*q+j*t+k*w,e[2]=l*o+m*r+n*u,e[5]=l*p+m*s+n*v,e[8]=l*q+m*t+n*w,this}multiplyScalar(a){let b=this.elements;return b[0]*=a,b[3]*=a,b[6]*=a,b[1]*=a,b[4]*=a,b[7]*=a,b[2]*=a,b[5]*=a,b[8]*=a,this}determinant(){let a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*f*j-b*g*i-c*e*j+c*g*h+d*e*i-d*f*h}invert(){let a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=j*f-g*i,l=g*h-j*e,m=i*e-f*h,n=b*k+c*l+d*m;if(0===n)return this.set(0,0,0,0,0,0,0,0,0);let o=1/n;return a[0]=k*o,a[1]=(d*i-j*c)*o,a[2]=(g*c-d*f)*o,a[3]=l*o,a[4]=(j*b-d*h)*o,a[5]=(d*e-g*b)*o,a[6]=m*o,a[7]=(c*h-i*b)*o,a[8]=(f*b-c*e)*o,this}transpose(){let a,b=this.elements;return a=b[1],b[1]=b[3],b[3]=a,a=b[2],b[2]=b[6],b[6]=a,a=b[5],b[5]=b[7],b[7]=a,this}getNormalMatrix(a){return this.setFromMatrix4(a).invert().transpose()}transposeIntoArray(a){let b=this.elements;return a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8],this}setUvTransform(a,b,c,d,e,f,g){let h=Math.cos(e),i=Math.sin(e);return this.set(c*h,c*i,-c*(h*f+i*g)+f+a,-d*i,d*h,-d*(-i*f+h*g)+g+b,0,0,1),this}scale(a,b){return this.premultiply(Ji.makeScale(a,b)),this}rotate(a){return this.premultiply(Ji.makeRotation(-a)),this}translate(a,b){return this.premultiply(Ji.makeTranslation(a,b)),this}makeTranslation(a,b){return a.isVector2?this.set(1,0,a.x,0,1,a.y,0,0,1):this.set(1,0,a,0,1,b,0,0,1),this}makeRotation(a){let b=Math.cos(a),c=Math.sin(a);return this.set(b,-c,0,c,b,0,0,0,1),this}makeScale(a,b){return this.set(a,0,0,0,b,0,0,0,1),this}equals(a){let b=this.elements,c=a.elements;for(let a=0;a<9;a++)if(b[a]!==c[a])return!1;return!0}fromArray(a,b=0){for(let c=0;c<9;c++)this.elements[c]=a[c+b];return this}toArray(a=[],b=0){let c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a}clone(){return new this.constructor().fromArray(this.elements)}},Ji=new Jh,Jj=new Jh().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Jk=new Jh().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715),Jl=(h=[.64,.33,.3,.6,.15,.06],i=[.2126,.7152,.0722],j=[.3127,.329],(g={enabled:!0,workingColorSpace:IU,spaces:{},convert:function(a,b,c){return!1!==this.enabled&&b!==c&&b&&c&&(this.spaces[b].transfer===IW&&(a.r=Jm(a.r),a.g=Jm(a.g),a.b=Jm(a.b)),this.spaces[b].primaries!==this.spaces[c].primaries&&(a.applyMatrix3(this.spaces[b].toXYZ),a.applyMatrix3(this.spaces[c].fromXYZ)),this.spaces[c].transfer===IW&&(a.r=Jn(a.r),a.g=Jn(a.g),a.b=Jn(a.b))),a},workingToColorSpace:function(a,b){return this.convert(a,this.workingColorSpace,b)},colorSpaceToWorking:function(a,b){return this.convert(a,b,this.workingColorSpace)},getPrimaries:function(a){return this.spaces[a].primaries},getTransfer:function(a){return""===a?IV:this.spaces[a].transfer},getToneMappingMode:function(a){return this.spaces[a].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(a,b=this.workingColorSpace){return a.fromArray(this.spaces[b].luminanceCoefficients)},define:function(a){Object.assign(this.spaces,a)},_getMatrix:function(a,b,c){return a.copy(this.spaces[b].toXYZ).multiply(this.spaces[c].fromXYZ)},_getDrawingBufferColorSpace:function(a){return this.spaces[a].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(a=this.workingColorSpace){return this.spaces[a].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(a,b){return I2("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),g.workingToColorSpace(a,b)},toWorkingColorSpace:function(a,b){return I2("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),g.colorSpaceToWorking(a,b)}}).define({[IU]:{primaries:h,whitePoint:j,transfer:IV,toXYZ:Jj,fromXYZ:Jk,luminanceCoefficients:i,workingColorSpaceConfig:{unpackColorSpace:IT},outputColorSpaceConfig:{drawingBufferColorSpace:IT}},[IT]:{primaries:h,whitePoint:j,transfer:IW,toXYZ:Jj,fromXYZ:Jk,luminanceCoefficients:i,outputColorSpaceConfig:{drawingBufferColorSpace:IT}}}),g);function Jm(a){return a<.04045?.0773993808*a:Math.pow(.9478672986*a+.0521327014,2.4)}function Jn(a){return a<.0031308?12.92*a:1.055*Math.pow(a,.41666)-.055}class Jo{static getDataURL(a,c="image/png"){let d;if(/^data:/i.test(a.src)||typeof HTMLCanvasElement>"u")return a.src;if(a instanceof HTMLCanvasElement)d=a;else{void 0===b&&(b=IZ("canvas")),b.width=a.width,b.height=a.height;let c=b.getContext("2d");a instanceof ImageData?c.putImageData(a,0,0):c.drawImage(a,0,0,a.width,a.height),d=b}return d.toDataURL(c)}static sRGBToLinear(a){if("u">typeof HTMLImageElement&&a instanceof HTMLImageElement||"u">typeof HTMLCanvasElement&&a instanceof HTMLCanvasElement||"u">typeof ImageBitmap&&a instanceof ImageBitmap){let b=IZ("canvas");b.width=a.width,b.height=a.height;let c=b.getContext("2d");c.drawImage(a,0,0,a.width,a.height);let d=c.getImageData(0,0,a.width,a.height),e=d.data;for(let a=0;a<e.length;a++)e[a]=255*Jm(e[a]/255);return c.putImageData(d,0,0),b}if(!a.data)return I0("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),a;{let b=a.data.slice(0);for(let a=0;a<b.length;a++)b instanceof Uint8Array||b instanceof Uint8ClampedArray?b[a]=Math.floor(255*Jm(b[a]/255)):b[a]=Jm(b[a]);return{data:b,width:a.width,height:a.height}}}}let Jp=0;class Jq{constructor(a=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Jp++}),this.uuid=I7(),this.data=a,this.dataReady=!0,this.version=0}getSize(a){let b=this.data;return"u">typeof HTMLVideoElement&&b instanceof HTMLVideoElement?a.set(b.videoWidth,b.videoHeight,0):b instanceof VideoFrame?a.set(b.displayHeight,b.displayWidth,0):null!==b?a.set(b.width,b.height,b.depth||0):a.set(0,0,0),a}set needsUpdate(a){!0===a&&this.version++}toJSON(a){let b=void 0===a||"string"==typeof a;if(!b&&void 0!==a.images[this.uuid])return a.images[this.uuid];let c={uuid:this.uuid,url:""},d=this.data;if(null!==d){let a;if(Array.isArray(d)){a=[];for(let b=0,c=d.length;b<c;b++)d[b].isDataTexture?a.push(Jr(d[b].image)):a.push(Jr(d[b]))}else a=Jr(d);c.url=a}return b||(a.images[this.uuid]=c),c}}function Jr(a){return"u">typeof HTMLImageElement&&a instanceof HTMLImageElement||"u">typeof HTMLCanvasElement&&a instanceof HTMLCanvasElement||"u">typeof ImageBitmap&&a instanceof ImageBitmap?Jo.getDataURL(a):a.data?{data:Array.from(a.data),width:a.width,height:a.height,type:a.data.constructor.name}:(I0("Texture: Unable to serialize Texture."),{})}let Js=0,Jt=new Je;class Ju extends I3{constructor(a=Ju.DEFAULT_IMAGE,b=Ju.DEFAULT_MAPPING,c=1001,d=1001,e=1006,f=1008,g=1023,h=1009,i=Ju.DEFAULT_ANISOTROPY,j=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Js++}),this.uuid=I7(),this.name="",this.source=new Jq(a),this.mipmaps=[],this.mapping=b,this.channel=0,this.wrapS=c,this.wrapT=d,this.magFilter=e,this.minFilter=f,this.anisotropy=i,this.format=g,this.internalFormat=null,this.type=h,this.offset=new Jc(0,0),this.repeat=new Jc(1,1),this.center=new Jc(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Jh,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=j,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(a&&a.depth&&a.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(Jt).x}get height(){return this.source.getSize(Jt).y}get depth(){return this.source.getSize(Jt).z}get image(){return this.source.data}set image(a=null){this.source.data=a}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(a,b){this.updateRanges.push({start:a,count:b})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(a){return this.name=a.name,this.source=a.source,this.mipmaps=a.mipmaps.slice(0),this.mapping=a.mapping,this.channel=a.channel,this.wrapS=a.wrapS,this.wrapT=a.wrapT,this.magFilter=a.magFilter,this.minFilter=a.minFilter,this.anisotropy=a.anisotropy,this.format=a.format,this.internalFormat=a.internalFormat,this.type=a.type,this.offset.copy(a.offset),this.repeat.copy(a.repeat),this.center.copy(a.center),this.rotation=a.rotation,this.matrixAutoUpdate=a.matrixAutoUpdate,this.matrix.copy(a.matrix),this.generateMipmaps=a.generateMipmaps,this.premultiplyAlpha=a.premultiplyAlpha,this.flipY=a.flipY,this.unpackAlignment=a.unpackAlignment,this.colorSpace=a.colorSpace,this.renderTarget=a.renderTarget,this.isRenderTargetTexture=a.isRenderTargetTexture,this.isArrayTexture=a.isArrayTexture,this.userData=JSON.parse(JSON.stringify(a.userData)),this.needsUpdate=!0,this}setValues(a){for(let b in a){let c=a[b];if(void 0===c){I0(`Texture.setValues(): parameter '${b}' has value of undefined.`);continue}let d=this[b];if(void 0===d){I0(`Texture.setValues(): property '${b}' does not exist.`);continue}d&&c&&d.isVector2&&c.isVector2||d&&c&&d.isVector3&&c.isVector3||d&&c&&d.isMatrix3&&c.isMatrix3?d.copy(c):this[b]=c}}toJSON(a){let b=void 0===a||"string"==typeof a;if(!b&&void 0!==a.textures[this.uuid])return a.textures[this.uuid];let c={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(a).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(c.userData=this.userData),b||(a.textures[this.uuid]=c),c}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(a){if(300!==this.mapping)return a;if(a.applyMatrix3(this.matrix),a.x<0||a.x>1)switch(this.wrapS){case 1e3:a.x=a.x-Math.floor(a.x);break;case 1001:a.x=a.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(a.x)%2)?a.x=Math.ceil(a.x)-a.x:a.x=a.x-Math.floor(a.x)}if(a.y<0||a.y>1)switch(this.wrapT){case 1e3:a.y=a.y-Math.floor(a.y);break;case 1001:a.y=a.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(a.y)%2)?a.y=Math.ceil(a.y)-a.y:a.y=a.y-Math.floor(a.y)}return this.flipY&&(a.y=1-a.y),a}set needsUpdate(a){!0===a&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(a){!0===a&&this.pmremVersion++}}Ju.DEFAULT_IMAGE=null,Ju.DEFAULT_MAPPING=300,Ju.DEFAULT_ANISOTROPY=1;let Jv=class a{constructor(b=0,c=0,d=0,e=1){a.prototype.isVector4=!0,this.x=b,this.y=c,this.z=d,this.w=e}get width(){return this.z}set width(a){this.z=a}get height(){return this.w}set height(a){this.w=a}set(a,b,c,d){return this.x=a,this.y=b,this.z=c,this.w=d,this}setScalar(a){return this.x=a,this.y=a,this.z=a,this.w=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setZ(a){return this.z=a,this}setW(a){return this.w=a,this}setComponent(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=void 0!==a.w?a.w:1,this}add(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this.w+=a.w,this}addScalar(a){return this.x+=a,this.y+=a,this.z+=a,this.w+=a,this}addVectors(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this.w=a.w+b.w,this}addScaledVector(a,b){return this.x+=a.x*b,this.y+=a.y*b,this.z+=a.z*b,this.w+=a.w*b,this}sub(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this.w-=a.w,this}subScalar(a){return this.x-=a,this.y-=a,this.z-=a,this.w-=a,this}subVectors(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this.w=a.w-b.w,this}multiply(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this.w*=a.w,this}multiplyScalar(a){return this.x*=a,this.y*=a,this.z*=a,this.w*=a,this}applyMatrix4(a){let b=this.x,c=this.y,d=this.z,e=this.w,f=a.elements;return this.x=f[0]*b+f[4]*c+f[8]*d+f[12]*e,this.y=f[1]*b+f[5]*c+f[9]*d+f[13]*e,this.z=f[2]*b+f[6]*c+f[10]*d+f[14]*e,this.w=f[3]*b+f[7]*c+f[11]*d+f[15]*e,this}divide(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this.w/=a.w,this}divideScalar(a){return this.multiplyScalar(1/a)}setAxisAngleFromQuaternion(a){this.w=2*Math.acos(a.w);let b=Math.sqrt(1-a.w*a.w);return b<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b),this}setAxisAngleFromRotationMatrix(a){let b,c,d,e,f=a.elements,g=f[0],h=f[4],i=f[8],j=f[1],k=f[5],l=f[9],m=f[2],n=f[6],o=f[10];if(.01>Math.abs(h-j)&&.01>Math.abs(i-m)&&.01>Math.abs(l-n)){if(.1>Math.abs(h+j)&&.1>Math.abs(i+m)&&.1>Math.abs(l+n)&&.1>Math.abs(g+k+o-3))return this.set(1,0,0,0),this;b=Math.PI;let a=(g+1)/2,f=(k+1)/2,p=(o+1)/2,q=(h+j)/4,r=(i+m)/4,s=(l+n)/4;return a>f&&a>p?a<.01?(c=0,d=.707106781,e=.707106781):(d=q/(c=Math.sqrt(a)),e=r/c):f>p?f<.01?(c=.707106781,d=0,e=.707106781):(c=q/(d=Math.sqrt(f)),e=s/d):p<.01?(c=.707106781,d=.707106781,e=0):(c=r/(e=Math.sqrt(p)),d=s/e),this.set(c,d,e,b),this}let p=Math.sqrt((n-l)*(n-l)+(i-m)*(i-m)+(j-h)*(j-h));return .001>Math.abs(p)&&(p=1),this.x=(n-l)/p,this.y=(i-m)/p,this.z=(j-h)/p,this.w=Math.acos((g+k+o-1)/2),this}setFromMatrixPosition(a){let b=a.elements;return this.x=b[12],this.y=b[13],this.z=b[14],this.w=b[15],this}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this.w=Math.min(this.w,a.w),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this.z=Math.max(this.z,a.z),this.w=Math.max(this.w,a.w),this}clamp(a,b){return this.x=I8(this.x,a.x,b.x),this.y=I8(this.y,a.y,b.y),this.z=I8(this.z,a.z,b.z),this.w=I8(this.w,a.w,b.w),this}clampScalar(a,b){return this.x=I8(this.x,a,b),this.y=I8(this.y,a,b),this.z=I8(this.z,a,b),this.w=I8(this.w,a,b),this}clampLength(a,b){let c=this.length();return this.divideScalar(c||1).multiplyScalar(I8(c,a,b))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this.w+=(a.w-this.w)*b,this}lerpVectors(a,b,c){return this.x=a.x+(b.x-a.x)*c,this.y=a.y+(b.y-a.y)*c,this.z=a.z+(b.z-a.z)*c,this.w=a.w+(b.w-a.w)*c,this}equals(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w}fromArray(a,b=0){return this.x=a[b],this.y=a[b+1],this.z=a[b+2],this.w=a[b+3],this}toArray(a=[],b=0){return a[b]=this.x,a[b+1]=this.y,a[b+2]=this.z,a[b+3]=this.w,a}fromBufferAttribute(a,b){return this.x=a.getX(b),this.y=a.getY(b),this.z=a.getZ(b),this.w=a.getW(b),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};class Jw extends I3{constructor(a=1,b=1,c={}){super(),c=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:1006,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},c),this.isRenderTarget=!0,this.width=a,this.height=b,this.depth=c.depth,this.scissor=new Jv(0,0,a,b),this.scissorTest=!1,this.viewport=new Jv(0,0,a,b);const d=new Ju({width:a,height:b,depth:c.depth});this.textures=[];const e=c.count;for(let a=0;a<e;a++)this.textures[a]=d.clone(),this.textures[a].isRenderTargetTexture=!0,this.textures[a].renderTarget=this;this._setTextureOptions(c),this.depthBuffer=c.depthBuffer,this.stencilBuffer=c.stencilBuffer,this.resolveDepthBuffer=c.resolveDepthBuffer,this.resolveStencilBuffer=c.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=c.depthTexture,this.samples=c.samples,this.multiview=c.multiview}_setTextureOptions(a={}){let b={minFilter:1006,generateMipmaps:!1,flipY:!1,internalFormat:null};void 0!==a.mapping&&(b.mapping=a.mapping),void 0!==a.wrapS&&(b.wrapS=a.wrapS),void 0!==a.wrapT&&(b.wrapT=a.wrapT),void 0!==a.wrapR&&(b.wrapR=a.wrapR),void 0!==a.magFilter&&(b.magFilter=a.magFilter),void 0!==a.minFilter&&(b.minFilter=a.minFilter),void 0!==a.format&&(b.format=a.format),void 0!==a.type&&(b.type=a.type),void 0!==a.anisotropy&&(b.anisotropy=a.anisotropy),void 0!==a.colorSpace&&(b.colorSpace=a.colorSpace),void 0!==a.flipY&&(b.flipY=a.flipY),void 0!==a.generateMipmaps&&(b.generateMipmaps=a.generateMipmaps),void 0!==a.internalFormat&&(b.internalFormat=a.internalFormat);for(let a=0;a<this.textures.length;a++)this.textures[a].setValues(b)}get texture(){return this.textures[0]}set texture(a){this.textures[0]=a}set depthTexture(a){null!==this._depthTexture&&(this._depthTexture.renderTarget=null),null!==a&&(a.renderTarget=this),this._depthTexture=a}get depthTexture(){return this._depthTexture}setSize(a,b,c=1){if(this.width!==a||this.height!==b||this.depth!==c){this.width=a,this.height=b,this.depth=c;for(let d=0,e=this.textures.length;d<e;d++)this.textures[d].image.width=a,this.textures[d].image.height=b,this.textures[d].image.depth=c,!0!==this.textures[d].isData3DTexture&&(this.textures[d].isArrayTexture=this.textures[d].image.depth>1);this.dispose()}this.viewport.set(0,0,a,b),this.scissor.set(0,0,a,b)}clone(){return new this.constructor().copy(this)}copy(a){this.width=a.width,this.height=a.height,this.depth=a.depth,this.scissor.copy(a.scissor),this.scissorTest=a.scissorTest,this.viewport.copy(a.viewport),this.textures.length=0;for(let b=0,c=a.textures.length;b<c;b++){this.textures[b]=a.textures[b].clone(),this.textures[b].isRenderTargetTexture=!0,this.textures[b].renderTarget=this;let c=Object.assign({},a.textures[b].image);this.textures[b].source=new Jq(c)}return this.depthBuffer=a.depthBuffer,this.stencilBuffer=a.stencilBuffer,this.resolveDepthBuffer=a.resolveDepthBuffer,this.resolveStencilBuffer=a.resolveStencilBuffer,null!==a.depthTexture&&(this.depthTexture=a.depthTexture.clone()),this.samples=a.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Jx extends Jw{constructor(a=1,b=1,c={}){super(a,b,c),this.isWebGLRenderTarget=!0}}class Jy extends Ju{constructor(a=null,b=1,c=1,d=1){super(null),this.isDataArrayTexture=!0,this.image={data:a,width:b,height:c,depth:d},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(a){this.layerUpdates.add(a)}clearLayerUpdates(){this.layerUpdates.clear()}}class Jz{constructor(a=new Je(1/0,1/0,1/0),b=new Je(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=a,this.max=b}set(a,b){return this.min.copy(a),this.max.copy(b),this}setFromArray(a){this.makeEmpty();for(let b=0,c=a.length;b<c;b+=3)this.expandByPoint(JB.fromArray(a,b));return this}setFromBufferAttribute(a){this.makeEmpty();for(let b=0,c=a.count;b<c;b++)this.expandByPoint(JB.fromBufferAttribute(a,b));return this}setFromPoints(a){this.makeEmpty();for(let b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this}setFromCenterAndSize(a,b){let c=JB.copy(b).multiplyScalar(.5);return this.min.copy(a).sub(c),this.max.copy(a).add(c),this}setFromObject(a,b=!1){return this.makeEmpty(),this.expandByObject(a,b)}clone(){return new this.constructor().copy(this)}copy(a){return this.min.copy(a.min),this.max.copy(a.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(a){return this.isEmpty()?a.set(0,0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(a){return this.isEmpty()?a.set(0,0,0):a.subVectors(this.max,this.min)}expandByPoint(a){return this.min.min(a),this.max.max(a),this}expandByVector(a){return this.min.sub(a),this.max.add(a),this}expandByScalar(a){return this.min.addScalar(-a),this.max.addScalar(a),this}expandByObject(a,b=!1){a.updateWorldMatrix(!1,!1);let c=a.geometry;if(void 0!==c){let d=c.getAttribute("position");if(!0===b&&void 0!==d&&!0!==a.isInstancedMesh)for(let b=0,c=d.count;b<c;b++)!0===a.isMesh?a.getVertexPosition(b,JB):JB.fromBufferAttribute(d,b),JB.applyMatrix4(a.matrixWorld),this.expandByPoint(JB);else void 0!==a.boundingBox?(null===a.boundingBox&&a.computeBoundingBox(),JC.copy(a.boundingBox)):(null===c.boundingBox&&c.computeBoundingBox(),JC.copy(c.boundingBox)),JC.applyMatrix4(a.matrixWorld),this.union(JC)}let d=a.children;for(let a=0,c=d.length;a<c;a++)this.expandByObject(d[a],b);return this}containsPoint(a){return a.x>=this.min.x&&a.x<=this.max.x&&a.y>=this.min.y&&a.y<=this.max.y&&a.z>=this.min.z&&a.z<=this.max.z}containsBox(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z}getParameter(a,b){return b.set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(a){return a.max.x>=this.min.x&&a.min.x<=this.max.x&&a.max.y>=this.min.y&&a.min.y<=this.max.y&&a.max.z>=this.min.z&&a.min.z<=this.max.z}intersectsSphere(a){return this.clampPoint(a.center,JB),JB.distanceToSquared(a.center)<=a.radius*a.radius}intersectsPlane(a){let b,c;return a.normal.x>0?(b=a.normal.x*this.min.x,c=a.normal.x*this.max.x):(b=a.normal.x*this.max.x,c=a.normal.x*this.min.x),a.normal.y>0?(b+=a.normal.y*this.min.y,c+=a.normal.y*this.max.y):(b+=a.normal.y*this.max.y,c+=a.normal.y*this.min.y),a.normal.z>0?(b+=a.normal.z*this.min.z,c+=a.normal.z*this.max.z):(b+=a.normal.z*this.max.z,c+=a.normal.z*this.min.z),b<=-a.constant&&c>=-a.constant}intersectsTriangle(a){if(this.isEmpty())return!1;this.getCenter(JJ),JK.subVectors(this.max,JJ),JD.subVectors(a.a,JJ),JE.subVectors(a.b,JJ),JF.subVectors(a.c,JJ),JG.subVectors(JE,JD),JH.subVectors(JF,JE),JI.subVectors(JD,JF);let b=[0,-JG.z,JG.y,0,-JH.z,JH.y,0,-JI.z,JI.y,JG.z,0,-JG.x,JH.z,0,-JH.x,JI.z,0,-JI.x,-JG.y,JG.x,0,-JH.y,JH.x,0,-JI.y,JI.x,0];return!!JN(b,JD,JE,JF,JK)&&!!JN(b=[1,0,0,0,1,0,0,0,1],JD,JE,JF,JK)&&(JL.crossVectors(JG,JH),JN(b=[JL.x,JL.y,JL.z],JD,JE,JF,JK))}clampPoint(a,b){return b.copy(a).clamp(this.min,this.max)}distanceToPoint(a){return this.clampPoint(a,JB).distanceTo(a)}getBoundingSphere(a){return this.isEmpty()?a.makeEmpty():(this.getCenter(a.center),a.radius=.5*this.getSize(JB).length()),a}intersect(a){return this.min.max(a.min),this.max.min(a.max),this.isEmpty()&&this.makeEmpty(),this}union(a){return this.min.min(a.min),this.max.max(a.max),this}applyMatrix4(a){return this.isEmpty()||(JA[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(a),JA[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(a),JA[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(a),JA[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(a),JA[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(a),JA[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(a),JA[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(a),JA[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(a),this.setFromPoints(JA)),this}translate(a){return this.min.add(a),this.max.add(a),this}equals(a){return a.min.equals(this.min)&&a.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(a){return this.min.fromArray(a.min),this.max.fromArray(a.max),this}}let JA=[new Je,new Je,new Je,new Je,new Je,new Je,new Je,new Je],JB=new Je,JC=new Jz,JD=new Je,JE=new Je,JF=new Je,JG=new Je,JH=new Je,JI=new Je,JJ=new Je,JK=new Je,JL=new Je,JM=new Je;function JN(a,b,c,d,e){for(let f=0,g=a.length-3;f<=g;f+=3){JM.fromArray(a,f);let g=e.x*Math.abs(JM.x)+e.y*Math.abs(JM.y)+e.z*Math.abs(JM.z),h=b.dot(JM),i=c.dot(JM),j=d.dot(JM);if(Math.max(-Math.max(h,i,j),Math.min(h,i,j))>g)return!1}return!0}let JO=new Jz,JP=new Je,JQ=new Je;class JR{constructor(a=new Je,b=-1){this.isSphere=!0,this.center=a,this.radius=b}set(a,b){return this.center.copy(a),this.radius=b,this}setFromPoints(a,b){let c=this.center;void 0!==b?c.copy(b):JO.setFromPoints(a).getCenter(c);let d=0;for(let b=0,e=a.length;b<e;b++)d=Math.max(d,c.distanceToSquared(a[b]));return this.radius=Math.sqrt(d),this}copy(a){return this.center.copy(a.center),this.radius=a.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(a){return a.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(a){return a.distanceTo(this.center)-this.radius}intersectsSphere(a){let b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b}intersectsBox(a){return a.intersectsSphere(this)}intersectsPlane(a){return Math.abs(a.distanceToPoint(this.center))<=this.radius}clampPoint(a,b){let c=this.center.distanceToSquared(a);return b.copy(a),c>this.radius*this.radius&&(b.sub(this.center).normalize(),b.multiplyScalar(this.radius).add(this.center)),b}getBoundingBox(a){return this.isEmpty()?a.makeEmpty():(a.set(this.center,this.center),a.expandByScalar(this.radius)),a}applyMatrix4(a){return this.center.applyMatrix4(a),this.radius=this.radius*a.getMaxScaleOnAxis(),this}translate(a){return this.center.add(a),this}expandByPoint(a){if(this.isEmpty())return this.center.copy(a),this.radius=0,this;JP.subVectors(a,this.center);let b=JP.lengthSq();if(b>this.radius*this.radius){let a=Math.sqrt(b),c=(a-this.radius)*.5;this.center.addScaledVector(JP,c/a),this.radius+=c}return this}union(a){return a.isEmpty()||(this.isEmpty()?this.copy(a):!0===this.center.equals(a.center)?this.radius=Math.max(this.radius,a.radius):(JQ.subVectors(a.center,this.center).setLength(a.radius),this.expandByPoint(JP.copy(a.center).add(JQ)),this.expandByPoint(JP.copy(a.center).sub(JQ)))),this}equals(a){return a.center.equals(this.center)&&a.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(a){return this.radius=a.radius,this.center.fromArray(a.center),this}}let JS=new Je,JT=new Je,JU=new Je,JV=new Je,JW=new Je,JX=new Je,JY=new Je,JZ=class a{constructor(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){a.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==b&&this.set(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q)}set(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){let q=this.elements;return q[0]=a,q[4]=b,q[8]=c,q[12]=d,q[1]=e,q[5]=f,q[9]=g,q[13]=h,q[2]=i,q[6]=j,q[10]=k,q[14]=l,q[3]=m,q[7]=n,q[11]=o,q[15]=p,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new a().fromArray(this.elements)}copy(a){let b=this.elements,c=a.elements;return b[0]=c[0],b[1]=c[1],b[2]=c[2],b[3]=c[3],b[4]=c[4],b[5]=c[5],b[6]=c[6],b[7]=c[7],b[8]=c[8],b[9]=c[9],b[10]=c[10],b[11]=c[11],b[12]=c[12],b[13]=c[13],b[14]=c[14],b[15]=c[15],this}copyPosition(a){let b=this.elements,c=a.elements;return b[12]=c[12],b[13]=c[13],b[14]=c[14],this}setFromMatrix3(a){let b=a.elements;return this.set(b[0],b[3],b[6],0,b[1],b[4],b[7],0,b[2],b[5],b[8],0,0,0,0,1),this}extractBasis(a,b,c){return a.setFromMatrixColumn(this,0),b.setFromMatrixColumn(this,1),c.setFromMatrixColumn(this,2),this}makeBasis(a,b,c){return this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1),this}extractRotation(a){let b=this.elements,c=a.elements,d=1/J$.setFromMatrixColumn(a,0).length(),e=1/J$.setFromMatrixColumn(a,1).length(),f=1/J$.setFromMatrixColumn(a,2).length();return b[0]=c[0]*d,b[1]=c[1]*d,b[2]=c[2]*d,b[3]=0,b[4]=c[4]*e,b[5]=c[5]*e,b[6]=c[6]*e,b[7]=0,b[8]=c[8]*f,b[9]=c[9]*f,b[10]=c[10]*f,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this}makeRotationFromEuler(a){let b=this.elements,c=a.x,d=a.y,e=a.z,f=Math.cos(c),g=Math.sin(c),h=Math.cos(d),i=Math.sin(d),j=Math.cos(e),k=Math.sin(e);if("XYZ"===a.order){let a=f*j,c=f*k,d=g*j,e=g*k;b[0]=h*j,b[4]=-h*k,b[8]=i,b[1]=c+d*i,b[5]=a-e*i,b[9]=-g*h,b[2]=e-a*i,b[6]=d+c*i,b[10]=f*h}else if("YXZ"===a.order){let a=h*j,c=h*k,d=i*j,e=i*k;b[0]=a+e*g,b[4]=d*g-c,b[8]=f*i,b[1]=f*k,b[5]=f*j,b[9]=-g,b[2]=c*g-d,b[6]=e+a*g,b[10]=f*h}else if("ZXY"===a.order){let a=h*j,c=h*k,d=i*j,e=i*k;b[0]=a-e*g,b[4]=-f*k,b[8]=d+c*g,b[1]=c+d*g,b[5]=f*j,b[9]=e-a*g,b[2]=-f*i,b[6]=g,b[10]=f*h}else if("ZYX"===a.order){let a=f*j,c=f*k,d=g*j,e=g*k;b[0]=h*j,b[4]=d*i-c,b[8]=a*i+e,b[1]=h*k,b[5]=e*i+a,b[9]=c*i-d,b[2]=-i,b[6]=g*h,b[10]=f*h}else if("YZX"===a.order){let a=f*h,c=f*i,d=g*h,e=g*i;b[0]=h*j,b[4]=e-a*k,b[8]=d*k+c,b[1]=k,b[5]=f*j,b[9]=-g*j,b[2]=-i*j,b[6]=c*k+d,b[10]=a-e*k}else if("XZY"===a.order){let a=f*h,c=f*i,d=g*h,e=g*i;b[0]=h*j,b[4]=-k,b[8]=i*j,b[1]=a*k+e,b[5]=f*j,b[9]=c*k-d,b[2]=d*k-c,b[6]=g*j,b[10]=e*k+a}return b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this}makeRotationFromQuaternion(a){return this.compose(J0,a,J1)}lookAt(a,b,c){let d=this.elements;return J4.subVectors(a,b),0===J4.lengthSq()&&(J4.z=1),J4.normalize(),J2.crossVectors(c,J4),0===J2.lengthSq()&&(1===Math.abs(c.z)?J4.x+=1e-4:J4.z+=1e-4,J4.normalize(),J2.crossVectors(c,J4)),J2.normalize(),J3.crossVectors(J4,J2),d[0]=J2.x,d[4]=J3.x,d[8]=J4.x,d[1]=J2.y,d[5]=J3.y,d[9]=J4.y,d[2]=J2.z,d[6]=J3.z,d[10]=J4.z,this}multiply(a){return this.multiplyMatrices(this,a)}premultiply(a){return this.multiplyMatrices(a,this)}multiplyMatrices(a,b){let c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],i=c[12],j=c[1],k=c[5],l=c[9],m=c[13],n=c[2],o=c[6],p=c[10],q=c[14],r=c[3],s=c[7],t=c[11],u=c[15],v=d[0],w=d[4],x=d[8],y=d[12],z=d[1],A=d[5],B=d[9],C=d[13],D=d[2],E=d[6],F=d[10],G=d[14],H=d[3],I=d[7],J=d[11],K=d[15];return e[0]=f*v+g*z+h*D+i*H,e[4]=f*w+g*A+h*E+i*I,e[8]=f*x+g*B+h*F+i*J,e[12]=f*y+g*C+h*G+i*K,e[1]=j*v+k*z+l*D+m*H,e[5]=j*w+k*A+l*E+m*I,e[9]=j*x+k*B+l*F+m*J,e[13]=j*y+k*C+l*G+m*K,e[2]=n*v+o*z+p*D+q*H,e[6]=n*w+o*A+p*E+q*I,e[10]=n*x+o*B+p*F+q*J,e[14]=n*y+o*C+p*G+q*K,e[3]=r*v+s*z+t*D+u*H,e[7]=r*w+s*A+t*E+u*I,e[11]=r*x+s*B+t*F+u*J,e[15]=r*y+s*C+t*G+u*K,this}multiplyScalar(a){let b=this.elements;return b[0]*=a,b[4]*=a,b[8]*=a,b[12]*=a,b[1]*=a,b[5]*=a,b[9]*=a,b[13]*=a,b[2]*=a,b[6]*=a,b[10]*=a,b[14]*=a,b[3]*=a,b[7]*=a,b[11]*=a,b[15]*=a,this}determinant(){let a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],i=a[13],j=a[2],k=a[6],l=a[10],m=a[14];return a[3]*(e*h*k-d*i*k-e*g*l+c*i*l+d*g*m-c*h*m)+a[7]*(b*h*m-b*i*l+e*f*l-d*f*m+d*i*j-e*h*j)+a[11]*(b*i*k-b*g*m-e*f*k+c*f*m+e*g*j-c*i*j)+a[15]*(-d*g*j-b*h*k+b*g*l+d*f*k-c*f*l+c*h*j)}transpose(){let a,b=this.elements;return a=b[1],b[1]=b[4],b[4]=a,a=b[2],b[2]=b[8],b[8]=a,a=b[6],b[6]=b[9],b[9]=a,a=b[3],b[3]=b[12],b[12]=a,a=b[7],b[7]=b[13],b[13]=a,a=b[11],b[11]=b[14],b[14]=a,this}setPosition(a,b,c){let d=this.elements;return a.isVector3?(d[12]=a.x,d[13]=a.y,d[14]=a.z):(d[12]=a,d[13]=b,d[14]=c),this}invert(){let a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=k*p*i-o*l*i+o*h*m-g*p*m-k*h*q+g*l*q,s=n*l*i-j*p*i-n*h*m+f*p*m+j*h*q-f*l*q,t=j*o*i-n*k*i+n*g*m-f*o*m-j*g*q+f*k*q,u=n*k*h-j*o*h-n*g*l+f*o*l+j*g*p-f*k*p,v=b*r+c*s+d*t+e*u;if(0===v)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let w=1/v;return a[0]=r*w,a[1]=(o*l*e-k*p*e-o*d*m+c*p*m+k*d*q-c*l*q)*w,a[2]=(g*p*e-o*h*e+o*d*i-c*p*i-g*d*q+c*h*q)*w,a[3]=(k*h*e-g*l*e-k*d*i+c*l*i+g*d*m-c*h*m)*w,a[4]=s*w,a[5]=(j*p*e-n*l*e+n*d*m-b*p*m-j*d*q+b*l*q)*w,a[6]=(n*h*e-f*p*e-n*d*i+b*p*i+f*d*q-b*h*q)*w,a[7]=(f*l*e-j*h*e+j*d*i-b*l*i-f*d*m+b*h*m)*w,a[8]=t*w,a[9]=(n*k*e-j*o*e-n*c*m+b*o*m+j*c*q-b*k*q)*w,a[10]=(f*o*e-n*g*e+n*c*i-b*o*i-f*c*q+b*g*q)*w,a[11]=(j*g*e-f*k*e-j*c*i+b*k*i+f*c*m-b*g*m)*w,a[12]=u*w,a[13]=(j*o*d-n*k*d+n*c*l-b*o*l-j*c*p+b*k*p)*w,a[14]=(n*g*d-f*o*d-n*c*h+b*o*h+f*c*p-b*g*p)*w,a[15]=(f*k*d-j*g*d+j*c*h-b*k*h-f*c*l+b*g*l)*w,this}scale(a){let b=this.elements,c=a.x,d=a.y,e=a.z;return b[0]*=c,b[4]*=d,b[8]*=e,b[1]*=c,b[5]*=d,b[9]*=e,b[2]*=c,b[6]*=d,b[10]*=e,b[3]*=c,b[7]*=d,b[11]*=e,this}getMaxScaleOnAxis(){let a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))}makeTranslation(a,b,c){return a.isVector3?this.set(1,0,0,a.x,0,1,0,a.y,0,0,1,a.z,0,0,0,1):this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1),this}makeRotationX(a){let b=Math.cos(a),c=Math.sin(a);return this.set(1,0,0,0,0,b,-c,0,0,c,b,0,0,0,0,1),this}makeRotationY(a){let b=Math.cos(a),c=Math.sin(a);return this.set(b,0,c,0,0,1,0,0,-c,0,b,0,0,0,0,1),this}makeRotationZ(a){let b=Math.cos(a),c=Math.sin(a);return this.set(b,-c,0,0,c,b,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(a,b){let c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,g=a.y,h=a.z,i=e*f,j=e*g;return this.set(i*f+c,i*g-d*h,i*h+d*g,0,i*g+d*h,j*g+c,j*h-d*f,0,i*h-d*g,j*h+d*f,e*h*h+c,0,0,0,0,1),this}makeScale(a,b,c){return this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1),this}makeShear(a,b,c,d,e,f){return this.set(1,c,e,0,a,1,f,0,b,d,1,0,0,0,0,1),this}compose(a,b,c){let d=this.elements,e=b._x,f=b._y,g=b._z,h=b._w,i=e+e,j=f+f,k=g+g,l=e*i,m=e*j,n=e*k,o=f*j,p=f*k,q=g*k,r=h*i,s=h*j,t=h*k,u=c.x,v=c.y,w=c.z;return d[0]=(1-(o+q))*u,d[1]=(m+t)*u,d[2]=(n-s)*u,d[3]=0,d[4]=(m-t)*v,d[5]=(1-(l+q))*v,d[6]=(p+r)*v,d[7]=0,d[8]=(n+s)*w,d[9]=(p-r)*w,d[10]=(1-(l+o))*w,d[11]=0,d[12]=a.x,d[13]=a.y,d[14]=a.z,d[15]=1,this}decompose(a,b,c){let d=this.elements,e=J$.set(d[0],d[1],d[2]).length(),f=J$.set(d[4],d[5],d[6]).length(),g=J$.set(d[8],d[9],d[10]).length();0>this.determinant()&&(e=-e),a.x=d[12],a.y=d[13],a.z=d[14],J_.copy(this);let h=1/e,i=1/f,j=1/g;return J_.elements[0]*=h,J_.elements[1]*=h,J_.elements[2]*=h,J_.elements[4]*=i,J_.elements[5]*=i,J_.elements[6]*=i,J_.elements[8]*=j,J_.elements[9]*=j,J_.elements[10]*=j,b.setFromRotationMatrix(J_),c.x=e,c.y=f,c.z=g,this}makePerspective(a,b,c,d,e,f,g=2e3,h=!1){let i,j,k=this.elements;if(h)i=e/(f-e),j=f*e/(f-e);else if(2e3===g)i=-(f+e)/(f-e),j=-2*f*e/(f-e);else if(2001===g)i=-f/(f-e),j=-f*e/(f-e);else throw Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+g);return k[0]=2*e/(b-a),k[4]=0,k[8]=(b+a)/(b-a),k[12]=0,k[1]=0,k[5]=2*e/(c-d),k[9]=(c+d)/(c-d),k[13]=0,k[2]=0,k[6]=0,k[10]=i,k[14]=j,k[3]=0,k[7]=0,k[11]=-1,k[15]=0,this}makeOrthographic(a,b,c,d,e,f,g=2e3,h=!1){let i,j,k=this.elements;if(h)i=1/(f-e),j=f/(f-e);else if(2e3===g)i=-2/(f-e),j=-(f+e)/(f-e);else if(2001===g)i=-1/(f-e),j=-e/(f-e);else throw Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+g);return k[0]=2/(b-a),k[4]=0,k[8]=0,k[12]=-(b+a)/(b-a),k[1]=0,k[5]=2/(c-d),k[9]=0,k[13]=-(c+d)/(c-d),k[2]=0,k[6]=0,k[10]=i,k[14]=j,k[3]=0,k[7]=0,k[11]=0,k[15]=1,this}equals(a){let b=this.elements,c=a.elements;for(let a=0;a<16;a++)if(b[a]!==c[a])return!1;return!0}fromArray(a,b=0){for(let c=0;c<16;c++)this.elements[c]=a[c+b];return this}toArray(a=[],b=0){let c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a[b+9]=c[9],a[b+10]=c[10],a[b+11]=c[11],a[b+12]=c[12],a[b+13]=c[13],a[b+14]=c[14],a[b+15]=c[15],a}},J$=new Je,J_=new JZ,J0=new Je(0,0,0),J1=new Je(1,1,1),J2=new Je,J3=new Je,J4=new Je,J5=new JZ,J6=new Jd;class J7{constructor(a=0,b=0,c=0,d=J7.DEFAULT_ORDER){this.isEuler=!0,this._x=a,this._y=b,this._z=c,this._order=d}get x(){return this._x}set x(a){this._x=a,this._onChangeCallback()}get y(){return this._y}set y(a){this._y=a,this._onChangeCallback()}get z(){return this._z}set z(a){this._z=a,this._onChangeCallback()}get order(){return this._order}set order(a){this._order=a,this._onChangeCallback()}set(a,b,c,d=this._order){return this._x=a,this._y=b,this._z=c,this._order=d,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(a){return this._x=a._x,this._y=a._y,this._z=a._z,this._order=a._order,this._onChangeCallback(),this}setFromRotationMatrix(a,b=this._order,c=!0){let d=a.elements,e=d[0],f=d[4],g=d[8],h=d[1],i=d[5],j=d[9],k=d[2],l=d[6],m=d[10];switch(b){case"XYZ":this._y=Math.asin(I8(g,-1,1)),.9999999>Math.abs(g)?(this._x=Math.atan2(-j,m),this._z=Math.atan2(-f,e)):(this._x=Math.atan2(l,i),this._z=0);break;case"YXZ":this._x=Math.asin(-I8(j,-1,1)),.9999999>Math.abs(j)?(this._y=Math.atan2(g,m),this._z=Math.atan2(h,i)):(this._y=Math.atan2(-k,e),this._z=0);break;case"ZXY":this._x=Math.asin(I8(l,-1,1)),.9999999>Math.abs(l)?(this._y=Math.atan2(-k,m),this._z=Math.atan2(-f,i)):(this._y=0,this._z=Math.atan2(h,e));break;case"ZYX":this._y=Math.asin(-I8(k,-1,1)),.9999999>Math.abs(k)?(this._x=Math.atan2(l,m),this._z=Math.atan2(h,e)):(this._x=0,this._z=Math.atan2(-f,i));break;case"YZX":this._z=Math.asin(I8(h,-1,1)),.9999999>Math.abs(h)?(this._x=Math.atan2(-j,i),this._y=Math.atan2(-k,e)):(this._x=0,this._y=Math.atan2(g,m));break;case"XZY":this._z=Math.asin(-I8(f,-1,1)),.9999999>Math.abs(f)?(this._x=Math.atan2(l,i),this._y=Math.atan2(g,e)):(this._x=Math.atan2(-j,m),this._y=0);break;default:I0("Euler: .setFromRotationMatrix() encountered an unknown order: "+b)}return this._order=b,!0===c&&this._onChangeCallback(),this}setFromQuaternion(a,b,c){return J5.makeRotationFromQuaternion(a),this.setFromRotationMatrix(J5,b,c)}setFromVector3(a,b=this._order){return this.set(a.x,a.y,a.z,b)}reorder(a){return J6.setFromEuler(this),this.setFromQuaternion(J6,a)}equals(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order}fromArray(a){return this._x=a[0],this._y=a[1],this._z=a[2],void 0!==a[3]&&(this._order=a[3]),this._onChangeCallback(),this}toArray(a=[],b=0){return a[b]=this._x,a[b+1]=this._y,a[b+2]=this._z,a[b+3]=this._order,a}_onChange(a){return this._onChangeCallback=a,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}J7.DEFAULT_ORDER="XYZ";class J8{constructor(){this.mask=1}set(a){this.mask=1<<a>>>0}enable(a){this.mask|=1<<a}enableAll(){this.mask=-1}toggle(a){this.mask^=1<<a}disable(a){this.mask&=~(1<<a)}disableAll(){this.mask=0}test(a){return(this.mask&a.mask)!=0}isEnabled(a){return(this.mask&1<<a)!=0}}let J9=0,Ka=new Je,Kb=new Jd,Kc=new JZ,Kd=new Je,Ke=new Je,Kf=new Je,Kg=new Jd,Kh=new Je(1,0,0),Ki=new Je(0,1,0),Kj=new Je(0,0,1),Kk={type:"added"},Kl={type:"removed"},Km={type:"childadded",child:null},Kn={type:"childremoved",child:null};class Ko extends I3{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:J9++}),this.uuid=I7(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ko.DEFAULT_UP.clone();const a=new Je,b=new J7,c=new Jd,d=new Je(1,1,1);b._onChange(function(){c.setFromEuler(b,!1)}),c._onChange(function(){b.setFromQuaternion(c,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:a},rotation:{configurable:!0,enumerable:!0,value:b},quaternion:{configurable:!0,enumerable:!0,value:c},scale:{configurable:!0,enumerable:!0,value:d},modelViewMatrix:{value:new JZ},normalMatrix:{value:new Jh}}),this.matrix=new JZ,this.matrixWorld=new JZ,this.matrixAutoUpdate=Ko.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Ko.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new J8,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(a){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(a),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(a){return this.quaternion.premultiply(a),this}setRotationFromAxisAngle(a,b){this.quaternion.setFromAxisAngle(a,b)}setRotationFromEuler(a){this.quaternion.setFromEuler(a,!0)}setRotationFromMatrix(a){this.quaternion.setFromRotationMatrix(a)}setRotationFromQuaternion(a){this.quaternion.copy(a)}rotateOnAxis(a,b){return Kb.setFromAxisAngle(a,b),this.quaternion.multiply(Kb),this}rotateOnWorldAxis(a,b){return Kb.setFromAxisAngle(a,b),this.quaternion.premultiply(Kb),this}rotateX(a){return this.rotateOnAxis(Kh,a)}rotateY(a){return this.rotateOnAxis(Ki,a)}rotateZ(a){return this.rotateOnAxis(Kj,a)}translateOnAxis(a,b){return Ka.copy(a).applyQuaternion(this.quaternion),this.position.add(Ka.multiplyScalar(b)),this}translateX(a){return this.translateOnAxis(Kh,a)}translateY(a){return this.translateOnAxis(Ki,a)}translateZ(a){return this.translateOnAxis(Kj,a)}localToWorld(a){return this.updateWorldMatrix(!0,!1),a.applyMatrix4(this.matrixWorld)}worldToLocal(a){return this.updateWorldMatrix(!0,!1),a.applyMatrix4(Kc.copy(this.matrixWorld).invert())}lookAt(a,b,c){a.isVector3?Kd.copy(a):Kd.set(a,b,c);let d=this.parent;this.updateWorldMatrix(!0,!1),Ke.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Kc.lookAt(Ke,Kd,this.up):Kc.lookAt(Kd,Ke,this.up),this.quaternion.setFromRotationMatrix(Kc),d&&(Kc.extractRotation(d.matrixWorld),Kb.setFromRotationMatrix(Kc),this.quaternion.premultiply(Kb.invert()))}add(a){if(arguments.length>1){for(let a=0;a<arguments.length;a++)this.add(arguments[a]);return this}return a===this?I1("Object3D.add: object can't be added as a child of itself.",a):a&&a.isObject3D?(a.removeFromParent(),a.parent=this,this.children.push(a),a.dispatchEvent(Kk),Km.child=a,this.dispatchEvent(Km),Km.child=null):I1("Object3D.add: object not an instance of THREE.Object3D.",a),this}remove(a){if(arguments.length>1){for(let a=0;a<arguments.length;a++)this.remove(arguments[a]);return this}let b=this.children.indexOf(a);return -1!==b&&(a.parent=null,this.children.splice(b,1),a.dispatchEvent(Kl),Kn.child=a,this.dispatchEvent(Kn),Kn.child=null),this}removeFromParent(){let a=this.parent;return null!==a&&a.remove(this),this}clear(){return this.remove(...this.children)}attach(a){return this.updateWorldMatrix(!0,!1),Kc.copy(this.matrixWorld).invert(),null!==a.parent&&(a.parent.updateWorldMatrix(!0,!1),Kc.multiply(a.parent.matrixWorld)),a.applyMatrix4(Kc),a.removeFromParent(),a.parent=this,this.children.push(a),a.updateWorldMatrix(!1,!0),a.dispatchEvent(Kk),Km.child=a,this.dispatchEvent(Km),Km.child=null,this}getObjectById(a){return this.getObjectByProperty("id",a)}getObjectByName(a){return this.getObjectByProperty("name",a)}getObjectByProperty(a,b){if(this[a]===b)return this;for(let c=0,d=this.children.length;c<d;c++){let d=this.children[c].getObjectByProperty(a,b);if(void 0!==d)return d}}getObjectsByProperty(a,b,c=[]){this[a]===b&&c.push(this);let d=this.children;for(let e=0,f=d.length;e<f;e++)d[e].getObjectsByProperty(a,b,c);return c}getWorldPosition(a){return this.updateWorldMatrix(!0,!1),a.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(a){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ke,a,Kf),a}getWorldScale(a){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ke,Kg,a),a}getWorldDirection(a){this.updateWorldMatrix(!0,!1);let b=this.matrixWorld.elements;return a.set(b[8],b[9],b[10]).normalize()}raycast(){}traverse(a){a(this);let b=this.children;for(let c=0,d=b.length;c<d;c++)b[c].traverse(a)}traverseVisible(a){if(!1===this.visible)return;a(this);let b=this.children;for(let c=0,d=b.length;c<d;c++)b[c].traverseVisible(a)}traverseAncestors(a){let b=this.parent;null!==b&&(a(b),b.traverseAncestors(a))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(a){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||a)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,a=!0);let b=this.children;for(let c=0,d=b.length;c<d;c++)b[c].updateMatrixWorld(a)}updateWorldMatrix(a,b){let c=this.parent;if(!0===a&&null!==c&&c.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===b){let a=this.children;for(let b=0,c=a.length;b<c;b++)a[b].updateWorldMatrix(!1,!0)}}toJSON(a){let b=void 0===a||"string"==typeof a,c={};b&&(a={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},c.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});let d={};function e(b,c){return void 0===b[c.uuid]&&(b[c.uuid]=c.toJSON(a)),c.uuid}if(d.uuid=this.uuid,d.type=this.type,""!==this.name&&(d.name=this.name),!0===this.castShadow&&(d.castShadow=!0),!0===this.receiveShadow&&(d.receiveShadow=!0),!1===this.visible&&(d.visible=!1),!1===this.frustumCulled&&(d.frustumCulled=!1),0!==this.renderOrder&&(d.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(d.userData=this.userData),d.layers=this.layers.mask,d.matrix=this.matrix.toArray(),d.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(d.matrixAutoUpdate=!1),this.isInstancedMesh&&(d.type="InstancedMesh",d.count=this.count,d.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(d.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(d.type="BatchedMesh",d.perObjectFrustumCulled=this.perObjectFrustumCulled,d.sortObjects=this.sortObjects,d.drawRanges=this._drawRanges,d.reservedRanges=this._reservedRanges,d.geometryInfo=this._geometryInfo.map(a=>({...a,boundingBox:a.boundingBox?a.boundingBox.toJSON():void 0,boundingSphere:a.boundingSphere?a.boundingSphere.toJSON():void 0})),d.instanceInfo=this._instanceInfo.map(a=>({...a})),d.availableInstanceIds=this._availableInstanceIds.slice(),d.availableGeometryIds=this._availableGeometryIds.slice(),d.nextIndexStart=this._nextIndexStart,d.nextVertexStart=this._nextVertexStart,d.geometryCount=this._geometryCount,d.maxInstanceCount=this._maxInstanceCount,d.maxVertexCount=this._maxVertexCount,d.maxIndexCount=this._maxIndexCount,d.geometryInitialized=this._geometryInitialized,d.matricesTexture=this._matricesTexture.toJSON(a),d.indirectTexture=this._indirectTexture.toJSON(a),null!==this._colorsTexture&&(d.colorsTexture=this._colorsTexture.toJSON(a)),null!==this.boundingSphere&&(d.boundingSphere=this.boundingSphere.toJSON()),null!==this.boundingBox&&(d.boundingBox=this.boundingBox.toJSON())),this.isScene)this.background&&(this.background.isColor?d.background=this.background.toJSON():this.background.isTexture&&(d.background=this.background.toJSON(a).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(d.environment=this.environment.toJSON(a).uuid);else if(this.isMesh||this.isLine||this.isPoints){d.geometry=e(a.geometries,this.geometry);let b=this.geometry.parameters;if(void 0!==b&&void 0!==b.shapes){let c=b.shapes;if(Array.isArray(c))for(let b=0,d=c.length;b<d;b++){let d=c[b];e(a.shapes,d)}else e(a.shapes,c)}}if(this.isSkinnedMesh&&(d.bindMode=this.bindMode,d.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(e(a.skeletons,this.skeleton),d.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){let b=[];for(let c=0,d=this.material.length;c<d;c++)b.push(e(a.materials,this.material[c]));d.material=b}else d.material=e(a.materials,this.material);if(this.children.length>0){d.children=[];for(let b=0;b<this.children.length;b++)d.children.push(this.children[b].toJSON(a).object)}if(this.animations.length>0){d.animations=[];for(let b=0;b<this.animations.length;b++){let c=this.animations[b];d.animations.push(e(a.animations,c))}}if(b){let b=f(a.geometries),d=f(a.materials),e=f(a.textures),g=f(a.images),h=f(a.shapes),i=f(a.skeletons),j=f(a.animations),k=f(a.nodes);b.length>0&&(c.geometries=b),d.length>0&&(c.materials=d),e.length>0&&(c.textures=e),g.length>0&&(c.images=g),h.length>0&&(c.shapes=h),i.length>0&&(c.skeletons=i),j.length>0&&(c.animations=j),k.length>0&&(c.nodes=k)}return c.object=d,c;function f(a){let b=[];for(let c in a){let d=a[c];delete d.metadata,b.push(d)}return b}}clone(a){return new this.constructor().copy(this,a)}copy(a,b=!0){if(this.name=a.name,this.up.copy(a.up),this.position.copy(a.position),this.rotation.order=a.rotation.order,this.quaternion.copy(a.quaternion),this.scale.copy(a.scale),this.matrix.copy(a.matrix),this.matrixWorld.copy(a.matrixWorld),this.matrixAutoUpdate=a.matrixAutoUpdate,this.matrixWorldAutoUpdate=a.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate,this.layers.mask=a.layers.mask,this.visible=a.visible,this.castShadow=a.castShadow,this.receiveShadow=a.receiveShadow,this.frustumCulled=a.frustumCulled,this.renderOrder=a.renderOrder,this.animations=a.animations.slice(),this.userData=JSON.parse(JSON.stringify(a.userData)),!0===b)for(let b=0;b<a.children.length;b++){let c=a.children[b];this.add(c.clone())}return this}}Ko.DEFAULT_UP=new Je(0,1,0),Ko.DEFAULT_MATRIX_AUTO_UPDATE=!0,Ko.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;let Kp=new Je,Kq=new Je,Kr=new Je,Ks=new Je,Kt=new Je,Ku=new Je,Kv=new Je,Kw=new Je,Kx=new Je,Ky=new Je,Kz=new Jv,KA=new Jv,KB=new Jv;class KC{constructor(a=new Je,b=new Je,c=new Je){this.a=a,this.b=b,this.c=c}static getNormal(a,b,c,d){d.subVectors(c,b),Kp.subVectors(a,b),d.cross(Kp);let e=d.lengthSq();return e>0?d.multiplyScalar(1/Math.sqrt(e)):d.set(0,0,0)}static getBarycoord(a,b,c,d,e){Kp.subVectors(d,b),Kq.subVectors(c,b),Kr.subVectors(a,b);let f=Kp.dot(Kp),g=Kp.dot(Kq),h=Kp.dot(Kr),i=Kq.dot(Kq),j=Kq.dot(Kr),k=f*i-g*g;if(0===k)return e.set(0,0,0),null;let l=1/k,m=(i*h-g*j)*l,n=(f*j-g*h)*l;return e.set(1-m-n,n,m)}static containsPoint(a,b,c,d){return null!==this.getBarycoord(a,b,c,d,Ks)&&Ks.x>=0&&Ks.y>=0&&Ks.x+Ks.y<=1}static getInterpolation(a,b,c,d,e,f,g,h){return null===this.getBarycoord(a,b,c,d,Ks)?(h.x=0,h.y=0,"z"in h&&(h.z=0),"w"in h&&(h.w=0),null):(h.setScalar(0),h.addScaledVector(e,Ks.x),h.addScaledVector(f,Ks.y),h.addScaledVector(g,Ks.z),h)}static getInterpolatedAttribute(a,b,c,d,e,f){return Kz.setScalar(0),KA.setScalar(0),KB.setScalar(0),Kz.fromBufferAttribute(a,b),KA.fromBufferAttribute(a,c),KB.fromBufferAttribute(a,d),f.setScalar(0),f.addScaledVector(Kz,e.x),f.addScaledVector(KA,e.y),f.addScaledVector(KB,e.z),f}static isFrontFacing(a,b,c,d){return Kp.subVectors(c,b),Kq.subVectors(a,b),0>Kp.cross(Kq).dot(d)}set(a,b,c){return this.a.copy(a),this.b.copy(b),this.c.copy(c),this}setFromPointsAndIndices(a,b,c,d){return this.a.copy(a[b]),this.b.copy(a[c]),this.c.copy(a[d]),this}setFromAttributeAndIndices(a,b,c,d){return this.a.fromBufferAttribute(a,b),this.b.fromBufferAttribute(a,c),this.c.fromBufferAttribute(a,d),this}clone(){return new this.constructor().copy(this)}copy(a){return this.a.copy(a.a),this.b.copy(a.b),this.c.copy(a.c),this}getArea(){return Kp.subVectors(this.c,this.b),Kq.subVectors(this.a,this.b),.5*Kp.cross(Kq).length()}getMidpoint(a){return a.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(a){return KC.getNormal(this.a,this.b,this.c,a)}getPlane(a){return a.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(a,b){return KC.getBarycoord(a,this.a,this.b,this.c,b)}getInterpolation(a,b,c,d,e){return KC.getInterpolation(a,this.a,this.b,this.c,b,c,d,e)}containsPoint(a){return KC.containsPoint(a,this.a,this.b,this.c)}isFrontFacing(a){return KC.isFrontFacing(this.a,this.b,this.c,a)}intersectsBox(a){return a.intersectsTriangle(this)}closestPointToPoint(a,b){let c,d,e=this.a,f=this.b,g=this.c;Kt.subVectors(f,e),Ku.subVectors(g,e),Kw.subVectors(a,e);let h=Kt.dot(Kw),i=Ku.dot(Kw);if(h<=0&&i<=0)return b.copy(e);Kx.subVectors(a,f);let j=Kt.dot(Kx),k=Ku.dot(Kx);if(j>=0&&k<=j)return b.copy(f);let l=h*k-j*i;if(l<=0&&h>=0&&j<=0)return c=h/(h-j),b.copy(e).addScaledVector(Kt,c);Ky.subVectors(a,g);let m=Kt.dot(Ky),n=Ku.dot(Ky);if(n>=0&&m<=n)return b.copy(g);let o=m*i-h*n;if(o<=0&&i>=0&&n<=0)return d=i/(i-n),b.copy(e).addScaledVector(Ku,d);let p=j*n-m*k;if(p<=0&&k-j>=0&&m-n>=0)return Kv.subVectors(g,f),d=(k-j)/(k-j+(m-n)),b.copy(f).addScaledVector(Kv,d);let q=1/(p+o+l);return c=o*q,d=l*q,b.copy(e).addScaledVector(Kt,c).addScaledVector(Ku,d)}equals(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}}let KD={aliceblue:0xf0f8ff,antiquewhite:0xfaebd7,aqua:65535,aquamarine:8388564,azure:0xf0ffff,beige:0xf5f5dc,bisque:0xffe4c4,black:0,blanchedalmond:0xffebcd,blue:255,blueviolet:9055202,brown:0xa52a2a,burlywood:0xdeb887,cadetblue:6266528,chartreuse:8388352,chocolate:0xd2691e,coral:0xff7f50,cornflowerblue:6591981,cornsilk:0xfff8dc,crimson:0xdc143c,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:0xb8860b,darkgray:0xa9a9a9,darkgreen:25600,darkgrey:0xa9a9a9,darkkhaki:0xbdb76b,darkmagenta:9109643,darkolivegreen:5597999,darkorange:0xff8c00,darkorchid:0x9932cc,darkred:9109504,darksalmon:0xe9967a,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:0xff1493,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:0xb22222,floralwhite:0xfffaf0,forestgreen:2263842,fuchsia:0xff00ff,gainsboro:0xdcdcdc,ghostwhite:0xf8f8ff,gold:0xffd700,goldenrod:0xdaa520,gray:8421504,green:32768,greenyellow:0xadff2f,grey:8421504,honeydew:0xf0fff0,hotpink:0xff69b4,indianred:0xcd5c5c,indigo:4915330,ivory:0xfffff0,khaki:0xf0e68c,lavender:0xe6e6fa,lavenderblush:0xfff0f5,lawngreen:8190976,lemonchiffon:0xfffacd,lightblue:0xadd8e6,lightcoral:0xf08080,lightcyan:0xe0ffff,lightgoldenrodyellow:0xfafad2,lightgray:0xd3d3d3,lightgreen:9498256,lightgrey:0xd3d3d3,lightpink:0xffb6c1,lightsalmon:0xffa07a,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:0xb0c4de,lightyellow:0xffffe0,lime:65280,limegreen:3329330,linen:0xfaf0e6,magenta:0xff00ff,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:0xba55d3,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:0xc71585,midnightblue:1644912,mintcream:0xf5fffa,mistyrose:0xffe4e1,moccasin:0xffe4b5,navajowhite:0xffdead,navy:128,oldlace:0xfdf5e6,olive:8421376,olivedrab:7048739,orange:0xffa500,orangered:0xff4500,orchid:0xda70d6,palegoldenrod:0xeee8aa,palegreen:0x98fb98,paleturquoise:0xafeeee,palevioletred:0xdb7093,papayawhip:0xffefd5,peachpuff:0xffdab9,peru:0xcd853f,pink:0xffc0cb,plum:0xdda0dd,powderblue:0xb0e0e6,purple:8388736,rebeccapurple:6697881,red:0xff0000,rosybrown:0xbc8f8f,royalblue:4286945,saddlebrown:9127187,salmon:0xfa8072,sandybrown:0xf4a460,seagreen:3050327,seashell:0xfff5ee,sienna:0xa0522d,silver:0xc0c0c0,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:0xfffafa,springgreen:65407,steelblue:4620980,tan:0xd2b48c,teal:32896,thistle:0xd8bfd8,tomato:0xff6347,turquoise:4251856,violet:0xee82ee,wheat:0xf5deb3,white:0xffffff,whitesmoke:0xf5f5f5,yellow:0xffff00,yellowgreen:0x9acd32},KE={h:0,s:0,l:0},KF={h:0,s:0,l:0};function KG(a,b,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?a+(b-a)*6*c:c<.5?b:c<2/3?a+(b-a)*6*(2/3-c):a}let KH=class{constructor(a,b,c){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(a,b,c)}set(a,b,c){return void 0===b&&void 0===c?a&&a.isColor?this.copy(a):"number"==typeof a?this.setHex(a):"string"==typeof a&&this.setStyle(a):this.setRGB(a,b,c),this}setScalar(a){return this.r=a,this.g=a,this.b=a,this}setHex(a,b=IT){return a=Math.floor(a),this.r=(a>>16&255)/255,this.g=(a>>8&255)/255,this.b=(255&a)/255,Jl.colorSpaceToWorking(this,b),this}setRGB(a,b,c,d=Jl.workingColorSpace){return this.r=a,this.g=b,this.b=c,Jl.colorSpaceToWorking(this,d),this}setHSL(a,b,c,d=Jl.workingColorSpace){var e;if(e=1,a=(a%1+1)%1,b=I8(b,0,1),c=I8(c,0,1),0===b)this.r=this.g=this.b=c;else{let d=c<=.5?c*(1+b):c+b-c*b,e=2*c-d;this.r=KG(e,d,a+1/3),this.g=KG(e,d,a),this.b=KG(e,d,a-1/3)}return Jl.colorSpaceToWorking(this,d),this}setStyle(a,b=IT){let c;function d(b){void 0!==b&&1>parseFloat(b)&&I0("Color: Alpha component of "+a+" will be ignored.")}if(c=/^(\w+)\(([^\)]*)\)/.exec(a)){let e,f=c[1],g=c[2];switch(f){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(g))return d(e[4]),this.setRGB(Math.min(255,parseInt(e[1],10))/255,Math.min(255,parseInt(e[2],10))/255,Math.min(255,parseInt(e[3],10))/255,b);if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(g))return d(e[4]),this.setRGB(Math.min(100,parseInt(e[1],10))/100,Math.min(100,parseInt(e[2],10))/100,Math.min(100,parseInt(e[3],10))/100,b);break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(g))return d(e[4]),this.setHSL(parseFloat(e[1])/360,parseFloat(e[2])/100,parseFloat(e[3])/100,b);break;default:I0("Color: Unknown color model "+a)}}else if(c=/^\#([A-Fa-f\d]+)$/.exec(a)){let d=c[1],e=d.length;if(3===e)return this.setRGB(parseInt(d.charAt(0),16)/15,parseInt(d.charAt(1),16)/15,parseInt(d.charAt(2),16)/15,b);if(6===e)return this.setHex(parseInt(d,16),b);I0("Color: Invalid hex color "+a)}else if(a&&a.length>0)return this.setColorName(a,b);return this}setColorName(a,b=IT){let c=KD[a.toLowerCase()];return void 0!==c?this.setHex(c,b):I0("Color: Unknown color "+a),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(a){return this.r=a.r,this.g=a.g,this.b=a.b,this}copySRGBToLinear(a){return this.r=Jm(a.r),this.g=Jm(a.g),this.b=Jm(a.b),this}copyLinearToSRGB(a){return this.r=Jn(a.r),this.g=Jn(a.g),this.b=Jn(a.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(a=IT){return Jl.workingToColorSpace(KI.copy(this),a),65536*Math.round(I8(255*KI.r,0,255))+256*Math.round(I8(255*KI.g,0,255))+Math.round(I8(255*KI.b,0,255))}getHexString(a=IT){return("000000"+this.getHex(a).toString(16)).slice(-6)}getHSL(a,b=Jl.workingColorSpace){let c,d;Jl.workingToColorSpace(KI.copy(this),b);let e=KI.r,f=KI.g,g=KI.b,h=Math.max(e,f,g),i=Math.min(e,f,g),j=(i+h)/2;if(i===h)c=0,d=0;else{let a=h-i;switch(d=j<=.5?a/(h+i):a/(2-h-i),h){case e:c=(f-g)/a+6*(f<g);break;case f:c=(g-e)/a+2;break;case g:c=(e-f)/a+4}c/=6}return a.h=c,a.s=d,a.l=j,a}getRGB(a,b=Jl.workingColorSpace){return Jl.workingToColorSpace(KI.copy(this),b),a.r=KI.r,a.g=KI.g,a.b=KI.b,a}getStyle(a=IT){Jl.workingToColorSpace(KI.copy(this),a);let b=KI.r,c=KI.g,d=KI.b;return a!==IT?`color(${a} ${b.toFixed(3)} ${c.toFixed(3)} ${d.toFixed(3)})`:`rgb(${Math.round(255*b)},${Math.round(255*c)},${Math.round(255*d)})`}offsetHSL(a,b,c){return this.getHSL(KE),this.setHSL(KE.h+a,KE.s+b,KE.l+c)}add(a){return this.r+=a.r,this.g+=a.g,this.b+=a.b,this}addColors(a,b){return this.r=a.r+b.r,this.g=a.g+b.g,this.b=a.b+b.b,this}addScalar(a){return this.r+=a,this.g+=a,this.b+=a,this}sub(a){return this.r=Math.max(0,this.r-a.r),this.g=Math.max(0,this.g-a.g),this.b=Math.max(0,this.b-a.b),this}multiply(a){return this.r*=a.r,this.g*=a.g,this.b*=a.b,this}multiplyScalar(a){return this.r*=a,this.g*=a,this.b*=a,this}lerp(a,b){return this.r+=(a.r-this.r)*b,this.g+=(a.g-this.g)*b,this.b+=(a.b-this.b)*b,this}lerpColors(a,b,c){return this.r=a.r+(b.r-a.r)*c,this.g=a.g+(b.g-a.g)*c,this.b=a.b+(b.b-a.b)*c,this}lerpHSL(a,b){this.getHSL(KE),a.getHSL(KF);let c=I9(KE.h,KF.h,b),d=I9(KE.s,KF.s,b),e=I9(KE.l,KF.l,b);return this.setHSL(c,d,e),this}setFromVector3(a){return this.r=a.x,this.g=a.y,this.b=a.z,this}applyMatrix3(a){let b=this.r,c=this.g,d=this.b,e=a.elements;return this.r=e[0]*b+e[3]*c+e[6]*d,this.g=e[1]*b+e[4]*c+e[7]*d,this.b=e[2]*b+e[5]*c+e[8]*d,this}equals(a){return a.r===this.r&&a.g===this.g&&a.b===this.b}fromArray(a,b=0){return this.r=a[b],this.g=a[b+1],this.b=a[b+2],this}toArray(a=[],b=0){return a[b]=this.r,a[b+1]=this.g,a[b+2]=this.b,a}fromBufferAttribute(a,b){return this.r=a.getX(b),this.g=a.getY(b),this.b=a.getZ(b),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}},KI=new KH;KH.NAMES=KD;let KJ=0;class KK extends I3{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:KJ++}),this.uuid=I7(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new KH(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(a){this._alphaTest>0!=a>0&&this.version++,this._alphaTest=a}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(a){if(void 0!==a)for(let b in a){let c=a[b];if(void 0===c){I0(`Material: parameter '${b}' has value of undefined.`);continue}let d=this[b];if(void 0===d){I0(`Material: '${b}' is not a property of THREE.${this.type}.`);continue}d&&d.isColor?d.set(c):d&&d.isVector3&&c&&c.isVector3?d.copy(c):this[b]=c}}toJSON(a){let b=void 0===a||"string"==typeof a;b&&(a={textures:{},images:{}});let c={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};function d(a){let b=[];for(let c in a){let d=a[c];delete d.metadata,b.push(d)}return b}if(c.uuid=this.uuid,c.type=this.type,""!==this.name&&(c.name=this.name),this.color&&this.color.isColor&&(c.color=this.color.getHex()),void 0!==this.roughness&&(c.roughness=this.roughness),void 0!==this.metalness&&(c.metalness=this.metalness),void 0!==this.sheen&&(c.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(c.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(c.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(c.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(c.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(c.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(c.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(c.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(c.shininess=this.shininess),void 0!==this.clearcoat&&(c.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(c.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(c.clearcoatMap=this.clearcoatMap.toJSON(a).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(c.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(a).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(c.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(a).uuid,c.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(c.sheenColorMap=this.sheenColorMap.toJSON(a).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(c.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(a).uuid),void 0!==this.dispersion&&(c.dispersion=this.dispersion),void 0!==this.iridescence&&(c.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(c.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(c.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(c.iridescenceMap=this.iridescenceMap.toJSON(a).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(c.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(a).uuid),void 0!==this.anisotropy&&(c.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(c.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(c.anisotropyMap=this.anisotropyMap.toJSON(a).uuid),this.map&&this.map.isTexture&&(c.map=this.map.toJSON(a).uuid),this.matcap&&this.matcap.isTexture&&(c.matcap=this.matcap.toJSON(a).uuid),this.alphaMap&&this.alphaMap.isTexture&&(c.alphaMap=this.alphaMap.toJSON(a).uuid),this.lightMap&&this.lightMap.isTexture&&(c.lightMap=this.lightMap.toJSON(a).uuid,c.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(c.aoMap=this.aoMap.toJSON(a).uuid,c.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(c.bumpMap=this.bumpMap.toJSON(a).uuid,c.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(c.normalMap=this.normalMap.toJSON(a).uuid,c.normalMapType=this.normalMapType,c.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(c.displacementMap=this.displacementMap.toJSON(a).uuid,c.displacementScale=this.displacementScale,c.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(c.roughnessMap=this.roughnessMap.toJSON(a).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(c.metalnessMap=this.metalnessMap.toJSON(a).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(c.emissiveMap=this.emissiveMap.toJSON(a).uuid),this.specularMap&&this.specularMap.isTexture&&(c.specularMap=this.specularMap.toJSON(a).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(c.specularIntensityMap=this.specularIntensityMap.toJSON(a).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(c.specularColorMap=this.specularColorMap.toJSON(a).uuid),this.envMap&&this.envMap.isTexture&&(c.envMap=this.envMap.toJSON(a).uuid,void 0!==this.combine&&(c.combine=this.combine)),void 0!==this.envMapRotation&&(c.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(c.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(c.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(c.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(c.gradientMap=this.gradientMap.toJSON(a).uuid),void 0!==this.transmission&&(c.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(c.transmissionMap=this.transmissionMap.toJSON(a).uuid),void 0!==this.thickness&&(c.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(c.thicknessMap=this.thicknessMap.toJSON(a).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(c.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(c.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(c.size=this.size),null!==this.shadowSide&&(c.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(c.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(c.blending=this.blending),0!==this.side&&(c.side=this.side),!0===this.vertexColors&&(c.vertexColors=!0),this.opacity<1&&(c.opacity=this.opacity),!0===this.transparent&&(c.transparent=!0),204!==this.blendSrc&&(c.blendSrc=this.blendSrc),205!==this.blendDst&&(c.blendDst=this.blendDst),100!==this.blendEquation&&(c.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(c.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(c.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(c.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(c.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(c.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(c.depthFunc=this.depthFunc),!1===this.depthTest&&(c.depthTest=this.depthTest),!1===this.depthWrite&&(c.depthWrite=this.depthWrite),!1===this.colorWrite&&(c.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(c.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(c.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(c.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(c.stencilFuncMask=this.stencilFuncMask),7680!==this.stencilFail&&(c.stencilFail=this.stencilFail),7680!==this.stencilZFail&&(c.stencilZFail=this.stencilZFail),7680!==this.stencilZPass&&(c.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(c.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(c.rotation=this.rotation),!0===this.polygonOffset&&(c.polygonOffset=!0),0!==this.polygonOffsetFactor&&(c.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(c.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(c.linewidth=this.linewidth),void 0!==this.dashSize&&(c.dashSize=this.dashSize),void 0!==this.gapSize&&(c.gapSize=this.gapSize),void 0!==this.scale&&(c.scale=this.scale),!0===this.dithering&&(c.dithering=!0),this.alphaTest>0&&(c.alphaTest=this.alphaTest),!0===this.alphaHash&&(c.alphaHash=!0),!0===this.alphaToCoverage&&(c.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(c.premultipliedAlpha=!0),!0===this.forceSinglePass&&(c.forceSinglePass=!0),!0===this.wireframe&&(c.wireframe=!0),this.wireframeLinewidth>1&&(c.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(c.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(c.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(c.flatShading=!0),!1===this.visible&&(c.visible=!1),!1===this.toneMapped&&(c.toneMapped=!1),!1===this.fog&&(c.fog=!1),Object.keys(this.userData).length>0&&(c.userData=this.userData),b){let b=d(a.textures),e=d(a.images);b.length>0&&(c.textures=b),e.length>0&&(c.images=e)}return c}clone(){return new this.constructor().copy(this)}copy(a){this.name=a.name,this.blending=a.blending,this.side=a.side,this.vertexColors=a.vertexColors,this.opacity=a.opacity,this.transparent=a.transparent,this.blendSrc=a.blendSrc,this.blendDst=a.blendDst,this.blendEquation=a.blendEquation,this.blendSrcAlpha=a.blendSrcAlpha,this.blendDstAlpha=a.blendDstAlpha,this.blendEquationAlpha=a.blendEquationAlpha,this.blendColor.copy(a.blendColor),this.blendAlpha=a.blendAlpha,this.depthFunc=a.depthFunc,this.depthTest=a.depthTest,this.depthWrite=a.depthWrite,this.stencilWriteMask=a.stencilWriteMask,this.stencilFunc=a.stencilFunc,this.stencilRef=a.stencilRef,this.stencilFuncMask=a.stencilFuncMask,this.stencilFail=a.stencilFail,this.stencilZFail=a.stencilZFail,this.stencilZPass=a.stencilZPass,this.stencilWrite=a.stencilWrite;let b=a.clippingPlanes,c=null;if(null!==b){let a=b.length;c=Array(a);for(let d=0;d!==a;++d)c[d]=b[d].clone()}return this.clippingPlanes=c,this.clipIntersection=a.clipIntersection,this.clipShadows=a.clipShadows,this.shadowSide=a.shadowSide,this.colorWrite=a.colorWrite,this.precision=a.precision,this.polygonOffset=a.polygonOffset,this.polygonOffsetFactor=a.polygonOffsetFactor,this.polygonOffsetUnits=a.polygonOffsetUnits,this.dithering=a.dithering,this.alphaTest=a.alphaTest,this.alphaHash=a.alphaHash,this.alphaToCoverage=a.alphaToCoverage,this.premultipliedAlpha=a.premultipliedAlpha,this.forceSinglePass=a.forceSinglePass,this.visible=a.visible,this.toneMapped=a.toneMapped,this.userData=JSON.parse(JSON.stringify(a.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(a){!0===a&&this.version++}}class KL extends KK{constructor(a){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new KH(0xffffff),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new J7,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.envMapRotation.copy(a.envMapRotation),this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.fog=a.fog,this}}let KM=new Je,KN=new Jc,KO=0,KP=class{constructor(a,b,c=!1){if(Array.isArray(a))throw TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:KO++}),this.name="",this.array=a,this.itemSize=b,this.count=void 0!==a?a.length/b:0,this.normalized=c,this.usage=35044,this.updateRanges=[],this.gpuType=1015,this.version=0}onUploadCallback(){}set needsUpdate(a){!0===a&&this.version++}setUsage(a){return this.usage=a,this}addUpdateRange(a,b){this.updateRanges.push({start:a,count:b})}clearUpdateRanges(){this.updateRanges.length=0}copy(a){return this.name=a.name,this.array=new a.array.constructor(a.array),this.itemSize=a.itemSize,this.count=a.count,this.normalized=a.normalized,this.usage=a.usage,this.gpuType=a.gpuType,this}copyAt(a,b,c){a*=this.itemSize,c*=b.itemSize;for(let d=0,e=this.itemSize;d<e;d++)this.array[a+d]=b.array[c+d];return this}copyArray(a){return this.array.set(a),this}applyMatrix3(a){if(2===this.itemSize)for(let b=0,c=this.count;b<c;b++)KN.fromBufferAttribute(this,b),KN.applyMatrix3(a),this.setXY(b,KN.x,KN.y);else if(3===this.itemSize)for(let b=0,c=this.count;b<c;b++)KM.fromBufferAttribute(this,b),KM.applyMatrix3(a),this.setXYZ(b,KM.x,KM.y,KM.z);return this}applyMatrix4(a){for(let b=0,c=this.count;b<c;b++)KM.fromBufferAttribute(this,b),KM.applyMatrix4(a),this.setXYZ(b,KM.x,KM.y,KM.z);return this}applyNormalMatrix(a){for(let b=0,c=this.count;b<c;b++)KM.fromBufferAttribute(this,b),KM.applyNormalMatrix(a),this.setXYZ(b,KM.x,KM.y,KM.z);return this}transformDirection(a){for(let b=0,c=this.count;b<c;b++)KM.fromBufferAttribute(this,b),KM.transformDirection(a),this.setXYZ(b,KM.x,KM.y,KM.z);return this}set(a,b=0){return this.array.set(a,b),this}getComponent(a,b){let c=this.array[a*this.itemSize+b];return this.normalized&&(c=Ja(c,this.array)),c}setComponent(a,b,c){return this.normalized&&(c=Jb(c,this.array)),this.array[a*this.itemSize+b]=c,this}getX(a){let b=this.array[a*this.itemSize];return this.normalized&&(b=Ja(b,this.array)),b}setX(a,b){return this.normalized&&(b=Jb(b,this.array)),this.array[a*this.itemSize]=b,this}getY(a){let b=this.array[a*this.itemSize+1];return this.normalized&&(b=Ja(b,this.array)),b}setY(a,b){return this.normalized&&(b=Jb(b,this.array)),this.array[a*this.itemSize+1]=b,this}getZ(a){let b=this.array[a*this.itemSize+2];return this.normalized&&(b=Ja(b,this.array)),b}setZ(a,b){return this.normalized&&(b=Jb(b,this.array)),this.array[a*this.itemSize+2]=b,this}getW(a){let b=this.array[a*this.itemSize+3];return this.normalized&&(b=Ja(b,this.array)),b}setW(a,b){return this.normalized&&(b=Jb(b,this.array)),this.array[a*this.itemSize+3]=b,this}setXY(a,b,c){return a*=this.itemSize,this.normalized&&(b=Jb(b,this.array),c=Jb(c,this.array)),this.array[a+0]=b,this.array[a+1]=c,this}setXYZ(a,b,c,d){return a*=this.itemSize,this.normalized&&(b=Jb(b,this.array),c=Jb(c,this.array),d=Jb(d,this.array)),this.array[a+0]=b,this.array[a+1]=c,this.array[a+2]=d,this}setXYZW(a,b,c,d,e){return a*=this.itemSize,this.normalized&&(b=Jb(b,this.array),c=Jb(c,this.array),d=Jb(d,this.array),e=Jb(e,this.array)),this.array[a+0]=b,this.array[a+1]=c,this.array[a+2]=d,this.array[a+3]=e,this}onUpload(a){return this.onUploadCallback=a,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let a={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(a.name=this.name),35044!==this.usage&&(a.usage=this.usage),a}};class KQ extends KP{constructor(a,b,c){super(new Uint16Array(a),b,c)}}class KR extends KP{constructor(a,b,c){super(new Uint32Array(a),b,c)}}class KS extends KP{constructor(a,b,c){super(new Float32Array(a),b,c)}}let KT=0,KU=new JZ,KV=new Ko,KW=new Je,KX=new Jz,KY=new Jz,KZ=new Je;class K$ extends I3{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:KT++}),this.uuid=I7(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(a){return Array.isArray(a)?this.index=new(IY(a)?KR:KQ)(a,1):this.index=a,this}setIndirect(a){return this.indirect=a,this}getIndirect(){return this.indirect}getAttribute(a){return this.attributes[a]}setAttribute(a,b){return this.attributes[a]=b,this}deleteAttribute(a){return delete this.attributes[a],this}hasAttribute(a){return void 0!==this.attributes[a]}addGroup(a,b,c=0){this.groups.push({start:a,count:b,materialIndex:c})}clearGroups(){this.groups=[]}setDrawRange(a,b){this.drawRange.start=a,this.drawRange.count=b}applyMatrix4(a){let b=this.attributes.position;void 0!==b&&(b.applyMatrix4(a),b.needsUpdate=!0);let c=this.attributes.normal;if(void 0!==c){let b=new Jh().getNormalMatrix(a);c.applyNormalMatrix(b),c.needsUpdate=!0}let d=this.attributes.tangent;return void 0!==d&&(d.transformDirection(a),d.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(a){return KU.makeRotationFromQuaternion(a),this.applyMatrix4(KU),this}rotateX(a){return KU.makeRotationX(a),this.applyMatrix4(KU),this}rotateY(a){return KU.makeRotationY(a),this.applyMatrix4(KU),this}rotateZ(a){return KU.makeRotationZ(a),this.applyMatrix4(KU),this}translate(a,b,c){return KU.makeTranslation(a,b,c),this.applyMatrix4(KU),this}scale(a,b,c){return KU.makeScale(a,b,c),this.applyMatrix4(KU),this}lookAt(a){return KV.lookAt(a),KV.updateMatrix(),this.applyMatrix4(KV.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(KW).negate(),this.translate(KW.x,KW.y,KW.z),this}setFromPoints(a){let b=this.getAttribute("position");if(void 0===b){let b=[];for(let c=0,d=a.length;c<d;c++){let d=a[c];b.push(d.x,d.y,d.z||0)}this.setAttribute("position",new KS(b,3))}else{let c=Math.min(a.length,b.count);for(let d=0;d<c;d++){let c=a[d];b.setXYZ(d,c.x,c.y,c.z||0)}a.length>b.count&&I0("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),b.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Jz);let a=this.attributes.position,b=this.morphAttributes.position;if(a&&a.isGLBufferAttribute){I1("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Je(-1/0,-1/0,-1/0),new Je(1/0,1/0,1/0));return}if(void 0!==a){if(this.boundingBox.setFromBufferAttribute(a),b)for(let a=0,c=b.length;a<c;a++){let c=b[a];KX.setFromBufferAttribute(c),this.morphTargetsRelative?(KZ.addVectors(this.boundingBox.min,KX.min),this.boundingBox.expandByPoint(KZ),KZ.addVectors(this.boundingBox.max,KX.max),this.boundingBox.expandByPoint(KZ)):(this.boundingBox.expandByPoint(KX.min),this.boundingBox.expandByPoint(KX.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&I1('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new JR);let a=this.attributes.position,b=this.morphAttributes.position;if(a&&a.isGLBufferAttribute){I1("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Je,1/0);return}if(a){let c=this.boundingSphere.center;if(KX.setFromBufferAttribute(a),b)for(let a=0,c=b.length;a<c;a++){let c=b[a];KY.setFromBufferAttribute(c),this.morphTargetsRelative?(KZ.addVectors(KX.min,KY.min),KX.expandByPoint(KZ),KZ.addVectors(KX.max,KY.max),KX.expandByPoint(KZ)):(KX.expandByPoint(KY.min),KX.expandByPoint(KY.max))}KX.getCenter(c);let d=0;for(let b=0,e=a.count;b<e;b++)KZ.fromBufferAttribute(a,b),d=Math.max(d,c.distanceToSquared(KZ));if(b)for(let e=0,f=b.length;e<f;e++){let f=b[e],g=this.morphTargetsRelative;for(let b=0,e=f.count;b<e;b++)KZ.fromBufferAttribute(f,b),g&&(KW.fromBufferAttribute(a,b),KZ.add(KW)),d=Math.max(d,c.distanceToSquared(KZ))}this.boundingSphere.radius=Math.sqrt(d),isNaN(this.boundingSphere.radius)&&I1('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let a=this.index,b=this.attributes;if(null===a||void 0===b.position||void 0===b.normal||void 0===b.uv)return void I1("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");let c=b.position,d=b.normal,e=b.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new KP(new Float32Array(4*c.count),4));let f=this.getAttribute("tangent"),g=[],h=[];for(let a=0;a<c.count;a++)g[a]=new Je,h[a]=new Je;let i=new Je,j=new Je,k=new Je,l=new Jc,m=new Jc,n=new Jc,o=new Je,p=new Je,q=this.groups;0===q.length&&(q=[{start:0,count:a.count}]);for(let b=0,d=q.length;b<d;++b){let d=q[b],f=d.start,r=d.count;for(let b=f,d=f+r;b<d;b+=3)!function(a,b,d){i.fromBufferAttribute(c,a),j.fromBufferAttribute(c,b),k.fromBufferAttribute(c,d),l.fromBufferAttribute(e,a),m.fromBufferAttribute(e,b),n.fromBufferAttribute(e,d),j.sub(i),k.sub(i),m.sub(l),n.sub(l);let f=1/(m.x*n.y-n.x*m.y);isFinite(f)&&(o.copy(j).multiplyScalar(n.y).addScaledVector(k,-m.y).multiplyScalar(f),p.copy(k).multiplyScalar(m.x).addScaledVector(j,-n.x).multiplyScalar(f),g[a].add(o),g[b].add(o),g[d].add(o),h[a].add(p),h[b].add(p),h[d].add(p))}(a.getX(b+0),a.getX(b+1),a.getX(b+2))}let r=new Je,s=new Je,t=new Je,u=new Je;function v(a){t.fromBufferAttribute(d,a),u.copy(t);let b=g[a];r.copy(b),r.sub(t.multiplyScalar(t.dot(b))).normalize(),s.crossVectors(u,b);let c=0>s.dot(h[a])?-1:1;f.setXYZW(a,r.x,r.y,r.z,c)}for(let b=0,c=q.length;b<c;++b){let c=q[b],d=c.start,e=c.count;for(let b=d,c=d+e;b<c;b+=3)v(a.getX(b+0)),v(a.getX(b+1)),v(a.getX(b+2))}}computeVertexNormals(){let a=this.index,b=this.getAttribute("position");if(void 0!==b){let c=this.getAttribute("normal");if(void 0===c)c=new KP(new Float32Array(3*b.count),3),this.setAttribute("normal",c);else for(let a=0,b=c.count;a<b;a++)c.setXYZ(a,0,0,0);let d=new Je,e=new Je,f=new Je,g=new Je,h=new Je,i=new Je,j=new Je,k=new Je;if(a)for(let l=0,m=a.count;l<m;l+=3){let m=a.getX(l+0),n=a.getX(l+1),o=a.getX(l+2);d.fromBufferAttribute(b,m),e.fromBufferAttribute(b,n),f.fromBufferAttribute(b,o),j.subVectors(f,e),k.subVectors(d,e),j.cross(k),g.fromBufferAttribute(c,m),h.fromBufferAttribute(c,n),i.fromBufferAttribute(c,o),g.add(j),h.add(j),i.add(j),c.setXYZ(m,g.x,g.y,g.z),c.setXYZ(n,h.x,h.y,h.z),c.setXYZ(o,i.x,i.y,i.z)}else for(let a=0,g=b.count;a<g;a+=3)d.fromBufferAttribute(b,a+0),e.fromBufferAttribute(b,a+1),f.fromBufferAttribute(b,a+2),j.subVectors(f,e),k.subVectors(d,e),j.cross(k),c.setXYZ(a+0,j.x,j.y,j.z),c.setXYZ(a+1,j.x,j.y,j.z),c.setXYZ(a+2,j.x,j.y,j.z);this.normalizeNormals(),c.needsUpdate=!0}}normalizeNormals(){let a=this.attributes.normal;for(let b=0,c=a.count;b<c;b++)KZ.fromBufferAttribute(a,b),KZ.normalize(),a.setXYZ(b,KZ.x,KZ.y,KZ.z)}toNonIndexed(){function a(a,b){let c=a.array,d=a.itemSize,e=a.normalized,f=new c.constructor(b.length*d),g=0,h=0;for(let e=0,i=b.length;e<i;e++){g=a.isInterleavedBufferAttribute?b[e]*a.data.stride+a.offset:b[e]*d;for(let a=0;a<d;a++)f[h++]=c[g++]}return new KP(f,d,e)}if(null===this.index)return I0("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let b=new K$,c=this.index.array,d=this.attributes;for(let e in d){let f=a(d[e],c);b.setAttribute(e,f)}let e=this.morphAttributes;for(let d in e){let f=[],g=e[d];for(let b=0,d=g.length;b<d;b++){let d=a(g[b],c);f.push(d)}b.morphAttributes[d]=f}b.morphTargetsRelative=this.morphTargetsRelative;let f=this.groups;for(let a=0,c=f.length;a<c;a++){let c=f[a];b.addGroup(c.start,c.count,c.materialIndex)}return b}toJSON(){let a={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(a.uuid=this.uuid,a.type=this.type,""!==this.name&&(a.name=this.name),Object.keys(this.userData).length>0&&(a.userData=this.userData),void 0!==this.parameters){let b=this.parameters;for(let c in b)void 0!==b[c]&&(a[c]=b[c]);return a}a.data={attributes:{}};let b=this.index;null!==b&&(a.data.index={type:b.array.constructor.name,array:Array.prototype.slice.call(b.array)});let c=this.attributes;for(let b in c){let d=c[b];a.data.attributes[b]=d.toJSON(a.data)}let d={},e=!1;for(let b in this.morphAttributes){let c=this.morphAttributes[b],f=[];for(let b=0,d=c.length;b<d;b++){let d=c[b];f.push(d.toJSON(a.data))}f.length>0&&(d[b]=f,e=!0)}e&&(a.data.morphAttributes=d,a.data.morphTargetsRelative=this.morphTargetsRelative);let f=this.groups;f.length>0&&(a.data.groups=JSON.parse(JSON.stringify(f)));let g=this.boundingSphere;return null!==g&&(a.data.boundingSphere=g.toJSON()),a}clone(){return new this.constructor().copy(this)}copy(a){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let b={};this.name=a.name;let c=a.index;null!==c&&this.setIndex(c.clone());let d=a.attributes;for(let a in d){let c=d[a];this.setAttribute(a,c.clone(b))}let e=a.morphAttributes;for(let a in e){let c=[],d=e[a];for(let a=0,e=d.length;a<e;a++)c.push(d[a].clone(b));this.morphAttributes[a]=c}this.morphTargetsRelative=a.morphTargetsRelative;let f=a.groups;for(let a=0,b=f.length;a<b;a++){let b=f[a];this.addGroup(b.start,b.count,b.materialIndex)}let g=a.boundingBox;null!==g&&(this.boundingBox=g.clone());let h=a.boundingSphere;return null!==h&&(this.boundingSphere=h.clone()),this.drawRange.start=a.drawRange.start,this.drawRange.count=a.drawRange.count,this.userData=a.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}let K_=new JZ,K0=new class{constructor(a=new Je,b=new Je(0,0,-1)){this.origin=a,this.direction=b}set(a,b){return this.origin.copy(a),this.direction.copy(b),this}copy(a){return this.origin.copy(a.origin),this.direction.copy(a.direction),this}at(a,b){return b.copy(this.origin).addScaledVector(this.direction,a)}lookAt(a){return this.direction.copy(a).sub(this.origin).normalize(),this}recast(a){return this.origin.copy(this.at(a,JS)),this}closestPointToPoint(a,b){b.subVectors(a,this.origin);let c=b.dot(this.direction);return c<0?b.copy(this.origin):b.copy(this.origin).addScaledVector(this.direction,c)}distanceToPoint(a){return Math.sqrt(this.distanceSqToPoint(a))}distanceSqToPoint(a){let b=JS.subVectors(a,this.origin).dot(this.direction);return b<0?this.origin.distanceToSquared(a):(JS.copy(this.origin).addScaledVector(this.direction,b),JS.distanceToSquared(a))}distanceSqToSegment(a,b,c,d){let e,f,g,h;JT.copy(a).add(b).multiplyScalar(.5),JU.copy(b).sub(a).normalize(),JV.copy(this.origin).sub(JT);let i=.5*a.distanceTo(b),j=-this.direction.dot(JU),k=JV.dot(this.direction),l=-JV.dot(JU),m=JV.lengthSq(),n=Math.abs(1-j*j);if(n>0)if(e=j*l-k,f=j*k-l,h=i*n,e>=0)if(f>=-h)if(f<=h){let a=1/n;e*=a,f*=a,g=e*(e+j*f+2*k)+f*(j*e+f+2*l)+m}else g=-(e=Math.max(0,-(j*(f=i)+k)))*e+f*(f+2*l)+m;else g=-(e=Math.max(0,-(j*(f=-i)+k)))*e+f*(f+2*l)+m;else f<=-h?(f=(e=Math.max(0,-(-j*i+k)))>0?-i:Math.min(Math.max(-i,-l),i),g=-e*e+f*(f+2*l)+m):f<=h?(e=0,g=(f=Math.min(Math.max(-i,-l),i))*(f+2*l)+m):(f=(e=Math.max(0,-(j*i+k)))>0?i:Math.min(Math.max(-i,-l),i),g=-e*e+f*(f+2*l)+m);else f=j>0?-i:i,g=-(e=Math.max(0,-(j*f+k)))*e+f*(f+2*l)+m;return c&&c.copy(this.origin).addScaledVector(this.direction,e),d&&d.copy(JT).addScaledVector(JU,f),g}intersectSphere(a,b){JS.subVectors(a.center,this.origin);let c=JS.dot(this.direction),d=JS.dot(JS)-c*c,e=a.radius*a.radius;if(d>e)return null;let f=Math.sqrt(e-d),g=c-f,h=c+f;return h<0?null:g<0?this.at(h,b):this.at(g,b)}intersectsSphere(a){return!(a.radius<0)&&this.distanceSqToPoint(a.center)<=a.radius*a.radius}distanceToPlane(a){let b=a.normal.dot(this.direction);if(0===b)return 0===a.distanceToPoint(this.origin)?0:null;let c=-(this.origin.dot(a.normal)+a.constant)/b;return c>=0?c:null}intersectPlane(a,b){let c=this.distanceToPlane(a);return null===c?null:this.at(c,b)}intersectsPlane(a){let b=a.distanceToPoint(this.origin);return 0===b||a.normal.dot(this.direction)*b<0}intersectBox(a,b){let c,d,e,f,g,h,i=1/this.direction.x,j=1/this.direction.y,k=1/this.direction.z,l=this.origin;return i>=0?(c=(a.min.x-l.x)*i,d=(a.max.x-l.x)*i):(c=(a.max.x-l.x)*i,d=(a.min.x-l.x)*i),j>=0?(e=(a.min.y-l.y)*j,f=(a.max.y-l.y)*j):(e=(a.max.y-l.y)*j,f=(a.min.y-l.y)*j),c>f||e>d||((e>c||isNaN(c))&&(c=e),(f<d||isNaN(d))&&(d=f),k>=0?(g=(a.min.z-l.z)*k,h=(a.max.z-l.z)*k):(g=(a.max.z-l.z)*k,h=(a.min.z-l.z)*k),c>h||g>d)||((g>c||c!=c)&&(c=g),(h<d||d!=d)&&(d=h),d<0)?null:this.at(c>=0?c:d,b)}intersectsBox(a){return null!==this.intersectBox(a,JS)}intersectTriangle(a,b,c,d,e){JW.subVectors(b,a),JX.subVectors(c,a),JY.crossVectors(JW,JX);let f=this.direction.dot(JY),g;if(f>0){if(d)return null;g=1}else{if(!(f<0))return null;g=-1,f=-f}JV.subVectors(this.origin,a);let h=g*this.direction.dot(JX.crossVectors(JV,JX));if(h<0)return null;let i=g*this.direction.dot(JW.cross(JV));if(i<0||h+i>f)return null;let j=-g*JV.dot(JY);return j<0?null:this.at(j/f,e)}applyMatrix4(a){return this.origin.applyMatrix4(a),this.direction.transformDirection(a),this}equals(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},K1=new JR,K2=new Je,K3=new Je,K4=new Je,K5=new Je,K6=new Je,K7=new Je,K8=new Je,K9=new Je;class La extends Ko{constructor(a=new K$,b=new KL){super(),this.isMesh=!0,this.type="Mesh",this.geometry=a,this.material=b,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(a,b){return super.copy(a,b),void 0!==a.morphTargetInfluences&&(this.morphTargetInfluences=a.morphTargetInfluences.slice()),void 0!==a.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},a.morphTargetDictionary)),this.material=Array.isArray(a.material)?a.material.slice():a.material,this.geometry=a.geometry,this}updateMorphTargets(){let a=this.geometry.morphAttributes,b=Object.keys(a);if(b.length>0){let c=a[b[0]];if(void 0!==c){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,b=c.length;a<b;a++){let b=c[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[b]=a}}}}getVertexPosition(a,b){let c=this.geometry,d=c.attributes.position,e=c.morphAttributes.position,f=c.morphTargetsRelative;b.fromBufferAttribute(d,a);let g=this.morphTargetInfluences;if(e&&g){K7.set(0,0,0);for(let c=0,d=e.length;c<d;c++){let d=g[c],h=e[c];0!==d&&(K6.fromBufferAttribute(h,a),f?K7.addScaledVector(K6,d):K7.addScaledVector(K6.sub(b),d))}b.add(K7)}return b}raycast(a,b){let c=this.geometry,d=this.material,e=this.matrixWorld;void 0!==d&&(null===c.boundingSphere&&c.computeBoundingSphere(),K1.copy(c.boundingSphere),K1.applyMatrix4(e),K0.copy(a.ray).recast(a.near),!1===K1.containsPoint(K0.origin)&&(null===K0.intersectSphere(K1,K2)||K0.origin.distanceToSquared(K2)>(a.far-a.near)**2)||(K_.copy(e).invert(),K0.copy(a.ray).applyMatrix4(K_),(null===c.boundingBox||!1!==K0.intersectsBox(c.boundingBox))&&this._computeIntersections(a,b,K0)))}_computeIntersections(a,b,c){let d,e=this.geometry,f=this.material,g=e.index,h=e.attributes.position,i=e.attributes.uv,j=e.attributes.uv1,k=e.attributes.normal,l=e.groups,m=e.drawRange;if(null!==g)if(Array.isArray(f))for(let e=0,h=l.length;e<h;e++){let h=l[e],n=f[h.materialIndex],o=Math.max(h.start,m.start),p=Math.min(g.count,Math.min(h.start+h.count,m.start+m.count));for(let e=o;e<p;e+=3)(d=Lb(this,n,a,c,i,j,k,g.getX(e),g.getX(e+1),g.getX(e+2)))&&(d.faceIndex=Math.floor(e/3),d.face.materialIndex=h.materialIndex,b.push(d))}else{let e=Math.max(0,m.start),h=Math.min(g.count,m.start+m.count);for(let l=e;l<h;l+=3)(d=Lb(this,f,a,c,i,j,k,g.getX(l),g.getX(l+1),g.getX(l+2)))&&(d.faceIndex=Math.floor(l/3),b.push(d))}else if(void 0!==h)if(Array.isArray(f))for(let e=0,g=l.length;e<g;e++){let g=l[e],n=f[g.materialIndex],o=Math.max(g.start,m.start),p=Math.min(h.count,Math.min(g.start+g.count,m.start+m.count));for(let e=o;e<p;e+=3)(d=Lb(this,n,a,c,i,j,k,e,e+1,e+2))&&(d.faceIndex=Math.floor(e/3),d.face.materialIndex=g.materialIndex,b.push(d))}else{let e=Math.max(0,m.start),g=Math.min(h.count,m.start+m.count);for(let h=e;h<g;h+=3)(d=Lb(this,f,a,c,i,j,k,h,h+1,h+2))&&(d.faceIndex=Math.floor(h/3),b.push(d))}}}function Lb(a,b,c,d,e,f,g,h,i,j){a.getVertexPosition(h,K3),a.getVertexPosition(i,K4),a.getVertexPosition(j,K5);let k=function(a,b,c,d,e,f,g,h){if(null===(1===b.side?d.intersectTriangle(g,f,e,!0,h):d.intersectTriangle(e,f,g,0===b.side,h)))return null;K9.copy(h),K9.applyMatrix4(a.matrixWorld);let i=c.ray.origin.distanceTo(K9);return i<c.near||i>c.far?null:{distance:i,point:K9.clone(),object:a}}(a,b,c,d,K3,K4,K5,K8);if(k){let a=new Je;KC.getBarycoord(K8,K3,K4,K5,a),e&&(k.uv=KC.getInterpolatedAttribute(e,h,i,j,a,new Jc)),f&&(k.uv1=KC.getInterpolatedAttribute(f,h,i,j,a,new Jc)),g&&(k.normal=KC.getInterpolatedAttribute(g,h,i,j,a,new Je),k.normal.dot(d.direction)>0&&k.normal.multiplyScalar(-1));let b={a:h,b:i,c:j,normal:new Je,materialIndex:0};KC.getNormal(K3,K4,K5,b.normal),k.face=b,k.barycoord=a}return k}class Lc extends K${constructor(a=1,b=1,c=1,d=1,e=1,f=1){super(),this.type="BoxGeometry",this.parameters={width:a,height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};const g=this;d=Math.floor(d),e=Math.floor(e);const h=[],i=[],j=[],k=[];let l=0,m=0;function n(a,b,c,d,e,f,n,o,p,q,r){let s=f/p,t=n/q,u=f/2,v=n/2,w=o/2,x=p+1,y=q+1,z=0,A=0,B=new Je;for(let f=0;f<y;f++){let g=f*t-v;for(let h=0;h<x;h++){let l=h*s-u;B[a]=l*d,B[b]=g*e,B[c]=w,i.push(B.x,B.y,B.z),B[a]=0,B[b]=0,B[c]=o>0?1:-1,j.push(B.x,B.y,B.z),k.push(h/p),k.push(1-f/q),z+=1}}for(let a=0;a<q;a++)for(let b=0;b<p;b++){let c=l+b+x*a,d=l+b+x*(a+1),e=l+(b+1)+x*(a+1),f=l+(b+1)+x*a;h.push(c,d,f),h.push(d,e,f),A+=6}g.addGroup(m,A,r),m+=A,l+=z}n("z","y","x",-1,-1,c,b,a,f=Math.floor(f),e,0),n("z","y","x",1,-1,c,b,-a,f,e,1),n("x","z","y",1,1,a,c,b,d,f,2),n("x","z","y",1,-1,a,c,-b,d,f,3),n("x","y","z",1,-1,a,b,c,d,e,4),n("x","y","z",-1,-1,a,b,-c,d,e,5),this.setIndex(h),this.setAttribute("position",new KS(i,3)),this.setAttribute("normal",new KS(j,3)),this.setAttribute("uv",new KS(k,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new Lc(a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments)}}function Ld(a){let b={};for(let c in a)for(let d in b[c]={},a[c]){let e=a[c][d];e&&(e.isColor||e.isMatrix3||e.isMatrix4||e.isVector2||e.isVector3||e.isVector4||e.isTexture||e.isQuaternion)?e.isRenderTargetTexture?(I0("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),b[c][d]=null):b[c][d]=e.clone():Array.isArray(e)?b[c][d]=e.slice():b[c][d]=e}return b}function Le(a){let b={};for(let c=0;c<a.length;c++){let d=Ld(a[c]);for(let a in d)b[a]=d[a]}return b}function Lf(a){let b=a.getRenderTarget();return null===b?a.outputColorSpace:!0===b.isXRRenderTarget?b.texture.colorSpace:Jl.workingColorSpace}var Lg=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Lh=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Li extends KK{constructor(a){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Lg,this.fragmentShader=Lh,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==a&&this.setValues(a)}copy(a){return super.copy(a),this.fragmentShader=a.fragmentShader,this.vertexShader=a.vertexShader,this.uniforms=Ld(a.uniforms),this.uniformsGroups=function(a){let b=[];for(let c=0;c<a.length;c++)b.push(a[c].clone());return b}(a.uniformsGroups),this.defines=Object.assign({},a.defines),this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.fog=a.fog,this.lights=a.lights,this.clipping=a.clipping,this.extensions=Object.assign({},a.extensions),this.glslVersion=a.glslVersion,this}toJSON(a){let b=super.toJSON(a);for(let c in b.glslVersion=this.glslVersion,b.uniforms={},this.uniforms){let d=this.uniforms[c].value;d&&d.isTexture?b.uniforms[c]={type:"t",value:d.toJSON(a).uuid}:d&&d.isColor?b.uniforms[c]={type:"c",value:d.getHex()}:d&&d.isVector2?b.uniforms[c]={type:"v2",value:d.toArray()}:d&&d.isVector3?b.uniforms[c]={type:"v3",value:d.toArray()}:d&&d.isVector4?b.uniforms[c]={type:"v4",value:d.toArray()}:d&&d.isMatrix3?b.uniforms[c]={type:"m3",value:d.toArray()}:d&&d.isMatrix4?b.uniforms[c]={type:"m4",value:d.toArray()}:b.uniforms[c]={value:d}}Object.keys(this.defines).length>0&&(b.defines=this.defines),b.vertexShader=this.vertexShader,b.fragmentShader=this.fragmentShader,b.lights=this.lights,b.clipping=this.clipping;let c={};for(let a in this.extensions)!0===this.extensions[a]&&(c[a]=!0);return Object.keys(c).length>0&&(b.extensions=c),b}}class Lj extends Ko{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new JZ,this.projectionMatrix=new JZ,this.projectionMatrixInverse=new JZ,this.coordinateSystem=2e3,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(a,b){return super.copy(a,b),this.matrixWorldInverse.copy(a.matrixWorldInverse),this.projectionMatrix.copy(a.projectionMatrix),this.projectionMatrixInverse.copy(a.projectionMatrixInverse),this.coordinateSystem=a.coordinateSystem,this}getWorldDirection(a){return super.getWorldDirection(a).negate()}updateMatrixWorld(a){super.updateMatrixWorld(a),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(a,b){super.updateWorldMatrix(a,b),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}let Lk=new Je,Ll=new Jc,Lm=new Jc;class Ln extends Lj{constructor(a=50,b=1,c=.1,d=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=a,this.zoom=1,this.near=c,this.far=d,this.focus=10,this.aspect=b,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(a,b){return super.copy(a,b),this.fov=a.fov,this.zoom=a.zoom,this.near=a.near,this.far=a.far,this.focus=a.focus,this.aspect=a.aspect,this.view=null===a.view?null:Object.assign({},a.view),this.filmGauge=a.filmGauge,this.filmOffset=a.filmOffset,this}setFocalLength(a){let b=.5*this.getFilmHeight()/a;this.fov=2*I6*Math.atan(b),this.updateProjectionMatrix()}getFocalLength(){let a=Math.tan(.5*I5*this.fov);return .5*this.getFilmHeight()/a}getEffectiveFOV(){return 2*I6*Math.atan(Math.tan(.5*I5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(a,b,c){Lk.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),b.set(Lk.x,Lk.y).multiplyScalar(-a/Lk.z),Lk.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),c.set(Lk.x,Lk.y).multiplyScalar(-a/Lk.z)}getViewSize(a,b){return this.getViewBounds(a,Ll,Lm),b.subVectors(Lm,Ll)}setViewOffset(a,b,c,d,e,f){this.aspect=a/b,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=a,this.view.fullHeight=b,this.view.offsetX=c,this.view.offsetY=d,this.view.width=e,this.view.height=f,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let a=this.near,b=a*Math.tan(.5*I5*this.fov)/this.zoom,c=2*b,d=this.aspect*c,e=-.5*d,f=this.view;if(null!==this.view&&this.view.enabled){let a=f.fullWidth,g=f.fullHeight;e+=f.offsetX*d/a,b-=f.offsetY*c/g,d*=f.width/a,c*=f.height/g}let g=this.filmOffset;0!==g&&(e+=a*g/this.getFilmWidth()),this.projectionMatrix.makePerspective(e,e+d,b,b-c,a,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(a){let b=super.toJSON(a);return b.object.fov=this.fov,b.object.zoom=this.zoom,b.object.near=this.near,b.object.far=this.far,b.object.focus=this.focus,b.object.aspect=this.aspect,null!==this.view&&(b.object.view=Object.assign({},this.view)),b.object.filmGauge=this.filmGauge,b.object.filmOffset=this.filmOffset,b}}class Lo extends Ko{constructor(a,b,c){super(),this.type="CubeCamera",this.renderTarget=c,this.coordinateSystem=null,this.activeMipmapLevel=0;const d=new Ln(-90,1,a,b);d.layers=this.layers,this.add(d);const e=new Ln(-90,1,a,b);e.layers=this.layers,this.add(e);const f=new Ln(-90,1,a,b);f.layers=this.layers,this.add(f);const g=new Ln(-90,1,a,b);g.layers=this.layers,this.add(g);const h=new Ln(-90,1,a,b);h.layers=this.layers,this.add(h);const i=new Ln(-90,1,a,b);i.layers=this.layers,this.add(i)}updateCoordinateSystem(){let a=this.coordinateSystem,b=this.children.concat(),[c,d,e,f,g,h]=b;for(let a of b)this.remove(a);if(2e3===a)c.up.set(0,1,0),c.lookAt(1,0,0),d.up.set(0,1,0),d.lookAt(-1,0,0),e.up.set(0,0,-1),e.lookAt(0,1,0),f.up.set(0,0,1),f.lookAt(0,-1,0),g.up.set(0,1,0),g.lookAt(0,0,1),h.up.set(0,1,0),h.lookAt(0,0,-1);else if(2001===a)c.up.set(0,-1,0),c.lookAt(-1,0,0),d.up.set(0,-1,0),d.lookAt(1,0,0),e.up.set(0,0,1),e.lookAt(0,1,0),f.up.set(0,0,-1),f.lookAt(0,-1,0),g.up.set(0,-1,0),g.lookAt(0,0,1),h.up.set(0,-1,0),h.lookAt(0,0,-1);else throw Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+a);for(let a of b)this.add(a),a.updateMatrixWorld()}update(a,b){null===this.parent&&this.updateMatrixWorld();let{renderTarget:c,activeMipmapLevel:d}=this;this.coordinateSystem!==a.coordinateSystem&&(this.coordinateSystem=a.coordinateSystem,this.updateCoordinateSystem());let[e,f,g,h,i,j]=this.children,k=a.getRenderTarget(),l=a.getActiveCubeFace(),m=a.getActiveMipmapLevel(),n=a.xr.enabled;a.xr.enabled=!1;let o=c.texture.generateMipmaps;c.texture.generateMipmaps=!1,a.setRenderTarget(c,0,d),a.render(b,e),a.setRenderTarget(c,1,d),a.render(b,f),a.setRenderTarget(c,2,d),a.render(b,g),a.setRenderTarget(c,3,d),a.render(b,h),a.setRenderTarget(c,4,d),a.render(b,i),c.texture.generateMipmaps=o,a.setRenderTarget(c,5,d),a.render(b,j),a.setRenderTarget(k,l,m),a.xr.enabled=n,c.texture.needsPMREMUpdate=!0}}class Lp extends Ju{constructor(a=[],b=301,c,d,e,f,g,h,i,j){super(a,b,c,d,e,f,g,h,i,j),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(a){this.image=a}}class Lq extends Jx{constructor(a=1,b={}){super(a,a,b),this.isWebGLCubeRenderTarget=!0;const c={width:a,height:a,depth:1};this.texture=new Lp([c,c,c,c,c,c]),this._setTextureOptions(b),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(a,b){this.texture.type=b.type,this.texture.colorSpace=b.colorSpace,this.texture.generateMipmaps=b.generateMipmaps,this.texture.minFilter=b.minFilter,this.texture.magFilter=b.magFilter;let c={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},d=new Lc(5,5,5),e=new Li({name:"CubemapFromEquirect",uniforms:Ld(c.uniforms),vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,side:1,blending:0});e.uniforms.tEquirect.value=b;let f=new La(d,e),g=b.minFilter;return 1008===b.minFilter&&(b.minFilter=1006),new Lo(1,10,this).update(a,f),b.minFilter=g,f.geometry.dispose(),f.material.dispose(),this}clear(a,b=!0,c=!0,d=!0){let e=a.getRenderTarget();for(let e=0;e<6;e++)a.setRenderTarget(this,e),a.clear(b,c,d);a.setRenderTarget(e)}}class Lr extends Ko{constructor(){super(),this.isGroup=!0,this.type="Group"}}let Ls={type:"move"};class Lt{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Lr,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Lr,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Je,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Je),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Lr,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Je,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Je),this._grip}dispatchEvent(a){return null!==this._targetRay&&this._targetRay.dispatchEvent(a),null!==this._grip&&this._grip.dispatchEvent(a),null!==this._hand&&this._hand.dispatchEvent(a),this}connect(a){if(a&&a.hand){let b=this._hand;if(b)for(let c of a.hand.values())this._getHandJoint(b,c)}return this.dispatchEvent({type:"connected",data:a}),this}disconnect(a){return this.dispatchEvent({type:"disconnected",data:a}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(a,b,c){let d=null,e=null,f=null,g=this._targetRay,h=this._grip,i=this._hand;if(a&&"visible-blurred"!==b.session.visibilityState){if(i&&a.hand){for(let d of(f=!0,a.hand.values())){let a=b.getJointPose(d,c),e=this._getHandJoint(i,d);null!==a&&(e.matrix.fromArray(a.transform.matrix),e.matrix.decompose(e.position,e.rotation,e.scale),e.matrixWorldNeedsUpdate=!0,e.jointRadius=a.radius),e.visible=null!==a}let d=i.joints["index-finger-tip"],e=i.joints["thumb-tip"],g=d.position.distanceTo(e.position);i.inputState.pinching&&g>.025?(i.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:a.handedness,target:this})):!i.inputState.pinching&&g<=.015&&(i.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:a.handedness,target:this}))}else null!==h&&a.gripSpace&&null!==(e=b.getPose(a.gripSpace,c))&&(h.matrix.fromArray(e.transform.matrix),h.matrix.decompose(h.position,h.rotation,h.scale),h.matrixWorldNeedsUpdate=!0,e.linearVelocity?(h.hasLinearVelocity=!0,h.linearVelocity.copy(e.linearVelocity)):h.hasLinearVelocity=!1,e.angularVelocity?(h.hasAngularVelocity=!0,h.angularVelocity.copy(e.angularVelocity)):h.hasAngularVelocity=!1);null!==g&&(null===(d=b.getPose(a.targetRaySpace,c))&&null!==e&&(d=e),null!==d&&(g.matrix.fromArray(d.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.matrixWorldNeedsUpdate=!0,d.linearVelocity?(g.hasLinearVelocity=!0,g.linearVelocity.copy(d.linearVelocity)):g.hasLinearVelocity=!1,d.angularVelocity?(g.hasAngularVelocity=!0,g.angularVelocity.copy(d.angularVelocity)):g.hasAngularVelocity=!1,this.dispatchEvent(Ls)))}return null!==g&&(g.visible=null!==d),null!==h&&(h.visible=null!==e),null!==i&&(i.visible=null!==f),this}_getHandJoint(a,b){if(void 0===a.joints[b.jointName]){let c=new Lr;c.matrixAutoUpdate=!1,c.visible=!1,a.joints[b.jointName]=c,a.add(c)}return a.joints[b.jointName]}}let Lu=class{constructor(a,b){this.isInterleavedBuffer=!0,this.array=a,this.stride=b,this.count=void 0!==a?a.length/b:0,this.usage=35044,this.updateRanges=[],this.version=0,this.uuid=I7()}onUploadCallback(){}set needsUpdate(a){!0===a&&this.version++}setUsage(a){return this.usage=a,this}addUpdateRange(a,b){this.updateRanges.push({start:a,count:b})}clearUpdateRanges(){this.updateRanges.length=0}copy(a){return this.array=new a.array.constructor(a.array),this.count=a.count,this.stride=a.stride,this.usage=a.usage,this}copyAt(a,b,c){a*=this.stride,c*=b.stride;for(let d=0,e=this.stride;d<e;d++)this.array[a+d]=b.array[c+d];return this}set(a,b=0){return this.array.set(a,b),this}clone(a){void 0===a.arrayBuffers&&(a.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=I7()),void 0===a.arrayBuffers[this.array.buffer._uuid]&&(a.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let b=new this.array.constructor(a.arrayBuffers[this.array.buffer._uuid]),c=new this.constructor(b,this.stride);return c.setUsage(this.usage),c}onUpload(a){return this.onUploadCallback=a,this}toJSON(a){return void 0===a.arrayBuffers&&(a.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=I7()),void 0===a.arrayBuffers[this.array.buffer._uuid]&&(a.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},Lv=new Je,Lw=class a{constructor(a,b,c,d=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=a,this.itemSize=b,this.offset=c,this.normalized=d}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(a){this.data.needsUpdate=a}applyMatrix4(a){for(let b=0,c=this.data.count;b<c;b++)Lv.fromBufferAttribute(this,b),Lv.applyMatrix4(a),this.setXYZ(b,Lv.x,Lv.y,Lv.z);return this}applyNormalMatrix(a){for(let b=0,c=this.count;b<c;b++)Lv.fromBufferAttribute(this,b),Lv.applyNormalMatrix(a),this.setXYZ(b,Lv.x,Lv.y,Lv.z);return this}transformDirection(a){for(let b=0,c=this.count;b<c;b++)Lv.fromBufferAttribute(this,b),Lv.transformDirection(a),this.setXYZ(b,Lv.x,Lv.y,Lv.z);return this}getComponent(a,b){let c=this.array[a*this.data.stride+this.offset+b];return this.normalized&&(c=Ja(c,this.array)),c}setComponent(a,b,c){return this.normalized&&(c=Jb(c,this.array)),this.data.array[a*this.data.stride+this.offset+b]=c,this}setX(a,b){return this.normalized&&(b=Jb(b,this.array)),this.data.array[a*this.data.stride+this.offset]=b,this}setY(a,b){return this.normalized&&(b=Jb(b,this.array)),this.data.array[a*this.data.stride+this.offset+1]=b,this}setZ(a,b){return this.normalized&&(b=Jb(b,this.array)),this.data.array[a*this.data.stride+this.offset+2]=b,this}setW(a,b){return this.normalized&&(b=Jb(b,this.array)),this.data.array[a*this.data.stride+this.offset+3]=b,this}getX(a){let b=this.data.array[a*this.data.stride+this.offset];return this.normalized&&(b=Ja(b,this.array)),b}getY(a){let b=this.data.array[a*this.data.stride+this.offset+1];return this.normalized&&(b=Ja(b,this.array)),b}getZ(a){let b=this.data.array[a*this.data.stride+this.offset+2];return this.normalized&&(b=Ja(b,this.array)),b}getW(a){let b=this.data.array[a*this.data.stride+this.offset+3];return this.normalized&&(b=Ja(b,this.array)),b}setXY(a,b,c){return a=a*this.data.stride+this.offset,this.normalized&&(b=Jb(b,this.array),c=Jb(c,this.array)),this.data.array[a+0]=b,this.data.array[a+1]=c,this}setXYZ(a,b,c,d){return a=a*this.data.stride+this.offset,this.normalized&&(b=Jb(b,this.array),c=Jb(c,this.array),d=Jb(d,this.array)),this.data.array[a+0]=b,this.data.array[a+1]=c,this.data.array[a+2]=d,this}setXYZW(a,b,c,d,e){return a=a*this.data.stride+this.offset,this.normalized&&(b=Jb(b,this.array),c=Jb(c,this.array),d=Jb(d,this.array),e=Jb(e,this.array)),this.data.array[a+0]=b,this.data.array[a+1]=c,this.data.array[a+2]=d,this.data.array[a+3]=e,this}clone(b){if(void 0!==b)return void 0===b.interleavedBuffers&&(b.interleavedBuffers={}),void 0===b.interleavedBuffers[this.data.uuid]&&(b.interleavedBuffers[this.data.uuid]=this.data.clone(b)),new a(b.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized);{I_("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let a=[];for(let b=0;b<this.count;b++){let c=b*this.data.stride+this.offset;for(let b=0;b<this.itemSize;b++)a.push(this.data.array[c+b])}return new KP(new this.array.constructor(a),this.itemSize,this.normalized)}}toJSON(a){if(void 0!==a)return void 0===a.interleavedBuffers&&(a.interleavedBuffers={}),void 0===a.interleavedBuffers[this.data.uuid]&&(a.interleavedBuffers[this.data.uuid]=this.data.toJSON(a)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized};{I_("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let a=[];for(let b=0;b<this.count;b++){let c=b*this.data.stride+this.offset;for(let b=0;b<this.itemSize;b++)a.push(this.data.array[c+b])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:a,normalized:this.normalized}}}};class Lx extends Ju{constructor(a=null,b=1,c=1,d,e,f,g,h,i=1003,j=1003,k,l){super(null,f,g,h,i,j,d,e,k,l),this.isDataTexture=!0,this.image={data:a,width:b,height:c},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Ly extends KP{constructor(a,b,c,d=1){super(a,b,c),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=d}copy(a){return super.copy(a),this.meshPerAttribute=a.meshPerAttribute,this}toJSON(){let a=super.toJSON();return a.meshPerAttribute=this.meshPerAttribute,a.isInstancedBufferAttribute=!0,a}}let Lz=new Je,LA=new Je,LB=new Jh;class LC{constructor(a=new Je(1,0,0),b=0){this.isPlane=!0,this.normal=a,this.constant=b}set(a,b){return this.normal.copy(a),this.constant=b,this}setComponents(a,b,c,d){return this.normal.set(a,b,c),this.constant=d,this}setFromNormalAndCoplanarPoint(a,b){return this.normal.copy(a),this.constant=-b.dot(this.normal),this}setFromCoplanarPoints(a,b,c){let d=Lz.subVectors(c,b).cross(LA.subVectors(a,b)).normalize();return this.setFromNormalAndCoplanarPoint(d,a),this}copy(a){return this.normal.copy(a.normal),this.constant=a.constant,this}normalize(){let a=1/this.normal.length();return this.normal.multiplyScalar(a),this.constant*=a,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(a){return this.normal.dot(a)+this.constant}distanceToSphere(a){return this.distanceToPoint(a.center)-a.radius}projectPoint(a,b){return b.copy(a).addScaledVector(this.normal,-this.distanceToPoint(a))}intersectLine(a,b){let c=a.delta(Lz),d=this.normal.dot(c);if(0===d)return 0===this.distanceToPoint(a.start)?b.copy(a.start):null;let e=-(a.start.dot(this.normal)+this.constant)/d;return e<0||e>1?null:b.copy(a.start).addScaledVector(c,e)}intersectsLine(a){let b=this.distanceToPoint(a.start),c=this.distanceToPoint(a.end);return b<0&&c>0||c<0&&b>0}intersectsBox(a){return a.intersectsPlane(this)}intersectsSphere(a){return a.intersectsPlane(this)}coplanarPoint(a){return a.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(a,b){let c=b||LB.getNormalMatrix(a),d=this.coplanarPoint(Lz).applyMatrix4(a),e=this.normal.applyMatrix3(c).normalize();return this.constant=-d.dot(e),this}translate(a){return this.constant-=a.dot(this.normal),this}equals(a){return a.normal.equals(this.normal)&&a.constant===this.constant}clone(){return new this.constructor().copy(this)}}let LD=new JR,LE=new Jc(.5,.5),LF=new Je;class LG{constructor(a=new LC,b=new LC,c=new LC,d=new LC,e=new LC,f=new LC){this.planes=[a,b,c,d,e,f]}set(a,b,c,d,e,f){let g=this.planes;return g[0].copy(a),g[1].copy(b),g[2].copy(c),g[3].copy(d),g[4].copy(e),g[5].copy(f),this}copy(a){let b=this.planes;for(let c=0;c<6;c++)b[c].copy(a.planes[c]);return this}setFromProjectionMatrix(a,b=2e3,c=!1){let d=this.planes,e=a.elements,f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=e[5],l=e[6],m=e[7],n=e[8],o=e[9],p=e[10],q=e[11],r=e[12],s=e[13],t=e[14],u=e[15];if(d[0].setComponents(i-f,m-j,q-n,u-r).normalize(),d[1].setComponents(i+f,m+j,q+n,u+r).normalize(),d[2].setComponents(i+g,m+k,q+o,u+s).normalize(),d[3].setComponents(i-g,m-k,q-o,u-s).normalize(),c)d[4].setComponents(h,l,p,t).normalize(),d[5].setComponents(i-h,m-l,q-p,u-t).normalize();else if(d[4].setComponents(i-h,m-l,q-p,u-t).normalize(),2e3===b)d[5].setComponents(i+h,m+l,q+p,u+t).normalize();else if(2001===b)d[5].setComponents(h,l,p,t).normalize();else throw Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+b);return this}intersectsObject(a){if(void 0!==a.boundingSphere)null===a.boundingSphere&&a.computeBoundingSphere(),LD.copy(a.boundingSphere).applyMatrix4(a.matrixWorld);else{let b=a.geometry;null===b.boundingSphere&&b.computeBoundingSphere(),LD.copy(b.boundingSphere).applyMatrix4(a.matrixWorld)}return this.intersectsSphere(LD)}intersectsSprite(a){return LD.center.set(0,0,0),LD.radius=.7071067811865476+LE.distanceTo(a.center),LD.applyMatrix4(a.matrixWorld),this.intersectsSphere(LD)}intersectsSphere(a){let b=this.planes,c=a.center,d=-a.radius;for(let a=0;a<6;a++)if(b[a].distanceToPoint(c)<d)return!1;return!0}intersectsBox(a){let b=this.planes;for(let c=0;c<6;c++){let d=b[c];if(LF.x=d.normal.x>0?a.max.x:a.min.x,LF.y=d.normal.y>0?a.max.y:a.min.y,LF.z=d.normal.z>0?a.max.z:a.min.z,0>d.distanceToPoint(LF))return!1}return!0}containsPoint(a){let b=this.planes;for(let c=0;c<6;c++)if(0>b[c].distanceToPoint(a))return!1;return!0}clone(){return new this.constructor().copy(this)}}class LH extends Ju{constructor(a,b){super({width:a,height:b}),this.isFramebufferTexture=!0,this.magFilter=1003,this.minFilter=1003,this.generateMipmaps=!1,this.needsUpdate=!0}}class LI extends Ju{constructor(a,b,c=1014,d,e,f,g=1003,h=1003,i,j=1026,k=1){if(1026!==j&&1027!==j)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super({width:a,height:b,depth:k},d,e,f,g,h,j,c,i),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(a){return super.copy(a),this.source=new Jq(Object.assign({},a.image)),this.compareFunction=a.compareFunction,this}toJSON(a){let b=super.toJSON(a);return null!==this.compareFunction&&(b.compareFunction=this.compareFunction),b}}class LJ extends Ju{constructor(a=null){super(),this.sourceTexture=a,this.isExternalTexture=!0}copy(a){return super.copy(a),this.sourceTexture=a.sourceTexture,this}}class LK extends K${constructor(a=1,b=1,c=1,d=1){super(),this.type="PlaneGeometry",this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};const e=a/2,f=b/2,g=Math.floor(c),h=Math.floor(d),i=g+1,j=h+1,k=a/g,l=b/h,m=[],n=[],o=[],p=[];for(let a=0;a<j;a++){const b=a*l-f;for(let c=0;c<i;c++){const d=c*k-e;n.push(d,-b,0),o.push(0,0,1),p.push(c/g),p.push(1-a/h)}}for(let a=0;a<h;a++)for(let b=0;b<g;b++){const c=b+i*a,d=b+i*(a+1),e=b+1+i*(a+1),f=b+1+i*a;m.push(c,d,f),m.push(d,e,f)}this.setIndex(m),this.setAttribute("position",new KS(n,3)),this.setAttribute("normal",new KS(o,3)),this.setAttribute("uv",new KS(p,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new LK(a.width,a.height,a.widthSegments,a.heightSegments)}}class LL extends KK{constructor(a){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(a)}copy(a){return super.copy(a),this.depthPacking=a.depthPacking,this.map=a.map,this.alphaMap=a.alphaMap,this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this}}class LM extends KK{constructor(a){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(a)}copy(a){return super.copy(a),this.map=a.map,this.alphaMap=a.alphaMap,this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this}}class LN extends Lj{constructor(a=-1,b=1,c=1,d=-1,e=.1,f=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=a,this.right=b,this.top=c,this.bottom=d,this.near=e,this.far=f,this.updateProjectionMatrix()}copy(a,b){return super.copy(a,b),this.left=a.left,this.right=a.right,this.top=a.top,this.bottom=a.bottom,this.near=a.near,this.far=a.far,this.zoom=a.zoom,this.view=null===a.view?null:Object.assign({},a.view),this}setViewOffset(a,b,c,d,e,f){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=a,this.view.fullHeight=b,this.view.offsetX=c,this.view.offsetY=d,this.view.width=e,this.view.height=f,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let a=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,d=(this.top+this.bottom)/2,e=c-a,f=c+a,g=d+b,h=d-b;if(null!==this.view&&this.view.enabled){let a=(this.right-this.left)/this.view.fullWidth/this.zoom,b=(this.top-this.bottom)/this.view.fullHeight/this.zoom;e+=a*this.view.offsetX,f=e+a*this.view.width,g-=b*this.view.offsetY,h=g-b*this.view.height}this.projectionMatrix.makeOrthographic(e,f,g,h,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(a){let b=super.toJSON(a);return b.object.zoom=this.zoom,b.object.left=this.left,b.object.right=this.right,b.object.top=this.top,b.object.bottom=this.bottom,b.object.near=this.near,b.object.far=this.far,null!==this.view&&(b.object.view=Object.assign({},this.view)),b}}class LO extends Ln{constructor(a=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=a}}class LP extends Lu{constructor(a,b,c=1){super(a,b),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=c}copy(a){return super.copy(a),this.meshPerAttribute=a.meshPerAttribute,this}clone(a){let b=super.clone(a);return b.meshPerAttribute=this.meshPerAttribute,b}toJSON(a){let b=super.toJSON(a);return b.isInstancedInterleavedBuffer=!0,b.meshPerAttribute=this.meshPerAttribute,b}}let LQ=class a{constructor(b,c,d,e){a.prototype.isMatrix2=!0,this.elements=[1,0,0,1],void 0!==b&&this.set(b,c,d,e)}identity(){return this.set(1,0,0,1),this}fromArray(a,b=0){for(let c=0;c<4;c++)this.elements[c]=a[c+b];return this}set(a,b,c,d){let e=this.elements;return e[0]=a,e[2]=b,e[1]=c,e[3]=d,this}};function LR(a,b,c,d){let e=function(a){switch(a){case 1009:case 1010:return{byteLength:1,components:1};case 1012:case 1011:case 1016:return{byteLength:2,components:1};case 1017:case 1018:return{byteLength:2,components:4};case 1014:case 1013:case 1015:return{byteLength:4,components:1};case 35902:case 35899:return{byteLength:4,components:3}}throw Error(`Unknown texture type ${a}.`)}(d);switch(c){case 1021:return a*b;case 1028:case 1029:return a*b/e.components*e.byteLength;case 1030:case 1031:return a*b*2/e.components*e.byteLength;case 1022:return a*b*3/e.components*e.byteLength;case 1023:case 1033:return a*b*4/e.components*e.byteLength;case 33776:case 33777:case 36196:case 37492:return Math.floor((a+3)/4)*Math.floor((b+3)/4)*8;case 33778:case 33779:case 37496:case 37808:return Math.floor((a+3)/4)*Math.floor((b+3)/4)*16;case 35841:case 35843:return Math.max(a,16)*Math.max(b,8)/4;case 35840:case 35842:return Math.max(a,8)*Math.max(b,8)/2;case 37809:return Math.floor((a+4)/5)*Math.floor((b+3)/4)*16;case 37810:return Math.floor((a+4)/5)*Math.floor((b+4)/5)*16;case 37811:return Math.floor((a+5)/6)*Math.floor((b+4)/5)*16;case 37812:return Math.floor((a+5)/6)*Math.floor((b+5)/6)*16;case 37813:return Math.floor((a+7)/8)*Math.floor((b+4)/5)*16;case 37814:return Math.floor((a+7)/8)*Math.floor((b+5)/6)*16;case 37815:return Math.floor((a+7)/8)*Math.floor((b+7)/8)*16;case 37816:return Math.floor((a+9)/10)*Math.floor((b+4)/5)*16;case 37817:return Math.floor((a+9)/10)*Math.floor((b+5)/6)*16;case 37818:return Math.floor((a+9)/10)*Math.floor((b+7)/8)*16;case 37819:return Math.floor((a+9)/10)*Math.floor((b+9)/10)*16;case 37820:return Math.floor((a+11)/12)*Math.floor((b+9)/10)*16;case 37821:return Math.floor((a+11)/12)*Math.floor((b+11)/12)*16;case 36492:case 36494:case 36495:case 36285:case 36286:return Math.ceil(a/4)*Math.ceil(b/4)*16;case 36283:case 36284:return Math.ceil(a/4)*Math.ceil(b/4)*8}throw Error(`Unable to determine texture byte length for ${c} format.`)}function LS(){let a=null,b=!1,c=null,d=null;function e(b,f){c(b,f),d=a.requestAnimationFrame(e)}return{start:function(){!0!==b&&null!==c&&(d=a.requestAnimationFrame(e),b=!0)},stop:function(){a.cancelAnimationFrame(d),b=!1},setAnimationLoop:function(a){c=a},setContext:function(b){a=b}}}function LT(a){let b=new WeakMap;return{get:function(a){return a.isInterleavedBufferAttribute&&(a=a.data),b.get(a)},remove:function(c){c.isInterleavedBufferAttribute&&(c=c.data);let d=b.get(c);d&&(a.deleteBuffer(d.buffer),b.delete(c))},update:function(c,d){if(c.isInterleavedBufferAttribute&&(c=c.data),c.isGLBufferAttribute){let a=b.get(c);(!a||a.version<c.version)&&b.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}let e=b.get(c);if(void 0===e)b.set(c,function(b,c){let d,e=b.array,f=b.usage,g=e.byteLength,h=a.createBuffer();if(a.bindBuffer(c,h),a.bufferData(c,e,f),b.onUploadCallback(),e instanceof Float32Array)d=a.FLOAT;else if("u">typeof Float16Array&&e instanceof Float16Array)d=a.HALF_FLOAT;else if(e instanceof Uint16Array)d=b.isFloat16BufferAttribute?a.HALF_FLOAT:a.UNSIGNED_SHORT;else if(e instanceof Int16Array)d=a.SHORT;else if(e instanceof Uint32Array)d=a.UNSIGNED_INT;else if(e instanceof Int32Array)d=a.INT;else if(e instanceof Int8Array)d=a.BYTE;else if(e instanceof Uint8Array)d=a.UNSIGNED_BYTE;else if(e instanceof Uint8ClampedArray)d=a.UNSIGNED_BYTE;else throw Error("THREE.WebGLAttributes: Unsupported buffer data format: "+e);return{buffer:h,type:d,bytesPerElement:e.BYTES_PER_ELEMENT,version:b.version,size:g}}(c,d));else if(e.version<c.version){if(e.size!==c.array.byteLength)throw Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");(function(b,c,d){let e=c.array,f=c.updateRanges;if(a.bindBuffer(d,b),0===f.length)a.bufferSubData(d,0,e);else{f.sort((a,b)=>a.start-b.start);let b=0;for(let a=1;a<f.length;a++){let c=f[b],d=f[a];d.start<=c.start+c.count+1?c.count=Math.max(c.count,d.start+d.count-c.start):f[++b]=d}f.length=b+1;for(let b=0,c=f.length;b<c;b++){let c=f[b];a.bufferSubData(d,c.start*e.BYTES_PER_ELEMENT,e,c.start,c.count)}c.clearUpdateRanges()}c.onUploadCallback()})(e.buffer,c,d),e.version=c.version}}}}"u">typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"181"}}));let LU={alphahash_fragment:`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,alphahash_pars_fragment:`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,alphamap_fragment:`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,alphatest_pars_fragment:`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,batching_pars_vertex:`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,batching_vertex:`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,begin_vertex:`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment:`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, pow4( roughness ) ) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment:`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment:`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,lights_physical_pars_fragment:`uniform sampler2D dfgLUT;
struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transpose( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 uv = vec2( roughness, dotNV );
	return texture2D( dfgLUT, uv ).rg;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
vec3 BRDF_GGX_Multiscatter( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 singleScatter = BRDF_GGX( lightDir, viewDir, normal, material );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 dfgV = DFGApprox( vec3(0.0, 0.0, 1.0), vec3(sqrt(1.0 - dotNV * dotNV), 0.0, dotNV), material.roughness );
	vec2 dfgL = DFGApprox( vec3(0.0, 0.0, 1.0), vec3(sqrt(1.0 - dotNL * dotNL), 0.0, dotNL), material.roughness );
	vec3 FssEss_V = material.specularColor * dfgV.x + material.specularF90 * dfgV.y;
	vec3 FssEss_L = material.specularColor * dfgL.x + material.specularF90 * dfgL.y;
	float Ess_V = dfgV.x + dfgV.y;
	float Ess_L = dfgL.x + dfgL.y;
	float Ems_V = 1.0 - Ess_V;
	float Ems_L = 1.0 - Ess_L;
	vec3 Favg = material.specularColor + ( 1.0 - material.specularColor ) * 0.047619;
	vec3 Fms = FssEss_V * FssEss_L * Favg / ( 1.0 - Ems_V * Ems_L * Favg * Favg + EPSILON );
	float compensationFactor = Ems_V * Ems_L;
	vec3 multiScatter = Fms * compensationFactor;
	return singleScatter + multiScatter;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX_Multiscatter( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,map_fragment:`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphinstance_vertex:`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,morphcolor_vertex:`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,normal_fragment_maps:`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment:`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,opaque_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		float depth = unpackRGBAToDepth( texture2D( depths, uv ) );
		#ifdef USE_REVERSED_DEPTH_BUFFER
			return step( depth, compare );
		#else
			return step( compare, depth );
		#endif
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow( sampler2D shadow, vec2 uv, float compare ) {
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		#ifdef USE_REVERSED_DEPTH_BUFFER
			float hard_shadow = step( distribution.x, compare );
		#else
			float hard_shadow = step( compare, distribution.x );
		#endif
		if ( hard_shadow != 1.0 ) {
			float distance = compare - distribution.x;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,shadowmap_pars_vertex:`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,uv_pars_fragment:`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex:`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex:`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,backgroundCube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,backgroundCube_frag:`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,depth_vert:`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	#ifdef USE_REVERSED_DEPTH_BUFFER
		float fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];
	#else
		float fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;
	#endif
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`},LV={common:{diffuse:{value:new KH(0xffffff)},opacity:{value:1},map:{value:null},mapTransform:{value:new Jh},alphaMap:{value:null},alphaMapTransform:{value:new Jh},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Jh}},envmap:{envMap:{value:null},envMapRotation:{value:new Jh},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},dfgLUT:{value:null}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Jh}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Jh}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Jh},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Jh},normalScale:{value:new Jc(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Jh},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Jh}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Jh}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Jh}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new KH(0xffffff)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new KH(0xffffff)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Jh},alphaTest:{value:0},uvTransform:{value:new Jh}},sprite:{diffuse:{value:new KH(0xffffff)},opacity:{value:1},center:{value:new Jc(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Jh},alphaMap:{value:null},alphaMapTransform:{value:new Jh},alphaTest:{value:0}}},LW={basic:{uniforms:Le([LV.common,LV.specularmap,LV.envmap,LV.aomap,LV.lightmap,LV.fog]),vertexShader:LU.meshbasic_vert,fragmentShader:LU.meshbasic_frag},lambert:{uniforms:Le([LV.common,LV.specularmap,LV.envmap,LV.aomap,LV.lightmap,LV.emissivemap,LV.bumpmap,LV.normalmap,LV.displacementmap,LV.fog,LV.lights,{emissive:{value:new KH(0)}}]),vertexShader:LU.meshlambert_vert,fragmentShader:LU.meshlambert_frag},phong:{uniforms:Le([LV.common,LV.specularmap,LV.envmap,LV.aomap,LV.lightmap,LV.emissivemap,LV.bumpmap,LV.normalmap,LV.displacementmap,LV.fog,LV.lights,{emissive:{value:new KH(0)},specular:{value:new KH(1118481)},shininess:{value:30}}]),vertexShader:LU.meshphong_vert,fragmentShader:LU.meshphong_frag},standard:{uniforms:Le([LV.common,LV.envmap,LV.aomap,LV.lightmap,LV.emissivemap,LV.bumpmap,LV.normalmap,LV.displacementmap,LV.roughnessmap,LV.metalnessmap,LV.fog,LV.lights,{emissive:{value:new KH(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:LU.meshphysical_vert,fragmentShader:LU.meshphysical_frag},toon:{uniforms:Le([LV.common,LV.aomap,LV.lightmap,LV.emissivemap,LV.bumpmap,LV.normalmap,LV.displacementmap,LV.gradientmap,LV.fog,LV.lights,{emissive:{value:new KH(0)}}]),vertexShader:LU.meshtoon_vert,fragmentShader:LU.meshtoon_frag},matcap:{uniforms:Le([LV.common,LV.bumpmap,LV.normalmap,LV.displacementmap,LV.fog,{matcap:{value:null}}]),vertexShader:LU.meshmatcap_vert,fragmentShader:LU.meshmatcap_frag},points:{uniforms:Le([LV.points,LV.fog]),vertexShader:LU.points_vert,fragmentShader:LU.points_frag},dashed:{uniforms:Le([LV.common,LV.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:LU.linedashed_vert,fragmentShader:LU.linedashed_frag},depth:{uniforms:Le([LV.common,LV.displacementmap]),vertexShader:LU.depth_vert,fragmentShader:LU.depth_frag},normal:{uniforms:Le([LV.common,LV.bumpmap,LV.normalmap,LV.displacementmap,{opacity:{value:1}}]),vertexShader:LU.meshnormal_vert,fragmentShader:LU.meshnormal_frag},sprite:{uniforms:Le([LV.sprite,LV.fog]),vertexShader:LU.sprite_vert,fragmentShader:LU.sprite_frag},background:{uniforms:{uvTransform:{value:new Jh},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:LU.background_vert,fragmentShader:LU.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Jh}},vertexShader:LU.backgroundCube_vert,fragmentShader:LU.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:LU.cube_vert,fragmentShader:LU.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:LU.equirect_vert,fragmentShader:LU.equirect_frag},distanceRGBA:{uniforms:Le([LV.common,LV.displacementmap,{referencePosition:{value:new Je},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:LU.distanceRGBA_vert,fragmentShader:LU.distanceRGBA_frag},shadow:{uniforms:Le([LV.lights,LV.fog,{color:{value:new KH(0)},opacity:{value:1}}]),vertexShader:LU.shadow_vert,fragmentShader:LU.shadow_frag}};LW.physical={uniforms:Le([LW.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Jh},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Jh},clearcoatNormalScale:{value:new Jc(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Jh},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Jh},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Jh},sheen:{value:0},sheenColor:{value:new KH(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Jh},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Jh},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Jh},transmissionSamplerSize:{value:new Jc},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Jh},attenuationDistance:{value:0},attenuationColor:{value:new KH(0)},specularColor:{value:new KH(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Jh},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Jh},anisotropyVector:{value:new Jc},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Jh}}]),vertexShader:LU.meshphysical_vert,fragmentShader:LU.meshphysical_frag};let LX={r:0,b:0,g:0},LY=new J7,LZ=new JZ;function L$(a,b,c,d,e,f,g){let h=new KH(0),i=+(!0!==f),j,k,l=null,m=0,n=null;function o(a){let d=!0===a.isScene?a.background:null;return d&&d.isTexture&&(d=(a.backgroundBlurriness>0?c:b).get(d)),d}function p(b,c){b.getRGB(LX,Lf(a)),d.buffers.color.setClear(LX.r,LX.g,LX.b,c,g)}return{getClearColor:function(){return h},setClearColor:function(a,b=1){h.set(a),p(h,i=b)},getClearAlpha:function(){return i},setClearAlpha:function(a){p(h,i=a)},render:function(b){let c=!1,e=o(b);null===e?p(h,i):e&&e.isColor&&(p(e,1),c=!0);let f=a.xr.getEnvironmentBlendMode();"additive"===f?d.buffers.color.setClear(0,0,0,1,g):"alpha-blend"===f&&d.buffers.color.setClear(0,0,0,0,g),(a.autoClear||c)&&(d.buffers.depth.setTest(!0),d.buffers.depth.setMask(!0),d.buffers.color.setMask(!0),a.clear(a.autoClearColor,a.autoClearDepth,a.autoClearStencil))},addToRenderList:function(b,c){let d=o(c);d&&(d.isCubeTexture||306===d.mapping)?(void 0===k&&((k=new La(new Lc(1,1,1),new Li({name:"BackgroundCubeMaterial",uniforms:Ld(LW.backgroundCube.uniforms),vertexShader:LW.backgroundCube.vertexShader,fragmentShader:LW.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1}))).geometry.deleteAttribute("normal"),k.geometry.deleteAttribute("uv"),k.onBeforeRender=function(a,b,c){this.matrixWorld.copyPosition(c.matrixWorld)},Object.defineProperty(k.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),e.update(k)),LY.copy(c.backgroundRotation),LY.x*=-1,LY.y*=-1,LY.z*=-1,d.isCubeTexture&&!1===d.isRenderTargetTexture&&(LY.y*=-1,LY.z*=-1),k.material.uniforms.envMap.value=d,k.material.uniforms.flipEnvMap.value=d.isCubeTexture&&!1===d.isRenderTargetTexture?-1:1,k.material.uniforms.backgroundBlurriness.value=c.backgroundBlurriness,k.material.uniforms.backgroundIntensity.value=c.backgroundIntensity,k.material.uniforms.backgroundRotation.value.setFromMatrix4(LZ.makeRotationFromEuler(LY)),k.material.toneMapped=Jl.getTransfer(d.colorSpace)!==IW,(l!==d||m!==d.version||n!==a.toneMapping)&&(k.material.needsUpdate=!0,l=d,m=d.version,n=a.toneMapping),k.layers.enableAll(),b.unshift(k,k.geometry,k.material,0,0,null)):d&&d.isTexture&&(void 0===j&&((j=new La(new LK(2,2),new Li({name:"BackgroundMaterial",uniforms:Ld(LW.background.uniforms),vertexShader:LW.background.vertexShader,fragmentShader:LW.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(j.material,"map",{get:function(){return this.uniforms.t2D.value}}),e.update(j)),j.material.uniforms.t2D.value=d,j.material.uniforms.backgroundIntensity.value=c.backgroundIntensity,j.material.toneMapped=Jl.getTransfer(d.colorSpace)!==IW,!0===d.matrixAutoUpdate&&d.updateMatrix(),j.material.uniforms.uvTransform.value.copy(d.matrix),(l!==d||m!==d.version||n!==a.toneMapping)&&(j.material.needsUpdate=!0,l=d,m=d.version,n=a.toneMapping),j.layers.enableAll(),b.unshift(j,j.geometry,j.material,0,0,null))},dispose:function(){void 0!==k&&(k.geometry.dispose(),k.material.dispose(),k=void 0),void 0!==j&&(j.geometry.dispose(),j.material.dispose(),j=void 0)}}}function L_(a,b){let c=a.getParameter(a.MAX_VERTEX_ATTRIBS),d={},e=j(null),f=e,g=!1;function h(b){return a.bindVertexArray(b)}function i(b){return a.deleteVertexArray(b)}function j(a){let b=[],d=[],e=[];for(let a=0;a<c;a++)b[a]=0,d[a]=0,e[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:b,enabledAttributes:d,attributeDivisors:e,object:a,attributes:{},index:null}}function k(){let a=f.newAttributes;for(let b=0,c=a.length;b<c;b++)a[b]=0}function l(a){m(a,0)}function m(b,c){let d=f.newAttributes,e=f.enabledAttributes,g=f.attributeDivisors;d[b]=1,0===e[b]&&(a.enableVertexAttribArray(b),e[b]=1),g[b]!==c&&(a.vertexAttribDivisor(b,c),g[b]=c)}function n(){let b=f.newAttributes,c=f.enabledAttributes;for(let d=0,e=c.length;d<e;d++)c[d]!==b[d]&&(a.disableVertexAttribArray(d),c[d]=0)}function o(b,c,d,e,f,g,h){!0===h?a.vertexAttribIPointer(b,c,d,f,g):a.vertexAttribPointer(b,c,d,e,f,g)}function p(){q(),g=!0,f!==e&&h((f=e).object)}function q(){e.geometry=null,e.program=null,e.wireframe=!1}return{setup:function(c,e,i,p,q){var r,s;let t,u,v,w,x=!1,y=(r=p,s=i,t=!0===e.wireframe,void 0===(u=d[r.id])&&(u={},d[r.id]=u),void 0===(v=u[s.id])&&(v={},u[s.id]=v),void 0===(w=v[t])&&(w=j(a.createVertexArray()),v[t]=w),w);f!==y&&h((f=y).object),(x=function(a,b,c,d){let e=f.attributes,g=b.attributes,h=0,i=c.getAttributes();for(let b in i)if(i[b].location>=0){let c=e[b],d=g[b];if(void 0===d&&("instanceMatrix"===b&&a.instanceMatrix&&(d=a.instanceMatrix),"instanceColor"===b&&a.instanceColor&&(d=a.instanceColor)),void 0===c||c.attribute!==d||d&&c.data!==d.data)return!0;h++}return f.attributesNum!==h||f.index!==d}(c,p,i,q))&&function(a,b,c,d){let e={},g=b.attributes,h=0,i=c.getAttributes();for(let b in i)if(i[b].location>=0){let c=g[b];void 0===c&&("instanceMatrix"===b&&a.instanceMatrix&&(c=a.instanceMatrix),"instanceColor"===b&&a.instanceColor&&(c=a.instanceColor));let d={};d.attribute=c,c&&c.data&&(d.data=c.data),e[b]=d,h++}f.attributes=e,f.attributesNum=h,f.index=d}(c,p,i,q),null!==q&&b.update(q,a.ELEMENT_ARRAY_BUFFER),(x||g)&&(g=!1,function(c,d,e,f){k();let g=f.attributes,h=e.getAttributes(),i=d.defaultAttributeValues;for(let d in h){let e=h[d];if(e.location>=0){let h=g[d];if(void 0===h&&("instanceMatrix"===d&&c.instanceMatrix&&(h=c.instanceMatrix),"instanceColor"===d&&c.instanceColor&&(h=c.instanceColor)),void 0!==h){let d=h.normalized,g=h.itemSize,i=b.get(h);if(void 0===i)continue;let j=i.buffer,k=i.type,n=i.bytesPerElement,p=k===a.INT||k===a.UNSIGNED_INT||1013===h.gpuType;if(h.isInterleavedBufferAttribute){let b=h.data,i=b.stride,q=h.offset;if(b.isInstancedInterleavedBuffer){for(let a=0;a<e.locationSize;a++)m(e.location+a,b.meshPerAttribute);!0!==c.isInstancedMesh&&void 0===f._maxInstanceCount&&(f._maxInstanceCount=b.meshPerAttribute*b.count)}else for(let a=0;a<e.locationSize;a++)l(e.location+a);a.bindBuffer(a.ARRAY_BUFFER,j);for(let a=0;a<e.locationSize;a++)o(e.location+a,g/e.locationSize,k,d,i*n,(q+g/e.locationSize*a)*n,p)}else{if(h.isInstancedBufferAttribute){for(let a=0;a<e.locationSize;a++)m(e.location+a,h.meshPerAttribute);!0!==c.isInstancedMesh&&void 0===f._maxInstanceCount&&(f._maxInstanceCount=h.meshPerAttribute*h.count)}else for(let a=0;a<e.locationSize;a++)l(e.location+a);a.bindBuffer(a.ARRAY_BUFFER,j);for(let a=0;a<e.locationSize;a++)o(e.location+a,g/e.locationSize,k,d,g*n,g/e.locationSize*a*n,p)}}else if(void 0!==i){let b=i[d];if(void 0!==b)switch(b.length){case 2:a.vertexAttrib2fv(e.location,b);break;case 3:a.vertexAttrib3fv(e.location,b);break;case 4:a.vertexAttrib4fv(e.location,b);break;default:a.vertexAttrib1fv(e.location,b)}}}}n()}(c,e,i,p),null!==q&&a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,b.get(q).buffer))},reset:p,resetDefaultState:q,dispose:function(){for(let a in p(),d){let b=d[a];for(let a in b){let c=b[a];for(let a in c)i(c[a].object),delete c[a];delete b[a]}delete d[a]}},releaseStatesOfGeometry:function(a){if(void 0===d[a.id])return;let b=d[a.id];for(let a in b){let c=b[a];for(let a in c)i(c[a].object),delete c[a];delete b[a]}delete d[a.id]},releaseStatesOfProgram:function(a){for(let b in d){let c=d[b];if(void 0===c[a.id])continue;let e=c[a.id];for(let a in e)i(e[a].object),delete e[a];delete c[a.id]}},initAttributes:k,enableAttribute:l,disableUnusedAttributes:n}}function L0(a,b,c){let d;function e(b,e,f){0!==f&&(a.drawArraysInstanced(d,b,e,f),c.update(e,d,f))}this.setMode=function(a){d=a},this.render=function(b,e){a.drawArrays(d,b,e),c.update(e,d,1)},this.renderInstances=e,this.renderMultiDraw=function(a,e,f){if(0===f)return;b.get("WEBGL_multi_draw").multiDrawArraysWEBGL(d,a,0,e,0,f);let g=0;for(let a=0;a<f;a++)g+=e[a];c.update(g,d,1)},this.renderMultiDrawInstances=function(a,f,g,h){if(0===g)return;let i=b.get("WEBGL_multi_draw");if(null===i)for(let b=0;b<a.length;b++)e(a[b],f[b],h[b]);else{i.multiDrawArraysInstancedWEBGL(d,a,0,f,0,h,0,g);let b=0;for(let a=0;a<g;a++)b+=f[a]*h[a];c.update(b,d,1)}}}function L1(a,b,c,d){let e;function f(b){if("highp"===b){if(a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT).precision>0&&a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision>0)return"highp";b="mediump"}return"mediump"===b&&a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.MEDIUM_FLOAT).precision>0&&a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let g=void 0!==c.precision?c.precision:"highp",h=f(g);h!==g&&(I0("WebGLRenderer:",g,"not supported, using",h,"instead."),g=h);let i=!0===c.logarithmicDepthBuffer,j=!0===c.reversedDepthBuffer&&b.has("EXT_clip_control"),k=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),l=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==e)return e;if(!0===b.has("EXT_texture_filter_anisotropic")){let c=b.get("EXT_texture_filter_anisotropic");e=a.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else e=0;return e},getMaxPrecision:f,textureFormatReadable:function(b){return 1023===b||d.convert(b)===a.getParameter(a.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(c){let e=1016===c&&(b.has("EXT_color_buffer_half_float")||b.has("EXT_color_buffer_float"));return!(1009!==c&&d.convert(c)!==a.getParameter(a.IMPLEMENTATION_COLOR_READ_TYPE)&&1015!==c&&!e)},precision:g,logarithmicDepthBuffer:i,reversedDepthBuffer:j,maxTextures:k,maxVertexTextures:l,maxTextureSize:a.getParameter(a.MAX_TEXTURE_SIZE),maxCubemapSize:a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:a.getParameter(a.MAX_VERTEX_ATTRIBS),maxVertexUniforms:a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:a.getParameter(a.MAX_VARYING_VECTORS),maxFragmentUniforms:a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:l>0,maxSamples:a.getParameter(a.MAX_SAMPLES)}}function L2(a){let b=this,c=null,d=0,e=!1,f=!1,g=new LC,h=new Jh,i={value:null,needsUpdate:!1};function j(a,c,d,e){let f=null!==a?a.length:0,j=null;if(0!==f){if(j=i.value,!0!==e||null===j){let b=d+4*f,e=c.matrixWorldInverse;h.getNormalMatrix(e),(null===j||j.length<b)&&(j=new Float32Array(b));for(let b=0,c=d;b!==f;++b,c+=4)g.copy(a[b]).applyMatrix4(e,h),g.normal.toArray(j,c),j[c+3]=g.constant}i.value=j,i.needsUpdate=!0}return b.numPlanes=f,b.numIntersection=0,j}this.uniform=i,this.numPlanes=0,this.numIntersection=0,this.init=function(a,b){let c=0!==a.length||b||0!==d||e;return e=b,d=a.length,c},this.beginShadows=function(){f=!0,j(null)},this.endShadows=function(){f=!1},this.setGlobalState=function(a,b){c=j(a,b,0)},this.setState=function(g,h,k){let l=g.clippingPlanes,m=g.clipIntersection,n=g.clipShadows,o=a.get(g);if(e&&null!==l&&0!==l.length&&(!f||n)){let a=f?0:d,b=4*a,e=o.clippingState||null;i.value=e,e=j(l,h,b,k);for(let a=0;a!==b;++a)e[a]=c[a];o.clippingState=e,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=a}else f?j(null):(i.value!==c&&(i.value=c,i.needsUpdate=d>0),b.numPlanes=d,b.numIntersection=0)}}function L3(a){let b=new WeakMap;function c(a,b){return 303===b?a.mapping=301:304===b&&(a.mapping=302),a}function d(a){let c=a.target;c.removeEventListener("dispose",d);let e=b.get(c);void 0!==e&&(b.delete(c),e.dispose())}return{get:function(e){if(e&&e.isTexture){let f=e.mapping;if(303===f||304===f)if(b.has(e))return c(b.get(e).texture,e.mapping);else{let f=e.image;if(!f||!(f.height>0))return null;{let g=new Lq(f.height);return g.fromEquirectangularTexture(a,e),b.set(e,g),e.addEventListener("dispose",d),c(g.texture,e.mapping)}}}return e},dispose:function(){b=new WeakMap}}}let L4=[.125,.215,.35,.446,.526,.582],L5=new LN,L6=new KH,L7=null,L8=0,L9=0,Ma=!1,Mb=new Je,Mc=class{constructor(a){this._renderer=a,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._backgroundBox=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._blurMaterial=null,this._ggxMaterial=null}fromScene(a,b=0,c=.1,d=100,e={}){let{size:f=256,position:g=Mb}=e;L7=this._renderer.getRenderTarget(),L8=this._renderer.getActiveCubeFace(),L9=this._renderer.getActiveMipmapLevel(),Ma=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(f);let h=this._allocateTargets();return h.depthBuffer=!0,this._sceneToCubeUV(a,c,d,h,g),b>0&&this._blur(h,0,0,b),this._applyPMREM(h),this._cleanup(h),h}fromEquirectangular(a,b=null){return this._fromTexture(a,b)}fromCubemap(a,b=null){return this._fromTexture(a,b)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Mg(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Mf(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose(),null!==this._backgroundBox&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(a){this._lodMax=Math.floor(Math.log2(a)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._ggxMaterial&&this._ggxMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let a=0;a<this._lodMeshes.length;a++)this._lodMeshes[a].geometry.dispose()}_cleanup(a){this._renderer.setRenderTarget(L7,L8,L9),this._renderer.xr.enabled=Ma,a.scissorTest=!1,Me(a,0,0,a.width,a.height)}_fromTexture(a,b){301===a.mapping||302===a.mapping?this._setSize(0===a.image.length?16:a.image[0].width||a.image[0].image.width):this._setSize(a.image.width/4),L7=this._renderer.getRenderTarget(),L8=this._renderer.getActiveCubeFace(),L9=this._renderer.getActiveMipmapLevel(),Ma=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;let c=b||this._allocateTargets();return this._textureToCubeUV(a,c),this._applyPMREM(c),this._cleanup(c),c}_allocateTargets(){let a=3*Math.max(this._cubeSize,112),b=4*this._cubeSize,c={magFilter:1006,minFilter:1006,generateMipmaps:!1,type:1016,format:1023,colorSpace:IU,depthBuffer:!1},d=Md(a,b,c);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==a||this._pingPongRenderTarget.height!==b){var e;null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Md(a,b,c);let{_lodMax:d}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=function(a){let b=[],c=[],d=[],e=a,f=a-4+1+L4.length;for(let g=0;g<f;g++){let f=Math.pow(2,e);b.push(f);let h=1/f;g>a-4?h=L4[g-a+4-1]:0===g&&(h=0),c.push(h);let i=1/(f-2),j=-i,k=1+i,l=[j,j,k,j,k,k,j,j,k,k,j,k],m=new Float32Array(108),n=new Float32Array(72),o=new Float32Array(36);for(let a=0;a<6;a++){let b=a%3*2/3-1,c=a>2?0:-1,d=[b,c,0,b+2/3,c,0,b+2/3,c+1,0,b,c,0,b+2/3,c+1,0,b,c+1,0];m.set(d,18*a),n.set(l,12*a);let e=[a,a,a,a,a,a];o.set(e,6*a)}let p=new K$;p.setAttribute("position",new KP(m,3)),p.setAttribute("uv",new KP(n,2)),p.setAttribute("faceIndex",new KP(o,1)),d.push(new La(p,null)),e>4&&e--}return{lodMeshes:d,sizeLods:b,sigmas:c}}(d)),this._blurMaterial=(e=d,new Li({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/a,CUBEUV_TEXEL_HEIGHT:1/b,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:new Float32Array(20)},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:new Je(0,1,0)}},vertexShader:Mh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:0,depthTest:!1,depthWrite:!1}))}return d}_compileMaterial(a){let b=new La(new K$,a);this._renderer.compile(b,L5)}_sceneToCubeUV(a,b,c,d,e){let f=new Ln(90,1,b,c),g=[1,-1,1,1,1,1],h=[1,1,1,-1,-1,-1],i=this._renderer,j=i.autoClear,k=i.toneMapping;i.getClearColor(L6),i.toneMapping=0,i.autoClear=!1,i.state.buffers.depth.getReversed()&&(i.setRenderTarget(d),i.clearDepth(),i.setRenderTarget(null)),null===this._backgroundBox&&(this._backgroundBox=new La(new Lc,new KL({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1})));let l=this._backgroundBox,m=l.material,n=!1,o=a.background;o?o.isColor&&(m.color.copy(o),a.background=null,n=!0):(m.color.copy(L6),n=!0);for(let b=0;b<6;b++){let c=b%3;0===c?(f.up.set(0,g[b],0),f.position.set(e.x,e.y,e.z),f.lookAt(e.x+h[b],e.y,e.z)):1===c?(f.up.set(0,0,g[b]),f.position.set(e.x,e.y,e.z),f.lookAt(e.x,e.y+h[b],e.z)):(f.up.set(0,g[b],0),f.position.set(e.x,e.y,e.z),f.lookAt(e.x,e.y,e.z+h[b]));let j=this._cubeSize;Me(d,c*j,b>2?j:0,j,j),i.setRenderTarget(d),n&&i.render(l,f),i.render(a,f)}i.toneMapping=k,i.autoClear=j,a.background=o}_textureToCubeUV(a,b){let c=this._renderer,d=301===a.mapping||302===a.mapping;d?(null===this._cubemapMaterial&&(this._cubemapMaterial=Mg()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===a.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Mf());let e=d?this._cubemapMaterial:this._equirectMaterial,f=this._lodMeshes[0];f.material=e,e.uniforms.envMap.value=a;let g=this._cubeSize;Me(b,0,0,3*g,2*g),c.setRenderTarget(b),c.render(f,L5)}_applyPMREM(a){let b=this._renderer,c=b.autoClear;b.autoClear=!1;let d=this._lodMeshes.length;for(let b=1;b<d;b++)this._applyGGXFilter(a,b-1,b);b.autoClear=c}_applyGGXFilter(a,b,c){let d=this._renderer,e=this._pingPongRenderTarget;if(null===this._ggxMaterial){var f;let a=3*Math.max(this._cubeSize,16),b=4*this._cubeSize;this._ggxMaterial=(f=this._lodMax,new Li({name:"PMREMGGXConvolution",defines:{GGX_SAMPLES:512,CUBEUV_TEXEL_WIDTH:1/a,CUBEUV_TEXEL_HEIGHT:1/b,CUBEUV_MAX_MIP:`${f}.0`},uniforms:{envMap:{value:null},roughness:{value:0},mipInt:{value:0}},vertexShader:Mh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform float roughness;
			uniform float mipInt;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			#define PI 3.14159265359

			// Van der Corput radical inverse
			float radicalInverse_VdC(uint bits) {
				bits = (bits << 16u) | (bits >> 16u);
				bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);
				bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);
				bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);
				bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);
				return float(bits) * 2.3283064365386963e-10; // / 0x100000000
			}

			// Hammersley sequence
			vec2 hammersley(uint i, uint N) {
				return vec2(float(i) / float(N), radicalInverse_VdC(i));
			}

			// GGX VNDF importance sampling (Eric Heitz 2018)
			// "Sampling the GGX Distribution of Visible Normals"
			// https://jcgt.org/published/0007/04/01/
			vec3 importanceSampleGGX_VNDF(vec2 Xi, vec3 V, float roughness) {
				float alpha = roughness * roughness;

				// Section 3.2: Transform view direction to hemisphere configuration
				vec3 Vh = normalize(vec3(alpha * V.x, alpha * V.y, V.z));

				// Section 4.1: Orthonormal basis
				float lensq = Vh.x * Vh.x + Vh.y * Vh.y;
				vec3 T1 = lensq > 0.0 ? vec3(-Vh.y, Vh.x, 0.0) / sqrt(lensq) : vec3(1.0, 0.0, 0.0);
				vec3 T2 = cross(Vh, T1);

				// Section 4.2: Parameterization of projected area
				float r = sqrt(Xi.x);
				float phi = 2.0 * PI * Xi.y;
				float t1 = r * cos(phi);
				float t2 = r * sin(phi);
				float s = 0.5 * (1.0 + Vh.z);
				t2 = (1.0 - s) * sqrt(1.0 - t1 * t1) + s * t2;

				// Section 4.3: Reprojection onto hemisphere
				vec3 Nh = t1 * T1 + t2 * T2 + sqrt(max(0.0, 1.0 - t1 * t1 - t2 * t2)) * Vh;

				// Section 3.4: Transform back to ellipsoid configuration
				return normalize(vec3(alpha * Nh.x, alpha * Nh.y, max(0.0, Nh.z)));
			}

			void main() {
				vec3 N = normalize(vOutputDirection);
				vec3 V = N; // Assume view direction equals normal for pre-filtering

				vec3 prefilteredColor = vec3(0.0);
				float totalWeight = 0.0;

				// For very low roughness, just sample the environment directly
				if (roughness < 0.001) {
					gl_FragColor = vec4(bilinearCubeUV(envMap, N, mipInt), 1.0);
					return;
				}

				// Tangent space basis for VNDF sampling
				vec3 up = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);
				vec3 tangent = normalize(cross(up, N));
				vec3 bitangent = cross(N, tangent);

				for(uint i = 0u; i < uint(GGX_SAMPLES); i++) {
					vec2 Xi = hammersley(i, uint(GGX_SAMPLES));

					// For PMREM, V = N, so in tangent space V is always (0, 0, 1)
					vec3 H_tangent = importanceSampleGGX_VNDF(Xi, vec3(0.0, 0.0, 1.0), roughness);

					// Transform H back to world space
					vec3 H = normalize(tangent * H_tangent.x + bitangent * H_tangent.y + N * H_tangent.z);
					vec3 L = normalize(2.0 * dot(V, H) * H - V);

					float NdotL = max(dot(N, L), 0.0);

					if(NdotL > 0.0) {
						// Sample environment at fixed mip level
						// VNDF importance sampling handles the distribution filtering
						vec3 sampleColor = bilinearCubeUV(envMap, L, mipInt);

						// Weight by NdotL for the split-sum approximation
						// VNDF PDF naturally accounts for the visible microfacet distribution
						prefilteredColor += sampleColor * NdotL;
						totalWeight += NdotL;
					}
				}

				if (totalWeight > 0.0) {
					prefilteredColor = prefilteredColor / totalWeight;
				}

				gl_FragColor = vec4(prefilteredColor, 1.0);
			}
		`,blending:0,depthTest:!1,depthWrite:!1}))}let g=this._ggxMaterial,h=this._lodMeshes[c];h.material=g;let i=g.uniforms,j=c/(this._lodMeshes.length-1),k=b/(this._lodMeshes.length-1),l=Math.sqrt(j*j-k*k),{_lodMax:m}=this,n=this._sizeLods[c],o=3*n*(c>m-4?c-m+4:0),p=4*(this._cubeSize-n);i.envMap.value=a.texture,i.roughness.value=l*(.05+.95*j),i.mipInt.value=m-b,Me(e,o,p,3*n,2*n),d.setRenderTarget(e),d.render(h,L5),i.envMap.value=e.texture,i.roughness.value=0,i.mipInt.value=m-c,Me(a,o,p,3*n,2*n),d.setRenderTarget(a),d.render(h,L5)}_blur(a,b,c,d,e){let f=this._pingPongRenderTarget;this._halfBlur(a,f,b,c,d,"latitudinal",e),this._halfBlur(f,a,c,c,d,"longitudinal",e)}_halfBlur(a,b,c,d,e,f,g){let h=this._renderer,i=this._blurMaterial;"latitudinal"!==f&&"longitudinal"!==f&&I1("blur direction must be either latitudinal or longitudinal!");let j=this._lodMeshes[d];j.material=i;let k=i.uniforms,l=this._sizeLods[c]-1,m=isFinite(e)?Math.PI/(2*l):2*Math.PI/39,n=e/m,o=isFinite(e)?1+Math.floor(3*n):20;o>20&&I0(`sigmaRadians, ${e}, is too large and will clip, as it requested ${o} samples when the maximum is set to 20`);let p=[],q=0;for(let a=0;a<20;++a){let b=a/n,c=Math.exp(-b*b/2);p.push(c),0===a?q+=c:a<o&&(q+=2*c)}for(let a=0;a<p.length;a++)p[a]=p[a]/q;k.envMap.value=a.texture,k.samples.value=o,k.weights.value=p,k.latitudinal.value="latitudinal"===f,g&&(k.poleAxis.value=g);let{_lodMax:r}=this;k.dTheta.value=m,k.mipInt.value=r-c;let s=this._sizeLods[d],t=4*(this._cubeSize-s);Me(b,3*s*(d>r-4?d-r+4:0),t,3*s,2*s),h.setRenderTarget(b),h.render(j,L5)}};function Md(a,b,c){let d=new Jx(a,b,c);return d.texture.mapping=306,d.texture.name="PMREM.cubeUv",d.scissorTest=!0,d}function Me(a,b,c,d,e){a.viewport.set(b,c,d,e),a.scissor.set(b,c,d,e)}function Mf(){return new Li({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Mh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function Mg(){return new Li({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Mh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function Mh(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Mi(a){let b=new WeakMap,c=null;function d(a){let c=a.target;c.removeEventListener("dispose",d);let e=b.get(c);void 0!==e&&(b.delete(c),e.dispose())}return{get:function(e){if(e&&e.isTexture){let f=e.mapping,g=303===f||304===f,h=301===f||302===f;if(g||h){let f=b.get(e),i=void 0!==f?f.texture.pmremVersion:0;if(e.isRenderTargetTexture&&e.pmremVersion!==i)return null===c&&(c=new Mc(a)),(f=g?c.fromEquirectangular(e,f):c.fromCubemap(e,f)).texture.pmremVersion=e.pmremVersion,b.set(e,f),f.texture;if(void 0!==f)return f.texture;{let i=e.image;return g&&i&&i.height>0||h&&i&&function(a){let b=0;for(let c=0;c<6;c++)void 0!==a[c]&&b++;return 6===b}(i)?(null===c&&(c=new Mc(a)),(f=g?c.fromEquirectangular(e):c.fromCubemap(e)).texture.pmremVersion=e.pmremVersion,b.set(e,f),e.addEventListener("dispose",d),f.texture):null}}}return e},dispose:function(){b=new WeakMap,null!==c&&(c.dispose(),c=null)}}}function Mj(a){let b={};function c(c){if(void 0!==b[c])return b[c];let d=a.getExtension(c);return b[c]=d,d}return{has:function(a){return null!==c(a)},init:function(){c("EXT_color_buffer_float"),c("WEBGL_clip_cull_distance"),c("OES_texture_float_linear"),c("EXT_color_buffer_half_float"),c("WEBGL_multisampled_render_to_texture"),c("WEBGL_render_shared_exponent")},get:function(a){let b=c(a);return null===b&&I2("WebGLRenderer: "+a+" extension not supported."),b}}}function Mk(a,b,c,d){let e={},f=new WeakMap;function g(a){let h=a.target;for(let a in null!==h.index&&b.remove(h.index),h.attributes)b.remove(h.attributes[a]);h.removeEventListener("dispose",g),delete e[h.id];let i=f.get(h);i&&(b.remove(i),f.delete(h)),d.releaseStatesOfGeometry(h),!0===h.isInstancedBufferGeometry&&delete h._maxInstanceCount,c.memory.geometries--}function h(a){let c=[],d=a.index,e=a.attributes.position,g=0;if(null!==d){let a=d.array;g=d.version;for(let b=0,d=a.length;b<d;b+=3){let d=a[b+0],e=a[b+1],f=a[b+2];c.push(d,e,e,f,f,d)}}else{if(void 0===e)return;let a=e.array;g=e.version;for(let b=0,d=a.length/3-1;b<d;b+=3){let a=b+0,d=b+1,e=b+2;c.push(a,d,d,e,e,a)}}let h=new(IY(c)?KR:KQ)(c,1);h.version=g;let i=f.get(a);i&&b.remove(i),f.set(a,h)}return{get:function(a,b){return!0===e[b.id]||(b.addEventListener("dispose",g),e[b.id]=!0,c.memory.geometries++),b},update:function(c){let d=c.attributes;for(let c in d)b.update(d[c],a.ARRAY_BUFFER)},getWireframeAttribute:function(a){let b=f.get(a);if(b){let c=a.index;null!==c&&b.version<c.version&&h(a)}else h(a);return f.get(a)}}}function Ml(a,b,c){let d,e,f;function g(b,g,h){0!==h&&(a.drawElementsInstanced(d,g,e,b*f,h),c.update(g,d,h))}this.setMode=function(a){d=a},this.setIndex=function(a){e=a.type,f=a.bytesPerElement},this.render=function(b,g){a.drawElements(d,g,e,b*f),c.update(g,d,1)},this.renderInstances=g,this.renderMultiDraw=function(a,f,g){if(0===g)return;b.get("WEBGL_multi_draw").multiDrawElementsWEBGL(d,f,0,e,a,0,g);let h=0;for(let a=0;a<g;a++)h+=f[a];c.update(h,d,1)},this.renderMultiDrawInstances=function(a,h,i,j){if(0===i)return;let k=b.get("WEBGL_multi_draw");if(null===k)for(let b=0;b<a.length;b++)g(a[b]/f,h[b],j[b]);else{k.multiDrawElementsInstancedWEBGL(d,h,0,e,a,0,j,0,i);let b=0;for(let a=0;a<i;a++)b+=h[a]*j[a];c.update(b,d,1)}}}function Mm(a){let b={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:b,programs:null,autoReset:!0,reset:function(){b.calls=0,b.triangles=0,b.points=0,b.lines=0},update:function(c,d,e){switch(b.calls++,d){case a.TRIANGLES:b.triangles+=c/3*e;break;case a.LINES:b.lines+=c/2*e;break;case a.LINE_STRIP:b.lines+=e*(c-1);break;case a.LINE_LOOP:b.lines+=e*c;break;case a.POINTS:b.points+=e*c;break;default:I1("WebGLInfo: Unknown draw mode:",d)}}}}function Mn(a,b,c){let d=new WeakMap,e=new Jv;return{update:function(f,g,h){let i=f.morphTargetInfluences,j=g.morphAttributes.position||g.morphAttributes.normal||g.morphAttributes.color,k=void 0!==j?j.length:0,l=d.get(g);if(void 0===l||l.count!==k){let a=function(){r.dispose(),d.delete(g),g.removeEventListener("dispose",a)};void 0!==l&&l.texture.dispose();let c=void 0!==g.morphAttributes.position,f=void 0!==g.morphAttributes.normal,h=void 0!==g.morphAttributes.color,i=g.morphAttributes.position||[],j=g.morphAttributes.normal||[],m=g.morphAttributes.color||[],n=0;!0===c&&(n=1),!0===f&&(n=2),!0===h&&(n=3);let o=g.attributes.position.count*n,p=1;o>b.maxTextureSize&&(p=Math.ceil(o/b.maxTextureSize),o=b.maxTextureSize);let q=new Float32Array(o*p*4*k),r=new Jy(q,o,p,k);r.type=1015,r.needsUpdate=!0;let s=4*n;for(let a=0;a<k;a++){let b=i[a],d=j[a],g=m[a],k=o*p*4*a;for(let a=0;a<b.count;a++){let i=a*s;!0===c&&(e.fromBufferAttribute(b,a),q[k+i+0]=e.x,q[k+i+1]=e.y,q[k+i+2]=e.z,q[k+i+3]=0),!0===f&&(e.fromBufferAttribute(d,a),q[k+i+4]=e.x,q[k+i+5]=e.y,q[k+i+6]=e.z,q[k+i+7]=0),!0===h&&(e.fromBufferAttribute(g,a),q[k+i+8]=e.x,q[k+i+9]=e.y,q[k+i+10]=e.z,q[k+i+11]=4===g.itemSize?e.w:1)}}l={count:k,texture:r,size:new Jc(o,p)},d.set(g,l),g.addEventListener("dispose",a)}if(!0===f.isInstancedMesh&&null!==f.morphTexture)h.getUniforms().setValue(a,"morphTexture",f.morphTexture,c);else{let b=0;for(let a=0;a<i.length;a++)b+=i[a];let c=g.morphTargetsRelative?1:1-b;h.getUniforms().setValue(a,"morphTargetBaseInfluence",c),h.getUniforms().setValue(a,"morphTargetInfluences",i)}h.getUniforms().setValue(a,"morphTargetsTexture",l.texture,c),h.getUniforms().setValue(a,"morphTargetsTextureSize",l.size)}}}function Mo(a,b,c,d){let e=new WeakMap;function f(a){let b=a.target;b.removeEventListener("dispose",f),c.remove(b.instanceMatrix),null!==b.instanceColor&&c.remove(b.instanceColor)}return{update:function(g){let h=d.render.frame,i=g.geometry,j=b.get(g,i);if(e.get(j)!==h&&(b.update(j),e.set(j,h)),g.isInstancedMesh&&(!1===g.hasEventListener("dispose",f)&&g.addEventListener("dispose",f),e.get(g)!==h&&(c.update(g.instanceMatrix,a.ARRAY_BUFFER),null!==g.instanceColor&&c.update(g.instanceColor,a.ARRAY_BUFFER),e.set(g,h))),g.isSkinnedMesh){let a=g.skeleton;e.get(a)!==h&&(a.update(),e.set(a,h))}return j},dispose:function(){e=new WeakMap}}}let Mp=new Ju,Mq=new LI(1,1),Mr=new Jy,Ms=new class extends Ju{constructor(a=null,b=1,c=1,d=1){super(null),this.isData3DTexture=!0,this.image={data:a,width:b,height:c,depth:d},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},Mt=new Lp,Mu=[],Mv=[],Mw=new Float32Array(16),Mx=new Float32Array(9),My=new Float32Array(4);function Mz(a,b,c){let d=a[0];if(d<=0||d>0)return a;let e=b*c,f=Mu[e];if(void 0===f&&(f=new Float32Array(e),Mu[e]=f),0!==b){d.toArray(f,0);for(let d=1,e=0;d!==b;++d)e+=c,a[d].toArray(f,e)}return f}function MA(a,b){if(a.length!==b.length)return!1;for(let c=0,d=a.length;c<d;c++)if(a[c]!==b[c])return!1;return!0}function MB(a,b){for(let c=0,d=b.length;c<d;c++)a[c]=b[c]}function MC(a,b){let c=Mv[b];void 0===c&&(c=new Int32Array(b),Mv[b]=c);for(let d=0;d!==b;++d)c[d]=a.allocateTextureUnit();return c}function MD(a,b){let c=this.cache;c[0]!==b&&(a.uniform1f(this.addr,b),c[0]=b)}function ME(a,b){let c=this.cache;if(void 0!==b.x)(c[0]!==b.x||c[1]!==b.y)&&(a.uniform2f(this.addr,b.x,b.y),c[0]=b.x,c[1]=b.y);else{if(MA(c,b))return;a.uniform2fv(this.addr,b),MB(c,b)}}function MF(a,b){let c=this.cache;if(void 0!==b.x)(c[0]!==b.x||c[1]!==b.y||c[2]!==b.z)&&(a.uniform3f(this.addr,b.x,b.y,b.z),c[0]=b.x,c[1]=b.y,c[2]=b.z);else if(void 0!==b.r)(c[0]!==b.r||c[1]!==b.g||c[2]!==b.b)&&(a.uniform3f(this.addr,b.r,b.g,b.b),c[0]=b.r,c[1]=b.g,c[2]=b.b);else{if(MA(c,b))return;a.uniform3fv(this.addr,b),MB(c,b)}}function MG(a,b){let c=this.cache;if(void 0!==b.x)(c[0]!==b.x||c[1]!==b.y||c[2]!==b.z||c[3]!==b.w)&&(a.uniform4f(this.addr,b.x,b.y,b.z,b.w),c[0]=b.x,c[1]=b.y,c[2]=b.z,c[3]=b.w);else{if(MA(c,b))return;a.uniform4fv(this.addr,b),MB(c,b)}}function MH(a,b){let c=this.cache,d=b.elements;if(void 0===d){if(MA(c,b))return;a.uniformMatrix2fv(this.addr,!1,b),MB(c,b)}else{if(MA(c,d))return;My.set(d),a.uniformMatrix2fv(this.addr,!1,My),MB(c,d)}}function MI(a,b){let c=this.cache,d=b.elements;if(void 0===d){if(MA(c,b))return;a.uniformMatrix3fv(this.addr,!1,b),MB(c,b)}else{if(MA(c,d))return;Mx.set(d),a.uniformMatrix3fv(this.addr,!1,Mx),MB(c,d)}}function MJ(a,b){let c=this.cache,d=b.elements;if(void 0===d){if(MA(c,b))return;a.uniformMatrix4fv(this.addr,!1,b),MB(c,b)}else{if(MA(c,d))return;Mw.set(d),a.uniformMatrix4fv(this.addr,!1,Mw),MB(c,d)}}function MK(a,b){let c=this.cache;c[0]!==b&&(a.uniform1i(this.addr,b),c[0]=b)}function ML(a,b){let c=this.cache;if(void 0!==b.x)(c[0]!==b.x||c[1]!==b.y)&&(a.uniform2i(this.addr,b.x,b.y),c[0]=b.x,c[1]=b.y);else{if(MA(c,b))return;a.uniform2iv(this.addr,b),MB(c,b)}}function MM(a,b){let c=this.cache;if(void 0!==b.x)(c[0]!==b.x||c[1]!==b.y||c[2]!==b.z)&&(a.uniform3i(this.addr,b.x,b.y,b.z),c[0]=b.x,c[1]=b.y,c[2]=b.z);else{if(MA(c,b))return;a.uniform3iv(this.addr,b),MB(c,b)}}function MN(a,b){let c=this.cache;if(void 0!==b.x)(c[0]!==b.x||c[1]!==b.y||c[2]!==b.z||c[3]!==b.w)&&(a.uniform4i(this.addr,b.x,b.y,b.z,b.w),c[0]=b.x,c[1]=b.y,c[2]=b.z,c[3]=b.w);else{if(MA(c,b))return;a.uniform4iv(this.addr,b),MB(c,b)}}function MO(a,b){let c=this.cache;c[0]!==b&&(a.uniform1ui(this.addr,b),c[0]=b)}function MP(a,b){let c=this.cache;if(void 0!==b.x)(c[0]!==b.x||c[1]!==b.y)&&(a.uniform2ui(this.addr,b.x,b.y),c[0]=b.x,c[1]=b.y);else{if(MA(c,b))return;a.uniform2uiv(this.addr,b),MB(c,b)}}function MQ(a,b){let c=this.cache;if(void 0!==b.x)(c[0]!==b.x||c[1]!==b.y||c[2]!==b.z)&&(a.uniform3ui(this.addr,b.x,b.y,b.z),c[0]=b.x,c[1]=b.y,c[2]=b.z);else{if(MA(c,b))return;a.uniform3uiv(this.addr,b),MB(c,b)}}function MR(a,b){let c=this.cache;if(void 0!==b.x)(c[0]!==b.x||c[1]!==b.y||c[2]!==b.z||c[3]!==b.w)&&(a.uniform4ui(this.addr,b.x,b.y,b.z,b.w),c[0]=b.x,c[1]=b.y,c[2]=b.z,c[3]=b.w);else{if(MA(c,b))return;a.uniform4uiv(this.addr,b),MB(c,b)}}function MS(a,b,c){let d,e=this.cache,f=c.allocateTextureUnit();e[0]!==f&&(a.uniform1i(this.addr,f),e[0]=f),this.type===a.SAMPLER_2D_SHADOW?(Mq.compareFunction=515,d=Mq):d=Mp,c.setTexture2D(b||d,f)}function MT(a,b,c){let d=this.cache,e=c.allocateTextureUnit();d[0]!==e&&(a.uniform1i(this.addr,e),d[0]=e),c.setTexture3D(b||Ms,e)}function MU(a,b,c){let d=this.cache,e=c.allocateTextureUnit();d[0]!==e&&(a.uniform1i(this.addr,e),d[0]=e),c.setTextureCube(b||Mt,e)}function MV(a,b,c){let d=this.cache,e=c.allocateTextureUnit();d[0]!==e&&(a.uniform1i(this.addr,e),d[0]=e),c.setTexture2DArray(b||Mr,e)}function MW(a,b){a.uniform1fv(this.addr,b)}function MX(a,b){let c=Mz(b,this.size,2);a.uniform2fv(this.addr,c)}function MY(a,b){let c=Mz(b,this.size,3);a.uniform3fv(this.addr,c)}function MZ(a,b){let c=Mz(b,this.size,4);a.uniform4fv(this.addr,c)}function M$(a,b){let c=Mz(b,this.size,4);a.uniformMatrix2fv(this.addr,!1,c)}function M_(a,b){let c=Mz(b,this.size,9);a.uniformMatrix3fv(this.addr,!1,c)}function M0(a,b){let c=Mz(b,this.size,16);a.uniformMatrix4fv(this.addr,!1,c)}function M1(a,b){a.uniform1iv(this.addr,b)}function M2(a,b){a.uniform2iv(this.addr,b)}function M3(a,b){a.uniform3iv(this.addr,b)}function M4(a,b){a.uniform4iv(this.addr,b)}function M5(a,b){a.uniform1uiv(this.addr,b)}function M6(a,b){a.uniform2uiv(this.addr,b)}function M7(a,b){a.uniform3uiv(this.addr,b)}function M8(a,b){a.uniform4uiv(this.addr,b)}function M9(a,b,c){let d=this.cache,e=b.length,f=MC(c,e);MA(d,f)||(a.uniform1iv(this.addr,f),MB(d,f));for(let a=0;a!==e;++a)c.setTexture2D(b[a]||Mp,f[a])}function Na(a,b,c){let d=this.cache,e=b.length,f=MC(c,e);MA(d,f)||(a.uniform1iv(this.addr,f),MB(d,f));for(let a=0;a!==e;++a)c.setTexture3D(b[a]||Ms,f[a])}function Nb(a,b,c){let d=this.cache,e=b.length,f=MC(c,e);MA(d,f)||(a.uniform1iv(this.addr,f),MB(d,f));for(let a=0;a!==e;++a)c.setTextureCube(b[a]||Mt,f[a])}function Nc(a,b,c){let d=this.cache,e=b.length,f=MC(c,e);MA(d,f)||(a.uniform1iv(this.addr,f),MB(d,f));for(let a=0;a!==e;++a)c.setTexture2DArray(b[a]||Mr,f[a])}class Nd{constructor(a,b,c){this.id=a,this.addr=c,this.cache=[],this.type=b.type,this.setValue=function(a){switch(a){case 5126:return MD;case 35664:return ME;case 35665:return MF;case 35666:return MG;case 35674:return MH;case 35675:return MI;case 35676:return MJ;case 5124:case 35670:return MK;case 35667:case 35671:return ML;case 35668:case 35672:return MM;case 35669:case 35673:return MN;case 5125:return MO;case 36294:return MP;case 36295:return MQ;case 36296:return MR;case 35678:case 36198:case 36298:case 36306:case 35682:return MS;case 35679:case 36299:case 36307:return MT;case 35680:case 36300:case 36308:case 36293:return MU;case 36289:case 36303:case 36311:case 36292:return MV}}(b.type)}}class Ne{constructor(a,b,c){this.id=a,this.addr=c,this.cache=[],this.type=b.type,this.size=b.size,this.setValue=function(a){switch(a){case 5126:return MW;case 35664:return MX;case 35665:return MY;case 35666:return MZ;case 35674:return M$;case 35675:return M_;case 35676:return M0;case 5124:case 35670:return M1;case 35667:case 35671:return M2;case 35668:case 35672:return M3;case 35669:case 35673:return M4;case 5125:return M5;case 36294:return M6;case 36295:return M7;case 36296:return M8;case 35678:case 36198:case 36298:case 36306:case 35682:return M9;case 35679:case 36299:case 36307:return Na;case 35680:case 36300:case 36308:case 36293:return Nb;case 36289:case 36303:case 36311:case 36292:return Nc}}(b.type)}}class Nf{constructor(a){this.id=a,this.seq=[],this.map={}}setValue(a,b,c){let d=this.seq;for(let e=0,f=d.length;e!==f;++e){let f=d[e];f.setValue(a,b[f.id],c)}}}let Ng=/(\w+)(\])?(\[|\.)?/g;function Nh(a,b){a.seq.push(b),a.map[b.id]=b}class Ni{constructor(a,b){this.seq=[],this.map={};const c=a.getProgramParameter(b,a.ACTIVE_UNIFORMS);for(let d=0;d<c;++d){const c=a.getActiveUniform(b,d),e=a.getUniformLocation(b,c.name);!function(a,b,c){let d=a.name,e=d.length;for(Ng.lastIndex=0;;){let f=Ng.exec(d),g=Ng.lastIndex,h=f[1],i="]"===f[2],j=f[3];if(i&&(h|=0),void 0===j||"["===j&&g+2===e){Nh(c,void 0===j?new Nd(h,a,b):new Ne(h,a,b));break}{let a=c.map[h];void 0===a&&Nh(c,a=new Nf(h)),c=a}}}(c,e,this)}}setValue(a,b,c,d){let e=this.map[b];void 0!==e&&e.setValue(a,c,d)}setOptional(a,b,c){let d=b[c];void 0!==d&&this.setValue(a,c,d)}static upload(a,b,c,d){for(let e=0,f=b.length;e!==f;++e){let f=b[e],g=c[f.id];!1!==g.needsUpdate&&f.setValue(a,g.value,d)}}static seqWithValue(a,b){let c=[];for(let d=0,e=a.length;d!==e;++d){let e=a[d];e.id in b&&c.push(e)}return c}}function Nj(a,b,c){let d=a.createShader(b);return a.shaderSource(d,c),a.compileShader(d),d}let Nk=0,Nl=new Jh;function Nm(a,b,c){let d=a.getShaderParameter(b,a.COMPILE_STATUS),e=(a.getShaderInfoLog(b)||"").trim();if(d&&""===e)return"";let f=/ERROR: 0:(\d+)/.exec(e);if(!f)return e;{let d=parseInt(f[1]);return c.toUpperCase()+`

`+e+`

`+function(a,b){let c=a.split(`
`),d=[],e=Math.max(b-6,0),f=Math.min(b+6,c.length);for(let a=e;a<f;a++){let e=a+1;d.push(`${e===b?">":" "} ${e}: ${c[a]}`)}return d.join(`
`)}(a.getShaderSource(b),d)}}let Nn=new Je;function No(a){return""!==a}function Np(a,b){let c=b.numSpotLightShadows+b.numSpotLightMaps-b.numSpotLightShadowsWithMaps;return a.replace(/NUM_DIR_LIGHTS/g,b.numDirLights).replace(/NUM_SPOT_LIGHTS/g,b.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,b.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,c).replace(/NUM_RECT_AREA_LIGHTS/g,b.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,b.numPointLights).replace(/NUM_HEMI_LIGHTS/g,b.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,b.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,b.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,b.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,b.numPointLightShadows)}function Nq(a,b){return a.replace(/NUM_CLIPPING_PLANES/g,b.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,b.numClippingPlanes-b.numClipIntersection)}let Nr=/^[ \t]*#include +<([\w\d./]+)>/gm;function Ns(a){return a.replace(Nr,Nu)}let Nt=new Map;function Nu(a,b){let c=LU[b];if(void 0===c){let a=Nt.get(b);if(void 0!==a)c=LU[a],I0('WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',b,a);else throw Error("Can not resolve #include <"+b+">")}return Ns(c)}let Nv=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Nw(a){return a.replace(Nv,Nx)}function Nx(a,b,c,d){let e="";for(let a=parseInt(b);a<parseInt(c);a++)e+=d.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return e}function Ny(a){let b=`precision ${a.precision} float;
	precision ${a.precision} int;
	precision ${a.precision} sampler2D;
	precision ${a.precision} samplerCube;
	precision ${a.precision} sampler3D;
	precision ${a.precision} sampler2DArray;
	precision ${a.precision} sampler2DShadow;
	precision ${a.precision} samplerCubeShadow;
	precision ${a.precision} sampler2DArrayShadow;
	precision ${a.precision} isampler2D;
	precision ${a.precision} isampler3D;
	precision ${a.precision} isamplerCube;
	precision ${a.precision} isampler2DArray;
	precision ${a.precision} usampler2D;
	precision ${a.precision} usampler3D;
	precision ${a.precision} usamplerCube;
	precision ${a.precision} usampler2DArray;
	`;return"highp"===a.precision?b+=`
#define HIGH_PRECISION`:"mediump"===a.precision?b+=`
#define MEDIUM_PRECISION`:"lowp"===a.precision&&(b+=`
#define LOW_PRECISION`),b}function Nz(a,b,c,d){let e,f,g,h,i,j,k,l,m=a.getContext(),n=c.defines,o=c.vertexShader,p=c.fragmentShader,q=(g="SHADOWMAP_TYPE_BASIC",1===c.shadowMapType?g="SHADOWMAP_TYPE_PCF":2===c.shadowMapType?g="SHADOWMAP_TYPE_PCF_SOFT":3===c.shadowMapType&&(g="SHADOWMAP_TYPE_VSM"),g),r=function(a){let b="ENVMAP_TYPE_CUBE";if(a.envMap)switch(a.envMapMode){case 301:case 302:b="ENVMAP_TYPE_CUBE";break;case 306:b="ENVMAP_TYPE_CUBE_UV"}return b}(c),s=(h="ENVMAP_MODE_REFLECTION",c.envMap&&302===c.envMapMode&&(h="ENVMAP_MODE_REFRACTION"),h),t=function(a){let b="ENVMAP_BLENDING_NONE";if(a.envMap)switch(a.combine){case 0:b="ENVMAP_BLENDING_MULTIPLY";break;case 1:b="ENVMAP_BLENDING_MIX";break;case 2:b="ENVMAP_BLENDING_ADD"}return b}(c),u=function(a){let b=a.envMapCubeUVHeight;if(null===b)return null;let c=Math.log2(b)-2;return{texelWidth:1/(3*Math.max(Math.pow(2,c),112)),texelHeight:1/b,maxMip:c}}(c),v=[c.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",c.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(No).join(`
`),w=function(a){let b=[];for(let c in a){let d=a[c];!1!==d&&b.push("#define "+c+" "+d)}return b.join(`
`)}(n),x=m.createProgram(),y,z,A=c.glslVersion?"#version "+c.glslVersion+`
`:"";c.isRawShaderMaterial?((y=["#define SHADER_TYPE "+c.shaderType,"#define SHADER_NAME "+c.shaderName,w].filter(No).join(`
`)).length>0&&(y+=`
`),(z=["#define SHADER_TYPE "+c.shaderType,"#define SHADER_NAME "+c.shaderName,w].filter(No).join(`
`)).length>0&&(z+=`
`)):(y=[Ny(c),"#define SHADER_TYPE "+c.shaderType,"#define SHADER_NAME "+c.shaderName,w,c.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",c.batching?"#define USE_BATCHING":"",c.batchingColor?"#define USE_BATCHING_COLOR":"",c.instancing?"#define USE_INSTANCING":"",c.instancingColor?"#define USE_INSTANCING_COLOR":"",c.instancingMorph?"#define USE_INSTANCING_MORPH":"",c.useFog&&c.fog?"#define USE_FOG":"",c.useFog&&c.fogExp2?"#define FOG_EXP2":"",c.map?"#define USE_MAP":"",c.envMap?"#define USE_ENVMAP":"",c.envMap?"#define "+s:"",c.lightMap?"#define USE_LIGHTMAP":"",c.aoMap?"#define USE_AOMAP":"",c.bumpMap?"#define USE_BUMPMAP":"",c.normalMap?"#define USE_NORMALMAP":"",c.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",c.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",c.displacementMap?"#define USE_DISPLACEMENTMAP":"",c.emissiveMap?"#define USE_EMISSIVEMAP":"",c.anisotropy?"#define USE_ANISOTROPY":"",c.anisotropyMap?"#define USE_ANISOTROPYMAP":"",c.clearcoatMap?"#define USE_CLEARCOATMAP":"",c.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",c.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",c.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",c.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",c.specularMap?"#define USE_SPECULARMAP":"",c.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",c.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",c.roughnessMap?"#define USE_ROUGHNESSMAP":"",c.metalnessMap?"#define USE_METALNESSMAP":"",c.alphaMap?"#define USE_ALPHAMAP":"",c.alphaHash?"#define USE_ALPHAHASH":"",c.transmission?"#define USE_TRANSMISSION":"",c.transmissionMap?"#define USE_TRANSMISSIONMAP":"",c.thicknessMap?"#define USE_THICKNESSMAP":"",c.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",c.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",c.mapUv?"#define MAP_UV "+c.mapUv:"",c.alphaMapUv?"#define ALPHAMAP_UV "+c.alphaMapUv:"",c.lightMapUv?"#define LIGHTMAP_UV "+c.lightMapUv:"",c.aoMapUv?"#define AOMAP_UV "+c.aoMapUv:"",c.emissiveMapUv?"#define EMISSIVEMAP_UV "+c.emissiveMapUv:"",c.bumpMapUv?"#define BUMPMAP_UV "+c.bumpMapUv:"",c.normalMapUv?"#define NORMALMAP_UV "+c.normalMapUv:"",c.displacementMapUv?"#define DISPLACEMENTMAP_UV "+c.displacementMapUv:"",c.metalnessMapUv?"#define METALNESSMAP_UV "+c.metalnessMapUv:"",c.roughnessMapUv?"#define ROUGHNESSMAP_UV "+c.roughnessMapUv:"",c.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+c.anisotropyMapUv:"",c.clearcoatMapUv?"#define CLEARCOATMAP_UV "+c.clearcoatMapUv:"",c.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+c.clearcoatNormalMapUv:"",c.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+c.clearcoatRoughnessMapUv:"",c.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+c.iridescenceMapUv:"",c.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+c.iridescenceThicknessMapUv:"",c.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+c.sheenColorMapUv:"",c.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+c.sheenRoughnessMapUv:"",c.specularMapUv?"#define SPECULARMAP_UV "+c.specularMapUv:"",c.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+c.specularColorMapUv:"",c.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+c.specularIntensityMapUv:"",c.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+c.transmissionMapUv:"",c.thicknessMapUv?"#define THICKNESSMAP_UV "+c.thicknessMapUv:"",c.vertexTangents&&!1===c.flatShading?"#define USE_TANGENT":"",c.vertexColors?"#define USE_COLOR":"",c.vertexAlphas?"#define USE_COLOR_ALPHA":"",c.vertexUv1s?"#define USE_UV1":"",c.vertexUv2s?"#define USE_UV2":"",c.vertexUv3s?"#define USE_UV3":"",c.pointsUvs?"#define USE_POINTS_UV":"",c.flatShading?"#define FLAT_SHADED":"",c.skinning?"#define USE_SKINNING":"",c.morphTargets?"#define USE_MORPHTARGETS":"",c.morphNormals&&!1===c.flatShading?"#define USE_MORPHNORMALS":"",c.morphColors?"#define USE_MORPHCOLORS":"",c.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+c.morphTextureStride:"",c.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+c.morphTargetsCount:"",c.doubleSided?"#define DOUBLE_SIDED":"",c.flipSided?"#define FLIP_SIDED":"",c.shadowMapEnabled?"#define USE_SHADOWMAP":"",c.shadowMapEnabled?"#define "+q:"",c.sizeAttenuation?"#define USE_SIZEATTENUATION":"",c.numLightProbes>0?"#define USE_LIGHT_PROBES":"",c.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",c.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(No).join(`
`),z=[Ny(c),"#define SHADER_TYPE "+c.shaderType,"#define SHADER_NAME "+c.shaderName,w,c.useFog&&c.fog?"#define USE_FOG":"",c.useFog&&c.fogExp2?"#define FOG_EXP2":"",c.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",c.map?"#define USE_MAP":"",c.matcap?"#define USE_MATCAP":"",c.envMap?"#define USE_ENVMAP":"",c.envMap?"#define "+r:"",c.envMap?"#define "+s:"",c.envMap?"#define "+t:"",u?"#define CUBEUV_TEXEL_WIDTH "+u.texelWidth:"",u?"#define CUBEUV_TEXEL_HEIGHT "+u.texelHeight:"",u?"#define CUBEUV_MAX_MIP "+u.maxMip+".0":"",c.lightMap?"#define USE_LIGHTMAP":"",c.aoMap?"#define USE_AOMAP":"",c.bumpMap?"#define USE_BUMPMAP":"",c.normalMap?"#define USE_NORMALMAP":"",c.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",c.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",c.emissiveMap?"#define USE_EMISSIVEMAP":"",c.anisotropy?"#define USE_ANISOTROPY":"",c.anisotropyMap?"#define USE_ANISOTROPYMAP":"",c.clearcoat?"#define USE_CLEARCOAT":"",c.clearcoatMap?"#define USE_CLEARCOATMAP":"",c.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",c.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",c.dispersion?"#define USE_DISPERSION":"",c.iridescence?"#define USE_IRIDESCENCE":"",c.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",c.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",c.specularMap?"#define USE_SPECULARMAP":"",c.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",c.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",c.roughnessMap?"#define USE_ROUGHNESSMAP":"",c.metalnessMap?"#define USE_METALNESSMAP":"",c.alphaMap?"#define USE_ALPHAMAP":"",c.alphaTest?"#define USE_ALPHATEST":"",c.alphaHash?"#define USE_ALPHAHASH":"",c.sheen?"#define USE_SHEEN":"",c.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",c.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",c.transmission?"#define USE_TRANSMISSION":"",c.transmissionMap?"#define USE_TRANSMISSIONMAP":"",c.thicknessMap?"#define USE_THICKNESSMAP":"",c.vertexTangents&&!1===c.flatShading?"#define USE_TANGENT":"",c.vertexColors||c.instancingColor||c.batchingColor?"#define USE_COLOR":"",c.vertexAlphas?"#define USE_COLOR_ALPHA":"",c.vertexUv1s?"#define USE_UV1":"",c.vertexUv2s?"#define USE_UV2":"",c.vertexUv3s?"#define USE_UV3":"",c.pointsUvs?"#define USE_POINTS_UV":"",c.gradientMap?"#define USE_GRADIENTMAP":"",c.flatShading?"#define FLAT_SHADED":"",c.doubleSided?"#define DOUBLE_SIDED":"",c.flipSided?"#define FLIP_SIDED":"",c.shadowMapEnabled?"#define USE_SHADOWMAP":"",c.shadowMapEnabled?"#define "+q:"",c.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",c.numLightProbes>0?"#define USE_LIGHT_PROBES":"",c.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",c.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",c.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",c.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==c.toneMapping?"#define TONE_MAPPING":"",0!==c.toneMapping?LU.tonemapping_pars_fragment:"",0!==c.toneMapping?function(a,b){let c;switch(b){case 1:c="Linear";break;case 2:c="Reinhard";break;case 3:c="Cineon";break;case 4:c="ACESFilmic";break;case 6:c="AgX";break;case 7:c="Neutral";break;case 5:c="Custom";break;default:I0("WebGLProgram: Unsupported toneMapping:",b),c="Linear"}return"vec3 "+a+"( vec3 color ) { return "+c+"ToneMapping( color ); }"}("toneMapping",c.toneMapping):"",c.dithering?"#define DITHERING":"",c.opaque?"#define OPAQUE":"",LU.colorspace_pars_fragment,(i=function(a){Jl._getMatrix(Nl,Jl.workingColorSpace,a);let b=`mat3( ${Nl.elements.map(a=>a.toFixed(4))} )`;switch(Jl.getTransfer(a)){case IV:return[b,"LinearTransferOETF"];case IW:return[b,"sRGBTransferOETF"];default:return I0("WebGLProgram: Unsupported color space: ",a),[b,"LinearTransferOETF"]}}(c.outputColorSpace),["vec4 linearToOutputTexel( vec4 value ) {",`	return ${i[1]}( vec4( value.rgb * ${i[0]}, value.a ) );`,"}"].join(`
`)),(Jl.getLuminanceCoefficients(Nn),j=Nn.x.toFixed(4),k=Nn.y.toFixed(4),l=Nn.z.toFixed(4),["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${j}, ${k}, ${l} );`,"	return dot( weights, rgb );","}"].join(`
`)),c.useDepthPacking?"#define DEPTH_PACKING "+c.depthPacking:"",`
`].filter(No).join(`
`)),o=Nq(o=Np(o=Ns(o),c),c),p=Nq(p=Np(p=Ns(p),c),c),o=Nw(o),p=Nw(p),!0!==c.isRawShaderMaterial&&(A=`#version 300 es
`,y=[v,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+y,z=["#define varying in",c.glslVersion===IX?"":"layout(location = 0) out highp vec4 pc_fragColor;",c.glslVersion===IX?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+z);let B=A+y+o,C=A+z+p,D=Nj(m,m.VERTEX_SHADER,B),E=Nj(m,m.FRAGMENT_SHADER,C);function F(b){if(a.debug.checkShaderErrors){let c=m.getProgramInfoLog(x)||"",d=m.getShaderInfoLog(D)||"",e=m.getShaderInfoLog(E)||"",f=c.trim(),g=d.trim(),h=e.trim(),i=!0,j=!0;if(!1===m.getProgramParameter(x,m.LINK_STATUS))if(i=!1,"function"==typeof a.debug.onShaderError)a.debug.onShaderError(m,x,D,E);else{let a=Nm(m,D,"vertex"),c=Nm(m,E,"fragment");I1("THREE.WebGLProgram: Shader Error "+m.getError()+" - VALIDATE_STATUS "+m.getProgramParameter(x,m.VALIDATE_STATUS)+`

Material Name: `+b.name+`
Material Type: `+b.type+`

Program Info Log: `+f+`
`+a+`
`+c)}else""!==f?I0("WebGLProgram: Program Info Log:",f):(""===g||""===h)&&(j=!1);j&&(b.diagnostics={runnable:i,programLog:f,vertexShader:{log:g,prefix:y},fragmentShader:{log:h,prefix:z}})}m.deleteShader(D),m.deleteShader(E),e=new Ni(m,x),f=function(a,b){let c={},d=a.getProgramParameter(b,a.ACTIVE_ATTRIBUTES);for(let e=0;e<d;e++){let d=a.getActiveAttrib(b,e),f=d.name,g=1;d.type===a.FLOAT_MAT2&&(g=2),d.type===a.FLOAT_MAT3&&(g=3),d.type===a.FLOAT_MAT4&&(g=4),c[f]={type:d.type,location:a.getAttribLocation(b,f),locationSize:g}}return c}(m,x)}m.attachShader(x,D),m.attachShader(x,E),void 0!==c.index0AttributeName?m.bindAttribLocation(x,0,c.index0AttributeName):!0===c.morphTargets&&m.bindAttribLocation(x,0,"position"),m.linkProgram(x),this.getUniforms=function(){return void 0===e&&F(this),e},this.getAttributes=function(){return void 0===f&&F(this),f};let G=!1===c.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===G&&(G=m.getProgramParameter(x,37297)),G},this.destroy=function(){d.releaseStatesOfProgram(this),m.deleteProgram(x),this.program=void 0},this.type=c.shaderType,this.name=c.shaderName,this.id=Nk++,this.cacheKey=b,this.usedTimes=1,this.program=x,this.vertexShader=D,this.fragmentShader=E,this}let NA=0;class NB{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(a){let b=a.vertexShader,c=a.fragmentShader,d=this._getShaderStage(b),e=this._getShaderStage(c),f=this._getShaderCacheForMaterial(a);return!1===f.has(d)&&(f.add(d),d.usedTimes++),!1===f.has(e)&&(f.add(e),e.usedTimes++),this}remove(a){for(let b of this.materialCache.get(a))b.usedTimes--,0===b.usedTimes&&this.shaderCache.delete(b.code);return this.materialCache.delete(a),this}getVertexShaderID(a){return this._getShaderStage(a.vertexShader).id}getFragmentShaderID(a){return this._getShaderStage(a.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(a){let b=this.materialCache,c=b.get(a);return void 0===c&&(c=new Set,b.set(a,c)),c}_getShaderStage(a){let b=this.shaderCache,c=b.get(a);return void 0===c&&(c=new NC(a),b.set(a,c)),c}}class NC{constructor(a){this.id=NA++,this.code=a,this.usedTimes=0}}function ND(a,b,c,d,e,f,g){let h=new J8,i=new NB,j=new Set,k=[],l=e.logarithmicDepthBuffer,m=e.vertexTextures,n=e.precision,o={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function p(a){return j.add(a),0===a?"uv":`uv${a}`}return{getParameters:function(f,h,k,q,r){let s,t,u,v,w=q.fog,x=r.geometry,y=f.isMeshStandardMaterial?q.environment:null,z=(f.isMeshStandardMaterial?c:b).get(f.envMap||y),A=z&&306===z.mapping?z.image.height:null,B=o[f.type];null!==f.precision&&(n=e.getMaxPrecision(f.precision))!==f.precision&&I0("WebGLProgram.getParameters:",f.precision,"not supported, using",n,"instead.");let C=x.morphAttributes.position||x.morphAttributes.normal||x.morphAttributes.color,D=void 0!==C?C.length:0,E=0;if(void 0!==x.morphAttributes.position&&(E=1),void 0!==x.morphAttributes.normal&&(E=2),void 0!==x.morphAttributes.color&&(E=3),B){let a=LW[B];s=a.vertexShader,t=a.fragmentShader}else s=f.vertexShader,t=f.fragmentShader,i.update(f),u=i.getVertexShaderID(f),v=i.getFragmentShaderID(f);let F=a.getRenderTarget(),G=a.state.buffers.depth.getReversed(),H=!0===r.isInstancedMesh,I=!0===r.isBatchedMesh,J=!!f.map,K=!!f.matcap,L=!!z,M=!!f.aoMap,N=!!f.lightMap,O=!!f.bumpMap,P=!!f.normalMap,Q=!!f.displacementMap,R=!!f.emissiveMap,S=!!f.metalnessMap,T=!!f.roughnessMap,U=f.anisotropy>0,V=f.clearcoat>0,W=f.dispersion>0,X=f.iridescence>0,Y=f.sheen>0,Z=f.transmission>0,$=U&&!!f.anisotropyMap,_=V&&!!f.clearcoatMap,aa=V&&!!f.clearcoatNormalMap,ab=V&&!!f.clearcoatRoughnessMap,ac=X&&!!f.iridescenceMap,ad=X&&!!f.iridescenceThicknessMap,ae=Y&&!!f.sheenColorMap,af=Y&&!!f.sheenRoughnessMap,ag=!!f.specularMap,ah=!!f.specularColorMap,ai=!!f.specularIntensityMap,aj=Z&&!!f.transmissionMap,ak=Z&&!!f.thicknessMap,al=!!f.gradientMap,am=!!f.alphaMap,an=f.alphaTest>0,ao=!!f.alphaHash,ap=!!f.extensions,aq=0;f.toneMapped&&(null===F||!0===F.isXRRenderTarget)&&(aq=a.toneMapping);let ar={shaderID:B,shaderType:f.type,shaderName:f.name,vertexShader:s,fragmentShader:t,defines:f.defines,customVertexShaderID:u,customFragmentShaderID:v,isRawShaderMaterial:!0===f.isRawShaderMaterial,glslVersion:f.glslVersion,precision:n,batching:I,batchingColor:I&&null!==r._colorsTexture,instancing:H,instancingColor:H&&null!==r.instanceColor,instancingMorph:H&&null!==r.morphTexture,supportsVertexTextures:m,outputColorSpace:null===F?a.outputColorSpace:!0===F.isXRRenderTarget?F.texture.colorSpace:IU,alphaToCoverage:!!f.alphaToCoverage,map:J,matcap:K,envMap:L,envMapMode:L&&z.mapping,envMapCubeUVHeight:A,aoMap:M,lightMap:N,bumpMap:O,normalMap:P,displacementMap:m&&Q,emissiveMap:R,normalMapObjectSpace:P&&1===f.normalMapType,normalMapTangentSpace:P&&0===f.normalMapType,metalnessMap:S,roughnessMap:T,anisotropy:U,anisotropyMap:$,clearcoat:V,clearcoatMap:_,clearcoatNormalMap:aa,clearcoatRoughnessMap:ab,dispersion:W,iridescence:X,iridescenceMap:ac,iridescenceThicknessMap:ad,sheen:Y,sheenColorMap:ae,sheenRoughnessMap:af,specularMap:ag,specularColorMap:ah,specularIntensityMap:ai,transmission:Z,transmissionMap:aj,thicknessMap:ak,gradientMap:al,opaque:!1===f.transparent&&1===f.blending&&!1===f.alphaToCoverage,alphaMap:am,alphaTest:an,alphaHash:ao,combine:f.combine,mapUv:J&&p(f.map.channel),aoMapUv:M&&p(f.aoMap.channel),lightMapUv:N&&p(f.lightMap.channel),bumpMapUv:O&&p(f.bumpMap.channel),normalMapUv:P&&p(f.normalMap.channel),displacementMapUv:Q&&p(f.displacementMap.channel),emissiveMapUv:R&&p(f.emissiveMap.channel),metalnessMapUv:S&&p(f.metalnessMap.channel),roughnessMapUv:T&&p(f.roughnessMap.channel),anisotropyMapUv:$&&p(f.anisotropyMap.channel),clearcoatMapUv:_&&p(f.clearcoatMap.channel),clearcoatNormalMapUv:aa&&p(f.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ab&&p(f.clearcoatRoughnessMap.channel),iridescenceMapUv:ac&&p(f.iridescenceMap.channel),iridescenceThicknessMapUv:ad&&p(f.iridescenceThicknessMap.channel),sheenColorMapUv:ae&&p(f.sheenColorMap.channel),sheenRoughnessMapUv:af&&p(f.sheenRoughnessMap.channel),specularMapUv:ag&&p(f.specularMap.channel),specularColorMapUv:ah&&p(f.specularColorMap.channel),specularIntensityMapUv:ai&&p(f.specularIntensityMap.channel),transmissionMapUv:aj&&p(f.transmissionMap.channel),thicknessMapUv:ak&&p(f.thicknessMap.channel),alphaMapUv:am&&p(f.alphaMap.channel),vertexTangents:!!x.attributes.tangent&&(P||U),vertexColors:f.vertexColors,vertexAlphas:!0===f.vertexColors&&!!x.attributes.color&&4===x.attributes.color.itemSize,pointsUvs:!0===r.isPoints&&!!x.attributes.uv&&(J||am),fog:!!w,useFog:!0===f.fog,fogExp2:!!w&&w.isFogExp2,flatShading:!0===f.flatShading&&!1===f.wireframe,sizeAttenuation:!0===f.sizeAttenuation,logarithmicDepthBuffer:l,reversedDepthBuffer:G,skinning:!0===r.isSkinnedMesh,morphTargets:void 0!==x.morphAttributes.position,morphNormals:void 0!==x.morphAttributes.normal,morphColors:void 0!==x.morphAttributes.color,morphTargetsCount:D,morphTextureStride:E,numDirLights:h.directional.length,numPointLights:h.point.length,numSpotLights:h.spot.length,numSpotLightMaps:h.spotLightMap.length,numRectAreaLights:h.rectArea.length,numHemiLights:h.hemi.length,numDirLightShadows:h.directionalShadowMap.length,numPointLightShadows:h.pointShadowMap.length,numSpotLightShadows:h.spotShadowMap.length,numSpotLightShadowsWithMaps:h.numSpotLightShadowsWithMaps,numLightProbes:h.numLightProbes,numClippingPlanes:g.numPlanes,numClipIntersection:g.numIntersection,dithering:f.dithering,shadowMapEnabled:a.shadowMap.enabled&&k.length>0,shadowMapType:a.shadowMap.type,toneMapping:aq,decodeVideoTexture:J&&!0===f.map.isVideoTexture&&Jl.getTransfer(f.map.colorSpace)===IW,decodeVideoTextureEmissive:R&&!0===f.emissiveMap.isVideoTexture&&Jl.getTransfer(f.emissiveMap.colorSpace)===IW,premultipliedAlpha:f.premultipliedAlpha,doubleSided:2===f.side,flipSided:1===f.side,useDepthPacking:f.depthPacking>=0,depthPacking:f.depthPacking||0,index0AttributeName:f.index0AttributeName,extensionClipCullDistance:ap&&!0===f.extensions.clipCullDistance&&d.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(ap&&!0===f.extensions.multiDraw||I)&&d.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:d.has("KHR_parallel_shader_compile"),customProgramCacheKey:f.customProgramCacheKey()};return ar.vertexUv1s=j.has(1),ar.vertexUv2s=j.has(2),ar.vertexUv3s=j.has(3),j.clear(),ar},getProgramCacheKey:function(b){var c,d,e,f;let g=[];if(b.shaderID?g.push(b.shaderID):(g.push(b.customVertexShaderID),g.push(b.customFragmentShaderID)),void 0!==b.defines)for(let a in b.defines)g.push(a),g.push(b.defines[a]);return!1===b.isRawShaderMaterial&&(c=g,d=b,c.push(d.precision),c.push(d.outputColorSpace),c.push(d.envMapMode),c.push(d.envMapCubeUVHeight),c.push(d.mapUv),c.push(d.alphaMapUv),c.push(d.lightMapUv),c.push(d.aoMapUv),c.push(d.bumpMapUv),c.push(d.normalMapUv),c.push(d.displacementMapUv),c.push(d.emissiveMapUv),c.push(d.metalnessMapUv),c.push(d.roughnessMapUv),c.push(d.anisotropyMapUv),c.push(d.clearcoatMapUv),c.push(d.clearcoatNormalMapUv),c.push(d.clearcoatRoughnessMapUv),c.push(d.iridescenceMapUv),c.push(d.iridescenceThicknessMapUv),c.push(d.sheenColorMapUv),c.push(d.sheenRoughnessMapUv),c.push(d.specularMapUv),c.push(d.specularColorMapUv),c.push(d.specularIntensityMapUv),c.push(d.transmissionMapUv),c.push(d.thicknessMapUv),c.push(d.combine),c.push(d.fogExp2),c.push(d.sizeAttenuation),c.push(d.morphTargetsCount),c.push(d.morphAttributeCount),c.push(d.numDirLights),c.push(d.numPointLights),c.push(d.numSpotLights),c.push(d.numSpotLightMaps),c.push(d.numHemiLights),c.push(d.numRectAreaLights),c.push(d.numDirLightShadows),c.push(d.numPointLightShadows),c.push(d.numSpotLightShadows),c.push(d.numSpotLightShadowsWithMaps),c.push(d.numLightProbes),c.push(d.shadowMapType),c.push(d.toneMapping),c.push(d.numClippingPlanes),c.push(d.numClipIntersection),c.push(d.depthPacking),e=g,f=b,h.disableAll(),f.supportsVertexTextures&&h.enable(0),f.instancing&&h.enable(1),f.instancingColor&&h.enable(2),f.instancingMorph&&h.enable(3),f.matcap&&h.enable(4),f.envMap&&h.enable(5),f.normalMapObjectSpace&&h.enable(6),f.normalMapTangentSpace&&h.enable(7),f.clearcoat&&h.enable(8),f.iridescence&&h.enable(9),f.alphaTest&&h.enable(10),f.vertexColors&&h.enable(11),f.vertexAlphas&&h.enable(12),f.vertexUv1s&&h.enable(13),f.vertexUv2s&&h.enable(14),f.vertexUv3s&&h.enable(15),f.vertexTangents&&h.enable(16),f.anisotropy&&h.enable(17),f.alphaHash&&h.enable(18),f.batching&&h.enable(19),f.dispersion&&h.enable(20),f.batchingColor&&h.enable(21),f.gradientMap&&h.enable(22),e.push(h.mask),h.disableAll(),f.fog&&h.enable(0),f.useFog&&h.enable(1),f.flatShading&&h.enable(2),f.logarithmicDepthBuffer&&h.enable(3),f.reversedDepthBuffer&&h.enable(4),f.skinning&&h.enable(5),f.morphTargets&&h.enable(6),f.morphNormals&&h.enable(7),f.morphColors&&h.enable(8),f.premultipliedAlpha&&h.enable(9),f.shadowMapEnabled&&h.enable(10),f.doubleSided&&h.enable(11),f.flipSided&&h.enable(12),f.useDepthPacking&&h.enable(13),f.dithering&&h.enable(14),f.transmission&&h.enable(15),f.sheen&&h.enable(16),f.opaque&&h.enable(17),f.pointsUvs&&h.enable(18),f.decodeVideoTexture&&h.enable(19),f.decodeVideoTextureEmissive&&h.enable(20),f.alphaToCoverage&&h.enable(21),e.push(h.mask),g.push(a.outputColorSpace)),g.push(b.customProgramCacheKey),g.join()},getUniforms:function(a){let b,c=o[a.type];return b=c?Ld(LW[c].uniforms):a.uniforms},acquireProgram:function(b,c){let d;for(let a=0,b=k.length;a<b;a++){let b=k[a];if(b.cacheKey===c){d=b,++d.usedTimes;break}}return void 0===d&&(d=new Nz(a,c,b,f),k.push(d)),d},releaseProgram:function(a){if(0==--a.usedTimes){let b=k.indexOf(a);k[b]=k[k.length-1],k.pop(),a.destroy()}},releaseShaderCache:function(a){i.remove(a)},programs:k,dispose:function(){i.dispose()}}}function NE(){let a=new WeakMap;return{has:function(b){return a.has(b)},get:function(b){let c=a.get(b);return void 0===c&&(c={},a.set(b,c)),c},remove:function(b){a.delete(b)},update:function(b,c,d){a.get(b)[c]=d},dispose:function(){a=new WeakMap}}}function NF(a,b){return a.groupOrder!==b.groupOrder?a.groupOrder-b.groupOrder:a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function NG(a,b){return a.groupOrder!==b.groupOrder?a.groupOrder-b.groupOrder:a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:a.id-b.id}function NH(){let a=[],b=0,c=[],d=[],e=[];function f(c,d,e,f,g,h){let i=a[b];return void 0===i?(i={id:c.id,object:c,geometry:d,material:e,groupOrder:f,renderOrder:c.renderOrder,z:g,group:h},a[b]=i):(i.id=c.id,i.object=c,i.geometry=d,i.material=e,i.groupOrder=f,i.renderOrder=c.renderOrder,i.z=g,i.group=h),b++,i}return{opaque:c,transmissive:d,transparent:e,init:function(){b=0,c.length=0,d.length=0,e.length=0},push:function(a,b,g,h,i,j){let k=f(a,b,g,h,i,j);g.transmission>0?d.push(k):!0===g.transparent?e.push(k):c.push(k)},unshift:function(a,b,g,h,i,j){let k=f(a,b,g,h,i,j);g.transmission>0?d.unshift(k):!0===g.transparent?e.unshift(k):c.unshift(k)},finish:function(){for(let c=b,d=a.length;c<d;c++){let b=a[c];if(null===b.id)break;b.id=null,b.object=null,b.geometry=null,b.material=null,b.group=null}},sort:function(a,b){c.length>1&&c.sort(a||NF),d.length>1&&d.sort(b||NG),e.length>1&&e.sort(b||NG)}}}function NI(){let a=new WeakMap;return{get:function(b,c){let d,e=a.get(b);return void 0===e?(d=new NH,a.set(b,[d])):c>=e.length?(d=new NH,e.push(d)):d=e[c],d},dispose:function(){a=new WeakMap}}}function NJ(){let a={};return{get:function(b){let c;if(void 0!==a[b.id])return a[b.id];switch(b.type){case"DirectionalLight":c={direction:new Je,color:new KH};break;case"SpotLight":c={position:new Je,direction:new Je,color:new KH,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":c={position:new Je,color:new KH,distance:0,decay:0};break;case"HemisphereLight":c={direction:new Je,skyColor:new KH,groundColor:new KH};break;case"RectAreaLight":c={color:new KH,position:new Je,halfWidth:new Je,halfHeight:new Je}}return a[b.id]=c,c}}}let NK=0;function NL(a,b){return 2*!!b.castShadow-2*!!a.castShadow+ +!!b.map-!!a.map}function NM(a){let b,c=new NJ,d=(b={},{get:function(a){let c;if(void 0!==b[a.id])return b[a.id];switch(a.type){case"DirectionalLight":case"SpotLight":c={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Jc};break;case"PointLight":c={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Jc,shadowCameraNear:1,shadowCameraFar:1e3}}return b[a.id]=c,c}}),e={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let a=0;a<9;a++)e.probe.push(new Je);let f=new Je,g=new JZ,h=new JZ;return{setup:function(b){let f=0,g=0,h=0;for(let a=0;a<9;a++)e.probe[a].set(0,0,0);let i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0;b.sort(NL);for(let a=0,t=b.length;a<t;a++){let t=b[a],u=t.color,v=t.intensity,w=t.distance,x=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)f+=u.r*v,g+=u.g*v,h+=u.b*v;else if(t.isLightProbe){for(let a=0;a<9;a++)e.probe[a].addScaledVector(t.sh.coefficients[a],v);s++}else if(t.isDirectionalLight){let a=c.get(t);if(a.color.copy(t.color).multiplyScalar(t.intensity),t.castShadow){let a=t.shadow,b=d.get(t);b.shadowIntensity=a.intensity,b.shadowBias=a.bias,b.shadowNormalBias=a.normalBias,b.shadowRadius=a.radius,b.shadowMapSize=a.mapSize,e.directionalShadow[i]=b,e.directionalShadowMap[i]=x,e.directionalShadowMatrix[i]=t.shadow.matrix,n++}e.directional[i]=a,i++}else if(t.isSpotLight){let a=c.get(t);a.position.setFromMatrixPosition(t.matrixWorld),a.color.copy(u).multiplyScalar(v),a.distance=w,a.coneCos=Math.cos(t.angle),a.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),a.decay=t.decay,e.spot[k]=a;let b=t.shadow;if(t.map&&(e.spotLightMap[q]=t.map,q++,b.updateMatrices(t),t.castShadow&&r++),e.spotLightMatrix[k]=b.matrix,t.castShadow){let a=d.get(t);a.shadowIntensity=b.intensity,a.shadowBias=b.bias,a.shadowNormalBias=b.normalBias,a.shadowRadius=b.radius,a.shadowMapSize=b.mapSize,e.spotShadow[k]=a,e.spotShadowMap[k]=x,p++}k++}else if(t.isRectAreaLight){let a=c.get(t);a.color.copy(u).multiplyScalar(v),a.halfWidth.set(.5*t.width,0,0),a.halfHeight.set(0,.5*t.height,0),e.rectArea[l]=a,l++}else if(t.isPointLight){let a=c.get(t);if(a.color.copy(t.color).multiplyScalar(t.intensity),a.distance=t.distance,a.decay=t.decay,t.castShadow){let a=t.shadow,b=d.get(t);b.shadowIntensity=a.intensity,b.shadowBias=a.bias,b.shadowNormalBias=a.normalBias,b.shadowRadius=a.radius,b.shadowMapSize=a.mapSize,b.shadowCameraNear=a.camera.near,b.shadowCameraFar=a.camera.far,e.pointShadow[j]=b,e.pointShadowMap[j]=x,e.pointShadowMatrix[j]=t.shadow.matrix,o++}e.point[j]=a,j++}else if(t.isHemisphereLight){let a=c.get(t);a.skyColor.copy(t.color).multiplyScalar(v),a.groundColor.copy(t.groundColor).multiplyScalar(v),e.hemi[m]=a,m++}}l>0&&(!0===a.has("OES_texture_float_linear")?(e.rectAreaLTC1=LV.LTC_FLOAT_1,e.rectAreaLTC2=LV.LTC_FLOAT_2):(e.rectAreaLTC1=LV.LTC_HALF_1,e.rectAreaLTC2=LV.LTC_HALF_2)),e.ambient[0]=f,e.ambient[1]=g,e.ambient[2]=h;let t=e.hash;(t.directionalLength!==i||t.pointLength!==j||t.spotLength!==k||t.rectAreaLength!==l||t.hemiLength!==m||t.numDirectionalShadows!==n||t.numPointShadows!==o||t.numSpotShadows!==p||t.numSpotMaps!==q||t.numLightProbes!==s)&&(e.directional.length=i,e.spot.length=k,e.rectArea.length=l,e.point.length=j,e.hemi.length=m,e.directionalShadow.length=n,e.directionalShadowMap.length=n,e.pointShadow.length=o,e.pointShadowMap.length=o,e.spotShadow.length=p,e.spotShadowMap.length=p,e.directionalShadowMatrix.length=n,e.pointShadowMatrix.length=o,e.spotLightMatrix.length=p+q-r,e.spotLightMap.length=q,e.numSpotLightShadowsWithMaps=r,e.numLightProbes=s,t.directionalLength=i,t.pointLength=j,t.spotLength=k,t.rectAreaLength=l,t.hemiLength=m,t.numDirectionalShadows=n,t.numPointShadows=o,t.numSpotShadows=p,t.numSpotMaps=q,t.numLightProbes=s,e.version=NK++)},setupView:function(a,b){let c=0,d=0,i=0,j=0,k=0,l=b.matrixWorldInverse;for(let b=0,m=a.length;b<m;b++){let m=a[b];if(m.isDirectionalLight){let a=e.directional[c];a.direction.setFromMatrixPosition(m.matrixWorld),f.setFromMatrixPosition(m.target.matrixWorld),a.direction.sub(f),a.direction.transformDirection(l),c++}else if(m.isSpotLight){let a=e.spot[i];a.position.setFromMatrixPosition(m.matrixWorld),a.position.applyMatrix4(l),a.direction.setFromMatrixPosition(m.matrixWorld),f.setFromMatrixPosition(m.target.matrixWorld),a.direction.sub(f),a.direction.transformDirection(l),i++}else if(m.isRectAreaLight){let a=e.rectArea[j];a.position.setFromMatrixPosition(m.matrixWorld),a.position.applyMatrix4(l),h.identity(),g.copy(m.matrixWorld),g.premultiply(l),h.extractRotation(g),a.halfWidth.set(.5*m.width,0,0),a.halfHeight.set(0,.5*m.height,0),a.halfWidth.applyMatrix4(h),a.halfHeight.applyMatrix4(h),j++}else if(m.isPointLight){let a=e.point[d];a.position.setFromMatrixPosition(m.matrixWorld),a.position.applyMatrix4(l),d++}else if(m.isHemisphereLight){let a=e.hemi[k];a.direction.setFromMatrixPosition(m.matrixWorld),a.direction.transformDirection(l),k++}}},state:e}}function NN(a){let b=new NM(a),c=[],d=[],e={lightsArray:c,shadowsArray:d,camera:null,lights:b,transmissionRenderTarget:{}};return{init:function(a){e.camera=a,c.length=0,d.length=0},state:e,setupLights:function(){b.setup(c)},setupLightsView:function(a){b.setupView(c,a)},pushLight:function(a){c.push(a)},pushShadow:function(a){d.push(a)}}}function NO(a){let b=new WeakMap;return{get:function(c,d=0){let e,f=b.get(c);return void 0===f?(e=new NN(a),b.set(c,[e])):d>=f.length?(e=new NN(a),f.push(e)):e=f[d],e},dispose:function(){b=new WeakMap}}}let NP=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,NQ=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function NR(a,b,c){let d=new LG,e=new Jc,f=new Jc,g=new Jv,h=new LL({depthPacking:3201}),i=new LM,j={},k=c.maxTextureSize,l={0:1,1:0,2:2},m=new Li({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Jc},radius:{value:4}},vertexShader:NP,fragmentShader:NQ}),n=m.clone();n.defines.HORIZONTAL_PASS=1;let o=new K$;o.setAttribute("position",new KP(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let p=new La(o,m),q=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;let r=this.type;function s(b,c,d,e){let f=null,g=!0===d.isPointLight?b.customDistanceMaterial:b.customDepthMaterial;if(void 0!==g)f=g;else if(f=!0===d.isPointLight?i:h,a.localClippingEnabled&&!0===c.clipShadows&&Array.isArray(c.clippingPlanes)&&0!==c.clippingPlanes.length||c.displacementMap&&0!==c.displacementScale||c.alphaMap&&c.alphaTest>0||c.map&&c.alphaTest>0||!0===c.alphaToCoverage){let a=f.uuid,b=c.uuid,d=j[a];void 0===d&&(d={},j[a]=d);let e=d[b];void 0===e&&(e=f.clone(),d[b]=e,c.addEventListener("dispose",t)),f=e}return f.visible=c.visible,f.wireframe=c.wireframe,3===e?f.side=null!==c.shadowSide?c.shadowSide:c.side:f.side=null!==c.shadowSide?c.shadowSide:l[c.side],f.alphaMap=c.alphaMap,f.alphaTest=!0===c.alphaToCoverage?.5:c.alphaTest,f.map=c.map,f.clipShadows=c.clipShadows,f.clippingPlanes=c.clippingPlanes,f.clipIntersection=c.clipIntersection,f.displacementMap=c.displacementMap,f.displacementScale=c.displacementScale,f.displacementBias=c.displacementBias,f.wireframeLinewidth=c.wireframeLinewidth,f.linewidth=c.linewidth,!0===d.isPointLight&&!0===f.isMeshDistanceMaterial&&(a.properties.get(f).light=d),f}function t(a){for(let b in a.target.removeEventListener("dispose",t),j){let c=j[b],d=a.target.uuid;d in c&&(c[d].dispose(),delete c[d])}}this.render=function(c,h,i){if(!1===q.enabled||!1===q.autoUpdate&&!1===q.needsUpdate||0===c.length)return;let j=a.getRenderTarget(),l=a.getActiveCubeFace(),o=a.getActiveMipmapLevel(),t=a.state;t.setBlending(0),!0===t.buffers.depth.getReversed()?t.buffers.color.setClear(0,0,0,0):t.buffers.color.setClear(1,1,1,1),t.buffers.depth.setTest(!0),t.setScissorTest(!1);let u=3!==r&&3===this.type,v=3===r&&3!==this.type;for(let j=0,l=c.length;j<l;j++){let l=c[j],o=l.shadow;if(void 0===o){I0("WebGLShadowMap:",l,"has no shadow.");continue}if(!1===o.autoUpdate&&!1===o.needsUpdate)continue;e.copy(o.mapSize);let q=o.getFrameExtents();if(e.multiply(q),f.copy(o.mapSize),(e.x>k||e.y>k)&&(e.x>k&&(f.x=Math.floor(k/q.x),e.x=f.x*q.x,o.mapSize.x=f.x),e.y>k&&(f.y=Math.floor(k/q.y),e.y=f.y*q.y,o.mapSize.y=f.y)),null===o.map||!0===u||!0===v){let a=3!==this.type?{minFilter:1003,magFilter:1003}:{};null!==o.map&&o.map.dispose(),o.map=new Jx(e.x,e.y,a),o.map.texture.name=l.name+".shadowMap",o.camera.updateProjectionMatrix()}a.setRenderTarget(o.map),a.clear();let r=o.getViewportCount();for(let c=0;c<r;c++){let e=o.getViewport(c);g.set(f.x*e.x,f.y*e.y,f.x*e.z,f.y*e.w),t.viewport(g),o.updateMatrices(l,c),d=o.getFrustum(),function c(e,f,g,h,i){if(!1===e.visible)return;if(e.layers.test(f.layers)&&(e.isMesh||e.isLine||e.isPoints)&&(e.castShadow||e.receiveShadow&&3===i)&&(!e.frustumCulled||d.intersectsObject(e))){e.modelViewMatrix.multiplyMatrices(g.matrixWorldInverse,e.matrixWorld);let c=b.update(e),d=e.material;if(Array.isArray(d)){let b=c.groups;for(let j=0,k=b.length;j<k;j++){let k=b[j],l=d[k.materialIndex];if(l&&l.visible){let b=s(e,l,h,i);e.onBeforeShadow(a,e,f,g,c,b,k),a.renderBufferDirect(g,null,c,b,e,k),e.onAfterShadow(a,e,f,g,c,b,k)}}}else if(d.visible){let b=s(e,d,h,i);e.onBeforeShadow(a,e,f,g,c,b,null),a.renderBufferDirect(g,null,c,b,e,null),e.onAfterShadow(a,e,f,g,c,b,null)}}let j=e.children;for(let a=0,b=j.length;a<b;a++)c(j[a],f,g,h,i)}(h,i,o.camera,l,this.type)}!0!==o.isPointLightShadow&&3===this.type&&function(c,d){let f=b.update(p);m.defines.VSM_SAMPLES!==c.blurSamples&&(m.defines.VSM_SAMPLES=c.blurSamples,n.defines.VSM_SAMPLES=c.blurSamples,m.needsUpdate=!0,n.needsUpdate=!0),null===c.mapPass&&(c.mapPass=new Jx(e.x,e.y)),m.uniforms.shadow_pass.value=c.map.texture,m.uniforms.resolution.value=c.mapSize,m.uniforms.radius.value=c.radius,a.setRenderTarget(c.mapPass),a.clear(),a.renderBufferDirect(d,null,f,m,p,null),n.uniforms.shadow_pass.value=c.mapPass.texture,n.uniforms.resolution.value=c.mapSize,n.uniforms.radius.value=c.radius,a.setRenderTarget(c.map),a.clear(),a.renderBufferDirect(d,null,f,n,p,null)}(o,i),o.needsUpdate=!1}r=this.type,q.needsUpdate=!1,a.setRenderTarget(j,l,o)}}let NS={0:1,2:6,4:7,3:5,1:0,6:2,7:4,5:3};function NT(a,b){let c=new function(){let b=!1,c=new Jv,d=null,e=new Jv(0,0,0,0);return{setMask:function(c){d===c||b||(a.colorMask(c,c,c,c),d=c)},setLocked:function(a){b=a},setClear:function(b,d,f,g,h){!0===h&&(b*=g,d*=g,f*=g),c.set(b,d,f,g),!1===e.equals(c)&&(a.clearColor(b,d,f,g),e.copy(c))},reset:function(){b=!1,d=null,e.set(-1,0,0,0)}}},d=new function(){let c=!1,d=!1,e=null,f=null,g=null;return{setReversed:function(a){if(d!==a){let c=b.get("EXT_clip_control");a?c.clipControlEXT(c.LOWER_LEFT_EXT,c.ZERO_TO_ONE_EXT):c.clipControlEXT(c.LOWER_LEFT_EXT,c.NEGATIVE_ONE_TO_ONE_EXT),d=a;let e=g;g=null,this.setClear(e)}},getReversed:function(){return d},setTest:function(b){b?N(a.DEPTH_TEST):O(a.DEPTH_TEST)},setMask:function(b){e===b||c||(a.depthMask(b),e=b)},setFunc:function(b){if(d&&(b=NS[b]),f!==b){switch(b){case 0:a.depthFunc(a.NEVER);break;case 1:a.depthFunc(a.ALWAYS);break;case 2:a.depthFunc(a.LESS);break;case 3:default:a.depthFunc(a.LEQUAL);break;case 4:a.depthFunc(a.EQUAL);break;case 5:a.depthFunc(a.GEQUAL);break;case 6:a.depthFunc(a.GREATER);break;case 7:a.depthFunc(a.NOTEQUAL)}f=b}},setLocked:function(a){c=a},setClear:function(b){g!==b&&(d&&(b=1-b),a.clearDepth(b),g=b)},reset:function(){c=!1,e=null,f=null,g=null,d=!1}}},e=new function(){let b=!1,c=null,d=null,e=null,f=null,g=null,h=null,i=null,j=null;return{setTest:function(c){b||(c?N(a.STENCIL_TEST):O(a.STENCIL_TEST))},setMask:function(d){c===d||b||(a.stencilMask(d),c=d)},setFunc:function(b,c,g){(d!==b||e!==c||f!==g)&&(a.stencilFunc(b,c,g),d=b,e=c,f=g)},setOp:function(b,c,d){(g!==b||h!==c||i!==d)&&(a.stencilOp(b,c,d),g=b,h=c,i=d)},setLocked:function(a){b=a},setClear:function(b){j!==b&&(a.clearStencil(b),j=b)},reset:function(){b=!1,c=null,d=null,e=null,f=null,g=null,h=null,i=null,j=null}}},f=new WeakMap,g=new WeakMap,h={},i={},j=new WeakMap,k=[],l=null,m=!1,n=null,o=null,p=null,q=null,r=null,s=null,t=null,u=new KH(0,0,0),v=0,w=!1,x=null,y=null,z=null,A=null,B=null,C=a.getParameter(a.MAX_COMBINED_TEXTURE_IMAGE_UNITS),D=!1,E=a.getParameter(a.VERSION);-1!==E.indexOf("WebGL")?D=parseFloat(/^WebGL (\d)/.exec(E)[1])>=1:-1!==E.indexOf("OpenGL ES")&&(D=parseFloat(/^OpenGL ES (\d)/.exec(E)[1])>=2);let F=null,G={},H=a.getParameter(a.SCISSOR_BOX),I=a.getParameter(a.VIEWPORT),J=new Jv().fromArray(H),K=new Jv().fromArray(I);function L(b,c,d,e){let f=new Uint8Array(4),g=a.createTexture();a.bindTexture(b,g),a.texParameteri(b,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(b,a.TEXTURE_MAG_FILTER,a.NEAREST);for(let g=0;g<d;g++)b===a.TEXTURE_3D||b===a.TEXTURE_2D_ARRAY?a.texImage3D(c,0,a.RGBA,1,1,e,0,a.RGBA,a.UNSIGNED_BYTE,f):a.texImage2D(c+g,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,f);return g}let M={};function N(b){!0!==h[b]&&(a.enable(b),h[b]=!0)}function O(b){!1!==h[b]&&(a.disable(b),h[b]=!1)}M[a.TEXTURE_2D]=L(a.TEXTURE_2D,a.TEXTURE_2D,1),M[a.TEXTURE_CUBE_MAP]=L(a.TEXTURE_CUBE_MAP,a.TEXTURE_CUBE_MAP_POSITIVE_X,6),M[a.TEXTURE_2D_ARRAY]=L(a.TEXTURE_2D_ARRAY,a.TEXTURE_2D_ARRAY,1,1),M[a.TEXTURE_3D]=L(a.TEXTURE_3D,a.TEXTURE_3D,1,1),c.setClear(0,0,0,1),d.setClear(1),e.setClear(0),N(a.DEPTH_TEST),d.setFunc(3),S(!1),T(1),N(a.CULL_FACE),R(0);let P={100:a.FUNC_ADD,101:a.FUNC_SUBTRACT,102:a.FUNC_REVERSE_SUBTRACT};P[103]=a.MIN,P[104]=a.MAX;let Q={200:a.ZERO,201:a.ONE,202:a.SRC_COLOR,204:a.SRC_ALPHA,210:a.SRC_ALPHA_SATURATE,208:a.DST_COLOR,206:a.DST_ALPHA,203:a.ONE_MINUS_SRC_COLOR,205:a.ONE_MINUS_SRC_ALPHA,209:a.ONE_MINUS_DST_COLOR,207:a.ONE_MINUS_DST_ALPHA,211:a.CONSTANT_COLOR,212:a.ONE_MINUS_CONSTANT_COLOR,213:a.CONSTANT_ALPHA,214:a.ONE_MINUS_CONSTANT_ALPHA};function R(b,c,d,e,f,g,h,i,j,k){if(0===b){!0===m&&(O(a.BLEND),m=!1);return}if(!1===m&&(N(a.BLEND),m=!0),5!==b){if(b!==n||k!==w){if((100!==o||100!==r)&&(a.blendEquation(a.FUNC_ADD),o=100,r=100),k)switch(b){case 1:a.blendFuncSeparate(a.ONE,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA);break;case 2:a.blendFunc(a.ONE,a.ONE);break;case 3:a.blendFuncSeparate(a.ZERO,a.ONE_MINUS_SRC_COLOR,a.ZERO,a.ONE);break;case 4:a.blendFuncSeparate(a.DST_COLOR,a.ONE_MINUS_SRC_ALPHA,a.ZERO,a.ONE);break;default:I1("WebGLState: Invalid blending: ",b)}else switch(b){case 1:a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA);break;case 2:a.blendFuncSeparate(a.SRC_ALPHA,a.ONE,a.ONE,a.ONE);break;case 3:I1("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case 4:I1("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:I1("WebGLState: Invalid blending: ",b)}p=null,q=null,s=null,t=null,u.set(0,0,0),v=0,n=b,w=k}return}f=f||c,g=g||d,h=h||e,(c!==o||f!==r)&&(a.blendEquationSeparate(P[c],P[f]),o=c,r=f),(d!==p||e!==q||g!==s||h!==t)&&(a.blendFuncSeparate(Q[d],Q[e],Q[g],Q[h]),p=d,q=e,s=g,t=h),(!1===i.equals(u)||j!==v)&&(a.blendColor(i.r,i.g,i.b,j),u.copy(i),v=j),n=b,w=!1}function S(b){x!==b&&(b?a.frontFace(a.CW):a.frontFace(a.CCW),x=b)}function T(b){0!==b?(N(a.CULL_FACE),b!==y&&(1===b?a.cullFace(a.BACK):2===b?a.cullFace(a.FRONT):a.cullFace(a.FRONT_AND_BACK))):O(a.CULL_FACE),y=b}function U(b,c,d){b?(N(a.POLYGON_OFFSET_FILL),(A!==c||B!==d)&&(a.polygonOffset(c,d),A=c,B=d)):O(a.POLYGON_OFFSET_FILL)}return{buffers:{color:c,depth:d,stencil:e},enable:N,disable:O,bindFramebuffer:function(b,c){return i[b]!==c&&(a.bindFramebuffer(b,c),i[b]=c,b===a.DRAW_FRAMEBUFFER&&(i[a.FRAMEBUFFER]=c),b===a.FRAMEBUFFER&&(i[a.DRAW_FRAMEBUFFER]=c),!0)},drawBuffers:function(b,c){let d=k,e=!1;if(b){void 0===(d=j.get(c))&&(d=[],j.set(c,d));let f=b.textures;if(d.length!==f.length||d[0]!==a.COLOR_ATTACHMENT0){for(let b=0,c=f.length;b<c;b++)d[b]=a.COLOR_ATTACHMENT0+b;d.length=f.length,e=!0}}else d[0]!==a.BACK&&(d[0]=a.BACK,e=!0);e&&a.drawBuffers(d)},useProgram:function(b){return l!==b&&(a.useProgram(b),l=b,!0)},setBlending:R,setMaterial:function(b,f){2===b.side?O(a.CULL_FACE):N(a.CULL_FACE);let g=1===b.side;f&&(g=!g),S(g),1===b.blending&&!1===b.transparent?R(0):R(b.blending,b.blendEquation,b.blendSrc,b.blendDst,b.blendEquationAlpha,b.blendSrcAlpha,b.blendDstAlpha,b.blendColor,b.blendAlpha,b.premultipliedAlpha),d.setFunc(b.depthFunc),d.setTest(b.depthTest),d.setMask(b.depthWrite),c.setMask(b.colorWrite);let h=b.stencilWrite;e.setTest(h),h&&(e.setMask(b.stencilWriteMask),e.setFunc(b.stencilFunc,b.stencilRef,b.stencilFuncMask),e.setOp(b.stencilFail,b.stencilZFail,b.stencilZPass)),U(b.polygonOffset,b.polygonOffsetFactor,b.polygonOffsetUnits),!0===b.alphaToCoverage?N(a.SAMPLE_ALPHA_TO_COVERAGE):O(a.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:S,setCullFace:T,setLineWidth:function(b){b!==z&&(D&&a.lineWidth(b),z=b)},setPolygonOffset:U,setScissorTest:function(b){b?N(a.SCISSOR_TEST):O(a.SCISSOR_TEST)},activeTexture:function(b){void 0===b&&(b=a.TEXTURE0+C-1),F!==b&&(a.activeTexture(b),F=b)},bindTexture:function(b,c,d){void 0===d&&(d=null===F?a.TEXTURE0+C-1:F);let e=G[d];void 0===e&&(e={type:void 0,texture:void 0},G[d]=e),(e.type!==b||e.texture!==c)&&(F!==d&&(a.activeTexture(d),F=d),a.bindTexture(b,c||M[b]),e.type=b,e.texture=c)},unbindTexture:function(){let b=G[F];void 0!==b&&void 0!==b.type&&(a.bindTexture(b.type,null),b.type=void 0,b.texture=void 0)},compressedTexImage2D:function(){try{a.compressedTexImage2D(...arguments)}catch(a){a("WebGLState:",a)}},compressedTexImage3D:function(){try{a.compressedTexImage3D(...arguments)}catch(a){a("WebGLState:",a)}},texImage2D:function(){try{a.texImage2D(...arguments)}catch(a){a("WebGLState:",a)}},texImage3D:function(){try{a.texImage3D(...arguments)}catch(a){a("WebGLState:",a)}},updateUBOMapping:function(b,c){let d=g.get(c);void 0===d&&(d=new WeakMap,g.set(c,d));let e=d.get(b);void 0===e&&(e=a.getUniformBlockIndex(c,b.name),d.set(b,e))},uniformBlockBinding:function(b,c){let d=g.get(c).get(b);f.get(c)!==d&&(a.uniformBlockBinding(c,d,b.__bindingPointIndex),f.set(c,d))},texStorage2D:function(){try{a.texStorage2D(...arguments)}catch(a){a("WebGLState:",a)}},texStorage3D:function(){try{a.texStorage3D(...arguments)}catch(a){a("WebGLState:",a)}},texSubImage2D:function(){try{a.texSubImage2D(...arguments)}catch(a){a("WebGLState:",a)}},texSubImage3D:function(){try{a.texSubImage3D(...arguments)}catch(a){a("WebGLState:",a)}},compressedTexSubImage2D:function(){try{a.compressedTexSubImage2D(...arguments)}catch(a){a("WebGLState:",a)}},compressedTexSubImage3D:function(){try{a.compressedTexSubImage3D(...arguments)}catch(a){a("WebGLState:",a)}},scissor:function(b){!1===J.equals(b)&&(a.scissor(b.x,b.y,b.z,b.w),J.copy(b))},viewport:function(b){!1===K.equals(b)&&(a.viewport(b.x,b.y,b.z,b.w),K.copy(b))},reset:function(){a.disable(a.BLEND),a.disable(a.CULL_FACE),a.disable(a.DEPTH_TEST),a.disable(a.POLYGON_OFFSET_FILL),a.disable(a.SCISSOR_TEST),a.disable(a.STENCIL_TEST),a.disable(a.SAMPLE_ALPHA_TO_COVERAGE),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ONE,a.ZERO),a.blendFuncSeparate(a.ONE,a.ZERO,a.ONE,a.ZERO),a.blendColor(0,0,0,0),a.colorMask(!0,!0,!0,!0),a.clearColor(0,0,0,0),a.depthMask(!0),a.depthFunc(a.LESS),d.setReversed(!1),a.clearDepth(1),a.stencilMask(0xffffffff),a.stencilFunc(a.ALWAYS,0,0xffffffff),a.stencilOp(a.KEEP,a.KEEP,a.KEEP),a.clearStencil(0),a.cullFace(a.BACK),a.frontFace(a.CCW),a.polygonOffset(0,0),a.activeTexture(a.TEXTURE0),a.bindFramebuffer(a.FRAMEBUFFER,null),a.bindFramebuffer(a.DRAW_FRAMEBUFFER,null),a.bindFramebuffer(a.READ_FRAMEBUFFER,null),a.useProgram(null),a.lineWidth(1),a.scissor(0,0,a.canvas.width,a.canvas.height),a.viewport(0,0,a.canvas.width,a.canvas.height),h={},F=null,G={},i={},j=new WeakMap,k=[],l=null,m=!1,n=null,o=null,p=null,q=null,r=null,s=null,t=null,u=new KH(0,0,0),v=0,w=!1,x=null,y=null,z=null,A=null,B=null,J.set(0,0,a.canvas.width,a.canvas.height),K.set(0,0,a.canvas.width,a.canvas.height),c.reset(),d.reset(),e.reset()}}}function NU(a,b,c,d,e,f,g){let h,i=b.has("WEBGL_multisampled_render_to_texture")?b.get("WEBGL_multisampled_render_to_texture"):null,j=!(typeof navigator>"u")&&/OculusBrowser/g.test(navigator.userAgent),k=new Jc,l=new WeakMap,m=new WeakMap,n=!1;try{n="u">typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch{}function o(a,b){return n?new OffscreenCanvas(a,b):IZ("canvas")}function p(a,b,c){let d=1,e=Q(a);if((e.width>c||e.height>c)&&(d=c/Math.max(e.width,e.height)),d<1)if(!("u">typeof HTMLImageElement&&a instanceof HTMLImageElement||"u">typeof HTMLCanvasElement&&a instanceof HTMLCanvasElement||"u">typeof ImageBitmap&&a instanceof ImageBitmap||"u">typeof VideoFrame&&a instanceof VideoFrame))return"data"in a&&I0("WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),a;else{let c=Math.floor(d*e.width),f=Math.floor(d*e.height);void 0===h&&(h=o(c,f));let g=b?o(c,f):h;return g.width=c,g.height=f,g.getContext("2d").drawImage(a,0,0,c,f),I0("WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+c+"x"+f+")."),g}return a}function q(a){return a.generateMipmaps}function r(b){a.generateMipmap(b)}function s(c,d,e,f,g=!1){if(null!==c){if(void 0!==a[c])return a[c];I0("WebGLRenderer: Attempt to use non-existing WebGL internal format '"+c+"'")}let h=d;if(d===a.RED&&(e===a.FLOAT&&(h=a.R32F),e===a.HALF_FLOAT&&(h=a.R16F),e===a.UNSIGNED_BYTE&&(h=a.R8)),d===a.RED_INTEGER&&(e===a.UNSIGNED_BYTE&&(h=a.R8UI),e===a.UNSIGNED_SHORT&&(h=a.R16UI),e===a.UNSIGNED_INT&&(h=a.R32UI),e===a.BYTE&&(h=a.R8I),e===a.SHORT&&(h=a.R16I),e===a.INT&&(h=a.R32I)),d===a.RG&&(e===a.FLOAT&&(h=a.RG32F),e===a.HALF_FLOAT&&(h=a.RG16F),e===a.UNSIGNED_BYTE&&(h=a.RG8)),d===a.RG_INTEGER&&(e===a.UNSIGNED_BYTE&&(h=a.RG8UI),e===a.UNSIGNED_SHORT&&(h=a.RG16UI),e===a.UNSIGNED_INT&&(h=a.RG32UI),e===a.BYTE&&(h=a.RG8I),e===a.SHORT&&(h=a.RG16I),e===a.INT&&(h=a.RG32I)),d===a.RGB_INTEGER&&(e===a.UNSIGNED_BYTE&&(h=a.RGB8UI),e===a.UNSIGNED_SHORT&&(h=a.RGB16UI),e===a.UNSIGNED_INT&&(h=a.RGB32UI),e===a.BYTE&&(h=a.RGB8I),e===a.SHORT&&(h=a.RGB16I),e===a.INT&&(h=a.RGB32I)),d===a.RGBA_INTEGER&&(e===a.UNSIGNED_BYTE&&(h=a.RGBA8UI),e===a.UNSIGNED_SHORT&&(h=a.RGBA16UI),e===a.UNSIGNED_INT&&(h=a.RGBA32UI),e===a.BYTE&&(h=a.RGBA8I),e===a.SHORT&&(h=a.RGBA16I),e===a.INT&&(h=a.RGBA32I)),d===a.RGB&&(e===a.UNSIGNED_INT_5_9_9_9_REV&&(h=a.RGB9_E5),e===a.UNSIGNED_INT_10F_11F_11F_REV&&(h=a.R11F_G11F_B10F)),d===a.RGBA){let b=g?IV:Jl.getTransfer(f);e===a.FLOAT&&(h=a.RGBA32F),e===a.HALF_FLOAT&&(h=a.RGBA16F),e===a.UNSIGNED_BYTE&&(h=b===IW?a.SRGB8_ALPHA8:a.RGBA8),e===a.UNSIGNED_SHORT_4_4_4_4&&(h=a.RGBA4),e===a.UNSIGNED_SHORT_5_5_5_1&&(h=a.RGB5_A1)}return(h===a.R16F||h===a.R32F||h===a.RG16F||h===a.RG32F||h===a.RGBA16F||h===a.RGBA32F)&&b.get("EXT_color_buffer_float"),h}function t(b,c){let d;return b?null===c||1014===c||1020===c?d=a.DEPTH24_STENCIL8:1015===c?d=a.DEPTH32F_STENCIL8:1012===c&&(d=a.DEPTH24_STENCIL8,I0("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===c||1014===c||1020===c?d=a.DEPTH_COMPONENT24:1015===c?d=a.DEPTH_COMPONENT32F:1012===c&&(d=a.DEPTH_COMPONENT16),d}function u(a,b){return!0===q(a)||a.isFramebufferTexture&&1003!==a.minFilter&&1006!==a.minFilter?Math.log2(Math.max(b.width,b.height))+1:void 0!==a.mipmaps&&a.mipmaps.length>0?a.mipmaps.length:a.isCompressedTexture&&Array.isArray(a.image)?b.mipmaps.length:1}function v(a){let b=a.target;b.removeEventListener("dispose",v),function(a){let b=d.get(a);if(void 0===b.__webglInit)return;let c=a.source,e=m.get(c);if(e){let d=e[b.__cacheKey];d.usedTimes--,0===d.usedTimes&&x(a),0===Object.keys(e).length&&m.delete(c)}d.remove(a)}(b),b.isVideoTexture&&l.delete(b)}function w(b){let c=b.target;c.removeEventListener("dispose",w),function(b){let c=d.get(b);if(b.depthTexture&&(b.depthTexture.dispose(),d.remove(b.depthTexture)),b.isWebGLCubeRenderTarget)for(let b=0;b<6;b++){if(Array.isArray(c.__webglFramebuffer[b]))for(let d=0;d<c.__webglFramebuffer[b].length;d++)a.deleteFramebuffer(c.__webglFramebuffer[b][d]);else a.deleteFramebuffer(c.__webglFramebuffer[b]);c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer[b])}else{if(Array.isArray(c.__webglFramebuffer))for(let b=0;b<c.__webglFramebuffer.length;b++)a.deleteFramebuffer(c.__webglFramebuffer[b]);else a.deleteFramebuffer(c.__webglFramebuffer);if(c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer),c.__webglMultisampledFramebuffer&&a.deleteFramebuffer(c.__webglMultisampledFramebuffer),c.__webglColorRenderbuffer)for(let b=0;b<c.__webglColorRenderbuffer.length;b++)c.__webglColorRenderbuffer[b]&&a.deleteRenderbuffer(c.__webglColorRenderbuffer[b]);c.__webglDepthRenderbuffer&&a.deleteRenderbuffer(c.__webglDepthRenderbuffer)}let e=b.textures;for(let b=0,c=e.length;b<c;b++){let c=d.get(e[b]);c.__webglTexture&&(a.deleteTexture(c.__webglTexture),g.memory.textures--),d.remove(e[b])}d.remove(b)}(c)}function x(b){let c=d.get(b);a.deleteTexture(c.__webglTexture);let e=b.source,f=m.get(e);delete f[c.__cacheKey],g.memory.textures--}let y=0;function z(b,e){var f;let h,i=d.get(b);if(b.isVideoTexture&&(f=b,h=g.render.frame,l.get(f)!==h&&(l.set(f,h),f.update())),!1===b.isRenderTargetTexture&&!0!==b.isExternalTexture&&b.version>0&&i.__version!==b.version){let a=b.image;if(null===a)I0("WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==a.complete)return void G(i,b,e);I0("WebGLRenderer: Texture marked for update but image is incomplete")}}else b.isExternalTexture&&(i.__webglTexture=b.sourceTexture?b.sourceTexture:null);c.bindTexture(a.TEXTURE_2D,i.__webglTexture,a.TEXTURE0+e)}let A={1e3:a.REPEAT,1001:a.CLAMP_TO_EDGE,1002:a.MIRRORED_REPEAT},B={1003:a.NEAREST,1004:a.NEAREST_MIPMAP_NEAREST,1005:a.NEAREST_MIPMAP_LINEAR,1006:a.LINEAR,1007:a.LINEAR_MIPMAP_NEAREST,1008:a.LINEAR_MIPMAP_LINEAR},C={512:a.NEVER,519:a.ALWAYS,513:a.LESS,515:a.LEQUAL,514:a.EQUAL,518:a.GEQUAL,516:a.GREATER,517:a.NOTEQUAL};function D(c,f){if(1015===f.type&&!1===b.has("OES_texture_float_linear")&&(1006===f.magFilter||1007===f.magFilter||1005===f.magFilter||1008===f.magFilter||1006===f.minFilter||1007===f.minFilter||1005===f.minFilter||1008===f.minFilter)&&I0("WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),a.texParameteri(c,a.TEXTURE_WRAP_S,A[f.wrapS]),a.texParameteri(c,a.TEXTURE_WRAP_T,A[f.wrapT]),(c===a.TEXTURE_3D||c===a.TEXTURE_2D_ARRAY)&&a.texParameteri(c,a.TEXTURE_WRAP_R,A[f.wrapR]),a.texParameteri(c,a.TEXTURE_MAG_FILTER,B[f.magFilter]),a.texParameteri(c,a.TEXTURE_MIN_FILTER,B[f.minFilter]),f.compareFunction&&(a.texParameteri(c,a.TEXTURE_COMPARE_MODE,a.COMPARE_REF_TO_TEXTURE),a.texParameteri(c,a.TEXTURE_COMPARE_FUNC,C[f.compareFunction])),!0===b.has("EXT_texture_filter_anisotropic")&&1003!==f.magFilter&&(1005===f.minFilter||1008===f.minFilter)&&(1015!==f.type||!1!==b.has("OES_texture_float_linear"))&&(f.anisotropy>1||d.get(f).__currentAnisotropy)){let g=b.get("EXT_texture_filter_anisotropic");a.texParameterf(c,g.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(f.anisotropy,e.getMaxAnisotropy())),d.get(f).__currentAnisotropy=f.anisotropy}}function E(b,c){let d,e=!1;void 0===b.__webglInit&&(b.__webglInit=!0,c.addEventListener("dispose",v));let f=c.source,h=m.get(f);void 0===h&&(h={},m.set(f,h));let i=((d=[]).push(c.wrapS),d.push(c.wrapT),d.push(c.wrapR||0),d.push(c.magFilter),d.push(c.minFilter),d.push(c.anisotropy),d.push(c.internalFormat),d.push(c.format),d.push(c.type),d.push(c.generateMipmaps),d.push(c.premultiplyAlpha),d.push(c.flipY),d.push(c.unpackAlignment),d.push(c.colorSpace),d.join());if(i!==b.__cacheKey){void 0===h[i]&&(h[i]={texture:a.createTexture(),usedTimes:0},g.memory.textures++,e=!0),h[i].usedTimes++;let d=h[b.__cacheKey];void 0!==d&&(h[b.__cacheKey].usedTimes--,0===d.usedTimes&&x(c)),b.__cacheKey=i,b.__webglTexture=h[i].texture}return e}function F(a,b,c){return Math.floor(Math.floor(a/c)/b)}function G(b,g,h){let i=a.TEXTURE_2D;(g.isDataArrayTexture||g.isCompressedArrayTexture)&&(i=a.TEXTURE_2D_ARRAY),g.isData3DTexture&&(i=a.TEXTURE_3D);let j=E(b,g),k=g.source;c.bindTexture(i,b.__webglTexture,a.TEXTURE0+h);let l=d.get(k);if(k.version!==l.__version||!0===j){let b;c.activeTexture(a.TEXTURE0+h);let d=Jl.getPrimaries(Jl.workingColorSpace),m=""===g.colorSpace?null:Jl.getPrimaries(g.colorSpace),n=""===g.colorSpace||d===m?a.NONE:a.BROWSER_DEFAULT_WEBGL;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,g.flipY),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,g.premultiplyAlpha),a.pixelStorei(a.UNPACK_ALIGNMENT,g.unpackAlignment),a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,n);let o=p(g.image,!1,e.maxTextureSize);o=P(g,o);let v=f.convert(g.format,g.colorSpace),w=f.convert(g.type),x=s(g.internalFormat,v,w,g.colorSpace,g.isVideoTexture);D(i,g);let y=g.mipmaps,z=!0!==g.isVideoTexture,A=void 0===l.__version||!0===j,B=k.dataReady,C=u(g,o);if(g.isDepthTexture)x=t(1027===g.format,g.type),A&&(z?c.texStorage2D(a.TEXTURE_2D,1,x,o.width,o.height):c.texImage2D(a.TEXTURE_2D,0,x,o.width,o.height,0,v,w,null));else if(g.isDataTexture)if(y.length>0){z&&A&&c.texStorage2D(a.TEXTURE_2D,C,x,y[0].width,y[0].height);for(let d=0,e=y.length;d<e;d++)b=y[d],z?B&&c.texSubImage2D(a.TEXTURE_2D,d,0,0,b.width,b.height,v,w,b.data):c.texImage2D(a.TEXTURE_2D,d,x,b.width,b.height,0,v,w,b.data);g.generateMipmaps=!1}else z?(A&&c.texStorage2D(a.TEXTURE_2D,C,x,o.width,o.height),B&&function(b,d,e,f){let g=b.updateRanges;if(0===g.length)c.texSubImage2D(a.TEXTURE_2D,0,0,0,d.width,d.height,e,f,d.data);else{g.sort((a,b)=>a.start-b.start);let h=0;for(let a=1;a<g.length;a++){let b=g[h],c=g[a],e=b.start+b.count,f=F(c.start,d.width,4),i=F(b.start,d.width,4);c.start<=e+1&&f===i&&F(c.start+c.count-1,d.width,4)===f?b.count=Math.max(b.count,c.start+c.count-b.start):g[++h]=c}g.length=h+1;let i=a.getParameter(a.UNPACK_ROW_LENGTH),j=a.getParameter(a.UNPACK_SKIP_PIXELS),k=a.getParameter(a.UNPACK_SKIP_ROWS);a.pixelStorei(a.UNPACK_ROW_LENGTH,d.width);for(let b=0,h=g.length;b<h;b++){let h=g[b],i=Math.floor(h.start/4),j=Math.ceil(h.count/4),k=i%d.width,l=Math.floor(i/d.width);a.pixelStorei(a.UNPACK_SKIP_PIXELS,k),a.pixelStorei(a.UNPACK_SKIP_ROWS,l),c.texSubImage2D(a.TEXTURE_2D,0,k,l,j,1,e,f,d.data)}b.clearUpdateRanges(),a.pixelStorei(a.UNPACK_ROW_LENGTH,i),a.pixelStorei(a.UNPACK_SKIP_PIXELS,j),a.pixelStorei(a.UNPACK_SKIP_ROWS,k)}}(g,o,v,w)):c.texImage2D(a.TEXTURE_2D,0,x,o.width,o.height,0,v,w,o.data);else if(g.isCompressedTexture)if(g.isCompressedArrayTexture){z&&A&&c.texStorage3D(a.TEXTURE_2D_ARRAY,C,x,y[0].width,y[0].height,o.depth);for(let d=0,e=y.length;d<e;d++)if(b=y[d],1023!==g.format)if(null!==v)if(z){if(B)if(g.layerUpdates.size>0){let e=LR(b.width,b.height,g.format,g.type);for(let f of g.layerUpdates){let g=b.data.subarray(f*e/b.data.BYTES_PER_ELEMENT,(f+1)*e/b.data.BYTES_PER_ELEMENT);c.compressedTexSubImage3D(a.TEXTURE_2D_ARRAY,d,0,0,f,b.width,b.height,1,v,g)}g.clearLayerUpdates()}else c.compressedTexSubImage3D(a.TEXTURE_2D_ARRAY,d,0,0,0,b.width,b.height,o.depth,v,b.data)}else c.compressedTexImage3D(a.TEXTURE_2D_ARRAY,d,x,b.width,b.height,o.depth,0,b.data,0,0);else I0("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else z?B&&c.texSubImage3D(a.TEXTURE_2D_ARRAY,d,0,0,0,b.width,b.height,o.depth,v,w,b.data):c.texImage3D(a.TEXTURE_2D_ARRAY,d,x,b.width,b.height,o.depth,0,v,w,b.data)}else{z&&A&&c.texStorage2D(a.TEXTURE_2D,C,x,y[0].width,y[0].height);for(let d=0,e=y.length;d<e;d++)b=y[d],1023!==g.format?null!==v?z?B&&c.compressedTexSubImage2D(a.TEXTURE_2D,d,0,0,b.width,b.height,v,b.data):c.compressedTexImage2D(a.TEXTURE_2D,d,x,b.width,b.height,0,b.data):I0("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):z?B&&c.texSubImage2D(a.TEXTURE_2D,d,0,0,b.width,b.height,v,w,b.data):c.texImage2D(a.TEXTURE_2D,d,x,b.width,b.height,0,v,w,b.data)}else if(g.isDataArrayTexture)if(z){if(A&&c.texStorage3D(a.TEXTURE_2D_ARRAY,C,x,o.width,o.height,o.depth),B)if(g.layerUpdates.size>0){let b=LR(o.width,o.height,g.format,g.type);for(let d of g.layerUpdates){let e=o.data.subarray(d*b/o.data.BYTES_PER_ELEMENT,(d+1)*b/o.data.BYTES_PER_ELEMENT);c.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,d,o.width,o.height,1,v,w,e)}g.clearLayerUpdates()}else c.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,0,o.width,o.height,o.depth,v,w,o.data)}else c.texImage3D(a.TEXTURE_2D_ARRAY,0,x,o.width,o.height,o.depth,0,v,w,o.data);else if(g.isData3DTexture)z?(A&&c.texStorage3D(a.TEXTURE_3D,C,x,o.width,o.height,o.depth),B&&c.texSubImage3D(a.TEXTURE_3D,0,0,0,0,o.width,o.height,o.depth,v,w,o.data)):c.texImage3D(a.TEXTURE_3D,0,x,o.width,o.height,o.depth,0,v,w,o.data);else if(g.isFramebufferTexture){if(A)if(z)c.texStorage2D(a.TEXTURE_2D,C,x,o.width,o.height);else{let b=o.width,d=o.height;for(let e=0;e<C;e++)c.texImage2D(a.TEXTURE_2D,e,x,b,d,0,v,w,null),b>>=1,d>>=1}}else if(y.length>0){if(z&&A){let b=Q(y[0]);c.texStorage2D(a.TEXTURE_2D,C,x,b.width,b.height)}for(let d=0,e=y.length;d<e;d++)b=y[d],z?B&&c.texSubImage2D(a.TEXTURE_2D,d,0,0,v,w,b):c.texImage2D(a.TEXTURE_2D,d,x,v,w,b);g.generateMipmaps=!1}else if(z){if(A){let b=Q(o);c.texStorage2D(a.TEXTURE_2D,C,x,b.width,b.height)}B&&c.texSubImage2D(a.TEXTURE_2D,0,0,0,v,w,o)}else c.texImage2D(a.TEXTURE_2D,0,x,v,w,o);q(g)&&r(i),l.__version=k.version,g.onUpdate&&g.onUpdate(g)}b.__version=g.version}function H(b,e,g,h,j,k){let l=f.convert(g.format,g.colorSpace),m=f.convert(g.type),n=s(g.internalFormat,l,m,g.colorSpace),o=d.get(e),p=d.get(g);if(p.__renderTarget=e,!o.__hasExternalTextures){let b=Math.max(1,e.width>>k),d=Math.max(1,e.height>>k);j===a.TEXTURE_3D||j===a.TEXTURE_2D_ARRAY?c.texImage3D(j,k,n,b,d,e.depth,0,l,m,null):c.texImage2D(j,k,n,b,d,0,l,m,null)}c.bindFramebuffer(a.FRAMEBUFFER,b),O(e)?i.framebufferTexture2DMultisampleEXT(a.FRAMEBUFFER,h,j,p.__webglTexture,0,N(e)):(j===a.TEXTURE_2D||j>=a.TEXTURE_CUBE_MAP_POSITIVE_X&&j<=a.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&a.framebufferTexture2D(a.FRAMEBUFFER,h,j,p.__webglTexture,k),c.bindFramebuffer(a.FRAMEBUFFER,null)}function I(b,c,d){if(a.bindRenderbuffer(a.RENDERBUFFER,b),c.depthBuffer){let e=c.depthTexture,f=e&&e.isDepthTexture?e.type:null,g=t(c.stencilBuffer,f),h=c.stencilBuffer?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT,j=N(c);O(c)?i.renderbufferStorageMultisampleEXT(a.RENDERBUFFER,j,g,c.width,c.height):d?a.renderbufferStorageMultisample(a.RENDERBUFFER,j,g,c.width,c.height):a.renderbufferStorage(a.RENDERBUFFER,g,c.width,c.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,h,a.RENDERBUFFER,b)}else{let b=c.textures;for(let e=0;e<b.length;e++){let g=b[e],h=f.convert(g.format,g.colorSpace),j=f.convert(g.type),k=s(g.internalFormat,h,j,g.colorSpace),l=N(c);d&&!1===O(c)?a.renderbufferStorageMultisample(a.RENDERBUFFER,l,k,c.width,c.height):O(c)?i.renderbufferStorageMultisampleEXT(a.RENDERBUFFER,l,k,c.width,c.height):a.renderbufferStorage(a.RENDERBUFFER,k,c.width,c.height)}}a.bindRenderbuffer(a.RENDERBUFFER,null)}function J(b,e){if(e&&e.isWebGLCubeRenderTarget)throw Error("Depth Texture with cube render targets is not supported");if(c.bindFramebuffer(a.FRAMEBUFFER,b),!(e.depthTexture&&e.depthTexture.isDepthTexture))throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");let f=d.get(e.depthTexture);f.__renderTarget=e,f.__webglTexture&&e.depthTexture.image.width===e.width&&e.depthTexture.image.height===e.height||(e.depthTexture.image.width=e.width,e.depthTexture.image.height=e.height,e.depthTexture.needsUpdate=!0),z(e.depthTexture,0);let g=f.__webglTexture,h=N(e);if(1026===e.depthTexture.format)O(e)?i.framebufferTexture2DMultisampleEXT(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,g,0,h):a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,g,0);else if(1027===e.depthTexture.format)O(e)?i.framebufferTexture2DMultisampleEXT(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,g,0,h):a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,g,0);else throw Error("Unknown depthTexture format")}function K(b){let e=d.get(b),f=!0===b.isWebGLCubeRenderTarget;if(e.__boundDepthTexture!==b.depthTexture){let a=b.depthTexture;if(e.__depthDisposeCallback&&e.__depthDisposeCallback(),a){let b=()=>{delete e.__boundDepthTexture,delete e.__depthDisposeCallback,a.removeEventListener("dispose",b)};a.addEventListener("dispose",b),e.__depthDisposeCallback=b}e.__boundDepthTexture=a}if(b.depthTexture&&!e.__autoAllocateDepthBuffer){if(f)throw Error("target.depthTexture not supported in Cube render targets");let a=b.texture.mipmaps;a&&a.length>0?J(e.__webglFramebuffer[0],b):J(e.__webglFramebuffer,b)}else if(f){e.__webglDepthbuffer=[];for(let d=0;d<6;d++)if(c.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer[d]),void 0===e.__webglDepthbuffer[d])e.__webglDepthbuffer[d]=a.createRenderbuffer(),I(e.__webglDepthbuffer[d],b,!1);else{let c=b.stencilBuffer?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT,f=e.__webglDepthbuffer[d];a.bindRenderbuffer(a.RENDERBUFFER,f),a.framebufferRenderbuffer(a.FRAMEBUFFER,c,a.RENDERBUFFER,f)}}else{let d=b.texture.mipmaps;if(d&&d.length>0?c.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer[0]):c.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer),void 0===e.__webglDepthbuffer)e.__webglDepthbuffer=a.createRenderbuffer(),I(e.__webglDepthbuffer,b,!1);else{let c=b.stencilBuffer?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT,d=e.__webglDepthbuffer;a.bindRenderbuffer(a.RENDERBUFFER,d),a.framebufferRenderbuffer(a.FRAMEBUFFER,c,a.RENDERBUFFER,d)}}c.bindFramebuffer(a.FRAMEBUFFER,null)}let L=[],M=[];function N(a){return Math.min(e.maxSamples,a.samples)}function O(a){let c=d.get(a);return a.samples>0&&!0===b.has("WEBGL_multisampled_render_to_texture")&&!1!==c.__useRenderToTexture}function P(a,b){let c=a.colorSpace,d=a.format,e=a.type;return!0===a.isCompressedTexture||!0===a.isVideoTexture||c!==IU&&""!==c&&(Jl.getTransfer(c)===IW?(1023!==d||1009!==e)&&I0("WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):I1("WebGLTextures: Unsupported texture color space:",c)),b}function Q(a){return"u">typeof HTMLImageElement&&a instanceof HTMLImageElement?(k.width=a.naturalWidth||a.width,k.height=a.naturalHeight||a.height):"u">typeof VideoFrame&&a instanceof VideoFrame?(k.width=a.displayWidth,k.height=a.displayHeight):(k.width=a.width,k.height=a.height),k}this.allocateTextureUnit=function(){let a=y;return a>=e.maxTextures&&I0("WebGLTextures: Trying to use "+a+" texture units while this GPU supports only "+e.maxTextures),y+=1,a},this.resetTextureUnits=function(){y=0},this.setTexture2D=z,this.setTexture2DArray=function(b,e){let f=d.get(b);!1===b.isRenderTargetTexture&&b.version>0&&f.__version!==b.version?G(f,b,e):(b.isExternalTexture&&(f.__webglTexture=b.sourceTexture?b.sourceTexture:null),c.bindTexture(a.TEXTURE_2D_ARRAY,f.__webglTexture,a.TEXTURE0+e))},this.setTexture3D=function(b,e){let f=d.get(b);!1===b.isRenderTargetTexture&&b.version>0&&f.__version!==b.version?G(f,b,e):c.bindTexture(a.TEXTURE_3D,f.__webglTexture,a.TEXTURE0+e)},this.setTextureCube=function(b,g){let h=d.get(b);b.version>0&&h.__version!==b.version?function(b,g,h){if(6!==g.image.length)return;let i=E(b,g),j=g.source;c.bindTexture(a.TEXTURE_CUBE_MAP,b.__webglTexture,a.TEXTURE0+h);let k=d.get(j);if(j.version!==k.__version||!0===i){let b;c.activeTexture(a.TEXTURE0+h);let d=Jl.getPrimaries(Jl.workingColorSpace),l=""===g.colorSpace?null:Jl.getPrimaries(g.colorSpace),m=""===g.colorSpace||d===l?a.NONE:a.BROWSER_DEFAULT_WEBGL;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,g.flipY),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,g.premultiplyAlpha),a.pixelStorei(a.UNPACK_ALIGNMENT,g.unpackAlignment),a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,m);let n=g.isCompressedTexture||g.image[0].isCompressedTexture,o=g.image[0]&&g.image[0].isDataTexture,t=[];for(let a=0;a<6;a++)n||o?t[a]=o?g.image[a].image:g.image[a]:t[a]=p(g.image[a],!0,e.maxCubemapSize),t[a]=P(g,t[a]);let v=t[0],w=f.convert(g.format,g.colorSpace),x=f.convert(g.type),y=s(g.internalFormat,w,x,g.colorSpace),z=!0!==g.isVideoTexture,A=void 0===k.__version||!0===i,B=j.dataReady,C=u(g,v);if(D(a.TEXTURE_CUBE_MAP,g),n){z&&A&&c.texStorage2D(a.TEXTURE_CUBE_MAP,C,y,v.width,v.height);for(let d=0;d<6;d++){b=t[d].mipmaps;for(let e=0;e<b.length;e++){let f=b[e];1023!==g.format?null!==w?z?B&&c.compressedTexSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+d,e,0,0,f.width,f.height,w,f.data):c.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+d,e,y,f.width,f.height,0,f.data):I0("WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):z?B&&c.texSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+d,e,0,0,f.width,f.height,w,x,f.data):c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+d,e,y,f.width,f.height,0,w,x,f.data)}}}else{if(b=g.mipmaps,z&&A){b.length>0&&C++;let d=Q(t[0]);c.texStorage2D(a.TEXTURE_CUBE_MAP,C,y,d.width,d.height)}for(let d=0;d<6;d++)if(o){z?B&&c.texSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,0,0,t[d].width,t[d].height,w,x,t[d].data):c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,y,t[d].width,t[d].height,0,w,x,t[d].data);for(let e=0;e<b.length;e++){let f=b[e].image[d].image;z?B&&c.texSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+d,e+1,0,0,f.width,f.height,w,x,f.data):c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+d,e+1,y,f.width,f.height,0,w,x,f.data)}}else{z?B&&c.texSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,0,0,w,x,t[d]):c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,y,w,x,t[d]);for(let e=0;e<b.length;e++){let f=b[e];z?B&&c.texSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+d,e+1,0,0,w,x,f.image[d]):c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+d,e+1,y,w,x,f.image[d])}}}q(g)&&r(a.TEXTURE_CUBE_MAP),k.__version=j.version,g.onUpdate&&g.onUpdate(g)}b.__version=g.version}(h,b,g):c.bindTexture(a.TEXTURE_CUBE_MAP,h.__webglTexture,a.TEXTURE0+g)},this.rebindTextures=function(b,c,e){let f=d.get(b);void 0!==c&&H(f.__webglFramebuffer,b,b.texture,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,0),void 0!==e&&K(b)},this.setupRenderTarget=function(b){let e=b.texture,h=d.get(b),i=d.get(e);b.addEventListener("dispose",w);let j=b.textures,k=!0===b.isWebGLCubeRenderTarget,l=j.length>1;if(l||(void 0===i.__webglTexture&&(i.__webglTexture=a.createTexture()),i.__version=e.version,g.memory.textures++),k){h.__webglFramebuffer=[];for(let b=0;b<6;b++)if(e.mipmaps&&e.mipmaps.length>0){h.__webglFramebuffer[b]=[];for(let c=0;c<e.mipmaps.length;c++)h.__webglFramebuffer[b][c]=a.createFramebuffer()}else h.__webglFramebuffer[b]=a.createFramebuffer()}else{if(e.mipmaps&&e.mipmaps.length>0){h.__webglFramebuffer=[];for(let b=0;b<e.mipmaps.length;b++)h.__webglFramebuffer[b]=a.createFramebuffer()}else h.__webglFramebuffer=a.createFramebuffer();if(l)for(let b=0,c=j.length;b<c;b++){let c=d.get(j[b]);void 0===c.__webglTexture&&(c.__webglTexture=a.createTexture(),g.memory.textures++)}if(b.samples>0&&!1===O(b)){h.__webglMultisampledFramebuffer=a.createFramebuffer(),h.__webglColorRenderbuffer=[],c.bindFramebuffer(a.FRAMEBUFFER,h.__webglMultisampledFramebuffer);for(let c=0;c<j.length;c++){let d=j[c];h.__webglColorRenderbuffer[c]=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,h.__webglColorRenderbuffer[c]);let e=f.convert(d.format,d.colorSpace),g=f.convert(d.type),i=s(d.internalFormat,e,g,d.colorSpace,!0===b.isXRRenderTarget),k=N(b);a.renderbufferStorageMultisample(a.RENDERBUFFER,k,i,b.width,b.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0+c,a.RENDERBUFFER,h.__webglColorRenderbuffer[c])}a.bindRenderbuffer(a.RENDERBUFFER,null),b.depthBuffer&&(h.__webglDepthRenderbuffer=a.createRenderbuffer(),I(h.__webglDepthRenderbuffer,b,!0)),c.bindFramebuffer(a.FRAMEBUFFER,null)}}if(k){c.bindTexture(a.TEXTURE_CUBE_MAP,i.__webglTexture),D(a.TEXTURE_CUBE_MAP,e);for(let c=0;c<6;c++)if(e.mipmaps&&e.mipmaps.length>0)for(let d=0;d<e.mipmaps.length;d++)H(h.__webglFramebuffer[c][d],b,e,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+c,d);else H(h.__webglFramebuffer[c],b,e,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+c,0);q(e)&&r(a.TEXTURE_CUBE_MAP),c.unbindTexture()}else if(l){for(let e=0,f=j.length;e<f;e++){let f=j[e],g=d.get(f),i=a.TEXTURE_2D;(b.isWebGL3DRenderTarget||b.isWebGLArrayRenderTarget)&&(i=b.isWebGL3DRenderTarget?a.TEXTURE_3D:a.TEXTURE_2D_ARRAY),c.bindTexture(i,g.__webglTexture),D(i,f),H(h.__webglFramebuffer,b,f,a.COLOR_ATTACHMENT0+e,i,0),q(f)&&r(i)}c.unbindTexture()}else{let d=a.TEXTURE_2D;if((b.isWebGL3DRenderTarget||b.isWebGLArrayRenderTarget)&&(d=b.isWebGL3DRenderTarget?a.TEXTURE_3D:a.TEXTURE_2D_ARRAY),c.bindTexture(d,i.__webglTexture),D(d,e),e.mipmaps&&e.mipmaps.length>0)for(let c=0;c<e.mipmaps.length;c++)H(h.__webglFramebuffer[c],b,e,a.COLOR_ATTACHMENT0,d,c);else H(h.__webglFramebuffer,b,e,a.COLOR_ATTACHMENT0,d,0);q(e)&&r(d),c.unbindTexture()}b.depthBuffer&&K(b)},this.updateRenderTargetMipmap=function(b){let e=b.textures;for(let f=0,g=e.length;f<g;f++){let g=e[f];if(q(g)){let e=b.isWebGLCubeRenderTarget?a.TEXTURE_CUBE_MAP:b.isWebGL3DRenderTarget?a.TEXTURE_3D:b.isWebGLArrayRenderTarget||b.isCompressedArrayTexture?a.TEXTURE_2D_ARRAY:a.TEXTURE_2D,f=d.get(g).__webglTexture;c.bindTexture(e,f),r(e),c.unbindTexture()}}},this.updateMultisampleRenderTarget=function(b){if(b.samples>0){if(!1===O(b)){let e=b.textures,f=b.width,g=b.height,h=a.COLOR_BUFFER_BIT,i=b.stencilBuffer?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT,k=d.get(b),l=e.length>1;if(l)for(let b=0;b<e.length;b++)c.bindFramebuffer(a.FRAMEBUFFER,k.__webglMultisampledFramebuffer),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0+b,a.RENDERBUFFER,null),c.bindFramebuffer(a.FRAMEBUFFER,k.__webglFramebuffer),a.framebufferTexture2D(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0+b,a.TEXTURE_2D,null,0);c.bindFramebuffer(a.READ_FRAMEBUFFER,k.__webglMultisampledFramebuffer);let m=b.texture.mipmaps;m&&m.length>0?c.bindFramebuffer(a.DRAW_FRAMEBUFFER,k.__webglFramebuffer[0]):c.bindFramebuffer(a.DRAW_FRAMEBUFFER,k.__webglFramebuffer);for(let c=0;c<e.length;c++){if(b.resolveDepthBuffer&&(b.depthBuffer&&(h|=a.DEPTH_BUFFER_BIT),b.stencilBuffer&&b.resolveStencilBuffer&&(h|=a.STENCIL_BUFFER_BIT)),l){a.framebufferRenderbuffer(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.RENDERBUFFER,k.__webglColorRenderbuffer[c]);let b=d.get(e[c]).__webglTexture;a.framebufferTexture2D(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,b,0)}a.blitFramebuffer(0,0,f,g,0,0,f,g,h,a.NEAREST),!0===j&&(L.length=0,M.length=0,L.push(a.COLOR_ATTACHMENT0+c),b.depthBuffer&&!1===b.resolveDepthBuffer&&(L.push(i),M.push(i),a.invalidateFramebuffer(a.DRAW_FRAMEBUFFER,M)),a.invalidateFramebuffer(a.READ_FRAMEBUFFER,L))}if(c.bindFramebuffer(a.READ_FRAMEBUFFER,null),c.bindFramebuffer(a.DRAW_FRAMEBUFFER,null),l)for(let b=0;b<e.length;b++){c.bindFramebuffer(a.FRAMEBUFFER,k.__webglMultisampledFramebuffer),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0+b,a.RENDERBUFFER,k.__webglColorRenderbuffer[b]);let f=d.get(e[b]).__webglTexture;c.bindFramebuffer(a.FRAMEBUFFER,k.__webglFramebuffer),a.framebufferTexture2D(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0+b,a.TEXTURE_2D,f,0)}c.bindFramebuffer(a.DRAW_FRAMEBUFFER,k.__webglMultisampledFramebuffer)}else if(b.depthBuffer&&!1===b.resolveDepthBuffer&&j){let c=b.stencilBuffer?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT;a.invalidateFramebuffer(a.DRAW_FRAMEBUFFER,[c])}}},this.setupDepthRenderbuffer=K,this.setupFrameBufferTexture=H,this.useMultisampledRTT=O}function NV(a,b){return{convert:function(c,d=""){let e,f=Jl.getTransfer(d);if(1009===c)return a.UNSIGNED_BYTE;if(1017===c)return a.UNSIGNED_SHORT_4_4_4_4;if(1018===c)return a.UNSIGNED_SHORT_5_5_5_1;if(35902===c)return a.UNSIGNED_INT_5_9_9_9_REV;if(35899===c)return a.UNSIGNED_INT_10F_11F_11F_REV;if(1010===c)return a.BYTE;if(1011===c)return a.SHORT;if(1012===c)return a.UNSIGNED_SHORT;if(1013===c)return a.INT;if(1014===c)return a.UNSIGNED_INT;if(1015===c)return a.FLOAT;if(1016===c)return a.HALF_FLOAT;if(1021===c)return a.ALPHA;if(1022===c)return a.RGB;if(1023===c)return a.RGBA;if(1026===c)return a.DEPTH_COMPONENT;if(1027===c)return a.DEPTH_STENCIL;if(1028===c)return a.RED;if(1029===c)return a.RED_INTEGER;if(1030===c)return a.RG;if(1031===c)return a.RG_INTEGER;if(1033===c)return a.RGBA_INTEGER;if(33776===c||33777===c||33778===c||33779===c)if(f===IW)if(null===(e=b.get("WEBGL_compressed_texture_s3tc_srgb")))return null;else{if(33776===c)return e.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(33777===c)return e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(33778===c)return e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(33779===c)return e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(e=b.get("WEBGL_compressed_texture_s3tc")))return null;if(33776===c)return e.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===c)return e.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===c)return e.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===c)return e.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===c||35841===c||35842===c||35843===c)if(null===(e=b.get("WEBGL_compressed_texture_pvrtc")))return null;else{if(35840===c)return e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===c)return e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===c)return e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===c)return e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===c||37492===c||37496===c)if(null===(e=b.get("WEBGL_compressed_texture_etc")))return null;else{if(36196===c||37492===c)return f===IW?e.COMPRESSED_SRGB8_ETC2:e.COMPRESSED_RGB8_ETC2;if(37496===c)return f===IW?e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:e.COMPRESSED_RGBA8_ETC2_EAC}if(37808===c||37809===c||37810===c||37811===c||37812===c||37813===c||37814===c||37815===c||37816===c||37817===c||37818===c||37819===c||37820===c||37821===c)if(null===(e=b.get("WEBGL_compressed_texture_astc")))return null;else{if(37808===c)return f===IW?e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:e.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===c)return f===IW?e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:e.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===c)return f===IW?e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:e.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===c)return f===IW?e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:e.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===c)return f===IW?e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:e.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===c)return f===IW?e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:e.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===c)return f===IW?e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:e.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===c)return f===IW?e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:e.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===c)return f===IW?e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:e.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===c)return f===IW?e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:e.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===c)return f===IW?e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:e.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===c)return f===IW?e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:e.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===c)return f===IW?e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:e.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===c)return f===IW?e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:e.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===c||36494===c||36495===c)if(null===(e=b.get("EXT_texture_compression_bptc")))return null;else{if(36492===c)return f===IW?e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:e.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(36494===c)return e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(36495===c)return e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===c||36284===c||36285===c||36286===c)if(null===(e=b.get("EXT_texture_compression_rgtc")))return null;else{if(36283===c)return e.COMPRESSED_RED_RGTC1_EXT;if(36284===c)return e.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===c)return e.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===c)return e.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return 1020===c?a.UNSIGNED_INT_24_8:void 0!==a[c]?a[c]:null}}}let NW=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,NX=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class NY{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(a,b){if(null===this.texture){let c=new LJ(a.texture);(a.depthNear!==b.depthNear||a.depthFar!==b.depthFar)&&(this.depthNear=a.depthNear,this.depthFar=a.depthFar),this.texture=c}}getMesh(a){if(null!==this.texture&&null===this.mesh){let b=a.cameras[0].viewport,c=new Li({vertexShader:NW,fragmentShader:NX,uniforms:{depthColor:{value:this.texture},depthWidth:{value:b.z},depthHeight:{value:b.w}}});this.mesh=new La(new LK(20,20),c)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class NZ extends I3{constructor(a,b){super();const c=this;let d=null,e=1,f=null,g="local-floor",h=1,i=null,j=null,k=null,l=null,m=null,n=null;const o="u">typeof XRWebGLBinding,p=new NY,q={},r=b.getContextAttributes();let s=null,t=null;const u=[],v=[],w=new Jc;let x=null;const y=new Ln;y.viewport=new Jv;const z=new Ln;z.viewport=new Jv;const A=[y,z],B=new LO;let C=null,D=null;function E(a){let b=v.indexOf(a.inputSource);if(-1===b)return;let c=u[b];void 0!==c&&(c.update(a.inputSource,a.frame,i||f),c.dispatchEvent({type:a.type,data:a.inputSource}))}function F(){d.removeEventListener("select",E),d.removeEventListener("selectstart",E),d.removeEventListener("selectend",E),d.removeEventListener("squeeze",E),d.removeEventListener("squeezestart",E),d.removeEventListener("squeezeend",E),d.removeEventListener("end",F),d.removeEventListener("inputsourceschange",G);for(let a=0;a<u.length;a++){let b=v[a];null!==b&&(v[a]=null,u[a].disconnect(b))}for(let a in C=null,D=null,p.reset(),q)delete q[a];a.setRenderTarget(s),m=null,l=null,k=null,d=null,t=null,L.stop(),c.isPresenting=!1,a.setPixelRatio(x),a.setSize(w.width,w.height,!1),c.dispatchEvent({type:"sessionend"})}function G(a){for(let b=0;b<a.removed.length;b++){let c=a.removed[b],d=v.indexOf(c);d>=0&&(v[d]=null,u[d].disconnect(c))}for(let b=0;b<a.added.length;b++){let c=a.added[b],d=v.indexOf(c);if(-1===d){for(let a=0;a<u.length;a++)if(a>=v.length){v.push(c),d=a;break}else if(null===v[a]){v[a]=c,d=a;break}if(-1===d)break}let e=u[d];e&&e.connect(c)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(a){let b=u[a];return void 0===b&&(b=new Lt,u[a]=b),b.getTargetRaySpace()},this.getControllerGrip=function(a){let b=u[a];return void 0===b&&(b=new Lt,u[a]=b),b.getGripSpace()},this.getHand=function(a){let b=u[a];return void 0===b&&(b=new Lt,u[a]=b),b.getHandSpace()},this.setFramebufferScaleFactor=function(a){e=a,!0===c.isPresenting&&I0("WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(a){g=a,!0===c.isPresenting&&I0("WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return i||f},this.setReferenceSpace=function(a){i=a},this.getBaseLayer=function(){return null!==l?l:m},this.getBinding=function(){return null===k&&o&&(k=new XRWebGLBinding(d,b)),k},this.getFrame=function(){return n},this.getSession=function(){return d},this.setSession=async function(j){if(null!==(d=j)){if(s=a.getRenderTarget(),d.addEventListener("select",E),d.addEventListener("selectstart",E),d.addEventListener("selectend",E),d.addEventListener("squeeze",E),d.addEventListener("squeezestart",E),d.addEventListener("squeezeend",E),d.addEventListener("end",F),d.addEventListener("inputsourceschange",G),!0!==r.xrCompatible&&await b.makeXRCompatible(),x=a.getPixelRatio(),a.getSize(w),o&&"createProjectionLayer"in XRWebGLBinding.prototype){let c=null,f=null,g=null;r.depth&&(g=r.stencil?b.DEPTH24_STENCIL8:b.DEPTH_COMPONENT24,c=r.stencil?1027:1026,f=r.stencil?1020:1014);let h={colorFormat:b.RGBA8,depthFormat:g,scaleFactor:e};l=(k=this.getBinding()).createProjectionLayer(h),d.updateRenderState({layers:[l]}),a.setPixelRatio(1),a.setSize(l.textureWidth,l.textureHeight,!1),t=new Jx(l.textureWidth,l.textureHeight,{format:1023,type:1009,depthTexture:new LI(l.textureWidth,l.textureHeight,f,void 0,void 0,void 0,void 0,void 0,void 0,c),stencilBuffer:r.stencil,colorSpace:a.outputColorSpace,samples:4*!!r.antialias,resolveDepthBuffer:!1===l.ignoreDepthValues,resolveStencilBuffer:!1===l.ignoreDepthValues})}else{let c={antialias:r.antialias,alpha:!0,depth:r.depth,stencil:r.stencil,framebufferScaleFactor:e};m=new XRWebGLLayer(d,b,c),d.updateRenderState({baseLayer:m}),a.setPixelRatio(1),a.setSize(m.framebufferWidth,m.framebufferHeight,!1),t=new Jx(m.framebufferWidth,m.framebufferHeight,{format:1023,type:1009,colorSpace:a.outputColorSpace,stencilBuffer:r.stencil,resolveDepthBuffer:!1===m.ignoreDepthValues,resolveStencilBuffer:!1===m.ignoreDepthValues})}t.isXRRenderTarget=!0,this.setFoveation(h),i=null,f=await d.requestReferenceSpace(g),L.setContext(d),L.start(),c.isPresenting=!0,c.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==d)return d.environmentBlendMode},this.getDepthTexture=function(){return p.getDepthTexture()};const H=new Je,I=new Je;function J(a,b){null===b?a.matrixWorld.copy(a.matrix):a.matrixWorld.multiplyMatrices(b.matrixWorld,a.matrix),a.matrixWorldInverse.copy(a.matrixWorld).invert()}this.updateCamera=function(a){var b,c,e;if(null===d)return;let f=a.near,g=a.far;null!==p.texture&&(p.depthNear>0&&(f=p.depthNear),p.depthFar>0&&(g=p.depthFar)),B.near=z.near=y.near=f,B.far=z.far=y.far=g,(C!==B.near||D!==B.far)&&(d.updateRenderState({depthNear:B.near,depthFar:B.far}),C=B.near,D=B.far),B.layers.mask=6|a.layers.mask,y.layers.mask=3&B.layers.mask,z.layers.mask=5&B.layers.mask;let h=a.parent,i=B.cameras;J(B,h);for(let a=0;a<i.length;a++)J(i[a],h);2===i.length?function(a,b,c){H.setFromMatrixPosition(b.matrixWorld),I.setFromMatrixPosition(c.matrixWorld);let d=H.distanceTo(I),e=b.projectionMatrix.elements,f=c.projectionMatrix.elements,g=e[14]/(e[10]-1),h=e[14]/(e[10]+1),i=(e[9]+1)/e[5],j=(e[9]-1)/e[5],k=(e[8]-1)/e[0],l=(f[8]+1)/f[0],m=d/(-k+l),n=-(m*k);if(b.matrixWorld.decompose(a.position,a.quaternion,a.scale),a.translateX(n),a.translateZ(m),a.matrixWorld.compose(a.position,a.quaternion,a.scale),a.matrixWorldInverse.copy(a.matrixWorld).invert(),-1===e[10])a.projectionMatrix.copy(b.projectionMatrix),a.projectionMatrixInverse.copy(b.projectionMatrixInverse);else{let b=g+m,c=h+m;a.projectionMatrix.makePerspective(g*k-n,g*l+(d-n),i*h/c*b,j*h/c*b,b,c),a.projectionMatrixInverse.copy(a.projectionMatrix).invert()}}(B,y,z):B.projectionMatrix.copy(y.projectionMatrix),b=a,c=B,null===(e=h)?b.matrix.copy(c.matrixWorld):(b.matrix.copy(e.matrixWorld),b.matrix.invert(),b.matrix.multiply(c.matrixWorld)),b.matrix.decompose(b.position,b.quaternion,b.scale),b.updateMatrixWorld(!0),b.projectionMatrix.copy(c.projectionMatrix),b.projectionMatrixInverse.copy(c.projectionMatrixInverse),b.isPerspectiveCamera&&(b.fov=2*I6*Math.atan(1/b.projectionMatrix.elements[5]),b.zoom=1)},this.getCamera=function(){return B},this.getFoveation=function(){if(null!==l||null!==m)return h},this.setFoveation=function(a){h=a,null!==l&&(l.fixedFoveation=a),null!==m&&void 0!==m.fixedFoveation&&(m.fixedFoveation=a)},this.hasDepthSensing=function(){return null!==p.texture},this.getDepthSensingMesh=function(){return p.getMesh(B)},this.getCameraTexture=function(a){return q[a]};let K=null;const L=new LS;L.setAnimationLoop(function(b,e){if(j=e.getViewerPose(i||f),n=e,null!==j){let b=j.views;null!==m&&(a.setRenderTargetFramebuffer(t,m.framebuffer),a.setRenderTarget(t));let e=!1;b.length!==B.cameras.length&&(B.cameras.length=0,e=!0);for(let c=0;c<b.length;c++){let d=b[c],f=null;if(null!==m)f=m.getViewport(d);else{let b=k.getViewSubImage(l,d);f=b.viewport,0===c&&(a.setRenderTargetTextures(t,b.colorTexture,b.depthStencilTexture),a.setRenderTarget(t))}let g=A[c];void 0===g&&((g=new Ln).layers.enable(c),g.viewport=new Jv,A[c]=g),g.matrix.fromArray(d.transform.matrix),g.matrix.decompose(g.position,g.quaternion,g.scale),g.projectionMatrix.fromArray(d.projectionMatrix),g.projectionMatrixInverse.copy(g.projectionMatrix).invert(),g.viewport.set(f.x,f.y,f.width,f.height),0===c&&(B.matrix.copy(g.matrix),B.matrix.decompose(B.position,B.quaternion,B.scale)),!0===e&&B.cameras.push(g)}let f=d.enabledFeatures;if(f&&f.includes("depth-sensing")&&"gpu-optimized"==d.depthUsage&&o){let a=(k=c.getBinding()).getDepthInformation(b[0]);a&&a.isValid&&a.texture&&p.init(a,d.renderState)}if(f&&f.includes("camera-access")&&o){a.state.unbindTexture(),k=c.getBinding();for(let a=0;a<b.length;a++){let c=b[a].camera;if(c){let a=q[c];a||(a=new LJ,q[c]=a);let b=k.getCameraImage(c);a.sourceTexture=b}}}}for(let a=0;a<u.length;a++){let b=v[a],c=u[a];null!==b&&void 0!==c&&c.update(b,e,i||f)}K&&K(b,e),e.detectedPlanes&&c.dispatchEvent({type:"planesdetected",data:e}),n=null}),this.setAnimationLoop=function(a){K=a},this.dispose=function(){}}}let N$=new J7,N_=new JZ;function N0(a,b){function c(a,b){!0===a.matrixAutoUpdate&&a.updateMatrix(),b.value.copy(a.matrix)}function d(a,d){a.opacity.value=d.opacity,d.color&&a.diffuse.value.copy(d.color),d.emissive&&a.emissive.value.copy(d.emissive).multiplyScalar(d.emissiveIntensity),d.map&&(a.map.value=d.map,c(d.map,a.mapTransform)),d.alphaMap&&(a.alphaMap.value=d.alphaMap,c(d.alphaMap,a.alphaMapTransform)),d.bumpMap&&(a.bumpMap.value=d.bumpMap,c(d.bumpMap,a.bumpMapTransform),a.bumpScale.value=d.bumpScale,1===d.side&&(a.bumpScale.value*=-1)),d.normalMap&&(a.normalMap.value=d.normalMap,c(d.normalMap,a.normalMapTransform),a.normalScale.value.copy(d.normalScale),1===d.side&&a.normalScale.value.negate()),d.displacementMap&&(a.displacementMap.value=d.displacementMap,c(d.displacementMap,a.displacementMapTransform),a.displacementScale.value=d.displacementScale,a.displacementBias.value=d.displacementBias),d.emissiveMap&&(a.emissiveMap.value=d.emissiveMap,c(d.emissiveMap,a.emissiveMapTransform)),d.specularMap&&(a.specularMap.value=d.specularMap,c(d.specularMap,a.specularMapTransform)),d.alphaTest>0&&(a.alphaTest.value=d.alphaTest);let e=b.get(d),f=e.envMap,g=e.envMapRotation;f&&(a.envMap.value=f,N$.copy(g),N$.x*=-1,N$.y*=-1,N$.z*=-1,f.isCubeTexture&&!1===f.isRenderTargetTexture&&(N$.y*=-1,N$.z*=-1),a.envMapRotation.value.setFromMatrix4(N_.makeRotationFromEuler(N$)),a.flipEnvMap.value=f.isCubeTexture&&!1===f.isRenderTargetTexture?-1:1,a.reflectivity.value=d.reflectivity,a.ior.value=d.ior,a.refractionRatio.value=d.refractionRatio),d.lightMap&&(a.lightMap.value=d.lightMap,a.lightMapIntensity.value=d.lightMapIntensity,c(d.lightMap,a.lightMapTransform)),d.aoMap&&(a.aoMap.value=d.aoMap,a.aoMapIntensity.value=d.aoMapIntensity,c(d.aoMap,a.aoMapTransform))}return{refreshFogUniforms:function(b,c){c.color.getRGB(b.fogColor.value,Lf(a)),c.isFog?(b.fogNear.value=c.near,b.fogFar.value=c.far):c.isFogExp2&&(b.fogDensity.value=c.density)},refreshMaterialUniforms:function(a,e,f,g,h){var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E;let F;e.isMeshBasicMaterial||e.isMeshLambertMaterial?d(a,e):e.isMeshToonMaterial?(d(a,e),i=a,(j=e).gradientMap&&(i.gradientMap.value=j.gradientMap)):e.isMeshPhongMaterial?(d(a,e),k=a,l=e,k.specular.value.copy(l.specular),k.shininess.value=Math.max(l.shininess,1e-4)):e.isMeshStandardMaterial?(d(a,e),m=a,n=e,m.metalness.value=n.metalness,n.metalnessMap&&(m.metalnessMap.value=n.metalnessMap,c(n.metalnessMap,m.metalnessMapTransform)),m.roughness.value=n.roughness,n.roughnessMap&&(m.roughnessMap.value=n.roughnessMap,c(n.roughnessMap,m.roughnessMapTransform)),n.envMap&&(m.envMapIntensity.value=n.envMapIntensity),e.isMeshPhysicalMaterial&&(o=a,p=e,q=h,o.ior.value=p.ior,p.sheen>0&&(o.sheenColor.value.copy(p.sheenColor).multiplyScalar(p.sheen),o.sheenRoughness.value=p.sheenRoughness,p.sheenColorMap&&(o.sheenColorMap.value=p.sheenColorMap,c(p.sheenColorMap,o.sheenColorMapTransform)),p.sheenRoughnessMap&&(o.sheenRoughnessMap.value=p.sheenRoughnessMap,c(p.sheenRoughnessMap,o.sheenRoughnessMapTransform))),p.clearcoat>0&&(o.clearcoat.value=p.clearcoat,o.clearcoatRoughness.value=p.clearcoatRoughness,p.clearcoatMap&&(o.clearcoatMap.value=p.clearcoatMap,c(p.clearcoatMap,o.clearcoatMapTransform)),p.clearcoatRoughnessMap&&(o.clearcoatRoughnessMap.value=p.clearcoatRoughnessMap,c(p.clearcoatRoughnessMap,o.clearcoatRoughnessMapTransform)),p.clearcoatNormalMap&&(o.clearcoatNormalMap.value=p.clearcoatNormalMap,c(p.clearcoatNormalMap,o.clearcoatNormalMapTransform),o.clearcoatNormalScale.value.copy(p.clearcoatNormalScale),1===p.side&&o.clearcoatNormalScale.value.negate())),p.dispersion>0&&(o.dispersion.value=p.dispersion),p.iridescence>0&&(o.iridescence.value=p.iridescence,o.iridescenceIOR.value=p.iridescenceIOR,o.iridescenceThicknessMinimum.value=p.iridescenceThicknessRange[0],o.iridescenceThicknessMaximum.value=p.iridescenceThicknessRange[1],p.iridescenceMap&&(o.iridescenceMap.value=p.iridescenceMap,c(p.iridescenceMap,o.iridescenceMapTransform)),p.iridescenceThicknessMap&&(o.iridescenceThicknessMap.value=p.iridescenceThicknessMap,c(p.iridescenceThicknessMap,o.iridescenceThicknessMapTransform))),p.transmission>0&&(o.transmission.value=p.transmission,o.transmissionSamplerMap.value=q.texture,o.transmissionSamplerSize.value.set(q.width,q.height),p.transmissionMap&&(o.transmissionMap.value=p.transmissionMap,c(p.transmissionMap,o.transmissionMapTransform)),o.thickness.value=p.thickness,p.thicknessMap&&(o.thicknessMap.value=p.thicknessMap,c(p.thicknessMap,o.thicknessMapTransform)),o.attenuationDistance.value=p.attenuationDistance,o.attenuationColor.value.copy(p.attenuationColor)),p.anisotropy>0&&(o.anisotropyVector.value.set(p.anisotropy*Math.cos(p.anisotropyRotation),p.anisotropy*Math.sin(p.anisotropyRotation)),p.anisotropyMap&&(o.anisotropyMap.value=p.anisotropyMap,c(p.anisotropyMap,o.anisotropyMapTransform))),o.specularIntensity.value=p.specularIntensity,o.specularColor.value.copy(p.specularColor),p.specularColorMap&&(o.specularColorMap.value=p.specularColorMap,c(p.specularColorMap,o.specularColorMapTransform)),p.specularIntensityMap&&(o.specularIntensityMap.value=p.specularIntensityMap,c(p.specularIntensityMap,o.specularIntensityMapTransform)))):e.isMeshMatcapMaterial?(d(a,e),r=a,(s=e).matcap&&(r.matcap.value=s.matcap)):e.isMeshDepthMaterial?d(a,e):e.isMeshDistanceMaterial?(d(a,e),t=a,u=e,F=b.get(u).light,t.referencePosition.value.setFromMatrixPosition(F.matrixWorld),t.nearDistance.value=F.shadow.camera.near,t.farDistance.value=F.shadow.camera.far):e.isMeshNormalMaterial?d(a,e):e.isLineBasicMaterial?(v=a,w=e,v.diffuse.value.copy(w.color),v.opacity.value=w.opacity,w.map&&(v.map.value=w.map,c(w.map,v.mapTransform)),e.isLineDashedMaterial&&(x=a,y=e,x.dashSize.value=y.dashSize,x.totalSize.value=y.dashSize+y.gapSize,x.scale.value=y.scale)):e.isPointsMaterial?(z=a,A=e,B=f,C=g,z.diffuse.value.copy(A.color),z.opacity.value=A.opacity,z.size.value=A.size*B,z.scale.value=.5*C,A.map&&(z.map.value=A.map,c(A.map,z.uvTransform)),A.alphaMap&&(z.alphaMap.value=A.alphaMap,c(A.alphaMap,z.alphaMapTransform)),A.alphaTest>0&&(z.alphaTest.value=A.alphaTest)):e.isSpriteMaterial?(D=a,E=e,D.diffuse.value.copy(E.color),D.opacity.value=E.opacity,D.rotation.value=E.rotation,E.map&&(D.map.value=E.map,c(E.map,D.mapTransform)),E.alphaMap&&(D.alphaMap.value=E.alphaMap,c(E.alphaMap,D.alphaMapTransform)),E.alphaTest>0&&(D.alphaTest.value=E.alphaTest)):e.isShadowMaterial?(a.color.value.copy(e.color),a.opacity.value=e.opacity):e.isShaderMaterial&&(e.uniformsNeedUpdate=!1)}}}function N1(a,b,c,d){let e={},f={},g=[],h=a.getParameter(a.MAX_UNIFORM_BUFFER_BINDINGS);function i(a){let b={boundary:0,storage:0};return"number"==typeof a||"boolean"==typeof a?(b.boundary=4,b.storage=4):a.isVector2?(b.boundary=8,b.storage=8):a.isVector3||a.isColor?(b.boundary=16,b.storage=12):a.isVector4?(b.boundary=16,b.storage=16):a.isMatrix3?(b.boundary=48,b.storage=48):a.isMatrix4?(b.boundary=64,b.storage=64):a.isTexture?I0("WebGLRenderer: Texture samplers can not be part of an uniforms group."):I0("WebGLRenderer: Unsupported uniform value type.",a),b}function j(b){let c=b.target;c.removeEventListener("dispose",j);let d=g.indexOf(c.__bindingPointIndex);g.splice(d,1),a.deleteBuffer(e[c.id]),delete e[c.id],delete f[c.id]}return{bind:function(a,b){let c=b.program;d.uniformBlockBinding(a,c)},update:function(c,k){var l;let m,n,o,p,q=e[c.id];void 0===q&&(function(a){let b=a.uniforms,c=0;for(let a=0,d=b.length;a<d;a++){let d=Array.isArray(b[a])?b[a]:[b[a]];for(let a=0,b=d.length;a<b;a++){let b=d[a],e=Array.isArray(b.value)?b.value:[b.value];for(let a=0,d=e.length;a<d;a++){let d=i(e[a]),f=c%16,g=f%d.boundary,h=f+g;c+=g,0!==h&&16-h<d.storage&&(c+=16-h),b.__data=new Float32Array(d.storage/Float32Array.BYTES_PER_ELEMENT),b.__offset=c,c+=d.storage}}}let d=c%16;d>0&&(c+=16-d),a.__size=c,a.__cache={}}(c),(l=c).__bindingPointIndex=m=function(){for(let a=0;a<h;a++)if(-1===g.indexOf(a))return g.push(a),a;return I1("WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}(),n=a.createBuffer(),o=l.__size,p=l.usage,a.bindBuffer(a.UNIFORM_BUFFER,n),a.bufferData(a.UNIFORM_BUFFER,o,p),a.bindBuffer(a.UNIFORM_BUFFER,null),a.bindBufferBase(a.UNIFORM_BUFFER,m,n),q=n,e[c.id]=q,c.addEventListener("dispose",j));let r=k.program;d.updateUBOMapping(c,r);let s=b.render.frame;f[c.id]!==s&&(function(b){let c=e[b.id],d=b.uniforms,f=b.__cache;a.bindBuffer(a.UNIFORM_BUFFER,c);for(let b=0,c=d.length;b<c;b++){let c=Array.isArray(d[b])?d[b]:[d[b]];for(let d=0,e=c.length;d<e;d++){let e=c[d];if(!0===function(a,b,c,d){let e=a.value,f=b+"_"+c;if(void 0===d[f])return"number"==typeof e||"boolean"==typeof e?d[f]=e:d[f]=e.clone(),!0;{let a=d[f];if("number"==typeof e||"boolean"==typeof e){if(a!==e)return d[f]=e,!0}else if(!1===a.equals(e))return a.copy(e),!0}return!1}(e,b,d,f)){let b=e.__offset,c=Array.isArray(e.value)?e.value:[e.value],d=0;for(let f=0;f<c.length;f++){let g=c[f],h=i(g);"number"==typeof g||"boolean"==typeof g?(e.__data[0]=g,a.bufferSubData(a.UNIFORM_BUFFER,b+d,e.__data)):g.isMatrix3?(e.__data[0]=g.elements[0],e.__data[1]=g.elements[1],e.__data[2]=g.elements[2],e.__data[3]=0,e.__data[4]=g.elements[3],e.__data[5]=g.elements[4],e.__data[6]=g.elements[5],e.__data[7]=0,e.__data[8]=g.elements[6],e.__data[9]=g.elements[7],e.__data[10]=g.elements[8],e.__data[11]=0):(g.toArray(e.__data,d),d+=h.storage/Float32Array.BYTES_PER_ELEMENT)}a.bufferSubData(a.UNIFORM_BUFFER,b,e.__data)}}}a.bindBuffer(a.UNIFORM_BUFFER,null)}(c),f[c.id]=s)},dispose:function(){for(let b in e)a.deleteBuffer(e[b]);g=[],e={},f={}}}}let N2=new Uint16Array([11481,15204,11534,15171,11808,15015,12385,14843,12894,14716,13396,14600,13693,14483,13976,14366,14237,14171,14405,13961,14511,13770,14605,13598,14687,13444,14760,13305,14822,13066,14876,12857,14923,12675,14963,12517,14997,12379,15025,12230,15049,12023,15070,11843,15086,11687,15100,11551,15111,11433,15120,11330,15127,11217,15132,11060,15135,10922,15138,10801,15139,10695,15139,10600,13012,14923,13020,14917,13064,14886,13176,14800,13349,14666,13513,14526,13724,14398,13960,14230,14200,14020,14383,13827,14488,13651,14583,13491,14667,13348,14740,13132,14803,12908,14856,12713,14901,12542,14938,12394,14968,12241,14992,12017,15010,11822,15024,11654,15034,11507,15041,11380,15044,11269,15044,11081,15042,10913,15037,10764,15031,10635,15023,10520,15014,10419,15003,10330,13657,14676,13658,14673,13670,14660,13698,14622,13750,14547,13834,14442,13956,14317,14112,14093,14291,13889,14407,13704,14499,13538,14586,13389,14664,13201,14733,12966,14792,12758,14842,12577,14882,12418,14915,12272,14940,12033,14959,11826,14972,11646,14980,11490,14983,11355,14983,11212,14979,11008,14971,10830,14961,10675,14950,10540,14936,10420,14923,10315,14909,10204,14894,10041,14089,14460,14090,14459,14096,14452,14112,14431,14141,14388,14186,14305,14252,14130,14341,13941,14399,13756,14467,13585,14539,13430,14610,13272,14677,13026,14737,12808,14790,12617,14833,12449,14869,12303,14896,12065,14916,11845,14929,11655,14937,11490,14939,11347,14936,11184,14930,10970,14921,10783,14912,10621,14900,10480,14885,10356,14867,10247,14848,10062,14827,9894,14805,9745,14400,14208,14400,14206,14402,14198,14406,14174,14415,14122,14427,14035,14444,13913,14469,13767,14504,13613,14548,13463,14598,13324,14651,13082,14704,12858,14752,12658,14795,12483,14831,12330,14860,12106,14881,11875,14895,11675,14903,11501,14905,11351,14903,11178,14900,10953,14892,10757,14880,10589,14865,10442,14847,10313,14827,10162,14805,9965,14782,9792,14757,9642,14731,9507,14562,13883,14562,13883,14563,13877,14566,13862,14570,13830,14576,13773,14584,13689,14595,13582,14613,13461,14637,13336,14668,13120,14704,12897,14741,12695,14776,12516,14808,12358,14835,12150,14856,11910,14870,11701,14878,11519,14882,11361,14884,11187,14880,10951,14871,10748,14858,10572,14842,10418,14823,10286,14801,10099,14777,9897,14751,9722,14725,9567,14696,9430,14666,9309,14702,13604,14702,13604,14702,13600,14703,13591,14705,13570,14707,13533,14709,13477,14712,13400,14718,13305,14727,13106,14743,12907,14762,12716,14784,12539,14807,12380,14827,12190,14844,11943,14855,11727,14863,11539,14870,11376,14871,11204,14868,10960,14858,10748,14845,10565,14829,10406,14809,10269,14786,10058,14761,9852,14734,9671,14705,9512,14674,9374,14641,9253,14608,9076,14821,13366,14821,13365,14821,13364,14821,13358,14821,13344,14821,13320,14819,13252,14817,13145,14815,13011,14814,12858,14817,12698,14823,12539,14832,12389,14841,12214,14850,11968,14856,11750,14861,11558,14866,11390,14867,11226,14862,10972,14853,10754,14840,10565,14823,10401,14803,10259,14780,10032,14754,9820,14725,9635,14694,9473,14661,9333,14627,9203,14593,8988,14557,8798,14923,13014,14922,13014,14922,13012,14922,13004,14920,12987,14919,12957,14915,12907,14909,12834,14902,12738,14894,12623,14888,12498,14883,12370,14880,12203,14878,11970,14875,11759,14873,11569,14874,11401,14872,11243,14865,10986,14855,10762,14842,10568,14825,10401,14804,10255,14781,10017,14754,9799,14725,9611,14692,9445,14658,9301,14623,9139,14587,8920,14548,8729,14509,8562,15008,12672,15008,12672,15008,12671,15007,12667,15005,12656,15001,12637,14997,12605,14989,12556,14978,12490,14966,12407,14953,12313,14940,12136,14927,11934,14914,11742,14903,11563,14896,11401,14889,11247,14879,10992,14866,10767,14851,10570,14833,10400,14812,10252,14789,10007,14761,9784,14731,9592,14698,9424,14663,9279,14627,9088,14588,8868,14548,8676,14508,8508,14467,8360,15080,12386,15080,12386,15079,12385,15078,12383,15076,12378,15072,12367,15066,12347,15057,12315,15045,12253,15030,12138,15012,11998,14993,11845,14972,11685,14951,11530,14935,11383,14920,11228,14904,10981,14887,10762,14870,10567,14850,10397,14827,10248,14803,9997,14774,9771,14743,9578,14710,9407,14674,9259,14637,9048,14596,8826,14555,8632,14514,8464,14471,8317,14427,8182,15139,12008,15139,12008,15138,12008,15137,12007,15135,12003,15130,11990,15124,11969,15115,11929,15102,11872,15086,11794,15064,11693,15041,11581,15013,11459,14987,11336,14966,11170,14944,10944,14921,10738,14898,10552,14875,10387,14850,10239,14824,9983,14794,9758,14762,9563,14728,9392,14692,9244,14653,9014,14611,8791,14569,8597,14526,8427,14481,8281,14436,8110,14391,7885,15188,11617,15188,11617,15187,11617,15186,11618,15183,11617,15179,11612,15173,11601,15163,11581,15150,11546,15133,11495,15110,11427,15083,11346,15051,11246,15024,11057,14996,10868,14967,10687,14938,10517,14911,10362,14882,10206,14853,9956,14821,9737,14787,9543,14752,9375,14715,9228,14675,8980,14632,8760,14589,8565,14544,8395,14498,8248,14451,8049,14404,7824,14357,7630,15228,11298,15228,11298,15227,11299,15226,11301,15223,11303,15219,11302,15213,11299,15204,11290,15191,11271,15174,11217,15150,11129,15119,11015,15087,10886,15057,10744,15024,10599,14990,10455,14957,10318,14924,10143,14891,9911,14856,9701,14820,9516,14782,9352,14744,9200,14703,8946,14659,8725,14615,8533,14568,8366,14521,8220,14472,7992,14423,7770,14374,7578,14315,7408,15260,10819,15260,10819,15259,10822,15258,10826,15256,10832,15251,10836,15246,10841,15237,10838,15225,10821,15207,10788,15183,10734,15151,10660,15120,10571,15087,10469,15049,10359,15012,10249,14974,10041,14937,9837,14900,9647,14860,9475,14820,9320,14779,9147,14736,8902,14691,8688,14646,8499,14598,8335,14549,8189,14499,7940,14448,7720,14397,7529,14347,7363,14256,7218,15285,10410,15285,10411,15285,10413,15284,10418,15282,10425,15278,10434,15272,10442,15264,10449,15252,10445,15235,10433,15210,10403,15179,10358,15149,10301,15113,10218,15073,10059,15033,9894,14991,9726,14951,9565,14909,9413,14865,9273,14822,9073,14777,8845,14730,8641,14682,8459,14633,8300,14583,8129,14531,7883,14479,7670,14426,7482,14373,7321,14305,7176,14201,6939,15305,9939,15305,9940,15305,9945,15304,9955,15302,9967,15298,9989,15293,10010,15286,10033,15274,10044,15258,10045,15233,10022,15205,9975,15174,9903,15136,9808,15095,9697,15053,9578,15009,9451,14965,9327,14918,9198,14871,8973,14825,8766,14775,8579,14725,8408,14675,8259,14622,8058,14569,7821,14515,7615,14460,7435,14405,7276,14350,7108,14256,6866,14149,6653,15321,9444,15321,9445,15321,9448,15320,9458,15317,9470,15314,9490,15310,9515,15302,9540,15292,9562,15276,9579,15251,9577,15226,9559,15195,9519,15156,9463,15116,9389,15071,9304,15025,9208,14978,9023,14927,8838,14878,8661,14827,8496,14774,8344,14722,8206,14667,7973,14612,7749,14556,7555,14499,7382,14443,7229,14385,7025,14322,6791,14210,6588,14100,6409,15333,8920,15333,8921,15332,8927,15332,8943,15329,8965,15326,9002,15322,9048,15316,9106,15307,9162,15291,9204,15267,9221,15244,9221,15212,9196,15175,9134,15133,9043,15088,8930,15040,8801,14990,8665,14938,8526,14886,8391,14830,8261,14775,8087,14719,7866,14661,7664,14603,7482,14544,7322,14485,7178,14426,6936,14367,6713,14281,6517,14166,6348,14054,6198,15341,8360,15341,8361,15341,8366,15341,8379,15339,8399,15336,8431,15332,8473,15326,8527,15318,8585,15302,8632,15281,8670,15258,8690,15227,8690,15191,8664,15149,8612,15104,8543,15055,8456,15001,8360,14948,8259,14892,8122,14834,7923,14776,7734,14716,7558,14656,7397,14595,7250,14534,7070,14472,6835,14410,6628,14350,6443,14243,6283,14125,6135,14010,5889,15348,7715,15348,7717,15348,7725,15347,7745,15345,7780,15343,7836,15339,7905,15334,8e3,15326,8103,15310,8193,15293,8239,15270,8270,15240,8287,15204,8283,15163,8260,15118,8223,15067,8143,15014,8014,14958,7873,14899,7723,14839,7573,14778,7430,14715,7293,14652,7164,14588,6931,14524,6720,14460,6531,14396,6362,14330,6210,14207,6015,14086,5781,13969,5576,15352,7114,15352,7116,15352,7128,15352,7159,15350,7195,15348,7237,15345,7299,15340,7374,15332,7457,15317,7544,15301,7633,15280,7703,15251,7754,15216,7775,15176,7767,15131,7733,15079,7670,15026,7588,14967,7492,14906,7387,14844,7278,14779,7171,14714,6965,14648,6770,14581,6587,14515,6420,14448,6269,14382,6123,14299,5881,14172,5665,14049,5477,13929,5310,15355,6329,15355,6330,15355,6339,15355,6362,15353,6410,15351,6472,15349,6572,15344,6688,15337,6835,15323,6985,15309,7142,15287,7220,15260,7277,15226,7310,15188,7326,15142,7318,15090,7285,15036,7239,14976,7177,14914,7045,14849,6892,14782,6736,14714,6581,14645,6433,14576,6293,14506,6164,14438,5946,14369,5733,14270,5540,14140,5369,14014,5216,13892,5043,15357,5483,15357,5484,15357,5496,15357,5528,15356,5597,15354,5692,15351,5835,15347,6011,15339,6195,15328,6317,15314,6446,15293,6566,15268,6668,15235,6746,15197,6796,15152,6811,15101,6790,15046,6748,14985,6673,14921,6583,14854,6479,14785,6371,14714,6259,14643,6149,14571,5946,14499,5750,14428,5567,14358,5401,14242,5250,14109,5111,13980,4870,13856,4657,15359,4555,15359,4557,15358,4573,15358,4633,15357,4715,15355,4841,15353,5061,15349,5216,15342,5391,15331,5577,15318,5770,15299,5967,15274,6150,15243,6223,15206,6280,15161,6310,15111,6317,15055,6300,14994,6262,14928,6208,14860,6141,14788,5994,14715,5838,14641,5684,14566,5529,14492,5384,14418,5247,14346,5121,14216,4892,14079,4682,13948,4496,13822,4330,15359,3498,15359,3501,15359,3520,15359,3598,15358,3719,15356,3860,15355,4137,15351,4305,15344,4563,15334,4809,15321,5116,15303,5273,15280,5418,15250,5547,15214,5653,15170,5722,15120,5761,15064,5763,15002,5733,14935,5673,14865,5597,14792,5504,14716,5400,14640,5294,14563,5185,14486,5041,14410,4841,14335,4655,14191,4482,14051,4325,13918,4183,13790,4012,15360,2282,15360,2285,15360,2306,15360,2401,15359,2547,15357,2748,15355,3103,15352,3349,15345,3675,15336,4020,15324,4272,15307,4496,15285,4716,15255,4908,15220,5086,15178,5170,15128,5214,15072,5234,15010,5231,14943,5206,14871,5166,14796,5102,14718,4971,14639,4833,14559,4687,14480,4541,14402,4401,14315,4268,14167,4142,14025,3958,13888,3747,13759,3556,15360,923,15360,925,15360,946,15360,1052,15359,1214,15357,1494,15356,1892,15352,2274,15346,2663,15338,3099,15326,3393,15309,3679,15288,3980,15260,4183,15226,4325,15185,4437,15136,4517,15080,4570,15018,4591,14950,4581,14877,4545,14800,4485,14720,4411,14638,4325,14556,4231,14475,4136,14395,3988,14297,3803,14145,3628,13999,3465,13861,3314,13729,3177,15360,263,15360,264,15360,272,15360,325,15359,407,15358,548,15356,780,15352,1144,15347,1580,15339,2099,15328,2425,15312,2795,15292,3133,15264,3329,15232,3517,15191,3689,15143,3819,15088,3923,15025,3978,14956,3999,14882,3979,14804,3931,14722,3855,14639,3756,14554,3645,14470,3529,14388,3409,14279,3289,14124,3173,13975,3055,13834,2848,13701,2658,15360,49,15360,49,15360,52,15360,75,15359,111,15358,201,15356,283,15353,519,15348,726,15340,1045,15329,1415,15314,1795,15295,2173,15269,2410,15237,2649,15197,2866,15150,3054,15095,3140,15032,3196,14963,3228,14888,3236,14808,3224,14725,3191,14639,3146,14553,3088,14466,2976,14382,2836,14262,2692,14103,2549,13952,2409,13808,2278,13674,2154,15360,4,15360,4,15360,4,15360,13,15359,33,15358,59,15357,112,15353,199,15348,302,15341,456,15331,628,15316,827,15297,1082,15272,1332,15241,1601,15202,1851,15156,2069,15101,2172,15039,2256,14970,2314,14894,2348,14813,2358,14728,2344,14640,2311,14551,2263,14463,2203,14376,2133,14247,2059,14084,1915,13930,1761,13784,1609,13648,1464,15360,0,15360,0,15360,0,15360,3,15359,18,15358,26,15357,53,15354,80,15348,97,15341,165,15332,238,15318,326,15299,427,15275,529,15245,654,15207,771,15161,885,15108,994,15046,1089,14976,1170,14900,1229,14817,1266,14731,1284,14641,1282,14550,1260,14460,1223,14370,1174,14232,1116,14066,1050,13909,981,13761,910,13623,839]),N3=null;class N4{constructor(a={}){let b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;const{canvas:A=function(){let a=IZ("canvas");return a.style.display="block",a}(),context:B=null,depth:C=!0,stencil:D=!1,alpha:E=!1,antialias:F=!1,premultipliedAlpha:G=!0,preserveDrawingBuffer:H=!1,powerPreference:I="default",failIfMajorPerformanceCaveat:J=!1,reversedDepthBuffer:K=!1}=a;if(this.isWebGLRenderer=!0,null!==B){if("u">typeof WebGLRenderingContext&&B instanceof WebGLRenderingContext)throw Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");b=B.getContextAttributes().alpha}else b=E;const L=new Set([1033,1031,1029]),M=new Set([1009,1014,1012,1020,1017,1018]),N=new Uint32Array(4),O=new Int32Array(4);let P=null,Q=null;const R=[],S=[];this.domElement=A,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=0,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const T=this;let U=!1;this._outputColorSpace=IT;let V=0,W=0,X=null,Y=-1,Z=null;const $=new Jv,_=new Jv;let aa=null;const ab=new KH(0);let ac=0,ad=A.width,ae=A.height,af=1,ag=null,ah=null;const ai=new Jv(0,0,ad,ae),aj=new Jv(0,0,ad,ae);let ak=!1;const al=new LG;let am=!1,an=!1;const ao=new JZ,ap=new Je,aq=new Jv,ar={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let as=!1;function at(){return null===X?af:1}let au=B;function av(a,b){return A.getContext(a,b)}try{if("setAttribute"in A&&A.setAttribute("data-engine","three.js r181"),A.addEventListener("webglcontextlost",ay,!1),A.addEventListener("webglcontextrestored",az,!1),A.addEventListener("webglcontextcreationerror",aA,!1),null===au){const a="webgl2";if(au=av(a,{alpha:!0,depth:C,stencil:D,antialias:F,premultipliedAlpha:G,preserveDrawingBuffer:H,powerPreference:I,failIfMajorPerformanceCaveat:J}),null===au)throw av(a)?Error("Error creating WebGL context with your selected attributes."):Error("Error creating WebGL context.")}}catch(a){throw a("WebGLRenderer: "+a.message),a}function aw(){(c=new Mj(au)).init(),x=new NV(au,c),d=new L1(au,c,a,x),e=new NT(au,c),d.reversedDepthBuffer&&K&&e.buffers.depth.setReversed(!0),f=new Mm(au),g=new NE,h=new NU(au,c,e,g,d,x,f),i=new L3(T),j=new Mi(T),k=new LT(au),y=new L_(au,k),l=new Mk(au,k,f,y),m=new Mo(au,l,k,f),u=new Mn(au,d,h),r=new L2(g),n=new ND(T,i,j,c,d,y,r),o=new N0(T,g),p=new NI,q=new NO(c),t=new L$(T,i,j,e,m,b,G),s=new NR(T,m,d),z=new N1(au,f,d,e),v=new L0(au,c,f),w=new Ml(au,c,f),f.programs=n.programs,T.capabilities=d,T.extensions=c,T.properties=g,T.renderLists=p,T.shadowMap=s,T.state=e,T.info=f}aw();const ax=new NZ(T,au);function ay(a){a.preventDefault(),I_("WebGLRenderer: Context Lost."),U=!0}function az(){I_("WebGLRenderer: Context Restored."),U=!1;let a=f.autoReset,b=s.enabled,c=s.autoUpdate,d=s.needsUpdate,e=s.type;aw(),f.autoReset=a,s.enabled=b,s.autoUpdate=c,s.needsUpdate=d,s.type=e}function aA(a){I1("WebGLRenderer: A WebGL context could not be created. Reason: ",a.statusMessage)}function aB(a){var b,c;let d,e=a.target;e.removeEventListener("dispose",aB),c=b=e,void 0!==(d=g.get(c).programs)&&(d.forEach(function(a){n.releaseProgram(a)}),c.isShaderMaterial&&n.releaseShaderCache(c)),g.remove(b)}function aC(a,b,c){!0===a.transparent&&2===a.side&&!1===a.forceSinglePass?(a.side=1,a.needsUpdate=!0,aM(a,b,c),a.side=0,a.needsUpdate=!0,aM(a,b,c),a.side=2):aM(a,b,c)}this.xr=ax,this.getContext=function(){return au},this.getContextAttributes=function(){return au.getContextAttributes()},this.forceContextLoss=function(){let a=c.get("WEBGL_lose_context");a&&a.loseContext()},this.forceContextRestore=function(){let a=c.get("WEBGL_lose_context");a&&a.restoreContext()},this.getPixelRatio=function(){return af},this.setPixelRatio=function(a){void 0!==a&&(af=a,this.setSize(ad,ae,!1))},this.getSize=function(a){return a.set(ad,ae)},this.setSize=function(a,b,c=!0){ax.isPresenting?I0("WebGLRenderer: Can't change size while VR device is presenting."):(ad=a,ae=b,A.width=Math.floor(a*af),A.height=Math.floor(b*af),!0===c&&(A.style.width=a+"px",A.style.height=b+"px"),this.setViewport(0,0,a,b))},this.getDrawingBufferSize=function(a){return a.set(ad*af,ae*af).floor()},this.setDrawingBufferSize=function(a,b,c){ad=a,ae=b,af=c,A.width=Math.floor(a*c),A.height=Math.floor(b*c),this.setViewport(0,0,a,b)},this.getCurrentViewport=function(a){return a.copy($)},this.getViewport=function(a){return a.copy(ai)},this.setViewport=function(a,b,c,d){a.isVector4?ai.set(a.x,a.y,a.z,a.w):ai.set(a,b,c,d),e.viewport($.copy(ai).multiplyScalar(af).round())},this.getScissor=function(a){return a.copy(aj)},this.setScissor=function(a,b,c,d){a.isVector4?aj.set(a.x,a.y,a.z,a.w):aj.set(a,b,c,d),e.scissor(_.copy(aj).multiplyScalar(af).round())},this.getScissorTest=function(){return ak},this.setScissorTest=function(a){e.setScissorTest(ak=a)},this.setOpaqueSort=function(a){ag=a},this.setTransparentSort=function(a){ah=a},this.getClearColor=function(a){return a.copy(t.getClearColor())},this.setClearColor=function(){t.setClearColor(...arguments)},this.getClearAlpha=function(){return t.getClearAlpha()},this.setClearAlpha=function(){t.setClearAlpha(...arguments)},this.clear=function(a=!0,b=!0,c=!0){let d=0;if(a){let a=!1;if(null!==X){let b=X.texture.format;a=L.has(b)}if(a){let a=X.texture.type,b=M.has(a),c=t.getClearColor(),d=t.getClearAlpha(),e=c.r,f=c.g,g=c.b;b?(N[0]=e,N[1]=f,N[2]=g,N[3]=d,au.clearBufferuiv(au.COLOR,0,N)):(O[0]=e,O[1]=f,O[2]=g,O[3]=d,au.clearBufferiv(au.COLOR,0,O))}else d|=au.COLOR_BUFFER_BIT}b&&(d|=au.DEPTH_BUFFER_BIT),c&&(d|=au.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(0xffffffff)),au.clear(d)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){A.removeEventListener("webglcontextlost",ay,!1),A.removeEventListener("webglcontextrestored",az,!1),A.removeEventListener("webglcontextcreationerror",aA,!1),t.dispose(),p.dispose(),q.dispose(),g.dispose(),i.dispose(),j.dispose(),m.dispose(),y.dispose(),z.dispose(),n.dispose(),ax.dispose(),ax.removeEventListener("sessionstart",aE),ax.removeEventListener("sessionend",aF),aG.stop()},this.renderBufferDirect=function(a,b,f,m,n,p){null===b&&(b=ar);let q=n.isMesh&&0>n.matrixWorld.determinant(),s=function(a,b,c,f,k){var l,m;!0!==b.isScene&&(b=ar),h.resetTextureUnits();let n=b.fog,p=f.isMeshStandardMaterial?b.environment:null,q=null===X?T.outputColorSpace:!0===X.isXRRenderTarget?X.texture.colorSpace:IU,s=(f.isMeshStandardMaterial?j:i).get(f.envMap||p),t=!0===f.vertexColors&&!!c.attributes.color&&4===c.attributes.color.itemSize,v=!!c.attributes.tangent&&(!!f.normalMap||f.anisotropy>0),w=!!c.morphAttributes.position,x=!!c.morphAttributes.normal,y=!!c.morphAttributes.color,A=0;f.toneMapped&&(null===X||!0===X.isXRRenderTarget)&&(A=T.toneMapping);let B=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,C=void 0!==B?B.length:0,D=g.get(f),E=Q.state.lights;if(!0===am&&(!0===an||a!==Z)){let b=a===Z&&f.id===Y;r.setState(f,a,b)}let F=!1;f.version===D.__version?(D.needsLights&&D.lightsStateVersion!==E.state.version||D.outputColorSpace!==q||k.isBatchedMesh&&!1===D.batching||!k.isBatchedMesh&&!0===D.batching||k.isBatchedMesh&&!0===D.batchingColor&&null===k.colorTexture||k.isBatchedMesh&&!1===D.batchingColor&&null!==k.colorTexture||k.isInstancedMesh&&!1===D.instancing||!k.isInstancedMesh&&!0===D.instancing||k.isSkinnedMesh&&!1===D.skinning||!k.isSkinnedMesh&&!0===D.skinning||k.isInstancedMesh&&!0===D.instancingColor&&null===k.instanceColor||k.isInstancedMesh&&!1===D.instancingColor&&null!==k.instanceColor||k.isInstancedMesh&&!0===D.instancingMorph&&null===k.morphTexture||k.isInstancedMesh&&!1===D.instancingMorph&&null!==k.morphTexture||D.envMap!==s||!0===f.fog&&D.fog!==n||void 0!==D.numClippingPlanes&&(D.numClippingPlanes!==r.numPlanes||D.numIntersection!==r.numIntersection)||D.vertexAlphas!==t||D.vertexTangents!==v||D.morphTargets!==w||D.morphNormals!==x||D.morphColors!==y||D.toneMapping!==A||D.morphTargetsCount!==C)&&(F=!0):(F=!0,D.__version=f.version);let G=D.currentProgram;!0===F&&(G=aM(f,b,k));let H=!1,I=!1,J=!1,K=G.getUniforms(),L=D.uniforms;if(e.useProgram(G.program)&&(H=!0,I=!0,J=!0),f.id!==Y&&(Y=f.id,I=!0),H||Z!==a){e.buffers.depth.getReversed()&&!0!==a.reversedDepth&&(a._reversedDepth=!0,a.updateProjectionMatrix()),K.setValue(au,"projectionMatrix",a.projectionMatrix),K.setValue(au,"viewMatrix",a.matrixWorldInverse);let b=K.map.cameraPosition;void 0!==b&&b.setValue(au,ap.setFromMatrixPosition(a.matrixWorld)),d.logarithmicDepthBuffer&&K.setValue(au,"logDepthBufFC",2/(Math.log(a.far+1)/Math.LN2)),(f.isMeshPhongMaterial||f.isMeshToonMaterial||f.isMeshLambertMaterial||f.isMeshBasicMaterial||f.isMeshStandardMaterial||f.isShaderMaterial)&&K.setValue(au,"isOrthographic",!0===a.isOrthographicCamera),Z!==a&&(Z=a,I=!0,J=!0)}if(k.isSkinnedMesh){K.setOptional(au,k,"bindMatrix"),K.setOptional(au,k,"bindMatrixInverse");let a=k.skeleton;a&&(null===a.boneTexture&&a.computeBoneTexture(),K.setValue(au,"boneTexture",a.boneTexture,h))}k.isBatchedMesh&&(K.setOptional(au,k,"batchingTexture"),K.setValue(au,"batchingTexture",k._matricesTexture,h),K.setOptional(au,k,"batchingIdTexture"),K.setValue(au,"batchingIdTexture",k._indirectTexture,h),K.setOptional(au,k,"batchingColorTexture"),null!==k._colorsTexture&&K.setValue(au,"batchingColorTexture",k._colorsTexture,h));let M=c.morphAttributes;if((void 0!==M.position||void 0!==M.normal||void 0!==M.color)&&u.update(k,c,G),(I||D.receiveShadow!==k.receiveShadow)&&(D.receiveShadow=k.receiveShadow,K.setValue(au,"receiveShadow",k.receiveShadow)),f.isMeshGouraudMaterial&&null!==f.envMap&&(L.envMap.value=s,L.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1),f.isMeshStandardMaterial&&null===f.envMap&&null!==b.environment&&(L.envMapIntensity.value=b.environmentIntensity),void 0!==L.dfgLUT&&(L.dfgLUT.value=(null===N3&&((N3=new Lx(N2,32,32,1030,1016)).minFilter=1006,N3.magFilter=1006,N3.wrapS=1001,N3.wrapT=1001,N3.generateMipmaps=!1,N3.needsUpdate=!0),N3)),I&&(K.setValue(au,"toneMappingExposure",T.toneMappingExposure),D.needsLights&&(l=L,m=J,l.ambientLightColor.needsUpdate=m,l.lightProbe.needsUpdate=m,l.directionalLights.needsUpdate=m,l.directionalLightShadows.needsUpdate=m,l.pointLights.needsUpdate=m,l.pointLightShadows.needsUpdate=m,l.spotLights.needsUpdate=m,l.spotLightShadows.needsUpdate=m,l.rectAreaLights.needsUpdate=m,l.hemisphereLights.needsUpdate=m),n&&!0===f.fog&&o.refreshFogUniforms(L,n),o.refreshMaterialUniforms(L,f,af,ae,Q.state.transmissionRenderTarget[a.id]),Ni.upload(au,aN(D),L,h)),f.isShaderMaterial&&!0===f.uniformsNeedUpdate&&(Ni.upload(au,aN(D),L,h),f.uniformsNeedUpdate=!1),f.isSpriteMaterial&&K.setValue(au,"center",k.center),K.setValue(au,"modelViewMatrix",k.modelViewMatrix),K.setValue(au,"normalMatrix",k.normalMatrix),K.setValue(au,"modelMatrix",k.matrixWorld),f.isShaderMaterial||f.isRawShaderMaterial){let a=f.uniformsGroups;for(let b=0,c=a.length;b<c;b++){let c=a[b];z.update(c,G),z.bind(c,G)}}return G}(a,b,f,m,n);e.setMaterial(m,q);let t=f.index,x=1;if(!0===m.wireframe){if(void 0===(t=l.getWireframeAttribute(f)))return;x=2}let A=f.drawRange,B=f.attributes.position,C=A.start*x,D=(A.start+A.count)*x;null!==p&&(C=Math.max(C,p.start*x),D=Math.min(D,(p.start+p.count)*x)),null!==t?(C=Math.max(C,0),D=Math.min(D,t.count)):null!=B&&(C=Math.max(C,0),D=Math.min(D,B.count));let E=D-C;if(E<0||E===1/0)return;y.setup(n,m,s,f,t);let F,G=v;if(null!==t&&(F=k.get(t),(G=w).setIndex(F)),n.isMesh)!0===m.wireframe?(e.setLineWidth(m.wireframeLinewidth*at()),G.setMode(au.LINES)):G.setMode(au.TRIANGLES);else if(n.isLine){let a=m.linewidth;void 0===a&&(a=1),e.setLineWidth(a*at()),n.isLineSegments?G.setMode(au.LINES):n.isLineLoop?G.setMode(au.LINE_LOOP):G.setMode(au.LINE_STRIP)}else n.isPoints?G.setMode(au.POINTS):n.isSprite&&G.setMode(au.TRIANGLES);if(n.isBatchedMesh)if(null!==n._multiDrawInstances)I2("WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),G.renderMultiDrawInstances(n._multiDrawStarts,n._multiDrawCounts,n._multiDrawCount,n._multiDrawInstances);else if(c.get("WEBGL_multi_draw"))G.renderMultiDraw(n._multiDrawStarts,n._multiDrawCounts,n._multiDrawCount);else{let a=n._multiDrawStarts,b=n._multiDrawCounts,c=n._multiDrawCount,d=t?k.get(t).bytesPerElement:1,e=g.get(m).currentProgram.getUniforms();for(let f=0;f<c;f++)e.setValue(au,"_gl_DrawID",f),G.render(a[f]/d,b[f])}else if(n.isInstancedMesh)G.renderInstances(C,E,n.count);else if(f.isInstancedBufferGeometry){let a=void 0!==f._maxInstanceCount?f._maxInstanceCount:1/0,b=Math.min(f.instanceCount,a);G.renderInstances(C,E,b)}else G.render(C,E)},this.compile=function(a,b,c=null){null===c&&(c=a),(Q=q.get(c)).init(b),S.push(Q),c.traverseVisible(function(a){a.isLight&&a.layers.test(b.layers)&&(Q.pushLight(a),a.castShadow&&Q.pushShadow(a))}),a!==c&&a.traverseVisible(function(a){a.isLight&&a.layers.test(b.layers)&&(Q.pushLight(a),a.castShadow&&Q.pushShadow(a))}),Q.setupLights();let d=new Set;return a.traverse(function(a){if(!(a.isMesh||a.isPoints||a.isLine||a.isSprite))return;let b=a.material;if(b)if(Array.isArray(b))for(let e=0;e<b.length;e++){let f=b[e];aC(f,c,a),d.add(f)}else aC(b,c,a),d.add(b)}),Q=S.pop(),d},this.compileAsync=function(a,b,d=null){let e=this.compile(a,b,d);return new Promise(b=>{function d(){(e.forEach(function(a){g.get(a).currentProgram.isReady()&&e.delete(a)}),0===e.size)?b(a):setTimeout(d,10)}null!==c.get("KHR_parallel_shader_compile")?d():setTimeout(d,10)})};let aD=null;function aE(){aG.stop()}function aF(){aG.start()}const aG=new LS;function aH(a,b,c,d){if(!1===a.visible)return;if(a.layers.test(b.layers)){if(a.isGroup)c=a.renderOrder;else if(a.isLOD)!0===a.autoUpdate&&a.update(b);else if(a.isLight)Q.pushLight(a),a.castShadow&&Q.pushShadow(a);else if(a.isSprite){if(!a.frustumCulled||al.intersectsSprite(a)){d&&aq.setFromMatrixPosition(a.matrixWorld).applyMatrix4(ao);let b=m.update(a),e=a.material;e.visible&&P.push(a,b,e,c,aq.z,null)}}else if((a.isMesh||a.isLine||a.isPoints)&&(!a.frustumCulled||al.intersectsObject(a))){let b=m.update(a),e=a.material;if(d&&(void 0!==a.boundingSphere?(null===a.boundingSphere&&a.computeBoundingSphere(),aq.copy(a.boundingSphere.center)):(null===b.boundingSphere&&b.computeBoundingSphere(),aq.copy(b.boundingSphere.center)),aq.applyMatrix4(a.matrixWorld).applyMatrix4(ao)),Array.isArray(e)){let d=b.groups;for(let f=0,g=d.length;f<g;f++){let g=d[f],h=e[g.materialIndex];h&&h.visible&&P.push(a,b,h,c,aq.z,g)}}else e.visible&&P.push(a,b,e,c,aq.z,null)}}let e=a.children;for(let a=0,f=e.length;a<f;a++)aH(e[a],b,c,d)}function aI(a,b,c,d){let{opaque:f,transmissive:g,transparent:h}=a;Q.setupLightsView(c),!0===am&&r.setGlobalState(T.clippingPlanes,c),d&&e.viewport($.copy(d)),f.length>0&&aK(f,b,c),g.length>0&&aK(g,b,c),h.length>0&&aK(h,b,c),e.buffers.depth.setTest(!0),e.buffers.depth.setMask(!0),e.buffers.color.setMask(!0),e.setPolygonOffset(!1)}function aJ(a,b,d,e){if((!0===d.isScene?d.overrideMaterial:null)!==null)return;void 0===Q.state.transmissionRenderTarget[e.id]&&(Q.state.transmissionRenderTarget[e.id]=new Jx(1,1,{generateMipmaps:!0,type:c.has("EXT_color_buffer_half_float")||c.has("EXT_color_buffer_float")?1016:1009,minFilter:1008,samples:4,stencilBuffer:D,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Jl.workingColorSpace}));let f=Q.state.transmissionRenderTarget[e.id],g=e.viewport||$;f.setSize(g.z*T.transmissionResolutionScale,g.w*T.transmissionResolutionScale);let i=T.getRenderTarget(),j=T.getActiveCubeFace(),k=T.getActiveMipmapLevel();T.setRenderTarget(f),T.getClearColor(ab),(ac=T.getClearAlpha())<1&&T.setClearColor(0xffffff,.5),T.clear(),as&&t.render(d);let l=T.toneMapping;T.toneMapping=0;let m=e.viewport;if(void 0!==e.viewport&&(e.viewport=void 0),Q.setupLightsView(e),!0===am&&r.setGlobalState(T.clippingPlanes,e),aK(a,d,e),h.updateMultisampleRenderTarget(f),h.updateRenderTargetMipmap(f),!1===c.has("WEBGL_multisampled_render_to_texture")){let a=!1;for(let c=0,f=b.length;c<f;c++){let{object:f,geometry:g,material:h,group:i}=b[c];if(2===h.side&&f.layers.test(e.layers)){let b=h.side;h.side=1,h.needsUpdate=!0,aL(f,d,e,g,h,i),h.side=b,h.needsUpdate=!0,a=!0}}!0===a&&(h.updateMultisampleRenderTarget(f),h.updateRenderTargetMipmap(f))}T.setRenderTarget(i,j,k),T.setClearColor(ab,ac),void 0!==m&&(e.viewport=m),T.toneMapping=l}function aK(a,b,c){let d=!0===b.isScene?b.overrideMaterial:null;for(let e=0,f=a.length;e<f;e++){let f=a[e],{object:g,geometry:h,group:i}=f,j=f.material;!0===j.allowOverride&&null!==d&&(j=d),g.layers.test(c.layers)&&aL(g,b,c,h,j,i)}}function aL(a,b,c,d,e,f){a.onBeforeRender(T,b,c,d,e,f),a.modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,a.matrixWorld),a.normalMatrix.getNormalMatrix(a.modelViewMatrix),e.onBeforeRender(T,b,c,d,a,f),!0===e.transparent&&2===e.side&&!1===e.forceSinglePass?(e.side=1,e.needsUpdate=!0,T.renderBufferDirect(c,b,d,e,a,f),e.side=0,e.needsUpdate=!0,T.renderBufferDirect(c,b,d,e,a,f),e.side=2):T.renderBufferDirect(c,b,d,e,a,f),a.onAfterRender(T,b,c,d,e,f)}function aM(a,b,c){var d;!0!==b.isScene&&(b=ar);let e=g.get(a),f=Q.state.lights,h=Q.state.shadowsArray,k=f.state.version,l=n.getParameters(a,f.state,h,b,c),m=n.getProgramCacheKey(l),o=e.programs;e.environment=a.isMeshStandardMaterial?b.environment:null,e.fog=b.fog,e.envMap=(a.isMeshStandardMaterial?j:i).get(a.envMap||e.environment),e.envMapRotation=null!==e.environment&&null===a.envMap?b.environmentRotation:a.envMapRotation,void 0===o&&(a.addEventListener("dispose",aB),e.programs=o=new Map);let p=o.get(m);if(void 0!==p){if(e.currentProgram===p&&e.lightsStateVersion===k)return aO(a,l),p}else l.uniforms=n.getUniforms(a),a.onBeforeCompile(l,T),p=n.acquireProgram(l,m),o.set(m,p),e.uniforms=l.uniforms;let q=e.uniforms;return(a.isShaderMaterial||a.isRawShaderMaterial)&&!0!==a.clipping||(q.clippingPlanes=r.uniform),aO(a,l),e.needsLights=(d=a).isMeshLambertMaterial||d.isMeshToonMaterial||d.isMeshPhongMaterial||d.isMeshStandardMaterial||d.isShadowMaterial||d.isShaderMaterial&&!0===d.lights,e.lightsStateVersion=k,e.needsLights&&(q.ambientLightColor.value=f.state.ambient,q.lightProbe.value=f.state.probe,q.directionalLights.value=f.state.directional,q.directionalLightShadows.value=f.state.directionalShadow,q.spotLights.value=f.state.spot,q.spotLightShadows.value=f.state.spotShadow,q.rectAreaLights.value=f.state.rectArea,q.ltc_1.value=f.state.rectAreaLTC1,q.ltc_2.value=f.state.rectAreaLTC2,q.pointLights.value=f.state.point,q.pointLightShadows.value=f.state.pointShadow,q.hemisphereLights.value=f.state.hemi,q.directionalShadowMap.value=f.state.directionalShadowMap,q.directionalShadowMatrix.value=f.state.directionalShadowMatrix,q.spotShadowMap.value=f.state.spotShadowMap,q.spotLightMatrix.value=f.state.spotLightMatrix,q.spotLightMap.value=f.state.spotLightMap,q.pointShadowMap.value=f.state.pointShadowMap,q.pointShadowMatrix.value=f.state.pointShadowMatrix),e.currentProgram=p,e.uniformsList=null,p}function aN(a){if(null===a.uniformsList){let b=a.currentProgram.getUniforms();a.uniformsList=Ni.seqWithValue(b.seq,a.uniforms)}return a.uniformsList}function aO(a,b){let c=g.get(a);c.outputColorSpace=b.outputColorSpace,c.batching=b.batching,c.batchingColor=b.batchingColor,c.instancing=b.instancing,c.instancingColor=b.instancingColor,c.instancingMorph=b.instancingMorph,c.skinning=b.skinning,c.morphTargets=b.morphTargets,c.morphNormals=b.morphNormals,c.morphColors=b.morphColors,c.morphTargetsCount=b.morphTargetsCount,c.numClippingPlanes=b.numClippingPlanes,c.numIntersection=b.numClipIntersection,c.vertexAlphas=b.vertexAlphas,c.vertexTangents=b.vertexTangents,c.toneMapping=b.toneMapping}aG.setAnimationLoop(function(a){aD&&aD(a)}),"u">typeof self&&aG.setContext(self),this.setAnimationLoop=function(a){aD=a,ax.setAnimationLoop(a),null===a?aG.stop():aG.start()},ax.addEventListener("sessionstart",aE),ax.addEventListener("sessionend",aF),this.render=function(a,b){if(void 0!==b&&!0!==b.isCamera)return void I1("WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===U)return;if(!0===a.matrixWorldAutoUpdate&&a.updateMatrixWorld(),null===b.parent&&!0===b.matrixWorldAutoUpdate&&b.updateMatrixWorld(),!0===ax.enabled&&!0===ax.isPresenting&&(!0===ax.cameraAutoUpdate&&ax.updateCamera(b),b=ax.getCamera()),!0===a.isScene&&a.onBeforeRender(T,a,b,X),(Q=q.get(a,S.length)).init(b),S.push(Q),ao.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse),al.setFromProjectionMatrix(ao,2e3,b.reversedDepth),an=this.localClippingEnabled,am=r.init(this.clippingPlanes,an),(P=p.get(a,R.length)).init(),R.push(P),!0===ax.enabled&&!0===ax.isPresenting){let a=T.xr.getDepthSensingMesh();null!==a&&aH(a,b,-1/0,T.sortObjects)}aH(a,b,0,T.sortObjects),P.finish(),!0===T.sortObjects&&P.sort(ag,ah),(as=!1===ax.enabled||!1===ax.isPresenting||!1===ax.hasDepthSensing())&&t.addToRenderList(P,a),this.info.render.frame++,!0===am&&r.beginShadows();let c=Q.state.shadowsArray;s.render(c,a,b),!0===am&&r.endShadows(),!0===this.info.autoReset&&this.info.reset();let d=P.opaque,e=P.transmissive;if(Q.setupLights(),b.isArrayCamera){let c=b.cameras;if(e.length>0)for(let b=0,f=c.length;b<f;b++)aJ(d,e,a,c[b]);as&&t.render(a);for(let b=0,d=c.length;b<d;b++){let d=c[b];aI(P,a,d,d.viewport)}}else e.length>0&&aJ(d,e,a,b),as&&t.render(a),aI(P,a,b);null!==X&&0===W&&(h.updateMultisampleRenderTarget(X),h.updateRenderTargetMipmap(X)),!0===a.isScene&&a.onAfterRender(T,a,b),y.resetDefaultState(),Y=-1,Z=null,S.pop(),S.length>0?(Q=S[S.length-1],!0===am&&r.setGlobalState(T.clippingPlanes,Q.state.camera)):Q=null,R.pop(),P=R.length>0?R[R.length-1]:null},this.getActiveCubeFace=function(){return V},this.getActiveMipmapLevel=function(){return W},this.getRenderTarget=function(){return X},this.setRenderTargetTextures=function(a,b,c){let d=g.get(a);d.__autoAllocateDepthBuffer=!1===a.resolveDepthBuffer,!1===d.__autoAllocateDepthBuffer&&(d.__useRenderToTexture=!1),g.get(a.texture).__webglTexture=b,g.get(a.depthTexture).__webglTexture=d.__autoAllocateDepthBuffer?void 0:c,d.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(a,b){let c=g.get(a);c.__webglFramebuffer=b,c.__useDefaultFramebuffer=void 0===b};const aP=au.createFramebuffer();this.setRenderTarget=function(a,b=0,c=0){X=a,V=b,W=c;let d=!0,f=null,i=!1,j=!1;if(a){let k=g.get(a);if(void 0!==k.__useDefaultFramebuffer)e.bindFramebuffer(au.FRAMEBUFFER,null),d=!1;else if(void 0===k.__webglFramebuffer)h.setupRenderTarget(a);else if(k.__hasExternalTextures)h.rebindTextures(a,g.get(a.texture).__webglTexture,g.get(a.depthTexture).__webglTexture);else if(a.depthBuffer){let b=a.depthTexture;if(k.__boundDepthTexture!==b){if(null!==b&&g.has(b)&&(a.width!==b.image.width||a.height!==b.image.height))throw Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");h.setupDepthRenderbuffer(a)}}let l=a.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(j=!0);let m=g.get(a).__webglFramebuffer;a.isWebGLCubeRenderTarget?(f=Array.isArray(m[b])?m[b][c]:m[b],i=!0):f=a.samples>0&&!1===h.useMultisampledRTT(a)?g.get(a).__webglMultisampledFramebuffer:Array.isArray(m)?m[c]:m,$.copy(a.viewport),_.copy(a.scissor),aa=a.scissorTest}else $.copy(ai).multiplyScalar(af).floor(),_.copy(aj).multiplyScalar(af).floor(),aa=ak;if(0!==c&&(f=aP),e.bindFramebuffer(au.FRAMEBUFFER,f)&&d&&e.drawBuffers(a,f),e.viewport($),e.scissor(_),e.setScissorTest(aa),i){let d=g.get(a.texture);au.framebufferTexture2D(au.FRAMEBUFFER,au.COLOR_ATTACHMENT0,au.TEXTURE_CUBE_MAP_POSITIVE_X+b,d.__webglTexture,c)}else if(j)for(let d=0;d<a.textures.length;d++){let e=g.get(a.textures[d]);au.framebufferTextureLayer(au.FRAMEBUFFER,au.COLOR_ATTACHMENT0+d,e.__webglTexture,c,b)}else if(null!==a&&0!==c){let b=g.get(a.texture);au.framebufferTexture2D(au.FRAMEBUFFER,au.COLOR_ATTACHMENT0,au.TEXTURE_2D,b.__webglTexture,c)}Y=-1},this.readRenderTargetPixels=function(a,b,c,f,h,i,j,k=0){if(!(a&&a.isWebGLRenderTarget))return void I1("WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let l=g.get(a).__webglFramebuffer;if(a.isWebGLCubeRenderTarget&&void 0!==j&&(l=l[j]),l){e.bindFramebuffer(au.FRAMEBUFFER,l);try{let e=a.textures[k],g=e.format,j=e.type;if(!d.textureFormatReadable(g))return void I1("WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!d.textureTypeReadable(j))return void I1("WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");b>=0&&b<=a.width-f&&c>=0&&c<=a.height-h&&(a.textures.length>1&&au.readBuffer(au.COLOR_ATTACHMENT0+k),au.readPixels(b,c,f,h,x.convert(g),x.convert(j),i))}finally{let a=null!==X?g.get(X).__webglFramebuffer:null;e.bindFramebuffer(au.FRAMEBUFFER,a)}}},this.readRenderTargetPixelsAsync=async function(a,b,c,f,h,i,j,k=0){if(!(a&&a.isWebGLRenderTarget))throw Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let l=g.get(a).__webglFramebuffer;if(a.isWebGLCubeRenderTarget&&void 0!==j&&(l=l[j]),l)if(b>=0&&b<=a.width-f&&c>=0&&c<=a.height-h){var m;e.bindFramebuffer(au.FRAMEBUFFER,l);let j=a.textures[k],n=j.format,o=j.type;if(!d.textureFormatReadable(n))throw Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!d.textureTypeReadable(o))throw Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");let p=au.createBuffer();au.bindBuffer(au.PIXEL_PACK_BUFFER,p),au.bufferData(au.PIXEL_PACK_BUFFER,i.byteLength,au.STREAM_READ),a.textures.length>1&&au.readBuffer(au.COLOR_ATTACHMENT0+k),au.readPixels(b,c,f,h,x.convert(n),x.convert(o),0);let q=null!==X?g.get(X).__webglFramebuffer:null;e.bindFramebuffer(au.FRAMEBUFFER,q);let r=au.fenceSync(au.SYNC_GPU_COMMANDS_COMPLETE,0);return au.flush(),await (m=au,new Promise(function(a,b){setTimeout(function c(){switch(m.clientWaitSync(r,m.SYNC_FLUSH_COMMANDS_BIT,0)){case m.WAIT_FAILED:b();break;case m.TIMEOUT_EXPIRED:setTimeout(c,4);break;default:a()}},4)})),au.bindBuffer(au.PIXEL_PACK_BUFFER,p),au.getBufferSubData(au.PIXEL_PACK_BUFFER,0,i),au.deleteBuffer(p),au.deleteSync(r),i}else throw Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(a,b=null,c=0){let d=Math.pow(2,-c),f=Math.floor(a.image.width*d),g=Math.floor(a.image.height*d),i=null!==b?b.x:0,j=null!==b?b.y:0;h.setTexture2D(a,0),au.copyTexSubImage2D(au.TEXTURE_2D,c,0,0,i,j,f,g),e.unbindTexture()};const aQ=au.createFramebuffer(),aR=au.createFramebuffer();this.copyTextureToTexture=function(a,b,c=null,d=null,f=0,i=null){let j,k,l,m,n,o,p,q,r,s;null===i&&(0!==f?(I2("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),i=f,f=0):i=0);let t=a.isCompressedTexture?a.mipmaps[i]:a.image;if(null!==c)j=c.max.x-c.min.x,k=c.max.y-c.min.y,l=c.isBox3?c.max.z-c.min.z:1,m=c.min.x,n=c.min.y,o=c.isBox3?c.min.z:0;else{let b=Math.pow(2,-f);j=Math.floor(t.width*b),k=Math.floor(t.height*b),l=a.isDataArrayTexture?t.depth:a.isData3DTexture?Math.floor(t.depth*b):1,m=0,n=0,o=0}null!==d?(p=d.x,q=d.y,r=d.z):(p=0,q=0,r=0);let u=x.convert(b.format),v=x.convert(b.type);b.isData3DTexture?(h.setTexture3D(b,0),s=au.TEXTURE_3D):b.isDataArrayTexture||b.isCompressedArrayTexture?(h.setTexture2DArray(b,0),s=au.TEXTURE_2D_ARRAY):(h.setTexture2D(b,0),s=au.TEXTURE_2D),au.pixelStorei(au.UNPACK_FLIP_Y_WEBGL,b.flipY),au.pixelStorei(au.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlpha),au.pixelStorei(au.UNPACK_ALIGNMENT,b.unpackAlignment);let w=au.getParameter(au.UNPACK_ROW_LENGTH),y=au.getParameter(au.UNPACK_IMAGE_HEIGHT),z=au.getParameter(au.UNPACK_SKIP_PIXELS),A=au.getParameter(au.UNPACK_SKIP_ROWS),B=au.getParameter(au.UNPACK_SKIP_IMAGES);au.pixelStorei(au.UNPACK_ROW_LENGTH,t.width),au.pixelStorei(au.UNPACK_IMAGE_HEIGHT,t.height),au.pixelStorei(au.UNPACK_SKIP_PIXELS,m),au.pixelStorei(au.UNPACK_SKIP_ROWS,n),au.pixelStorei(au.UNPACK_SKIP_IMAGES,o);let C=a.isDataArrayTexture||a.isData3DTexture,D=b.isDataArrayTexture||b.isData3DTexture;if(a.isDepthTexture){let c=g.get(a),d=g.get(b),h=g.get(c.__renderTarget),s=g.get(d.__renderTarget);e.bindFramebuffer(au.READ_FRAMEBUFFER,h.__webglFramebuffer),e.bindFramebuffer(au.DRAW_FRAMEBUFFER,s.__webglFramebuffer);for(let c=0;c<l;c++)C&&(au.framebufferTextureLayer(au.READ_FRAMEBUFFER,au.COLOR_ATTACHMENT0,g.get(a).__webglTexture,f,o+c),au.framebufferTextureLayer(au.DRAW_FRAMEBUFFER,au.COLOR_ATTACHMENT0,g.get(b).__webglTexture,i,r+c)),au.blitFramebuffer(m,n,j,k,p,q,j,k,au.DEPTH_BUFFER_BIT,au.NEAREST);e.bindFramebuffer(au.READ_FRAMEBUFFER,null),e.bindFramebuffer(au.DRAW_FRAMEBUFFER,null)}else if(0!==f||a.isRenderTargetTexture||g.has(a)){let c=g.get(a),d=g.get(b);e.bindFramebuffer(au.READ_FRAMEBUFFER,aQ),e.bindFramebuffer(au.DRAW_FRAMEBUFFER,aR);for(let a=0;a<l;a++)C?au.framebufferTextureLayer(au.READ_FRAMEBUFFER,au.COLOR_ATTACHMENT0,c.__webglTexture,f,o+a):au.framebufferTexture2D(au.READ_FRAMEBUFFER,au.COLOR_ATTACHMENT0,au.TEXTURE_2D,c.__webglTexture,f),D?au.framebufferTextureLayer(au.DRAW_FRAMEBUFFER,au.COLOR_ATTACHMENT0,d.__webglTexture,i,r+a):au.framebufferTexture2D(au.DRAW_FRAMEBUFFER,au.COLOR_ATTACHMENT0,au.TEXTURE_2D,d.__webglTexture,i),0!==f?au.blitFramebuffer(m,n,j,k,p,q,j,k,au.COLOR_BUFFER_BIT,au.NEAREST):D?au.copyTexSubImage3D(s,i,p,q,r+a,m,n,j,k):au.copyTexSubImage2D(s,i,p,q,m,n,j,k);e.bindFramebuffer(au.READ_FRAMEBUFFER,null),e.bindFramebuffer(au.DRAW_FRAMEBUFFER,null)}else D?a.isDataTexture||a.isData3DTexture?au.texSubImage3D(s,i,p,q,r,j,k,l,u,v,t.data):b.isCompressedArrayTexture?au.compressedTexSubImage3D(s,i,p,q,r,j,k,l,u,t.data):au.texSubImage3D(s,i,p,q,r,j,k,l,u,v,t):a.isDataTexture?au.texSubImage2D(au.TEXTURE_2D,i,p,q,j,k,u,v,t.data):a.isCompressedTexture?au.compressedTexSubImage2D(au.TEXTURE_2D,i,p,q,t.width,t.height,u,t.data):au.texSubImage2D(au.TEXTURE_2D,i,p,q,j,k,u,v,t);au.pixelStorei(au.UNPACK_ROW_LENGTH,w),au.pixelStorei(au.UNPACK_IMAGE_HEIGHT,y),au.pixelStorei(au.UNPACK_SKIP_PIXELS,z),au.pixelStorei(au.UNPACK_SKIP_ROWS,A),au.pixelStorei(au.UNPACK_SKIP_IMAGES,B),0===i&&b.generateMipmaps&&au.generateMipmap(s),e.unbindTexture()},this.initRenderTarget=function(a){void 0===g.get(a).__webglFramebuffer&&h.setupRenderTarget(a)},this.initTexture=function(a){a.isCubeTexture?h.setTextureCube(a,0):a.isData3DTexture?h.setTexture3D(a,0):a.isDataArrayTexture||a.isCompressedArrayTexture?h.setTexture2DArray(a,0):h.setTexture2D(a,0),e.unbindTexture()},this.resetState=function(){V=0,W=0,X=null,e.reset(),y.reset()},"u">typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return 2e3}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(a){this._outputColorSpace=a;let b=this.getContext();b.drawingBufferColorSpace=Jl._getDrawingBufferColorSpace(a),b.unpackColorSpace=Jl._getUnpackColorSpace()}}function N5(a,b){let c=a.length;Array.isArray(a[0])||(a=[a]),Array.isArray(b[0])||(b=b.map(a=>[a]));let d=b[0].length,e=b[0].map((a,c)=>b.map(a=>a[c])),f=a.map(a=>e.map(b=>{let c=0;if(!Array.isArray(a)){for(let d of b)c+=a*d;return c}for(let d=0;d<a.length;d++)c+=a[d]*(b[d]||0);return c}));return 1===c&&(f=f[0]),1===d?f.map(a=>a[0]):f}function N6(a){return"string"===N7(a)}function N7(a){return(Object.prototype.toString.call(a).match(/^\[object\s+(.*?)\]$/)[1]||"").toLowerCase()}function N8(a,{precision:b,unit:c}){return N9(a)?"none":Ob(a,b)+(c??"")}function N9(a){return Number.isNaN(a)||a instanceof Number&&a?.none}function Oa(a){return N9(a)?0:a}function Ob(a,b){if(0===a)return 0;let c=~~a,d=0;c&&b&&(d=~~Math.log10(Math.abs(c))+1);let e=10**(b-d);return Math.floor(a*e+.5)/e}var Oc={deg:1,grad:.9,rad:180/Math.PI,turn:360};function Od(a){if(!a)return;a=a.trim();let b=/^-?[\d.]+$/,c=/%|deg|g?rad|turn$/,d=a.match(/^([a-z]+)\((.+?)\)$/i);if(d){let a=[];return d[2].replace(/\/?\s*(none|[-\w.]+(?:%|deg|g?rad|turn)?)/g,(d,e)=>{let f=e.match(c),g=e;if(f){let a=f[0],b=g.slice(0,-a.length);"%"===a?(g=new Number(b/100)).type="<percentage>":((g=new Number(b*Oc[a])).type="<angle>",g.unit=a)}else b.test(g)?(g=new Number(g)).type="<number>":"none"===g&&((g=new Number(NaN)).none=!0);d.startsWith("/")&&((g=g instanceof Number?g:new Number(g)).alpha=!0),"object"==typeof g&&g instanceof Number&&(g.raw=e),a.push(g)}),{name:d[1].toLowerCase(),rawName:d[1],rawArgs:d[2],args:a}}}function Oe(a){return a[a.length-1]}function Of(a,b,c){return isNaN(a)?b:isNaN(b)?a:a+(b-a)*c}function Og(a,b,c){return(c-a)/(b-a)}function Oh(a,b,c){return Of(b[0],b[1],Og(a[0],a[1],c))}function Oi(a){return a.map(a=>a.split("|").map(a=>{let b=(a=a.trim()).match(/^(<[a-z]+>)\[(-?[.\d]+),\s*(-?[.\d]+)\]?$/);if(b){let a=new String(b[1]);return a.range=[+b[2],+b[3]],a}return a}))}function Oj(a,b,c){return Math.max(Math.min(c,b),a)}function Ok(a,b){return Math.sign(a)===Math.sign(b)?a:-a}function Ol(a,b){return Ok(Math.abs(a)**b,a)}function Om(a,b){return 0===b?0:a/b}function On(a,b,c=0,d=a.length){for(;c<d;){let e=c+d>>1;a[e]<b?c=e+1:d=e}return c}var Oo=Object.freeze({__proto__:null,bisectLeft:On,clamp:Oj,copySign:Ok,interpolate:Of,interpolateInv:Og,isNone:N9,isString:N6,last:Oe,mapRange:Oh,multiplyMatrices:N5,parseCoordGrammar:Oi,parseFunction:Od,serializeNumber:N8,skipNone:Oa,spow:Ol,toPrecision:Ob,type:N7,zdiv:Om}),Op=new class{add(a,b,c){if("string"!=typeof arguments[0]){for(var a in arguments[0])this.add(a,arguments[0][a],arguments[1]);return}(Array.isArray(a)?a:[a]).forEach(function(a){this[a]=this[a]||[],b&&this[a][c?"unshift":"push"](b)},this)}run(a,b){this[a]=this[a]||[],this[a].forEach(function(a){a.call(b&&b.context?b.context:b,b)})}},Oq={gamut_mapping:"css",precision:5,deltaE:"76",verbose:globalThis?.process?.env?.NODE_ENV?.toLowerCase()!=="test",warn:function(a){this.verbose&&globalThis?.console?.warn?.(a)}},Or={D50:[.3457/.3585,1,.2958/.3585],D65:[.3127/.329,1,.3583/.329]};function Os(a){return Array.isArray(a)?a:Or[a]}function Ot(a,b,c,d={}){if(a=Os(a),b=Os(b),!a||!b)throw TypeError(`Missing white point to convert ${a?"":"from"}${!a&&!b?"/":""}${b?"":"to"}`);if(a===b)return c;let e={W1:a,W2:b,XYZ:c,options:d};if(Op.run("chromatic-adaptation-start",e),e.M||(e.W1===Or.D65&&e.W2===Or.D50?e.M=[[1.0479297925449969,.022946870601609652,-.05019226628920524],[.02962780877005599,.9904344267538799,-.017073799063418826],[-.009243040646204504,.015055191490298152,.7518742814281371]]:e.W1===Or.D50&&e.W2===Or.D65&&(e.M=[[.955473421488075,-.02309845494876471,.06325924320057072],[-.0283697093338637,1.0099953980813041,.021041441191917323],[.012314014864481998,-.020507649298898964,1.330365926242124]])),Op.run("chromatic-adaptation-end",e),e.M)return N5(e.M,e.XYZ);throw TypeError("Only Bradford CAT with white points D50 and D65 supported for now.")}var Ou=new Set(["<number>","<percentage>","<angle>"]);function Ov(a,b,c,d){return Object.entries(a.coords).map(([a,e],f)=>{let g=b.coordGrammar[f],h=d[f],i=h?.type,j;if(!(j=h.none?g.find(a=>Ou.has(a)):g.find(a=>a==i))){let b=e.name||a;throw TypeError(`${i??h.raw} not allowed for ${b} in ${c}()`)}let k=j.range;"<percentage>"===i&&(k||(k=[0,1]));let l=e.range||e.refRange;return k&&l&&(d[f]=Oh(k,l,d[f])),j})}function Ow(a,{meta:b}={}){let c={str:String(a)?.trim()};if(Op.run("parse-start",c),c.color)return c.color;if(c.parsed=Od(c.str),c.parsed){let a=c.parsed.name;if("color"===a){let a=c.parsed.args.shift(),d=a.startsWith("--")?a.substring(2):`--${a}`,e=[a,d],f=c.parsed.rawArgs.indexOf("/")>0?c.parsed.args.pop():1;for(let d of Oz.all){let g=d.getFormat("color");if(g&&(e.includes(g.id)||g.ids?.filter(a=>e.includes(a)).length)){let e=Object.keys(d.coords).map((a,b)=>c.parsed.args[b]||0),h;return g.coordGrammar&&(h=Ov(d,g,"color",e)),b&&Object.assign(b,{formatId:"color",types:h}),g.id.startsWith("--")&&!a.startsWith("--")&&Oq.warn(`${d.name} is a non-standard space and not currently supported in the CSS spec. Use prefixed color(${g.id}) instead of color(${a}).`),a.startsWith("--")&&!g.id.startsWith("--")&&Oq.warn(`${d.name} is a standard space and supported in the CSS spec. Use color(${g.id}) instead of prefixed color(${a}).`),{spaceId:d.id,coords:e,alpha:f}}}let g="",h=a in Oz.registry?a:d;if(h in Oz.registry){let a=Oz.registry[h].formats?.color?.id;a&&(g=`Did you mean color(${a})?`)}throw TypeError(`Cannot parse color(${a}). `+(g||"Missing a plugin?"))}for(let d of Oz.all){let e=d.getFormat(a);if(e&&"function"===e.type){let f=1;(e.lastAlpha||Oe(c.parsed.args).alpha)&&(f=c.parsed.args.pop());let g=c.parsed.args,h;return e.coordGrammar&&(h=Ov(d,e,a,g)),b&&Object.assign(b,{formatId:e.name,types:h}),{spaceId:d.id,coords:g,alpha:f}}}}else for(let a of Oz.all)for(let d in a.formats){let e=a.formats[d];if("custom"!==e.type||e.test&&!e.test(c.str))continue;let f=e.parse(c.str);if(f)return f.alpha??(f.alpha=1),b&&(b.formatId=d),f}throw TypeError(`Could not parse ${a} as a color. Missing a plugin?`)}function Ox(a){if(Array.isArray(a))return a.map(Ox);if(!a)throw TypeError("Empty color reference");N6(a)&&(a=Ow(a));let b=a.space||a.spaceId;return b instanceof Oz||(a.space=Oz.get(b)),void 0===a.alpha&&(a.alpha=1),a}var Oy,Oz=(y(Oy=class{constructor(a){this.id=a.id,this.name=a.name,this.base=a.base?Oy.get(a.base):null,this.aliases=a.aliases,this.base&&(this.fromBase=a.fromBase,this.toBase=a.toBase);let b=a.coords??this.base.coords;for(let a in b)"name"in b[a]||(b[a].name=a);for(let c in this.coords=b,this.white=Os(a.white??this.base.white??"D65"),this.formats=a.formats??{},this.formats){let a=this.formats[c];a.type||(a.type="function"),a.name||(a.name=c)}this.formats.color?.id||(this.formats.color={...this.formats.color??{},id:a.cssId||this.id}),a.gamutSpace?this.gamutSpace="self"===a.gamutSpace?this:Oy.get(a.gamutSpace):this.isPolar?this.gamutSpace=this.base:this.gamutSpace=this,this.gamutSpace.isUnbounded&&(this.inGamut=(a,b)=>!0),this.referred=a.referred,Object.defineProperty(this,"path",{value:(function(a){let b=[a];for(let c=a;c=c.base;)b.push(c);return b})(this).reverse(),writable:!1,enumerable:!0,configurable:!0}),Op.run("colorspace-init-end",this)}inGamut(a,{epsilon:b=75e-6}={}){if(!this.equals(this.gamutSpace))return a=this.to(this.gamutSpace,a),this.gamutSpace.inGamut(a,{epsilon:b});let c=Object.values(this.coords);return a.every((a,d)=>{let e=c[d];if("angle"!==e.type&&e.range){if(Number.isNaN(a))return!0;let[c,d]=e.range;return(void 0===c||a>=c-b)&&(void 0===d||a<=d+b)}return!0})}get isUnbounded(){return Object.values(this.coords).every(a=>!("range"in a))}get cssId(){return this.formats?.color?.id||this.id}get isPolar(){for(let a in this.coords)if("angle"===this.coords[a].type)return!0;return!1}getFormat(a){let b;return"object"==typeof a?a=OA(a,this):(b="default"===a?Object.values(this.formats)[0]:this.formats[a])?b=OA(b,this):null}equals(a){return!!a&&(this===a||this.id===a||this.id===a.id)}to(a,b){if(1==arguments.length){let c=Ox(a);[a,b]=[c.space,c.coords]}if(a=Oy.get(a),this.equals(a))return b;b=b.map(a=>Number.isNaN(a)?0:a);let c=this.path,d=a.path,e,f;for(let a=0;a<c.length&&c[a].equals(d[a]);a++)e=c[a],f=a;if(!e)throw Error(`Cannot convert between color spaces ${this} and ${a}: no connection space was found`);for(let a=c.length-1;a>f;a--)b=c[a].toBase(b);for(let a=f+1;a<d.length;a++)b=d[a].fromBase(b);return b}from(a,b){if(1==arguments.length){let c=Ox(a);[a,b]=[c.space,c.coords]}return(a=Oy.get(a)).to(this,b)}toString(){return`${this.name} (${this.id})`}getMinCoords(){let a=[];for(let b in this.coords){let c=this.coords[b],d=c.range||c.refRange;a.push(d?.min??0)}return a}static get all(){return[...new Set(Object.values(Oy.registry))]}static register(a,b){if(1==arguments.length&&(b=arguments[0],a=b.id),b=this.get(b),this.registry[a]&&this.registry[a]!==b)throw Error(`Duplicate color space registration: '${a}'`);if(this.registry[a]=b,1==arguments.length&&b.aliases)for(let a of b.aliases)this.register(a,b);return b}static get(a,...b){if(!a||a instanceof Oy)return a;if("string"===N7(a)){let b=Oy.registry[a.toLowerCase()];if(!b)throw TypeError(`No color space found with id = "${a}"`);return b}if(b.length)return Oy.get(...b);throw TypeError(`${a} is not a valid color space`)}static resolveCoord(a,b){let c=N7(a),d,e;if("string"===c?a.includes(".")?[d,e]=a.split("."):[d,e]=[,a]:Array.isArray(a)?[d,e]=a:(d=a.space,e=a.coordId),(d=Oy.get(d))||(d=b),!d)throw TypeError(`Cannot resolve coordinate reference ${a}: No color space specified and relative references are not allowed here`);if("number"===(c=N7(e))||"string"===c&&e>=0){let a=Object.entries(d.coords)[e];if(a)return{space:d,id:a[0],index:e,...a[1]}}d=Oy.get(d);let f=e.toLowerCase(),g=0;for(let a in d.coords){let b=d.coords[a];if(a.toLowerCase()===f||b.name?.toLowerCase()===f)return{space:d,id:a,index:g,...b};g++}throw TypeError(`No "${e}" coordinate found in ${d.name}. Its coordinates are: ${Object.keys(d.coords).join(", ")}`)}},"registry",{}),y(Oy,"DEFAULT_FORMAT",{type:"functions",name:"color"}),Oy);function OA(a,{coords:b}={}){if(a.coords&&!a.coordGrammar){a.type||(a.type="function"),a.name||(a.name="color"),a.coordGrammar=Oi(a.coords);let c=Object.entries(b).map(([b,c],d)=>{let e=a.coordGrammar[d][0],f=c.range||c.refRange,g=e.range,h="";return"<percentage>"==e?(g=[0,100],h="%"):"<angle>"==e&&(h="deg"),{fromRange:f,toRange:g,suffix:h}});a.serializeCoords=(a,b)=>a.map((a,d)=>{let{fromRange:e,toRange:f,suffix:g}=c[d];return e&&f&&(a=Oh(e,f,a)),a=N8(a,{precision:b,unit:g})})}return a}var OB=new Oz({id:"xyz-d65",name:"XYZ D65",coords:{x:{name:"X"},y:{name:"Y"},z:{name:"Z"}},white:"D65",formats:{color:{ids:["xyz-d65","xyz"]}},aliases:["xyz"]}),OC=class extends Oz{constructor(a){a.coords||(a.coords={r:{range:[0,1],name:"Red"},g:{range:[0,1],name:"Green"},b:{range:[0,1],name:"Blue"}}),a.base||(a.base=OB),a.toXYZ_M&&a.fromXYZ_M&&(a.toBase??(a.toBase=b=>{let c=N5(a.toXYZ_M,b);return this.white!==this.base.white&&(c=Ot(this.white,this.base.white,c)),c}),a.fromBase??(a.fromBase=b=>(b=Ot(this.base.white,this.white,b),N5(a.fromXYZ_M,b)))),a.referred??(a.referred="display"),super(a)}};function OD(a,b){return a=Ox(a),!b||a.space.equals(b)?a.coords.slice():(b=Oz.get(b)).from(a)}function OE(a,b){a=Ox(a);let{space:c,index:d}=Oz.resolveCoord(b,a.space);return OD(a,c)[d]}function OF(a,b,c){return a=Ox(a),b=Oz.get(b),a.coords=b.to(a.space,c),a}function OG(a,b,c){if(a=Ox(a),2==arguments.length&&"object"===N7(arguments[1])){let b=arguments[1];for(let c in b)OG(a,c,b[c])}else{"function"==typeof c&&(c=c(OE(a,b)));let{space:d,index:e}=Oz.resolveCoord(b,a.space),f=OD(a,d);f[e]=c,OF(a,d,f)}return a}OF.returns="color",OG.returns="color";var OH=new Oz({id:"xyz-d50",name:"XYZ D50",white:"D50",base:OB,fromBase:a=>Ot(OB.white,"D50",a),toBase:a=>Ot("D50",OB.white,a)}),OI=216/24389,OJ=24/116,OK=24389/27,OL=Or.D50,OM=new Oz({id:"lab",name:"Lab",coords:{l:{refRange:[0,100],name:"Lightness"},a:{refRange:[-125,125]},b:{refRange:[-125,125]}},white:OL,base:OH,fromBase(a){let b=a.map((a,b)=>a/OL[b]).map(a=>a>OI?Math.cbrt(a):(OK*a+16)/116);return[116*b[1]-16,500*(b[0]-b[1]),200*(b[1]-b[2])]},toBase(a){let b=[];return b[1]=(a[0]+16)/116,b[0]=a[1]/500+b[1],b[2]=b[1]-a[2]/200,[b[0]>OJ?b[0]**3:(116*b[0]-16)/OK,a[0]>8?((a[0]+16)/116)**3:a[0]/OK,b[2]>OJ?b[2]**3:(116*b[2]-16)/OK].map((a,b)=>a*OL[b])},formats:{lab:{coords:["<number> | <percentage>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}});function ON(a){return(a%360+360)%360}var OO=new Oz({id:"lch",name:"LCH",coords:{l:{refRange:[0,100],name:"Lightness"},c:{refRange:[0,150],name:"Chroma"},h:{refRange:[0,360],type:"angle",name:"Hue"}},base:OM,fromBase(a){let[b,c,d]=a,e;return e=.02>Math.abs(c)&&.02>Math.abs(d)?NaN:180*Math.atan2(d,c)/Math.PI,[b,Math.sqrt(c**2+d**2),ON(e)]},toBase(a){let[b,c,d]=a;return c<0&&(c=0),isNaN(d)&&(d=0),[b,c*Math.cos(d*Math.PI/180),c*Math.sin(d*Math.PI/180)]},formats:{lch:{coords:["<number> | <percentage>","<number> | <percentage>","<number> | <angle>"]}}}),OP=Math.PI,OQ=180/OP,OR=OP/180;function OS(a){let b=a*a;return b*b*b*a}function OT(a,b,{kL:c=1,kC:d=1,kH:e=1}={}){[a,b]=Ox([a,b]);let[f,g,h]=OM.from(a),i=OO.from(OM,[f,g,h])[1],[j,k,l]=OM.from(b),m=OO.from(OM,[j,k,l])[1];i<0&&(i=0),m<0&&(m=0);let n=OS((i+m)/2),o=.5*(1-Math.sqrt(n/(n+0x16bcc41e9))),p=(1+o)*g,q=(1+o)*k,r=Math.sqrt(p**2+h**2),s=Math.sqrt(q**2+l**2),t=0===p&&0===h?0:Math.atan2(h,p),u=0===q&&0===l?0:Math.atan2(l,q);t<0&&(t+=2*OP),u<0&&(u+=2*OP),t*=OQ;let v=j-f,w=s-r,x=(u*=OQ)-t,y=t+u,z=Math.abs(x),A;r*s==0?A=0:z<=180?A=x:x>180?A=x-360:x<-180?A=x+360:Oq.warn("the unthinkable has happened");let B=2*Math.sqrt(s*r)*Math.sin(A*OR/2),C=(f+j)/2,D=(r+s)/2,E=OS(D),F,G=(C-50)**2,H=1+.015*G/Math.sqrt(20+G),I=1+.045*D,J,K=1+.015*D*(J=1-.17*Math.cos(((F=r*s==0?y:z<=180?y/2:y<360?(y+360)/2:(y-360)/2)-30)*OR)+(.24*Math.cos(2*F*OR)+.32*Math.cos((3*F+6)*OR))-.2*Math.cos((4*F-63)*OR)),L=(v/(c*H))**2;return Math.sqrt(L+=(w/(d*I))**2+(B/(e*K))**2+w/(d*I)*(-1*Math.sin(2*(30*Math.exp(-1*((F-275)/25)**2))*OR)*(2*Math.sqrt(E/(E+0x16bcc41e9))))*(B/(e*K)))}var OU=[[.819022437996703,.3619062600528904,-.1288737815209879],[.0329836539323885,.9292868615863434,.0361446663506424],[.0481771893596242,.2642395317527308,.6335478284694309]],OV=[[1.2268798758459243,-.5578149944602171,.2813910456659647],[-.0405757452148008,1.112286803280317,-.0717110580655164],[-.0763729366746601,-.4214933324022432,1.5869240198367816]],OW=[[.210454268309314,.7936177747023054,-.0040720430116193],[1.9779985324311684,-2.42859224204858,.450593709617411],[.0259040424655478,.7827717124575296,-.8086757549230774]],OX=[[1,.3963377773761749,.2158037573099136],[1,-.1055613458156586,-.0638541728258133],[1,-.0894841775298119,-1.2914855480194092]],OY=new Oz({id:"oklab",name:"Oklab",coords:{l:{refRange:[0,1],name:"Lightness"},a:{refRange:[-.4,.4]},b:{refRange:[-.4,.4]}},white:"D65",base:OB,fromBase:a=>N5(OW,N5(OU,a).map(a=>Math.cbrt(a))),toBase:a=>N5(OV,N5(OX,a).map(a=>a**3)),formats:{oklab:{coords:["<percentage> | <number>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}});function OZ(a,b){[a,b]=Ox([a,b]);let[c,d,e]=OY.from(a),[f,g,h]=OY.from(b);return Math.sqrt((c-f)**2+(d-g)**2+(e-h)**2)}function O$(a,b,{epsilon:c=75e-6}={}){a=Ox(a),b||(b=a.space),b=Oz.get(b);let d=a.coords;return b!==a.space&&(d=b.from(a)),b.inGamut(d,{epsilon:c})}function O_(a){return{space:a.space,coords:a.coords.slice(),alpha:a.alpha}}function O0(a,b,c="lab"){let d=(c=Oz.get(c)).from(a),e=c.from(b);return Math.sqrt(d.reduce((a,b,c)=>{let d=e[c];return isNaN(b)||isNaN(d)?a:a+(d-b)**2},0))}var O1=Math.PI/180,O2=new Oz({id:"xyz-abs-d65",cssId:"--xyz-abs-d65",name:"Absolute XYZ D65",coords:{x:{refRange:[0,9504.7],name:"Xa"},y:{refRange:[0,1e4],name:"Ya"},z:{refRange:[0,10888.3],name:"Za"}},base:OB,fromBase:a=>a.map(a=>Math.max(203*a,0)),toBase:a=>a.map(a=>Math.max(a/203,0))}),O3=2610/16384,O4=16384/2610,O5=1.7*2523/32,O6=32/(1.7*2523),O7=[[.41478972,.579999,.014648],[-.20151,1.120649,.0531008],[-.0166008,.2648,.6684799]],O8=[[1.9242264357876067,-1.0047923125953657,.037651404030618],[.35031676209499907,.7264811939316552,-.06538442294808501],[-.09098281098284752,-.3127282905230739,1.5227665613052603]],O9=[[.5,.5,0],[3.524,-4.066708,.542708],[.199076,1.096799,-1.295875]],Pa=[[1,.1386050432715393,.05804731615611886],[.9999999999999999,-.1386050432715393,-.05804731615611886],[.9999999999999998,-.09601924202631895,-.8118918960560388]],Pb=new Oz({id:"jzazbz",name:"Jzazbz",coords:{jz:{refRange:[0,1],name:"Jz"},az:{refRange:[-.5,.5]},bz:{refRange:[-.5,.5]}},base:O2,fromBase(a){let[b,c,d]=a,[e,f,g]=N5(O9,N5(O7,[1.15*b-(1.15-1)*d,.66*c-(.66-1)*b,d]).map(function(a){return((.8359375+18.8515625*(a/1e4)**O3)/(1+18.6875*(a/1e4)**O3))**O5}));return[.43999999999999995*e/(1+-.56*e)-16295499532821565e-27,f,g]},toBase(a){let[b,c,d]=a,[e,f,g]=N5(O8,N5(Pa,[(b+16295499532821565e-27)/(.43999999999999995- -.56*(b+16295499532821565e-27)),c,d]).map(function(a){return 1e4*((.8359375-a**O6)/(18.6875*a**O6-18.8515625))**O4})),h=(e+(1.15-1)*g)/1.15;return[h,(f+(.66-1)*h)/.66,g]},formats:{color:{coords:["<number> | <percentage>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}}),Pc=new Oz({id:"jzczhz",name:"JzCzHz",coords:{jz:{refRange:[0,1],name:"Jz"},cz:{refRange:[0,1],name:"Chroma"},hz:{refRange:[0,360],type:"angle",name:"Hue"}},base:Pb,fromBase(a){let[b,c,d]=a,e;return e=2e-4>Math.abs(c)&&2e-4>Math.abs(d)?NaN:180*Math.atan2(d,c)/Math.PI,[b,Math.sqrt(c**2+d**2),ON(e)]},toBase:a=>[a[0],a[1]*Math.cos(a[2]*Math.PI/180),a[1]*Math.sin(a[2]*Math.PI/180)]}),Pd=2413/128,Pe=2610/16384,Pf=2523/32,Pg=16384/2610,Ph=32/2523,Pi=[[.3592832590121217,.6976051147779502,-.035891593232029],[-.1920808463704993,1.100476797037432,.0753748658519118],[.0070797844607479,.0748396662186362,.8433265453898765]],Pj=[[.5,.5,0],[6610/4096,-13613/4096,7003/4096],[17933/4096,-17390/4096,-543/4096]],Pk=[[.9999999999999998,.0086090370379328,.111029625003026],[.9999999999999998,-.0086090370379328,-.1110296250030259],[.9999999999999998,.5600313357106791,-.3206271749873188]],Pl=[[2.0701522183894223,-1.3263473389671563,.2066510476294053],[.3647385209748072,.6805660249472273,-.0453045459220347],[-.0497472075358123,-.0492609666966131,1.1880659249923042]],Pm=new Oz({id:"ictcp",name:"ICTCP",coords:{i:{refRange:[0,1],name:"I"},ct:{refRange:[-.5,.5],name:"CT"},cp:{refRange:[-.5,.5],name:"CP"}},base:O2,fromBase:a=>{var b;return b=N5(Pi,a),N5(Pj,b.map(function(a){return((.8359375+Pd*(a/1e4)**Pe)/(1+18.6875*(a/1e4)**Pe))**Pf}))},toBase:a=>N5(Pl,N5(Pk,a).map(function(a){return 1e4*(Math.max(a**Ph-.8359375,0)/(Pd-18.6875*a**Ph))**Pg}))}),Pn=Or.D65,Po=2*Math.PI,Pp=[[.401288,.650173,-.051461],[-.250268,1.204414,.045854],[-.002079,.048952,.953127]],Pq=[[1.8620678550872327,-1.0112546305316843,.14918677544445175],[.38752654323613717,.6214474419314753,-.008973985167612518],[-.015841498849333856,-.03412293802851557,1.0499644368778496]],Pr=[[460,451,288],[460,-891,-261],[460,-220,-6300]],Ps={dark:[.8,.525,.8],dim:[.9,.59,.9],average:[1,.69,1]},Pt=[20.14,90,164.25,237.53,380.14],Pu=[.8,.7,1,1.2,.8],Pv=[0,100,200,300,400],Pw=180/Math.PI,Px=Math.PI/180;function Py(a,b){return a.map(a=>{let c=Ol(b*Math.abs(a)*.01,.42);return 400*Ok(c,a)/(c+27.13)})}function Pz(a,b,c,d,e){let f={};f.discounting=e,f.refWhite=a,f.surround=d;let g=a.map(a=>100*a);f.la=b,f.yb=c;let h=g[1],i=N5(Pp,g),j=(d=Ps[f.surround])[0];f.c=d[1],f.nc=d[2];let k=(1/(5*f.la+1))**4;f.fl=k*f.la+.1*(1-k)*(1-k)*Math.cbrt(5*f.la),f.flRoot=f.fl**.25,f.n=f.yb/h,f.z=1.48+Math.sqrt(f.n),f.nbb=.725*f.n**-.2,f.ncb=f.nbb;let l=Math.max(Math.min(j*(1-1/3.6*Math.exp((-f.la-42)/92)),1),0);f.dRgb=i.map(a=>Of(1,h/a,l)),f.dRgbInv=f.dRgb.map(a=>1/a);let m=Py(i.map((a,b)=>a*f.dRgb[b]),f.fl);return f.aW=f.nbb*(2*m[0]+m[1]+.05*m[2]),f}var PA=Pz(Pn,64/Math.PI*.2,20,"average",!1);function PB(a,b){var c;let d;if(!(void 0!==a.J^void 0!==a.Q))throw Error("Conversion requires one and only one: 'J' or 'Q'");if(!(void 0!==a.C^void 0!==a.M^void 0!==a.s))throw Error("Conversion requires one and only one: 'C', 'M' or 's'");if(!(void 0!==a.h^void 0!==a.H))throw Error("Conversion requires one and only one: 'h' or 'H'");if(0===a.J||0===a.Q)return[0,0,0];let e=0,f=Math.cos(e=void 0===a.h?function(a){let b=(a%400+400)%400,c=Math.floor(.01*b);b%=100;let[d,e]=Pt.slice(c,c+2),[f,g]=Pu.slice(c,c+2);return ON((b*(g*d-f*e)-100*d*g)/(b*(g-f)-100*g))}(a.H)*Px:ON(a.h)*Px),g=Math.sin(e),h=0;void 0===a.J?void 0!==a.Q&&(h=.25*b.c*a.Q/((b.aW+4)*b.flRoot)):h=.1*Ol(a.J,.5);let i=0;void 0===a.C?void 0===a.M?void 0!==a.s&&(i=4e-4*a.s**2*(b.aW+4)/b.c):i=a.M/b.flRoot/h:i=a.C/h;let j=Ol(i*(1.64-.29**b.n)**-.73,10/9),k=.25*(Math.cos(e+2)+3.8),l=b.aW*Ol(h,2/b.c/b.z),m=5e4/13*b.nc*b.ncb*k,n=l/b.nbb,o=23*(n+.305)*Om(j,23*m+j*(11*f+108*g));return N5(Pq,(c=N5(Pr,[n,o*f,o*g]).map(a=>a/1403),d=100/b.fl*2588.068098016295,c.map(a=>{let b=Math.abs(a);return Ok(d*Ol(b/(400-b),2.380952380952381),a)})).map((a,c)=>a*b.dRgbInv[c])).map(a=>a/100)}function PC(a,b){let c=Py(N5(Pp,a.map(a=>100*a)).map((a,c)=>a*b.dRgb[c]),b.fl),d=c[0]+(-12*c[1]+c[2])/11,e=(c[0]+c[1]-2*c[2])/9,f=(Math.atan2(e,d)%Po+Po)%Po,g=.25*(Math.cos(f+2)+3.8),h=Ol(5e4/13*b.nc*b.ncb*Om(g*Math.sqrt(d**2+e**2),c[0]+c[1]+1.05*c[2]+.305),.9)*(1.64-.29**b.n)**.73,i=Ol(b.nbb*(2*c[0]+c[1]+.05*c[2])/b.aW,.5*b.c*b.z),j=100*Ol(i,2),k=4/b.c*i*(b.aW+4)*b.flRoot,l=h*i,m=l*b.flRoot,n=ON(f*Pw),o=function(a){let b=ON(a);b<=Pt[0]&&(b+=360);let c=On(Pt,b)-1,[d,e]=Pt.slice(c,c+2),[f,g]=Pu.slice(c,c+2),h=Pv[c],i=(b-d)/f;return h+100*i/(i+(e-b)/g)}(n);return{J:j,C:l,h:n,s:50*Ol(b.c*h/(b.aW+4),.5),Q:k,M:m,H:o}}var PD=new Oz({id:"cam16-jmh",cssId:"--cam16-jmh",name:"CAM16-JMh",coords:{j:{refRange:[0,100],name:"J"},m:{refRange:[0,105],name:"Colorfulness"},h:{refRange:[0,360],type:"angle",name:"Hue"}},base:OB,fromBase(a){let b=PC(a,PA);return[b.J,b.M,b.h]},toBase:a=>PB({J:a[0],M:a[1],h:a[2]},PA)}),PE=Or.D65,PF=216/24389,PG=24389/27;function PH(a){return a>8?((a+16)/116)**3:a/PG}var PI=Pz(PE,200/Math.PI*PH(50),100*PH(50),"average",!1),PJ=new Oz({id:"hct",name:"HCT",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},c:{refRange:[0,145],name:"Colorfulness"},t:{refRange:[0,100],name:"Tone"}},base:OB,fromBase:a=>(function(a,b){var c;let d=116*((c=a[1])>PF?Math.cbrt(c):(PG*c+16)/116)-16;if(0===d)return[0,0,0];let e=PC(a,PI);return[ON(e.h),e.C,d]})(a),toBase:a=>(function(a,b){let[c,d,e]=a,f=[],g=0;if(0===e)return[0,0,0];let h=PH(e);g=e>0?.00379058511492914*e**2+.608983189401032*e+.9155088574762233:9514440756550361e-21*e**2+.08693057439788597*e-21.928975842194614;let i=0,j=1/0;for(;i<=15;){let a=Math.abs((f=PB({J:g,C:d,h:c},b))[1]-h);if(a<j){if(a<=2e-12)return f;j=a}g-=(f[1]-h)*g/(2*f[1]),i+=1}return PB({J:g,C:d,h:c},b)})(a,PI),formats:{color:{id:"--hct",coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"]}}}),PK=Math.PI/180;function PL(a){a[1]<0&&(a=PJ.fromBase(PJ.toBase(a)));let b=Math.log(Math.max(1+.0228*a[1]*PI.flRoot,1))/.0228,c=a[0]*PK,d=b*Math.cos(c),e=b*Math.sin(c);return[a[2],d,e]}var PM={deltaE76:function(a,b){return O0(a,b,"lab")},deltaECMC:function(a,b,{l:c=2,c:d=1}={}){[a,b]=Ox([a,b]);let[e,f,g]=OM.from(a),[,h,i]=OO.from(OM,[e,f,g]),[j,k,l]=OM.from(b),m=OO.from(OM,[j,k,l])[1];h<0&&(h=0),m<0&&(m=0);let n=e-j,o=h-m,p=f-k,q=g-l,r=.511;e>=16&&(r=.040975*e/(1+.01765*e));let s=.0638*h/(1+.0131*h)+.638;Number.isNaN(i)&&(i=0);let t=h**4,u=Math.sqrt(t/(t+1900)),v=(n/(c*r))**2;return Math.sqrt(v+=(o/(d*s))**2+(p**2+q**2-o**2)/(s*(u*(i>=164&&i<=345?.56+Math.abs(.2*Math.cos((i+168)*O1)):.36+Math.abs(.4*Math.cos((i+35)*O1)))+1-u))**2)},deltaE2000:OT,deltaEJz:function(a,b){[a,b]=Ox([a,b]);let[c,d,e]=Pc.from(a),[f,g,h]=Pc.from(b);Number.isNaN(e)&&Number.isNaN(h)?(e=0,h=0):Number.isNaN(e)?e=h:Number.isNaN(h)&&(h=e);let i=2*Math.sqrt(d*g)*Math.sin((e-h)/2*(Math.PI/180));return Math.sqrt((c-f)**2+(d-g)**2+i**2)},deltaEITP:function(a,b){[a,b]=Ox([a,b]);let[c,d,e]=Pm.from(a),[f,g,h]=Pm.from(b);return 720*Math.sqrt((c-f)**2+.25*(d-g)**2+(e-h)**2)},deltaEOK:OZ,deltaEHCT:function(a,b){[a,b]=Ox([a,b]);let[c,d,e]=PL(PJ.from(a)),[f,g,h]=PL(PJ.from(b));return Math.sqrt((c-f)**2+(d-g)**2+(e-h)**2)}},PN={hct:{method:"hct.c",jnd:2,deltaEMethod:"hct",blackWhiteClamp:{}},"hct-tonal":{method:"hct.c",jnd:0,deltaEMethod:"hct",blackWhiteClamp:{channel:"hct.t",min:0,max:100}}};function PO(a,{method:b=Oq.gamut_mapping,space:c,deltaEMethod:d="",jnd:e=2,blackWhiteClamp:f={}}={}){let g;if(a=Ox(a),N6(arguments[1])?c=arguments[1]:c||(c=a.space),O$(a,c=Oz.get(c),{epsilon:0}))return a;if("css"===b)g=function(a,{space:b}={}){a=Ox(a),b||(b=a.space),b=Oz.get(b);let c=Oz.get("oklch");if(b.isUnbounded)return PR(a,b);let d=PR(a,c),e=d.coords[0];if(e>=1){let c=PR(PP,b);return c.alpha=a.alpha,PR(c,b)}if(e<=0){let c=PR(PQ,b);return c.alpha=a.alpha,PR(c,b)}if(O$(d,b,{epsilon:0}))return PR(d,b);function f(a){let c=PR(a,b),d=Object.values(b.coords);return c.coords=c.coords.map((a,b)=>{if("range"in d[b]){let[c,e]=d[b].range;return Oj(c,a,e)}return a}),c}let g=0,h=d.coords[1],i=!0,j=O_(d),k=f(j),l=OZ(k,j);if(l<.02)return k;for(;h-g>1e-4;){let a=(g+h)/2;if(j.coords[1]=a,i&&O$(j,b,{epsilon:0}))g=a;else if((l=OZ(k=f(j),j))<.02){if(.02-l<1e-4)break;i=!1,g=a}else h=a}return k}(a,{space:c});else{if("clip"===b||O$(a,c))g=PR(a,c);else{Object.prototype.hasOwnProperty.call(PN,b)&&({method:b,jnd:e,deltaEMethod:d,blackWhiteClamp:f}=PN[b]);let i=OT;if(""!==d){for(let a in PM)if("deltae"+d.toLowerCase()===a.toLowerCase()){i=PM[a];break}}let j=PO(PR(a,c),{method:"clip",space:c});if(i(a,j)>e){var h;let d;if(3===Object.keys(f).length){let b=Oz.resolveCoord(f.channel),c=OE(PR(a,b.space),b.id);if(N9(c)&&(c=0),c>=f.max)return PR({space:"xyz-d65",coords:Or.D65},a.space);if(c<=f.min)return PR({space:"xyz-d65",coords:[0,0,0]},a.space)}let j=Oz.resolveCoord(b),k=j.space,l=j.id,m=PR(a,k);m.coords.forEach((a,b)=>{N9(a)&&(m.coords[b]=0)});let n=(j.range||j.refRange)[0],o=(d=(h=e)?Math.floor(Math.log10(Math.abs(h))):0,Math.max(parseFloat(`1e${d-2}`),1e-6)),p=n,q=OE(m,l);for(;q-p>o;){let a=O_(m);i(m,a=PO(a,{space:c,method:"clip"}))-e<o?p=OE(m,l):q=OE(m,l),OG(m,l,(p+q)/2)}g=PR(m,c)}else g=j}if("clip"===b||!O$(g,c,{epsilon:0})){let a=Object.values(c.coords).map(a=>a.range||[]);g.coords=g.coords.map((b,c)=>{let[d,e]=a[c];return void 0!==d&&(b=Math.max(d,b)),void 0!==e&&(b=Math.min(b,e)),b})}}return c!==a.space&&(g=PR(g,a.space)),a.coords=g.coords,a}PO.returns="color";var PP={space:OY,coords:[1,0,0]},PQ={space:OY,coords:[0,0,0]};function PR(a,b,{inGamut:c}={}){a=Ox(a);let d=(b=Oz.get(b)).from(a),e={space:b,coords:d,alpha:a.alpha};return c&&(e=PO(e,!0===c?void 0:c)),e}function PS(a,{precision:b=Oq.precision,format:c="default",inGamut:d=!0,...e}={}){let f;a=Ox(a);let g=c;c=a.space.getFormat(c)??a.space.getFormat("default")??Oz.DEFAULT_FORMAT;let h=a.coords.slice();if(d||(d=c.toGamut),d&&!O$(a)&&(h=PO(O_(a),!0===d?void 0:d).coords),"custom"===c.type)if(e.precision=b,c.serialize)f=c.serialize(h,a.alpha,e);else throw TypeError(`format ${g} can only be used to parse colors, not for serialization`);else{let d=c.name||"color";c.serializeCoords?h=c.serializeCoords(h,b):null!==b&&(h=h.map(a=>N8(a,{precision:b})));let e=[...h];if("color"===d){let b=c.id||c.ids?.[0]||a.space.id;e.unshift(b)}let g=a.alpha;null!==b&&(g=N8(g,{precision:b}));let i=a.alpha>=1||c.noAlpha?"":`${c.commas?",":" /"} ${g}`;f=`${d}(${e.join(c.commas?", ":" ")}${i})`}return f}PR.returns="color";var PT=new OC({id:"rec2020-linear",cssId:"--rec2020-linear",name:"Linear REC.2020",white:"D65",toXYZ_M:[[.6369580483012914,.14461690358620832,.1688809751641721],[.2627002120112671,.6779980715188708,.05930171646986196],[0,.028072693049087428,1.060985057710791]],fromXYZ_M:[[1.716651187971268,-.355670783776392,-.25336628137366],[-.666684351832489,1.616481236634939,.0157685458139111],[.017639857445311,-.042770613257809,.942103121235474]]}),PU=new OC({id:"rec2020",name:"REC.2020",base:PT,toBase:a=>a.map(function(a){return a<.08124285829863151?a/4.5:((a+1.09929682680944-1)/1.09929682680944)**(1/.45)}),fromBase:a=>a.map(function(a){return a>=.018053968510807?1.09929682680944*a**.45-(1.09929682680944-1):4.5*a})}),PV=new OC({id:"p3-linear",cssId:"--display-p3-linear",name:"Linear P3",white:"D65",toXYZ_M:[[.4865709486482162,.26566769316909306,.1982172852343625],[.2289745640697488,.6917385218365064,.079286914093745],[0,.04511338185890264,1.043944368900976]],fromXYZ_M:[[2.493496911941425,-.9313836179191239,-.40271078445071684],[-.8294889695615747,1.7626640603183463,.023624685841943577],[.03584583024378447,-.07617238926804182,.9568845240076872]]}),PW=[[3.2409699419045226,-1.537383177570094,-.4986107602930034],[-.9692436362808796,1.8759675015077202,.04155505740717559],[.05563007969699366,-.20397695888897652,1.0569715142428786]],PX=new OC({id:"srgb-linear",name:"Linear sRGB",white:"D65",toXYZ_M:[[.41239079926595934,.357584339383878,.1804807884018343],[.21263900587151027,.715168678767756,.07219231536073371],[.01933081871559182,.11919477979462598,.9505321522496607]],fromXYZ_M:PW}),PY={aliceblue:[240/255,248/255,1],antiquewhite:[250/255,235/255,215/255],aqua:[0,1,1],aquamarine:[127/255,1,212/255],azure:[240/255,1,1],beige:[245/255,245/255,220/255],bisque:[1,228/255,196/255],black:[0,0,0],blanchedalmond:[1,235/255,205/255],blue:[0,0,1],blueviolet:[138/255,43/255,226/255],brown:[165/255,42/255,42/255],burlywood:[222/255,184/255,135/255],cadetblue:[95/255,158/255,160/255],chartreuse:[127/255,1,0],chocolate:[210/255,105/255,30/255],coral:[1,127/255,80/255],cornflowerblue:[100/255,149/255,237/255],cornsilk:[1,248/255,220/255],crimson:[220/255,20/255,60/255],cyan:[0,1,1],darkblue:[0,0,139/255],darkcyan:[0,139/255,139/255],darkgoldenrod:[184/255,134/255,11/255],darkgray:[169/255,169/255,169/255],darkgreen:[0,100/255,0],darkgrey:[169/255,169/255,169/255],darkkhaki:[189/255,183/255,107/255],darkmagenta:[139/255,0,139/255],darkolivegreen:[85/255,107/255,47/255],darkorange:[1,140/255,0],darkorchid:[.6,50/255,.8],darkred:[139/255,0,0],darksalmon:[233/255,150/255,122/255],darkseagreen:[143/255,188/255,143/255],darkslateblue:[72/255,61/255,139/255],darkslategray:[47/255,79/255,79/255],darkslategrey:[47/255,79/255,79/255],darkturquoise:[0,206/255,209/255],darkviolet:[148/255,0,211/255],deeppink:[1,20/255,147/255],deepskyblue:[0,191/255,1],dimgray:[105/255,105/255,105/255],dimgrey:[105/255,105/255,105/255],dodgerblue:[30/255,144/255,1],firebrick:[178/255,34/255,34/255],floralwhite:[1,250/255,240/255],forestgreen:[34/255,139/255,34/255],fuchsia:[1,0,1],gainsboro:[220/255,220/255,220/255],ghostwhite:[248/255,248/255,1],gold:[1,215/255,0],goldenrod:[218/255,165/255,32/255],gray:[128/255,128/255,128/255],green:[0,128/255,0],greenyellow:[173/255,1,47/255],grey:[128/255,128/255,128/255],honeydew:[240/255,1,240/255],hotpink:[1,105/255,180/255],indianred:[205/255,92/255,92/255],indigo:[75/255,0,130/255],ivory:[1,1,240/255],khaki:[240/255,230/255,140/255],lavender:[230/255,230/255,250/255],lavenderblush:[1,240/255,245/255],lawngreen:[124/255,252/255,0],lemonchiffon:[1,250/255,205/255],lightblue:[173/255,216/255,230/255],lightcoral:[240/255,128/255,128/255],lightcyan:[224/255,1,1],lightgoldenrodyellow:[250/255,250/255,210/255],lightgray:[211/255,211/255,211/255],lightgreen:[144/255,238/255,144/255],lightgrey:[211/255,211/255,211/255],lightpink:[1,182/255,193/255],lightsalmon:[1,160/255,122/255],lightseagreen:[32/255,178/255,170/255],lightskyblue:[135/255,206/255,250/255],lightslategray:[119/255,136/255,.6],lightslategrey:[119/255,136/255,.6],lightsteelblue:[176/255,196/255,222/255],lightyellow:[1,1,224/255],lime:[0,1,0],limegreen:[50/255,205/255,50/255],linen:[250/255,240/255,230/255],magenta:[1,0,1],maroon:[128/255,0,0],mediumaquamarine:[.4,205/255,170/255],mediumblue:[0,0,205/255],mediumorchid:[186/255,85/255,211/255],mediumpurple:[147/255,112/255,219/255],mediumseagreen:[60/255,179/255,113/255],mediumslateblue:[123/255,104/255,238/255],mediumspringgreen:[0,250/255,154/255],mediumturquoise:[72/255,209/255,.8],mediumvioletred:[199/255,21/255,133/255],midnightblue:[25/255,25/255,112/255],mintcream:[245/255,1,250/255],mistyrose:[1,228/255,225/255],moccasin:[1,228/255,181/255],navajowhite:[1,222/255,173/255],navy:[0,0,128/255],oldlace:[253/255,245/255,230/255],olive:[128/255,128/255,0],olivedrab:[107/255,142/255,35/255],orange:[1,165/255,0],orangered:[1,69/255,0],orchid:[218/255,112/255,214/255],palegoldenrod:[238/255,232/255,170/255],palegreen:[152/255,251/255,152/255],paleturquoise:[175/255,238/255,238/255],palevioletred:[219/255,112/255,147/255],papayawhip:[1,239/255,213/255],peachpuff:[1,218/255,185/255],peru:[205/255,133/255,63/255],pink:[1,192/255,203/255],plum:[221/255,160/255,221/255],powderblue:[176/255,224/255,230/255],purple:[128/255,0,128/255],rebeccapurple:[.4,.2,.6],red:[1,0,0],rosybrown:[188/255,143/255,143/255],royalblue:[65/255,105/255,225/255],saddlebrown:[139/255,69/255,19/255],salmon:[250/255,128/255,114/255],sandybrown:[244/255,164/255,96/255],seagreen:[46/255,139/255,87/255],seashell:[1,245/255,238/255],sienna:[160/255,82/255,45/255],silver:[192/255,192/255,192/255],skyblue:[135/255,206/255,235/255],slateblue:[106/255,90/255,205/255],slategray:[112/255,128/255,144/255],slategrey:[112/255,128/255,144/255],snow:[1,250/255,250/255],springgreen:[0,1,127/255],steelblue:[70/255,130/255,180/255],tan:[210/255,180/255,140/255],teal:[0,128/255,128/255],thistle:[216/255,191/255,216/255],tomato:[1,99/255,71/255],turquoise:[64/255,224/255,208/255],violet:[238/255,130/255,238/255],wheat:[245/255,222/255,179/255],white:[1,1,1],whitesmoke:[245/255,245/255,245/255],yellow:[1,1,0],yellowgreen:[154/255,205/255,50/255]},PZ=[,,,].fill("<percentage> | <number>[0, 255]"),P$=[,,,].fill("<number>[0, 255]"),P_=new OC({id:"srgb",name:"sRGB",base:PX,fromBase:a=>a.map(a=>{let b=a<0?-1:1,c=a*b;return c>.0031308?b*(1.055*c**(1/2.4)-.055):12.92*a}),toBase:a=>a.map(a=>{let b=a<0?-1:1,c=a*b;return c<=.04045?a/12.92:b*((c+.055)/1.055)**2.4}),formats:{rgb:{coords:PZ},rgb_number:{name:"rgb",commas:!0,coords:P$,noAlpha:!0},color:{},rgba:{coords:PZ,commas:!0,lastAlpha:!0},rgba_number:{name:"rgba",commas:!0,coords:P$},hex:{type:"custom",toGamut:!0,test:a=>/^#([a-f0-9]{3,4}){1,2}$/i.test(a),parse(a){a.length<=5&&(a=a.replace(/[a-f0-9]/gi,"$&$&"));let b=[];return a.replace(/[a-f0-9]{2}/gi,a=>{b.push(parseInt(a,16)/255)}),{spaceId:"srgb",coords:b.slice(0,3),alpha:b.slice(3)[0]}},serialize:(a,b,{collapse:c=!0}={})=>{b<1&&a.push(b),a=a.map(a=>Math.round(255*a));let d=c&&a.every(a=>a%17==0);return"#"+a.map(a=>d?(a/17).toString(16):a.toString(16).padStart(2,"0")).join("")}},keyword:{type:"custom",test:a=>/^[a-z]+$/i.test(a),parse(a){a=a.toLowerCase();let b={spaceId:"srgb",coords:null,alpha:1};if("transparent"===a?(b.coords=PY.black,b.alpha=0):b.coords=PY[a],b.coords)return b}}}}),P0=new OC({id:"p3",cssId:"display-p3",name:"P3",base:PV,fromBase:P_.fromBase,toBase:P_.toBase});if(Oq.display_space=P_,"u">typeof CSS&&CSS.supports)for(let a of[OM,PU,P0]){let b=PS({space:a,coords:a.getMinCoords(),alpha:1});if(CSS.supports("color",b)){Oq.display_space=a;break}}function P1(a){return OE(a,[OB,"y"])}function P2(a,b){OG(a,[OB,"y"],b)}var P3=Object.freeze({__proto__:null,getLuminance:P1,register:function(a){Object.defineProperty(a.prototype,"luminance",{get(){return P1(this)},set(a){P2(this,a)}})},setLuminance:P2});function P4(a){return a>=.022?a:a+(.022-a)**1.414}function P5(a){return(a<0?-1:1)*Math.abs(a)**2.4}var P6=216/24389,P7=24/116,P8=24389/27,P9=Or.D65,Qa=new Oz({id:"lab-d65",name:"Lab D65",coords:{l:{refRange:[0,100],name:"Lightness"},a:{refRange:[-125,125]},b:{refRange:[-125,125]}},white:P9,base:OB,fromBase(a){let b=a.map((a,b)=>a/P9[b]).map(a=>a>P6?Math.cbrt(a):(P8*a+16)/116);return[116*b[1]-16,500*(b[0]-b[1]),200*(b[1]-b[2])]},toBase(a){let b=[];return b[1]=(a[0]+16)/116,b[0]=a[1]/500+b[1],b[2]=b[1]-a[2]/200,[b[0]>P7?b[0]**3:(116*b[0]-16)/P8,a[0]>8?((a[0]+16)/116)**3:a[0]/P8,b[2]>P7?b[2]**3:(116*b[2]-16)/P8].map((a,b)=>a*P9[b])},formats:{"lab-d65":{coords:["<number> | <percentage>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}}),Qb=2.23606797749979*.5+.5,Qc=Object.freeze({__proto__:null,contrastAPCA:function(a,b){let c,d,e,f;b=Ox(b),a=Ox(a),b=PR(b,"srgb"),[d,e,f]=b.coords;let g=.2126729*P5(d)+.7151522*P5(e)+.072175*P5(f);a=PR(a,"srgb"),[d,e,f]=a.coords;let h=.2126729*P5(d)+.7151522*P5(e)+.072175*P5(f),i=P4(g),j=P4(h);return 100*(.1>Math.abs(c=5e-4>Math.abs(j-i)?0:j>i?1.14*(j**.56-i**.57):1.14*(j**.65-i**.62))?0:c>0?c-.027:c+.027)},contrastDeltaPhi:function(a,b){a=Ox(a),b=Ox(b);let c=OE(a,[Qa,"l"]),d=OE(b,[Qa,"l"]),e=Math.abs(c**Qb-d**Qb)**(1/Qb)*Math.SQRT2-40;return e<7.5?0:e},contrastLstar:function(a,b){return a=Ox(a),b=Ox(b),Math.abs(OE(a,[OM,"l"])-OE(b,[OM,"l"]))},contrastMichelson:function(a,b){a=Ox(a),b=Ox(b);let c=Math.max(P1(a),0),d=Math.max(P1(b),0);d>c&&([c,d]=[d,c]);let e=c+d;return 0===e?0:(c-d)/e},contrastWCAG21:function(a,b){a=Ox(a),b=Ox(b);let c=Math.max(P1(a),0),d=Math.max(P1(b),0);return d>c&&([c,d]=[d,c]),(c+.05)/(d+.05)},contrastWeber:function(a,b){a=Ox(a),b=Ox(b);let c=Math.max(P1(a),0),d=Math.max(P1(b),0);return d>c&&([c,d]=[d,c]),0===d?5e4:(c-d)/d}});function Qd(a){let[b,c,d]=OD(a,OB),e=b+15*c+3*d;return[4*b/e,9*c/e]}function Qe(a){let[b,c,d]=OD(a,OB),e=b+c+d;return[b/e,c/e]}var Qf=Object.freeze({__proto__:null,register:function(a){Object.defineProperty(a.prototype,"uv",{get(){return Qd(this)}}),Object.defineProperty(a.prototype,"xy",{get(){return Qe(this)}})},uv:Qd,xy:Qe});function Qg(a,b,c={}){N6(c)&&(c={method:c});let{method:d=Oq.deltaE,...e}=c;for(let c in PM)if("deltae"+d.toLowerCase()===c.toLowerCase())return PM[c](a,b,e);throw TypeError(`Unknown deltaE method: ${d}`)}var Qh=Object.freeze({__proto__:null,darken:function(a,b=.25){return OG(a,[Oz.get("oklch","lch"),"l"],a=>a*(1-b))},lighten:function(a,b=.25){return OG(a,[Oz.get("oklch","lch"),"l"],a=>a*(1+b))}});function Qi(a,b,c=.5,d={}){return[a,b]=[Ox(a),Ox(b)],"object"===N7(c)&&([c,d]=[.5,c]),Qk(a,b,d)(c)}function Qj(a,b,c={}){let d;Ql(a)&&([d,c]=[a,b],[a,b]=d.rangeArgs.colors);let{maxDeltaE:e,deltaEMethod:f,steps:g=2,maxSteps:h=1e3,...i}=c;d||([a,b]=[Ox(a),Ox(b)],d=Qk(a,b,i));let j=Qg(a,b),k=e>0?Math.max(g,Math.ceil(j/e)+1):g,l=[];if(void 0!==h&&(k=Math.min(k,h)),1===k)l=[{p:.5,color:d(.5)}];else{let a=1/(k-1);l=Array.from({length:k},(b,c)=>{let e=c*a;return{p:e,color:d(e)}})}if(e>0){let a=l.reduce((a,b,c)=>0===c?0:Math.max(a,Qg(b.color,l[c-1].color,f)),0);for(;a>e;){a=0;for(let b=1;b<l.length&&l.length<h;b++){let c=l[b-1],e=l[b],f=(e.p+c.p)/2,g=d(f);a=Math.max(a,Qg(g,c.color),Qg(g,e.color)),l.splice(b,0,{p:f,color:d(f)}),b++}}}return l=l.map(a=>a.color)}function Qk(a,b,c={}){if(Ql(a)){let[c,d]=[a,b];return Qk(...c.rangeArgs.colors,{...c.rangeArgs.options,...d})}let{space:d,outputSpace:e,progression:f,premultiplied:g}=c;a=Ox(a),b=Ox(b),a=O_(a),b=O_(b);let h={colors:[a,b],options:c};if(d=d?Oz.get(d):Oz.registry[Oq.interpolationSpace]||a.space,e=e?Oz.get(e):d,a=PR(a,d),b=PR(b,d),a=PO(a),b=PO(b),d.coords.h&&"angle"===d.coords.h.type){let e=c.hue=c.hue||"shorter",f=[d,"h"],[g,h]=[OE(a,f),OE(b,f)];isNaN(g)&&!isNaN(h)?g=h:isNaN(h)&&!isNaN(g)&&(h=g),[g,h]=function(a,b){if("raw"===a)return b;let[c,d]=b.map(ON),e=d-c;return"increasing"===a?e<0&&(d+=360):"decreasing"===a?e>0&&(c+=360):"longer"===a?-180<e&&e<180&&(e>0?c+=360:d+=360):"shorter"===a&&(e>180?c+=360:e<-180&&(d+=360)),[c,d]}(e,[g,h]),OG(a,f,g),OG(b,f,h)}return g&&(a.coords=a.coords.map(b=>b*a.alpha),b.coords=b.coords.map(a=>a*b.alpha)),Object.assign(c=>{c=f?f(c):c;let h=a.coords.map((a,d)=>Of(a,b.coords[d],c)),i=Of(a.alpha,b.alpha,c),j={space:d,coords:h,alpha:i};return g&&(j.coords=j.coords.map(a=>a/i)),e!==d&&(j=PR(j,e)),j},{rangeArgs:h})}function Ql(a){return"function"===N7(a)&&!!a.rangeArgs}Oq.interpolationSpace="lab";var Qm=Object.freeze({__proto__:null,isRange:Ql,mix:Qi,range:Qk,register:function(a){a.defineFunction("mix",Qi,{returns:"color"}),a.defineFunction("range",Qk,{returns:"function<color>"}),a.defineFunction("steps",Qj,{returns:"array<color>"})},steps:Qj}),Qn=new Oz({id:"hsl",name:"HSL",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},l:{range:[0,100],name:"Lightness"}},base:P_,fromBase:a=>{let b=Math.max(...a),c=Math.min(...a),[d,e,f]=a,[g,h,i]=[NaN,0,(c+b)/2],j=b-c;if(0!==j){switch(h=0===i||1===i?0:(b-i)/Math.min(i,1-i),b){case d:g=(e-f)/j+6*(e<f);break;case e:g=(f-d)/j+2;break;case f:g=(d-e)/j+4}g*=60}return h<0&&(g+=180,h=Math.abs(h)),g>=360&&(g-=360),[g,100*h,100*i]},toBase:a=>{let[b,c,d]=a;function e(a){let e=(a+b/30)%12,f=c*Math.min(d,1-d);return d-f*Math.max(-1,Math.min(e-3,9-e,1))}return(b%=360)<0&&(b+=360),c/=100,d/=100,[e(0),e(8),e(4)]},formats:{hsl:{coords:["<number> | <angle>","<percentage>","<percentage>"]},hsla:{coords:["<number> | <angle>","<percentage>","<percentage>"],commas:!0,lastAlpha:!0}}}),Qo=new Oz({id:"hsv",name:"HSV",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},v:{range:[0,100],name:"Value"}},base:Qn,fromBase(a){let[b,c,d]=a,e=(d/=100)+(c/=100)*Math.min(d,1-d);return[b,0===e?0:200*(1-d/e),100*e]},toBase(a){let[b,c,d]=a,e=(d/=100)*(1-(c/=100)/2);return[b,0===e||1===e?0:(d-e)/Math.min(e,1-e)*100,100*e]},formats:{color:{id:"--hsv",coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"]}}}),Qp=new Oz({id:"hwb",name:"HWB",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},w:{range:[0,100],name:"Whiteness"},b:{range:[0,100],name:"Blackness"}},base:Qo,fromBase(a){let[b,c,d]=a;return[b,d*(100-c)/100,100-d]},toBase(a){let[b,c,d]=a,e=(c/=100)+(d/=100);if(e>=1)return[b,0,c/e*100];let f=1-d;return[b,(0===f?0:1-c/f)*100,100*f]},formats:{hwb:{coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"]}}}),Qq=new OC({id:"a98rgb-linear",cssId:"--a98-rgb-linear",name:"Linear Adobe® 98 RGB compatible",white:"D65",toXYZ_M:[[.5766690429101305,.1855582379065463,.1882286462349947],[.29734497525053605,.6273635662554661,.07529145849399788],[.02703136138641234,.07068885253582723,.9913375368376388]],fromXYZ_M:[[2.0415879038107465,-.5650069742788596,-.34473135077832956],[-.9692436362808795,1.8759675015077202,.04155505740717557],[.013444280632031142,-.11836239223101838,1.0151749943912054]]}),Qr=new OC({id:"a98rgb",cssId:"a98-rgb",name:"Adobe® 98 RGB compatible",base:Qq,toBase:a=>a.map(a=>Math.abs(a)**(563/256)*Math.sign(a)),fromBase:a=>a.map(a=>Math.abs(a)**(256/563)*Math.sign(a))}),Qs=new OC({id:"prophoto-linear",cssId:"--prophoto-rgb-linear",name:"Linear ProPhoto",white:"D50",base:OH,toXYZ_M:[[.7977666449006423,.13518129740053308,.0313477341283922],[.2880748288194013,.711835234241873,8993693872564e-17],[0,0,.8251046025104602]],fromXYZ_M:[[1.3457868816471583,-.25557208737979464,-.05110186497554526],[-.5446307051249019,1.5082477428451468,.02052744743642139],[0,0,1.2119675456389452]]}),Qt=1/512,Qu=16/512,Qv=new OC({id:"prophoto",cssId:"prophoto-rgb",name:"ProPhoto",base:Qs,toBase:a=>a.map(a=>a<Qu?a/16:a**1.8),fromBase:a=>a.map(a=>a>=Qt?a**(1/1.8):16*a)}),Qw=new Oz({id:"oklch",name:"Oklch",coords:{l:{refRange:[0,1],name:"Lightness"},c:{refRange:[0,.4],name:"Chroma"},h:{refRange:[0,360],type:"angle",name:"Hue"}},white:"D65",base:OY,fromBase(a){let[b,c,d]=a,e;return e=2e-4>Math.abs(c)&&2e-4>Math.abs(d)?NaN:180*Math.atan2(d,c)/Math.PI,[b,Math.sqrt(c**2+d**2),ON(e)]},toBase(a){let[b,c,d]=a,e,f;return isNaN(d)?(e=0,f=0):(e=c*Math.cos(d*Math.PI/180),f=c*Math.sin(d*Math.PI/180)),[b,e,f]},formats:{oklch:{coords:["<percentage> | <number>","<number> | <percentage>[0,1]","<number> | <angle>"]}}}),Qx=Or.D65,Qy=216/24389,Qz=24389/27,[QA,QB]=Qd({space:OB,coords:Qx}),QC=new Oz({id:"luv",name:"Luv",coords:{l:{refRange:[0,100],name:"Lightness"},u:{refRange:[-215,215]},v:{refRange:[-215,215]}},white:Qx,base:OB,fromBase(a){let b=[Oa(a[0]),Oa(a[1]),Oa(a[2])],c=b[1],[d,e]=Qd({space:OB,coords:b});if(!Number.isFinite(d)||!Number.isFinite(e))return[0,0,0];let f=c<=Qy?Qz*c:116*Math.cbrt(c)-16;return[f,13*f*(d-QA),13*f*(e-QB)]},toBase(a){let[b,c,d]=a;if(0===b||N9(b))return[0,0,0];c=Oa(c),d=Oa(d);let e=c/(13*b)+QA,f=d/(13*b)+QB,g=b<=8?b/Qz:((b+16)/116)**3;return[9*e/(4*f)*g,g,(12-3*e-20*f)/(4*f)*g]},formats:{color:{id:"--luv",coords:["<number> | <percentage>","<number> | <percentage>[-1,1]","<number> | <percentage>[-1,1]"]}}}),QD=new Oz({id:"lchuv",name:"LChuv",coords:{l:{refRange:[0,100],name:"Lightness"},c:{refRange:[0,220],name:"Chroma"},h:{refRange:[0,360],type:"angle",name:"Hue"}},base:QC,fromBase(a){let[b,c,d]=a,e;return e=.02>Math.abs(c)&&.02>Math.abs(d)?NaN:180*Math.atan2(d,c)/Math.PI,[b,Math.sqrt(c**2+d**2),ON(e)]},toBase(a){let[b,c,d]=a;return c<0&&(c=0),isNaN(d)&&(d=0),[b,c*Math.cos(d*Math.PI/180),c*Math.sin(d*Math.PI/180)]},formats:{color:{id:"--lchuv",coords:["<number> | <percentage>","<number> | <percentage>","<number> | <angle>"]}}}),QE=216/24389,QF=24389/27,QG=PW[0][0],QH=PW[0][1],QI=PW[0][2],QJ=PW[1][0],QK=PW[1][1],QL=PW[1][2],QM=PW[2][0],QN=PW[2][1],QO=PW[2][2];function QP(a,b,c){let d=b/(Math.sin(c)-a*Math.cos(c));return d<0?1/0:d}function QQ(a){let b=(a+16)**3/1560896,c=b>QE?b:a/QF,d=c*(284517*QG-94839*QI),e=c*(838422*QI+769860*QH+731718*QG),f=c*(632260*QI-126452*QH),g=c*(284517*QJ-94839*QL),h=c*(838422*QL+769860*QK+731718*QJ),i=c*(632260*QL-126452*QK),j=c*(284517*QM-94839*QO),k=c*(838422*QO+769860*QN+731718*QM),l=c*(632260*QO-126452*QN);return{r0s:d/f,r0i:e*a/f,r1s:d/(f+126452),r1i:(e-769860)*a/(f+126452),g0s:g/i,g0i:h*a/i,g1s:g/(i+126452),g1i:(h-769860)*a/(i+126452),b0s:j/l,b0i:k*a/l,b1s:j/(l+126452),b1i:(k-769860)*a/(l+126452)}}function QR(a,b){let c=b/360*Math.PI*2;return Math.min(QP(a.r0s,a.r0i,c),QP(a.r1s,a.r1i,c),QP(a.g0s,a.g0i,c),QP(a.g1s,a.g1i,c),QP(a.b0s,a.b0i,c),QP(a.b1s,a.b1i,c))}var QS=new Oz({id:"hsluv",name:"HSLuv",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},l:{range:[0,100],name:"Lightness"}},base:QD,gamutSpace:P_,fromBase(a){let[b,c,d]=[Oa(a[0]),Oa(a[1]),Oa(a[2])],e;return b>99.9999999?(e=0,b=100):b<1e-8?(e=0,b=0):e=c/QR(QQ(b),d)*100,[d,e,b]},toBase(a){let[b,c,d]=[Oa(a[0]),Oa(a[1]),Oa(a[2])],e;return d>99.9999999?(d=100,e=0):d<1e-8?(d=0,e=0):e=QR(QQ(d),b)/100*c,[d,e,b]},formats:{color:{id:"--hsluv",coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"]}}});function QT(a,b){return Math.abs(b)/Math.sqrt(a**2+1)}function QU(a){return Math.min(QT(a.r0s,a.r0i),QT(a.r1s,a.r1i),QT(a.g0s,a.g0i),QT(a.g1s,a.g1i),QT(a.b0s,a.b0i),QT(a.b1s,a.b1i))}PW[0][0],PW[0][1],PW[0][2],PW[1][0],PW[1][1],PW[1][2],PW[2][0],PW[2][1],PW[2][2];var QV=new Oz({id:"hpluv",name:"HPLuv",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},l:{range:[0,100],name:"Lightness"}},base:QD,gamutSpace:"self",fromBase(a){let[b,c,d]=[Oa(a[0]),Oa(a[1]),Oa(a[2])],e;return b>99.9999999?(e=0,b=100):b<1e-8?(e=0,b=0):e=c/QU(QQ(b))*100,[d,e,b]},toBase(a){let[b,c,d]=[Oa(a[0]),Oa(a[1]),Oa(a[2])],e;return d>99.9999999?(d=100,e=0):d<1e-8?(d=0,e=0):e=QU(QQ(d))/100*c,[d,e,b]},formats:{color:{id:"--hpluv",coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"]}}}),QW=2610/16384,QX=16384/2610,QY=32/2523,QZ=new OC({id:"rec2100pq",cssId:"rec2100-pq",name:"REC.2100-PQ",base:PT,toBase:a=>a.map(function(a){return(Math.max(a**QY-.8359375,0)/(18.8515625-18.6875*a**QY))**QX*1e4/203}),fromBase:a=>a.map(function(a){let b=Math.max(203*a/1e4,0);return((.8359375+18.8515625*b**QW)/(1+18.6875*b**QW))**78.84375})}),Q$=new OC({id:"rec2100hlg",cssId:"rec2100-hlg",name:"REC.2100-HLG",referred:"scene",base:PT,toBase:a=>a.map(function(a){return a<=.5?a**2/3*3.7743:(Math.exp((a-.55991073)/.17883277)+.28466892)/12*3.7743}),fromBase:a=>a.map(function(a){return(a/=3.7743)<=1/12?Math.sqrt(3*a):.17883277*Math.log(12*a-.28466892)+.55991073})}),Q_={};function Q0({id:a,toCone_M:b,fromCone_M:c}){Q_[a]=arguments[0]}function Q1(a,b,c="Bradford"){let d=Q_[c],[e,f,g]=N5(d.toCone_M,a),[h,i,j]=N5(d.toCone_M,b),k=N5([[h/e,0,0],[0,i/f,0],[0,0,j/g]],d.toCone_M);return N5(d.fromCone_M,k)}Op.add("chromatic-adaptation-start",a=>{a.options.method&&(a.M=Q1(a.W1,a.W2,a.options.method))}),Op.add("chromatic-adaptation-end",a=>{a.M||(a.M=Q1(a.W1,a.W2,a.options.method))}),Q0({id:"von Kries",toCone_M:[[.40024,.7076,-.08081],[-.2263,1.16532,.0457],[0,0,.91822]],fromCone_M:[[1.8599363874558397,-1.1293816185800916,.21989740959619328],[.3611914362417676,.6388124632850422,-6370596838649899e-21],[0,0,1.0890636230968613]]}),Q0({id:"Bradford",toCone_M:[[.8951,.2664,-.1614],[-.7502,1.7135,.0367],[.0389,-.0685,1.0296]],fromCone_M:[[.9869929054667121,-.14705425642099013,.15996265166373122],[.4323052697233945,.5183602715367774,.049291228212855594],[-.00852866457517732,.04004282165408486,.96848669578755]]}),Q0({id:"CAT02",toCone_M:[[.7328,.4296,-.1624],[-.7036,1.6975,.0061],[.003,.0136,.9834]],fromCone_M:[[1.0961238208355142,-.27886900021828726,.18274517938277307],[.4543690419753592,.4735331543074117,.07209780371722911],[-.009627608738429355,-.00569803121611342,1.0153256399545427]]}),Q0({id:"CAT16",toCone_M:[[.401288,.650173,-.051461],[-.250268,1.204414,.045854],[-.002079,.048952,.953127]],fromCone_M:[[1.862067855087233,-1.0112546305316845,.14918677544445172],[.3875265432361372,.6214474419314753,-.008973985167612521],[-.01584149884933386,-.03412293802851557,1.0499644368778496]]}),Object.assign(Or,{A:[1.0985,1,.35585],C:[.98074,1,1.18232],D55:[.95682,1,.92149],D75:[.94972,1,1.22638],E:[1,1,1],F2:[.99186,1,.67393],F7:[.95041,1,1.08747],F11:[1.00962,1,.6435]}),Or.ACES=[.32168/.33767,1,.34065/.33767];var Q2=new OC({id:"acescg",cssId:"--acescg",name:"ACEScg",coords:{r:{range:[0,65504],name:"Red"},g:{range:[0,65504],name:"Green"},b:{range:[0,65504],name:"Blue"}},referred:"scene",white:Or.ACES,toXYZ_M:[[.6624541811085053,.13400420645643313,.1561876870049078],[.27222871678091454,.6740817658111484,.05368951740793705],[-.005574649490394108,.004060733528982826,1.0103391003129971]],fromXYZ_M:[[1.6410233796943257,-.32480329418479,-.23642469523761225],[-.6636628587229829,1.6153315916573379,.016756347685530137],[.011721894328375376,-.008284441996237409,.9883948585390215]]}),Q3=(Math.log2(65504)+9.72)/17.52,Q4=Object.freeze({__proto__:null,A98RGB:Qr,A98RGB_Linear:Qq,ACEScc:new OC({id:"acescc",cssId:"--acescc",name:"ACEScc",coords:{r:{range:[-.35828683,Q3],name:"Red"},g:{range:[-.35828683,Q3],name:"Green"},b:{range:[-.35828683,Q3],name:"Blue"}},referred:"scene",base:Q2,toBase:a=>a.map(function(a){return a<=-.3013698630136986?(2**(17.52*a-9.72)-152587890625e-16)*2:a<Q3?2**(17.52*a-9.72):65504}),fromBase:a=>a.map(function(a){return a<=0?(Math.log2(152587890625e-16)+9.72)/17.52:a<152587890625e-16?(Math.log2(152587890625e-16+.5*a)+9.72)/17.52:(Math.log2(a)+9.72)/17.52})}),ACEScg:Q2,CAM16_JMh:PD,HCT:PJ,HPLuv:QV,HSL:Qn,HSLuv:QS,HSV:Qo,HWB:Qp,ICTCP:Pm,JzCzHz:Pc,Jzazbz:Pb,LCH:OO,LCHuv:QD,Lab:OM,Lab_D65:Qa,Luv:QC,OKLCH:Qw,OKLab:OY,P3:P0,P3_Linear:PV,ProPhoto:Qv,ProPhoto_Linear:Qs,REC_2020:PU,REC_2020_Linear:PT,REC_2100_HLG:Q$,REC_2100_PQ:QZ,XYZ_ABS_D65:O2,XYZ_D50:OH,XYZ_D65:OB,sRGB:P_,sRGB_Linear:PX}),Q5=class a{constructor(...a){let b,c,d,e;1===a.length&&(b=Ox(a[0])),b?(c=b.space||b.spaceId,d=b.coords,e=b.alpha):[c,d,e]=a,Object.defineProperty(this,"space",{value:Oz.get(c),writable:!1,enumerable:!0,configurable:!0}),this.coords=d?d.slice():[0,0,0],this.alpha=e>1||void 0===e?1:e<0?0:e;for(let a=0;a<this.coords.length;a++)"NaN"===this.coords[a]&&(this.coords[a]=NaN);for(let a in this.space.coords)Object.defineProperty(this,a,{get:()=>this.get(a),set:b=>this.set(a,b)})}get spaceId(){return this.space.id}clone(){return new a(this.space,this.coords,this.alpha)}toJSON(){return{spaceId:this.spaceId,coords:this.coords,alpha:this.alpha}}display(...b){let c=function(a,{space:b=Oq.display_space,...c}={}){let d=PS(a,c);if(typeof CSS>"u"||CSS.supports("color",d)||!Oq.display_space)(d=new String(d)).color=a;else{let e=a;if((a.coords.some(N9)||N9(a.alpha))&&!(Wq??(Wq=CSS.supports("color","hsl(none 50% 50%)")))&&((e=O_(a)).coords=e.coords.map(Oa),e.alpha=Oa(e.alpha),d=PS(e,c),CSS.supports("color",d)))return(d=new String(d)).color=e,d;(d=new String(PS(e=PR(e,b),c))).color=e}return d}(this,...b);return c.color=new a(c.color),c}static get(b,...c){return b instanceof a?b:new a(b,...c)}static defineFunction(b,c,d=c){let{instance:e=!0,returns:f}=d,g=function(...b){let d=c(...b);if("color"===f)d=a.get(d);else if("function<color>"===f){let b=d;Object.assign(d=function(...c){let d=b(...c);return a.get(d)},b)}else"array<color>"===f&&(d=d.map(b=>a.get(b)));return d};b in a||(a[b]=g),e&&(a.prototype[b]=function(...a){return g(this,...a)})}static defineFunctions(b){for(let c in b)a.defineFunction(c,b[c],b[c])}static extend(b){if(b.register)b.register(a);else for(let c in b)a.defineFunction(c,b[c])}};for(let a of(Q5.defineFunctions({get:OE,getAll:OD,set:OG,setAll:OF,to:PR,equals:function(a,b){return a=Ox(a),b=Ox(b),a.space===b.space&&a.alpha===b.alpha&&a.coords.every((a,c)=>a===b.coords[c])},inGamut:O$,toGamut:PO,distance:O0,toString:PS}),Object.assign(Q5,{util:Oo,hooks:Op,WHITES:Or,Space:Oz,spaces:Oz.registry,parse:Ow,defaults:Oq}),Object.keys(Q4)))Oz.register(Q4[a]);for(let a in Oz.registry)Q6(a,Oz.registry[a]);function Q6(a,b){let c=a.replace(/-/g,"_");Object.defineProperty(Q5.prototype,c,{get(){let c=this.getAll(a);return typeof Proxy>"u"?c:new Proxy(c,{has:(a,c)=>{try{return Oz.resolveCoord([b,c]),!0}catch{}return Reflect.has(a,c)},get:(a,c,d)=>{if(c&&"symbol"!=typeof c&&!(c in a)){let{index:d}=Oz.resolveCoord([b,c]);if(d>=0)return a[d]}return Reflect.get(a,c,d)},set:(c,d,e,f)=>{if(d&&"symbol"!=typeof d&&!(d in c)||d>=0){let{index:f}=Oz.resolveCoord([b,d]);if(f>=0)return c[f]=e,this.setAll(a,c),!0}return Reflect.set(c,d,e,f)}})},set(b){this.setAll(a,b)},configurable:!0,enumerable:!0})}Op.add("colorspace-init-end",a=>{Q6(a.id,a),a.aliases?.forEach(b=>{Q6(b,a)})}),Q5.extend(PM),Q5.extend({deltaE:Qg}),Object.assign(Q5,{deltaEMethods:PM}),Q5.extend(Qh),Q5.extend({contrast:function(a,b,c={}){N6(c)&&(c={algorithm:c});let{algorithm:d,...e}=c;if(!d){let a=Object.keys(Qc).map(a=>a.replace(/^contrast/,"")).join(", ");throw TypeError(`contrast() function needs a contrast algorithm. Please specify one of: ${a}`)}for(let c in a=Ox(a),b=Ox(b),Qc)if("contrast"+d.toLowerCase()===c.toLowerCase())return Qc[c](a,b,e);throw TypeError(`Unknown contrast algorithm: ${d}`)}}),Q5.extend(Qf),Q5.extend(P3),Q5.extend(Qm),Q5.extend(Qc),II();var{vec2:Q7,vec4:Q8}=IH;let Q9=a=>{let b=new Q5(a),c=b.to("p3-linear").coords,d=c[0],e=c[1],f=c[2],g=b.alpha;return{node:Q8(d,e,f,g),data:new Jv(d,e,f,g)}},Ra=a=>{let b=.5,c=.5,d=(a,b=!1)=>{if("number"==typeof a)return a;let c=a.toLowerCase().trim();if(b){if("top"===c)return 0;if("bottom"===c)return 1;if("center"===c)return .5}else{if("left"===c)return 0;if("right"===c)return 1;if("center"===c)return .5}return console.warn(`Invalid position value: ${a}. Defaulting to center.`),.5};if("string"==typeof a){let d=a.toLowerCase().trim().split(/\s+/);d.includes("left")?b=0:d.includes("right")?b=1:(d.includes("center")||1===d.length&&("top"===d[0]||"bottom"===d[0]))&&(b=.5),d.includes("top")?c=0:d.includes("bottom")?c=1:(d.includes("center")||1===d.length&&("left"===d[0]||"right"===d[0]))&&(c=.5),1===d.length&&"center"===d[0]&&(b=.5,c=.5)}else"object"==typeof a&&a?(b=d(a.x,!1),c=d(a.y,!0)):console.warn(`Invalid position value provided: ${a}. Defaulting to center.`);let e=1-c;return{node:Q7(b,e),data:new Jc(b,e)}},Rb=a=>{if("number"==typeof a)return(a%360+360)%360;let b=a.toLowerCase().trim();switch(b){case"to right":case"from left":return 0;case"to bottom":case"from top":return 90;case"to left":case"from right":return 180;case"to top":case"from bottom":return 270;case"to bottom right":case"to right bottom":case"from top left":return 45;case"to bottom left":case"to left bottom":case"from top right":return 135;case"to top left":case"to left top":case"from bottom right":return 225;case"to top right":case"to right top":case"from bottom left":return 315;default:let c=b.match(/^(-?\d*\.?\d+)(deg|rad|turn)?$/);if(c){let[,a,b="deg"]=c,d=parseFloat(a);switch(b){case"deg":default:return(d%360+360)%360;case"rad":return(180*d/Math.PI%360+360)%360;case"turn":return(360*d%360+360)%360}}return console.warn(`Invalid angle value: ${a}. Defaulting to 0 degrees.`),0}},Rc=a=>{let b={stretch:0,transparent:1,mirror:2,wrap:3}[a.toLowerCase()];return void 0===b?(console.warn(`Invalid edge mode: ${a}. Defaulting to 'stretch'.`),0):b},Rd=[{label:"Linear RGB",value:"linear"},{label:"OKLCh",value:"oklch"},{label:"OKLAB",value:"oklab"}],Re=a=>{let b={linear:0,oklch:1,oklab:2}[a.toLowerCase()];return void 0===b?(console.warn(`Invalid color space mode: ${a}. Defaulting to 'linear'.`),0):b};II();let Rf={name:"AngularBlur",category:"Blurs",requiresRTT:!0,requiresChild:!0,props:{intensity:{default:20,description:"Intensity of the angular blur effect",ui:{type:"range",min:0,max:100,step:1,label:"Blur Intensity"}},center:{default:{x:.5,y:.5},transform:Ra,description:"The center point of the rotation",ui:{type:"position",label:"Center Position"}}},fragmentNode:({uniforms:a,childNode:b,onCleanup:c})=>{let{vec2:d,vec4:e,float:f,screenUV:g,sin:h,cos:i,Fn:j,convertToTexture:k}=IH;if(!b)return e(0,0,0,0);let l=k(b);c(()=>{l?.renderTarget?.dispose&&l.renderTarget.dispose()});let m=d(a.center.uniform.x,a.center.uniform.y.oneMinus()),n=a.intensity.uniform.mul(.005);return j(()=>{let a=g.sub(m),b=e(0).toVar(),c=f(0).toVar(),j=n.div(f(31));for(let e=0;e<32;e++){let g=f(e).div(f(31)).sub(.5).mul(2),k=f(1).div(f(2.506628)).mul(f(-.5).mul(g).mul(g).div(f(.64)).exp()),n=j.mul(f(e)),o=i(n),p=h(n),q=d(a.x.mul(o).sub(a.y.mul(p)),a.x.mul(p).add(a.y.mul(o))).add(m),r=l.sample(q).mul(k);b.assign(b.add(r)),c.assign(c.add(k))}return b.div(c)})()}};II();let Rg={name:"Ascii",category:"Effects",requiresRTT:!0,requiresChild:!0,props:{characters:{default:"@%#*+=-:.",description:"Characters to use for ASCII effect (light to dark)",ui:{type:"text",label:"Characters"}},cellSize:{default:30,description:"Size of each ASCII character cell in pixels",ui:{type:"range",min:8,max:100,step:1,label:"Cell Size"}},fontFamily:{default:"JetBrains Mono",description:"Font family for characters",ui:{type:"select",options:[{label:"JetBrains Mono",value:"JetBrains Mono"},{label:"Fira Code",value:"Fira Code"},{label:"Source Code Pro",value:"Source Code Pro"},{label:"IBM Plex Mono",value:"IBM Plex Mono"},{label:"Space Mono",value:"Space Mono"},{label:"Roboto Mono",value:"Roboto Mono"},{label:"Courier Prime",value:"Courier Prime"}],label:"Font Family"}},spacing:{default:1,description:"Character size within each cell (1.0 = optimal size, 0.0 = smallest)",ui:{type:"range",min:0,max:1,step:.05,label:"Character Size"},transform:a=>.1+1.4*a}},fragmentNode:({uniforms:a,childNode:b,onCleanup:c,onBeforeRender:d})=>{let{vec2:e,vec3:f,vec4:g,floor:h,fract:i,dot:j,ceil:k,sqrt:l,screenUV:m,texture:n,viewportSize:o,convertToTexture:p}=IH;if(!b)return g(0,0,0,0);let q=p(b);c(()=>{q?.renderTarget?.dispose&&q.renderTarget.dispose()});let r={"JetBrains Mono":"JetBrains+Mono","Fira Code":"Fira+Code","Source Code Pro":"Source+Code+Pro","IBM Plex Mono":"IBM+Plex+Mono","Space Mono":"Space+Mono","Roboto Mono":"Roboto+Mono","Courier Prime":"Courier+Prime"},s=new Set;async function t(a){if(s.has(a)||!r[a])return;let b=r[a];if(!document.querySelector(`link[href*="${b}"]`)){let a=document.createElement("link");a.rel="stylesheet",a.href=`https://fonts.googleapis.com/css2?family=${b}:wght@400&display=swap`,document.head.appendChild(a)}try{if(document.fonts&&document.fonts.load){for(let b of[`400 12px "${a}"`,`12px "${a}"`,`400 12px ${a}`,`12px ${a}`])try{await document.fonts.load(b);break}catch{}await new Promise(a=>setTimeout(a,500)),s.add(a)}else await new Promise(a=>setTimeout(a,1e3)),s.add(a)}catch{}}let u=async(a,b,c,d)=>{if(!a||0===a.length)throw Error("Characters string cannot be empty");let e=a.length,f=Math.max(2,Math.ceil(Math.sqrt(e))),g=Math.min(128*Math.max(1,2/d),2048/f),h=.75*g,i=document.createElement("canvas");i.width=2048,i.height=2048;let j=i.getContext("2d");j.clearRect(0,0,i.width,i.height),j.fillStyle="#ffffff",j.font=`${h}px "${c}", ${c}, monospace`,j.font.includes(c)||j.font.includes("IBM")||j.font.includes("Plex")||(j.font=`${h}px ${c}, monospace`),j.textAlign="center",j.textBaseline="middle";for(let b=0;b<e;b++){let c=a[b],d=Math.floor(b/f),e=b%f*g+g/2,h=d*g+g/2;j.fillText(c,e,h)}return{data:new Uint8Array(j.getImageData(0,0,i.width,i.height).data),width:2048,height:2048,atlasSize:f,cellSize:b,charCount:e,characters:a,fontFamily:c,uvScale:f*g/2048}},v=Rg.props.characters.default,w=Rg.props.cellSize.default,x=Rg.props.fontFamily.default,y=Rg.props.spacing.transform?Rg.props.spacing.transform(Rg.props.spacing.default):Rg.props.spacing.default,z=a?.characters?.uniform?.value??v,A=a?.cellSize?.uniform?.value??w,B=a?.fontFamily?.uniform?.value??x,C=a?.spacing?.uniform?.value??y,D={data:new Uint8Array(4194304*4),cellSize:A,charCount:z.length,uvScale:1},E=new Lx(D.data,2048,2048,1023,1009);E.minFilter=1003,E.magFilter=1003,E.generateMipmaps=!1,E.needsUpdate=!0;let F=n(E),G=H$(D.charCount),H=H$(D.cellSize),I=H$(D.uvScale),J=z,K=A,L=B,M=C,N=async()=>{let b=a?.characters?.uniform?.value??J,c=a?.cellSize?.uniform?.value??K,d=a?.fontFamily?.uniform?.value??L,e=a?.spacing?.uniform?.value??M;D=await u(b,c,d,e),E.image.data=D.data,E.needsUpdate=!0,G.value=D.charCount,H.value=D.cellSize,I.value=D.uvScale,J=b,K=c,L=d,M=e};setTimeout(()=>{N().catch(a=>{console.error("Failed to initialize atlas:",a)}),t(a?.fontFamily?.uniform?.value??B).then(()=>{N().catch(a=>{console.error("Failed to update atlas with custom font:",a)})}).catch(a=>{console.error("Failed to load font:",a)})},0);let O=0,P=!1;d(()=>{let b=Date.now();if(b-O<16||P)return;let c=a.characters?.uniform?.value??J,d=a.cellSize?.uniform?.value??K,e=a.fontFamily?.uniform?.value??L,f=a.spacing?.uniform?.value??M;c&&0!==c.length&&(c!==J||d!==K||e!==L||f!==M)&&(O=b,P=!0,u(c,d,e,f).then(a=>{D=a,E.image.data=D.data,E.needsUpdate=!0,G.value=D.charCount,H.value=D.cellSize,I.value=D.uvScale,J=c,K=d,L=e,M=f,P=!1}).catch(a=>{console.error("Failed to update atlas:",a),P=!1}))}),c(()=>{E.dispose()});let Q=H.mul(1.5),R=o.div(Q),S=m.mul(R),T=h(S),U=i(S),V=a.spacing?.uniform??H$(C),W=e(.5),X=U.sub(W),Y=X.div(V).add(W),Z=zQ(Ck(zD(X),e(V.mul(.5)))),$=T.add(e(.5)).div(R),_=q.sample($),aa=h(j(_.rgb,f(.299,.587,.114)).mul(.8).add(.1).mul(G).min(G.sub(1e-4))),ab=k(l(G)),ac=aa.mod(ab),ad=h(aa.div(ab)),ae=BR(1).div(ab).mul(I),af=e(ac,ad).mul(ae).add(Y.mul(ae)),ag=F.sample(af),ah=j(ag.rgb,f(.299,.587,.114)).lessThan(.1);return g(ag.rgb.mul(_.rgb),Gx(Fl(ah,Z),BR(0),_.a))}};II();var{vec3:Rh,vec4:Ri,float:Rj,pow:Rk,sqrt:Rl,atan:Rm,cos:Rn,sin:Ro,mix:Rp}=IH,Rq=a=>Rh(a.x.mul(1.2249401).sub(a.y.mul(.2249404)).sub(a.z.mul(0)),a.x.mul(-.0420569).add(a.y.mul(1.0420571)).add(a.z.mul(0)),a.x.mul(-.0196376).sub(a.y.mul(.0786361)).add(a.z.mul(1.0982735))),Rr=a=>Rh(a.x.mul(.8224621).add(a.y.mul(.177538)).add(a.z.mul(0)),a.x.mul(.0331941).add(a.y.mul(.9668058)).add(a.z.mul(0)),a.x.mul(.0170826).add(a.y.mul(.0723974)).add(a.z.mul(.9105199))),Rs=a=>{let b=a.x,c=a.y,d=a.z,e=b.mul(.4122214708).add(c.mul(.5363325363)).add(d.mul(.0514459929)),f=b.mul(.2119034982).add(c.mul(.6806995451).add(d.mul(.1073969566))),g=b.mul(.0883024619).add(c.mul(.2817188376)).add(d.mul(.6299787005)),h=Rk(e,Rj(1/3)),i=Rk(f,Rj(1/3)),j=Rk(g,Rj(1/3));return Rh(h.mul(.2104542553).add(i.mul(.793617785)).sub(j.mul(.0040720468)),h.mul(1.9779984951).sub(i.mul(2.428592205)).add(j.mul(.4505937099)),h.mul(.0259040371).add(i.mul(.7827717662)).sub(j.mul(.808675766)))},Rt=a=>{let b=a.x,c=a.y,d=a.z,e=b.add(c.mul(.3963377774)).add(d.mul(.2158037573)),f=b.sub(c.mul(.1055613458)).sub(d.mul(.0638541728)),g=b.sub(c.mul(.0894841775)).sub(d.mul(1.291485548)),h=Rk(e,Rj(3)),i=Rk(f,Rj(3)),j=Rk(g,Rj(3));return Rh(h.mul(4.0767416621).sub(i.mul(3.3077115913)).add(j.mul(.2309699292)),h.mul(-1.2684380046).add(i.mul(2.6097574011)).sub(j.mul(.3413193965)),h.mul(-.0041960863).sub(i.mul(.7034186147)).add(j.mul(1.707614701)))},Ru=a=>{let b=a.x,c=a.y,d=a.z;return Rh(b,Rl(c.mul(c).add(d.mul(d))),Rm(d,c))};let Rv=(a,b,c,d)=>{var e;let f,g,h,i=Rh(a.x,a.y,a.z),j=Rh(b.x,b.y,b.z),k=a.w,l=b.w,m=Rp(i,j,c),n=Rq(i),o=Rq(j),p=Rs(n),q=Rs(o),r=Rr(Rt((f=(e=Rp(Ru(p),Ru(q),c)).x,g=e.y,h=e.z,Rh(f,g.mul(Rn(h)),g.mul(Ro(h)))))),s=Rr(Rt(Rp(p,q,c))),t=d.greaterThanEqual(Rj(.5)),u=d.greaterThanEqual(Rj(1.5)).select(s,t.select(r,m)),v=Rp(k,l,c);return Ri(u.x,u.y,u.z,v)};II();let Rw={name:"Blob",category:"Organic",props:{colorA:{default:"#ff6b35",transform:Q9,description:"Primary color of the blob",ui:{type:"color",label:"Color A"}},colorB:{default:"#e91e63",transform:Q9,description:"Secondary color of the blob",ui:{type:"color",label:"Color B"}},size:{default:.5,description:"Size of the blob",ui:{type:"range",min:0,max:1,step:.01,label:"Size"}},deformation:{default:.5,description:"How organic and blobby the shape is (0 = circle, 1 = very blobby)",ui:{type:"range",min:0,max:1,step:.01,label:"Deformation"}},softness:{default:.5,description:"Softness of the blob edges (combines edge width and transition curve)",ui:{type:"range",min:0,max:1,step:.01,label:"Softness"}},highlightIntensity:{default:.5,description:"Intensity of specular highlight effect",ui:{type:"range",min:0,max:1,step:.01,label:"Highlight Intensity"}},highlightX:{default:.3,description:"Light direction X component",ui:{type:"range",min:-1,max:1,step:.01,label:"Highlight X"}},highlightY:{default:-.3,description:"Light direction Y component",ui:{type:"range",min:-1,max:1,step:.01,label:"Highlight Y"}},highlightZ:{default:.4,description:"Light direction Z component",ui:{type:"range",min:-1,max:1,step:.01,label:"Highlight Z"}},highlightColor:{default:"#ffe11a",transform:Q9,description:"Color of the specular highlight",ui:{type:"color",label:"Highlight Color"}},speed:{default:.5,description:"Animation speed",ui:{type:"range",min:0,max:2,step:.1,label:"Speed"}},seed:{default:1,description:"Adjusts the starting state, useful for variation",ui:{type:"range",min:0,max:100,step:1,label:"Seed"}},center:{default:{x:.5,y:.5},transform:Ra,description:"The center point of the blob",ui:{type:"position",label:"Center Position"}},colorSpace:{default:"linear",transform:Re,description:"Color space for color interpolation",ui:{type:"select",options:Rd,label:"Color Space"}}},fragmentNode:a=>{let{uniforms:b}=a,{vec2:c,vec3:d,vec4:e,float:f,screenUV:g,smoothstep:h,sin:i,length:j,viewportSize:k,pow:l,max:m,normalize:n,dot:o,reflect:p}=IH,q=IS(a,b.speed,b.seed),r=b.colorA.uniform,s=b.colorB.uniform,t=b.size.uniform,u=b.deformation.uniform,v=b.softness.uniform,w=b.highlightIntensity.uniform,x=b.highlightX.uniform,y=b.highlightY.uniform,z=b.highlightZ.uniform,A=b.highlightColor.uniform,B=v.mul(f(.3)),C=v.mul(f(2)).add(f(.5)),D=f(.5),E=k.x.div(k.y),F=c(g.x.mul(E),g.y),G=c(b.center.uniform.x.mul(E),b.center.uniform.y.oneMinus()),H=F.sub(G),I=j(H),J=f(4),K=i(H.x.mul(J.mul(f(.8))).add(q.mul(f(.8)))).mul(i(H.y.mul(J.mul(f(.7))).add(q.mul(f(.6))))).add(i(H.x.mul(J.mul(f(1.2))).sub(H.y.mul(J.mul(f(.9))).add(q.mul(f(.4)))))).mul(f(.15)).mul(u),L=i(H.x.mul(J.mul(f(1.4))).sub(q.mul(f(.5)))).mul(i(H.y.mul(J.mul(f(1.1))).add(q.mul(f(.7))))).mul(f(.12)).mul(u).mul(h(f(.15),f(.25),D)),M=i(H.x.mul(J.mul(f(1.8))).add(H.y.mul(J.mul(f(1.6))).add(q.mul(f(.3))))).add(i(H.x.mul(J.mul(f(.6))).sub(q.mul(f(.9))))).mul(f(.1)).mul(u).mul(h(f(.3),f(.4),D)),N=i(H.x.mul(J.mul(f(2.2))).add(q.mul(f(.2)))).mul(i(H.y.mul(J.mul(f(1.9))).sub(q.mul(f(.8))))).mul(f(.08)).mul(u).mul(h(f(.45),f(.55),D)),O=i(H.x.mul(J.mul(f(2.8))).sub(H.y.mul(J.mul(f(2.4))).add(q.mul(f(.6))))).mul(f(.06)).mul(u).mul(h(f(.6),f(.7),D)),P=i(H.x.mul(J.mul(f(3.2))).add(q.mul(f(1.1)))).add(i(H.y.mul(J.mul(f(3.5))).sub(q.mul(f(.4))))).mul(f(.04)).mul(u).mul(h(f(.75),f(.85),D)),Q=K.add(L).add(M).add(N).add(O).add(P),R=t.add(Q),S=l(h(R.add(B),R.sub(B),I),C),T=j(H),U=h(f(0),R,T),V=f(1).sub(U.mul(f(.1))),W=n(d(H.x.mul(U.add(f(.2))),H.y.mul(U.add(f(.2))),V)),X=n(d(x,y,z)),Y=d(f(0),f(0),f(1)),Z=p(X.negate(),W),$=f(32),_=l(m(f(0),o(Z,Y)),$),aa=U.mul(f(.5)).add(f(.5)),ab=_.mul(aa).mul(w).mul(S),ac=H.x.mul(f(3)),ad=H.y.mul(f(3)),ae=i(ac.add(q.mul(f(.4)))).mul(i(ad.add(q.mul(f(.3))))).add(i(ac.mul(f(.7)).add(ad.mul(f(.8))).add(q.mul(f(.2))))).mul(f(.5)).add(f(.5)),af=i(ac.mul(f(1.3)).sub(q.mul(f(.5)))).mul(i(ad.mul(f(1.1)).add(q.mul(f(.6))))).add(i(ac.mul(f(.5)).sub(ad.mul(f(.6)).sub(q.mul(f(.3)))))).mul(f(.5)).add(f(.5)),ag=ae.mul(f(.6)).add(af.mul(f(.4))),ah=Rv(r,s,h(f(.1),f(.9),ag),b.colorSpace.uniform).rgb,ai=r.a.add(s.a).div(f(2)),aj=A.rgb.mul(ab);return e(ah.add(aj),ai.mul(S))}};II();let Rx={name:"Blur",category:"Blurs",requiresRTT:!0,requiresChild:!0,props:{intensity:{default:50,description:"Intensity of the blur effect",ui:{type:"range",min:0,max:100,step:1,label:"Intensity"}}},fragmentNode:({uniforms:a,childNode:b,onCleanup:c})=>{let{vec2:d,vec4:e,float:f,screenUV:g,convertToTexture:h,viewportSize:i,Fn:j}=IH;if(!b)return e(0,0,0,0);let k=h(b);c(()=>{k?.renderTarget?.dispose&&k.renderTarget.dispose()});let l=[.056,.135,.278,.487,.726,.923,1,.923,.726,.487,.278,.135,.056],m=a.intensity.uniform.mul(.06),n=h(j(()=>{let a=d(1).div(i),b=e(0).toVar();for(let c=-6;c<=6;c++){let e=f(l[c+6]/6.214),h=d(f(c),f(0)).mul(m).mul(a),i=g.add(h),j=k.sample(i).mul(e);b.assign(b.add(j))}return b})());return c(()=>{n?.renderTarget?.dispose&&n.renderTarget.dispose()}),j(()=>{let a=d(1).div(i),b=e(0).toVar();for(let c=-6;c<=6;c++){let e=f(l[c+6]/6.214),h=d(f(0),f(c)).mul(m).mul(a),i=g.add(h),j=n.sample(i).mul(e);b.assign(b.add(j))}return b})()}};II();let Ry={name:"Bulge",category:"Distortions",requiresRTT:!0,requiresChild:!0,props:{center:{default:{x:.5,y:.5},transform:Ra,description:"The center point of the bulge effect",ui:{type:"position",label:"Center"}},strength:{default:1,description:"The intensity of the bulge effect (positive = bulge out, negative = pinch in)",ui:{type:"range",min:-1,max:1,step:.01,label:"Strength"}},radius:{default:1,description:"The radius of the bulge effect area",ui:{type:"range",min:0,max:5,step:.01,label:"Radius"}},falloff:{default:.5,description:"Controls the smoothness of the transition (0 = hard edge, 1 = very smooth)",ui:{type:"range",min:0,max:1,step:.01,label:"Falloff"}},edges:{default:"stretch",description:"How to handle edges when distortion pushes content out of bounds",transform:Rc,ui:{type:"select",options:[{label:"Stretch",value:"stretch"},{label:"Transparent",value:"transparent"},{label:"Mirror",value:"mirror"},{label:"Wrap",value:"wrap"}],label:"Edges"}}},fragmentNode:({uniforms:a,childNode:b,onCleanup:c})=>{let{vec2:d,vec4:e,length:f,screenUV:g,viewportSize:h,convertToTexture:i,smoothstep:j}=IH;if(!b)return e(0,0,0,0);let k=i(b);c(()=>{k?.renderTarget?.dispose&&k.renderTarget.dispose()});let l=h.x.div(h.y),m=d(g.x.mul(l),g.y),n=d(a.center.uniform.x.mul(l),a.center.uniform.y.oneMinus()),o=m.sub(n),p=f(o),q=a.radius.uniform.mul(.5),r=a.falloff.uniform,s=j(q.mul(BR(1).sub(r).sub(BR(.001)).max(BR(0))),q,p).oneMinus(),t=p.div(q),u=t.mul(t),v=DP(BR(0),BR(1).sub(u)),w=s.mul(v),x=a.strength.uniform.negate().mul(w),y=BR(1).add(x),z=o.mul(y),A=n.add(z),B=d(A.x.div(l),A.y);return IR(B,k.sample(B),k,a.edges.uniform)}};II();let Rz={name:"ChannelBlur",category:"Blurs",requiresRTT:!0,requiresChild:!0,props:{redIntensity:{default:0,description:"Blur intensity for red channel",ui:{type:"range",min:0,max:100,step:1,label:"Red Intensity"}},greenIntensity:{default:20,description:"Blur intensity for green channel",ui:{type:"range",min:0,max:100,step:1,label:"Green Intensity"}},blueIntensity:{default:40,description:"Blur intensity for blue channel",ui:{type:"range",min:0,max:100,step:1,label:"Blue Intensity"}}},fragmentNode:({uniforms:a,childNode:b,onCleanup:c})=>{let{vec2:d,vec4:e,float:f,screenUV:g,convertToTexture:h,viewportSize:i,Fn:j}=IH;if(!b)return e(0,0,0,0);let k=h(b);c(()=>{k?.renderTarget?.dispose&&k.renderTarget.dispose()});let l=[.056,.135,.278,.487,.726,.923,1,.923,.726,.487,.278,.135,.056],m=a.redIntensity.uniform.mul(.1),n=a.greenIntensity.uniform.mul(.1),o=a.blueIntensity.uniform.mul(.1),p=h(j(()=>{let a=d(1).div(i),b=f(0).toVar(),c=f(0).toVar(),h=f(0).toVar();for(let e=-6;e<=6;e++){let i=f(l[e+6]/6.214),j=f(e).mul(a.x),p=d(j.mul(m),f(0)),q=d(j.mul(n),f(0)),r=d(j.mul(o),f(0)),s=k.sample(g.add(p)).r.mul(i),t=k.sample(g.add(q)).g.mul(i),u=k.sample(g.add(r)).b.mul(i);b.assign(b.add(s)),c.assign(c.add(t)),h.assign(h.add(u))}return e(b,c,h,f(1))})());return c(()=>{p?.renderTarget?.dispose&&p.renderTarget.dispose()}),j(()=>{let a=d(1).div(i),b=f(0).toVar(),c=f(0).toVar(),h=f(0).toVar();for(let e=-6;e<=6;e++){let i=f(l[e+6]/6.214),j=f(e).mul(a.y),k=d(f(0),j.mul(m)),q=d(f(0),j.mul(n)),r=d(f(0),j.mul(o)),s=p.sample(g.add(k)).r.mul(i),t=p.sample(g.add(q)).g.mul(i),u=p.sample(g.add(r)).b.mul(i);b.assign(b.add(s)),c.assign(c.add(t)),h.assign(h.add(u))}return e(b,c,h,k.sample(g).a)})()}};II();let RA={name:"Checkerboard",category:"Shapes & Masks",props:{colorA:{default:"#cccccc",transform:Q9,description:"First color of the checkerboard pattern",ui:{type:"color",label:"Color A"}},colorB:{default:"#999999",transform:Q9,description:"Second color of the checkerboard pattern",ui:{type:"color",label:"Color B"}},cells:{default:8,description:"Number of cells along the shortest canvas edge (creates square cells)",ui:{type:"range",min:1,max:50,step:1,label:"Cells"}},softness:{default:0,description:"Smoothness of the transition between colors (0 = hard edges, 1 = very soft)",ui:{type:"range",min:0,max:1,step:.01,label:"Softness"}},colorSpace:{default:"linear",transform:Re,description:"Color space for color interpolation",ui:{type:"select",options:Rd,label:"Color Space"}}},fragmentNode:({uniforms:a})=>{let{vec2:b,float:c,floor:d,mod:e,fract:f,smoothstep:g,min:h,screenUV:i,viewportSize:j}=IH,k=j.x.div(j.y),l=b(i.x.mul(k),i.y.oneMinus()),m=a.cells.uniform,n=a.softness.uniform,o=l.mul(m),p=d(o),q=e(p.x.add(p.y),2),r=q;if(n){let a=f(o),b=h(h(a.x,c(1).sub(a.x)),h(a.y,c(1).sub(a.y))),d=n.mul(.5),e=g(c(0),d,b);r=q.mul(e).add(c(.5).mul(c(1).sub(e)))}return Rv(a.colorA.uniform,a.colorB.uniform,r,a.colorSpace.uniform)}};II();let RB={name:"ChromaFlow",category:"Interactive",props:{baseColor:{default:"#0066ff",transform:Q9,description:"Base liquid color",ui:{type:"color",label:"Base Color"}},upColor:{default:"#00ff00",transform:Q9,description:"Color for upward movement",ui:{type:"color",label:"Up Color"}},downColor:{default:"#ff0000",transform:Q9,description:"Color for downward movement",ui:{type:"color",label:"Down Color"}},leftColor:{default:"#0000ff",transform:Q9,description:"Color for leftward movement",ui:{type:"color",label:"Left Color"}},rightColor:{default:"#ffff00",transform:Q9,description:"Color for rightward movement",ui:{type:"color",label:"Right Color"}},intensity:{default:1,description:"Strength of the liquid effect",ui:{type:"range",min:.5,max:1.5,step:.1,label:"Intensity"}},radius:{default:2,description:"Radius of the liquid effect",ui:{type:"range",min:0,max:3,step:.01,label:"Radius"}},momentum:{default:30,description:"How much momentum colors retain in their flow direction",ui:{type:"range",min:10,max:60,step:1,label:"Momentum"}}},fragmentNode:({uniforms:a,onBeforeRender:b,onCleanup:c})=>{let{vec2:d,vec4:e,float:f,uniform:g,screenUV:h,texture:i,smoothstep:j,mix:k}=IH,l=new Float32Array(32768),m=new Float32Array(32768),n=new Lx(l,128,128,1030,1015);n.magFilter=1006,n.minFilter=1006,n.needsUpdate=!0;let o=new Lx(m,128,128,1030,1015);o.magFilter=1006,o.minFilter=1006,o.needsUpdate=!0;let p=i(n),q=i(o),r=g(.5),s=g(.5),t=g(0),u=g(0),v=.5,w=.5,x=Date.now();b(({pointer:b})=>{let c=Date.now(),d=Math.min((c-x)/1e3,.016);x=c;let e=d>0?(b.x-v)/d:0,f=d>0?(b.y-w)/d:0;t.value=.85*t.value+.15*e,u.value=.85*u.value+.15*f,r.value=b.x,s.value=b.y;let g=a.intensity.uniform.value,h=.05*a.radius.uniform.value,i=a.momentum.uniform.value,j=new Float32Array(l),k=new Float32Array(m),p=1-d/1;for(let a=0;a<32768;a++)j[a]=l[a]*p;for(let a=0;a<128;a++)for(let b=0;b<128;b++){let c=(128*a+b)*2,e=1-d/1;if(k[c]=m[c]*e,k[c+1]=m[c+1]*e,Math.abs(l[c])>.001||Math.abs(l[c+1])>.001){let f=50*i*d,g=b-l[c]*f,h=a-l[c+1]*f,j=Math.floor(g),n=Math.floor(h),o=j+1,p=n+1;if(j>=0&&n>=0&&o<128&&p<128){let a=g-j,b=h-n,d=(128*n+j)*2,f=(128*n+o)*2,i=(128*p+j)*2,l=(128*p+o)*2;k[c]=(m[d]*(1-a)*(1-b)+m[f]*a*(1-b)+m[i]*(1-a)*b+m[l]*a*b)*e}}}for(let a=0;a<128;a++)for(let c=0;c<128;c++){let i=(128*a+c)*2,l=(a+.5)/128,m=(c+.5)/128-b.x,n=l-b.y,o=Math.sqrt(m*m+n*n),p=Math.sqrt(t.value*t.value+u.value*u.value),q=h*Math.min(p*p*20,1);if(o<2*q&&Math.abs(e)+Math.abs(f)>.01){let a=Math.exp(-o*o/(q*q));j[i]+=t.value*a*(100*g)*d*.01,j[i+1]+=u.value*a*(100*g)*d*.01;let b=Math.min(10*p,1);k[i]+=100*g*a*d*.01*b,k[i+1]=0}j[i]=Math.max(-1,Math.min(1,j[i])),j[i+1]=Math.max(-1,Math.min(1,j[i+1])),k[i]=Math.max(0,Math.min(1,k[i])),k[i+1]=0}l.set(j),m.set(k),n.needsUpdate=!0,o.needsUpdate=!0,v=b.x,w=b.y}),c(()=>{n.dispose(),o.dispose()});let y=q.sample(h).x,z=d(f(1/128),f(1/128)),A=q.sample(h.add(d(z.x,f(0)))).x,B=q.sample(h.add(d(f(0),z.y))).x,C=q.sample(h.add(d(z.x.negate(),f(0)))).x,D=q.sample(h.add(d(f(0),z.y.negate()))).x,E=y.add(A).add(B).add(C).add(D).mul(f(.2)),F=j(f(0),f(.1),E),G=d(f(1/128),f(1/128)),H=p.sample(h).xy,I=p.sample(h.add(d(G.x,f(0)))).xy,J=p.sample(h.add(d(f(0),G.y))).xy,K=p.sample(h.add(d(G.x.negate(),f(0)))).xy,L=p.sample(h.add(d(f(0),G.y.negate()))).xy,M=H.add(I).add(J).add(K).add(L).mul(f(.2)),N=a.baseColor.uniform,O=a.upColor.uniform,P=a.downColor.uniform,Q=a.leftColor.uniform,R=a.rightColor.uniform,S=M.x.mul(M.x).add(M.y.mul(M.y)).sqrt(),T=j(f(.01),f(.1),S),U=M.x.div(S.add(f(.001))),V=M.y.div(S.add(f(.001))),W=j(f(0),f(.7),U.max(f(0))),X=j(f(0),f(.7),U.negate().max(f(0))),Y=j(f(0),f(.7),V.max(f(0))),Z=j(f(0),f(.7),V.negate().max(f(0))),$=Q.mul(X).add(R.mul(W)),_=P.mul(Z).add(O.mul(Y)),aa=X.add(W),ab=Y.add(Z),ac=aa.add(ab).add(f(.001)),ad=k(N,$.mul(aa.div(ac)).add(_.mul(ab.div(ac))),T);return e(ad.rgb.mul(F),ad.a.mul(F))}};II();let RC={name:"ChromaticAberration",category:"Effects",requiresRTT:!0,requiresChild:!0,props:{strength:{default:.2,description:"Overall strength of the chromatic aberration effect",ui:{type:"range",min:0,max:1,step:.01,label:"Strength"}},angle:{default:0,transform:Rb,description:"Direction of the chromatic aberration in degrees",ui:{type:"range",min:0,max:360,step:1,label:"Angle"}},redOffset:{default:-1,description:"Red channel offset multiplier",ui:{type:"range",min:-2,max:2,step:.1,label:"Red Offset"}},greenOffset:{default:0,description:"Green channel offset multiplier",ui:{type:"range",min:-2,max:2,step:.1,label:"Green Offset"}},blueOffset:{default:1,description:"Blue channel offset multiplier",ui:{type:"range",min:-2,max:2,step:.1,label:"Blue Offset"}}},fragmentNode:({uniforms:a,childNode:b,onCleanup:c})=>{let{vec2:d,vec4:e,cos:f,sin:g,radians:h,screenUV:i,convertToTexture:j}=IH;if(!b)return e(0,0,0,0);let k=j(b);c(()=>{k?.renderTarget?.dispose&&k.renderTarget.dispose()});let l=h(a.angle.uniform),m=d(f(l),g(l)),n=a.strength.uniform.mul(.1),o=i.add(m.mul(n).mul(a.redOffset.uniform)),p=i.add(m.mul(n).mul(a.greenOffset.uniform)),q=i.add(m.mul(n).mul(a.blueOffset.uniform));return e(k.sample(o).r,k.sample(p).g,k.sample(q).b,k.sample(i).a)}};II();let RD={name:"Circle",category:"Shapes & Masks",props:{color:{default:"#ffffff",transform:Q9,description:"The color of the circle",ui:{type:"color",label:"Color"}},radius:{default:1,description:"The radius of the circle. A value of one (1) is sets the circle to fit the canvas.",ui:{type:"range",min:0,max:2,step:.01,label:"Radius"}},softness:{default:0,description:"Edge softness. Lower values like zero (0) are sharp, higher values like one (1) are softer.",ui:{type:"range",min:0,max:1,step:.01,label:"Softness"}},center:{default:{x:.5,y:.5},transform:Ra,description:"The center point of the circle",ui:{type:"position",label:"Center Position"}}},fragmentNode:({uniforms:a})=>{let{vec2:b,vec4:c,length:d,smoothstep:e,screenUV:f,viewportSize:g}=IH,h=g.x.div(g.y),i=b(f.x.mul(h),f.y),j=b(a.center.uniform.x.mul(h),a.center.uniform.y.oneMinus()),k=d(i.sub(j)),l=a.softness.uniform,m=a.radius.uniform.mul(.5),n=e(m,m.sub(l),k);return c(a.color.uniform.rgb,a.color.uniform.a.mul(n))}};II();let RE={name:"CRTScreen",category:"Effects",requiresRTT:!0,requiresChild:!0,props:{pixelSize:{default:128,description:"Size of individual TV pixels (lower = more pixels)",ui:{type:"range",min:8,max:128,step:1,label:"Pixel Size"}},colorShift:{default:1,description:"Chromatic aberration amount",ui:{type:"range",min:0,max:10,step:.1,label:"Color Shift"}},scanlineIntensity:{default:.3,description:"Strength of horizontal scanlines",ui:{type:"range",min:0,max:1,step:.01,label:"Scanline Intensity"}},scanlineFrequency:{default:200,description:"Number of scanlines across screen",ui:{type:"range",min:100,max:800,step:10,label:"Scanline Frequency"}},brightness:{default:1.1,description:"Screen brightness boost",ui:{type:"range",min:.5,max:2,step:.01,label:"Brightness"}},contrast:{default:1.2,description:"Screen contrast enhancement",ui:{type:"range",min:.5,max:2,step:.01,label:"Contrast"}}},fragmentNode:({uniforms:a,childNode:b,onCleanup:c})=>{let{vec2:d,vec3:e,vec4:f,float:g,screenUV:h,sin:i,fract:j,smoothstep:k,length:l,convertToTexture:m}=IH;if(!b)return f(0,0,0,0);let n=m(b);c(()=>{n?.renderTarget?.dispose&&n.renderTarget.dispose()});let o=a.pixelSize.uniform,p=a.colorShift.uniform,q=a.scanlineIntensity.uniform,r=a.scanlineFrequency.uniform,s=a.brightness.uniform,t=a.contrast.uniform,u=p.mul(g(.002)),v=h.add(d(u,g(0))),w=h.sub(d(u,g(0))),x=e(n.sample(v).r,n.sample(h).g,n.sample(w).b).sub(g(.5)).mul(t).add(g(.5)).mul(s),y=i(h.y.mul(r).mul(g(6.28318))),z=g(1).sub(q.mul(y.mul(g(.5)).add(g(.5)))),A=x.mul(z),B=o.mul(g(.5)),C=j(h.mul(B)),D=i(C.x.mul(g(6.28318))).mul(g(.1)).add(g(.95)),E=i(C.x.mul(g(6.28318)).add(g(2.09))).mul(g(.1)).add(g(.95)),F=i(C.x.mul(g(6.28318)).add(g(4.18))).mul(g(.1)).add(g(.95)),G=e(A.r.mul(D),A.g.mul(E),A.b.mul(F)),H=l(h.sub(d(.5,.5))),I=k(g(.8),g(.3),H);return f(G.mul(I),g(1))}};II();let RF={name:"CursorTrail",category:"Interactive",props:{colorA:{default:"#00aaff",transform:Q9,description:"Color of fresh trails",ui:{type:"color",label:"Start Color"}},colorB:{default:"#ff00aa",transform:Q9,description:"Color trails transition to as they fade",ui:{type:"color",label:"End Color"}},radius:{default:.5,description:"Base radius of trail circles",ui:{type:"range",min:.5,max:2,step:.01,label:"Radius"}},length:{default:.5,description:"How long trail circles persist (in seconds)",ui:{type:"range",min:.1,max:2,step:.1,label:"Trail Length"}},shrink:{default:1,description:"How much circles shrink as they fade out (0 = no shrink, 1 = full shrink)",ui:{type:"range",min:0,max:1,step:.01,label:"Shrink Amount"}},colorSpace:{default:"linear",transform:Re,description:"Color space for color interpolation",ui:{type:"select",options:Rd,label:"Color Space"}}},fragmentNode:({uniforms:a,onBeforeRender:b,onCleanup:c})=>{let{vec4:d,float:e,texture:f,step:g,screenUV:h}=IH,i=new Float32Array(65536),j=new Lx(i,128,128,1023,1015);j.magFilter=1006,j.minFilter=1006,j.needsUpdate=!0;let k=f(j),l=.5,m=.5,n=Date.now();b(({pointer:b})=>{let c=Date.now(),d=Math.min((c-n)/1e3,.016);n=c;let e=.1*a.radius.uniform.value,f=a.length.uniform.value,g=a.shrink.uniform.value,h=b.x-l,k=b.y-m,o=Math.sqrt(h*h+k*k),p=1-d/Math.max(.1,f),q=d/Math.max(.1,f);for(let a=0;a<65536;a+=4)i[a]*=p,i[a+1]=1-(1-i[a])*g,i[a+2]=Math.min(1,i[a+2]+q);if(o>.001){let a=3*e,c=Math.max(0,Math.floor((b.x-a)*128)),f=Math.min(127,Math.ceil((b.x+a)*128)),g=Math.max(0,Math.floor((b.y-a)*128)),h=Math.min(127,Math.ceil((b.y+a)*128));for(let j=g;j<=h;j++)for(let g=c;g<=f;g++){let c=(128*j+g)*4,f=(j+.5)/128,h=(g+.5)/128-b.x,k=f-b.y,l=Math.sqrt(h*h+k*k);if(l<a){let a=Math.exp(-l*l/(e*e))*o*50*d;i[c]=Math.min(1,i[c]+a),i[c+1]=1,i[c+2]=0}}}j.needsUpdate=!0,l=b.x,m=b.y}),c(()=>{j.dispose()});let o=e(1/128),p=k.sample(h),q=k.sample(h.add(Ic(o,e(0)))),r=k.sample(h.add(Ic(e(0),o))),s=k.sample(h.add(Ic(o.negate(),e(0)))),t=k.sample(h.add(Ic(e(0),o.negate()))),u=p.x.mul(e(.5)).add(q.x.mul(e(.125))).add(r.x.mul(e(.125))).add(s.x.mul(e(.125))).add(t.x.mul(e(.125))),v=p.z.mul(e(.5)).add(q.z.mul(e(.125))).add(r.z.mul(e(.125))).add(s.z.mul(e(.125))).add(t.z.mul(e(.125))),w=g(e(.01),u),x=Rv(a.colorA.uniform,a.colorB.uniform,v,a.colorSpace.uniform);return d(x.rgb,x.a.mul(w))}};II();let RG={name:"DiffuseBlur",category:"Blurs",requiresRTT:!0,requiresChild:!0,props:{intensity:{default:30,description:"Intensity of the diffuse blur effect",ui:{type:"range",min:0,max:100,step:1,label:"Intensity"}}},fragmentNode:({uniforms:a,childNode:b,onCleanup:c})=>{let{vec2:d,vec4:e,float:f,screenUV:g,convertToTexture:h,viewportSize:i,fract:j,sin:k,cos:l,dot:m,Fn:n}=IH;if(!b)return e(0,0,0,0);let o=h(b);return c(()=>{o?.renderTarget?.dispose&&o.renderTarget.dispose()}),n(()=>{let b=a.intensity.uniform.mul(1),c=d(1).div(i),h=a=>j(k(m(a,d(12.9898,78.233).mul(2))).mul(43758.5453)),n=e(0).toVar();for(let a=0;a<16;a++){let e=g.mul(1e3).add(d(f(11.7*a),f(5.3*a))),i=h(e),j=h(e.add(d(73.2,41.9))),m=i.mul(6.28318530718),p=j.sqrt().mul(b),q=d(l(m).mul(p),k(m).mul(p)).mul(c.x),r=g.add(q),s=o.sample(r);n.assign(n.add(s))}return n.div(f(16))})()}};II();let RH={name:"Dither",category:"Effects",requiresChild:!0,props:{pixelSize:{default:4,description:"Size of dithering pixels",ui:{type:"range",min:1,max:20,step:1,label:"Pixel Size"}},threshold:{default:.5,description:"Luminance threshold for dithering",ui:{type:"range",min:0,max:1,step:.01,label:"Threshold"}},colorA:{default:"transparent",transform:Q9,description:"Dark color for dithering",ui:{type:"color",label:"Dark Color"}},colorB:{default:"#ffffff",transform:Q9,description:"Light color for dithering",ui:{type:"color",label:"Light Color"}}},fragmentNode:({uniforms:a,childNode:b})=>{let{vec2:c,vec3:d,vec4:e,floor:f,screenUV:g,viewportSize:h,dot:i,step:j,mix:k}=IH;if(!b)return e(0,0,0,0);let l=i(b.rgb,d(.299,.587,.114)).mul(b.a),m=a.pixelSize.uniform,n=f(g.mul(h).div(m)).mod(c(4)),o=n.x,p=n.y,q=p.equal(0).select(o.equal(0).select(0,o.equal(1).select(.5,o.equal(2).select(2/16,.625))),p.equal(1).select(o.equal(0).select(.75,o.equal(1).select(.25,o.equal(2).select(.875,6/16))),p.equal(2).select(o.equal(0).select(3/16,o.equal(1).select(11/16,o.equal(2).select(1/16,9/16))),o.equal(0).select(15/16,o.equal(1).select(7/16,o.equal(2).select(13/16,5/16)))))),r=a.threshold.uniform,s=j(q,l.add(r.sub(.5)));return e(k(a.colorA.uniform.rgb,a.colorB.uniform.rgb,s),k(a.colorA.uniform.a,a.colorB.uniform.a,s))}};II();let RI={name:"DotGrid",category:"Shapes & Masks",props:{color:{default:"#ffffff",description:"The color of the dot",transform:Q9,ui:{type:"color",label:"Color"}},density:{default:100,description:"The number of dots on the longest canvas edge",ui:{type:"range",min:10,max:500,step:10,label:"Density"}},dotSize:{default:.3,description:"The size of each dot, zero (0) being invisible, one (1) filled the grid with no gaps",ui:{type:"range",min:0,max:1,step:.01,label:"Dot Size"}},twinkle:{default:0,description:"Intensity of the twinkle effect (0 = off, 1 = full twinkle)",ui:{type:"range",min:0,max:1,step:.01,label:"Twinkle"}}},fragmentNode:({uniforms:a})=>{let{screenUV:b,vec4:c,vec2:d,smoothstep:e,length:f,floor:g,float:h,viewportSize:i,time:j,sin:k,mix:l}=IH,m=a.density.uniform,n=a.dotSize.uniform,o=a.color.uniform,p=a.twinkle.uniform,q=i.x.div(i.y),r=d(b.x.mul(q),b.y.oneMinus()),s=r.mul(m),t=f(s.sub(g(s)).sub(.5)),u=f(B$(r.mul(m))),v=h(1).sub(e(n.mul(.5),n.mul(.5).add(u.mul(.5)),t)),w=g(s),x=w.x.mul(12.9898).add(w.y.mul(78.233)).sin().mul(43758.5453).fract(),y=k(j.mul(2).add(x.mul(6.28318))).mul(.5).add(.5),z=l(h(1),y,p),A=v.mul(z);return c(o.rgb,A)}};II();let RJ={name:"Duotone",category:"Effects",requiresRTT:!0,requiresChild:!0,props:{colorA:{default:"#ff0000",transform:Q9,description:"First color (used for darker areas)",ui:{type:"color",label:"Color A"}},colorB:{default:"#023af4",transform:Q9,description:"Second color (used for brighter areas)",ui:{type:"color",label:"Color B"}},blend:{default:.5,description:"Blend point between the two colors",ui:{type:"range",min:0,max:1,step:.01,label:"Blend"}},colorSpace:{default:"linear",transform:Re,description:"Color space for color interpolation",ui:{type:"select",options:Rd,label:"Color Space"}}},fragmentNode:({uniforms:a,childNode:b,onCleanup:c})=>{let{vec3:d,vec4:e,dot:f,smoothstep:g,screenUV:h,convertToTexture:i}=IH;if(!b)return e(0,0,0,0);let j=i(b);c(()=>{j?.renderTarget?.dispose&&j.renderTarget.dispose()});let k=j.sample(h),l=f(k.rgb,d(.299,.587,.114)),m=g(a.blend.uniform.sub(.5),a.blend.uniform.add(.5),l);return e(Rv(a.colorA.uniform,a.colorB.uniform,m,a.colorSpace.uniform).rgb,k.a)}};II();let RK={name:"FilmGrain",category:"Effects",requiresChild:!0,props:{strength:{default:.5,description:"Intensity of the film grain noise",ui:{type:"range",min:0,max:1,step:.01,label:"Strength"}}},fragmentNode:({uniforms:a,childNode:b})=>{let{vec2:c,vec4:d,float:e,screenUV:f,sin:g,dot:h,fract:i}=IH,j=a.strength.uniform,k=b||d(0,0,0,0),l=i(g(h(f,c(e(12.9898),e(78.233)).mul(e(2)))).mul(e(43758.5453))).mul(e(2)).sub(e(1)).mul(j.mul(e(.1)));return d(k.rgb.add(l),k.a)}};II();let RL={name:"FloatingParticles",category:"Effects",requiresRTT:!1,props:{randomness:{default:.25,description:"Randomness of particle animation",ui:{type:"range",min:0,max:1,step:.01,label:"Randomness"}},speed:{default:.25,description:"Speed of particle movement",ui:{type:"range",min:0,max:1,step:.01,label:"Speed"}},angle:{default:90,description:"Movement angle in degrees (0=right, 90=down, 180=left, 270=up)",ui:{type:"range",min:0,max:360,step:1,label:"Angle"}},particleSize:{default:1,description:"Size of particles",ui:{type:"range",min:.1,max:20,step:.1,label:"Particle Size"}},particleSoftness:{default:0,description:"Edge softness of particles (0 = sharp, 1 = very soft)",ui:{type:"range",min:0,max:5,step:.01,label:"Particle Softness"}},twinkle:{default:.5,description:"Intensity of the twinkle effect (0 = off, 1 = full twinkle)",ui:{type:"range",min:0,max:1,step:.01,label:"Twinkle"}},count:{default:5,description:"Number of particle layers",ui:{type:"range",min:1,max:5,step:1,label:"Count"}},particleColor:{default:"#ffffff",transform:Q9,description:"Color of the particles",ui:{type:"color",label:"Particle Color"}},speedVariance:{default:.3,description:"Per-layer speed variance (0 = all layers same speed, 1 = high variance)",ui:{type:"range",min:0,max:1,step:.01,label:"Speed Variance"}},angleVariance:{default:30,description:"Per-layer angle variance in degrees (0 = all layers same angle, 180 = full variance)",ui:{type:"range",min:0,max:180,step:1,label:"Angle Variance"}},particleDensity:{default:3,description:"Particle density (lower = more spread out, higher = more dense)",ui:{type:"range",min:.5,max:3,step:.1,label:"Particle Density"}}},fragmentNode:({uniforms:a,childNode:b})=>{let{vec2:c,vec3:d,vec4:e,float:f,sin:g,cos:h,smoothstep:i,mix:j,min:k,floor:l,fract:m,length:n,dot:o,screenUV:p,viewportSize:q,time:r,Fn:s}=IH,t=s(([a])=>m(g(o(a,c(127.1,311.7))).mul(43758.5453123))),u=s(([a])=>m(g(c(o(a,c(127.1,311.7)),o(a,c(269.5,183.3)))).mul(43758.5453))),v=s(([a,b])=>{let d=u(a).sub(.5),e=g(b),f=h(b);return c(f.mul(d.x).sub(e.mul(d.y)).mul(.66),e.mul(d.x).add(f.mul(d.y)).mul(.66)).add(a).add(.5)}),w=s(([b])=>r.mul(a.randomness.uniform).mul(t(b).sub(.5)).mul(2)),x=s(([a,b])=>{let c=v(b,w(b));return n(a.sub(c))}),y=s(([b])=>{let d=l(b),e=m(b),h=x(b,d),n=a.particleSoftness.uniform,o=a.particleSize.uniform.mul(.01),p=o.mul(.6).add(n.mul(o.mul(2.4))),q=p.greaterThan(.35),s=e.x.lessThan(.4),t=e.x.greaterThan(.6),u=e.y.lessThan(.4),v=e.y.greaterThan(.6),w=q.and(s),y=q.and(t),z=q.and(u),A=q.and(v);h=w.select(k(h,x(b,d.add(c(-1,0)))),h),h=y.select(k(h,x(b,d.add(c(1,0)))),h),h=z.select(k(h,x(b,d.add(c(0,-1)))),h),h=A.select(k(h,x(b,d.add(c(0,1)))),h);let B=i(p,o.mul(.6),h),C=a.twinkle.uniform,D=d.x.mul(12.9898).add(d.y.mul(78.233)).sin().mul(43758.5453).fract(),E=g(r.mul(2).add(D.mul(6.28318))).mul(.5).add(.5),F=j(f(1),E,C);return B.mul(F).mul(a.particleColor.uniform.rgb)}),z=s(([b])=>{let e=f(1.05),i=f(.9),j=a.count.uniform,k=d(0).toVar(),l=f(1).toVar(),m=f(1).toVar(),n=c(0).toVar(),o=a.angle.uniform.mul(3.14159).div(180),p=c(h(o),g(o)),q=r.mul(p).mul(a.speed.uniform),s=a.speedVariance.uniform,t=a.angleVariance.uniform.mul(3.14159).div(180);for(let v=0;v<4;v++){let w=f(v).lessThan(j).and(m.greaterThan(.02)),x=u(c(m,f(v).mul(7.919))),z=f(1).add(x.x.sub(.5).mul(s)),A=x.y.sub(.5).mul(t).mul(2),B=o.add(A),C=c(h(B),g(B)),D=q.mul(z).add(C.sub(p).mul(r).mul(a.speed.uniform)),E=y(b.mul(l).add(D).add(n)).mul(m);k.assign(k.add(w.select(E,d(0)))),n.assign(n.add(x.mul(10))),m.assign(m.mul(i)),l.assign(l.mul(e))}return k}),A=p.mul(2).sub(1),B=q.x.div(q.y),C=z(c(A.x.mul(B),A.y).mul(a.particleDensity.uniform)),D=n(C);return b?e(j(b.xyz,C,D.greaterThan(.01).select(D,0)),1):e(C,D)}};II();let RM={name:"GlassTiles",category:"Distortions",requiresRTT:!0,requiresChild:!0,props:{intensity:{default:1,description:"The intensity of the glass tiles effect",ui:{type:"range",min:0,max:5,step:.1,label:"Intensity"}},tileCount:{default:100,description:"Number of tiles across the shortest dimension",ui:{type:"range",min:1,max:200,step:1,label:"Tile Count"}}},fragmentNode:({uniforms:a,childNode:b,dimensions:c,onCleanup:d})=>{let{vec2:e,vec4:f,floor:g,mul:h,div:i,sub:j,add:k,screenUV:l,uniform:m,convertToTexture:n}=IH;if(!b)return console.error("You must pass a child component into the Glass Tiles shader."),f(0);let o=n(b);d(()=>{o?.renderTarget?.dispose&&o.renderTarget.dispose()});let p=m(c.width/c.height),q=a.intensity.uniform,r=a.tileCount.uniform,s=e(p.greaterThanEqual(1).select(h(r,p),r),p.lessThan(1).select(i(r,p),r)),t=i(g(h(l,s)),s),u=j(l,t),v=e(.5,.5),w=h(q,.025),x=k(k(u,h(j(i(u,i(e(1),s)),v),w)),t);return f(o.sample(x))}};II();let RN={name:"Glow",category:"Effects",requiresRTT:!0,requiresChild:!0,props:{intensity:{default:1,description:"Glow intensity (brightness of the glow effect)",ui:{type:"range",min:0,max:10,step:.01,label:"Intensity"}},threshold:{default:.5,description:"Brightness threshold for glow extraction (lower = more glow)",ui:{type:"range",min:0,max:1,step:.01,label:"Threshold"}},size:{default:10,description:"Size/spread of the glow effect",ui:{type:"range",min:1,max:20,step:.01,label:"Glow Size"}}},fragmentNode:({uniforms:a,childNode:b,onCleanup:c})=>{let{vec2:d,vec3:e,vec4:f,float:g,max:h,dot:i,screenUV:j,convertToTexture:k,viewportSize:l,Fn:m}=IH;if(!b)return f(0,0,0,0);let n=k(b);c(()=>{n?.renderTarget?.dispose&&n.renderTarget.dispose()});let o=n.sample(j),p=m(()=>{let b=a.size.uniform,c=a.threshold.uniform,k=d(1).div(l),m=f(0,0,0,0).toVar();for(let a=-5;a<=5;a++)for(let f=-5;f<=5;f++){let l=d(g(a),g(f)).mul(k).mul(b),o=j.add(l),p=n.sample(o),q=i(p.rgb,e(.299,.587,.114)),r=h(g(0),q.sub(c)),s=p.mul(r);m.assign(m.add(s))}let o=g(121);return m.div(o)})(),q=a.intensity.uniform,r=p.mul(q);return f(o.rgb.add(r.rgb),h(o.a,r.a))}};II();let RO={name:"Godrays",category:"Effects",requiresRTT:!1,props:{center:{default:{x:0,y:0},transform:Ra,description:"The center point of the god rays",ui:{type:"position",label:"Center"}},density:{default:.3,description:"Frequency of ray sectors",ui:{type:"range",min:0,max:1,step:.01,label:"Density"}},intensity:{default:.8,description:"Ray visibility within sectors",ui:{type:"range",min:0,max:1,step:.01,label:"Intensity"}},spotty:{default:1,description:"Density of spots on rays (higher = more spots)",ui:{type:"range",min:0,max:1,step:.01,label:"Spotty"}},speed:{default:.5,description:"Animation speed of the rays",ui:{type:"range",min:0,max:2,step:.01,label:"Speed"}},rayColor:{default:"#4283fb",transform:Q9,description:"Color of the light rays",ui:{type:"color",label:"Ray Color"}},backgroundColor:{default:"transparent",transform:Q9,description:"Background color",ui:{type:"color",label:"Background Color"}}},fragmentNode:({uniforms:a})=>{let{vec2:b,vec4:c,float:d,sin:e,atan2:f,length:g,pow:h,smoothstep:i,mix:j,clamp:k,screenUV:l,time:m,PI:n,Fn:o}=IH,p=b(a.center.uniform.x,a.center.uniform.y.oneMinus()),q=l.sub(p),r=o(([a])=>{let c=a.floor(),d=a.fract(),f=a=>e(a.x.mul(127.1).add(a.y.mul(311.7))).mul(43758.5453).fract(),g=f(c),h=f(c.add(b(1,0))),i=f(c.add(b(0,1))),k=f(c.add(b(1,1))),l=d.mul(d).mul(d.mul(-2).add(3));return j(j(g,h,l.x),j(i,k,l.x),l.y)}),s=o(([a,c,d,e])=>{let g=f(a.y,a.x),k=b(g.mul(d),c),l=b(g.mod(n.mul(2)).mul(d),c),m=h(r(k),e);return j(h(r(l),e),m,i(-.15,.15,a.x))}),t=o(()=>{let b=m.mul(a.speed.uniform).mul(.2),c=g(q),e=d(6.5).mul(zD(a.spotty.uniform)),f=d(4).sub(d(3).mul(k(a.intensity.uniform,0,1))),h=d(6).mul(a.density.uniform),i=d(0).toVar(),j=c.mul(1).sub(b.mul(3)),l=c.mul(.5).mul(d(1).add(e)).sub(b.mul(2)),n=h.mul(5),o=s(q,j,n,f).toVar();o.assign(o.mul(s(q,l,n.mul(4),f))),i.assign(i.add(o));let p=c.mul(1.4).sub(b.mul(2.5)),r=c.mul(.7).mul(d(1).add(e)).sub(b.mul(1.8)),t=h.mul(4.5),u=s(q,p,t,f).toVar();return u.assign(u.mul(s(q,r,t.mul(3.5),f))),i.assign(i.add(u.mul(.7))),k(i,0,1)})(),u=a.rayColor.uniform.rgb;return c(j(a.backgroundColor.uniform.rgb,u,t),a.backgroundColor.uniform.a.add(t.mul(a.rayColor.uniform.a)))}},RP="vertex",RQ="none",RR="frame",RS="object",RT=["x","y","z","w"];var RU={};function RV(...a){console.log("THREE."+a.shift(),...a)}function RW(...a){console.warn("THREE."+a.shift(),...a)}function RX(...a){console.error("THREE."+a.shift(),...a)}function RY(...a){let b=a.join(" ");b in RU||(RU[b]=!0,RW(...a))}var RZ="00.01.02.03.04.05.06.07.08.09.0a.0b.0c.0d.0e.0f.10.11.12.13.14.15.16.17.18.19.1a.1b.1c.1d.1e.1f.20.21.22.23.24.25.26.27.28.29.2a.2b.2c.2d.2e.2f.30.31.32.33.34.35.36.37.38.39.3a.3b.3c.3d.3e.3f.40.41.42.43.44.45.46.47.48.49.4a.4b.4c.4d.4e.4f.50.51.52.53.54.55.56.57.58.59.5a.5b.5c.5d.5e.5f.60.61.62.63.64.65.66.67.68.69.6a.6b.6c.6d.6e.6f.70.71.72.73.74.75.76.77.78.79.7a.7b.7c.7d.7e.7f.80.81.82.83.84.85.86.87.88.89.8a.8b.8c.8d.8e.8f.90.91.92.93.94.95.96.97.98.99.9a.9b.9c.9d.9e.9f.a0.a1.a2.a3.a4.a5.a6.a7.a8.a9.aa.ab.ac.ad.ae.af.b0.b1.b2.b3.b4.b5.b6.b7.b8.b9.ba.bb.bc.bd.be.bf.c0.c1.c2.c3.c4.c5.c6.c7.c8.c9.ca.cb.cc.cd.ce.cf.d0.d1.d2.d3.d4.d5.d6.d7.d8.d9.da.db.dc.dd.de.df.e0.e1.e2.e3.e4.e5.e6.e7.e8.e9.ea.eb.ec.ed.ee.ef.f0.f1.f2.f3.f4.f5.f6.f7.f8.f9.fa.fb.fc.fd.fe.ff".split(".");function R$(){let a=0xffffffff*Math.random()|0,b=0xffffffff*Math.random()|0,c=0xffffffff*Math.random()|0,d=0xffffffff*Math.random()|0;return(RZ[255&a]+RZ[a>>8&255]+RZ[a>>16&255]+RZ[a>>24&255]+"-"+RZ[255&b]+RZ[b>>8&255]+"-"+RZ[b>>16&15|64]+RZ[b>>24&255]+"-"+RZ[63&c|128]+RZ[c>>8&255]+"-"+RZ[c>>16&255]+RZ[c>>24&255]+RZ[255&d]+RZ[d>>8&255]+RZ[d>>16&255]+RZ[d>>24&255]).toLowerCase()}function R_(a,b,c){return Math.max(b,Math.min(c,a))}function R0(a,b){switch(b.constructor){case Float32Array:return a;case Uint32Array:return a/0xffffffff;case Uint16Array:return a/65535;case Uint8Array:return a/255;case Int32Array:return Math.max(a/0x7fffffff,-1);case Int16Array:return Math.max(a/32767,-1);case Int8Array:return Math.max(a/127,-1);default:throw Error("Invalid component type.")}}function R1(a,b){switch(b.constructor){case Float32Array:return a;case Uint32Array:return Math.round(0xffffffff*a);case Uint16Array:return Math.round(65535*a);case Uint8Array:return Math.round(255*a);case Int32Array:return Math.round(0x7fffffff*a);case Int16Array:return Math.round(32767*a);case Int8Array:return Math.round(127*a);default:throw Error("Invalid component type.")}}let R2="srgb",R3="srgb-linear",R4="linear";var R5=class a{constructor(b,c,d,e,f,g,h,i,j){a.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==b&&this.set(b,c,d,e,f,g,h,i,j)}set(a,b,c,d,e,f,g,h,i){let j=this.elements;return j[0]=a,j[1]=d,j[2]=g,j[3]=b,j[4]=e,j[5]=h,j[6]=c,j[7]=f,j[8]=i,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(a){let b=this.elements,c=a.elements;return b[0]=c[0],b[1]=c[1],b[2]=c[2],b[3]=c[3],b[4]=c[4],b[5]=c[5],b[6]=c[6],b[7]=c[7],b[8]=c[8],this}extractBasis(a,b,c){return a.setFromMatrix3Column(this,0),b.setFromMatrix3Column(this,1),c.setFromMatrix3Column(this,2),this}setFromMatrix4(a){let b=a.elements;return this.set(b[0],b[4],b[8],b[1],b[5],b[9],b[2],b[6],b[10]),this}multiply(a){return this.multiplyMatrices(this,a)}premultiply(a){return this.multiplyMatrices(a,this)}multiplyMatrices(a,b){let c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[3],h=c[6],i=c[1],j=c[4],k=c[7],l=c[2],m=c[5],n=c[8],o=d[0],p=d[3],q=d[6],r=d[1],s=d[4],t=d[7],u=d[2],v=d[5],w=d[8];return e[0]=f*o+g*r+h*u,e[3]=f*p+g*s+h*v,e[6]=f*q+g*t+h*w,e[1]=i*o+j*r+k*u,e[4]=i*p+j*s+k*v,e[7]=i*q+j*t+k*w,e[2]=l*o+m*r+n*u,e[5]=l*p+m*s+n*v,e[8]=l*q+m*t+n*w,this}multiplyScalar(a){let b=this.elements;return b[0]*=a,b[3]*=a,b[6]*=a,b[1]*=a,b[4]*=a,b[7]*=a,b[2]*=a,b[5]*=a,b[8]*=a,this}determinant(){let a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*f*j-b*g*i-c*e*j+c*g*h+d*e*i-d*f*h}invert(){let a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=j*f-g*i,l=g*h-j*e,m=i*e-f*h,n=b*k+c*l+d*m;if(0===n)return this.set(0,0,0,0,0,0,0,0,0);let o=1/n;return a[0]=k*o,a[1]=(d*i-j*c)*o,a[2]=(g*c-d*f)*o,a[3]=l*o,a[4]=(j*b-d*h)*o,a[5]=(d*e-g*b)*o,a[6]=m*o,a[7]=(c*h-i*b)*o,a[8]=(f*b-c*e)*o,this}transpose(){let a,b=this.elements;return a=b[1],b[1]=b[3],b[3]=a,a=b[2],b[2]=b[6],b[6]=a,a=b[5],b[5]=b[7],b[7]=a,this}getNormalMatrix(a){return this.setFromMatrix4(a).invert().transpose()}transposeIntoArray(a){let b=this.elements;return a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8],this}setUvTransform(a,b,c,d,e,f,g){let h=Math.cos(e),i=Math.sin(e);return this.set(c*h,c*i,-c*(h*f+i*g)+f+a,-d*i,d*h,-d*(-i*f+h*g)+g+b,0,0,1),this}scale(a,b){return this.premultiply(R6.makeScale(a,b)),this}rotate(a){return this.premultiply(R6.makeRotation(-a)),this}translate(a,b){return this.premultiply(R6.makeTranslation(a,b)),this}makeTranslation(a,b){return a.isVector2?this.set(1,0,a.x,0,1,a.y,0,0,1):this.set(1,0,a,0,1,b,0,0,1),this}makeRotation(a){let b=Math.cos(a),c=Math.sin(a);return this.set(b,-c,0,c,b,0,0,0,1),this}makeScale(a,b){return this.set(a,0,0,0,b,0,0,0,1),this}equals(a){let b=this.elements,c=a.elements;for(let a=0;a<9;a++)if(b[a]!==c[a])return!1;return!0}fromArray(a,b=0){for(let c=0;c<9;c++)this.elements[c]=a[c+b];return this}toArray(a=[],b=0){let c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a}clone(){return new this.constructor().fromArray(this.elements)}},R6=new R5,R7=new R5().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),R8=new R5().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);let R9=(l=[.64,.33,.3,.6,.15,.06],m=[.2126,.7152,.0722],n=[.3127,.329],(k={enabled:!0,workingColorSpace:R3,spaces:{},convert:function(a,b,c){return!1!==this.enabled&&b!==c&&b&&c&&("srgb"===this.spaces[b].transfer&&(a.r=Sa(a.r),a.g=Sa(a.g),a.b=Sa(a.b)),this.spaces[b].primaries!==this.spaces[c].primaries&&(a.applyMatrix3(this.spaces[b].toXYZ),a.applyMatrix3(this.spaces[c].fromXYZ)),"srgb"===this.spaces[c].transfer&&(a.r=Sb(a.r),a.g=Sb(a.g),a.b=Sb(a.b))),a},workingToColorSpace:function(a,b){return this.convert(a,this.workingColorSpace,b)},colorSpaceToWorking:function(a,b){return this.convert(a,b,this.workingColorSpace)},getPrimaries:function(a){return this.spaces[a].primaries},getTransfer:function(a){return""===a?R4:this.spaces[a].transfer},getToneMappingMode:function(a){return this.spaces[a].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(a,b=this.workingColorSpace){return a.fromArray(this.spaces[b].luminanceCoefficients)},define:function(a){Object.assign(this.spaces,a)},_getMatrix:function(a,b,c){return a.copy(this.spaces[b].toXYZ).multiply(this.spaces[c].fromXYZ)},_getDrawingBufferColorSpace:function(a){return this.spaces[a].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(a=this.workingColorSpace){return this.spaces[a].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(a,b){return RY("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),k.workingToColorSpace(a,b)},toWorkingColorSpace:function(a,b){return RY("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),k.colorSpaceToWorking(a,b)}}).define({[R3]:{primaries:l,whitePoint:n,transfer:R4,toXYZ:R7,fromXYZ:R8,luminanceCoefficients:m,workingColorSpaceConfig:{unpackColorSpace:R2},outputColorSpaceConfig:{drawingBufferColorSpace:R2}},[R2]:{primaries:l,whitePoint:n,transfer:"srgb",toXYZ:R7,fromXYZ:R8,luminanceCoefficients:m,outputColorSpaceConfig:{drawingBufferColorSpace:R2}}}),k);function Sa(a){return a<.04045?.0773993808*a:(.9478672986*a+.0521327014)**2.4}function Sb(a){return a<.0031308?12.92*a:1.055*a**.41666-.055}var Sc={aliceblue:0xf0f8ff,antiquewhite:0xfaebd7,aqua:65535,aquamarine:8388564,azure:0xf0ffff,beige:0xf5f5dc,bisque:0xffe4c4,black:0,blanchedalmond:0xffebcd,blue:255,blueviolet:9055202,brown:0xa52a2a,burlywood:0xdeb887,cadetblue:6266528,chartreuse:8388352,chocolate:0xd2691e,coral:0xff7f50,cornflowerblue:6591981,cornsilk:0xfff8dc,crimson:0xdc143c,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:0xb8860b,darkgray:0xa9a9a9,darkgreen:25600,darkgrey:0xa9a9a9,darkkhaki:0xbdb76b,darkmagenta:9109643,darkolivegreen:5597999,darkorange:0xff8c00,darkorchid:0x9932cc,darkred:9109504,darksalmon:0xe9967a,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:0xff1493,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:0xb22222,floralwhite:0xfffaf0,forestgreen:2263842,fuchsia:0xff00ff,gainsboro:0xdcdcdc,ghostwhite:0xf8f8ff,gold:0xffd700,goldenrod:0xdaa520,gray:8421504,green:32768,greenyellow:0xadff2f,grey:8421504,honeydew:0xf0fff0,hotpink:0xff69b4,indianred:0xcd5c5c,indigo:4915330,ivory:0xfffff0,khaki:0xf0e68c,lavender:0xe6e6fa,lavenderblush:0xfff0f5,lawngreen:8190976,lemonchiffon:0xfffacd,lightblue:0xadd8e6,lightcoral:0xf08080,lightcyan:0xe0ffff,lightgoldenrodyellow:0xfafad2,lightgray:0xd3d3d3,lightgreen:9498256,lightgrey:0xd3d3d3,lightpink:0xffb6c1,lightsalmon:0xffa07a,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:0xb0c4de,lightyellow:0xffffe0,lime:65280,limegreen:3329330,linen:0xfaf0e6,magenta:0xff00ff,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:0xba55d3,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:0xc71585,midnightblue:1644912,mintcream:0xf5fffa,mistyrose:0xffe4e1,moccasin:0xffe4b5,navajowhite:0xffdead,navy:128,oldlace:0xfdf5e6,olive:8421376,olivedrab:7048739,orange:0xffa500,orangered:0xff4500,orchid:0xda70d6,palegoldenrod:0xeee8aa,palegreen:0x98fb98,paleturquoise:0xafeeee,palevioletred:0xdb7093,papayawhip:0xffefd5,peachpuff:0xffdab9,peru:0xcd853f,pink:0xffc0cb,plum:0xdda0dd,powderblue:0xb0e0e6,purple:8388736,rebeccapurple:6697881,red:0xff0000,rosybrown:0xbc8f8f,royalblue:4286945,saddlebrown:9127187,salmon:0xfa8072,sandybrown:0xf4a460,seagreen:3050327,seashell:0xfff5ee,sienna:0xa0522d,silver:0xc0c0c0,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:0xfffafa,springgreen:65407,steelblue:4620980,tan:0xd2b48c,teal:32896,thistle:0xd8bfd8,tomato:0xff6347,turquoise:4251856,violet:0xee82ee,wheat:0xf5deb3,white:0xffffff,whitesmoke:0xf5f5f5,yellow:0xffff00,yellowgreen:0x9acd32},Sd={h:0,s:0,l:0},Se={h:0,s:0,l:0};function Sf(a,b,c){return c<0&&(c+=1),c>1&&--c,c<1/6?a+(b-a)*6*c:c<.5?b:c<2/3?a+(b-a)*6*(2/3-c):a}var Sg=class{constructor(a,b,c){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(a,b,c)}set(a,b,c){return void 0===b&&void 0===c?a&&a.isColor?this.copy(a):"number"==typeof a?this.setHex(a):"string"==typeof a&&this.setStyle(a):this.setRGB(a,b,c),this}setScalar(a){return this.r=a,this.g=a,this.b=a,this}setHex(a,b=R2){return a=Math.floor(a),this.r=(a>>16&255)/255,this.g=(a>>8&255)/255,this.b=(255&a)/255,R9.colorSpaceToWorking(this,b),this}setRGB(a,b,c,d=R9.workingColorSpace){return this.r=a,this.g=b,this.b=c,R9.colorSpaceToWorking(this,d),this}setHSL(a,b,c,d=R9.workingColorSpace){var e;if(e=1,a=(a%1+1)%1,b=R_(b,0,1),c=R_(c,0,1),0===b)this.r=this.g=this.b=c;else{let d=c<=.5?c*(1+b):c+b-c*b,e=2*c-d;this.r=Sf(e,d,a+1/3),this.g=Sf(e,d,a),this.b=Sf(e,d,a-1/3)}return R9.colorSpaceToWorking(this,d),this}setStyle(a,b=R2){let c;function d(b){void 0!==b&&1>parseFloat(b)&&RW("Color: Alpha component of "+a+" will be ignored.")}if(c=/^(\w+)\(([^\)]*)\)/.exec(a)){let e,f=c[1],g=c[2];switch(f){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(g))return d(e[4]),this.setRGB(Math.min(255,parseInt(e[1],10))/255,Math.min(255,parseInt(e[2],10))/255,Math.min(255,parseInt(e[3],10))/255,b);if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(g))return d(e[4]),this.setRGB(Math.min(100,parseInt(e[1],10))/100,Math.min(100,parseInt(e[2],10))/100,Math.min(100,parseInt(e[3],10))/100,b);break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(g))return d(e[4]),this.setHSL(parseFloat(e[1])/360,parseFloat(e[2])/100,parseFloat(e[3])/100,b);break;default:RW("Color: Unknown color model "+a)}}else if(c=/^\#([A-Fa-f\d]+)$/.exec(a)){let d=c[1],e=d.length;if(3===e)return this.setRGB(parseInt(d.charAt(0),16)/15,parseInt(d.charAt(1),16)/15,parseInt(d.charAt(2),16)/15,b);if(6===e)return this.setHex(parseInt(d,16),b);RW("Color: Invalid hex color "+a)}else if(a&&a.length>0)return this.setColorName(a,b);return this}setColorName(a,b=R2){let c=Sc[a.toLowerCase()];return void 0===c?RW("Color: Unknown color "+a):this.setHex(c,b),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(a){return this.r=a.r,this.g=a.g,this.b=a.b,this}copySRGBToLinear(a){return this.r=Sa(a.r),this.g=Sa(a.g),this.b=Sa(a.b),this}copyLinearToSRGB(a){return this.r=Sb(a.r),this.g=Sb(a.g),this.b=Sb(a.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(a=R2){return R9.workingToColorSpace(Sh.copy(this),a),65536*Math.round(R_(255*Sh.r,0,255))+256*Math.round(R_(255*Sh.g,0,255))+Math.round(R_(255*Sh.b,0,255))}getHexString(a=R2){return("000000"+this.getHex(a).toString(16)).slice(-6)}getHSL(a,b=R9.workingColorSpace){R9.workingToColorSpace(Sh.copy(this),b);let c=Sh.r,d=Sh.g,e=Sh.b,f=Math.max(c,d,e),g=Math.min(c,d,e),h,i,j=(g+f)/2;if(g===f)h=0,i=0;else{let a=f-g;switch(i=j<=.5?a/(f+g):a/(2-f-g),f){case c:h=(d-e)/a+6*(d<e);break;case d:h=(e-c)/a+2;break;case e:h=(c-d)/a+4}h/=6}return a.h=h,a.s=i,a.l=j,a}getRGB(a,b=R9.workingColorSpace){return R9.workingToColorSpace(Sh.copy(this),b),a.r=Sh.r,a.g=Sh.g,a.b=Sh.b,a}getStyle(a=R2){R9.workingToColorSpace(Sh.copy(this),a);let b=Sh.r,c=Sh.g,d=Sh.b;return"srgb"===a?`rgb(${Math.round(255*b)},${Math.round(255*c)},${Math.round(255*d)})`:`color(${a} ${b.toFixed(3)} ${c.toFixed(3)} ${d.toFixed(3)})`}offsetHSL(a,b,c){return this.getHSL(Sd),this.setHSL(Sd.h+a,Sd.s+b,Sd.l+c)}add(a){return this.r+=a.r,this.g+=a.g,this.b+=a.b,this}addColors(a,b){return this.r=a.r+b.r,this.g=a.g+b.g,this.b=a.b+b.b,this}addScalar(a){return this.r+=a,this.g+=a,this.b+=a,this}sub(a){return this.r=Math.max(0,this.r-a.r),this.g=Math.max(0,this.g-a.g),this.b=Math.max(0,this.b-a.b),this}multiply(a){return this.r*=a.r,this.g*=a.g,this.b*=a.b,this}multiplyScalar(a){return this.r*=a,this.g*=a,this.b*=a,this}lerp(a,b){return this.r+=(a.r-this.r)*b,this.g+=(a.g-this.g)*b,this.b+=(a.b-this.b)*b,this}lerpColors(a,b,c){return this.r=a.r+(b.r-a.r)*c,this.g=a.g+(b.g-a.g)*c,this.b=a.b+(b.b-a.b)*c,this}lerpHSL(a,b){var c,d,e,f,g,h,i,j,k;this.getHSL(Sd),a.getHSL(Se);let l=(c=Sd.h,d=Se.h,(1-(e=b))*c+e*d),m=(f=Sd.s,g=Se.s,(1-(h=b))*f+h*g),n=(i=Sd.l,j=Se.l,(1-(k=b))*i+k*j);return this.setHSL(l,m,n),this}setFromVector3(a){return this.r=a.x,this.g=a.y,this.b=a.z,this}applyMatrix3(a){let b=this.r,c=this.g,d=this.b,e=a.elements;return this.r=e[0]*b+e[3]*c+e[6]*d,this.g=e[1]*b+e[4]*c+e[7]*d,this.b=e[2]*b+e[5]*c+e[8]*d,this}equals(a){return a.r===this.r&&a.g===this.g&&a.b===this.b}fromArray(a,b=0){return this.r=a[b],this.g=a[b+1],this.b=a[b+2],this}toArray(a=[],b=0){return a[b]=this.r,a[b+1]=this.g,a[b+2]=this.b,a}fromBufferAttribute(a,b){return this.r=a.getX(b),this.g=a.getY(b),this.b=a.getZ(b),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}},Sh=new Sg;Sg.NAMES=Sc;var Si=class a{constructor(b,c,d,e){a.prototype.isMatrix2=!0,this.elements=[1,0,0,1],void 0!==b&&this.set(b,c,d,e)}identity(){return this.set(1,0,0,1),this}fromArray(a,b=0){for(let c=0;c<4;c++)this.elements[c]=a[c+b];return this}set(a,b,c,d){let e=this.elements;return e[0]=a,e[2]=b,e[1]=c,e[3]=d,this}},Sj=class{constructor(a=0,b=0,c=0,d=1){this.isQuaternion=!0,this._x=a,this._y=b,this._z=c,this._w=d}static slerpFlat(a,b,c,d,e,f,g){let h=c[d+0],i=c[d+1],j=c[d+2],k=c[d+3],l=e[f+0],m=e[f+1],n=e[f+2],o=e[f+3];if(g<=0){a[b+0]=h,a[b+1]=i,a[b+2]=j,a[b+3]=k;return}if(g>=1){a[b+0]=l,a[b+1]=m,a[b+2]=n,a[b+3]=o;return}if(k!==o||h!==l||i!==m||j!==n){let a=h*l+i*m+j*n+k*o;a<0&&(l=-l,m=-m,n=-n,o=-o,a=-a);let b=1-g;if(a<.9995){let c=Math.acos(a),d=Math.sin(c);h=h*(b=Math.sin(b*c)/d)+l*(g=Math.sin(g*c)/d),i=i*b+m*g,j=j*b+n*g,k=k*b+o*g}else{h=h*b+l*g,i=i*b+m*g;let a=1/Math.sqrt(h*h+i*i+(j=j*b+n*g)*j+(k=k*b+o*g)*k);h*=a,i*=a,j*=a,k*=a}}a[b]=h,a[b+1]=i,a[b+2]=j,a[b+3]=k}static multiplyQuaternionsFlat(a,b,c,d,e,f){let g=c[d],h=c[d+1],i=c[d+2],j=c[d+3],k=e[f],l=e[f+1],m=e[f+2],n=e[f+3];return a[b]=g*n+j*k+h*m-i*l,a[b+1]=h*n+j*l+i*k-g*m,a[b+2]=i*n+j*m+g*l-h*k,a[b+3]=j*n-g*k-h*l-i*m,a}get x(){return this._x}set x(a){this._x=a,this._onChangeCallback()}get y(){return this._y}set y(a){this._y=a,this._onChangeCallback()}get z(){return this._z}set z(a){this._z=a,this._onChangeCallback()}get w(){return this._w}set w(a){this._w=a,this._onChangeCallback()}set(a,b,c,d){return this._x=a,this._y=b,this._z=c,this._w=d,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(a){return this._x=a.x,this._y=a.y,this._z=a.z,this._w=a.w,this._onChangeCallback(),this}setFromEuler(a,b=!0){let c=a._x,d=a._y,e=a._z,f=a._order,g=Math.cos,h=Math.sin,i=g(c/2),j=g(d/2),k=g(e/2),l=h(c/2),m=h(d/2),n=h(e/2);switch(f){case"XYZ":this._x=l*j*k+i*m*n,this._y=i*m*k-l*j*n,this._z=i*j*n+l*m*k,this._w=i*j*k-l*m*n;break;case"YXZ":this._x=l*j*k+i*m*n,this._y=i*m*k-l*j*n,this._z=i*j*n-l*m*k,this._w=i*j*k+l*m*n;break;case"ZXY":this._x=l*j*k-i*m*n,this._y=i*m*k+l*j*n,this._z=i*j*n+l*m*k,this._w=i*j*k-l*m*n;break;case"ZYX":this._x=l*j*k-i*m*n,this._y=i*m*k+l*j*n,this._z=i*j*n-l*m*k,this._w=i*j*k+l*m*n;break;case"YZX":this._x=l*j*k+i*m*n,this._y=i*m*k+l*j*n,this._z=i*j*n-l*m*k,this._w=i*j*k-l*m*n;break;case"XZY":this._x=l*j*k-i*m*n,this._y=i*m*k-l*j*n,this._z=i*j*n+l*m*k,this._w=i*j*k+l*m*n;break;default:RW("Quaternion: .setFromEuler() encountered an unknown order: "+f)}return!0===b&&this._onChangeCallback(),this}setFromAxisAngle(a,b){let c=b/2,d=Math.sin(c);return this._x=a.x*d,this._y=a.y*d,this._z=a.z*d,this._w=Math.cos(c),this._onChangeCallback(),this}setFromRotationMatrix(a){let b=a.elements,c=b[0],d=b[4],e=b[8],f=b[1],g=b[5],h=b[9],i=b[2],j=b[6],k=b[10],l=c+g+k;if(l>0){let a=.5/Math.sqrt(l+1);this._w=.25/a,this._x=(j-h)*a,this._y=(e-i)*a,this._z=(f-d)*a}else if(c>g&&c>k){let a=2*Math.sqrt(1+c-g-k);this._w=(j-h)/a,this._x=.25*a,this._y=(d+f)/a,this._z=(e+i)/a}else if(g>k){let a=2*Math.sqrt(1+g-c-k);this._w=(e-i)/a,this._x=(d+f)/a,this._y=.25*a,this._z=(h+j)/a}else{let a=2*Math.sqrt(1+k-c-g);this._w=(f-d)/a,this._x=(e+i)/a,this._y=(h+j)/a,this._z=.25*a}return this._onChangeCallback(),this}setFromUnitVectors(a,b){let c=a.dot(b)+1;return c<1e-8?(c=0,Math.abs(a.x)>Math.abs(a.z)?(this._x=-a.y,this._y=a.x,this._z=0):(this._x=0,this._y=-a.z,this._z=a.y)):(this._x=a.y*b.z-a.z*b.y,this._y=a.z*b.x-a.x*b.z,this._z=a.x*b.y-a.y*b.x),this._w=c,this.normalize()}angleTo(a){return 2*Math.acos(Math.abs(R_(this.dot(a),-1,1)))}rotateTowards(a,b){let c=this.angleTo(a);if(0===c)return this;let d=Math.min(1,b/c);return this.slerp(a,d),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let a=this.length();return 0===a?(this._x=0,this._y=0,this._z=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a),this._onChangeCallback(),this}multiply(a){return this.multiplyQuaternions(this,a)}premultiply(a){return this.multiplyQuaternions(a,this)}multiplyQuaternions(a,b){let c=a._x,d=a._y,e=a._z,f=a._w,g=b._x,h=b._y,i=b._z,j=b._w;return this._x=c*j+f*g+d*i-e*h,this._y=d*j+f*h+e*g-c*i,this._z=e*j+f*i+c*h-d*g,this._w=f*j-c*g-d*h-e*i,this._onChangeCallback(),this}slerp(a,b){if(b<=0)return this;if(b>=1)return this.copy(a);let c=a._x,d=a._y,e=a._z,f=a._w,g=this.dot(a);g<0&&(c=-c,d=-d,e=-e,f=-f,g=-g);let h=1-b;if(g<.9995){let a=Math.acos(g),i=Math.sin(a);h=Math.sin(h*a)/i,b=Math.sin(b*a)/i,this._x=this._x*h+c*b,this._y=this._y*h+d*b,this._z=this._z*h+e*b,this._w=this._w*h+f*b,this._onChangeCallback()}else this._x=this._x*h+c*b,this._y=this._y*h+d*b,this._z=this._z*h+e*b,this._w=this._w*h+f*b,this.normalize();return this}slerpQuaternions(a,b,c){return this.copy(a).slerp(b,c)}random(){let a=2*Math.PI*Math.random(),b=2*Math.PI*Math.random(),c=Math.random(),d=Math.sqrt(1-c),e=Math.sqrt(c);return this.set(d*Math.sin(a),d*Math.cos(a),e*Math.sin(b),e*Math.cos(b))}equals(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w}fromArray(a,b=0){return this._x=a[b],this._y=a[b+1],this._z=a[b+2],this._w=a[b+3],this._onChangeCallback(),this}toArray(a=[],b=0){return a[b]=this._x,a[b+1]=this._y,a[b+2]=this._z,a[b+3]=this._w,a}fromBufferAttribute(a,b){return this._x=a.getX(b),this._y=a.getY(b),this._z=a.getZ(b),this._w=a.getW(b),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(a){return this._onChangeCallback=a,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},Sk=class a{constructor(b=0,c=0,d=0){a.prototype.isVector3=!0,this.x=b,this.y=c,this.z=d}set(a,b,c){return void 0===c&&(c=this.z),this.x=a,this.y=b,this.z=c,this}setScalar(a){return this.x=a,this.y=a,this.z=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setZ(a){return this.z=a,this}setComponent(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(a){return this.x=a.x,this.y=a.y,this.z=a.z,this}add(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this}addScalar(a){return this.x+=a,this.y+=a,this.z+=a,this}addVectors(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this}addScaledVector(a,b){return this.x+=a.x*b,this.y+=a.y*b,this.z+=a.z*b,this}sub(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this}subScalar(a){return this.x-=a,this.y-=a,this.z-=a,this}subVectors(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this}multiply(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this}multiplyScalar(a){return this.x*=a,this.y*=a,this.z*=a,this}multiplyVectors(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this}applyEuler(a){return this.applyQuaternion(Sm.setFromEuler(a))}applyAxisAngle(a,b){return this.applyQuaternion(Sm.setFromAxisAngle(a,b))}applyMatrix3(a){let b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[3]*c+e[6]*d,this.y=e[1]*b+e[4]*c+e[7]*d,this.z=e[2]*b+e[5]*c+e[8]*d,this}applyNormalMatrix(a){return this.applyMatrix3(a).normalize()}applyMatrix4(a){let b=this.x,c=this.y,d=this.z,e=a.elements,f=1/(e[3]*b+e[7]*c+e[11]*d+e[15]);return this.x=(e[0]*b+e[4]*c+e[8]*d+e[12])*f,this.y=(e[1]*b+e[5]*c+e[9]*d+e[13])*f,this.z=(e[2]*b+e[6]*c+e[10]*d+e[14])*f,this}applyQuaternion(a){let b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z,h=a.w,i=2*(f*d-g*c),j=2*(g*b-e*d),k=2*(e*c-f*b);return this.x=b+h*i+f*k-g*j,this.y=c+h*j+g*i-e*k,this.z=d+h*k+e*j-f*i,this}project(a){return this.applyMatrix4(a.matrixWorldInverse).applyMatrix4(a.projectionMatrix)}unproject(a){return this.applyMatrix4(a.projectionMatrixInverse).applyMatrix4(a.matrixWorld)}transformDirection(a){let b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d,this.y=e[1]*b+e[5]*c+e[9]*d,this.z=e[2]*b+e[6]*c+e[10]*d,this.normalize()}divide(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this}divideScalar(a){return this.multiplyScalar(1/a)}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this.z=Math.max(this.z,a.z),this}clamp(a,b){return this.x=R_(this.x,a.x,b.x),this.y=R_(this.y,a.y,b.y),this.z=R_(this.z,a.z,b.z),this}clampScalar(a,b){return this.x=R_(this.x,a,b),this.y=R_(this.y,a,b),this.z=R_(this.z,a,b),this}clampLength(a,b){let c=this.length();return this.divideScalar(c||1).multiplyScalar(R_(c,a,b))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this}lerpVectors(a,b,c){return this.x=a.x+(b.x-a.x)*c,this.y=a.y+(b.y-a.y)*c,this.z=a.z+(b.z-a.z)*c,this}cross(a){return this.crossVectors(this,a)}crossVectors(a,b){let c=a.x,d=a.y,e=a.z,f=b.x,g=b.y,h=b.z;return this.x=d*h-e*g,this.y=e*f-c*h,this.z=c*g-d*f,this}projectOnVector(a){let b=a.lengthSq();if(0===b)return this.set(0,0,0);let c=a.dot(this)/b;return this.copy(a).multiplyScalar(c)}projectOnPlane(a){return Sl.copy(this).projectOnVector(a),this.sub(Sl)}reflect(a){return this.sub(Sl.copy(a).multiplyScalar(2*this.dot(a)))}angleTo(a){let b=Math.sqrt(this.lengthSq()*a.lengthSq());return 0===b?Math.PI/2:Math.acos(R_(this.dot(a)/b,-1,1))}distanceTo(a){return Math.sqrt(this.distanceToSquared(a))}distanceToSquared(a){let b=this.x-a.x,c=this.y-a.y,d=this.z-a.z;return b*b+c*c+d*d}manhattanDistanceTo(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)}setFromSpherical(a){return this.setFromSphericalCoords(a.radius,a.phi,a.theta)}setFromSphericalCoords(a,b,c){let d=Math.sin(b)*a;return this.x=d*Math.sin(c),this.y=Math.cos(b)*a,this.z=d*Math.cos(c),this}setFromCylindrical(a){return this.setFromCylindricalCoords(a.radius,a.theta,a.y)}setFromCylindricalCoords(a,b,c){return this.x=a*Math.sin(b),this.y=c,this.z=a*Math.cos(b),this}setFromMatrixPosition(a){let b=a.elements;return this.x=b[12],this.y=b[13],this.z=b[14],this}setFromMatrixScale(a){let b=this.setFromMatrixColumn(a,0).length(),c=this.setFromMatrixColumn(a,1).length(),d=this.setFromMatrixColumn(a,2).length();return this.x=b,this.y=c,this.z=d,this}setFromMatrixColumn(a,b){return this.fromArray(a.elements,4*b)}setFromMatrix3Column(a,b){return this.fromArray(a.elements,3*b)}setFromEuler(a){return this.x=a._x,this.y=a._y,this.z=a._z,this}setFromColor(a){return this.x=a.r,this.y=a.g,this.z=a.b,this}equals(a){return a.x===this.x&&a.y===this.y&&a.z===this.z}fromArray(a,b=0){return this.x=a[b],this.y=a[b+1],this.z=a[b+2],this}toArray(a=[],b=0){return a[b]=this.x,a[b+1]=this.y,a[b+2]=this.z,a}fromBufferAttribute(a,b){return this.x=a.getX(b),this.y=a.getY(b),this.z=a.getZ(b),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let a=Math.random()*Math.PI*2,b=2*Math.random()-1,c=Math.sqrt(1-b*b);return this.x=c*Math.cos(a),this.y=b,this.z=c*Math.sin(a),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},Sl=new Sk,Sm=new Sj,Sn=class a{constructor(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){a.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==b&&this.set(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q)}set(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){let q=this.elements;return q[0]=a,q[4]=b,q[8]=c,q[12]=d,q[1]=e,q[5]=f,q[9]=g,q[13]=h,q[2]=i,q[6]=j,q[10]=k,q[14]=l,q[3]=m,q[7]=n,q[11]=o,q[15]=p,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new a().fromArray(this.elements)}copy(a){let b=this.elements,c=a.elements;return b[0]=c[0],b[1]=c[1],b[2]=c[2],b[3]=c[3],b[4]=c[4],b[5]=c[5],b[6]=c[6],b[7]=c[7],b[8]=c[8],b[9]=c[9],b[10]=c[10],b[11]=c[11],b[12]=c[12],b[13]=c[13],b[14]=c[14],b[15]=c[15],this}copyPosition(a){let b=this.elements,c=a.elements;return b[12]=c[12],b[13]=c[13],b[14]=c[14],this}setFromMatrix3(a){let b=a.elements;return this.set(b[0],b[3],b[6],0,b[1],b[4],b[7],0,b[2],b[5],b[8],0,0,0,0,1),this}extractBasis(a,b,c){return a.setFromMatrixColumn(this,0),b.setFromMatrixColumn(this,1),c.setFromMatrixColumn(this,2),this}makeBasis(a,b,c){return this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1),this}extractRotation(a){let b=this.elements,c=a.elements,d=1/So.setFromMatrixColumn(a,0).length(),e=1/So.setFromMatrixColumn(a,1).length(),f=1/So.setFromMatrixColumn(a,2).length();return b[0]=c[0]*d,b[1]=c[1]*d,b[2]=c[2]*d,b[3]=0,b[4]=c[4]*e,b[5]=c[5]*e,b[6]=c[6]*e,b[7]=0,b[8]=c[8]*f,b[9]=c[9]*f,b[10]=c[10]*f,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this}makeRotationFromEuler(a){let b=this.elements,c=a.x,d=a.y,e=a.z,f=Math.cos(c),g=Math.sin(c),h=Math.cos(d),i=Math.sin(d),j=Math.cos(e),k=Math.sin(e);if("XYZ"===a.order){let a=f*j,c=f*k,d=g*j,e=g*k;b[0]=h*j,b[4]=-h*k,b[8]=i,b[1]=c+d*i,b[5]=a-e*i,b[9]=-g*h,b[2]=e-a*i,b[6]=d+c*i,b[10]=f*h}else if("YXZ"===a.order){let a=h*j,c=h*k,d=i*j,e=i*k;b[0]=a+e*g,b[4]=d*g-c,b[8]=f*i,b[1]=f*k,b[5]=f*j,b[9]=-g,b[2]=c*g-d,b[6]=e+a*g,b[10]=f*h}else if("ZXY"===a.order){let a=h*j,c=h*k,d=i*j,e=i*k;b[0]=a-e*g,b[4]=-f*k,b[8]=d+c*g,b[1]=c+d*g,b[5]=f*j,b[9]=e-a*g,b[2]=-f*i,b[6]=g,b[10]=f*h}else if("ZYX"===a.order){let a=f*j,c=f*k,d=g*j,e=g*k;b[0]=h*j,b[4]=d*i-c,b[8]=a*i+e,b[1]=h*k,b[5]=e*i+a,b[9]=c*i-d,b[2]=-i,b[6]=g*h,b[10]=f*h}else if("YZX"===a.order){let a=f*h,c=f*i,d=g*h,e=g*i;b[0]=h*j,b[4]=e-a*k,b[8]=d*k+c,b[1]=k,b[5]=f*j,b[9]=-g*j,b[2]=-i*j,b[6]=c*k+d,b[10]=a-e*k}else if("XZY"===a.order){let a=f*h,c=f*i,d=g*h,e=g*i;b[0]=h*j,b[4]=-k,b[8]=i*j,b[1]=a*k+e,b[5]=f*j,b[9]=c*k-d,b[2]=d*k-c,b[6]=g*j,b[10]=e*k+a}return b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this}makeRotationFromQuaternion(a){return this.compose(Sq,a,Sr)}lookAt(a,b,c){let d=this.elements;return Su.subVectors(a,b),0===Su.lengthSq()&&(Su.z=1),Su.normalize(),Ss.crossVectors(c,Su),0===Ss.lengthSq()&&(1===Math.abs(c.z)?Su.x+=1e-4:Su.z+=1e-4,Su.normalize(),Ss.crossVectors(c,Su)),Ss.normalize(),St.crossVectors(Su,Ss),d[0]=Ss.x,d[4]=St.x,d[8]=Su.x,d[1]=Ss.y,d[5]=St.y,d[9]=Su.y,d[2]=Ss.z,d[6]=St.z,d[10]=Su.z,this}multiply(a){return this.multiplyMatrices(this,a)}premultiply(a){return this.multiplyMatrices(a,this)}multiplyMatrices(a,b){let c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],i=c[12],j=c[1],k=c[5],l=c[9],m=c[13],n=c[2],o=c[6],p=c[10],q=c[14],r=c[3],s=c[7],t=c[11],u=c[15],v=d[0],w=d[4],x=d[8],y=d[12],z=d[1],A=d[5],B=d[9],C=d[13],D=d[2],E=d[6],F=d[10],G=d[14],H=d[3],I=d[7],J=d[11],K=d[15];return e[0]=f*v+g*z+h*D+i*H,e[4]=f*w+g*A+h*E+i*I,e[8]=f*x+g*B+h*F+i*J,e[12]=f*y+g*C+h*G+i*K,e[1]=j*v+k*z+l*D+m*H,e[5]=j*w+k*A+l*E+m*I,e[9]=j*x+k*B+l*F+m*J,e[13]=j*y+k*C+l*G+m*K,e[2]=n*v+o*z+p*D+q*H,e[6]=n*w+o*A+p*E+q*I,e[10]=n*x+o*B+p*F+q*J,e[14]=n*y+o*C+p*G+q*K,e[3]=r*v+s*z+t*D+u*H,e[7]=r*w+s*A+t*E+u*I,e[11]=r*x+s*B+t*F+u*J,e[15]=r*y+s*C+t*G+u*K,this}multiplyScalar(a){let b=this.elements;return b[0]*=a,b[4]*=a,b[8]*=a,b[12]*=a,b[1]*=a,b[5]*=a,b[9]*=a,b[13]*=a,b[2]*=a,b[6]*=a,b[10]*=a,b[14]*=a,b[3]*=a,b[7]*=a,b[11]*=a,b[15]*=a,this}determinant(){let a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],i=a[13],j=a[2],k=a[6],l=a[10],m=a[14];return a[3]*(e*h*k-d*i*k-e*g*l+c*i*l+d*g*m-c*h*m)+a[7]*(b*h*m-b*i*l+e*f*l-d*f*m+d*i*j-e*h*j)+a[11]*(b*i*k-b*g*m-e*f*k+c*f*m+e*g*j-c*i*j)+a[15]*(-d*g*j-b*h*k+b*g*l+d*f*k-c*f*l+c*h*j)}transpose(){let a=this.elements,b;return b=a[1],a[1]=a[4],a[4]=b,b=a[2],a[2]=a[8],a[8]=b,b=a[6],a[6]=a[9],a[9]=b,b=a[3],a[3]=a[12],a[12]=b,b=a[7],a[7]=a[13],a[13]=b,b=a[11],a[11]=a[14],a[14]=b,this}setPosition(a,b,c){let d=this.elements;return a.isVector3?(d[12]=a.x,d[13]=a.y,d[14]=a.z):(d[12]=a,d[13]=b,d[14]=c),this}invert(){let a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=k*p*i-o*l*i+o*h*m-g*p*m-k*h*q+g*l*q,s=n*l*i-j*p*i-n*h*m+f*p*m+j*h*q-f*l*q,t=j*o*i-n*k*i+n*g*m-f*o*m-j*g*q+f*k*q,u=n*k*h-j*o*h-n*g*l+f*o*l+j*g*p-f*k*p,v=b*r+c*s+d*t+e*u;if(0===v)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let w=1/v;return a[0]=r*w,a[1]=(o*l*e-k*p*e-o*d*m+c*p*m+k*d*q-c*l*q)*w,a[2]=(g*p*e-o*h*e+o*d*i-c*p*i-g*d*q+c*h*q)*w,a[3]=(k*h*e-g*l*e-k*d*i+c*l*i+g*d*m-c*h*m)*w,a[4]=s*w,a[5]=(j*p*e-n*l*e+n*d*m-b*p*m-j*d*q+b*l*q)*w,a[6]=(n*h*e-f*p*e-n*d*i+b*p*i+f*d*q-b*h*q)*w,a[7]=(f*l*e-j*h*e+j*d*i-b*l*i-f*d*m+b*h*m)*w,a[8]=t*w,a[9]=(n*k*e-j*o*e-n*c*m+b*o*m+j*c*q-b*k*q)*w,a[10]=(f*o*e-n*g*e+n*c*i-b*o*i-f*c*q+b*g*q)*w,a[11]=(j*g*e-f*k*e-j*c*i+b*k*i+f*c*m-b*g*m)*w,a[12]=u*w,a[13]=(j*o*d-n*k*d+n*c*l-b*o*l-j*c*p+b*k*p)*w,a[14]=(n*g*d-f*o*d-n*c*h+b*o*h+f*c*p-b*g*p)*w,a[15]=(f*k*d-j*g*d+j*c*h-b*k*h-f*c*l+b*g*l)*w,this}scale(a){let b=this.elements,c=a.x,d=a.y,e=a.z;return b[0]*=c,b[4]*=d,b[8]*=e,b[1]*=c,b[5]*=d,b[9]*=e,b[2]*=c,b[6]*=d,b[10]*=e,b[3]*=c,b[7]*=d,b[11]*=e,this}getMaxScaleOnAxis(){let a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))}makeTranslation(a,b,c){return a.isVector3?this.set(1,0,0,a.x,0,1,0,a.y,0,0,1,a.z,0,0,0,1):this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1),this}makeRotationX(a){let b=Math.cos(a),c=Math.sin(a);return this.set(1,0,0,0,0,b,-c,0,0,c,b,0,0,0,0,1),this}makeRotationY(a){let b=Math.cos(a),c=Math.sin(a);return this.set(b,0,c,0,0,1,0,0,-c,0,b,0,0,0,0,1),this}makeRotationZ(a){let b=Math.cos(a),c=Math.sin(a);return this.set(b,-c,0,0,c,b,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(a,b){let c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,g=a.y,h=a.z,i=e*f,j=e*g;return this.set(i*f+c,i*g-d*h,i*h+d*g,0,i*g+d*h,j*g+c,j*h-d*f,0,i*h-d*g,j*h+d*f,e*h*h+c,0,0,0,0,1),this}makeScale(a,b,c){return this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1),this}makeShear(a,b,c,d,e,f){return this.set(1,c,e,0,a,1,f,0,b,d,1,0,0,0,0,1),this}compose(a,b,c){let d=this.elements,e=b._x,f=b._y,g=b._z,h=b._w,i=e+e,j=f+f,k=g+g,l=e*i,m=e*j,n=e*k,o=f*j,p=f*k,q=g*k,r=h*i,s=h*j,t=h*k,u=c.x,v=c.y,w=c.z;return d[0]=(1-(o+q))*u,d[1]=(m+t)*u,d[2]=(n-s)*u,d[3]=0,d[4]=(m-t)*v,d[5]=(1-(l+q))*v,d[6]=(p+r)*v,d[7]=0,d[8]=(n+s)*w,d[9]=(p-r)*w,d[10]=(1-(l+o))*w,d[11]=0,d[12]=a.x,d[13]=a.y,d[14]=a.z,d[15]=1,this}decompose(a,b,c){let d=this.elements,e=So.set(d[0],d[1],d[2]).length(),f=So.set(d[4],d[5],d[6]).length(),g=So.set(d[8],d[9],d[10]).length();0>this.determinant()&&(e=-e),a.x=d[12],a.y=d[13],a.z=d[14],Sp.copy(this);let h=1/e,i=1/f,j=1/g;return Sp.elements[0]*=h,Sp.elements[1]*=h,Sp.elements[2]*=h,Sp.elements[4]*=i,Sp.elements[5]*=i,Sp.elements[6]*=i,Sp.elements[8]*=j,Sp.elements[9]*=j,Sp.elements[10]*=j,b.setFromRotationMatrix(Sp),c.x=e,c.y=f,c.z=g,this}makePerspective(a,b,c,d,e,f,g=2e3,h=!1){let i=this.elements,j,k;if(h)j=e/(f-e),k=f*e/(f-e);else if(2e3===g)j=-(f+e)/(f-e),k=-2*f*e/(f-e);else if(2001===g)j=-f/(f-e),k=-f*e/(f-e);else throw Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+g);return i[0]=2*e/(b-a),i[4]=0,i[8]=(b+a)/(b-a),i[12]=0,i[1]=0,i[5]=2*e/(c-d),i[9]=(c+d)/(c-d),i[13]=0,i[2]=0,i[6]=0,i[10]=j,i[14]=k,i[3]=0,i[7]=0,i[11]=-1,i[15]=0,this}makeOrthographic(a,b,c,d,e,f,g=2e3,h=!1){let i=this.elements,j,k;if(h)j=1/(f-e),k=f/(f-e);else if(2e3===g)j=-2/(f-e),k=-(f+e)/(f-e);else if(2001===g)j=-1/(f-e),k=-e/(f-e);else throw Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+g);return i[0]=2/(b-a),i[4]=0,i[8]=0,i[12]=-(b+a)/(b-a),i[1]=0,i[5]=2/(c-d),i[9]=0,i[13]=-(c+d)/(c-d),i[2]=0,i[6]=0,i[10]=j,i[14]=k,i[3]=0,i[7]=0,i[11]=0,i[15]=1,this}equals(a){let b=this.elements,c=a.elements;for(let a=0;a<16;a++)if(b[a]!==c[a])return!1;return!0}fromArray(a,b=0){for(let c=0;c<16;c++)this.elements[c]=a[c+b];return this}toArray(a=[],b=0){let c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a[b+9]=c[9],a[b+10]=c[10],a[b+11]=c[11],a[b+12]=c[12],a[b+13]=c[13],a[b+14]=c[14],a[b+15]=c[15],a}},So=new Sk,Sp=new Sn,Sq=new Sk(0,0,0),Sr=new Sk(1,1,1),Ss=new Sk,St=new Sk,Su=new Sk,Sv=class a{constructor(b=0,c=0){a.prototype.isVector2=!0,this.x=b,this.y=c}get width(){return this.x}set width(a){this.x=a}get height(){return this.y}set height(a){this.y=a}set(a,b){return this.x=a,this.y=b,this}setScalar(a){return this.x=a,this.y=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setComponent(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y)}copy(a){return this.x=a.x,this.y=a.y,this}add(a){return this.x+=a.x,this.y+=a.y,this}addScalar(a){return this.x+=a,this.y+=a,this}addVectors(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this}addScaledVector(a,b){return this.x+=a.x*b,this.y+=a.y*b,this}sub(a){return this.x-=a.x,this.y-=a.y,this}subScalar(a){return this.x-=a,this.y-=a,this}subVectors(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this}multiply(a){return this.x*=a.x,this.y*=a.y,this}multiplyScalar(a){return this.x*=a,this.y*=a,this}divide(a){return this.x/=a.x,this.y/=a.y,this}divideScalar(a){return this.multiplyScalar(1/a)}applyMatrix3(a){let b=this.x,c=this.y,d=a.elements;return this.x=d[0]*b+d[3]*c+d[6],this.y=d[1]*b+d[4]*c+d[7],this}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this}clamp(a,b){return this.x=R_(this.x,a.x,b.x),this.y=R_(this.y,a.y,b.y),this}clampScalar(a,b){return this.x=R_(this.x,a,b),this.y=R_(this.y,a,b),this}clampLength(a,b){let c=this.length();return this.divideScalar(c||1).multiplyScalar(R_(c,a,b))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(a){return this.x*a.x+this.y*a.y}cross(a){return this.x*a.y-this.y*a.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(a){let b=Math.sqrt(this.lengthSq()*a.lengthSq());return 0===b?Math.PI/2:Math.acos(R_(this.dot(a)/b,-1,1))}distanceTo(a){return Math.sqrt(this.distanceToSquared(a))}distanceToSquared(a){let b=this.x-a.x,c=this.y-a.y;return b*b+c*c}manhattanDistanceTo(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this}lerpVectors(a,b,c){return this.x=a.x+(b.x-a.x)*c,this.y=a.y+(b.y-a.y)*c,this}equals(a){return a.x===this.x&&a.y===this.y}fromArray(a,b=0){return this.x=a[b],this.y=a[b+1],this}toArray(a=[],b=0){return a[b]=this.x,a[b+1]=this.y,a}fromBufferAttribute(a,b){return this.x=a.getX(b),this.y=a.getY(b),this}rotateAround(a,b){let c=Math.cos(b),d=Math.sin(b),e=this.x-a.x,f=this.y-a.y;return this.x=e*c-f*d+a.x,this.y=e*d+f*c+a.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Sw=class a{constructor(b=0,c=0,d=0,e=1){a.prototype.isVector4=!0,this.x=b,this.y=c,this.z=d,this.w=e}get width(){return this.z}set width(a){this.z=a}get height(){return this.w}set height(a){this.w=a}set(a,b,c,d){return this.x=a,this.y=b,this.z=c,this.w=d,this}setScalar(a){return this.x=a,this.y=a,this.z=a,this.w=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setZ(a){return this.z=a,this}setW(a){return this.w=a,this}setComponent(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=void 0===a.w?1:a.w,this}add(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this.w+=a.w,this}addScalar(a){return this.x+=a,this.y+=a,this.z+=a,this.w+=a,this}addVectors(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this.w=a.w+b.w,this}addScaledVector(a,b){return this.x+=a.x*b,this.y+=a.y*b,this.z+=a.z*b,this.w+=a.w*b,this}sub(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this.w-=a.w,this}subScalar(a){return this.x-=a,this.y-=a,this.z-=a,this.w-=a,this}subVectors(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this.w=a.w-b.w,this}multiply(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this.w*=a.w,this}multiplyScalar(a){return this.x*=a,this.y*=a,this.z*=a,this.w*=a,this}applyMatrix4(a){let b=this.x,c=this.y,d=this.z,e=this.w,f=a.elements;return this.x=f[0]*b+f[4]*c+f[8]*d+f[12]*e,this.y=f[1]*b+f[5]*c+f[9]*d+f[13]*e,this.z=f[2]*b+f[6]*c+f[10]*d+f[14]*e,this.w=f[3]*b+f[7]*c+f[11]*d+f[15]*e,this}divide(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this.w/=a.w,this}divideScalar(a){return this.multiplyScalar(1/a)}setAxisAngleFromQuaternion(a){this.w=2*Math.acos(a.w);let b=Math.sqrt(1-a.w*a.w);return b<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b),this}setAxisAngleFromRotationMatrix(a){let b,c,d,e,f=a.elements,g=f[0],h=f[4],i=f[8],j=f[1],k=f[5],l=f[9],m=f[2],n=f[6],o=f[10];if(.01>Math.abs(h-j)&&.01>Math.abs(i-m)&&.01>Math.abs(l-n)){if(.1>Math.abs(h+j)&&.1>Math.abs(i+m)&&.1>Math.abs(l+n)&&.1>Math.abs(g+k+o-3))return this.set(1,0,0,0),this;b=Math.PI;let a=(g+1)/2,f=(k+1)/2,p=(o+1)/2,q=(h+j)/4,r=(i+m)/4,s=(l+n)/4;return a>f&&a>p?a<.01?(c=0,d=.707106781,e=.707106781):(d=q/(c=Math.sqrt(a)),e=r/c):f>p?f<.01?(c=.707106781,d=0,e=.707106781):(c=q/(d=Math.sqrt(f)),e=s/d):p<.01?(c=.707106781,d=.707106781,e=0):(c=r/(e=Math.sqrt(p)),d=s/e),this.set(c,d,e,b),this}let p=Math.sqrt((n-l)*(n-l)+(i-m)*(i-m)+(j-h)*(j-h));return .001>Math.abs(p)&&(p=1),this.x=(n-l)/p,this.y=(i-m)/p,this.z=(j-h)/p,this.w=Math.acos((g+k+o-1)/2),this}setFromMatrixPosition(a){let b=a.elements;return this.x=b[12],this.y=b[13],this.z=b[14],this.w=b[15],this}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this.w=Math.min(this.w,a.w),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this.z=Math.max(this.z,a.z),this.w=Math.max(this.w,a.w),this}clamp(a,b){return this.x=R_(this.x,a.x,b.x),this.y=R_(this.y,a.y,b.y),this.z=R_(this.z,a.z,b.z),this.w=R_(this.w,a.w,b.w),this}clampScalar(a,b){return this.x=R_(this.x,a,b),this.y=R_(this.y,a,b),this.z=R_(this.z,a,b),this.w=R_(this.w,a,b),this}clampLength(a,b){let c=this.length();return this.divideScalar(c||1).multiplyScalar(R_(c,a,b))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this.w+=(a.w-this.w)*b,this}lerpVectors(a,b,c){return this.x=a.x+(b.x-a.x)*c,this.y=a.y+(b.y-a.y)*c,this.z=a.z+(b.z-a.z)*c,this.w=a.w+(b.w-a.w)*c,this}equals(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w}fromArray(a,b=0){return this.x=a[b],this.y=a[b+1],this.z=a[b+2],this.w=a[b+3],this}toArray(a=[],b=0){return a[b]=this.x,a[b+1]=this.y,a[b+2]=this.z,a[b+3]=this.w,a}fromBufferAttribute(a,b){return this.x=a.getX(b),this.y=a.getY(b),this.z=a.getZ(b),this.w=a.getW(b),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};function Sx(a,b=0){let c=0xdeadbeef^b,d=0x41c6ce57^b;if(a instanceof Array)for(let b=0,e;b<a.length;b++)c=Math.imul(c^(e=a[b]),0x9e3779b1),d=Math.imul(d^e,0x5f356495);else for(let b=0,e;b<a.length;b++)c=Math.imul(c^(e=a.charCodeAt(b)),0x9e3779b1),d=Math.imul(d^e,0x5f356495);return c=Math.imul(c^c>>>16,0x85ebca6b)^Math.imul(d^d>>>13,0xc2b2ae35),0x100000000*(2097151&(d=Math.imul(d^d>>>16,0x85ebca6b)^Math.imul(c^c>>>13,0xc2b2ae35)))+(c>>>0)}let Sy=a=>Sx(a);function Sz(a){if(null==a)return null;let b=typeof a;return!0===a.isNode?"node":"number"===b?"float":"boolean"===b?"bool":"string"===b?"string":"function"===b?"shader":!0===a.isVector2?"vec2":!0===a.isVector3?"vec3":!0===a.isVector4?"vec4":!0===a.isMatrix2?"mat2":!0===a.isMatrix3?"mat3":!0===a.isMatrix4?"mat4":!0===a.isColor?"color":a instanceof ArrayBuffer?"ArrayBuffer":null}function SA(a,...b){var c;let d=a?a.slice(-4):void 0;return 1===b.length&&("vec2"===d?b=[b[0],b[0]]:"vec3"===d?b=[b[0],b[0],b[0]]:"vec4"===d&&(b=[b[0],b[0],b[0],b[0]])),"color"===a?new Sg(...b):"vec2"===d?new Sv(...b):"vec3"===d?new Sk(...b):"vec4"===d?new Sw(...b):"mat2"===d?new Si(...b):"mat3"===d?new R5(...b):"mat4"===d?new Sn(...b):"bool"===a?b[0]||!1:"float"===a||"int"===a||"uint"===a?b[0]||0:"string"===a?b[0]||"":"ArrayBuffer"===a?(c=b[0],Uint8Array.from(atob(c),a=>a.charCodeAt(0)).buffer):null}var SB=class{addEventListener(a,b){void 0===this._listeners&&(this._listeners={});let c=this._listeners;void 0===c[a]&&(c[a]=[]),-1===c[a].indexOf(b)&&c[a].push(b)}hasEventListener(a,b){let c=this._listeners;return void 0!==c&&void 0!==c[a]&&-1!==c[a].indexOf(b)}removeEventListener(a,b){let c=this._listeners;if(void 0===c)return;let d=c[a];if(void 0!==d){let a=d.indexOf(b);-1!==a&&d.splice(a,1)}}dispatchEvent(a){let b=this._listeners;if(void 0===b)return;let c=b[a.type];if(void 0!==c){a.target=this;let b=c.slice(0);for(let c=0,d=b.length;c<d;c++)b[c].call(this,a);a.target=null}}},SC={analyze:"setup",generate:"analyze"},SD=0,SE=class extends SB{static get type(){return"Node"}constructor(a=null){super(),this.nodeType=a,this.updateType=RQ,this.updateBeforeType=RQ,this.updateAfterType=RQ,this.uuid=R$(),this.version=0,this.name="",this.global=!1,this.parents=!1,this.isNode=!0,this._beforeNodes=null,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:SD++})}set needsUpdate(a){!0===a&&this.version++}get type(){return this.constructor.type}onUpdate(a,b){return this.updateType=b,this.update=a.bind(this),this}onFrameUpdate(a){return this.onUpdate(a,RR)}onRenderUpdate(a){return this.onUpdate(a,"render")}onObjectUpdate(a){return this.onUpdate(a,RS)}onReference(a){return this.updateReference=a.bind(this),this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(let{childNode:a}of this._getChildren())yield a}dispose(){this.dispatchEvent({type:"dispose"})}traverse(a){for(let b of(a(this),this.getChildren()))b.traverse(a)}_getChildren(a=new Set){let b=[];for(let c of(a.add(this),Object.getOwnPropertyNames(this))){let d=this[c];if(!(!0===c.startsWith("_")||a.has(d))){if(!0===Array.isArray(d))for(let a=0;a<d.length;a++){let e=d[a];e&&!0===e.isNode&&b.push({property:c,index:a,childNode:e})}else if(d&&!0===d.isNode)b.push({property:c,childNode:d});else if(d&&Object.getPrototypeOf(d)===Object.prototype)for(let a in d){if(!0===a.startsWith("_"))continue;let e=d[a];e&&!0===e.isNode&&b.push({property:c,index:a,childNode:e})}}}return b}getCacheKey(a=!1,b=null){if(a||(a=this.version!==this._cacheKeyVersion),!0===a||null===this._cacheKey){null===b&&(b=new Set);let c=[];for(let{property:d,childNode:e}of this._getChildren(b))c.push(Sy(d.slice(0,-4)),e.getCacheKey(a,b));this._cacheKey=((...a)=>Sx(a))(Sx(c),this.customCacheKey()),this._cacheKeyVersion=this.version}return this._cacheKey}customCacheKey(){return this.id}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(a){let b=this.getNodeType(a);return a.getElementType(b)}getMemberType(){return"void"}getNodeType(a){let b=a.getNodeProperties(this);return b.outputNode?b.outputNode.getNodeType(a):this.nodeType}getShared(a){let b=this.getHash(a);return a.getNodeFromHash(b)||this}getArrayCount(){return null}setup(a){let b=a.getNodeProperties(this),c=0;for(let a of this.getChildren())b["node"+c++]=a;return b.outputNode||null}analyze(a,b=null){let c=a.increaseUsage(this);if(!0===this.parents){let c=a.getDataFromNode(this,"any");c.stages=c.stages||{},c.stages[a.shaderStage]=c.stages[a.shaderStage]||[],c.stages[a.shaderStage].push(b)}if(1===c)for(let b of Object.values(a.getNodeProperties(this)))b&&!0===b.isNode&&b.build(a,this)}generate(a,b){let{outputNode:c}=a.getNodeProperties(this);if(c&&!0===c.isNode)return c.build(a,b)}updateBefore(){RW("Abstract function.")}updateAfter(){RW("Abstract function.")}update(){RW("Abstract function.")}before(a){return null===this._beforeNodes&&(this._beforeNodes=[]),this._beforeNodes.push(a),this}build(a,b=null){let c=this.getShared(a);if(this!==c)return c.build(a,b);if(null!==this._beforeNodes){let c=this._beforeNodes;for(let d of(this._beforeNodes=null,c))d.build(a,b);this._beforeNodes=c}let d=a.getDataFromNode(this);d.buildStages=d.buildStages||{},d.buildStages[a.buildStage]=!0;let e=SC[a.buildStage];if(e&&!0!==d.buildStages[e]){let b=a.getBuildStage();a.setBuildStage(e),this.build(a),a.setBuildStage(b)}a.addNode(this),a.addChain(this);let f=null,g=a.getBuildStage();if("setup"===g){this.updateReference(a);let b=a.getNodeProperties(this);if(!0!==b.initialized){for(let c of(b.initialized=!0,b.outputNode=this.setup(a)||b.outputNode||null,Object.values(b)))if(c&&!0===c.isNode){if(!0===c.parents){let b=a.getNodeProperties(c);b.parents=b.parents||[],b.parents.push(this)}c.build(a)}}f=b.outputNode}else if("analyze"===g)this.analyze(a,b);else if("generate"===g){if(this.generate.length<2){let c=this.getNodeType(a),d=a.getDataFromNode(this);void 0===(f=d.snippet)?void 0===d.generated?(d.generated=!0,d.snippet=f=this.generate(a)||""):(RW("Node: Recursion detected.",this),f="/* Recursion detected. */"):void 0!==d.flowCodes&&void 0!==a.context.nodeBlock&&a.addFlowCodeHierarchy(this,a.context.nodeBlock),f=a.format(f,c,b)}else f=this.generate(a,b)||"";""===f&&null!==b&&"void"!==b&&"OutputType"!==b&&(RX(`TSL: Invalid generated code, expected a "${b}".`),f=a.generateConst(b))}return a.removeChain(this),a.addSequentialNode(this),f}getSerializeChildren(){return this._getChildren()}serialize(a){let b=this.getSerializeChildren(),c={};for(let{property:d,index:e,childNode:f}of b)void 0===e?c[d]=f.toJSON(a.meta).uuid:(void 0===c[d]&&(c[d]=Number.isInteger(e)?[]:{}),c[d][e]=f.toJSON(a.meta).uuid);Object.keys(c).length>0&&(a.inputNodes=c)}deserialize(a){if(void 0!==a.inputNodes){let b=a.meta.nodes;for(let c in a.inputNodes)if(Array.isArray(a.inputNodes[c])){let d=[];for(let e of a.inputNodes[c])d.push(b[e]);this[c]=d}else if("object"==typeof a.inputNodes[c]){let d={};for(let e in a.inputNodes[c])d[e]=b[a.inputNodes[c][e]];this[c]=d}else this[c]=b[a.inputNodes[c]]}}toJSON(a){let{uuid:b,type:c}=this,d=void 0===a||"string"==typeof a;d&&(a={textures:{},images:{},nodes:{}});let e=a.nodes[b];function f(a){let b=[];for(let c in a){let d=a[c];delete d.metadata,b.push(d)}return b}if(void 0===e&&(e={uuid:b,type:c,meta:a,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},!0!==d&&(a.nodes[e.uuid]=e),this.serialize(e),delete e.meta),d){let b=f(a.textures),c=f(a.images),d=f(a.nodes);b.length>0&&(e.textures=b),c.length>0&&(e.images=c),d.length>0&&(e.nodes=d)}return e}},SF=class extends SE{static get type(){return"TempNode"}constructor(a=null){super(a),this.isTempNode=!0}hasDependencies(a){return a.getDataFromNode(this).usageCount>1}build(a,b){if("generate"===a.getBuildStage()){let c=a.getVectorType(this.getNodeType(a,b)),d=a.getDataFromNode(this);if(void 0!==d.propertyName)return a.format(d.propertyName,c,b);if("void"!==c&&"void"!==b&&this.hasDependencies(a)){let e=super.build(a,c),f=a.getVarFromNode(this,null,c),g=a.getPropertyName(f);return a.addLineFlowCode(`${g} = ${e}`,this),d.snippet=e,d.propertyName=g,a.format(d.propertyName,c,b)}}return super.build(a,b)}},SG=class extends SE{static get type(){return"ArrayElementNode"}constructor(a,b){super(),this.node=a,this.indexNode=b,this.isArrayElementNode=!0}getNodeType(a){return this.node.getElementType(a)}generate(a){let b=this.indexNode.getNodeType(a);return`${this.node.build(a)}[ ${this.indexNode.build(a,!a.isVector(b)&&a.isInteger(b)?b:"uint")} ]`}},SH=class extends SE{static get type(){return"ConvertNode"}constructor(a,b){super(),this.node=a,this.convertTo=b}getNodeType(a){let b=this.node.getNodeType(a),c=null;for(let d of this.convertTo.split("|"))(null===c||a.getTypeLength(b)===a.getTypeLength(d))&&(c=d);return c}serialize(a){super.serialize(a),a.convertTo=this.convertTo}deserialize(a){super.deserialize(a),this.convertTo=a.convertTo}generate(a,b){let c=this.node,d=this.getNodeType(a),e=c.build(a,d);return a.format(e,d,b)}},SI=class extends SF{static get type(){return"JoinNode"}constructor(a=[],b=null){super(b),this.nodes=a}getNodeType(a){return null===this.nodeType?a.getTypeFromLength(this.nodes.reduce((b,c)=>b+a.getTypeLength(c.getNodeType(a)),0)):a.getVectorType(this.nodeType)}generate(a,b){let c=this.getNodeType(a),d=a.getTypeLength(c),e=this.nodes,f=a.getComponentType(c),g=[],h=0;for(let b of e){if(h>=d){RX(`TSL: Length of parameters exceeds maximum length of function '${c}()' type.`);break}let e=b.getNodeType(a),i=a.getTypeLength(e),j;if(h+i>d&&(RX(`TSL: Length of '${c}()' data exceeds maximum length of output type.`),i=d-h,e=a.getTypeFromLength(i)),h+=i,j=b.build(a,e),a.getComponentType(e)!==f){let b=a.getTypeFromLength(i,f);j=a.format(j,e,b)}g.push(j)}let i=`${a.getType(c)}( ${g.join(", ")} )`;return a.format(i,c,b)}},SJ=RT.join(""),SK=class extends SE{static get type(){return"SplitNode"}constructor(a,b="x"){super(),this.node=a,this.components=b,this.isSplitNode=!0}getVectorLength(){let a=this.components.length;for(let b of this.components)a=Math.max(RT.indexOf(b)+1,a);return a}getComponentType(a){return a.getComponentType(this.node.getNodeType(a))}getNodeType(a){return a.getTypeFromLength(this.components.length,this.getComponentType(a))}getScope(){return this.node.getScope()}generate(a,b){let c=this.node,d=a.getTypeLength(c.getNodeType(a)),e=null;if(d>1){let f=null;this.getVectorLength()>=d&&(f=a.getTypeFromLength(this.getVectorLength(),this.getComponentType(a)));let g=c.build(a,f);e=this.components.length===d&&this.components===SJ.slice(0,this.components.length)?a.format(g,f,b):a.format(`${g}.${this.components}`,this.getNodeType(a),b)}else e=c.build(a,b);return e}serialize(a){super.serialize(a),a.components=this.components}deserialize(a){super.deserialize(a),this.components=a.components}},SL=class extends SF{static get type(){return"SetNode"}constructor(a,b,c){super(),this.sourceNode=a,this.components=b,this.targetNode=c}getNodeType(a){return this.sourceNode.getNodeType(a)}generate(a){let{sourceNode:b,components:c,targetNode:d}=this,e=this.getNodeType(a),f=a.getComponentType(d.getNodeType(a)),g=a.getTypeFromLength(c.length,f),h=d.build(a,g),i=b.build(a,e),j=a.getTypeLength(e),k=[];for(let a=0;a<j;a++){let b=RT[a];b===c[0]?(k.push(h),a+=c.length-1):k.push(i+"."+b)}return`${a.getType(e)}( ${k.join(", ")} )`}},SM=class extends SF{static get type(){return"FlipNode"}constructor(a,b){super(),this.sourceNode=a,this.components=b}getNodeType(a){return this.sourceNode.getNodeType(a)}generate(a){let{components:b,sourceNode:c}=this,d=this.getNodeType(a),e=c.build(a),f=a.getVarFromNode(this),g=a.getPropertyName(f);a.addLineFlowCode(g+" = "+e,this);let h=a.getTypeLength(d),i=[],j=0;for(let a=0;a<h;a++){let c=RT[a];c===b[j]?(i.push("1.0 - "+g+"."+c),j++):i.push(g+"."+c)}return`${a.getType(d)}( ${i.join(", ")} )`}},SN=class extends SE{static get type(){return"InputNode"}constructor(a,b=null){super(b),this.isInputNode=!0,this.value=a,this.precision=null}getNodeType(){return null===this.nodeType?Sz(this.value):this.nodeType}getInputType(a){return this.getNodeType(a)}setPrecision(a){return this.precision=a,this}serialize(a){super.serialize(a),a.value=this.value,this.value&&this.value.toArray&&(a.value=this.value.toArray()),a.valueType=Sz(this.value),a.nodeType=this.nodeType,"ArrayBuffer"===a.valueType&&(a.value=function(a){let b="",c=new Uint8Array(a);for(let a=0;a<c.length;a++)b+=String.fromCharCode(c[a]);return btoa(b)}(a.value)),a.precision=this.precision}deserialize(a){super.deserialize(a),this.nodeType=a.nodeType,this.value=Array.isArray(a.value)?SA(a.valueType,...a.value):a.value,this.precision=a.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(a.value))}generate(){RW("Abstract function.")}},SO=/float|u?int/,SP=class extends SN{static get type(){return"ConstNode"}constructor(a,b=null){super(a,b),this.isConstNode=!0}generateConst(a){return a.generateConst(this.getNodeType(a),this.value)}generate(a,b){let c=this.getNodeType(a);return SO.test(c)&&SO.test(b)?a.generateConst(b,this.value):a.format(this.generateConst(a),c,b)}},SQ=class extends SE{static get type(){return"MemberNode"}constructor(a,b){super(),this.structNode=a,this.property=b,this.isMemberNode=!0}hasMember(a){return(!this.structNode.isMemberNode||!1!==this.structNode.hasMember(a))&&"void"!==this.structNode.getMemberType(a,this.property)}getNodeType(a){return!1===this.hasMember(a)?"float":this.structNode.getMemberType(a,this.property)}getMemberType(a,b){if(!1===this.hasMember(a))return"float";let c=this.getNodeType(a);return a.getStructTypeNode(c).getMemberType(a,b)}generate(a){if(!1===this.hasMember(a)){RW(`TSL: Member "${this.property}" does not exist in struct.`);let b=this.getNodeType(a);return a.generateConst(b)}return this.structNode.build(a)+"."+this.property}},SR=new Map;function SS(a,b){if(SR.has(a))return void RW(`TSL: Redefinition of method chaining '${a}'.`);if("function"!=typeof b)throw Error(`THREE.TSL: Node element ${a} is not a function`);SR.set(a,b),"assign"!==a&&(SE.prototype[a]=function(...a){return this.isStackNode?this.addToStack(b(...a)):b(this,...a)},SE.prototype[a+"Assign"]=function(...a){return this.isStackNode?this.assign(a[0],b(...a)):this.assign(b(this,...a))})}var ST=a=>a.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w").split("").sort().join("");SE.prototype.assign=function(...a){if(!0!==this.isStackNode)return RX("TSL: No stack defined for assign operation. Make sure the assign is inside a Fn()."),this;{let b=SR.get("assign");return this.addToStack(b(...a))}},SE.prototype.toVarIntent=function(){return this},SE.prototype.get=function(a){return new SQ(this,a)};var SU={};function SV(a,b,c){SU[a]=SU[b]=SU[c]={get(){this._cache=this._cache||{};let b=this._cache[a];return void 0===b&&(b=new SK(this,a),this._cache[a]=b),b},set(b){this[a].assign(Td(b))}};let d=a.toUpperCase(),e=b.toUpperCase(),f=c.toUpperCase();SE.prototype["set"+d]=SE.prototype["set"+e]=SE.prototype["set"+f]=function(b){return new SL(this,ST(a),Td(b))},SE.prototype["flip"+d]=SE.prototype["flip"+e]=SE.prototype["flip"+f]=function(){return new SM(this,ST(a))}}var SW=["x","y","z","w"],SX=["r","g","b","a"],SY=["s","t","p","q"];for(let a=0;a<4;a++){let b=SW[a],c=SX[a],d=SY[a];SV(b,c,d);for(let e=0;e<4;e++){b=SW[a]+SW[e],SV(b,c=SX[a]+SX[e],d=SY[a]+SY[e]);for(let f=0;f<4;f++){b=SW[a]+SW[e]+SW[f],SV(b,c=SX[a]+SX[e]+SX[f],d=SY[a]+SY[e]+SY[f]);for(let g=0;g<4;g++)b=SW[a]+SW[e]+SW[f]+SW[g],SV(b,c=SX[a]+SX[e]+SX[f]+SX[g],d=SY[a]+SY[e]+SY[f]+SY[g])}}}for(let a=0;a<32;a++)SU[a]={get(){this._cache=this._cache||{};let b=this._cache[a];return void 0===b&&(b=new SG(this,new SP(a,"uint")),this._cache[a]=b),b},set(b){this[a].assign(Td(b))}};Object.defineProperties(SE.prototype,SU);var SZ=new WeakMap,S$=function(a,b=null){let c=Sz(a);return"node"===c?a:null===b&&("float"===c||"boolean"===c)||c&&"shader"!==c&&"string"!==c?Td(Ta(a,b)):"shader"===c?a.isFn?a:Tl(a):a},S_=function(a,b=null){for(let c in a)a[c]=Td(a[c],b);return a},S0=function(a,b=null){let c=a.length;for(let d=0;d<c;d++)a[d]=Td(a[d],b);return a},S1=function(a,b=null,c=null,d=null){function e(a){return null===d?a=Td(a):(a=Td(Object.assign(a,d)),!0===d.intent&&(a=a.toVarIntent())),a}let f,g=b,h,i;function j(b){let c;return c=g?/[a-z]/i.test(g)?g+"()":g:a.type,void 0!==h&&b.length<h?(RX(`TSL: "${c}" parameter length is less than minimum required.`),b.concat(Array(h-b.length).fill(0))):void 0!==i&&b.length>i?(RX(`TSL: "${c}" parameter length exceeds limit.`),b.slice(0,i)):b}return null===b?f=(...b)=>e(new a(...Tg(j(b)))):null===c?f=(...c)=>e(new a(b,...Tg(j(c)))):(c=Td(c),f=(...d)=>e(new a(b,...Tg(j(d)),c))),f.setParameterLength=(...a)=>(1===a.length?h=i=a[0]:2===a.length&&([h,i]=a),f),f.setName=a=>(g=a,f),f},S2=class extends SE{constructor(a,b){super(),this.shaderNode=a,this.rawInputs=b,this.isShaderCallNodeInternal=!0}getNodeType(a){return this.shaderNode.nodeType||this.getOutputNode(a).getNodeType(a)}getElementType(a){return this.getOutputNode(a).getElementType(a)}getMemberType(a,b){return this.getOutputNode(a).getMemberType(a,b)}call(a){var b,c;let{shaderNode:d,rawInputs:e}=this,f=a.getNodeProperties(d),g=a.getClosestSubBuild(d.subBuilds)||"",h=g||"default";if(f[h])return f[h];let i=a.subBuildFn,j=a.fnCall;a.subBuildFn=g,a.fnCall=this;let k=null;if(d.layout){let c=SZ.get(a.constructor);void 0===c&&(c=new WeakMap,SZ.set(a.constructor,c));let f=c.get(d);void 0===f&&(f=Td(a.buildFunctionNode(d)),c.set(d,f)),a.addInclude(f);let g=e?(Tf(b=e),b[0]&&(b[0].isNode||Object.getPrototypeOf(b[0])!==Object.prototype)?[...b]:b[0]):null;k=Td(f.call(g))}else{let b,f=new Proxy(a,{get:(a,b,c)=>Symbol.iterator===b?function*(){yield}:Reflect.get(a,b,c)}),g=e?(b=0,Tf(c=e),new Proxy(c,{get:(a,d,e)=>{let f;if("length"===d)return c.length;if(Symbol.iterator===d)f=function*(){for(let a of c)yield Td(a)};else{if(c.length>0)if(Object.getPrototypeOf(c[0])===Object.prototype){let a=c[0];f=void 0===a[d]?a[b++]:Reflect.get(a,d,e)}else c[0]instanceof SE&&(f=void 0===c[d]?c[b++]:Reflect.get(c,d,e));else f=Reflect.get(a,d,e);f=Td(f)}return f}})):null,h=Array.isArray(e)?e.length>0:null!==e,i=d.jsFunc;k=Td(h||i.length>1?i(g,f):i(f))}return a.subBuildFn=i,a.fnCall=j,d.once&&(f[h]=k),k}setupOutput(a){return a.addStack(),a.stack.outputNode=this.call(a),a.removeStack()}getOutputNode(a){let b=a.getNodeProperties(this),c=a.getSubBuildOutput(this);return b[c]=b[c]||this.setupOutput(a),b[c].subBuild=a.getClosestSubBuild(this),b[c]}build(a,b=null){let c=null,d=a.getBuildStage(),e=a.getNodeProperties(this),f=a.getSubBuildOutput(this),g=this.getOutputNode(a),h=a.fnCall;if(a.fnCall=this,"setup"===d){let b=a.getSubBuildProperty("initialized",this);if(!0!==e[b]&&(e[b]=!0,e[f]=this.getOutputNode(a),e[f].build(a),this.shaderNode.subBuilds))for(let b of a.chaining){let c=a.getDataFromNode(b,"any");for(let a of(c.subBuilds=c.subBuilds||new Set,this.shaderNode.subBuilds))c.subBuilds.add(a)}c=e[f]}else"analyze"===d?g.build(a,b):"generate"===d&&(c=g.build(a,b)||"");return a.fnCall=h,c}},S3=class extends SE{constructor(a,b){super(b),this.jsFunc=a,this.layout=null,this.global=!0,this.once=!1}setLayout(a){return this.layout=a,this}getLayout(){return this.layout}call(a=null){return new S2(this,a)}setup(){return this.call()}},S4=[.5,1.5,1/3,1e-6,1e6,Math.PI,2*Math.PI,1/Math.PI,2/Math.PI,1/(2*Math.PI),Math.PI/2],S5=new Map;for(let a of[!1,!0])S5.set(a,new SP(a));var S6=new Map;for(let a of[0,1,2,3])S6.set(a,new SP(a,"uint"));var S7=new Map([...S6].map(a=>new SP(a.value,"int")));for(let a of[-1,-2])S7.set(a,new SP(a,"int"));var S8=new Map([...S7].map(a=>new SP(a.value)));for(let a of S4)S8.set(a,new SP(a));for(let a of S4)S8.set(-a,new SP(-a));var S9=new Map([...S5,...S8]),Ta=(a,b)=>S9.has(a)?S9.get(a):!0===a.isNode?a:new SP(a,b),Tb=function(a,b=null){return(...c)=>{for(let b of c)if(void 0===b)return RX(`TSL: Invalid parameter for the type "${a}".`),Td(new SP(0,a));if((0===c.length||!["bool","float","int","uint"].includes(a)&&c.every(a=>{let b=typeof a;return"object"!==b&&"function"!==b}))&&(c=[SA(a,...c)]),1===c.length&&null!==b&&b.has(c[0]))return Te(b.get(c[0]));if(1===c.length){let b=Ta(c[0],a);return b.nodeType===a?Te(b):Te(new SH(b,a))}return Te(new SI(c.map(a=>Ta(a)),a))}};function Tc(a,b){return new S3(a,b)}let Td=(a,b=null)=>S$(a,b),Te=(a,b=null)=>Td(a,b).toVarIntent(),Tf=(a,b=null)=>new S_(a,b),Tg=(a,b=null)=>new S0(a,b),Th=(a,b=null,c=null,d=null)=>new S1(a,b,c,d),Ti=(a,b=null,c=null,d={})=>new S1(a,b,c,{...d,intent:!0});var Tj=0,Tk=class extends SE{constructor(a,b=null){super();let c=null;null!==b&&("object"==typeof b?c=b.return:("string"==typeof b?c=b:RX("TSL: Invalid layout type."),b=null)),this.shaderNode=new Tc(a,c),null!==b&&this.setLayout(b),this.isFn=!0}setLayout(a){let b=this.shaderNode.nodeType;if("object"!=typeof a.inputs){let c={name:"fn"+Tj++,type:b,inputs:[]};for(let b in a)"return"!==b&&c.inputs.push({name:b,type:a[b]});a=c}return this.shaderNode.setLayout(a),this}getNodeType(a){return this.shaderNode.getNodeType(a)||"float"}call(...a){let b=this.shaderNode.call(a);return"void"===this.shaderNode.nodeType&&b.toStack(),b.toVarIntent()}once(a=null){return this.shaderNode.once=!0,this.shaderNode.subBuilds=a,this}generate(a){let b=this.getNodeType(a);return RX('TSL: "Fn()" was declared but not invoked. Try calling it like "Fn()( ...params )".'),a.generateConst(b)}};function Tl(a,b=null){let c=new Tk(a,b);return new Proxy(()=>{},{apply:(a,b,d)=>c.call(...d),get:(a,b,d)=>Reflect.get(c,b,d),set:(a,b,d,e)=>Reflect.set(c,b,d,e)})}SS("toStack",function(a){return a});let Tm=new Tb("color"),Tn=new Tb("float",S8),To=new Tb("int",S7),Tp=new Tb("uint",S6),Tq=new Tb("bool",S5),Tr=new Tb("vec2"),Ts=new Tb("ivec2"),Tt=new Tb("uvec2"),Tu=new Tb("bvec2"),Tv=new Tb("vec3"),Tw=new Tb("ivec3"),Tx=new Tb("uvec3"),Ty=new Tb("bvec3"),Tz=new Tb("vec4"),TA=new Tb("ivec4"),TB=new Tb("uvec4"),TC=new Tb("bvec4"),TD=new Tb("mat2"),TE=new Tb("mat3"),TF=new Tb("mat4");SS("toColor",Tm),SS("toFloat",Tn),SS("toInt",To),SS("toUint",Tp),SS("toBool",Tq),SS("toVec2",Tr),SS("toIVec2",Ts),SS("toUVec2",Tt),SS("toBVec2",Tu),SS("toVec3",Tv),SS("toIVec3",Tw),SS("toUVec3",Tx),SS("toBVec3",Ty),SS("toVec4",Tz),SS("toIVec4",TA),SS("toUVec4",TB),SS("toBVec4",TC),SS("toMat2",TD),SS("toMat3",TE),SS("toMat4",TF),SS("element",Th(SG).setParameterLength(2)),SS("convert",(a,b)=>Td(new SH(Td(a),b))),SS("append",a=>(RW("TSL: .append() has been renamed to .toStack()."),a));var TG={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"},TH=class a extends SF{static get type(){return"OperatorNode"}constructor(b,c,d,...e){if(super(),e.length>0){let f=new a(b,c,d);for(let c=0;c<e.length-1;c++)f=new a(b,f,e[c]);c=f,d=e[e.length-1]}this.op=b,this.aNode=c,this.bNode=d,this.isOperatorNode=!0}getOperatorMethod(a,b){return a.getMethod(TG[this.op],b)}getNodeType(a,b=null){let c=this.op,d=this.aNode,e=this.bNode,f=d.getNodeType(a),g=e?e.getNodeType(a):null;if("void"===f||"void"===g)return b||"void";if("%"===c)return f;if("~"===c||"&"===c||"|"===c||"^"===c||">>"===c||"<<"===c)return a.getIntegerType(f);if("!"===c||"&&"===c||"||"===c||"^^"===c)return"bool";if("=="===c||"!="===c||"<"===c||">"===c||"<="===c||">="===c){let b=Math.max(a.getTypeLength(f),a.getTypeLength(g));return b>1?`bvec${b}`:"bool"}if(a.isMatrix(f)){if("float"===g)return f;if(a.isVector(g))return a.getVectorFromMatrix(f);if(a.isMatrix(g))return f}else if(a.isMatrix(g)){if("float"===f)return g;if(a.isVector(f))return a.getVectorFromMatrix(g)}return a.getTypeLength(g)>a.getTypeLength(f)?g:f}generate(a,b){let c=this.op,{aNode:d,bNode:e}=this,f=this.getNodeType(a,b),g=null,h=null;"void"===f?g=h=f:(g=d.getNodeType(a),h=e?e.getNodeType(a):null,"<"===c||">"===c||"<="===c||">="===c||"=="===c||"!="===c?a.isVector(g)?h=g:a.isVector(h)?g=h:g!==h&&(g=h="float"):">>"===c||"<<"===c?(g=f,h=a.changeComponentType(h,"uint")):"%"===c?(g=f,h=a.isInteger(g)&&a.isInteger(h)?h:g):a.isMatrix(g)?"float"===h?h="float":a.isVector(h)?h=a.getVectorFromMatrix(g):a.isMatrix(h)||(g=h=f):g=a.isMatrix(h)?"float"===g?"float":a.isVector(g)?a.getVectorFromMatrix(h):h=f:h=f);let i=d.build(a,g),j=e?e.build(a,h):null,k=a.getFunctionOperator(c);if("void"!==b){let d=2e3===a.renderer.coordinateSystem;if("=="===c||"!="===c||"<"===c||">"===c||"<="===c||">="===c)return d&&a.isVector(g)?a.format(`${this.getOperatorMethod(a,b)}( ${i}, ${j} )`,f,b):a.format(`( ${i} ${c} ${j} )`,f,b);if("%"===c)return a.isInteger(h)?a.format(`( ${i} % ${j} )`,f,b):a.format(`${this.getOperatorMethod(a,f)}( ${i}, ${j} )`,f,b);if("!"===c||"~"===c)return a.format(`(${c}${i})`,g,b);if(k)return a.format(`${k}( ${i}, ${j} )`,f,b);if(a.isMatrix(g)&&"float"===h)return a.format(`( ${j} ${c} ${i} )`,f,b);if("float"===g&&a.isMatrix(h))return a.format(`${i} ${c} ${j}`,f,b);{let e=`( ${i} ${c} ${j} )`;return!d&&"bool"===f&&a.isVector(g)&&a.isVector(h)&&(e=`all${e}`),a.format(e,f,b)}}if("void"!==g)return k?a.format(`${k}( ${i}, ${j} )`,f,b):a.isMatrix(g)&&"float"===h?a.format(`${j} ${c} ${i}`,f,b):a.format(`${i} ${c} ${j}`,f,b)}serialize(a){super.serialize(a),a.op=this.op}deserialize(a){super.deserialize(a),this.op=a.op}};let TI=Ti(TH,"+").setParameterLength(2,1/0).setName("add"),TJ=Ti(TH,"-").setParameterLength(2,1/0).setName("sub"),TK=Ti(TH,"*").setParameterLength(2,1/0).setName("mul"),TL=Ti(TH,"/").setParameterLength(2,1/0).setName("div"),TM=Ti(TH,"%").setParameterLength(2).setName("mod"),TN=Ti(TH,"==").setParameterLength(2).setName("equal"),TO=Ti(TH,"!=").setParameterLength(2).setName("notEqual"),TP=Ti(TH,"<").setParameterLength(2).setName("lessThan"),TQ=Ti(TH,">").setParameterLength(2).setName("greaterThan"),TR=Ti(TH,"<=").setParameterLength(2).setName("lessThanEqual"),TS=Ti(TH,">=").setParameterLength(2).setName("greaterThanEqual"),TT=Ti(TH,"&&").setParameterLength(2,1/0).setName("and"),TU=Ti(TH,"||").setParameterLength(2,1/0).setName("or"),TV=Ti(TH,"!").setParameterLength(1).setName("not"),TW=Ti(TH,"^^").setParameterLength(2).setName("xor"),TX=Ti(TH,"&").setParameterLength(2).setName("bitAnd"),TY=Ti(TH,"~").setParameterLength(1).setName("bitNot"),TZ=Ti(TH,"|").setParameterLength(2).setName("bitOr"),T$=Ti(TH,"^").setParameterLength(2).setName("bitXor"),T_=Ti(TH,"<<").setParameterLength(2).setName("shiftLeft"),T0=Ti(TH,">>").setParameterLength(2).setName("shiftRight"),T1=Tl(([a])=>(a.addAssign(1),a)),T2=Tl(([a])=>(a.subAssign(1),a)),T3=Tl(([a])=>{let b=To(a).toConst();return a.addAssign(1),b}),T4=Tl(([a])=>{let b=To(a).toConst();return a.subAssign(1),b});SS("add",TI),SS("sub",TJ),SS("mul",TK),SS("div",TL),SS("mod",TM),SS("equal",TN),SS("notEqual",TO),SS("lessThan",TP),SS("greaterThan",TQ),SS("lessThanEqual",TR),SS("greaterThanEqual",TS),SS("and",TT),SS("or",TU),SS("not",TV),SS("xor",TW),SS("bitAnd",TX),SS("bitNot",TY),SS("bitOr",TZ),SS("bitXor",T$),SS("shiftLeft",T_),SS("shiftRight",T0),SS("incrementBefore",T1),SS("decrementBefore",T2),SS("increment",T3),SS("decrement",T4),SS("modInt",(a,b)=>(RW('TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),TM(To(a),To(b))));var T5=class a extends SF{static get type(){return"MathNode"}constructor(b,c,d=null,e=null){if(super(),(b===a.MAX||b===a.MIN)&&arguments.length>3){let f=new a(b,c,d);for(let c=2;c<arguments.length-1;c++)f=new a(b,f,arguments[c]);c=f,d=arguments[arguments.length-1],e=null}this.method=b,this.aNode=c,this.bNode=d,this.cNode=e,this.isMathNode=!0}getInputType(a){let b=this.aNode.getNodeType(a),c=this.bNode?this.bNode.getNodeType(a):null,d=this.cNode?this.cNode.getNodeType(a):null,e=a.isMatrix(b)?0:a.getTypeLength(b),f=a.isMatrix(c)?0:a.getTypeLength(c),g=a.isMatrix(d)?0:a.getTypeLength(d);return e>f&&e>g?b:f>g?c:g>e?d:b}getNodeType(b){let c=this.method;return c===a.LENGTH||c===a.DISTANCE||c===a.DOT?"float":c===a.CROSS?"vec3":c===a.ALL||c===a.ANY?"bool":c===a.EQUALS?b.changeComponentType(this.aNode.getNodeType(b),"bool"):this.getInputType(b)}setup(b){let{aNode:c,bNode:d,method:e}=this,f=null;if(e===a.ONE_MINUS)f=TJ(1,c);else if(e===a.RECIPROCAL)f=TL(1,c);else if(e===a.DIFFERENCE)f=Ur(TJ(c,d));else if(e===a.TRANSFORM_DIRECTION){let a=c,e=d;b.isMatrix(a.getNodeType(b))?e=Tz(Tv(e),0):a=Tz(Tv(a),0),f=Uj(TK(a,e).xyz)}return null===f?super.setup(b):f}generate(b,c){if(b.getNodeProperties(this).outputNode)return super.generate(b,c);let d=this.method,e=this.getNodeType(b),f=this.getInputType(b),g=this.aNode,h=this.bNode,i=this.cNode,j=b.renderer.coordinateSystem;if(d===a.NEGATE)return b.format("( - "+g.build(b,f)+" )",e,c);{let k=[];return d===a.CROSS?k.push(g.build(b,e),h.build(b,e)):2e3===j&&d===a.STEP?k.push(g.build(b,1===b.getTypeLength(g.getNodeType(b))?"float":f),h.build(b,f)):2e3===j&&(d===a.MIN||d===a.MAX)?k.push(g.build(b,f),h.build(b,1===b.getTypeLength(h.getNodeType(b))?"float":f)):d===a.REFRACT?k.push(g.build(b,f),h.build(b,f),i.build(b,"float")):d===a.MIX?k.push(g.build(b,f),h.build(b,f),i.build(b,1===b.getTypeLength(i.getNodeType(b))?"float":f)):(2001===j&&d===a.ATAN&&null!==h&&(d="atan2"),"fragment"!==b.shaderStage&&(d===a.DFDX||d===a.DFDY)&&(RW(`TSL: '${d}' is not supported in the ${b.shaderStage} stage.`),d="/*"+d+"*/"),k.push(g.build(b,f)),null!==h&&k.push(h.build(b,f)),null!==i&&k.push(i.build(b,f))),b.format(`${b.getMethod(d,e)}( ${k.join(", ")} )`,e,c)}}serialize(a){super.serialize(a),a.method=this.method}deserialize(a){super.deserialize(a),this.method=a.method}};T5.ALL="all",T5.ANY="any",T5.RADIANS="radians",T5.DEGREES="degrees",T5.EXP="exp",T5.EXP2="exp2",T5.LOG="log",T5.LOG2="log2",T5.SQRT="sqrt",T5.INVERSE_SQRT="inversesqrt",T5.FLOOR="floor",T5.CEIL="ceil",T5.NORMALIZE="normalize",T5.FRACT="fract",T5.SIN="sin",T5.COS="cos",T5.TAN="tan",T5.ASIN="asin",T5.ACOS="acos",T5.ATAN="atan",T5.ABS="abs",T5.SIGN="sign",T5.LENGTH="length",T5.NEGATE="negate",T5.ONE_MINUS="oneMinus",T5.DFDX="dFdx",T5.DFDY="dFdy",T5.ROUND="round",T5.RECIPROCAL="reciprocal",T5.TRUNC="trunc",T5.FWIDTH="fwidth",T5.TRANSPOSE="transpose",T5.DETERMINANT="determinant",T5.INVERSE="inverse",T5.EQUALS="equals",T5.MIN="min",T5.MAX="max",T5.STEP="step",T5.REFLECT="reflect",T5.DISTANCE="distance",T5.DIFFERENCE="difference",T5.DOT="dot",T5.CROSS="cross",T5.POW="pow",T5.TRANSFORM_DIRECTION="transformDirection",T5.MIX="mix",T5.CLAMP="clamp",T5.REFRACT="refract",T5.SMOOTHSTEP="smoothstep",T5.FACEFORWARD="faceforward";let T6=Tn(Math.PI),T7=Ti(T5,T5.ALL).setParameterLength(1),T8=Ti(T5,T5.ANY).setParameterLength(1),T9=Ti(T5,T5.RADIANS).setParameterLength(1),Ua=Ti(T5,T5.DEGREES).setParameterLength(1),Ub=Ti(T5,T5.EXP).setParameterLength(1),Uc=Ti(T5,T5.EXP2).setParameterLength(1),Ud=Ti(T5,T5.LOG).setParameterLength(1),Ue=Ti(T5,T5.LOG2).setParameterLength(1),Uf=Ti(T5,T5.SQRT).setParameterLength(1),Ug=Ti(T5,T5.INVERSE_SQRT).setParameterLength(1),Uh=Ti(T5,T5.FLOOR).setParameterLength(1),Ui=Ti(T5,T5.CEIL).setParameterLength(1),Uj=Ti(T5,T5.NORMALIZE).setParameterLength(1),Uk=Ti(T5,T5.FRACT).setParameterLength(1),Ul=Ti(T5,T5.SIN).setParameterLength(1),Um=Ti(T5,T5.COS).setParameterLength(1),Un=Ti(T5,T5.TAN).setParameterLength(1),Uo=Ti(T5,T5.ASIN).setParameterLength(1),Up=Ti(T5,T5.ACOS).setParameterLength(1),Uq=Ti(T5,T5.ATAN).setParameterLength(1,2),Ur=Ti(T5,T5.ABS).setParameterLength(1),Us=Ti(T5,T5.SIGN).setParameterLength(1),Ut=Ti(T5,T5.LENGTH).setParameterLength(1),Uu=Ti(T5,T5.NEGATE).setParameterLength(1),Uv=Ti(T5,T5.ONE_MINUS).setParameterLength(1),Uw=Ti(T5,T5.DFDX).setParameterLength(1),Ux=Ti(T5,T5.DFDY).setParameterLength(1),Uy=Ti(T5,T5.ROUND).setParameterLength(1),Uz=Ti(T5,T5.RECIPROCAL).setParameterLength(1),UA=Ti(T5,T5.TRUNC).setParameterLength(1),UB=Ti(T5,T5.FWIDTH).setParameterLength(1),UC=Ti(T5,T5.TRANSPOSE).setParameterLength(1),UD=Ti(T5,T5.DETERMINANT).setParameterLength(1),UE=Ti(T5,T5.INVERSE).setParameterLength(1),UF=Ti(T5,T5.MIN).setParameterLength(2,1/0),UG=Ti(T5,T5.MAX).setParameterLength(2,1/0),UH=Ti(T5,T5.STEP).setParameterLength(2),UI=Ti(T5,T5.REFLECT).setParameterLength(2),UJ=Ti(T5,T5.DISTANCE).setParameterLength(2),UK=Ti(T5,T5.DIFFERENCE).setParameterLength(2),UL=Ti(T5,T5.DOT).setParameterLength(2),UM=Ti(T5,T5.CROSS).setParameterLength(2),UN=Ti(T5,T5.POW).setParameterLength(2),UO=Ti(T5,T5.TRANSFORM_DIRECTION).setParameterLength(2),UP=Ti(T5,T5.MIX).setParameterLength(3),UQ=(a,b=0,c=1)=>Td(new T5(T5.CLAMP,Td(a),Td(b),Td(c))),UR=Ti(T5,T5.REFRACT).setParameterLength(3),US=Ti(T5,T5.SMOOTHSTEP).setParameterLength(3),UT=Ti(T5,T5.FACEFORWARD).setParameterLength(3),UU=Tl(([a])=>Uk(Ul(TM(UL(a.xy,Tr(12.9898,78.233)),T6)).mul(43758.5453)));SS("all",T7),SS("any",T8),SS("equals",(a,b)=>(RW('TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),TN(a,b))),SS("radians",T9),SS("degrees",Ua),SS("exp",Ub),SS("exp2",Uc),SS("log",Ud),SS("log2",Ue),SS("sqrt",Uf),SS("inverseSqrt",Ug),SS("floor",Uh),SS("ceil",Ui),SS("normalize",Uj),SS("fract",Uk),SS("sin",Ul),SS("cos",Um),SS("tan",Un),SS("asin",Uo),SS("acos",Up),SS("atan",Uq),SS("abs",Ur),SS("sign",Us),SS("length",Ut),SS("lengthSq",a=>UL(a,a)),SS("negate",Uu),SS("oneMinus",Uv),SS("dFdx",Uw),SS("dFdy",Ux),SS("round",Uy),SS("reciprocal",Uz),SS("trunc",UA),SS("fwidth",UB),SS("atan2",(a,b)=>(RW('TSL: "atan2" is overloaded. Use "atan" instead.'),Uq(a,b))),SS("min",UF),SS("max",UG),SS("step",(a,b)=>UH(b,a)),SS("reflect",UI),SS("distance",UJ),SS("dot",UL),SS("cross",UM),SS("pow",UN),SS("pow2",a=>TK(a,a)),SS("pow3",a=>TK(a,a,a)),SS("pow4",a=>TK(a,a,a,a)),SS("transformDirection",UO),SS("mix",(a,b,c)=>UP(b,c,a)),SS("clamp",UQ),SS("refract",UR),SS("smoothstep",(a,b,c)=>US(b,c,a)),SS("faceForward",UT),SS("difference",UK),SS("saturate",a=>UQ(a)),SS("cbrt",a=>TK(Us(a),UN(Ur(a),1/3))),SS("transpose",UC),SS("determinant",UD),SS("inverse",UE),SS("rand",UU);var UV=class extends SF{static get type(){return"ArrayNode"}constructor(a,b,c=null){super(a),this.count=b,this.values=c,this.isArrayNode=!0}getArrayCount(){return this.count}getNodeType(a){return null===this.nodeType&&(this.nodeType=this.values[0].getNodeType(a)),this.nodeType}getElementType(a){return this.getNodeType(a)}generate(a){let b=this.getNodeType(a);return a.generateArray(b,this.count,this.values)}};SS("toArray",(a,b)=>((...a)=>{let b;if(1===a.length){let c=a[0];b=new UV(null,c.length,c)}else b=new UV(a[0],a[1]);return Td(b)})(Array(b).fill(a)));var UW=class extends SE{static get type(){return"UniformGroupNode"}constructor(a,b=!1,c=1){super("string"),this.name=a,this.shared=b,this.order=c,this.isUniformGroup=!0}serialize(a){super.serialize(a),a.name=this.name,a.version=this.version,a.shared=this.shared}deserialize(a){super.deserialize(a),this.name=a.name,this.version=a.version,this.shared=a.shared}};let UX=((a,b=0)=>new UW(a,!0,b))("render"),UY=new UW("object");var UZ=class extends SN{static get type(){return"UniformNode"}constructor(a,b=null){super(a,b),this.isUniformNode=!0,this.name="",this.groupNode=UY}setName(a){return this.name=a,this}label(a){return RW('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(a)}setGroup(a){return this.groupNode=a,this}getGroup(){return this.groupNode}getUniformHash(a){return this.getHash(a)}onUpdate(a,b){return a=a.bind(this),super.onUpdate(b=>{let c=a(b,this);void 0!==c&&(this.value=c)},b)}getInputType(a){let b=super.getInputType(a);return"bool"===b&&(b="uint"),b}generate(a,b){let c=this.getNodeType(a),d=this.getUniformHash(a),e=a.getNodeFromHash(d);void 0===e&&(a.setHashNode(this,d),e=this);let f=e.getInputType(a),g=a.getUniformFromNode(e,f,a.shaderStage,this.name||a.context.nodeName),h=a.getPropertyName(g);void 0!==a.context.nodeName&&delete a.context.nodeName;let i=h;if("bool"===c){let b=a.getDataFromNode(this),d=b.propertyName;if(void 0===d){let e=a.getVarFromNode(this,null,"bool");b.propertyName=d=a.getPropertyName(e),i=a.format(h,f,c),a.addLineFlowCode(`${d} = ${i}`,this)}i=d}return a.format(i,c,b)}},U$=class extends SE{static get type(){return"PropertyNode"}constructor(a,b=null,c=!1){super(a),this.name=b,this.varying=c,this.isPropertyNode=!0,this.global=!0}customCacheKey(){return Sy(this.type+":"+(this.name||"")+":"+(this.varying?"1":"0"))}getHash(a){return this.name||super.getHash(a)}generate(a){let b;return!0===this.varying?(b=a.getVaryingFromNode(this,this.name)).needsInterpolation=!0:b=a.getVarFromNode(this,this.name),a.getPropertyName(b)}};SS("assign",Th(class extends SF{static get type(){return"AssignNode"}constructor(a,b){super(),this.targetNode=a,this.sourceNode=b,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(a,b){return"void"===b?"void":this.targetNode.getNodeType(a)}needsSplitAssign(a){let{targetNode:b}=this;if(!1===a.isAvailable("swizzleAssign")&&b.isSplitNode&&b.components.length>1){let c=a.getTypeLength(b.node.getNodeType(a));return RT.join("").slice(0,c)!==b.components}return!1}setup(a){let{targetNode:b,sourceNode:c}=this,d=b.getScope();a.getNodeProperties(d).assign=!0;let e=a.getNodeProperties(this);e.sourceNode=c,e.targetNode=b.context({assign:!0})}generate(a,b){let{targetNode:c,sourceNode:d}=a.getNodeProperties(this),e=this.needsSplitAssign(a),f=c.build(a),g=c.getNodeType(a),h=d.build(a,g),i=d.getNodeType(a),j=a.getDataFromNode(this),k;if(!0===j.initialized)"void"!==b&&(k=f);else if(e){let d=a.getVarFromNode(this,null,g),e=a.getPropertyName(d);a.addLineFlowCode(`${e} = ${h}`,this);let i=c.node,j=i.node.context({assign:!0}).build(a);for(let b=0;b<i.components.length;b++){let c=i.components[b];a.addLineFlowCode(`${j}.${c} = ${e}[ ${b} ]`,this)}"void"!==b&&(k=f)}else k=`${f} = ${h}`,("void"===b||"void"===i)&&(a.addLineFlowCode(k,this),"void"!==b&&(k=f));return j.initialized=!0,a.format(k,g,b)}}).setParameterLength(2));var U_=class extends SF{static get type(){return"FunctionCallNode"}constructor(a=null,b={}){super(),this.functionNode=a,this.parameters=b}setParameters(a){return this.parameters=a,this}getParameters(){return this.parameters}getNodeType(a){return this.functionNode.getNodeType(a)}getMemberType(a,b){return this.functionNode.getMemberType(a,b)}generate(a){let b=[],c=this.functionNode,d=c.getInputs(a),e=this.parameters,f=(b,c)=>{let d=c.type;return"pointer"===d?"&"+b.build(a):b.build(a,d)};if(Array.isArray(e)){if(e.length>d.length)RX("TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),e.length=d.length;else if(e.length<d.length)for(RX("TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");e.length<d.length;)e.push(Tn(0));for(let a=0;a<e.length;a++)b.push(f(e[a],d[a]))}else for(let a of d){let c=e[a.name];void 0===c?(RX(`TSL: Input '${a.name}' not found in 'Fn()'.`),b.push(f(Tn(0),a))):b.push(f(c,a))}return`${c.build(a,"property")}( ${b.join(", ")} )`}};SS("call",(a,...b)=>(b=b.length>1||b[0]&&!0===b[0].isNode?Tg(b):Tf(b[0]),new U_(Td(a),b)));let U0=Th(class extends SE{static get type(){return"ConditionalNode"}constructor(a,b,c=null){super(),this.condNode=a,this.ifNode=b,this.elseNode=c}getNodeType(a){let{ifNode:b,elseNode:c}=a.getNodeProperties(this);if(void 0===b)return a.flowBuildStage(this,"setup"),this.getNodeType(a);let d=b.getNodeType(a);if(null!==c){let b=c.getNodeType(a);if(a.getTypeLength(b)>a.getTypeLength(d))return b}return d}setup(a){let b=this.condNode,c=this.ifNode.isolate(),d=this.elseNode?this.elseNode.isolate():null,e=a.context.nodeBlock;a.getDataFromNode(c).parentNodeBlock=e,null!==d&&(a.getDataFromNode(d).parentNodeBlock=e);let f=a.context.uniformFlow,g=a.getNodeProperties(this);g.condNode=b,g.ifNode=f?c:c.context({nodeBlock:c}),g.elseNode=d?f?d:d.context({nodeBlock:d}):null}generate(a,b){let c,d=this.getNodeType(a),e=a.getDataFromNode(this);if(void 0!==e.nodeProperty)return e.nodeProperty;let{condNode:f,ifNode:g,elseNode:h}=a.getNodeProperties(this),i=a.currentFunctionNode,j="void"!==b,k=j?Td(new U$(d,c)).build(a):"";e.nodeProperty=k;let l=f.build(a,"bool");if(a.context.uniformFlow&&null!==h){let c=g.build(a,d),e=h.build(a,d),f=a.getTernary(l,c,e);return a.format(f,d,b)}a.addFlowCode(`
${a.tab}if ( ${l} ) {

`).addFlowTab();let m=g.build(a,d);if(m&&(j?m=k+" = "+m+";":(m="return "+m+";",null===i&&(RW("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),m="// "+m))),a.removeFlowTab().addFlowCode(a.tab+"	"+m+`

`+a.tab+"}"),null!==h){a.addFlowCode(` else {

`).addFlowTab();let b=h.build(a,d);b&&(j?b=k+" = "+b+";":(b="return "+b+";",null===i&&(RW("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),b="// "+b))),a.removeFlowTab().addFlowCode(a.tab+"	"+b+`

`+a.tab+`}

`)}else a.addFlowCode(`

`);return a.format(k,d,b)}}).setParameterLength(2,3);SS("select",U0);let U1=Th(class extends SE{static get type(){return"ContextNode"}constructor(a,b={}){super(),this.isContextNode=!0,this.node=a,this.value=b}getScope(){return this.node.getScope()}getNodeType(a){return this.node.getNodeType(a)}getMemberType(a,b){return this.node.getMemberType(a,b)}analyze(a){let b=a.addContext(this.value);this.node.build(a),a.setContext(b)}setup(a){let b=a.addContext(this.value);this.node.build(a),a.setContext(b)}generate(a,b){let c=a.addContext(this.value),d=this.node.build(a,b);return a.setContext(c),d}}).setParameterLength(1,2),U2=(a,b)=>U1(a,{nodeName:b});SS("context",U1),SS("label",function(a,b){return RW('TSL: "label()" has been deprecated. Use "setName()" instead.'),U2(a,b)}),SS("uniformFlow",a=>U1(a,{uniformFlow:!0})),SS("setName",U2);var U3=Th(class extends SE{static get type(){return"VarNode"}constructor(a,b=null,c=!1){super(),this.node=a,this.name=b,this.global=!0,this.isVarNode=!0,this.readOnly=c,this.parents=!0,this.intent=!1}setIntent(a){return this.intent=a,this}getIntent(){return this.intent}getMemberType(a,b){return this.node.getMemberType(a,b)}getElementType(a){return this.node.getElementType(a)}getNodeType(a){return this.node.getNodeType(a)}getArrayCount(a){return this.node.getArrayCount(a)}isAssign(a){let b=a.getNodeProperties(this).assign;return!0!==b&&this.node.isShaderCallNodeInternal&&null===this.node.shaderNode.getLayout()&&a.fnCall&&a.fnCall.shaderNode&&a.getDataFromNode(this.node.shaderNode).hasLoop&&(b=!0),b}build(...a){let b=a[0];return!1===this._hasStack(b)&&"setup"===b.buildStage&&(b.context.nodeLoop||b.context.nodeBlock)&&b.getBaseStack().addToStack(this),!0===this.intent&&!0!==this.isAssign(b)?this.node.build(...a):super.build(...a)}generate(a){let{node:b,name:c,readOnly:d}=this,{renderer:e}=a,f=!0===e.backend.isWebGPUBackend,g=!1,h=!1;d&&(g=a.isDeterministic(b),h=f?d:g);let i=this.getNodeType(a);if("void"==i)return!0!==this.intent&&RX('TSL: ".toVar()" can not be used with void type.'),b.build(a);let j=a.getVectorType(i),k=b.build(a,j),l=a.getVarFromNode(this,c,j,void 0,h),m=a.getPropertyName(l),n=m;if(h)if(f)n=g?`const ${m}`:`let ${m}`;else{let c=b.getArrayCount(a);n=`const ${a.getVar(l.type,m,c)}`}return a.addLineFlowCode(`${n} = ${k}`,this),m}_hasStack(a){return void 0!==a.getDataFromNode(this).stack}});SS("toVar",(a,b=null)=>U3(a,b).toStack()),SS("toConst",(a,b=null)=>U3(a,b,!0).toStack()),SS("toVarIntent",a=>U3(a).setIntent(!0).toStack());var U4=class extends SE{static get type(){return"SubBuild"}constructor(a,b,c=null){super(c),this.node=a,this.name=b,this.isSubBuildNode=!0}getNodeType(a){if(null!==this.nodeType)return this.nodeType;a.addSubBuild(this.name);let b=this.node.getNodeType(a);return a.removeSubBuild(),b}build(a,...b){a.addSubBuild(this.name);let c=this.node.build(a,...b);return a.removeSubBuild(),c}};let U5=Th(class extends SE{static get type(){return"VaryingNode"}constructor(a,b=null){super(),this.node=a,this.name=b,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(a,b=null){return this.interpolationType=a,this.interpolationSampling=b,this}getHash(a){return this.name||super.getHash(a)}getNodeType(a){return this.node.getNodeType(a)}setupVarying(a){let b=a.getNodeProperties(this),c=b.varying;if(void 0===c){let d=this.name,e=this.getNodeType(a),f=this.interpolationType,g=this.interpolationSampling;b.varying=c=a.getVaryingFromNode(this,d,e,f,g),b.node=((a,b,c=null)=>Td(new U4(Td(a),b,c)))(this.node,"VERTEX")}return c.needsInterpolation||(c.needsInterpolation="fragment"===a.shaderStage),c}setup(a){this.setupVarying(a),a.flowNodeFromShaderStage(RP,this.node)}analyze(a){this.setupVarying(a),a.flowNodeFromShaderStage(RP,this.node)}generate(a){let b=a.getSubBuildProperty("property",a.currentStack),c=a.getNodeProperties(this),d=this.setupVarying(a);if(void 0===c[b]){let e=this.getNodeType(a),f=a.getPropertyName(d,RP);a.flowNodeFromShaderStage(RP,c.node,e,f),c[b]=f}return a.getPropertyName(d)}}).setParameterLength(1,2);SS("toVarying",U5),SS("toVertexStage",a=>U5(a)),SS("varying",(...a)=>(RW("TSL: .varying() has been renamed to .toVarying()."),U5(...a))),SS("vertexStage",(...a)=>(RW("TSL: .vertexStage() has been renamed to .toVertexStage()."),U5(...a)));let U6=Tl(([a])=>UP(a.mul(.9478672986).add(.0521327014).pow(2.4),a.mul(.0773993808),a.lessThanEqual(.04045))).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),U7=Tl(([a])=>UP(a.pow(.41666).mul(1.055).sub(.055),a.mul(12.92),a.lessThanEqual(.0031308))).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]});var U8="WorkingColorSpace",U9=class extends SF{static get type(){return"ColorSpaceNode"}constructor(a,b,c){super("vec4"),this.colorNode=a,this.source=b,this.target=c}resolveColorSpace(a,b){return b===U8?R9.workingColorSpace:"OutputColorSpace"===b?a.context.outputColorSpace||a.renderer.outputColorSpace:b}setup(a){let{colorNode:b}=this,c=this.resolveColorSpace(a,this.source),d=this.resolveColorSpace(a,this.target),e=b;return!1!==R9.enabled&&c!==d&&c&&d&&("srgb"===R9.getTransfer(c)&&(e=Tz(U6(e.rgb),e.a)),R9.getPrimaries(c)!==R9.getPrimaries(d)&&(e=Tz(TE(R9._getMatrix(new R5,c,d)).mul(e.rgb),e.a)),"srgb"===R9.getTransfer(d)&&(e=Tz(U7(e.rgb),e.a))),e}};SS("workingToColorSpace",(a,b)=>Td(new U9(Td(a),U8,b))),SS("colorSpaceToWorking",(a,b)=>Td(new U9(Td(a),b,U8)));var Va=class extends SG{static get type(){return"ReferenceElementNode"}constructor(a,b){super(a,b),this.referenceNode=a,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(a){let b=super.generate(a),c=this.referenceNode.getNodeType(),d=this.getNodeType();return a.format(b,c,d)}},Vb=class extends SE{static get type(){return"ReferenceBaseNode"}constructor(a,b,c=null,d=null){super(),this.property=a,this.uniformType=b,this.object=c,this.count=d,this.properties=a.split("."),this.reference=c,this.node=null,this.group=null,this.updateType=RS}setGroup(a){return this.group=a,this}element(a){return Td(new Va(this,Td(a)))}setNodeType(a){var b;let c,d,e=(b=null,(d=null==(c=a||b)?null:c.nodeType||c.convertTo||("string"==typeof c?c:null))===b&&(b=SA(d)),Td(new UZ(b=b&&!0===b.isNode?b.node&&b.node.value||b.value:b,d)));null!==this.group&&e.setGroup(this.group),this.node=e}getNodeType(a){return null===this.node&&(this.updateReference(a),this.updateValue()),this.node.getNodeType(a)}getValueFromReference(a=this.reference){let{properties:b}=this,c=a[b[0]];for(let a=1;a<b.length;a++)c=c[b[a]];return c}updateReference(a){return this.reference=null===this.object?a.object:this.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){null===this.node&&this.setNodeType(this.uniformType);let a=this.getValueFromReference();Array.isArray(a)?this.node.array=a:this.node.value=a}},Vc=class extends Vb{static get type(){return"RendererReferenceNode"}constructor(a,b,c=null){super(a,b,c),this.renderer=c,this.setGroup(UX)}updateReference(a){return this.reference=null===this.renderer?a.renderer:this.renderer,this.reference}},Vd=class extends SF{static get type(){return"ToneMappingNode"}constructor(a,b=Ve,c=null){super("vec3"),this._toneMapping=a,this.exposureNode=b,this.colorNode=c}customCacheKey(){return((...a)=>Sx(a))(this._toneMapping)}setToneMapping(a){return this._toneMapping=a,this}getToneMapping(){return this._toneMapping}setup(a){let b=this.colorNode||a.context.color,c=this._toneMapping;if(0===c)return b;let d=null,e=a.renderer.library.getToneMappingFunction(c);return null===e?(RX("ToneMappingNode: Unsupported Tone Mapping configuration.",c),d=b):d=Tz(e(b.rgb,this.exposureNode),b.a),d}};let Ve=((a,b,c=null)=>Td(new Vc(a,b,c)))("toneMappingExposure","float");SS("toneMapping",(a,b,c)=>Td(new Vd(b,Td(c),Td(a))));var Vf=new Sk,Vg=new Sv,Vh=0,Vi=class{constructor(a,b,c=!1){if(Array.isArray(a))throw TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:Vh++}),this.name="",this.array=a,this.itemSize=b,this.count=void 0===a?0:a.length/b,this.normalized=c,this.usage=35044,this.updateRanges=[],this.gpuType=1015,this.version=0}onUploadCallback(){}set needsUpdate(a){!0===a&&this.version++}setUsage(a){return this.usage=a,this}addUpdateRange(a,b){this.updateRanges.push({start:a,count:b})}clearUpdateRanges(){this.updateRanges.length=0}copy(a){return this.name=a.name,this.array=new a.array.constructor(a.array),this.itemSize=a.itemSize,this.count=a.count,this.normalized=a.normalized,this.usage=a.usage,this.gpuType=a.gpuType,this}copyAt(a,b,c){a*=this.itemSize,c*=b.itemSize;for(let d=0,e=this.itemSize;d<e;d++)this.array[a+d]=b.array[c+d];return this}copyArray(a){return this.array.set(a),this}applyMatrix3(a){if(2===this.itemSize)for(let b=0,c=this.count;b<c;b++)Vg.fromBufferAttribute(this,b),Vg.applyMatrix3(a),this.setXY(b,Vg.x,Vg.y);else if(3===this.itemSize)for(let b=0,c=this.count;b<c;b++)Vf.fromBufferAttribute(this,b),Vf.applyMatrix3(a),this.setXYZ(b,Vf.x,Vf.y,Vf.z);return this}applyMatrix4(a){for(let b=0,c=this.count;b<c;b++)Vf.fromBufferAttribute(this,b),Vf.applyMatrix4(a),this.setXYZ(b,Vf.x,Vf.y,Vf.z);return this}applyNormalMatrix(a){for(let b=0,c=this.count;b<c;b++)Vf.fromBufferAttribute(this,b),Vf.applyNormalMatrix(a),this.setXYZ(b,Vf.x,Vf.y,Vf.z);return this}transformDirection(a){for(let b=0,c=this.count;b<c;b++)Vf.fromBufferAttribute(this,b),Vf.transformDirection(a),this.setXYZ(b,Vf.x,Vf.y,Vf.z);return this}set(a,b=0){return this.array.set(a,b),this}getComponent(a,b){let c=this.array[a*this.itemSize+b];return this.normalized&&(c=R0(c,this.array)),c}setComponent(a,b,c){return this.normalized&&(c=R1(c,this.array)),this.array[a*this.itemSize+b]=c,this}getX(a){let b=this.array[a*this.itemSize];return this.normalized&&(b=R0(b,this.array)),b}setX(a,b){return this.normalized&&(b=R1(b,this.array)),this.array[a*this.itemSize]=b,this}getY(a){let b=this.array[a*this.itemSize+1];return this.normalized&&(b=R0(b,this.array)),b}setY(a,b){return this.normalized&&(b=R1(b,this.array)),this.array[a*this.itemSize+1]=b,this}getZ(a){let b=this.array[a*this.itemSize+2];return this.normalized&&(b=R0(b,this.array)),b}setZ(a,b){return this.normalized&&(b=R1(b,this.array)),this.array[a*this.itemSize+2]=b,this}getW(a){let b=this.array[a*this.itemSize+3];return this.normalized&&(b=R0(b,this.array)),b}setW(a,b){return this.normalized&&(b=R1(b,this.array)),this.array[a*this.itemSize+3]=b,this}setXY(a,b,c){return a*=this.itemSize,this.normalized&&(b=R1(b,this.array),c=R1(c,this.array)),this.array[a+0]=b,this.array[a+1]=c,this}setXYZ(a,b,c,d){return a*=this.itemSize,this.normalized&&(b=R1(b,this.array),c=R1(c,this.array),d=R1(d,this.array)),this.array[a+0]=b,this.array[a+1]=c,this.array[a+2]=d,this}setXYZW(a,b,c,d,e){return a*=this.itemSize,this.normalized&&(b=R1(b,this.array),c=R1(c,this.array),d=R1(d,this.array),e=R1(e,this.array)),this.array[a+0]=b,this.array[a+1]=c,this.array[a+2]=d,this.array[a+3]=e,this}onUpload(a){return this.onUploadCallback=a,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let a={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(a.name=this.name),35044!==this.usage&&(a.usage=this.usage),a}},Vj=new Sk,Vk=class a{constructor(a,b,c,d=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=a,this.itemSize=b,this.offset=c,this.normalized=d}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(a){this.data.needsUpdate=a}applyMatrix4(a){for(let b=0,c=this.data.count;b<c;b++)Vj.fromBufferAttribute(this,b),Vj.applyMatrix4(a),this.setXYZ(b,Vj.x,Vj.y,Vj.z);return this}applyNormalMatrix(a){for(let b=0,c=this.count;b<c;b++)Vj.fromBufferAttribute(this,b),Vj.applyNormalMatrix(a),this.setXYZ(b,Vj.x,Vj.y,Vj.z);return this}transformDirection(a){for(let b=0,c=this.count;b<c;b++)Vj.fromBufferAttribute(this,b),Vj.transformDirection(a),this.setXYZ(b,Vj.x,Vj.y,Vj.z);return this}getComponent(a,b){let c=this.array[a*this.data.stride+this.offset+b];return this.normalized&&(c=R0(c,this.array)),c}setComponent(a,b,c){return this.normalized&&(c=R1(c,this.array)),this.data.array[a*this.data.stride+this.offset+b]=c,this}setX(a,b){return this.normalized&&(b=R1(b,this.array)),this.data.array[a*this.data.stride+this.offset]=b,this}setY(a,b){return this.normalized&&(b=R1(b,this.array)),this.data.array[a*this.data.stride+this.offset+1]=b,this}setZ(a,b){return this.normalized&&(b=R1(b,this.array)),this.data.array[a*this.data.stride+this.offset+2]=b,this}setW(a,b){return this.normalized&&(b=R1(b,this.array)),this.data.array[a*this.data.stride+this.offset+3]=b,this}getX(a){let b=this.data.array[a*this.data.stride+this.offset];return this.normalized&&(b=R0(b,this.array)),b}getY(a){let b=this.data.array[a*this.data.stride+this.offset+1];return this.normalized&&(b=R0(b,this.array)),b}getZ(a){let b=this.data.array[a*this.data.stride+this.offset+2];return this.normalized&&(b=R0(b,this.array)),b}getW(a){let b=this.data.array[a*this.data.stride+this.offset+3];return this.normalized&&(b=R0(b,this.array)),b}setXY(a,b,c){return a=a*this.data.stride+this.offset,this.normalized&&(b=R1(b,this.array),c=R1(c,this.array)),this.data.array[a+0]=b,this.data.array[a+1]=c,this}setXYZ(a,b,c,d){return a=a*this.data.stride+this.offset,this.normalized&&(b=R1(b,this.array),c=R1(c,this.array),d=R1(d,this.array)),this.data.array[a+0]=b,this.data.array[a+1]=c,this.data.array[a+2]=d,this}setXYZW(a,b,c,d,e){return a=a*this.data.stride+this.offset,this.normalized&&(b=R1(b,this.array),c=R1(c,this.array),d=R1(d,this.array),e=R1(e,this.array)),this.data.array[a+0]=b,this.data.array[a+1]=c,this.data.array[a+2]=d,this.data.array[a+3]=e,this}clone(b){if(void 0!==b)return void 0===b.interleavedBuffers&&(b.interleavedBuffers={}),void 0===b.interleavedBuffers[this.data.uuid]&&(b.interleavedBuffers[this.data.uuid]=this.data.clone(b)),new a(b.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized);{RV("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let a=[];for(let b=0;b<this.count;b++){let c=b*this.data.stride+this.offset;for(let b=0;b<this.itemSize;b++)a.push(this.data.array[c+b])}return new Vi(new this.array.constructor(a),this.itemSize,this.normalized)}}toJSON(a){if(void 0!==a)return void 0===a.interleavedBuffers&&(a.interleavedBuffers={}),void 0===a.interleavedBuffers[this.data.uuid]&&(a.interleavedBuffers[this.data.uuid]=this.data.toJSON(a)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized};{RV("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let a=[];for(let b=0;b<this.count;b++){let c=b*this.data.stride+this.offset;for(let b=0;b<this.itemSize;b++)a.push(this.data.array[c+b])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:a,normalized:this.normalized}}}},Vl=class{constructor(a,b){this.isInterleavedBuffer=!0,this.array=a,this.stride=b,this.count=void 0===a?0:a.length/b,this.usage=35044,this.updateRanges=[],this.version=0,this.uuid=R$()}onUploadCallback(){}set needsUpdate(a){!0===a&&this.version++}setUsage(a){return this.usage=a,this}addUpdateRange(a,b){this.updateRanges.push({start:a,count:b})}clearUpdateRanges(){this.updateRanges.length=0}copy(a){return this.array=new a.array.constructor(a.array),this.count=a.count,this.stride=a.stride,this.usage=a.usage,this}copyAt(a,b,c){a*=this.stride,c*=b.stride;for(let d=0,e=this.stride;d<e;d++)this.array[a+d]=b.array[c+d];return this}set(a,b=0){return this.array.set(a,b),this}clone(a){void 0===a.arrayBuffers&&(a.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=R$()),void 0===a.arrayBuffers[this.array.buffer._uuid]&&(a.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let b=new this.array.constructor(a.arrayBuffers[this.array.buffer._uuid]),c=new this.constructor(b,this.stride);return c.setUsage(this.usage),c}onUpload(a){return this.onUploadCallback=a,this}toJSON(a){return void 0===a.arrayBuffers&&(a.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=R$()),void 0===a.arrayBuffers[this.array.buffer._uuid]&&(a.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},Vm=class extends SN{static get type(){return"BufferAttributeNode"}constructor(a,b=null,c=0,d=0){super(a,b),this.isBufferNode=!0,this.bufferType=b,this.bufferStride=c,this.bufferOffset=d,this.usage=35044,this.instanced=!1,this.attribute=null,this.global=!0,a&&!0===a.isBufferAttribute&&(this.attribute=a,this.usage=a.usage,this.instanced=a.isInstancedBufferAttribute)}getHash(a){if(0===this.bufferStride&&0===this.bufferOffset){let b=a.globalCache.getData(this.value);return void 0===b&&(b={node:this},a.globalCache.setData(this.value,b)),b.node.uuid}return this.uuid}getNodeType(a){return null===this.bufferType&&(this.bufferType=a.getTypeFromAttribute(this.attribute)),this.bufferType}setup(a){if(null!==this.attribute)return;let b=this.getNodeType(a),c=this.value,d=a.getTypeLength(b),e=this.bufferStride||d,f=this.bufferOffset,g=!0===c.isInterleavedBuffer?c:new Vl(c,e),h=new Vk(g,d,f);g.setUsage(this.usage),this.attribute=h,this.attribute.isInstancedBufferAttribute=this.instanced}generate(a){let b=this.getNodeType(a),c=a.getBufferAttributeFromNode(this,b),d=a.getPropertyName(c),e=null;return"vertex"===a.shaderStage||"compute"===a.shaderStage?(this.name=d,e=d):e=U5(this).build(a,b),e}getInputType(){return"bufferAttribute"}setUsage(a){return this.usage=a,this.attribute&&!0===this.attribute.isBufferAttribute&&(this.attribute.usage=a),this}setInstanced(a){return this.instanced=a,this}};SS("toAttribute",a=>((a,b=null,c=0,d=0)=>Td(new Vm(a,b,c,d)))(a.value));var Vn=class extends SE{static get type(){return"ComputeNode"}constructor(a,b){super("void"),this.isComputeNode=!0,this.computeNode=a,this.workgroupSize=b,this.count=null,this.version=1,this.name="",this.updateBeforeType=RS,this.onInitFunction=null}setCount(a){return this.count=a,this}getCount(){return this.count}dispose(){this.dispatchEvent({type:"dispose"})}setName(a){return this.name=a,this}label(a){return RW('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(a)}onInit(a){return this.onInitFunction=a,this}updateBefore({renderer:a}){a.compute(this)}setup(a){let b=this.computeNode.build(a);return b&&(a.getNodeProperties(this).outputComputeNode=b.outputNode,b.outputNode=null),b}generate(a,b){let{shaderStage:c}=a;if("compute"===c){let b=this.computeNode.build(a,"void");""!==b&&a.addLineFlowCode(b,this)}else{let c=a.getNodeProperties(this).outputComputeNode;if(c)return c.build(a,b)}}};let Vo=(a,b=[64])=>{(0===b.length||b.length>3)&&RX("TSL: compute() workgroupSize must have 1, 2, or 3 elements");for(let a=0;a<b.length;a++){let c=b[a];("number"!=typeof c||c<=0||!Number.isInteger(c))&&RX(`TSL: compute() workgroupSize element at index [ ${a} ] must be a positive integer`)}for(;b.length<3;)b.push(1);return Td(new Vn(Td(a),b))};SS("compute",(a,b,c)=>Vo(a,c).setCount(b)),SS("computeKernel",Vo);var Vp=class extends SE{static get type(){return"IsolateNode"}constructor(a,b=!0){super(),this.node=a,this.parent=b,this.isIsolateNode=!0}getNodeType(a){let b=a.getCache(),c=a.getCacheFromNode(this,this.parent);a.setCache(c);let d=this.node.getNodeType(a);return a.setCache(b),d}build(a,...b){let c=a.getCache(),d=a.getCacheFromNode(this,this.parent);a.setCache(d);let e=this.node.build(a,...b);return a.setCache(c),e}setParent(a){return this.parent=a,this}getParent(){return this.parent}};let Vq=a=>new Vp(Td(a));SS("cache",function(a,b=!0){return RW('TSL: "cache()" has been deprecated. Use "isolate()" instead.'),Vq(a).setParent(b)}),SS("isolate",Vq),SS("bypass",Th(class extends SE{static get type(){return"BypassNode"}constructor(a,b){super(),this.isBypassNode=!0,this.outputNode=a,this.callNode=b}getNodeType(a){return this.outputNode.getNodeType(a)}generate(a){let b=this.callNode.build(a,"void");return""!==b&&a.addLineFlowCode(b,this),this.outputNode.build(a)}}).setParameterLength(2));var Vr=class extends SE{static get type(){return"RemapNode"}constructor(a,b,c,d=Tn(0),e=Tn(1)){super(),this.node=a,this.inLowNode=b,this.inHighNode=c,this.outLowNode=d,this.outHighNode=e,this.doClamp=!0}setup(){let{node:a,inLowNode:b,inHighNode:c,outLowNode:d,outHighNode:e,doClamp:f}=this,g=a.sub(b).div(c.sub(b));return!0===f&&(g=g.clamp()),g.mul(e.sub(d)).add(d)}};let Vs=Th(Vr,null,null,{doClamp:!1}).setParameterLength(3,5),Vt=Th(Vr).setParameterLength(3,5);SS("remap",Vs),SS("remapClamp",Vt);let Vu=Th(class extends SE{static get type(){return"ExpressionNode"}constructor(a="",b="void"){super(b),this.snippet=a}generate(a,b){let c=this.getNodeType(a),d=this.snippet;if("void"!==c)return a.format(d,c,b);a.addLineFlowCode(d,this)}}).setParameterLength(1,2);SS("discard",a=>(a?U0(a,Vu("discard")):Vu("discard")).toStack());var Vv=class extends SF{static get type(){return"RenderOutputNode"}constructor(a,b,c){super("vec4"),this.colorNode=a,this._toneMapping=b,this.outputColorSpace=c,this.isRenderOutputNode=!0}setToneMapping(a){return this._toneMapping=a,this}getToneMapping(){return this._toneMapping}setup({context:a}){let b=this.colorNode||a.color,c=(null===this._toneMapping?a.toneMapping:this._toneMapping)||0,d=(null===this.outputColorSpace?a.outputColorSpace:this.outputColorSpace)||"";return 0!==c&&(b=b.toneMapping(c)),""!==d&&d!==R9.workingColorSpace&&(b=b.workingToColorSpace(d)),b}};SS("renderOutput",(a,b=null,c=null)=>Td(new Vv(Td(a),b,c)));var Vw=class extends SF{static get type(){return"DebugNode"}constructor(a,b=null){super(),this.node=a,this.callback=b}getNodeType(a){return this.node.getNodeType(a)}setup(a){return this.node.build(a)}analyze(a){return this.node.build(a)}generate(a){let b=this.callback,c=this.node.build(a),d="--- TSL debug - "+a.shaderStage+" shader ---",e="-".repeat(d.length),f="";return f+="// #"+d+`#
`+a.flow.code.replace(/^\t/gm,"")+`
`+("/* ... */ "+c)+` /* ... */
`+("// #"+e)+`#
`,null===b?RV(f):b(a,f),c}};SS("debug",(a,b=null)=>Td(new Vw(Td(a),b)).toStack());var Vx=class{constructor(){this._renderer=null,this.currentFrame=null}get nodeFrame(){return this._renderer._nodes.nodeFrame}setRenderer(a){return this._renderer=a,this}getRenderer(){return this._renderer}init(){}begin(){}finish(){}inspect(){}computeAsync(){}beginCompute(){}finishCompute(){}beginRender(){}finishRender(){}copyTextureToTexture(){}copyFramebufferToTexture(){}},Vy=class extends SE{static get type(){return"InspectorNode"}constructor(a,b="",c=null){super(),this.node=a,this.name=b,this.callback=c,this.updateType=RR,this.isInspectorNode=!0}getName(){return this.name||this.node.name}update(a){a.renderer.inspector.inspect(this)}getNodeType(a){return this.node.getNodeType(a)}setup(a){let b=this.node;return!0===a.context.inspector&&null!==this.callback&&(b=this.callback(b)),!0!==a.renderer.backend.isWebGPUBackend&&a.renderer.inspector.constructor!==Vx&&RY('TSL: ".toInspector()" is only available with WebGPU.'),b}};SS("toInspector",function(a,b="",c=null){return(a=Td(a)).before(new Vy(a,b,c))});let Vz=Tl(([a])=>VD(a.rgb)),VA=Tl(([a,b=Tn(1)])=>b.mix(VD(a.rgb),a.rgb)),VB=Tl(([a,b=Tn(1)])=>{let c=TI(a.r,a.g,a.b).div(3),d=a.r.max(a.g.max(a.b)),e=d.sub(c).mul(b).mul(-3);return UP(a.rgb,d,e)}),VC=Tl(([a,b=Tn(1)])=>{let c=Tv(.57735,.57735,.57735),d=b.cos();return Tv(a.rgb.mul(d).add(c.cross(a.rgb).mul(b.sin()).add(c.mul(UL(c,a.rgb).mul(d.oneMinus())))))}),VD=(a,b=Tv(R9.getLuminanceCoefficients(new Sk)))=>UL(a,b);II();let VE={name:"Grayscale",category:"Color Adjustments",requiresChild:!0,props:{},fragmentNode:({childNode:a})=>{let{vec4:b}=IH;if(!a)return console.error("You must pass a child component into the Grayscale shader."),b(0);let c=a||b(0,0,0,0);return b(Vz(c.rgb).rgb,c.a)}};II();let VF={name:"Grid",category:"Shapes & Masks",props:{color:{default:"#ffffff",transform:Q9,description:"The color of the grid lines",ui:{type:"color",label:"Color"}},cells:{default:10,description:"Number of cells along the shortest canvas edge (creates square cells)",ui:{type:"range",min:1,max:50,step:1,label:"Cells"}},thickness:{default:1,description:"Thickness of grid lines (normalized, 0.0-1.0)",ui:{type:"range",min:0,max:5,step:.1,label:"Thickness"}}},fragmentNode:({uniforms:a})=>{let{vec2:b,vec4:c,fract:d,max:e,screenUV:f,viewportSize:g,fwidth:h,smoothstep:i}=IH,j=g.x.div(g.y),k=b(f.x.mul(j),f.y.oneMinus()),l=a.cells.uniform,m=k.mul(l),n=d(m),o=a.thickness.uniform.mul(.01),p=n.x.min(n.x.oneMinus()),q=n.y.min(n.y.oneMinus()),r=h(m),s=e(i(o.add(r.x),o,p),i(o.add(r.y),o,q));return c(a.color.uniform.rgb,a.color.uniform.a.mul(s))}};II();let VG={name:"GridDistortion",category:"Interactive",requiresRTT:!0,requiresChild:!0,props:{intensity:{default:1,description:"Strength of the distortion effect",ui:{type:"range",min:0,max:5,step:.1,label:"Intensity"}},swirl:{default:0,description:"Amount of swirl motion",ui:{type:"range",min:0,max:2,step:.1,label:"Swirl"}},decay:{default:3,description:"Rate of distortion decay (higher = faster)",ui:{type:"range",min:0,max:10,step:.1,label:"Decay"}},radius:{default:1,description:"Radius of the distortion effect",ui:{type:"range",min:0,max:3,step:.01,label:"Radius"}},gridSize:{default:20,description:"Resolution of the distortion grid (higher = more detailed)",ui:{type:"range",min:8,max:128,step:1,label:"Grid Size"}},edges:{default:"stretch",description:"How to handle edges when distortion pushes content out of bounds",transform:Rc,ui:{type:"select",options:[{label:"Stretch",value:"stretch"},{label:"Transparent",value:"transparent"},{label:"Mirror",value:"mirror"},{label:"Wrap",value:"wrap"}],label:"Edges"}}},fragmentNode:({uniforms:a,onBeforeRender:b,childNode:c,onCleanup:d})=>{let{vec2:e,vec4:f,float:g,uniform:h,screenUV:i,texture:j,convertToTexture:k}=IH;if(!c)return f(0,0,0,0);let l=k(c);d(()=>{l?.renderTarget?.dispose&&l.renderTarget.dispose()});let m=Math.max(8,Math.min(128,Math.floor(a.gridSize.uniform.value))),n=new Float32Array(m*m*2),o=new Lx(n,m,m,1030,1015);o.magFilter=1006,o.minFilter=1006,o.needsUpdate=!0;let p=j(o),q=h(.5),r=h(.5),s=h(0),t=h(0),u=.5,v=.5,w=Date.now();b(({pointer:b})=>{let c=Date.now(),d=Math.min((c-w)/1e3,.016);w=c;let e=d>0?(b.x-u)/d:0,f=d>0?(b.y-v)/d:0;s.value=.85*s.value+.15*e,t.value=.85*t.value+.15*f,q.value=b.x,r.value=b.y;let g=a.decay.uniform.value,h=a.intensity.uniform.value,i=.05*a.radius.uniform.value,j=a.swirl.uniform.value;for(let a=0;a<m;a++)for(let c=0;c<m;c++){let k=(a*m+c)*2;n[k]*=1-g*d,n[k+1]*=1-g*d;let l=(c+.5)/m,o=(a+.5)/m,p=l-b.x,q=o-b.y,r=Math.sqrt(p*p+q*q);if(r<2*i&&Math.abs(e)+Math.abs(f)>.01){let a=Math.exp(-r*r/(i*i));if(n[k]+=s.value*a*h*d*.5,n[k+1]+=t.value*a*h*d*.5,j>0){let b=Math.atan2(q,p)+.5*Math.PI;n[k]+=Math.cos(b)*j*a*d*2,n[k+1]+=Math.sin(b)*j*a*d*2}}n[k]=Math.max(-1,Math.min(1,n[k])),n[k+1]=Math.max(-1,Math.min(1,n[k+1]))}o.needsUpdate=!0,u=b.x,v=b.y}),d(()=>{o.dispose()});let x=a.gridSize.uniform,y=g(1).div(x),z=i.div(y).floor().mul(y).add(y.mul(.5)),A=p.sample(z).xy,B=g(.1),C=g(-.1),D=A.clamp(e(C,C),e(B,B)),E=i.sub(D);return IR(E,l.sample(E),l,a.edges.uniform)}};II();let VH={name:"Group",category:"Layout",requiresChild:!0,props:{},fragmentNode:({childNode:a})=>{let{vec4:b}=IH;return a||b(0)}};II();let VI={name:"Halftone",category:"Effects",requiresChild:!0,props:{frequency:{default:100,description:"Frequency of the halftone dots",ui:{type:"range",min:10,max:300,step:1,label:"Frequency"}},angle:{default:45,transform:Rb,description:"Rotation angle of the pattern (in degrees)",ui:{type:"range",min:0,max:360,step:1,label:"Angle"}},smoothness:{default:.1,description:"Edge smoothness of the dots",ui:{type:"range",min:0,max:.3,step:.01,label:"Smoothness"}}},fragmentNode:({uniforms:a,childNode:b})=>{let{vec2:c,vec3:d,vec4:e,sin:f,cos:g,fract:h,length:i,smoothstep:j,dot:k,screenUV:l,viewportSize:m,radians:n}=IH;if(!b)return e(0);let o=a.frequency.uniform,p=a.angle.uniform,q=a.smoothness.uniform,r=n(p),s=m.x.div(m.y),t=c(l.x.mul(s),l.y),u=g(r),v=f(r),w=h(c(k(t,c(u,v.negate())),k(t,c(v,u))).mul(o)).sub(.5),x=k(b.rgb,d(.299,.587,.114)).mul(.7).add(.15),y=i(w),z=j(x.add(q),x.sub(q),y);return e(b.rgb.mul(z),b.a.mul(z))}};II();let VJ={name:"HueShift",category:"Color Adjustments",requiresChild:!0,props:{shift:{default:0,description:"The amount to shift the hue by",ui:{type:"range",min:-180,max:180,step:1,label:"Shift"},transform:a=>a*Math.PI/180}},fragmentNode:({uniforms:a,childNode:b})=>{let{vec4:c}=IH;if(!b)return console.error("You must pass a child component into the Hue Shift shader."),c(0);let d=b||c(0,0,0,0);return c(VC(d.rgb,a.shift.uniform).rgb,d.a)}};II(),IG();let VK={name:"ImageTexture",category:"Sources",props:{url:{default:"https://shaders.com/og.png",description:"Upload an image or provide a URL",ui:{type:"image-upload",label:"Image"}},objectFit:{default:"cover",description:"How the image should be sized within the viewport",transform:a=>({cover:0,contain:1,fill:2,"scale-down":3,none:4})[a]??0,ui:{type:"select",options:[{label:"Cover",value:"cover"},{label:"Contain",value:"contain"},{label:"Fill",value:"fill"},{label:"Scale Down",value:"scale-down"},{label:"None",value:"none"}],label:"Object Fit"}}},fragmentNode:({uniforms:a,onCleanup:b,onBeforeRender:c})=>{let{vec2:d,vec4:e,float:f,texture:g,screenUV:h,viewportSize:i,step:j,min:k,max:l}=IH,m=new eM,n="",o=!1,p=new b2;p.colorSpace=br;let q=g(p),r=H$(1),s=H$(0),t=H$(0),u=a=>{if(!(!a||""===a.trim()||o)){o=!0;try{let b=a;try{b=new URL(a,window.location.href).href}catch{}m.load(a,b=>{b.colorSpace=br;let c=b.image,d=c.width||1,e=c.height||1,f=d/e;b.dispose(),n=a,requestAnimationFrame(()=>{let a=p.image;a&&"object"==typeof a&&(a.width!==d||a.height!==e)&&p.dispose(),r.value=f,s.value=d,t.value=e,p.image=c,p.colorSpace=br,p.needsUpdate=!0}),o=!1},void 0,c=>{let d=!a.startsWith("http://")&&!a.startsWith("https://")&&!a.startsWith("data:");console.error(`[ImageTexture] Failed to load image
  Requested URL: ${a}
  Resolved URL: ${b}
  Path type: ${d?"relative":"absolute"}
  Error:`,c),o=!1})}catch(a){console.error("[ImageTexture] Error initiating image load:",a),o=!1}}};setTimeout(()=>{let b=a?.url?.uniform?.value??"";b&&""!==b.trim()&&u(b)},0),c(()=>{let b=a?.url?.uniform?.value??"";b===n||o||u(b)}),b(()=>{p.dispose()});let v=i.x.div(i.y),w=a.objectFit.uniform,x=l(v.div(r),f(1)),y=d(r.div(v).mul(x),x),z=k(v.div(r),f(1)),A=d(r.div(v).mul(z),z),B=d(1,1),C=k(k(v.div(r),f(1)),k(i.x.div(s),i.y.div(t))),D=d(r.div(v).mul(C),C),E=k(i.x.div(s),i.y.div(t)),F=d(r.div(v).mul(E),E),G=j(w,f(.5)),H=j(f(.5),w).mul(j(w,f(1.5))),I=j(f(1.5),w).mul(j(w,f(2.5))),J=j(f(2.5),w).mul(j(w,f(3.5))),K=j(f(3.5),w),L=d(0).add(y.mul(G)).add(A.mul(H)).add(B.mul(I)).add(D.mul(J)).add(F.mul(K)),M=h.sub(d(.5)).div(L).add(d(.5)),N=d(M.x,f(1).sub(M.y)),O=q.sample(N),P=Fl(Fl(N.x.lessThan(0),N.x.greaterThan(1)),Fl(N.y.lessThan(0),N.y.greaterThan(1)));return e(O.rgb,Gx(P,f(0),O.a))}};II();let VL={name:"Invert",category:"Color Adjustments",requiresChild:!0,props:{},fragmentNode:({childNode:a})=>{let{vec4:b,vec3:c}=IH;if(!a)return console.error("You must pass a child component into the Invert shader."),b(0);let d=a||b(0,0,0,0),e=d.a,f=e.greaterThan(0).select(d.rgb.div(e),c(0,0,0));return b(c(1,1,1).sub(f).mul(e),e)}};II();let VM={name:"LinearBlur",category:"Blurs",requiresRTT:!0,requiresChild:!0,props:{intensity:{default:30,description:"Intensity of the linear blur effect",ui:{type:"range",min:0,max:100,step:1,label:"Intensity"}},angle:{default:0,transform:Rb,description:"Direction of the linear blur (in degrees)",ui:{type:"range",min:0,max:360,step:1,label:"Angle"}}},fragmentNode:({uniforms:a,childNode:b,onCleanup:c})=>{let{vec2:d,vec4:e,float:f,screenUV:g,viewportSize:h,sin:i,cos:j,radians:k,Fn:l,convertToTexture:m}=IH;if(!b)return e(0,0,0,0);let n=m(b);c(()=>{n?.renderTarget?.dispose&&n.renderTarget.dispose()});let o=k(a.angle.uniform),p=d(j(o),i(o));return l(()=>{let b=d(1).div(h),c=p.mul(a.intensity.uniform).mul(b).mul(2),i=e(0).toVar(),j=f(0).toVar();for(let a=0;a<32;a++){let b=f(a).div(f(31)).sub(.5).mul(2),d=f(1).div(f(2.506628)).mul(f(-.5).mul(b).mul(b).div(f(.64)).exp()),e=g.add(c.mul(b.mul(.5))),h=n.sample(e).mul(d);i.assign(i.add(h)),j.assign(j.add(d))}return i.div(j)})()}};II();let VN={name:"LinearGradient",category:"Gradients & Colors",props:{colorA:{default:"#1aff00",transform:Q9,description:"The starting color of the gradient",ui:{type:"color",label:"Color A"}},colorB:{default:"#0000ff",transform:Q9,description:"The ending color of the gradient",ui:{type:"color",label:"Color B"}},start:{default:{x:0,y:.5},transform:Ra,description:"The starting point of the gradient",ui:{type:"position",label:"Start"}},end:{default:{x:1,y:.5},transform:Ra,description:"The ending point of the gradient",ui:{type:"position",label:"End"}},angle:{default:0,transform:Rb,description:"Additional rotation angle of the gradient (in degrees)",ui:{type:"range",min:0,max:360,step:1,label:"Angle"}},edges:{default:"stretch",transform:Rc,description:"How to handle areas beyond the gradient endpoints",ui:{type:"select",options:[{label:"Stretch",value:"stretch"},{label:"Transparent",value:"transparent"},{label:"Mirror",value:"mirror"},{label:"Wrap",value:"wrap"}],label:"Edges"}},colorSpace:{default:"linear",transform:Re,description:"Color space for color interpolation",ui:{type:"select",options:Rd,label:"Color Space"}}},fragmentNode:({uniforms:a})=>{let{vec2:b,vec4:c,float:d,cos:e,sin:f,dot:g,radians:h,screenUV:i,length:j,normalize:k,abs:l,mod:m,fract:n}=IH,o=b(a.start.uniform[0],a.start.uniform[1].oneMinus()),p=b(a.end.uniform[0],a.end.uniform[1].oneMinus()),q=p.sub(o),r=j(q),s=k(q),t=h(a.angle.uniform).negate(),u=e(t),v=f(t),w=o.add(p).mul(.5),x=i.sub(w),y=g(b(x.x.mul(u).sub(x.y.mul(v)),x.x.mul(v).add(x.y.mul(u))).add(w).sub(o),s).div(r.max(1e-6)),z=a.edges.uniform,A=y.clamp(d(0),d(1)),B=y.greaterThanEqual(d(0)).select(d(1),d(0)),C=y.lessThanEqual(d(1)).select(d(1),d(0)),D=B.mul(C),E=m(l(y),d(2)),F=E.greaterThan(d(1)).select(d(2).sub(E),E),G=n(y),H=z.greaterThanEqual(d(.5)),I=z.greaterThanEqual(d(1.5)),J=z.greaterThanEqual(d(2.5)).select(G,I.select(F,H.select(y,A))),K=Rv(a.colorA.uniform,a.colorB.uniform,J.clamp(d(0),d(1)),a.colorSpace.uniform),L=H.and(z.lessThan(d(1.5))).select(K.w.mul(D),K.w);return c(K.x,K.y,K.z,L)}};II();let VO={name:"Liquify",category:"Interactive",requiresRTT:!0,requiresChild:!0,props:{intensity:{default:1,description:"Strength of the distortion effect",ui:{type:"range",min:0,max:5,step:.1,label:"Intensity"}},swirl:{default:0,description:"Amount of swirl motion (0-1)",ui:{type:"range",min:0,max:1,step:.01,label:"Swirl"}},decay:{default:3,description:"Rate of distortion decay (higher = faster)",ui:{type:"range",min:0,max:10,step:.1,label:"Decay"}},radius:{default:1,description:"Radius of the distortion effect",ui:{type:"range",min:0,max:3,step:.01,label:"Radius"}},edges:{default:"stretch",description:"How to handle edges when distortion pushes content out of bounds",transform:Rc,ui:{type:"select",options:[{label:"Stretch",value:"stretch"},{label:"Transparent",value:"transparent"},{label:"Mirror",value:"mirror"},{label:"Wrap",value:"wrap"}],label:"Edges"}}},fragmentNode:({uniforms:a,onBeforeRender:b,childNode:c,onCleanup:d})=>{let{vec2:e,vec4:f,float:g,uniform:h,screenUV:i,texture:j,convertToTexture:k}=IH;if(!c)return f(0,0,0,0);let l=k(c);d(()=>{l?.renderTarget?.dispose&&l.renderTarget.dispose()});let m=new Float32Array(2048),n=new Lx(m,32,32,1030,1015);n.magFilter=1006,n.minFilter=1006,n.needsUpdate=!0;let o=j(n),p=h(.5),q=h(.5),r=h(0),s=h(0),t=.5,u=.5,v=Date.now();b(({pointer:b})=>{let c=Date.now(),d=Math.min((c-v)/1e3,.016);v=c;let e=d>0?(b.x-t)/d:0,f=d>0?(b.y-u)/d:0;r.value=.85*r.value+.15*e,s.value=.85*s.value+.15*f,p.value=b.x,q.value=b.y;let g=a.decay.uniform.value,h=a.intensity.uniform.value,i=.05*a.radius.uniform.value,j=a.swirl.uniform.value;for(let a=0;a<32;a++)for(let c=0;c<32;c++){let k=(32*a+c)*2;m[k]*=1-g*d,m[k+1]*=1-g*d;let l=(a+.5)/32,n=(c+.5)/32-b.x,o=l-b.y,p=Math.sqrt(n*n+o*o);if(p<2*i&&Math.abs(e)+Math.abs(f)>.01){let a=Math.exp(-p*p/(i*i));if(m[k]+=r.value*a*h*d*.5,m[k+1]+=s.value*a*h*d*.5,j>0){let b=Math.atan2(o,n)+.5*Math.PI;m[k]+=Math.cos(b)*j*a*d*2,m[k+1]+=Math.sin(b)*j*a*d*2}}m[k]=Math.max(-1,Math.min(1,m[k])),m[k+1]=Math.max(-1,Math.min(1,m[k+1]))}n.needsUpdate=!0,t=b.x,u=b.y}),d(()=>{n.dispose()});let w=o.sample(i).xy,x=g(.2),y=g(-.2),z=w.clamp(e(y,y),e(x,x)),A=i.sub(z);return IR(A,l.sample(A),l,a.edges.uniform)}};II();let VP={name:"Pixelate",category:"Effects",requiresRTT:!0,requiresChild:!0,props:{scale:{default:50,description:"Pixel size - higher values create larger, more visible pixels",ui:{type:"range",min:1,max:200,step:1,label:"Scale"}}},fragmentNode:({uniforms:a,childNode:b,onCleanup:c})=>{let{vec4:d,floor:e,screenUV:f,convertToTexture:g}=IH;if(!b)return d(0,0,0,0);let h=g(b);c(()=>{h?.renderTarget?.dispose&&h.renderTarget.dispose()});let i=a.scale.uniform,j=e(f.mul(i)).div(i);return h.sample(j)}};II();let VQ={name:"PolarCoordinates",category:"Distortions",requiresRTT:!0,requiresChild:!0,props:{center:{default:{x:.5,y:.5},transform:Ra,description:"The center point for polar coordinate conversion",ui:{type:"position",label:"Center"}},wrap:{default:1,description:"Controls how much of the angular range to use (1 = full 360°, 0.5 = 180°)",ui:{type:"range",min:0,max:2,step:.01,label:"Wrap"}},radius:{default:1,description:"Controls how much of the radius range to use (affects the radial mapping)",ui:{type:"range",min:0,max:2,step:.01,label:"Radius"}},intensity:{default:1,description:"Blends between original UVs (0) and polar coordinates (1)",ui:{type:"range",min:0,max:1,step:.01,label:"Intensity"}},edges:{default:"transparent",description:"How to handle edges when distortion pushes content out of bounds",transform:Rc,ui:{type:"select",options:[{label:"Stretch",value:"stretch"},{label:"Transparent",value:"transparent"},{label:"Mirror",value:"mirror"},{label:"Wrap",value:"wrap"}],label:"Edges"}}},fragmentNode:({uniforms:a,childNode:b,onCleanup:c})=>{let{vec2:d,vec4:e,length:f,atan:g,screenUV:h,viewportSize:i,convertToTexture:j,PI:k,mix:l}=IH;if(!b)return e(0,0,0,0);let m=j(b);c(()=>{m?.renderTarget?.dispose&&m.renderTarget.dispose()});let n=i.x.div(i.y),o=d(h.x.mul(n),h.y),p=d(a.center.uniform.x.mul(n),a.center.uniform.y.oneMinus()),q=o.sub(p),r=g(q.y,q.x).add(k).div(k.mul(2)),s=f(q),t=l(h,d(r.mul(a.wrap.uniform),s.mul(a.radius.uniform)),a.intensity.uniform);return IR(t,m.sample(t),m,a.edges.uniform)}},VR=Th(class extends SF{static get type(){return"PosterizeNode"}constructor(a,b){super(),this.sourceNode=a,this.stepsNode=b}setup(){let{sourceNode:a,stepsNode:b}=this;return a.mul(b).floor().div(b)}}).setParameterLength(2);II();let VS={name:"Posterize",category:"Color Adjustments",requiresChild:!0,props:{intensity:{default:5,description:"The intensity of the posterization effect (lower is more posterized)",ui:{type:"range",min:2,max:20,step:1,label:"Intensity"}}},fragmentNode:({uniforms:a,childNode:b})=>{let{vec4:c,int:d}=IH;return b?VR(b||c(0,0,0,0),d(a.intensity.uniform)):(console.error("You must pass a child component into the Posterize shader."),c(0))}};II();let VT={name:"ProgressiveBlur",category:"Blurs",requiresRTT:!0,requiresChild:!0,props:{intensity:{default:50,description:"Maximum intensity of the blur effect",ui:{type:"range",min:0,max:100,step:1,label:"Intensity"}},angle:{default:0,transform:Rb,description:"Direction of the blur gradient (in degrees)",ui:{type:"range",min:0,max:360,step:1,label:"Angle"}},center:{default:{x:0,y:.5},transform:Ra,description:"Center point where blur begins",ui:{type:"position",label:"Center"}},falloff:{default:1,description:"Distance over which blur transitions to full strength",ui:{type:"range",min:0,max:1,step:.01,label:"Falloff"}}},fragmentNode:({uniforms:a,childNode:b,onCleanup:c})=>{let{vec2:d,vec4:e,float:f,screenUV:g,viewportSize:h,sin:i,cos:j,radians:k,max:l,smoothstep:m,Fn:n,convertToTexture:o}=IH;if(!b)return e(0,0,0,0);let p=o(b);c(()=>{p?.renderTarget?.dispose&&p.renderTarget.dispose()});let q=k(a.angle.uniform),r=d(j(q),i(q)),s=d(a.center.uniform[0],a.center.uniform[1].oneMinus()),t=g.sub(s),u=l(f(0),t.dot(r)),v=l(f(.001),a.falloff.uniform),w=m(f(0),v,u),x=a.intensity.uniform.mul(.06),y=w.mul(x),z=[.056,.135,.278,.487,.726,.923,1,.923,.726,.487,.278,.135,.056],A=o(n(()=>{let a=d(1).div(h),b=e(0).toVar();for(let c=-6;c<=6;c++){let e=f(z[c+6]/6.214),h=d(f(c),f(0)).mul(y).mul(a),i=g.add(h),j=p.sample(i).mul(e);b.assign(b.add(j))}return b})());return c(()=>{A?.renderTarget?.dispose&&A.renderTarget.dispose()}),n(()=>{let a=d(1).div(h),b=e(0).toVar();for(let c=-6;c<=6;c++){let e=f(z[c+6]/6.214),h=d(f(0),f(c)).mul(y).mul(a),i=g.add(h),j=A.sample(i).mul(e);b.assign(b.add(j))}return b})()}};II();let VU={name:"RadialGradient",category:"Gradients & Colors",props:{colorA:{default:"#ff0000",transform:Q9,description:"The starting color at the center of the gradient",ui:{type:"color",label:"Color A"}},colorB:{default:"#0000ff",transform:Q9,description:"The ending color at the edge of the gradient",ui:{type:"color",label:"Color B"}},center:{default:{x:.5,y:.5},transform:Ra,description:"The center point of the radial gradient",ui:{type:"position",label:"Center"}},radius:{default:1,description:"The radius of the gradient (normalized, 0.0-1.0)",ui:{type:"range",min:0,max:2,step:.01,label:"Radius"}},colorSpace:{default:"linear",transform:Re,description:"Color space for color interpolation",ui:{type:"select",options:Rd,label:"Color Space"}}},fragmentNode:({uniforms:a})=>{let{vec2:b,float:c,distance:d,screenUV:e,viewportSize:f}=IH,g=f.x.div(f.y),h=d(b(e.x.mul(g),e.y),b(a.center.uniform.x.mul(g),a.center.uniform.y.oneMinus())).div(a.radius.uniform).clamp(c(0),c(1));return Rv(a.colorA.uniform,a.colorB.uniform,h,a.colorSpace.uniform)}};II();let VV={name:"Ripples",category:"Effects",props:{center:{default:{x:.5,y:.5},transform:Ra,description:"The center point where ripples emanate from",ui:{type:"position",label:"Center"}},colorA:{default:"#ffffff",transform:Q9,description:"Color of the ripple waves",ui:{type:"color",label:"Color A"}},colorB:{default:"#000000",transform:Q9,description:"Background color between ripples",ui:{type:"color",label:"Color B"}},speed:{default:1,description:"Speed of ripple animation",ui:{type:"range",min:-5,max:5,step:.1,label:"Speed"}},frequency:{default:20,description:"Number of ripples/spacing between them",ui:{type:"range",min:1,max:80,step:.1,label:"Frequency"}},softness:{default:0,description:"Softness of ripple edges",ui:{type:"range",min:0,max:3,step:.01,label:"Softness"}},thickness:{default:.5,description:"Thickness of each ripple band",ui:{type:"range",min:0,max:1,step:.01,label:"Thickness"}},phase:{default:0,description:"Phase offset for ripple animation",ui:{type:"range",min:0,max:6.28,step:.01,label:"Phase"}}},fragmentNode:a=>{let{uniforms:b}=a,{vec2:c,float:d,screenUV:e,sin:f,distance:g,viewportSize:h,mix:i,smoothstep:j}=IH,k=b.center.uniform,l=b.colorA.uniform,m=b.colorB.uniform,n=b.frequency.uniform,o=b.softness.uniform,p=b.thickness.uniform,q=b.phase.uniform,r=h.x.div(h.y),s=g(c(e.x.mul(r),e.y),c(k.x.mul(r),k.y.oneMinus())),t=IS(a,b.speed),u=f(s.mul(n).sub(t).add(q)),v=p.mul(d(2)).sub(d(1));return i(m,l,j(v.add(o),v.sub(o),u))}};II();let VW={name:"Saturation",category:"Color Adjustments",requiresChild:!0,props:{intensity:{default:1,description:"The intensity of the saturation effect (1 being no change)",ui:{type:"range",min:0,max:3,step:.01,label:"Intensity"}}},fragmentNode:({uniforms:a,childNode:b})=>{let{vec4:c}=IH;if(!b)return console.error("You must pass a child component into the Saturation shader."),c(0);let d=b||c(0,0,0,0);return c(VA(d.rgb,a.intensity.uniform).rgb,d.a)}};II();let VX={name:"SimplexNoise",category:"Noise",props:{colorA:{default:"#ffffff",description:"First color",transform:Q9,ui:{type:"color",label:"Color A"}},colorB:{default:"#000000",description:"Second color",transform:Q9,ui:{type:"color",label:"Color B"}},scale:{default:2,description:"Pattern scale (higher = larger patterns)",ui:{type:"range",min:-2,max:5,step:.1,label:"Scale"}},balance:{default:0,description:"Balance between colors (negative = more colorB, positive = more colorA)",ui:{type:"range",min:-1,max:1,step:.01,label:"Balance"}},contrast:{default:0,description:"Pattern contrast (higher = sharper transitions)",ui:{type:"range",min:-2,max:5,step:.1,label:"Contrast"}},seed:{default:0,description:"Random seed for pattern variation",ui:{type:"range",min:0,max:100,step:1,label:"Seed"}},speed:{default:1,description:"Animation speed",ui:{type:"range",min:0,max:5,step:.1,label:"Speed"}}},fragmentNode:a=>{let{uniforms:b}=a,c=Iw.x.div(Iw.y),d=Ic(Gu.x.mul(c),Gu.y),e=IS(a,b.speed),f=d.mul(BL(b.scale.uniform)).add(b.seed.uniform),g=Es(Id(f.x,f.y,e.mul(.5))),h=b.contrast.uniform.add(1),i=AW(0,1,g.mul(h).add(b.balance.uniform).mul(.5).add(.5));return DU(b.colorB.uniform,b.colorA.uniform,i)}};II();let VY={name:"SineWave",category:"Shapes & Masks",props:{color:{default:"#ffffff",transform:Q9,description:"The color of the sine wave",ui:{type:"color",label:"Color"}},amplitude:{default:.15,description:"The height/amplitude of the sine wave",ui:{type:"range",min:0,max:1,step:.01,label:"Amplitude"}},frequency:{default:1,description:"The frequency/number of wave cycles",ui:{type:"range",min:.1,max:20,step:.1,label:"Frequency"}},speed:{default:1,description:"The animation speed of the wave",ui:{type:"range",min:-5,max:5,step:.1,label:"Speed"}},angle:{default:0,transform:Rb,description:"The rotation angle of the wave (in degrees)",ui:{type:"range",min:0,max:360,step:1,label:"Angle"}},position:{default:{x:.5,y:.5},transform:Ra,description:"The center position of the wave",ui:{type:"position",label:"Position"}},thickness:{default:.2,description:"The thickness of the wave line",ui:{type:"range",min:0,max:2,step:.01,label:"Thickness"}},softness:{default:.4,description:"Edge softness of the wave line",ui:{type:"range",min:0,max:1,step:.01,label:"Softness"}}},fragmentNode:({uniforms:a})=>{let{vec2:b,vec4:c,sin:d,cos:e,abs:f,smoothstep:g,screenUV:h,viewportSize:i,time:j,radians:k,PI:l}=IH,m=i.x.div(i.y),n=b(h.x.mul(m),h.y),o=b(a.position.uniform.x.mul(m),a.position.uniform.y.oneMinus()),p=n.sub(o),q=k(a.angle.uniform),r=e(q),s=d(q),t=p.x.mul(r).sub(p.y.mul(s)),u=p.x.mul(s).add(p.y.mul(r)),v=j.mul(a.speed.uniform),w=d(t.mul(a.frequency.uniform).mul(l.mul(2)).add(v)).mul(a.amplitude.uniform),x=f(u.sub(w)),y=a.thickness.uniform.mul(.5),z=a.softness.uniform.mul(.5),A=g(y.add(z),y.sub(z),x);return c(a.color.uniform.rgb,a.color.uniform.a.mul(A))}},VZ={name:"SolidColor",category:"Gradients & Colors",props:{color:{default:"#5b18ca",transform:Q9,description:"The solid color to display",ui:{type:"color",label:"Color"}}},fragmentNode:({uniforms:a})=>a.color.uniform};II();let V$={name:"Spiral",category:"Shapes & Masks",props:{colorA:{default:"#000000",transform:Q9,description:"Background color",ui:{type:"color",label:"Color A"}},colorB:{default:"#ffffff",transform:Q9,description:"Spiral stroke color",ui:{type:"color",label:"Color B"}},strokeWidth:{default:.5,description:"Thickness of spiral stroke",ui:{type:"range",min:0,max:2,step:.01,label:"Stroke Width"}},strokeFalloff:{default:0,description:"Stroke losing width further from center",ui:{type:"range",min:0,max:1,step:.01,label:"Stroke Falloff"}},softness:{default:0,description:"Color transition sharpness (0 = hard edge, 1 = smooth fade)",ui:{type:"range",min:0,max:1,step:.01,label:"Softness"}},speed:{default:1,description:"Animation speed (negative values reverse direction)",ui:{type:"range",min:-3,max:3,step:.1,label:"Speed"}},center:{default:{x:.5,y:.5},transform:Ra,description:"The center point of the spiral",ui:{type:"position",label:"Center"}},scale:{default:1,description:"Scale factor for spiral bands (higher = more bands, lower = fewer bands)",ui:{type:"range",min:.1,max:5,step:.1,label:"Scale"}},colorSpace:{default:"linear",transform:Re,description:"Color space for color interpolation",ui:{type:"select",options:Rd,label:"Color Space"}}},fragmentNode:({uniforms:a})=>{let{vec2:b,vec4:c,float:d,atan:e,length:f,clamp:g,fract:h,abs:i,mix:j,smoothstep:k,screenUV:l,time:m,fwidth:n,viewportSize:o}=IH,p=o.x.div(o.y),q=b(l.x.mul(p),l.y),r=b(a.center.uniform.x.mul(p),a.center.uniform.y.oneMinus()),s=q.sub(r),t=m.mul(a.speed.uniform),u=f(s),v=e(s.y,s.x).sub(t),w=d(6.283185307),x=v.div(w),y=u.mul(a.scale.uniform).add(x),z=i(h(y).sub(.5)).mul(2),A=g(a.strokeWidth.uniform,a.strokeFalloff.uniform.mul(.005),1),B=g(a.strokeFalloff.uniform,0,1).mul(u).oneMinus(),C=A.mul(B),D=n(y),E=j(d(4).sub(k(.05,.4,a.strokeWidth.uniform.mul(2)).mul(k(.05,.4,a.strokeWidth.uniform.oneMinus().mul(2))).mul(3)).mul(D),n(z),g(D,0,1)),F=k(C.sub(E).sub(a.softness.uniform),C.add(E).add(a.softness.uniform),z),G=Rv(a.colorA.uniform,a.colorB.uniform,F,a.colorSpace.uniform);return c(G.rgb,G.a)}};II();let V_={name:"Strands",category:"Generative",requiresRTT:!1,requiresChild:!1,props:{speed:{default:.5,description:"Overall animation speed",ui:{type:"range",min:0,max:1,step:.01,label:"Speed"}},amplitude:{default:1,description:"Wave height amplitude",ui:{type:"range",min:0,max:5,step:.1,label:"Amplitude"}},frequency:{default:1,description:"Wave frequency",ui:{type:"range",min:0,max:5,step:.01,label:"Frequency"}},lineCount:{default:12,description:"Number of wave lines",ui:{type:"range",min:4,max:32,step:1,label:"Line Count"}},lineWidth:{default:.1,description:"Width of wave lines",ui:{type:"range",min:.01,max:.5,step:.01,label:"Line Width"}},waveColor:{default:"#f1c907",transform:Q9,description:"Color of the waves",ui:{type:"color",label:"Wave Color"}},pinEdges:{default:!0,description:"Pin waves at edges (fade effect)",ui:{type:"checkbox",label:"Pin Edges"}},start:{default:{x:0,y:.5},transform:Ra,description:"Starting point of the waves",ui:{type:"position",label:"Start"}},end:{default:{x:1,y:.5},transform:Ra,description:"Ending point of the waves",ui:{type:"position",label:"End"}}},fragmentNode:a=>{let{uniforms:b}=a,{vec2:c,vec4:d,cos:e,abs:f,smoothstep:g,mix:h,max:i,screenCoordinate:j,viewportSize:k,float:l,Fn:m}=IH,n=IS(a,b.speed),o=m(([a])=>e(a).add(e(a.mul(1.2).add(1.6))).add(e(a.mul(1.4).add(1.5))).div(3));return m(([a])=>{let j=k.x.div(k.y),m=c(b.start.uniform.x.mul(j),b.start.uniform.y.oneMinus()),p=c(b.end.uniform.x.mul(j),b.end.uniform.y.oneMinus()),q=c(a.x.mul(j),a.y),r=p.sub(m),s=r.length(),t=r.div(s),u=c(t.y.negate(),t.x),v=q.sub(m),w=v.dot(t).div(s),x=v.dot(u),y=w.mul(10),z=x.mul(10),A=b.pinEdges.uniform.select(g(l(0),l(.1),w).mul(g(l(1),l(.9),w)),l(1)),B=b.pinEdges.uniform.select(e(w.mul(6.28)).mul(.5).add(.5).oneMinus(),l(1)),C=e(w.mul(6.28)).mul(.5).add(.5).oneMinus(),D=d(0,0,0,0).toVar(),E=b.lineCount.uniform;for(let a=0;a<32;a++){let c=l(a).lessThan(E),e=l(a),j=e.div(E),k=l(.5),m=l(1.33),p=n.mul(m),q=e.add(y.mul(k)),r=o(q.add(p)).mul(.5).add(.5),s=h(l(.01),b.lineWidth.uniform,r.mul(B)).mul(.5),t=l(.6),u=l(2),v=o(q.add(p.mul(j.add(1)))).mul(h(t,u,B)).mul(b.amplitude.uniform),w=o(y.mul(b.frequency.uniform).add(n)).mul(B).mul(b.amplitude.uniform).add(v),x=f(z.sub(w)),A=l(.01),C=g(s.add(A),s.sub(A),x),F=d(b.waveColor.uniform.r,b.waveColor.uniform.g,b.waveColor.uniform.b,C).mul(r);D.assign(i(D,c.select(F,d(0,0,0,0))))}return D.mul(d(1,1,1,C.mul(A)))})(j.div(k))}};II();let V0={name:"Swirl",category:"Gradients & Colors",props:{colorA:{default:"#1275d8",description:"Primary gradient color",transform:Q9,ui:{type:"color",label:"Primary Color"}},colorB:{default:"#e19136",description:"Secondary gradient color",transform:Q9,ui:{type:"color",label:"Secondary Color"}},speed:{default:1,description:"Flow animation speed",ui:{type:"range",min:0,max:5,step:.1,label:"Speed"}},detail:{default:1,description:"Level of detail and intricacy in the swirl patterns",ui:{type:"range",min:0,max:10,step:.1,label:"Detail"}},blend:{default:50,description:"Skew color balance toward A (lower values) or B (higher values)",ui:{type:"range",min:0,max:100,step:1,label:"Blend"}},coarseX:{default:50,description:"Horizontal frequency for coarse/base layer",ui:{type:"range",min:0,max:100,step:1,label:"Coarse X"}},coarseY:{default:50,description:"Vertical frequency for coarse/base layer",ui:{type:"range",min:0,max:100,step:1,label:"Coarse Y"}},mediumX:{default:50,description:"Horizontal frequency for medium detail layer",ui:{type:"range",min:0,max:100,step:1,label:"Medium X"}},mediumY:{default:50,description:"Vertical frequency for medium detail layer",ui:{type:"range",min:0,max:100,step:1,label:"Medium Y"}},fineX:{default:50,description:"Horizontal frequency for fine detail layer",ui:{type:"range",min:0,max:100,step:1,label:"Fine X"}},fineY:{default:50,description:"Vertical frequency for fine detail layer",ui:{type:"range",min:0,max:100,step:1,label:"Fine Y"}},colorSpace:{default:"linear",transform:Re,description:"Color space for color interpolation",ui:{type:"select",options:Rd,label:"Color Space"}}},fragmentNode:a=>{let{uniforms:b}=a,{vec2:c,vec4:d,float:e,screenUV:f,sin:g,cos:h,smoothstep:i}=IH,j=IS(a,b.speed),k=b.detail.uniform,l=e(.02),m=e(.028),n=e(.056),o=b.coarseX.uniform.mul(l),p=b.coarseY.uniform.mul(l),q=c(f.x.add(g(f.y.mul(k.mul(p).mul(1.7)).add(j.mul(.8))).mul(.12)),f.y.add(h(f.x.mul(k.mul(o).mul(1.3)).sub(j.mul(.6))).mul(.12))),r=g(q.x.mul(k.mul(o).mul(2.1)).add(q.y.mul(k.mul(p).mul(1.8))).add(j.mul(.4))),s=k.mul(1.4),t=b.mediumX.uniform.mul(m),u=b.mediumY.uniform.mul(m),v=c(q.x.add(h(q.y.mul(s.mul(u).mul(1.9)).sub(j.mul(.5))).mul(.06)),q.y.add(g(q.x.mul(s.mul(t).mul(2.3)).add(j.mul(.7))).mul(.06))),w=h(v.x.mul(s.mul(t).mul(1.6)).sub(v.y.mul(s.mul(u).mul(2.4))).add(j.mul(.3))),x=k.mul(2.8),y=b.fineX.uniform.mul(n),z=b.fineY.uniform.mul(n),A=c(v.x.add(g(v.y.mul(x.mul(z).mul(1.1)).add(j.mul(.9))).mul(.03)),v.y.add(h(v.x.mul(x.mul(y).mul(.9)).sub(j.mul(.4))).mul(.03))),B=g(A.x.mul(x.mul(y).mul(1.3)).add(A.y.mul(x.mul(z).mul(1.7))).sub(j.mul(.6))),C=r.mul(.5).add(w.mul(.3)).add(B.mul(.2)),D=b.blend.uniform.sub(50).mul(.006),E=i(.3,.7,C.mul(.5).add(.5).add(D)),F=Rv(b.colorA.uniform,b.colorB.uniform,E,b.colorSpace.uniform),G=g(j.mul(2.5).add(C.mul(8))).mul(.015).add(1),H=F.mul(G);return d(H.rgb,H.a)}};II();let V1={name:"TiltShift",category:"Blurs",requiresRTT:!0,requiresChild:!0,props:{intensity:{default:50,description:"Maximum blur intensity at edges",ui:{type:"range",min:0,max:100,step:1,label:"Intensity"}},width:{default:.3,description:"Width of the sharp focus area",ui:{type:"range",min:0,max:1,step:.01,label:"Width"}},falloff:{default:.3,description:"Distance over which blur transitions to full strength",ui:{type:"range",min:0,max:1,step:.01,label:"Falloff"}},angle:{default:0,transform:Rb,description:"Rotation angle of the focus line (in degrees)",ui:{type:"range",min:0,max:360,step:1,label:"Angle"}},center:{default:{x:.5,y:.5},transform:Ra,description:"Center point of the focus line",ui:{type:"position",label:"Center"}}},fragmentNode:({uniforms:a,childNode:b,onCleanup:c})=>{let{vec2:d,vec4:e,float:f,screenUV:g,convertToTexture:h,viewportSize:i,radians:j,cos:k,sin:l,dot:m,abs:n,smoothstep:o,mix:p,Fn:q}=IH;if(!b)return e(0,0,0,0);let r=h(b);c(()=>{r?.renderTarget?.dispose&&r.renderTarget.dispose()});let s=j(a.angle.uniform),t=k(s),u=d(l(s).negate(),t),v=d(a.center.uniform[0],a.center.uniform[1].oneMinus()),w=n(m(g.sub(v),u)),x=a.width.uniform.mul(.5),y=a.falloff.uniform,z=o(x,x.add(y),w),A=a.intensity.uniform.mul(.06),B=z.mul(A),C=[.056,.135,.278,.487,.726,.923,1,.923,.726,.487,.278,.135,.056],D=h(q(()=>{let a=d(1).div(i),b=e(0).toVar();for(let c=-6;c<=6;c++){let e=f(C[c+6]/6.214),h=d(f(c),f(0)).mul(B).mul(a),i=g.add(h),j=r.sample(i).mul(e);b.assign(b.add(j))}return b})());return c(()=>{D?.renderTarget?.dispose&&D.renderTarget.dispose()}),q(()=>{let a=d(1).div(i),b=e(0).toVar();for(let c=-6;c<=6;c++){let e=f(C[c+6]/6.214),h=d(f(0),f(c)).mul(B).mul(a),i=g.add(h),j=D.sample(i).mul(e);b.assign(b.add(j))}return p(r.sample(g),b,z)})()}};II();let V2={name:"Tritone",category:"Effects",requiresRTT:!0,requiresChild:!0,props:{colorA:{default:"#ce1bea",transform:Q9,description:"First color (used for shadows/darkest areas)",ui:{type:"color",label:"Color A (Shadows)"}},colorB:{default:"#2fff00",transform:Q9,description:"Second color (used for midtones)",ui:{type:"color",label:"Color B (Midtones)"}},colorC:{default:"#ffff00",transform:Q9,description:"Third color (used for highlights/brightest areas)",ui:{type:"color",label:"Color C (Highlights)"}},blendMid:{default:.5,description:"Midpoint position between the three colors",ui:{type:"range",min:0,max:1,step:.01,label:"Midpoint"}},colorSpace:{default:"linear",transform:Re,description:"Color space for color interpolation",ui:{type:"select",options:Rd,label:"Color Space"}}},fragmentNode:({uniforms:a,childNode:b,onCleanup:c})=>{let{vec3:d,vec4:e,dot:f,smoothstep:g,screenUV:h,convertToTexture:i}=IH;if(!b)return e(0,0,0,0);let j=i(b);c(()=>{j?.renderTarget?.dispose&&j.renderTarget.dispose()});let k=j.sample(h),l=f(k.rgb,d(.299,.587,.114)),m=g(a.blendMid.uniform.sub(.25),a.blendMid.uniform,l),n=Rv(a.colorA.uniform,a.colorB.uniform,m,a.colorSpace.uniform),o=g(a.blendMid.uniform,a.blendMid.uniform.add(.25),l);return e(Rv(n,Rv(a.colorB.uniform,a.colorC.uniform,o,a.colorSpace.uniform),g(a.blendMid.uniform.sub(.1),a.blendMid.uniform.add(.1),l),a.colorSpace.uniform).rgb,k.a)}};II();let V3={name:"Twirl",category:"Distortions",requiresRTT:!0,requiresChild:!0,props:{center:{default:{x:.5,y:.5},transform:Ra,description:"The center point of the twirl effect",ui:{type:"position",label:"Center"}},intensity:{default:1,description:"The strength of the twirl effect",ui:{type:"range",min:-5,max:5,step:.1,label:"Intensity"}},edges:{default:"stretch",description:"How to handle edges when distortion pushes content out of bounds",transform:Rc,ui:{type:"select",options:[{label:"Stretch",value:"stretch"},{label:"Transparent",value:"transparent"},{label:"Mirror",value:"mirror"},{label:"Wrap",value:"wrap"}],label:"Edges"}}},fragmentNode:({uniforms:a,childNode:b,onCleanup:c})=>{let{vec2:d,vec4:e,cos:f,sin:g,length:h,screenUV:i,convertToTexture:j}=IH;if(!b)return console.error("You must pass a child component into the Twirl shader."),e(0);let k=j(b);c(()=>{k?.renderTarget?.dispose&&k.renderTarget.dispose()});let l=d(a.center.uniform.x,a.center.uniform.y.oneMinus()),m=i.sub(l),n=a.intensity.uniform.mul(h(m)),o=f(n),p=g(n),q=o.mul(m.x).sub(p.mul(m.y)),r=p.mul(m.x).add(o.mul(m.y)),s=d(q.add(l.x),r.add(l.y));return IR(s,k.sample(s),k,a.edges.uniform)}};II();let V4={name:"Vibrance",category:"Color Adjustments",requiresChild:!0,props:{intensity:{default:0,description:"The intensity of the vibrance effect",ui:{type:"range",min:-2,max:2,step:.01,label:"Intensity"}}},fragmentNode:({uniforms:a,childNode:b})=>{let{vec4:c}=IH;if(!b)return console.error("You must pass a child component into the Vibrance shader."),c(0);let d=b||c(0,0,0,0);return c(VB(d.rgb,a.intensity.uniform).rgb,d.a)}};II();let V5={name:"WaveDistortion",category:"Distortions",requiresRTT:!0,requiresChild:!0,props:{strength:{default:.3,description:"Distortion intensity",ui:{type:"range",min:0,max:1,step:.01,label:"Strength"}},frequency:{default:1,description:"Number of bends/waves",ui:{type:"range",min:.1,max:10,step:.1,label:"Frequency"}},speed:{default:1,description:"Animation speed",ui:{type:"range",min:0,max:5,step:.1,label:"Speed"}},angle:{default:0,description:"Direction of wave distortion in degrees",ui:{type:"range",min:0,max:360,step:1,label:"Angle"}},waveType:{default:"sine",description:"Shape of the distortion wave",transform:a=>({sine:0,triangle:1,square:2,sawtooth:3})[a]??0,ui:{type:"select",options:[{label:"Sine",value:"sine"},{label:"Triangle",value:"triangle"},{label:"Square",value:"square"},{label:"Sawtooth",value:"sawtooth"}],label:"Wave Type"}},edges:{default:"stretch",description:"How to handle edges when distortion pushes content out of bounds",transform:Rc,ui:{type:"select",options:[{label:"Stretch",value:"stretch"},{label:"Transparent",value:"transparent"},{label:"Mirror",value:"mirror"},{label:"Wrap",value:"wrap"}],label:"Edges"}}},fragmentNode:a=>{let{uniforms:b,childNode:c,onCleanup:d}=a,{vec2:e,vec4:f,sin:g,cos:h,abs:i,fract:j,step:k,convertToTexture:l,screenUV:m,float:n,PI:o}=IH;if(!c)return f(0,0,0,0);let p=IS(a,b.speed).mul(.5),q=b.angle.uniform.mul(o).div(180),r=h(q),s=g(q),t=m.sub(e(.5,.5)),u=e(t.x.mul(r).sub(t.y.mul(s)),t.x.mul(s).add(t.y.mul(r))).add(e(.5,.5)).y.mul(b.frequency.uniform).mul(o.mul(2)).add(p),v=j(u.div(o.mul(2))),w=g(u),x=i(v.mul(2).sub(1)).mul(2).sub(1),y=k(n(.5),v).mul(2).sub(1),z=v.mul(2).sub(1),A=b.waveType.uniform,B=k(A,n(.5)),C=k(n(.5),A).mul(k(A,n(1.5))),D=k(n(1.5),A).mul(k(A,n(2.5))),E=k(n(2.5),A),F=w.mul(B).add(x.mul(C)).add(y.mul(D)).add(z.mul(E)).mul(b.strength.uniform).mul(.5),G=F.mul(r),H=F.mul(s),I=e(m.x.add(G),m.y.add(H)),J=l(c);return d(()=>{J?.renderTarget?.dispose&&J.renderTarget.dispose()}),IR(I,J.sample(I),J,b.edges.uniform)}};II();let V6={name:"ZoomBlur",category:"Blurs",requiresRTT:!0,requiresChild:!0,props:{intensity:{default:30,description:"Intensity of the zoom blur effect",ui:{type:"range",min:0,max:100,step:1,label:"Intensity"}},center:{default:{x:.5,y:.5},transform:Ra,description:"Center point of the zoom blur",ui:{type:"position",label:"Center"}}},fragmentNode:({uniforms:a,childNode:b,onCleanup:c})=>{let{vec2:d,vec4:e,float:f,screenUV:g,Fn:h,convertToTexture:i}=IH;if(!b)return e(0,0,0,0);let j=i(b);c(()=>{j?.renderTarget?.dispose&&j.renderTarget.dispose()});let k=d(a.center.uniform.x,a.center.uniform.y.oneMinus()),l=a.intensity.uniform.mul(.01);return h(()=>{let a=e(0).toVar(),b=f(0).toVar();for(let c=0;c<32;c++){let d=f(c).div(f(31)),e=d.sub(.5).mul(2),h=f(1).div(f(2.506628)).mul(f(-.5).mul(e).mul(e).div(f(.64)).exp()),i=f(1).add(l.mul(d)),m=g.sub(k).div(i).add(k),n=j.sample(m).mul(h);a.assign(a.add(n)),b.assign(b.add(h))}return a.div(b)})()}};IG(),II(),II();var V7=a=>Id(a.x.mul(1.2249401).sub(a.y.mul(.2249404)).sub(a.z.mul(0)),a.x.mul(-.0420569).add(a.y.mul(1.0420571)).add(a.z.mul(0)),a.x.mul(-.0196376).sub(a.y.mul(.0786361)).add(a.z.mul(1.0982735))),V8=a=>{let b=a.x,c=a.y,d=a.z,e=b.mul(.4122214708).add(c.mul(.5363325363)).add(d.mul(.0514459929)),f=b.mul(.2119034982).add(c.mul(.6806995451).add(d.mul(.1073969566))),g=b.mul(.0883024619).add(c.mul(.2817188376)).add(d.mul(.6299787005)),h=FP(e,BR(1/3)),i=FP(f,BR(1/3)),j=FP(g,BR(1/3));return Id(h.mul(.2104542553).add(i.mul(.793617785)).sub(j.mul(.0040720468)),h.mul(1.9779984951).sub(i.mul(2.428592205)).add(j.mul(.4505937099)),h.mul(.0259040371).add(i.mul(.7827717662)).sub(j.mul(.808675766)))},V9=a=>{let b=a.x,c=a.y,d=a.z;return Id(b,GV(c.mul(c).add(d.mul(d))),zW(d,c))};II();var Wa=a=>Id(a.x.mul(1.2249401).sub(a.y.mul(.2249404)).sub(a.z.mul(0)),a.x.mul(-.0420569).add(a.y.mul(1.0420571)).add(a.z.mul(0)),a.x.mul(-.0196376).sub(a.y.mul(.0786361)).add(a.z.mul(1.0982735))),Wb=a=>{let b=a.x,c=a.y,d=a.z,e=b.mul(.4122214708).add(c.mul(.5363325363)).add(d.mul(.0514459929)),f=b.mul(.2119034982).add(c.mul(.6806995451).add(d.mul(.1073969566))),g=b.mul(.0883024619).add(c.mul(.2817188376)).add(d.mul(.6299787005)),h=FP(e,BR(1/3)),i=FP(f,BR(1/3)),j=FP(g,BR(1/3));return Id(h.mul(.2104542553).add(i.mul(.793617785)).sub(j.mul(.0040720468)),h.mul(1.9779984951).sub(i.mul(2.428592205)).add(j.mul(.4505937099)),h.mul(.0259040371).add(i.mul(.7827717662)).sub(j.mul(.808675766)))};function Wc(a){return zG(zG(D8(a.r,.2126),D8(a.g,.7152)),D8(a.b,.0722))}II(),II(),II(),II(),II(),II(),II(),II(),II(),II(),II(),II(),II(),II(),II(),II(),II(),II();var Wd={normal:function(a,b,c=1){let d=D8(b.a,c),e=zG(d,D8(a.a,G3(1,d)));return Ie(zG(D8(b.rgb,d),D8(a.rgb,D8(a.a,G3(1,d)))),e)},"normal-oklch":function(a,b,c=1){var d,e;let f,g,h,i,j,k,l,m,n,o,p,q,r,s=D8(b.a,c),t=zG(s,D8(a.a,G3(1,s))),u=V7(Id(a.r,a.g,a.b)),v=V7(Id(b.r,b.g,b.b)),w=V8(u),x=V8(v),y=V9(w);return Ie((i=(f=(d=zG(D8(V9(x),s),D8(y,D8(a.a,G3(1,s))))).x,g=d.y,h=d.z,e=Id(f,g.mul(A9(h)),g.mul(GL(h)))).x,j=e.y,k=e.z,l=i.add(j.mul(.3963377774)).add(k.mul(.2158037573)),m=i.sub(j.mul(.1055613458)).sub(k.mul(.0638541728)),n=i.sub(j.mul(.0894841775)).sub(k.mul(1.291485548)),o=FP(l,BR(3)),p=FP(m,BR(3)),q=FP(n,BR(3)),r=Id(o.mul(4.0767416621).sub(p.mul(3.3077115913)).add(q.mul(.2309699292)),o.mul(-1.2684380046).add(p.mul(2.6097574011)).sub(q.mul(.3413193965)),o.mul(-.0041960863).sub(p.mul(.7034186147)).add(q.mul(1.707614701))),Id(r.x.mul(.8224621).add(r.y.mul(.177538)).add(r.z.mul(0)),r.x.mul(.0331941).add(r.y.mul(.9668058)).add(r.z.mul(0)),r.x.mul(.0170826).add(r.y.mul(.0723974)).add(r.z.mul(.9105199)))),t)},"normal-oklab":function(a,b,c=1){var d;let e,f,g,h,i,j,k,l,m,n,o=D8(b.a,c),p=zG(o,D8(a.a,G3(1,o))),q=Wa(Id(a.r,a.g,a.b)),r=Wa(Id(b.r,b.g,b.b)),s=Wb(q);return Ie((e=(d=zG(D8(Wb(r),o),D8(s,D8(a.a,G3(1,o))))).x,f=d.y,g=d.z,h=e.add(f.mul(.3963377774)).add(g.mul(.2158037573)),i=e.sub(f.mul(.1055613458)).sub(g.mul(.0638541728)),j=e.sub(f.mul(.0894841775)).sub(g.mul(1.291485548)),k=FP(h,BR(3)),l=FP(i,BR(3)),m=FP(j,BR(3)),n=Id(k.mul(4.0767416621).sub(l.mul(3.3077115913)).add(m.mul(.2309699292)),k.mul(-1.2684380046).add(l.mul(2.6097574011)).sub(m.mul(.3413193965)),k.mul(-.0041960863).sub(l.mul(.7034186147)).add(m.mul(1.707614701))),Id(n.x.mul(.8224621).add(n.y.mul(.177538)).add(n.z.mul(0)),n.x.mul(.0331941).add(n.y.mul(.9668058)).add(n.z.mul(0)),n.x.mul(.0170826).add(n.y.mul(.0723974)).add(n.z.mul(.9105199)))),p)},multiply:function(a,b,c=1){let d=D8(b.a,c),e=zG(d,D8(a.a,G3(1,d)));return Ie(zG(D8(D8(a.rgb,b.rgb),d),D8(a.rgb,D8(a.a,G3(1,d)))),e)},screen:function(a,b,c=1){let d=D8(b.a,c),e=zG(d,D8(a.a,G3(1,d)));return Ie(zG(D8(G3(1,D8(G3(1,a.rgb),G3(1,b.rgb))),d),D8(a.rgb,D8(a.a,G3(1,d)))),e)},linearDodge:function(a,b,c=1){let d=D8(b.a,c),e=zG(d,D8(a.a,G3(1,d)));return Ie(zG(D8(DT(zG(a.rgb,b.rgb),1),d),D8(a.rgb,D8(a.a,G3(1,d)))),e)},overlay:function(a,b,c=1){let d=D8(b.a,c),e=zG(d,D8(a.a,G3(1,d)));return Ie(zG(D8(DU(D8(2,D8(a.rgb,b.rgb)),G3(1,D8(2,D8(G3(1,a.rgb),G3(1,b.rgb)))),GX(.5,a.rgb)),d),D8(a.rgb,D8(a.a,G3(1,d)))),e)},difference:function(a,b,c=1){let d=D8(b.a,c),e=zG(d,D8(a.a,G3(1,d)));return Ie(zG(D8(zD(G3(a.rgb,b.rgb)),d),D8(a.rgb,D8(a.a,G3(1,d)))),e)},colorDodge:function(a,b,c=1){let d=D8(b.a,c),e=zG(d,D8(a.a,G3(1,d)));return Ie(zG(D8(DU(a.rgb,DT(BB(a.rgb,G3(1,b.rgb)),1),GX(.001,G3(1,b.rgb))),d),D8(a.rgb,D8(a.a,G3(1,d)))),e)},exclusion:function(a,b,c=1){let d=D8(b.a,c),e=zG(d,D8(a.a,G3(1,d)));return Ie(zG(D8(G3(zG(a.rgb,b.rgb),D8(2,D8(a.rgb,b.rgb))),d),D8(a.rgb,D8(a.a,G3(1,d)))),e)},color:function(a,b,c=1){let d=D8(b.a,c),e=zG(d,D8(a.a,G3(1,d))),f=G3(Wc(a.rgb),Wc(b.rgb));return Ie(zG(D8(zG(b.rgb,f),d),D8(a.rgb,D8(a.a,G3(1,d)))),e)},luminosity:function(a,b,c=1){let d=D8(b.a,c),e=zG(d,D8(a.a,G3(1,d))),f=Wc(a.rgb),g=Wc(b.rgb).div(zG(f,1e-4));return Ie(zG(D8(D8(a.rgb,g),d),D8(a.rgb,D8(a.a,G3(1,d)))),e)},darken:function(a,b,c=1){let d=D8(b.a,c),e=zG(d,D8(a.a,G3(1,d)));return Ie(zG(D8(DT(a.rgb,b.rgb),d),D8(a.rgb,D8(a.a,G3(1,d)))),e)},lighten:function(a,b,c=1){let d=D8(b.a,c),e=zG(d,D8(a.a,G3(1,d)));return Ie(zG(D8(DP(a.rgb,b.rgb),d),D8(a.rgb,D8(a.a,G3(1,d)))),e)},colorBurn:function(a,b,c=1){let d=D8(b.a,c),e=zG(d,D8(a.a,G3(1,d)));return Ie(zG(D8(DU(Ie(0,0,0,1).rgb,DP(G3(1,G3(1,a.rgb).div(zG(b.rgb,1e-4))),0),GX(1e-4,b.rgb)),d),D8(a.rgb,D8(a.a,G3(1,d)))),e)},linearBurn:function(a,b,c=1){let d=D8(b.a,c),e=zG(d,D8(a.a,G3(1,d)));return Ie(zG(D8(DP(zG(zG(a.rgb,b.rgb),-1),0),d),D8(a.rgb,D8(a.a,G3(1,d)))),e)},softLight:function(a,b,c=1){let d=D8(b.a,c),e=zG(d,D8(a.a,G3(1,d))),f=zG(D8(2,D8(a.rgb,b.rgb)),D8(D8(a.rgb,a.rgb),G3(1,D8(2,b.rgb)))),g=GV(a.rgb);return Ie(zG(D8(DU(f,zG(D8(2,D8(a.rgb,G3(1,b.rgb))),D8(g,G3(D8(2,b.rgb),1))),GX(.5,b.rgb)),d),D8(a.rgb,D8(a.a,G3(1,d)))),e)},hardLight:function(a,b,c=1){let d=D8(b.a,c),e=zG(d,D8(a.a,G3(1,d)));return Ie(zG(D8(DU(D8(2,D8(a.rgb,b.rgb)),G3(1,D8(2,D8(G3(1,a.rgb),G3(1,b.rgb)))),GX(.5,b.rgb)),d),D8(a.rgb,D8(a.a,G3(1,d)))),e)},hue:function(a,b,c=1){let d=D8(b.a,c),e=zG(d,D8(a.a,G3(1,d))),f=Wc(a.rgb),g=Wc(b.rgb),h=a.rgb.sub(f),i=b.rgb.sub(g),j=h.length();return Ie(zG(D8(zG(D8(i.normalize(),j),f),d),D8(a.rgb,D8(a.a,G3(1,d)))),e)},saturation:function(a,b,c=1){let d=D8(b.a,c),e=zG(d,D8(a.a,G3(1,d))),f=Wc(a.rgb),g=Wc(b.rgb),h=a.rgb.sub(f),i=b.rgb.sub(g);return Ie(zG(D8(zG(D8(h.normalize(),i.length()),f),d),D8(a.rgb,D8(a.a,G3(1,d)))),e)}};function We(a,b,c="normal",d=1){return(Wd[c]||Wd.normal)(a,b,d)}II(),II(),II(),II();var Wf={alpha:function(a,b){let c=D8(a.a,b.a);return Ie(a.rgb,c)},alphaInverted:function(a,b){let c=G3(1,b.a),d=D8(a.a,c);return Ie(a.rgb,d)},luminance:function(a,b){let c=Id(.2126,.7152,.0722),d=BD(b.rgb,c),e=D8(a.a,d);return Ie(a.rgb,e)},luminanceInverted:function(a,b){let c=Id(.2126,.7152,.0722),d=G3(1,BD(b.rgb,c)),e=D8(a.a,d);return Ie(a.rgb,e)}},Wg=class{constructor(){y(this,"frameTimesMs",[]),y(this,"maxSamples",60),y(this,"targetFrameTime",16.67),y(this,"jankFrameCount",0),y(this,"totalFrameCount",0),y(this,"memorySnapshots",[]),y(this,"memoryWindowMs",5e3),y(this,"nodeCount",0),y(this,"rttNodeCount",0),y(this,"lastCpuTime",null),y(this,"lastGpuTime",null),y(this,"isRendering",!1)}recordFrame(a){this.frameTimesMs.push(a),this.frameTimesMs.length>this.maxSamples&&this.frameTimesMs.shift(),this.totalFrameCount++,a>this.targetFrameTime&&this.jankFrameCount++,this.recordMemorySnapshot()}recordCpuTime(a){this.lastCpuTime=a}recordGpuTime(a){this.lastGpuTime=a}updateNodeCounts(a,b){this.nodeCount=a,this.rttNodeCount=b}setRendering(a){this.isRendering=a}recordMemorySnapshot(){if(!performance.memory)return;let a=performance.now(),b=performance.memory.usedJSHeapSize;this.memorySnapshots.push({time:a,bytes:b});let c=a-this.memoryWindowMs;this.memorySnapshots=this.memorySnapshots.filter(a=>a.time>c)}calculateMemoryGrowthRate(){if(this.memorySnapshots.length<2)return null;let a=this.memorySnapshots[0],b=this.memorySnapshots[this.memorySnapshots.length-1],c=(b.time-a.time)/1e3;return(b.bytes-a.bytes)/1048576/c}calculateStdDev(a){if(0===a.length)return 0;let b=a.reduce((a,b)=>a+b,0)/a.length;return Math.sqrt(a.map(a=>(a-b)**2).reduce((a,b)=>a+b,0)/a.length)}calculateP99(a){if(0===a.length)return 0;let b=[...a].sort((a,b)=>a-b),c=Math.floor(.99*b.length);return b[Math.min(c,b.length-1)]}calculateComplexityScore(){return this.nodeCount+10*this.rttNodeCount}calculateIntensityScore(){let a=this.frameTimesMs.length;if(0===a)return{score:0,label:"N/A"};let b=Math.min(this.frameTimesMs.reduce((a,b)=>a+b,0)/a/16.67*100,100),c=Math.min(this.calculateComplexityScore()/100*100,100),d=0;null!==this.lastGpuTime&&(d=Math.min(this.lastGpuTime/16.67*100,100));let e=null===this.lastGpuTime?{frame:.7,gpu:0,complexity:.3}:{frame:.4,gpu:.4,complexity:.2},f=Math.round(b*e.frame+d*e.gpu+c*e.complexity),g;return g=f<=20?"Very Light":f<=40?"Light":f<=60?"Medium":f<=80?"Heavy":"Very Heavy",{score:Math.min(f,100),label:g}}getStats(a){let b=this.frameTimesMs.length,c=b>0?1e3/(this.frameTimesMs.reduce((a,b)=>a+b,0)/b):0,d=b>0?this.frameTimesMs.reduce((a,b)=>a+b,0)/b:0,e=b>0?Math.min(...this.frameTimesMs):0,f=b>0?Math.max(...this.frameTimesMs):0,g=this.calculateP99(this.frameTimesMs),h=this.calculateStdDev(this.frameTimesMs),i=this.totalFrameCount>0?this.jankFrameCount/this.totalFrameCount*100:0,j=performance.memory,k=j?j.usedJSHeapSize/1048576:null,l=this.calculateMemoryGrowthRate(),m=d>0?d/this.targetFrameTime*100:0,n=a?.render?.calls??null,o=a?.programs?.length??null,p=a?.memory?.textures??null,q=this.calculateIntensityScore();return{fps:Math.round(c),avgFrameTime:Math.round(100*d)/100,minFrameTime:Math.round(100*e)/100,maxFrameTime:Math.round(100*f)/100,p99FrameTime:Math.round(100*g)/100,stdDevFrameTime:Math.round(100*h)/100,jankCount:this.jankFrameCount,jankPercent:Math.round(10*i)/10,nodeCount:this.nodeCount,rttNodeCount:this.rttNodeCount,complexityScore:this.calculateComplexityScore(),memoryUsedMB:null===k?null:Math.round(100*k)/100,memoryGrowthRate:null===l?null:Math.round(1e3*l)/1e3,cpuTime:null===this.lastCpuTime?null:Math.round(100*this.lastCpuTime)/100,gpuTime:null===this.lastGpuTime?null:Math.round(100*this.lastGpuTime)/100,budgetUsed:Math.round(10*m)/10,drawCalls:n,shaderPrograms:o,textureCount:p,intensityScore:q.score,intensityLabel:q.label,isRendering:this.isRendering}}reset(){this.frameTimesMs=[],this.jankFrameCount=0,this.totalFrameCount=0,this.memorySnapshots=[],this.lastCpuTime=null,this.lastGpuTime=null}};II();var{vec2:Wh,cos:Wi,sin:Wj,float:Wk,PI:Wl}=IH;let Wm=a=>0!==a.offsetX||0!==a.offsetY||0!==a.rotation||1!==a.scale||.5!==a.anchorX||.5!==a.anchorY;var Wn=E({createUniformsMap:()=>Wo,updateUniformValue:()=>Wp});function Wo(a,b,c){let d={};return Object.entries(a.props).forEach(([a,e])=>{let f=b[a],g=f;if(e.transform){let a=e.transform(f);g=a?.node??a}if(null==g&&(g=e.default,e.transform&&null!=g)){let a=e.transform(g);g=a?.node??a}g??(console.error(`[Shaders] Uniform "${a}" is null/undefined after fallback. PropConfig:`,{propName:a,initialValue:f,default:e.default,hasTransform:!!e.transform}),g=0);let h=Wr(g).setName(`${a}_${c}`);"string"==typeof g&&null===h.value&&(h.value=g),d[a]={uniform:h,transform:e.transform||void 0}}),d}function Wp(a,b){if(a?.transform){let c=a.transform(b),d=c?.data??c;a.uniform.value=d}else a.uniform.value=b}var Wq,Wr,Ws=D(()=>{II(),{uniform:Wr}=IH});II();var Wt=!1,Wu=(o=0,p=new Set,q=a=>{p.forEach(b=>{try{b.onMouseMove(a)}catch(a){console.error("[Shaders] Error in mouse move handler:",a)}})},r=a=>{p.forEach(b=>{try{b.onTouchMove(a)}catch(a){console.error("[Shaders] Error in touch move handler:",a)}})},s=()=>{p.forEach(a=>{try{a.onMouseUp()}catch(a){console.error("[Shaders] Error in mouse up handler:",a)}})},t=()=>{p.forEach(a=>{try{a.onTouchEnd()}catch(a){console.error("[Shaders] Error in touch end handler:",a)}})},{register:a=>(p.add(a),1==++o&&(window.addEventListener("mousemove",q),window.addEventListener("touchmove",r),window.addEventListener("mouseup",s),window.addEventListener("touchend",t)),()=>{p.delete(a),0==--o&&(window.removeEventListener("mousemove",q),window.removeEventListener("touchmove",r),window.removeEventListener("mouseup",s),window.removeEventListener("touchend",t))})});Ws(),II();var{vec2:Wv,fract:Ww,sin:Wx,dot:Wy}=IH;II();var{vec2:Wz}=IH;II(),II(),u={},Object.entries({AngularBlur:Rf,Ascii:Rg,Blob:Rw,Blur:Rx,Bulge:Ry,ChannelBlur:Rz,Checkerboard:RA,ChromaFlow:RB,ChromaticAberration:RC,Circle:RD,CRTScreen:RE,CursorTrail:RF,DiffuseBlur:RG,Dither:RH,DotGrid:RI,Duotone:RJ,FilmGrain:RK,FloatingParticles:RL,GlassTiles:RM,Glow:RN,Godrays:RO,Grayscale:VE,Grid:VF,GridDistortion:VG,Group:VH,Halftone:VI,HueShift:VJ,ImageTexture:VK,Invert:VL,LinearBlur:VM,LinearGradient:VN,Liquify:VO,Pixelate:VP,PolarCoordinates:VQ,Posterize:VS,ProgressiveBlur:VT,RadialGradient:VU,Ripples:VV,Saturation:VW,SimplexNoise:VX,SineWave:VY,SolidColor:VZ,Spiral:V$,Strands:V_,Swirl:V0,TiltShift:V1,Tritone:V2,Twirl:V3,Vibrance:V4,WaveDistortion:V5,ZoomBlur:V6}).forEach(([a,b])=>{let c={};b.props&&Object.entries(b.props).forEach(([a,b])=>{b.ui&&(c[a]={ui:b.ui,default:b.default,description:b.description})}),u[b.name]={name:b.name,fileName:a,category:b.category||"Uncategorized",definition:b,propsMetadata:c}});let WA=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","aoMapIntensity","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveIntensity","emissiveMap","envMap","envMapIntensity","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","lightMapIntensity","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"],WB=new WeakMap;class WC{constructor(a){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(a),this.hasAnimation=!0===a.object.isSkinnedMesh,this.refreshUniforms=WA,this.renderId=0}firstInitialization(a){return!1===this.renderObjects.has(a)&&(this.getRenderObjectData(a),!0)}needsVelocity(a){let b=a.getMRT();return null!==b&&b.has("velocity")}getRenderObjectData(a){let b=this.renderObjects.get(a);if(void 0===b){let{geometry:c,material:d,object:e}=a;if(b={material:this.getMaterialData(d),geometry:{id:c.id,attributes:this.getAttributesData(c.attributes),indexVersion:c.index?c.index.version:null,drawRange:{start:c.drawRange.start,count:c.drawRange.count}},worldMatrix:e.matrixWorld.clone()},e.center&&(b.center=e.center.clone()),e.morphTargetInfluences&&(b.morphTargetInfluences=e.morphTargetInfluences.slice()),null!==a.bundle&&(b.version=a.bundle.version),b.material.transmission>0){let{width:c,height:d}=a.context;b.bufferWidth=c,b.bufferHeight=d}b.lights=this.getLightsData(a.lightsNode.getLights()),this.renderObjects.set(a,b)}return b}getAttributesData(a){let b={};for(let c in a){let d=a[c];b[c]={version:d.version}}return b}containsNode(a){let b=a.material;for(let a in b)if(b[a]&&b[a].isNode)return!0;return null!==a.renderer.overrideNodes.modelViewMatrix||null!==a.renderer.overrideNodes.modelNormalViewMatrix}getMaterialData(a){let b={};for(let c of this.refreshUniforms){let d=a[c];null!=d&&("object"==typeof d&&void 0!==d.clone?!0===d.isTexture?b[c]={id:d.id,version:d.version}:b[c]=d.clone():b[c]=d)}return b}equals(a,b){let{object:c,material:d,geometry:e}=a,f=this.getRenderObjectData(a);if(!0!==f.worldMatrix.equals(c.matrixWorld))return f.worldMatrix.copy(c.matrixWorld),!1;let g=f.material;for(let a in g){let b=g[a],c=d[a];if(void 0!==b.equals){if(!1===b.equals(c))return b.copy(c),!1}else if(!0===c.isTexture){if(b.id!==c.id||b.version!==c.version)return b.id=c.id,b.version=c.version,!1}else if(b!==c)return g[a]=c,!1}if(g.transmission>0){let{width:b,height:c}=a.context;if(f.bufferWidth!==b||f.bufferHeight!==c)return f.bufferWidth=b,f.bufferHeight=c,!1}let h=f.geometry,i=e.attributes,j=h.attributes,k=Object.keys(j),l=Object.keys(i);if(h.id!==e.id)return h.id=e.id,!1;if(k.length!==l.length)return f.geometry.attributes=this.getAttributesData(i),!1;for(let a of k){let b=j[a],c=i[a];if(void 0===c)return delete j[a],!1;if(b.version!==c.version)return b.version=c.version,!1}let m=e.index,n=h.indexVersion,o=m?m.version:null;if(n!==o)return h.indexVersion=o,!1;if(h.drawRange.start!==e.drawRange.start||h.drawRange.count!==e.drawRange.count)return h.drawRange.start=e.drawRange.start,h.drawRange.count=e.drawRange.count,!1;if(f.morphTargetInfluences){let a=!1;for(let b=0;b<f.morphTargetInfluences.length;b++)f.morphTargetInfluences[b]!==c.morphTargetInfluences[b]&&(f.morphTargetInfluences[b]=c.morphTargetInfluences[b],a=!0);if(a)return!1}if(f.lights){for(let a=0;a<b.length;a++)if(f.lights[a].map!==b[a].map)return!1}return f.center&&!1===f.center.equals(c.center)?f.center.copy(c.center):null!==a.bundle&&(f.version=a.bundle.version),!0}getLightsData(a){let b=[];for(let c of a)!0===c.isSpotLight&&null!==c.map&&b.push({map:c.map.version});return b}getLights(a,b){if(WB.has(a)){let c=WB.get(a);if(c.renderId===b)return c.lightsData}let c=this.getLightsData(a.getLights());return WB.set(a,{renderId:b,lightsData:c}),c}needsRefresh(a,b){if(this.hasNode||this.hasAnimation||this.firstInitialization(a)||this.needsVelocity(b.renderer))return!0;let{renderId:c}=b;if(this.renderId!==c)return this.renderId=c,!0;let d=!0===a.object.static,e=null!==a.bundle&&!0===a.bundle.static&&this.getRenderObjectData(a).version===a.bundle.version;if(d||e)return!1;let f=this.getLights(a.lightsNode,c);return!0!==this.equals(a,f)}}function WD(a,b=0){let c=0xdeadbeef^b,d=0x41c6ce57^b;if(a instanceof Array)for(let b=0,e;b<a.length;b++)c=Math.imul(c^(e=a[b]),0x9e3779b1),d=Math.imul(d^e,0x5f356495);else for(let b=0,e;b<a.length;b++)c=Math.imul(c^(e=a.charCodeAt(b)),0x9e3779b1),d=Math.imul(d^e,0x5f356495);return c=Math.imul(c^c>>>16,0x85ebca6b)^Math.imul(d^d>>>13,0xc2b2ae35),0x100000000*(2097151&(d=Math.imul(d^d>>>16,0x85ebca6b)^Math.imul(c^c>>>13,0xc2b2ae35)))+(c>>>0)}let WE=a=>WD(a),WF=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),WG=new WeakMap;function WH(a){if(/[iu]?vec\d/.test(a))return a.startsWith("ivec")?Int32Array:a.startsWith("uvec")?Uint32Array:Float32Array;if(/mat\d/.test(a)||/float/.test(a))return Float32Array;if(/uint/.test(a))return Uint32Array;if(/int/.test(a))return Int32Array;throw Error(`THREE.NodeUtils: Unsupported type: ${a}`)}function WI(a){return/float|int|uint/.test(a)?1:/vec2/.test(a)?2:/vec3/.test(a)?3:/vec4/.test(a)||/mat2/.test(a)?4:/mat3/.test(a)?9:/mat4/.test(a)?16:void I1("TSL: Unsupported type:",a)}function WJ(a){if(null==a)return null;let b=typeof a;return!0===a.isNode?"node":"number"===b?"float":"boolean"===b?"bool":"string"===b?"string":"function"===b?"shader":!0===a.isVector2?"vec2":!0===a.isVector3?"vec3":!0===a.isVector4?"vec4":!0===a.isMatrix2?"mat2":!0===a.isMatrix3?"mat3":!0===a.isMatrix4?"mat4":!0===a.isColor?"color":a instanceof ArrayBuffer?"ArrayBuffer":null}function WK(a,...b){let c=a?a.slice(-4):void 0;return 1===b.length&&("vec2"===c?b=[b[0],b[0]]:"vec3"===c?b=[b[0],b[0],b[0]]:"vec4"===c&&(b=[b[0],b[0],b[0],b[0]])),"color"===a?new KH(...b):"vec2"===c?new Jc(...b):"vec3"===c?new Je(...b):"vec4"===c?new Jv(...b):"mat2"===c?new LQ(...b):"mat3"===c?new Jh(...b):"mat4"===c?new JZ(...b):"bool"===a?b[0]||!1:"float"===a||"int"===a||"uint"===a?b[0]||0:"string"===a?b[0]||"":"ArrayBuffer"===a?WN(b[0]):null}function WL(a){let b=WG.get(a);return void 0===b&&(b={},WG.set(a,b)),b}function WM(a){let b="",c=new Uint8Array(a);for(let a=0;a<c.length;a++)b+=String.fromCharCode(c[a]);return btoa(b)}function WN(a){return Uint8Array.from(atob(a),a=>a.charCodeAt(0)).buffer}let WO={VERTEX:"vertex",FRAGMENT:"fragment"},WP={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},WQ={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},WR=["fragment","vertex"],WS=[...WR,"compute"],WT=["x","y","z","w"],WU={analyze:"setup",generate:"analyze"},WV=0;class WW extends I3{static get type(){return"Node"}constructor(a=null){super(),this.nodeType=a,this.updateType=WP.NONE,this.updateBeforeType=WP.NONE,this.updateAfterType=WP.NONE,this.uuid=I7(),this.version=0,this.name="",this.global=!1,this.parents=!1,this.isNode=!0,this._beforeNodes=null,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:WV++})}set needsUpdate(a){!0===a&&this.version++}get type(){return this.constructor.type}onUpdate(a,b){return this.updateType=b,this.update=a.bind(this),this}onFrameUpdate(a){return this.onUpdate(a,WP.FRAME)}onRenderUpdate(a){return this.onUpdate(a,WP.RENDER)}onObjectUpdate(a){return this.onUpdate(a,WP.OBJECT)}onReference(a){return this.updateReference=a.bind(this),this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(let{childNode:a}of this._getChildren())yield a}dispose(){this.dispatchEvent({type:"dispose"})}traverse(a){for(let b of(a(this),this.getChildren()))b.traverse(a)}_getChildren(a=new Set){let b=[];for(let c of(a.add(this),Object.getOwnPropertyNames(this))){let d=this[c];if(!(!0===c.startsWith("_")||a.has(d))){if(!0===Array.isArray(d))for(let a=0;a<d.length;a++){let e=d[a];e&&!0===e.isNode&&b.push({property:c,index:a,childNode:e})}else if(d&&!0===d.isNode)b.push({property:c,childNode:d});else if(d&&Object.getPrototypeOf(d)===Object.prototype)for(let a in d){if(!0===a.startsWith("_"))continue;let e=d[a];e&&!0===e.isNode&&b.push({property:c,index:a,childNode:e})}}}return b}getCacheKey(a=!1,b=null){if(!0===(a=a||this.version!==this._cacheKeyVersion)||null===this._cacheKey){null===b&&(b=new Set);let c=[];for(let{property:d,childNode:e}of this._getChildren(b))c.push(WE(d.slice(0,-4)),e.getCacheKey(a,b));this._cacheKey=((...a)=>WD(a))(WD(c),this.customCacheKey()),this._cacheKeyVersion=this.version}return this._cacheKey}customCacheKey(){return this.id}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(a){let b=this.getNodeType(a);return a.getElementType(b)}getMemberType(){return"void"}getNodeType(a){let b=a.getNodeProperties(this);return b.outputNode?b.outputNode.getNodeType(a):this.nodeType}getShared(a){let b=this.getHash(a);return a.getNodeFromHash(b)||this}getArrayCount(){return null}setup(a){let b=a.getNodeProperties(this),c=0;for(let a of this.getChildren())b["node"+c++]=a;return b.outputNode||null}analyze(a,b=null){let c=a.increaseUsage(this);if(!0===this.parents){let c=a.getDataFromNode(this,"any");c.stages=c.stages||{},c.stages[a.shaderStage]=c.stages[a.shaderStage]||[],c.stages[a.shaderStage].push(b)}if(1===c)for(let b of Object.values(a.getNodeProperties(this)))b&&!0===b.isNode&&b.build(a,this)}generate(a,b){let{outputNode:c}=a.getNodeProperties(this);if(c&&!0===c.isNode)return c.build(a,b)}updateBefore(){I0("Abstract function.")}updateAfter(){I0("Abstract function.")}update(){I0("Abstract function.")}before(a){return null===this._beforeNodes&&(this._beforeNodes=[]),this._beforeNodes.push(a),this}build(a,b=null){let c=this.getShared(a);if(this!==c)return c.build(a,b);if(null!==this._beforeNodes){let c=this._beforeNodes;for(let d of(this._beforeNodes=null,c))d.build(a,b);this._beforeNodes=c}let d=a.getDataFromNode(this);d.buildStages=d.buildStages||{},d.buildStages[a.buildStage]=!0;let e=WU[a.buildStage];if(e&&!0!==d.buildStages[e]){let b=a.getBuildStage();a.setBuildStage(e),this.build(a),a.setBuildStage(b)}a.addNode(this),a.addChain(this);let f=null,g=a.getBuildStage();if("setup"===g){this.updateReference(a);let b=a.getNodeProperties(this);if(!0!==b.initialized){for(let c of(b.initialized=!0,b.outputNode=this.setup(a)||b.outputNode||null,Object.values(b)))if(c&&!0===c.isNode){if(!0===c.parents){let b=a.getNodeProperties(c);b.parents=b.parents||[],b.parents.push(this)}c.build(a)}}f=b.outputNode}else if("analyze"===g)this.analyze(a,b);else if("generate"===g){if(this.generate.length<2){let c=this.getNodeType(a),d=a.getDataFromNode(this);void 0===(f=d.snippet)?void 0===d.generated?(d.generated=!0,d.snippet=f=this.generate(a)||""):(I0("Node: Recursion detected.",this),f="/* Recursion detected. */"):void 0!==d.flowCodes&&void 0!==a.context.nodeBlock&&a.addFlowCodeHierarchy(this,a.context.nodeBlock),f=a.format(f,c,b)}else f=this.generate(a,b)||"";""===f&&null!==b&&"void"!==b&&"OutputType"!==b&&(I1(`TSL: Invalid generated code, expected a "${b}".`),f=a.generateConst(b))}return a.removeChain(this),a.addSequentialNode(this),f}getSerializeChildren(){return this._getChildren()}serialize(a){let b=this.getSerializeChildren(),c={};for(let{property:d,index:e,childNode:f}of b)void 0!==e?(void 0===c[d]&&(c[d]=Number.isInteger(e)?[]:{}),c[d][e]=f.toJSON(a.meta).uuid):c[d]=f.toJSON(a.meta).uuid;Object.keys(c).length>0&&(a.inputNodes=c)}deserialize(a){if(void 0!==a.inputNodes){let b=a.meta.nodes;for(let c in a.inputNodes)if(Array.isArray(a.inputNodes[c])){let d=[];for(let e of a.inputNodes[c])d.push(b[e]);this[c]=d}else if("object"==typeof a.inputNodes[c]){let d={};for(let e in a.inputNodes[c]){let f=a.inputNodes[c][e];d[e]=b[f]}this[c]=d}else{let d=a.inputNodes[c];this[c]=b[d]}}}toJSON(a){let{uuid:b,type:c}=this,d=void 0===a||"string"==typeof a;d&&(a={textures:{},images:{},nodes:{}});let e=a.nodes[b];function f(a){let b=[];for(let c in a){let d=a[c];delete d.metadata,b.push(d)}return b}if(void 0===e&&(e={uuid:b,type:c,meta:a,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},!0!==d&&(a.nodes[e.uuid]=e),this.serialize(e),delete e.meta),d){let b=f(a.textures),c=f(a.images),d=f(a.nodes);b.length>0&&(e.textures=b),c.length>0&&(e.images=c),d.length>0&&(e.nodes=d)}return e}}class WX extends WW{static get type(){return"ArrayElementNode"}constructor(a,b){super(),this.node=a,this.indexNode=b,this.isArrayElementNode=!0}getNodeType(a){return this.node.getElementType(a)}generate(a){let b=this.indexNode.getNodeType(a),c=this.node.build(a),d=this.indexNode.build(a,!a.isVector(b)&&a.isInteger(b)?b:"uint");return`${c}[ ${d} ]`}}class WY extends WW{static get type(){return"ConvertNode"}constructor(a,b){super(),this.node=a,this.convertTo=b}getNodeType(a){let b=this.node.getNodeType(a),c=null;for(let d of this.convertTo.split("|"))(null===c||a.getTypeLength(b)===a.getTypeLength(d))&&(c=d);return c}serialize(a){super.serialize(a),a.convertTo=this.convertTo}deserialize(a){super.deserialize(a),this.convertTo=a.convertTo}generate(a,b){let c=this.node,d=this.getNodeType(a),e=c.build(a,d);return a.format(e,d,b)}}class WZ extends WW{static get type(){return"TempNode"}constructor(a=null){super(a),this.isTempNode=!0}hasDependencies(a){return a.getDataFromNode(this).usageCount>1}build(a,b){if("generate"===a.getBuildStage()){let c=a.getVectorType(this.getNodeType(a,b)),d=a.getDataFromNode(this);if(void 0!==d.propertyName)return a.format(d.propertyName,c,b);if("void"!==c&&"void"!==b&&this.hasDependencies(a)){let e=super.build(a,c),f=a.getVarFromNode(this,null,c),g=a.getPropertyName(f);return a.addLineFlowCode(`${g} = ${e}`,this),d.snippet=e,d.propertyName=g,a.format(d.propertyName,c,b)}}return super.build(a,b)}}class W$ extends WZ{static get type(){return"JoinNode"}constructor(a=[],b=null){super(b),this.nodes=a}getNodeType(a){return null!==this.nodeType?a.getVectorType(this.nodeType):a.getTypeFromLength(this.nodes.reduce((b,c)=>b+a.getTypeLength(c.getNodeType(a)),0))}generate(a,b){let c=this.getNodeType(a),d=a.getTypeLength(c),e=this.nodes,f=a.getComponentType(c),g=[],h=0;for(let b of e){if(h>=d){I1(`TSL: Length of parameters exceeds maximum length of function '${c}()' type.`);break}let e=b.getNodeType(a),i=a.getTypeLength(e),j;if(h+i>d&&(I1(`TSL: Length of '${c}()' data exceeds maximum length of output type.`),i=d-h,e=a.getTypeFromLength(i)),h+=i,j=b.build(a,e),a.getComponentType(e)!==f){let b=a.getTypeFromLength(i,f);j=a.format(j,e,b)}g.push(j)}let i=`${a.getType(c)}( ${g.join(", ")} )`;return a.format(i,c,b)}}let W_=WT.join("");class W0 extends WW{static get type(){return"SplitNode"}constructor(a,b="x"){super(),this.node=a,this.components=b,this.isSplitNode=!0}getVectorLength(){let a=this.components.length;for(let b of this.components)a=Math.max(WT.indexOf(b)+1,a);return a}getComponentType(a){return a.getComponentType(this.node.getNodeType(a))}getNodeType(a){return a.getTypeFromLength(this.components.length,this.getComponentType(a))}getScope(){return this.node.getScope()}generate(a,b){let c=this.node,d=a.getTypeLength(c.getNodeType(a)),e=null;if(d>1){let f=null;this.getVectorLength()>=d&&(f=a.getTypeFromLength(this.getVectorLength(),this.getComponentType(a)));let g=c.build(a,f);e=this.components.length===d&&this.components===W_.slice(0,this.components.length)?a.format(g,f,b):a.format(`${g}.${this.components}`,this.getNodeType(a),b)}else e=c.build(a,b);return e}serialize(a){super.serialize(a),a.components=this.components}deserialize(a){super.deserialize(a),this.components=a.components}}class W1 extends WZ{static get type(){return"SetNode"}constructor(a,b,c){super(),this.sourceNode=a,this.components=b,this.targetNode=c}getNodeType(a){return this.sourceNode.getNodeType(a)}generate(a){let{sourceNode:b,components:c,targetNode:d}=this,e=this.getNodeType(a),f=a.getComponentType(d.getNodeType(a)),g=a.getTypeFromLength(c.length,f),h=d.build(a,g),i=b.build(a,e),j=a.getTypeLength(e),k=[];for(let a=0;a<j;a++){let b=WT[a];b===c[0]?(k.push(h),a+=c.length-1):k.push(i+"."+b)}return`${a.getType(e)}( ${k.join(", ")} )`}}class W2 extends WZ{static get type(){return"FlipNode"}constructor(a,b){super(),this.sourceNode=a,this.components=b}getNodeType(a){return this.sourceNode.getNodeType(a)}generate(a){let{components:b,sourceNode:c}=this,d=this.getNodeType(a),e=c.build(a),f=a.getVarFromNode(this),g=a.getPropertyName(f);a.addLineFlowCode(g+" = "+e,this);let h=a.getTypeLength(d),i=[],j=0;for(let a=0;a<h;a++){let c=WT[a];c===b[j]?(i.push("1.0 - "+g+"."+c),j++):i.push(g+"."+c)}return`${a.getType(d)}( ${i.join(", ")} )`}}class W3 extends WW{static get type(){return"InputNode"}constructor(a,b=null){super(b),this.isInputNode=!0,this.value=a,this.precision=null}getNodeType(){return null===this.nodeType?WJ(this.value):this.nodeType}getInputType(a){return this.getNodeType(a)}setPrecision(a){return this.precision=a,this}serialize(a){super.serialize(a),a.value=this.value,this.value&&this.value.toArray&&(a.value=this.value.toArray()),a.valueType=WJ(this.value),a.nodeType=this.nodeType,"ArrayBuffer"===a.valueType&&(a.value=WM(a.value)),a.precision=this.precision}deserialize(a){super.deserialize(a),this.nodeType=a.nodeType,this.value=Array.isArray(a.value)?WK(a.valueType,...a.value):a.value,this.precision=a.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(a.value))}generate(){I0("Abstract function.")}}let W4=/float|u?int/;class W5 extends W3{static get type(){return"ConstNode"}constructor(a,b=null){super(a,b),this.isConstNode=!0}generateConst(a){return a.generateConst(this.getNodeType(a),this.value)}generate(a,b){let c=this.getNodeType(a);return W4.test(c)&&W4.test(b)?a.generateConst(b,this.value):a.format(this.generateConst(a),c,b)}}class W6 extends WW{static get type(){return"MemberNode"}constructor(a,b){super(),this.structNode=a,this.property=b,this.isMemberNode=!0}hasMember(a){return(!this.structNode.isMemberNode||!1!==this.structNode.hasMember(a))&&"void"!==this.structNode.getMemberType(a,this.property)}getNodeType(a){return!1===this.hasMember(a)?"float":this.structNode.getMemberType(a,this.property)}getMemberType(a,b){if(!1===this.hasMember(a))return"float";let c=this.getNodeType(a);return a.getStructTypeNode(c).getMemberType(a,b)}generate(a){if(!1===this.hasMember(a)){I0(`TSL: Member "${this.property}" does not exist in struct.`);let b=this.getNodeType(a);return a.generateConst(b)}return this.structNode.build(a)+"."+this.property}}let W7=null,W8=new Map;function W9(a,b){if(W8.has(a))return void I0(`TSL: Redefinition of method chaining '${a}'.`);if("function"!=typeof b)throw Error(`THREE.TSL: Node element ${a} is not a function`);W8.set(a,b),"assign"!==a&&(WW.prototype[a]=function(...a){return this.isStackNode?this.addToStack(b(...a)):b(this,...a)},WW.prototype[a+"Assign"]=function(...a){return this.isStackNode?this.assign(a[0],b(...a)):this.assign(b(this,...a))})}let Xa=a=>a.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w").split("").sort().join("");WW.prototype.assign=function(...a){if(!0!==this.isStackNode)return null!==W7?W7.assign(this,...a):I1("TSL: No stack defined for assign operation. Make sure the assign is inside a Fn()."),this;{let b=W8.get("assign");return this.addToStack(b(...a))}},WW.prototype.toVarIntent=function(){return this},WW.prototype.get=function(a){return new W6(this,a)};let Xb={};function Xc(a,b,c){Xb[a]=Xb[b]=Xb[c]={get(){this._cache=this._cache||{};let b=this._cache[a];return void 0===b&&(b=new W0(this,a),this._cache[a]=b),b},set(b){this[a].assign(Xz(b))}};let d=a.toUpperCase(),e=b.toUpperCase(),f=c.toUpperCase();WW.prototype["set"+d]=WW.prototype["set"+e]=WW.prototype["set"+f]=function(b){return new W1(this,Xa(a),Xz(b))},WW.prototype["flip"+d]=WW.prototype["flip"+e]=WW.prototype["flip"+f]=function(){return new W2(this,Xa(a))}}let Xd=["x","y","z","w"],Xe=["r","g","b","a"],Xf=["s","t","p","q"];for(let a=0;a<4;a++){let b=Xd[a],c=Xe[a],d=Xf[a];Xc(b,c,d);for(let e=0;e<4;e++){b=Xd[a]+Xd[e],Xc(b,c=Xe[a]+Xe[e],d=Xf[a]+Xf[e]);for(let f=0;f<4;f++){b=Xd[a]+Xd[e]+Xd[f],Xc(b,c=Xe[a]+Xe[e]+Xe[f],d=Xf[a]+Xf[e]+Xf[f]);for(let g=0;g<4;g++)b=Xd[a]+Xd[e]+Xd[f]+Xd[g],Xc(b,c=Xe[a]+Xe[e]+Xe[f]+Xe[g],d=Xf[a]+Xf[e]+Xf[f]+Xf[g])}}}for(let a=0;a<32;a++)Xb[a]={get(){this._cache=this._cache||{};let b=this._cache[a];return void 0===b&&(b=new WX(this,new W5(a,"uint")),this._cache[a]=b),b},set(b){this[a].assign(Xz(b))}};Object.defineProperties(WW.prototype,Xb);let Xg=new WeakMap,Xh=function(a,b=null){let c=WJ(a);return"node"===c?a:null===b&&("float"===c||"boolean"===c)||c&&"shader"!==c&&"string"!==c?Xz(Xu(a,b)):"shader"===c?a.isFn?a:XI(a):a},Xi=function(a,b=null){for(let c in a)a[c]=Xz(a[c],b);return a},Xj=function(a,b=null){let c=a.length;for(let d=0;d<c;d++)a[d]=Xz(a[d],b);return a},Xk=function(a,b=null,c=null,d=null){function e(a){return null!==d?(a=Xz(Object.assign(a,d)),!0===d.intent&&(a=a.toVarIntent())):a=Xz(a),a}let f,g=b,h,i;function j(b){let c;return c=g?/[a-z]/i.test(g)?g+"()":g:a.type,void 0!==h&&b.length<h?(I1(`TSL: "${c}" parameter length is less than minimum required.`),b.concat(Array(h-b.length).fill(0))):void 0!==i&&b.length>i?(I1(`TSL: "${c}" parameter length exceeds limit.`),b.slice(0,i)):b}return null===b?f=(...b)=>e(new a(...XC(j(b)))):null!==c?(c=Xz(c),f=(...d)=>e(new a(b,...XC(j(d)),c))):f=(...c)=>e(new a(b,...XC(j(c)))),f.setParameterLength=(...a)=>(1===a.length?h=i=a[0]:2===a.length&&([h,i]=a),f),f.setName=a=>(g=a,f),f},Xl=function(a,...b){return Xz(new a(...XC(b)))};class Xm extends WW{constructor(a,b){super(),this.shaderNode=a,this.rawInputs=b,this.isShaderCallNodeInternal=!0}getNodeType(a){return this.shaderNode.nodeType||this.getOutputNode(a).getNodeType(a)}getElementType(a){return this.getOutputNode(a).getElementType(a)}getMemberType(a,b){return this.getOutputNode(a).getMemberType(a,b)}call(a){var b,c;let{shaderNode:d,rawInputs:e}=this,f=a.getNodeProperties(d),g=a.getClosestSubBuild(d.subBuilds)||"",h=g||"default";if(f[h])return f[h];let i=a.subBuildFn,j=a.fnCall;a.subBuildFn=g,a.fnCall=this;let k=null;if(d.layout){let c=Xg.get(a.constructor);void 0===c&&(c=new WeakMap,Xg.set(a.constructor,c));let f=c.get(d);void 0===f&&(f=Xz(a.buildFunctionNode(d)),c.set(d,f)),a.addInclude(f);let g=e?(XB(b=e),b[0]&&(b[0].isNode||Object.getPrototypeOf(b[0])!==Object.prototype)?[...b]:b[0]):null;k=Xz(f.call(g))}else{let b,f=new Proxy(a,{get:(a,b,c)=>Symbol.iterator===b?function*(){yield}:Reflect.get(a,b,c)}),g=e?(b=0,XB(c=e),new Proxy(c,{get:(a,d,e)=>{let f;if("length"===d)return c.length;if(Symbol.iterator===d)f=function*(){for(let a of c)yield Xz(a)};else{if(c.length>0)if(Object.getPrototypeOf(c[0])===Object.prototype){let a=c[0];f=void 0===a[d]?a[b++]:Reflect.get(a,d,e)}else c[0]instanceof WW&&(f=void 0===c[d]?c[b++]:Reflect.get(c,d,e));else f=Reflect.get(a,d,e);f=Xz(f)}return f}})):null,h=Array.isArray(e)?e.length>0:null!==e,i=d.jsFunc;k=Xz(h||i.length>1?i(g,f):i(f))}return a.subBuildFn=i,a.fnCall=j,d.once&&(f[h]=k),k}setupOutput(a){return a.addStack(),a.stack.outputNode=this.call(a),a.removeStack()}getOutputNode(a){let b=a.getNodeProperties(this),c=a.getSubBuildOutput(this);return b[c]=b[c]||this.setupOutput(a),b[c].subBuild=a.getClosestSubBuild(this),b[c]}build(a,b=null){let c=null,d=a.getBuildStage(),e=a.getNodeProperties(this),f=a.getSubBuildOutput(this),g=this.getOutputNode(a),h=a.fnCall;if(a.fnCall=this,"setup"===d){let b=a.getSubBuildProperty("initialized",this);if(!0!==e[b]&&(e[b]=!0,e[f]=this.getOutputNode(a),e[f].build(a),this.shaderNode.subBuilds))for(let b of a.chaining){let c=a.getDataFromNode(b,"any");for(let a of(c.subBuilds=c.subBuilds||new Set,this.shaderNode.subBuilds))c.subBuilds.add(a)}c=e[f]}else"analyze"===d?g.build(a,b):"generate"===d&&(c=g.build(a,b)||"");return a.fnCall=h,c}}class Xn extends WW{constructor(a,b){super(b),this.jsFunc=a,this.layout=null,this.global=!0,this.once=!1}setLayout(a){return this.layout=a,this}getLayout(){return this.layout}call(a=null){return new Xm(this,a)}setup(){return this.call()}}let Xo=[.5,1.5,1/3,1e-6,1e6,Math.PI,2*Math.PI,1/Math.PI,2/Math.PI,1/(2*Math.PI),Math.PI/2],Xp=new Map;for(let a of[!1,!0])Xp.set(a,new W5(a));let Xq=new Map;for(let a of[0,1,2,3])Xq.set(a,new W5(a,"uint"));let Xr=new Map([...Xq].map(a=>new W5(a.value,"int")));for(let a of[-1,-2])Xr.set(a,new W5(a,"int"));let Xs=new Map([...Xr].map(a=>new W5(a.value)));for(let a of Xo)Xs.set(a,new W5(a));for(let a of Xo)Xs.set(-a,new W5(-a));let Xt=new Map([...Xp,...Xs]),Xu=(a,b)=>Xt.has(a)?Xt.get(a):!0===a.isNode?a:new W5(a,b),Xv=function(a,b=null){return(...c)=>{for(let b of c)if(void 0===b)return I1(`TSL: Invalid parameter for the type "${a}".`),Xz(new W5(0,a));if((0===c.length||!["bool","float","int","uint"].includes(a)&&c.every(a=>{let b=typeof a;return"object"!==b&&"function"!==b}))&&(c=[WK(a,...c)]),1===c.length&&null!==b&&b.has(c[0]))return XA(b.get(c[0]));if(1===c.length){let b=Xu(c[0],a);return b.nodeType===a?XA(b):XA(new WY(b,a))}return XA(new W$(c.map(a=>Xu(a)),a))}},Xw=a=>"object"==typeof a&&null!==a?a.value:a,Xx=a=>null!=a?a.nodeType||a.convertTo||("string"==typeof a?a:null):null;function Xy(a,b){return new Xn(a,b)}let Xz=(a,b=null)=>Xh(a,b),XA=(a,b=null)=>Xz(a,b).toVarIntent(),XB=(a,b=null)=>new Xi(a,b),XC=(a,b=null)=>new Xj(a,b),XD=(a,b=null,c=null,d=null)=>new Xk(a,b,c,d),XE=(a,...b)=>new Xl(a,...b),XF=(a,b=null,c=null,d={})=>new Xk(a,b,c,{...d,intent:!0}),XG=0;class XH extends WW{constructor(a,b=null){super();let c=null;null!==b&&("object"==typeof b?c=b.return:("string"==typeof b?c=b:I1("TSL: Invalid layout type."),b=null)),this.shaderNode=new Xy(a,c),null!==b&&this.setLayout(b),this.isFn=!0}setLayout(a){let b=this.shaderNode.nodeType;if("object"!=typeof a.inputs){let c={name:"fn"+XG++,type:b,inputs:[]};for(let b in a)"return"!==b&&c.inputs.push({name:b,type:a[b]});a=c}return this.shaderNode.setLayout(a),this}getNodeType(a){return this.shaderNode.getNodeType(a)||"float"}call(...a){let b=this.shaderNode.call(a);return"void"===this.shaderNode.nodeType&&b.toStack(),b.toVarIntent()}once(a=null){return this.shaderNode.once=!0,this.shaderNode.subBuilds=a,this}generate(a){let b=this.getNodeType(a);return I1('TSL: "Fn()" was declared but not invoked. Try calling it like "Fn()( ...params )".'),a.generateConst(b)}}function XI(a,b=null){let c=new XH(a,b);return new Proxy(()=>{},{apply:(a,b,d)=>c.call(...d),get:(a,b,d)=>Reflect.get(c,b,d),set:(a,b,d,e)=>Reflect.set(c,b,d,e)})}let XJ=a=>{W7=a},XK=()=>W7,XL=(...a)=>W7.If(...a);function XM(a){return W7&&W7.addToStack(a),a}W9("toStack",XM);let XN=new Xv("color"),XO=new Xv("float",Xs),XP=new Xv("int",Xr),XQ=new Xv("uint",Xq),XR=new Xv("bool",Xp),XS=new Xv("vec2"),XT=new Xv("ivec2"),XU=new Xv("uvec2"),XV=new Xv("bvec2"),XW=new Xv("vec3"),XX=new Xv("ivec3"),XY=new Xv("uvec3"),XZ=new Xv("bvec3"),X$=new Xv("vec4"),X_=new Xv("ivec4"),X0=new Xv("uvec4"),X1=new Xv("bvec4"),X2=new Xv("mat2"),X3=new Xv("mat3"),X4=new Xv("mat4");W9("toColor",XN),W9("toFloat",XO),W9("toInt",XP),W9("toUint",XQ),W9("toBool",XR),W9("toVec2",XS),W9("toIVec2",XT),W9("toUVec2",XU),W9("toBVec2",XV),W9("toVec3",XW),W9("toIVec3",XX),W9("toUVec3",XY),W9("toBVec3",XZ),W9("toVec4",X$),W9("toIVec4",X_),W9("toUVec4",X0),W9("toBVec4",X1),W9("toMat2",X2),W9("toMat3",X3),W9("toMat4",X4);let X5=XD(WX).setParameterLength(2),X6=(a,b)=>Xz(new WY(Xz(a),b));W9("element",X5),W9("convert",X6),W9("append",a=>(I0("TSL: .append() has been renamed to .toStack()."),XM(a)));class X7 extends WW{static get type(){return"PropertyNode"}constructor(a,b=null,c=!1){super(a),this.name=b,this.varying=c,this.isPropertyNode=!0,this.global=!0}customCacheKey(){return WE(this.type+":"+(this.name||"")+":"+(this.varying?"1":"0"))}getHash(a){return this.name||super.getHash(a)}generate(a){let b;return!0===this.varying?(b=a.getVaryingFromNode(this,this.name)).needsInterpolation=!0:b=a.getVarFromNode(this,this.name),a.getPropertyName(b)}}let X8=(a,b)=>Xz(new X7(a,b)),X9=(a,b)=>Xz(new X7(a,b,!0)),Ya=XE(X7,"vec4","DiffuseColor"),Yb=XE(X7,"vec3","EmissiveColor"),Yc=XE(X7,"float","Roughness"),Yd=XE(X7,"float","Metalness"),Ye=XE(X7,"float","Clearcoat"),Yf=XE(X7,"float","ClearcoatRoughness"),Yg=XE(X7,"vec3","Sheen"),Yh=XE(X7,"float","SheenRoughness"),Yi=XE(X7,"float","Iridescence"),Yj=XE(X7,"float","IridescenceIOR"),Yk=XE(X7,"float","IridescenceThickness"),Yl=XE(X7,"float","AlphaT"),Ym=XE(X7,"float","Anisotropy"),Yn=XE(X7,"vec3","AnisotropyT"),Yo=XE(X7,"vec3","AnisotropyB"),Yp=XE(X7,"color","SpecularColor"),Yq=XE(X7,"float","SpecularF90"),Yr=XE(X7,"float","Shininess"),Ys=XE(X7,"vec4","Output"),Yt=XE(X7,"float","dashSize"),Yu=XE(X7,"float","gapSize"),Yv=XE(X7,"float","pointWidth"),Yw=XE(X7,"float","IOR"),Yx=XE(X7,"float","Transmission"),Yy=XE(X7,"float","Thickness"),Yz=XE(X7,"float","AttenuationDistance"),YA=XE(X7,"color","AttenuationColor"),YB=XE(X7,"float","Dispersion");class YC extends WW{static get type(){return"UniformGroupNode"}constructor(a,b=!1,c=1){super("string"),this.name=a,this.shared=b,this.order=c,this.isUniformGroup=!0}serialize(a){super.serialize(a),a.name=this.name,a.version=this.version,a.shared=this.shared}deserialize(a){super.deserialize(a),this.name=a.name,this.version=a.version,this.shared=a.shared}}let YD=a=>new YC(a),YE=(a,b=0)=>new YC(a,!0,b),YF=YE("frame"),YG=YE("render"),YH=YD("object");class YI extends W3{static get type(){return"UniformNode"}constructor(a,b=null){super(a,b),this.isUniformNode=!0,this.name="",this.groupNode=YH}setName(a){return this.name=a,this}label(a){return I0('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(a)}setGroup(a){return this.groupNode=a,this}getGroup(){return this.groupNode}getUniformHash(a){return this.getHash(a)}onUpdate(a,b){return a=a.bind(this),super.onUpdate(b=>{let c=a(b,this);void 0!==c&&(this.value=c)},b)}getInputType(a){let b=super.getInputType(a);return"bool"===b&&(b="uint"),b}generate(a,b){let c=this.getNodeType(a),d=this.getUniformHash(a),e=a.getNodeFromHash(d);void 0===e&&(a.setHashNode(this,d),e=this);let f=e.getInputType(a),g=a.getUniformFromNode(e,f,a.shaderStage,this.name||a.context.nodeName),h=a.getPropertyName(g);void 0!==a.context.nodeName&&delete a.context.nodeName;let i=h;if("bool"===c){let b=a.getDataFromNode(this),d=b.propertyName;if(void 0===d){let e=a.getVarFromNode(this,null,"bool");b.propertyName=d=a.getPropertyName(e),i=a.format(h,f,c),a.addLineFlowCode(`${d} = ${i}`,this)}i=d}return a.format(i,c,b)}}let YJ=(a,b)=>{let c=Xx(b||a);return c===a&&(a=WK(c)),Xz(new YI(a=a&&!0===a.isNode?a.node&&a.node.value||a.value:a,c))};class YK extends WZ{static get type(){return"ArrayNode"}constructor(a,b,c=null){super(a),this.count=b,this.values=c,this.isArrayNode=!0}getArrayCount(){return this.count}getNodeType(a){return null===this.nodeType&&(this.nodeType=this.values[0].getNodeType(a)),this.nodeType}getElementType(a){return this.getNodeType(a)}generate(a){let b=this.getNodeType(a);return a.generateArray(b,this.count,this.values)}}let YL=(...a)=>{let b;if(1===a.length){let c=a[0];b=new YK(null,c.length,c)}else b=new YK(a[0],a[1]);return Xz(b)};W9("toArray",(a,b)=>YL(Array(b).fill(a)));let YM=XD(class extends WZ{static get type(){return"AssignNode"}constructor(a,b){super(),this.targetNode=a,this.sourceNode=b,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(a,b){return"void"!==b?this.targetNode.getNodeType(a):"void"}needsSplitAssign(a){let{targetNode:b}=this;if(!1===a.isAvailable("swizzleAssign")&&b.isSplitNode&&b.components.length>1){let c=a.getTypeLength(b.node.getNodeType(a));return WT.join("").slice(0,c)!==b.components}return!1}setup(a){let{targetNode:b,sourceNode:c}=this,d=b.getScope();a.getNodeProperties(d).assign=!0;let e=a.getNodeProperties(this);e.sourceNode=c,e.targetNode=b.context({assign:!0})}generate(a,b){let c,{targetNode:d,sourceNode:e}=a.getNodeProperties(this),f=this.needsSplitAssign(a),g=d.build(a),h=d.getNodeType(a),i=e.build(a,h),j=e.getNodeType(a),k=a.getDataFromNode(this);if(!0===k.initialized)"void"!==b&&(c=g);else if(f){let e=a.getVarFromNode(this,null,h),f=a.getPropertyName(e);a.addLineFlowCode(`${f} = ${i}`,this);let j=d.node,k=j.node.context({assign:!0}).build(a);for(let b=0;b<j.components.length;b++){let c=j.components[b];a.addLineFlowCode(`${k}.${c} = ${f}[ ${b} ]`,this)}"void"!==b&&(c=g)}else c=`${g} = ${i}`,("void"===b||"void"===j)&&(a.addLineFlowCode(c,this),"void"!==b&&(c=g));return k.initialized=!0,a.format(c,h,b)}}).setParameterLength(2);W9("assign",YM);class YN extends WZ{static get type(){return"FunctionCallNode"}constructor(a=null,b={}){super(),this.functionNode=a,this.parameters=b}setParameters(a){return this.parameters=a,this}getParameters(){return this.parameters}getNodeType(a){return this.functionNode.getNodeType(a)}getMemberType(a,b){return this.functionNode.getMemberType(a,b)}generate(a){let b=[],c=this.functionNode,d=c.getInputs(a),e=this.parameters,f=(b,c)=>{let d=c.type;return"pointer"===d?"&"+b.build(a):b.build(a,d)};if(Array.isArray(e)){if(e.length>d.length)I1("TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),e.length=d.length;else if(e.length<d.length)for(I1("TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");e.length<d.length;)e.push(XO(0));for(let a=0;a<e.length;a++)b.push(f(e[a],d[a]))}else for(let a of d){let c=e[a.name];void 0!==c?b.push(f(c,a)):(I1(`TSL: Input '${a.name}' not found in 'Fn()'.`),b.push(f(XO(0),a)))}return`${c.build(a,"property")}( ${b.join(", ")} )`}}let YO=(a,...b)=>(b=b.length>1||b[0]&&!0===b[0].isNode?XC(b):XB(b[0]),new YN(Xz(a),b));W9("call",YO);let YP={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};class YQ extends WZ{static get type(){return"OperatorNode"}constructor(a,b,c,...d){if(super(),d.length>0){let e=new YQ(a,b,c);for(let b=0;b<d.length-1;b++)e=new YQ(a,e,d[b]);b=e,c=d[d.length-1]}this.op=a,this.aNode=b,this.bNode=c,this.isOperatorNode=!0}getOperatorMethod(a,b){return a.getMethod(YP[this.op],b)}getNodeType(a,b=null){let c=this.op,d=this.aNode,e=this.bNode,f=d.getNodeType(a),g=e?e.getNodeType(a):null;if("void"===f||"void"===g)return b||"void";if("%"===c)return f;if("~"===c||"&"===c||"|"===c||"^"===c||">>"===c||"<<"===c)return a.getIntegerType(f);if("!"===c||"&&"===c||"||"===c||"^^"===c)return"bool";if("=="===c||"!="===c||"<"===c||">"===c||"<="===c||">="===c){let b=Math.max(a.getTypeLength(f),a.getTypeLength(g));return b>1?`bvec${b}`:"bool"}if(a.isMatrix(f)){if("float"===g)return f;if(a.isVector(g))return a.getVectorFromMatrix(f);if(a.isMatrix(g))return f}else if(a.isMatrix(g)){if("float"===f)return g;if(a.isVector(f))return a.getVectorFromMatrix(g)}return a.getTypeLength(g)>a.getTypeLength(f)?g:f}generate(a,b){let c=this.op,{aNode:d,bNode:e}=this,f=this.getNodeType(a,b),g=null,h=null;"void"!==f?(g=d.getNodeType(a),h=e?e.getNodeType(a):null,"<"===c||">"===c||"<="===c||">="===c||"=="===c||"!="===c?a.isVector(g)?h=g:a.isVector(h)?g=h:g!==h&&(g=h="float"):">>"===c||"<<"===c?(g=f,h=a.changeComponentType(h,"uint")):"%"===c?(g=f,h=a.isInteger(g)&&a.isInteger(h)?h:g):a.isMatrix(g)?"float"===h?h="float":a.isVector(h)?h=a.getVectorFromMatrix(g):a.isMatrix(h)||(g=h=f):g=a.isMatrix(h)?"float"===g?"float":a.isVector(g)?a.getVectorFromMatrix(h):h=f:h=f):g=h=f;let i=d.build(a,g),j=e?e.build(a,h):null,k=a.getFunctionOperator(c);if("void"!==b){let d=2e3===a.renderer.coordinateSystem;if("=="===c||"!="===c||"<"===c||">"===c||"<="===c||">="===c)return d&&a.isVector(g)?a.format(`${this.getOperatorMethod(a,b)}( ${i}, ${j} )`,f,b):a.format(`( ${i} ${c} ${j} )`,f,b);if("%"===c)return a.isInteger(h)?a.format(`( ${i} % ${j} )`,f,b):a.format(`${this.getOperatorMethod(a,f)}( ${i}, ${j} )`,f,b);if("!"===c||"~"===c)return a.format(`(${c}${i})`,g,b);if(k)return a.format(`${k}( ${i}, ${j} )`,f,b);if(a.isMatrix(g)&&"float"===h)return a.format(`( ${j} ${c} ${i} )`,f,b);if("float"===g&&a.isMatrix(h))return a.format(`${i} ${c} ${j}`,f,b);{let e=`( ${i} ${c} ${j} )`;return!d&&"bool"===f&&a.isVector(g)&&a.isVector(h)&&(e=`all${e}`),a.format(e,f,b)}}if("void"!==g)return k?a.format(`${k}( ${i}, ${j} )`,f,b):a.isMatrix(g)&&"float"===h?a.format(`${j} ${c} ${i}`,f,b):a.format(`${i} ${c} ${j}`,f,b)}serialize(a){super.serialize(a),a.op=this.op}deserialize(a){super.deserialize(a),this.op=a.op}}let YR=XF(YQ,"+").setParameterLength(2,1/0).setName("add"),YS=XF(YQ,"-").setParameterLength(2,1/0).setName("sub"),YT=XF(YQ,"*").setParameterLength(2,1/0).setName("mul"),YU=XF(YQ,"/").setParameterLength(2,1/0).setName("div"),YV=XF(YQ,"%").setParameterLength(2).setName("mod"),YW=XF(YQ,"==").setParameterLength(2).setName("equal"),YX=XF(YQ,"!=").setParameterLength(2).setName("notEqual"),YY=XF(YQ,"<").setParameterLength(2).setName("lessThan"),YZ=XF(YQ,">").setParameterLength(2).setName("greaterThan"),Y$=XF(YQ,"<=").setParameterLength(2).setName("lessThanEqual"),Y_=XF(YQ,">=").setParameterLength(2).setName("greaterThanEqual"),Y0=XF(YQ,"&&").setParameterLength(2,1/0).setName("and"),Y1=XF(YQ,"||").setParameterLength(2,1/0).setName("or"),Y2=XF(YQ,"!").setParameterLength(1).setName("not"),Y3=XF(YQ,"^^").setParameterLength(2).setName("xor"),Y4=XF(YQ,"&").setParameterLength(2).setName("bitAnd"),Y5=XF(YQ,"~").setParameterLength(1).setName("bitNot"),Y6=XF(YQ,"|").setParameterLength(2).setName("bitOr"),Y7=XF(YQ,"^").setParameterLength(2).setName("bitXor"),Y8=XF(YQ,"<<").setParameterLength(2).setName("shiftLeft"),Y9=XF(YQ,">>").setParameterLength(2).setName("shiftRight"),Za=XI(([a])=>(a.addAssign(1),a)),Zb=XI(([a])=>(a.subAssign(1),a)),Zc=XI(([a])=>{let b=XP(a).toConst();return a.addAssign(1),b}),Zd=XI(([a])=>{let b=XP(a).toConst();return a.subAssign(1),b});W9("add",YR),W9("sub",YS),W9("mul",YT),W9("div",YU),W9("mod",YV),W9("equal",YW),W9("notEqual",YX),W9("lessThan",YY),W9("greaterThan",YZ),W9("lessThanEqual",Y$),W9("greaterThanEqual",Y_),W9("and",Y0),W9("or",Y1),W9("not",Y2),W9("xor",Y3),W9("bitAnd",Y4),W9("bitNot",Y5),W9("bitOr",Y6),W9("bitXor",Y7),W9("shiftLeft",Y8),W9("shiftRight",Y9),W9("incrementBefore",Za),W9("decrementBefore",Zb),W9("increment",Zc),W9("decrement",Zd);let Ze=(a,b)=>(I0('TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),YV(XP(a),XP(b)));W9("modInt",Ze);class Zf extends WZ{static get type(){return"MathNode"}constructor(a,b,c=null,d=null){if(super(),(a===Zf.MAX||a===Zf.MIN)&&arguments.length>3){let e=new Zf(a,b,c);for(let b=2;b<arguments.length-1;b++)e=new Zf(a,e,arguments[b]);b=e,c=arguments[arguments.length-1],d=null}this.method=a,this.aNode=b,this.bNode=c,this.cNode=d,this.isMathNode=!0}getInputType(a){let b=this.aNode.getNodeType(a),c=this.bNode?this.bNode.getNodeType(a):null,d=this.cNode?this.cNode.getNodeType(a):null,e=a.isMatrix(b)?0:a.getTypeLength(b),f=a.isMatrix(c)?0:a.getTypeLength(c),g=a.isMatrix(d)?0:a.getTypeLength(d);return e>f&&e>g?b:f>g?c:g>e?d:b}getNodeType(a){let b=this.method;return b===Zf.LENGTH||b===Zf.DISTANCE||b===Zf.DOT?"float":b===Zf.CROSS?"vec3":b===Zf.ALL||b===Zf.ANY?"bool":b===Zf.EQUALS?a.changeComponentType(this.aNode.getNodeType(a),"bool"):this.getInputType(a)}setup(a){let{aNode:b,bNode:c,method:d}=this,e=null;if(d===Zf.ONE_MINUS)e=YS(1,b);else if(d===Zf.RECIPROCAL)e=YU(1,b);else if(d===Zf.DIFFERENCE)e=ZG(YS(b,c));else if(d===Zf.TRANSFORM_DIRECTION){let d=b,f=c;a.isMatrix(d.getNodeType(a))?f=X$(XW(f),0):d=X$(XW(d),0),e=Zy(YT(d,f).xyz)}return null!==e?e:super.setup(a)}generate(a,b){if(a.getNodeProperties(this).outputNode)return super.generate(a,b);let c=this.method,d=this.getNodeType(a),e=this.getInputType(a),f=this.aNode,g=this.bNode,h=this.cNode,i=a.renderer.coordinateSystem;if(c===Zf.NEGATE)return a.format("( - "+f.build(a,e)+" )",d,b);{let j=[];return c===Zf.CROSS?j.push(f.build(a,d),g.build(a,d)):2e3===i&&c===Zf.STEP?j.push(f.build(a,1===a.getTypeLength(f.getNodeType(a))?"float":e),g.build(a,e)):2e3===i&&(c===Zf.MIN||c===Zf.MAX)?j.push(f.build(a,e),g.build(a,1===a.getTypeLength(g.getNodeType(a))?"float":e)):c===Zf.REFRACT?j.push(f.build(a,e),g.build(a,e),h.build(a,"float")):c===Zf.MIX?j.push(f.build(a,e),g.build(a,e),h.build(a,1===a.getTypeLength(h.getNodeType(a))?"float":e)):(2001===i&&c===Zf.ATAN&&null!==g&&(c="atan2"),"fragment"!==a.shaderStage&&(c===Zf.DFDX||c===Zf.DFDY)&&(I0(`TSL: '${c}' is not supported in the ${a.shaderStage} stage.`),c="/*"+c+"*/"),j.push(f.build(a,e)),null!==g&&j.push(g.build(a,e)),null!==h&&j.push(h.build(a,e))),a.format(`${a.getMethod(c,d)}( ${j.join(", ")} )`,d,b)}}serialize(a){super.serialize(a),a.method=this.method}deserialize(a){super.deserialize(a),this.method=a.method}}Zf.ALL="all",Zf.ANY="any",Zf.RADIANS="radians",Zf.DEGREES="degrees",Zf.EXP="exp",Zf.EXP2="exp2",Zf.LOG="log",Zf.LOG2="log2",Zf.SQRT="sqrt",Zf.INVERSE_SQRT="inversesqrt",Zf.FLOOR="floor",Zf.CEIL="ceil",Zf.NORMALIZE="normalize",Zf.FRACT="fract",Zf.SIN="sin",Zf.COS="cos",Zf.TAN="tan",Zf.ASIN="asin",Zf.ACOS="acos",Zf.ATAN="atan",Zf.ABS="abs",Zf.SIGN="sign",Zf.LENGTH="length",Zf.NEGATE="negate",Zf.ONE_MINUS="oneMinus",Zf.DFDX="dFdx",Zf.DFDY="dFdy",Zf.ROUND="round",Zf.RECIPROCAL="reciprocal",Zf.TRUNC="trunc",Zf.FWIDTH="fwidth",Zf.TRANSPOSE="transpose",Zf.DETERMINANT="determinant",Zf.INVERSE="inverse",Zf.EQUALS="equals",Zf.MIN="min",Zf.MAX="max",Zf.STEP="step",Zf.REFLECT="reflect",Zf.DISTANCE="distance",Zf.DIFFERENCE="difference",Zf.DOT="dot",Zf.CROSS="cross",Zf.POW="pow",Zf.TRANSFORM_DIRECTION="transformDirection",Zf.MIX="mix",Zf.CLAMP="clamp",Zf.REFRACT="refract",Zf.SMOOTHSTEP="smoothstep",Zf.FACEFORWARD="faceforward";let Zg=XO(1e-6),Zh=XO(1e6),Zi=XO(Math.PI),Zj=XO(2*Math.PI),Zk=XO(2*Math.PI),Zl=XO(.5*Math.PI),Zm=XF(Zf,Zf.ALL).setParameterLength(1),Zn=XF(Zf,Zf.ANY).setParameterLength(1),Zo=XF(Zf,Zf.RADIANS).setParameterLength(1),Zp=XF(Zf,Zf.DEGREES).setParameterLength(1),Zq=XF(Zf,Zf.EXP).setParameterLength(1),Zr=XF(Zf,Zf.EXP2).setParameterLength(1),Zs=XF(Zf,Zf.LOG).setParameterLength(1),Zt=XF(Zf,Zf.LOG2).setParameterLength(1),Zu=XF(Zf,Zf.SQRT).setParameterLength(1),Zv=XF(Zf,Zf.INVERSE_SQRT).setParameterLength(1),Zw=XF(Zf,Zf.FLOOR).setParameterLength(1),Zx=XF(Zf,Zf.CEIL).setParameterLength(1),Zy=XF(Zf,Zf.NORMALIZE).setParameterLength(1),Zz=XF(Zf,Zf.FRACT).setParameterLength(1),ZA=XF(Zf,Zf.SIN).setParameterLength(1),ZB=XF(Zf,Zf.COS).setParameterLength(1),ZC=XF(Zf,Zf.TAN).setParameterLength(1),ZD=XF(Zf,Zf.ASIN).setParameterLength(1),ZE=XF(Zf,Zf.ACOS).setParameterLength(1),ZF=XF(Zf,Zf.ATAN).setParameterLength(1,2),ZG=XF(Zf,Zf.ABS).setParameterLength(1),ZH=XF(Zf,Zf.SIGN).setParameterLength(1),ZI=XF(Zf,Zf.LENGTH).setParameterLength(1),ZJ=XF(Zf,Zf.NEGATE).setParameterLength(1),ZK=XF(Zf,Zf.ONE_MINUS).setParameterLength(1),ZL=XF(Zf,Zf.DFDX).setParameterLength(1),ZM=XF(Zf,Zf.DFDY).setParameterLength(1),ZN=XF(Zf,Zf.ROUND).setParameterLength(1),ZO=XF(Zf,Zf.RECIPROCAL).setParameterLength(1),ZP=XF(Zf,Zf.TRUNC).setParameterLength(1),ZQ=XF(Zf,Zf.FWIDTH).setParameterLength(1),ZR=XF(Zf,Zf.TRANSPOSE).setParameterLength(1),ZS=XF(Zf,Zf.DETERMINANT).setParameterLength(1),ZT=XF(Zf,Zf.INVERSE).setParameterLength(1),ZU=(a,b)=>(I0('TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),YW(a,b)),ZV=XF(Zf,Zf.MIN).setParameterLength(2,1/0),ZW=XF(Zf,Zf.MAX).setParameterLength(2,1/0),ZX=XF(Zf,Zf.STEP).setParameterLength(2),ZY=XF(Zf,Zf.REFLECT).setParameterLength(2),ZZ=XF(Zf,Zf.DISTANCE).setParameterLength(2),Z$=XF(Zf,Zf.DIFFERENCE).setParameterLength(2),Z_=XF(Zf,Zf.DOT).setParameterLength(2),Z0=XF(Zf,Zf.CROSS).setParameterLength(2),Z1=XF(Zf,Zf.POW).setParameterLength(2),Z2=a=>YT(a,a),Z3=a=>YT(a,a,a),Z4=a=>YT(a,a,a,a),Z5=XF(Zf,Zf.TRANSFORM_DIRECTION).setParameterLength(2),Z6=a=>YT(ZH(a),Z1(ZG(a),1/3)),Z7=a=>Z_(a,a),Z8=XF(Zf,Zf.MIX).setParameterLength(3),Z9=(a,b=0,c=1)=>Xz(new Zf(Zf.CLAMP,Xz(a),Xz(b),Xz(c))),$a=a=>Z9(a),$b=XF(Zf,Zf.REFRACT).setParameterLength(3),$c=XF(Zf,Zf.SMOOTHSTEP).setParameterLength(3),$d=XF(Zf,Zf.FACEFORWARD).setParameterLength(3),$e=XI(([a])=>Zz(ZA(YV(Z_(a.xy,XS(12.9898,78.233)),Zi)).mul(43758.5453))),$f=(a,b,c)=>Z8(b,c,a),$g=(a,b,c)=>$c(b,c,a),$h=(a,b)=>ZX(b,a),$i=(a,b)=>(I0('TSL: "atan2" is overloaded. Use "atan" instead.'),ZF(a,b));W9("all",Zm),W9("any",Zn),W9("equals",ZU),W9("radians",Zo),W9("degrees",Zp),W9("exp",Zq),W9("exp2",Zr),W9("log",Zs),W9("log2",Zt),W9("sqrt",Zu),W9("inverseSqrt",Zv),W9("floor",Zw),W9("ceil",Zx),W9("normalize",Zy),W9("fract",Zz),W9("sin",ZA),W9("cos",ZB),W9("tan",ZC),W9("asin",ZD),W9("acos",ZE),W9("atan",ZF),W9("abs",ZG),W9("sign",ZH),W9("length",ZI),W9("lengthSq",Z7),W9("negate",ZJ),W9("oneMinus",ZK),W9("dFdx",ZL),W9("dFdy",ZM),W9("round",ZN),W9("reciprocal",ZO),W9("trunc",ZP),W9("fwidth",ZQ),W9("atan2",$i),W9("min",ZV),W9("max",ZW),W9("step",$h),W9("reflect",ZY),W9("distance",ZZ),W9("dot",Z_),W9("cross",Z0),W9("pow",Z1),W9("pow2",Z2),W9("pow3",Z3),W9("pow4",Z4),W9("transformDirection",Z5),W9("mix",$f),W9("clamp",Z9),W9("refract",$b),W9("smoothstep",$g),W9("faceForward",$d),W9("difference",Z$),W9("saturate",$a),W9("cbrt",Z6),W9("transpose",ZR),W9("determinant",ZS),W9("inverse",ZT),W9("rand",$e);let $j=XD(class extends WW{static get type(){return"ConditionalNode"}constructor(a,b,c=null){super(),this.condNode=a,this.ifNode=b,this.elseNode=c}getNodeType(a){let{ifNode:b,elseNode:c}=a.getNodeProperties(this);if(void 0===b)return a.flowBuildStage(this,"setup"),this.getNodeType(a);let d=b.getNodeType(a);if(null!==c){let b=c.getNodeType(a);if(a.getTypeLength(b)>a.getTypeLength(d))return b}return d}setup(a){let b=this.condNode,c=this.ifNode.isolate(),d=this.elseNode?this.elseNode.isolate():null,e=a.context.nodeBlock;a.getDataFromNode(c).parentNodeBlock=e,null!==d&&(a.getDataFromNode(d).parentNodeBlock=e);let f=a.context.uniformFlow,g=a.getNodeProperties(this);g.condNode=b,g.ifNode=f?c:c.context({nodeBlock:c}),g.elseNode=d?f?d:d.context({nodeBlock:d}):null}generate(a,b){let c=this.getNodeType(a),d=a.getDataFromNode(this);if(void 0!==d.nodeProperty)return d.nodeProperty;let{condNode:e,ifNode:f,elseNode:g}=a.getNodeProperties(this),h=a.currentFunctionNode,i="void"!==b,j=i?X8(c).build(a):"";d.nodeProperty=j;let k=e.build(a,"bool");if(a.context.uniformFlow&&null!==g){let d=f.build(a,c),e=g.build(a,c),h=a.getTernary(k,d,e);return a.format(h,c,b)}a.addFlowCode(`
${a.tab}if ( ${k} ) {

`).addFlowTab();let l=f.build(a,c);if(l&&(i?l=j+" = "+l+";":(l="return "+l+";",null===h&&(I0("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),l="// "+l))),a.removeFlowTab().addFlowCode(a.tab+"	"+l+`

`+a.tab+"}"),null!==g){a.addFlowCode(` else {

`).addFlowTab();let b=g.build(a,c);b&&(i?b=j+" = "+b+";":(b="return "+b+";",null===h&&(I0("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),b="// "+b))),a.removeFlowTab().addFlowCode(a.tab+"	"+b+`

`+a.tab+`}

`)}else a.addFlowCode(`

`);return a.format(j,c,b)}}).setParameterLength(2,3);W9("select",$j);class $k extends WW{static get type(){return"ContextNode"}constructor(a,b={}){super(),this.isContextNode=!0,this.node=a,this.value=b}getScope(){return this.node.getScope()}getNodeType(a){return this.node.getNodeType(a)}getMemberType(a,b){return this.node.getMemberType(a,b)}analyze(a){let b=a.addContext(this.value);this.node.build(a),a.setContext(b)}setup(a){let b=a.addContext(this.value);this.node.build(a),a.setContext(b)}generate(a,b){let c=a.addContext(this.value),d=this.node.build(a,b);return a.setContext(c),d}}let $l=XD($k).setParameterLength(1,2),$m=a=>$l(a,{uniformFlow:!0}),$n=(a,b)=>$l(a,{nodeName:b});function $o(a,b){return I0('TSL: "label()" has been deprecated. Use "setName()" instead.'),$n(a,b)}W9("context",$l),W9("label",$o),W9("uniformFlow",$m),W9("setName",$n);let $p=XD(class extends WW{static get type(){return"VarNode"}constructor(a,b=null,c=!1){super(),this.node=a,this.name=b,this.global=!0,this.isVarNode=!0,this.readOnly=c,this.parents=!0,this.intent=!1}setIntent(a){return this.intent=a,this}getIntent(){return this.intent}getMemberType(a,b){return this.node.getMemberType(a,b)}getElementType(a){return this.node.getElementType(a)}getNodeType(a){return this.node.getNodeType(a)}getArrayCount(a){return this.node.getArrayCount(a)}isAssign(a){let b=a.getNodeProperties(this).assign;return!0!==b&&this.node.isShaderCallNodeInternal&&null===this.node.shaderNode.getLayout()&&a.fnCall&&a.fnCall.shaderNode&&a.getDataFromNode(this.node.shaderNode).hasLoop&&(b=!0),b}build(...a){let b=a[0];return!1===this._hasStack(b)&&"setup"===b.buildStage&&(b.context.nodeLoop||b.context.nodeBlock)&&b.getBaseStack().addToStack(this),!0===this.intent&&!0!==this.isAssign(b)?this.node.build(...a):super.build(...a)}generate(a){let{node:b,name:c,readOnly:d}=this,{renderer:e}=a,f=!0===e.backend.isWebGPUBackend,g=!1,h=!1;d&&(g=a.isDeterministic(b),h=f?d:g);let i=this.getNodeType(a);if("void"==i)return!0!==this.intent&&I1('TSL: ".toVar()" can not be used with void type.'),b.build(a);let j=a.getVectorType(i),k=b.build(a,j),l=a.getVarFromNode(this,c,j,void 0,h),m=a.getPropertyName(l),n=m;if(h)if(f)n=g?`const ${m}`:`let ${m}`;else{let c=b.getArrayCount(a);n=`const ${a.getVar(l.type,m,c)}`}return a.addLineFlowCode(`${n} = ${k}`,this),m}_hasStack(a){return void 0!==a.getDataFromNode(this).stack}}),$q=(a,b=null)=>$p(a,b).toStack(),$r=(a,b=null)=>$p(a,b,!0).toStack(),$s=a=>$p(a).setIntent(!0).toStack();W9("toVar",$q),W9("toConst",$r),W9("toVarIntent",$s);class $t extends WW{static get type(){return"SubBuild"}constructor(a,b,c=null){super(c),this.node=a,this.name=b,this.isSubBuildNode=!0}getNodeType(a){if(null!==this.nodeType)return this.nodeType;a.addSubBuild(this.name);let b=this.node.getNodeType(a);return a.removeSubBuild(),b}build(a,...b){a.addSubBuild(this.name);let c=this.node.build(a,...b);return a.removeSubBuild(),c}}let $u=(a,b,c=null)=>Xz(new $t(Xz(a),b,c)),$v=XD(class extends WW{static get type(){return"VaryingNode"}constructor(a,b=null){super(),this.node=a,this.name=b,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(a,b=null){return this.interpolationType=a,this.interpolationSampling=b,this}getHash(a){return this.name||super.getHash(a)}getNodeType(a){return this.node.getNodeType(a)}setupVarying(a){let b=a.getNodeProperties(this),c=b.varying;if(void 0===c){let d=this.name,e=this.getNodeType(a),f=this.interpolationType,g=this.interpolationSampling;b.varying=c=a.getVaryingFromNode(this,d,e,f,g),b.node=$u(this.node,"VERTEX")}return c.needsInterpolation||(c.needsInterpolation="fragment"===a.shaderStage),c}setup(a){this.setupVarying(a),a.flowNodeFromShaderStage(WO.VERTEX,this.node)}analyze(a){this.setupVarying(a),a.flowNodeFromShaderStage(WO.VERTEX,this.node)}generate(a){let b=a.getSubBuildProperty("property",a.currentStack),c=a.getNodeProperties(this),d=this.setupVarying(a);if(void 0===c[b]){let e=this.getNodeType(a),f=a.getPropertyName(d,WO.VERTEX);a.flowNodeFromShaderStage(WO.VERTEX,c.node,e,f),c[b]=f}return a.getPropertyName(d)}}).setParameterLength(1,2),$w=a=>$v(a);W9("toVarying",$v),W9("toVertexStage",$w),W9("varying",(...a)=>(I0("TSL: .varying() has been renamed to .toVarying()."),$v(...a))),W9("vertexStage",(...a)=>(I0("TSL: .vertexStage() has been renamed to .toVertexStage()."),$v(...a)));let $x=XI(([a])=>Z8(a.mul(.9478672986).add(.0521327014).pow(2.4),a.mul(.0773993808),a.lessThanEqual(.04045))).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),$y=XI(([a])=>Z8(a.pow(.41666).mul(1.055).sub(.055),a.mul(12.92),a.lessThanEqual(.0031308))).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),$z="WorkingColorSpace";class $A extends WZ{static get type(){return"ColorSpaceNode"}constructor(a,b,c){super("vec4"),this.colorNode=a,this.source=b,this.target=c}resolveColorSpace(a,b){return b===$z?Jl.workingColorSpace:"OutputColorSpace"===b?a.context.outputColorSpace||a.renderer.outputColorSpace:b}setup(a){let{colorNode:b}=this,c=this.resolveColorSpace(a,this.source),d=this.resolveColorSpace(a,this.target),e=b;return!1!==Jl.enabled&&c!==d&&c&&d&&(Jl.getTransfer(c)===IW&&(e=X$($x(e.rgb),e.a)),Jl.getPrimaries(c)!==Jl.getPrimaries(d)&&(e=X$(X3(Jl._getMatrix(new Jh,c,d)).mul(e.rgb),e.a)),Jl.getTransfer(d)===IW&&(e=X$($y(e.rgb),e.a))),e}}let $B=(a,b)=>Xz(new $A(Xz(a),$z,b)),$C=(a,b)=>Xz(new $A(Xz(a),b,$z));W9("workingToColorSpace",$B),W9("colorSpaceToWorking",$C);let $D=class extends WX{static get type(){return"ReferenceElementNode"}constructor(a,b){super(a,b),this.referenceNode=a,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(a){let b=super.generate(a),c=this.referenceNode.getNodeType(),d=this.getNodeType();return a.format(b,c,d)}};class $E extends WW{static get type(){return"ReferenceBaseNode"}constructor(a,b,c=null,d=null){super(),this.property=a,this.uniformType=b,this.object=c,this.count=d,this.properties=a.split("."),this.reference=c,this.node=null,this.group=null,this.updateType=WP.OBJECT}setGroup(a){return this.group=a,this}element(a){return Xz(new $D(this,Xz(a)))}setNodeType(a){let b=YJ(null,a);null!==this.group&&b.setGroup(this.group),this.node=b}getNodeType(a){return null===this.node&&(this.updateReference(a),this.updateValue()),this.node.getNodeType(a)}getValueFromReference(a=this.reference){let{properties:b}=this,c=a[b[0]];for(let a=1;a<b.length;a++)c=c[b[a]];return c}updateReference(a){return this.reference=null!==this.object?this.object:a.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){null===this.node&&this.setNodeType(this.uniformType);let a=this.getValueFromReference();Array.isArray(a)?this.node.array=a:this.node.value=a}}class $F extends $E{static get type(){return"RendererReferenceNode"}constructor(a,b,c=null){super(a,b,c),this.renderer=c,this.setGroup(YG)}updateReference(a){return this.reference=null!==this.renderer?this.renderer:a.renderer,this.reference}}let $G=(a,b,c=null)=>Xz(new $F(a,b,c));class $H extends WZ{static get type(){return"ToneMappingNode"}constructor(a,b=$J,c=null){super("vec3"),this._toneMapping=a,this.exposureNode=b,this.colorNode=c}customCacheKey(){return((...a)=>WD(a))(this._toneMapping)}setToneMapping(a){return this._toneMapping=a,this}getToneMapping(){return this._toneMapping}setup(a){let b=this.colorNode||a.context.color,c=this._toneMapping;if(0===c)return b;let d=null,e=a.renderer.library.getToneMappingFunction(c);return null!==e?d=X$(e(b.rgb,this.exposureNode),b.a):(I1("ToneMappingNode: Unsupported Tone Mapping configuration.",c),d=b),d}}let $I=(a,b,c)=>Xz(new $H(a,Xz(b),Xz(c))),$J=$G("toneMappingExposure","float");W9("toneMapping",(a,b,c)=>$I(b,c,a));class $K extends W3{static get type(){return"BufferAttributeNode"}constructor(a,b=null,c=0,d=0){super(a,b),this.isBufferNode=!0,this.bufferType=b,this.bufferStride=c,this.bufferOffset=d,this.usage=35044,this.instanced=!1,this.attribute=null,this.global=!0,a&&!0===a.isBufferAttribute&&(this.attribute=a,this.usage=a.usage,this.instanced=a.isInstancedBufferAttribute)}getHash(a){if(0===this.bufferStride&&0===this.bufferOffset){let b=a.globalCache.getData(this.value);return void 0===b&&(b={node:this},a.globalCache.setData(this.value,b)),b.node.uuid}return this.uuid}getNodeType(a){return null===this.bufferType&&(this.bufferType=a.getTypeFromAttribute(this.attribute)),this.bufferType}setup(a){if(null!==this.attribute)return;let b=this.getNodeType(a),c=this.value,d=a.getTypeLength(b),e=this.bufferStride||d,f=this.bufferOffset,g=!0===c.isInterleavedBuffer?c:new Lu(c,e),h=new Lw(g,d,f);g.setUsage(this.usage),this.attribute=h,this.attribute.isInstancedBufferAttribute=this.instanced}generate(a){let b=this.getNodeType(a),c=a.getBufferAttributeFromNode(this,b),d=a.getPropertyName(c),e=null;return"vertex"===a.shaderStage||"compute"===a.shaderStage?(this.name=d,e=d):e=$v(this).build(a,b),e}getInputType(){return"bufferAttribute"}setUsage(a){return this.usage=a,this.attribute&&!0===this.attribute.isBufferAttribute&&(this.attribute.usage=a),this}setInstanced(a){return this.instanced=a,this}}let $L=(a,b=null,c=0,d=0)=>Xz(new $K(a,b,c,d)),$M=(a,b=null,c=0,d=0)=>$L(a,b,c,d).setUsage(35048),$N=(a,b=null,c=0,d=0)=>$L(a,b,c,d).setInstanced(!0),$O=(a,b=null,c=0,d=0)=>$M(a,b,c,d).setInstanced(!0);W9("toAttribute",a=>$L(a.value));class $P extends WW{static get type(){return"ComputeNode"}constructor(a,b){super("void"),this.isComputeNode=!0,this.computeNode=a,this.workgroupSize=b,this.count=null,this.version=1,this.name="",this.updateBeforeType=WP.OBJECT,this.onInitFunction=null}setCount(a){return this.count=a,this}getCount(){return this.count}dispose(){this.dispatchEvent({type:"dispose"})}setName(a){return this.name=a,this}label(a){return I0('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(a)}onInit(a){return this.onInitFunction=a,this}updateBefore({renderer:a}){a.compute(this)}setup(a){let b=this.computeNode.build(a);return b&&(a.getNodeProperties(this).outputComputeNode=b.outputNode,b.outputNode=null),b}generate(a,b){let{shaderStage:c}=a;if("compute"===c){let b=this.computeNode.build(a,"void");""!==b&&a.addLineFlowCode(b,this)}else{let c=a.getNodeProperties(this).outputComputeNode;if(c)return c.build(a,b)}}}let $Q=(a,b=[64])=>{(0===b.length||b.length>3)&&I1("TSL: compute() workgroupSize must have 1, 2, or 3 elements");for(let a=0;a<b.length;a++){let c=b[a];("number"!=typeof c||c<=0||!Number.isInteger(c))&&I1(`TSL: compute() workgroupSize element at index [ ${a} ] must be a positive integer`)}for(;b.length<3;)b.push(1);return Xz(new $P(Xz(a),b))},$R=(a,b,c)=>$Q(a,c).setCount(b);W9("compute",$R),W9("computeKernel",$Q);class $S extends WW{static get type(){return"IsolateNode"}constructor(a,b=!0){super(),this.node=a,this.parent=b,this.isIsolateNode=!0}getNodeType(a){let b=a.getCache(),c=a.getCacheFromNode(this,this.parent);a.setCache(c);let d=this.node.getNodeType(a);return a.setCache(b),d}build(a,...b){let c=a.getCache(),d=a.getCacheFromNode(this,this.parent);a.setCache(d);let e=this.node.build(a,...b);return a.setCache(c),e}setParent(a){return this.parent=a,this}getParent(){return this.parent}}let $T=a=>new $S(Xz(a));function $U(a,b=!0){return I0('TSL: "cache()" has been deprecated. Use "isolate()" instead.'),$T(a).setParent(b)}W9("cache",$U),W9("isolate",$T);let $V=XD(class extends WW{static get type(){return"BypassNode"}constructor(a,b){super(),this.isBypassNode=!0,this.outputNode=a,this.callNode=b}getNodeType(a){return this.outputNode.getNodeType(a)}generate(a){let b=this.callNode.build(a,"void");return""!==b&&a.addLineFlowCode(b,this),this.outputNode.build(a)}}).setParameterLength(2);W9("bypass",$V);class $W extends WW{static get type(){return"RemapNode"}constructor(a,b,c,d=XO(0),e=XO(1)){super(),this.node=a,this.inLowNode=b,this.inHighNode=c,this.outLowNode=d,this.outHighNode=e,this.doClamp=!0}setup(){let{node:a,inLowNode:b,inHighNode:c,outLowNode:d,outHighNode:e,doClamp:f}=this,g=a.sub(b).div(c.sub(b));return!0===f&&(g=g.clamp()),g.mul(e.sub(d)).add(d)}}let $X=XD($W,null,null,{doClamp:!1}).setParameterLength(3,5),$Y=XD($W).setParameterLength(3,5);W9("remap",$X),W9("remapClamp",$Y);let $Z=XD(class extends WW{static get type(){return"ExpressionNode"}constructor(a="",b="void"){super(b),this.snippet=a}generate(a,b){let c=this.getNodeType(a),d=this.snippet;if("void"!==c)return a.format(d,c,b);a.addLineFlowCode(d,this)}}).setParameterLength(1,2),$$=a=>(a?$j(a,$Z("discard")):$Z("discard")).toStack();W9("discard",$$);class $_ extends WZ{static get type(){return"RenderOutputNode"}constructor(a,b,c){super("vec4"),this.colorNode=a,this._toneMapping=b,this.outputColorSpace=c,this.isRenderOutputNode=!0}setToneMapping(a){return this._toneMapping=a,this}getToneMapping(){return this._toneMapping}setup({context:a}){let b=this.colorNode||a.color,c=(null!==this._toneMapping?this._toneMapping:a.toneMapping)||0,d=(null!==this.outputColorSpace?this.outputColorSpace:a.outputColorSpace)||"";return 0!==c&&(b=b.toneMapping(c)),""!==d&&d!==Jl.workingColorSpace&&(b=b.workingToColorSpace(d)),b}}let $0=(a,b=null,c=null)=>Xz(new $_(Xz(a),b,c));W9("renderOutput",$0);class $1 extends WZ{static get type(){return"DebugNode"}constructor(a,b=null){super(),this.node=a,this.callback=b}getNodeType(a){return this.node.getNodeType(a)}setup(a){return this.node.build(a)}analyze(a){return this.node.build(a)}generate(a){let b=this.callback,c=this.node.build(a),d="--- TSL debug - "+a.shaderStage+" shader ---",e="-".repeat(d.length),f="";return f+="// #"+d+`#
`+a.flow.code.replace(/^\t/mg,"")+`
`+("/* ... */ "+c)+` /* ... */
`+("// #"+e)+`#
`,null!==b?b(a,f):I_(f),c}}let $2=(a,b=null)=>Xz(new $1(Xz(a),b)).toStack();W9("debug",$2);class $3{constructor(){this._renderer=null,this.currentFrame=null}get nodeFrame(){return this._renderer._nodes.nodeFrame}setRenderer(a){return this._renderer=a,this}getRenderer(){return this._renderer}init(){}begin(){}finish(){}inspect(){}computeAsync(){}beginCompute(){}finishCompute(){}beginRender(){}finishRender(){}copyTextureToTexture(){}copyFramebufferToTexture(){}}class $4 extends WW{static get type(){return"InspectorNode"}constructor(a,b="",c=null){super(),this.node=a,this.name=b,this.callback=c,this.updateType=WP.FRAME,this.isInspectorNode=!0}getName(){return this.name||this.node.name}update(a){a.renderer.inspector.inspect(this)}getNodeType(a){return this.node.getNodeType(a)}setup(a){let b=this.node;return!0===a.context.inspector&&null!==this.callback&&(b=this.callback(b)),!0!==a.renderer.backend.isWebGPUBackend&&a.renderer.inspector.constructor!==$3&&I2('TSL: ".toInspector()" is only available with WebGPU.'),b}}function $5(a,b="",c=null){return(a=Xz(a)).before(new $4(a,b,c))}W9("toInspector",$5);class $6 extends WW{static get type(){return"AttributeNode"}constructor(a,b=null){super(b),this.global=!0,this._attributeName=a}getHash(a){return this.getAttributeName(a)}getNodeType(a){let b=this.nodeType;if(null===b){let c=this.getAttributeName(a);if(a.hasGeometryAttribute(c)){let d=a.geometry.getAttribute(c);b=a.getTypeFromAttribute(d)}else b="float"}return b}setAttributeName(a){return this._attributeName=a,this}getAttributeName(){return this._attributeName}generate(a){let b=this.getAttributeName(a),c=this.getNodeType(a);if(!0!==a.hasGeometryAttribute(b))return I0(`AttributeNode: Vertex attribute "${b}" not found on geometry.`),a.generateConst(c);{let d=a.geometry.getAttribute(b),e=a.getTypeFromAttribute(d),f=a.getAttribute(b,e);return"vertex"===a.shaderStage?a.format(f.name,e,c):$v(this).build(a,c)}}serialize(a){super.serialize(a),a.global=this.global,a._attributeName=this._attributeName}deserialize(a){super.deserialize(a),this.global=a.global,this._attributeName=a._attributeName}}let $7=(a,b=null)=>Xz(new $6(a,b)),$8=(a=0)=>$7("uv"+(a>0?a:""),"vec2"),$9=XD(class extends WW{static get type(){return"TextureSizeNode"}constructor(a,b=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=a,this.levelNode=b}generate(a,b){let c=this.textureNode.build(a,"property"),d=null===this.levelNode?"0":this.levelNode.build(a,"int");return a.format(`${a.getMethod("textureDimensions")}( ${c}, ${d} )`,this.getNodeType(a),b)}}).setParameterLength(1,2),_a=XD(class extends YI{static get type(){return"MaxMipLevelNode"}constructor(a){super(0),this._textureNode=a,this.updateType=WP.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){let a=this.texture,b=a.images,c=b&&b.length>0?b[0]&&b[0].image||b[0]:a.image;if(c&&void 0!==c.width){let{width:a,height:b}=c;this.value=Math.log2(Math.max(a,b))}}}).setParameterLength(1),_b=new Ju;class _c extends YI{static get type(){return"TextureNode"}constructor(a=_b,b=null,c=null,d=null){super(a),this.isTextureNode=!0,this.uvNode=b,this.levelNode=c,this.biasNode=d,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.offsetNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=WP.NONE,this.referenceNode=null,this._value=a,this._matrixUniform=null,this._flipYUniform=null,this.setUpdateMatrix(null===b)}set value(a){this.referenceNode?this.referenceNode.value=a:this._value=a}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return!0===this.value.isDepthTexture?"float":1014===this.value.type?"uvec4":1013===this.value.type?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return $8(this.value.channel)}updateReference(){return this.value}getTransformedUV(a){return null===this._matrixUniform&&(this._matrixUniform=YJ(this.value.matrix)),this._matrixUniform.mul(XW(a,1)).xy}setUpdateMatrix(a){return this.updateMatrix=a,this}setupUV(a,b){return a.isFlipY()&&(null===this._flipYUniform&&(this._flipYUniform=YJ(!1)),b=b.toVar(),b=this.sampler?this._flipYUniform.select(b.flipY(),b):this._flipYUniform.select(b.setY(XP($9(this,this.levelNode).y).sub(b.y).sub(1)),b)),b}setup(a){let b=a.getNodeProperties(this);b.referenceNode=this.referenceNode;let c=this.value;if(!c||!0!==c.isTexture)throw Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");let d=XI(()=>{let b=this.uvNode;return(null===b||!0===a.context.forceUVContext)&&a.context.getUV&&(b=a.context.getUV(this,a)),b||(b=this.getDefaultUV()),!0===this.updateMatrix&&(b=this.getTransformedUV(b)),b=this.setupUV(a,b),this.updateType=null!==this._matrixUniform||null!==this._flipYUniform?WP.OBJECT:WP.NONE,b})(),e=this.levelNode;null===e&&a.context.getTextureLevel&&(e=a.context.getTextureLevel(this)),b.uvNode=d,b.levelNode=e,b.biasNode=this.biasNode,b.compareNode=this.compareNode,b.gradNode=this.gradNode,b.depthNode=this.depthNode,b.offsetNode=this.offsetNode}generateUV(a,b){return b.build(a,!0===this.sampler?"vec2":"ivec2")}generateOffset(a,b){return b.build(a,"ivec2")}generateSnippet(a,b,c,d,e,f,g,h,i){let j=this.value;return e?a.generateTextureBias(j,b,c,e,f,i):h?a.generateTextureGrad(j,b,c,h,f,i):g?a.generateTextureCompare(j,b,c,g,f,i):!1===this.sampler?a.generateTextureLoad(j,b,c,d,f,i):d?a.generateTextureLevel(j,b,c,d,f,i):a.generateTexture(j,b,c,f,i)}generate(a,b){let c=this.value,d=a.getNodeProperties(this),e=super.generate(a,"property");if(/^sampler/.test(b))return e+"_sampler";if(a.isReference(b))return e;{let f=a.getDataFromNode(this),g=f.propertyName;if(void 0===g){let{uvNode:b,levelNode:c,biasNode:h,compareNode:i,depthNode:j,gradNode:k,offsetNode:l}=d,m=this.generateUV(a,b),n=c?c.build(a,"float"):null,o=h?h.build(a,"float"):null,p=j?j.build(a,"int"):null,q=i?i.build(a,"float"):null,r=k?[k[0].build(a,"vec2"),k[1].build(a,"vec2")]:null,s=l?this.generateOffset(a,l):null,t=a.getVarFromNode(this);g=a.getPropertyName(t);let u=this.generateSnippet(a,e,m,n,o,p,q,r,s);a.addLineFlowCode(`${g} = ${u}`,this),f.snippet=u,f.propertyName=g}let h=g,i=this.getNodeType(a);return a.needsToWorkingColorSpace(c)&&(h=$C($Z(h,i),c.colorSpace).setup(a).build(a,i)),a.format(h,i,b)}}setSampler(a){return this.sampler=a,this}getSampler(){return this.sampler}uv(a){return I0("TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(a)}sample(a){let b=this.clone();return b.uvNode=Xz(a),b.referenceNode=this.getBase(),Xz(b)}load(a){return this.sample(a).setSampler(!1)}blur(a){let b=this.clone();b.biasNode=Xz(a).mul(_a(b)),b.referenceNode=this.getBase();let c=b.value;return!1===b.generateMipmaps&&(c&&!1===c.generateMipmaps||1003===c.minFilter||1003===c.magFilter)&&(I0("TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),b.biasNode=null),Xz(b)}level(a){let b=this.clone();return b.levelNode=Xz(a),b.referenceNode=this.getBase(),Xz(b)}size(a){return $9(this,a)}bias(a){let b=this.clone();return b.biasNode=Xz(a),b.referenceNode=this.getBase(),Xz(b)}getBase(){return this.referenceNode?this.referenceNode.getBase():this}compare(a){let b=this.clone();return b.compareNode=Xz(a),b.referenceNode=this.getBase(),Xz(b)}grad(a,b){let c=this.clone();return c.gradNode=[Xz(a),Xz(b)],c.referenceNode=this.getBase(),Xz(c)}depth(a){let b=this.clone();return b.depthNode=Xz(a),b.referenceNode=this.getBase(),Xz(b)}offset(a){let b=this.clone();return b.offsetNode=Xz(a),b.referenceNode=this.getBase(),Xz(b)}serialize(a){super.serialize(a),a.value=this.value.toJSON(a.meta).uuid,a.sampler=this.sampler,a.updateMatrix=this.updateMatrix,a.updateType=this.updateType}deserialize(a){super.deserialize(a),this.value=a.meta.textures[a.value],this.sampler=a.sampler,this.updateMatrix=a.updateMatrix,this.updateType=a.updateType}update(){let a=this.value,b=this._matrixUniform;null!==b&&(b.value=a.matrix),!0===a.matrixAutoUpdate&&a.updateMatrix();let c=this._flipYUniform;null!==c&&(c.value=a.image instanceof ImageBitmap&&!0===a.flipY||!0===a.isRenderTargetTexture||!0===a.isFramebufferTexture||!0===a.isDepthTexture)}clone(){let a=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return a.sampler=this.sampler,a.depthNode=this.depthNode,a.compareNode=this.compareNode,a.gradNode=this.gradNode,a.offsetNode=this.offsetNode,a}}let _d=XD(_c).setParameterLength(1,4).setName("texture"),_e=(a=_b,b=null,c=null,d=null)=>{let e;return a&&!0===a.isTextureNode?((e=Xz(a.clone())).referenceNode=a.getBase(),null!==b&&(e.uvNode=Xz(b)),null!==c&&(e.levelNode=Xz(c)),null!==d&&(e.biasNode=Xz(d))):e=_d(a,b,c,d),e},_f=(...a)=>_e(...a).setSampler(!1);class _g extends YI{static get type(){return"BufferNode"}constructor(a,b,c=0){super(a,b),this.isBufferNode=!0,this.bufferType=b,this.bufferCount=c}getElementType(a){return this.getNodeType(a)}getInputType(){return"buffer"}}let _h=(a,b,c)=>Xz(new _g(a,b,c));class _i extends WX{static get type(){return"UniformArrayElementNode"}constructor(a,b){super(a,b),this.isArrayBufferElementNode=!0}generate(a){let b=super.generate(a),c=this.getNodeType(),d=this.node.getPaddedType();return a.format(b,d,c)}}class _j extends _g{static get type(){return"UniformArrayNode"}constructor(a,b=null){super(null),this.array=a,this.elementType=null===b?WJ(a[0]):b,this.paddedType=this.getPaddedType(),this.updateType=WP.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){let a=this.elementType,b="vec4";return"mat2"===a?b="mat2":!0===/mat/.test(a)?b="mat4":"i"===a.charAt(0)?b="ivec4":"u"===a.charAt(0)&&(b="uvec4"),b}update(){let{array:a,value:b}=this,c=this.elementType;if("float"===c||"int"===c||"uint"===c)for(let c=0;c<a.length;c++)b[4*c]=a[c];else if("color"===c)for(let c=0;c<a.length;c++){let d=4*c,e=a[c];b[d]=e.r,b[d+1]=e.g,b[d+2]=e.b||0}else if("mat2"===c)for(let c=0;c<a.length;c++){let d=4*c,e=a[c];b[d]=e.elements[0],b[d+1]=e.elements[1],b[d+2]=e.elements[2],b[d+3]=e.elements[3]}else if("mat3"===c)for(let c=0;c<a.length;c++){let d=16*c,e=a[c];b[d]=e.elements[0],b[d+1]=e.elements[1],b[d+2]=e.elements[2],b[d+4]=e.elements[3],b[d+5]=e.elements[4],b[d+6]=e.elements[5],b[d+8]=e.elements[6],b[d+9]=e.elements[7],b[d+10]=e.elements[8],b[d+15]=1}else if("mat4"===c)for(let c=0;c<a.length;c++){let d=16*c,e=a[c];for(let a=0;a<e.elements.length;a++)b[d+a]=e.elements[a]}else for(let c=0;c<a.length;c++){let d=4*c,e=a[c];b[d]=e.x,b[d+1]=e.y,b[d+2]=e.z||0,b[d+3]=e.w||0}}setup(a){let b=this.array.length,c=this.elementType,d=Float32Array,e=this.paddedType,f=a.getTypeLength(e);return"i"===c.charAt(0)&&(d=Int32Array),"u"===c.charAt(0)&&(d=Uint32Array),this.value=new d(b*f),this.bufferCount=b,this.bufferType=e,super.setup(a)}element(a){return Xz(new _i(this,Xz(a)))}}let _k=(a,b)=>Xz(new _j(a,b)),_l=XD(class extends WW{constructor(a){super("float"),this.name=a,this.isBuiltinNode=!0}generate(){return this.name}}).setParameterLength(1);class _m extends WW{static get type(){return"ScreenNode"}constructor(a){super(),this.scope=a,this._output=null,this.isViewportNode=!0}getNodeType(){return this.scope===_m.DPR?"float":this.scope===_m.VIEWPORT?"vec4":"vec2"}getUpdateType(){let a=WP.NONE;return(this.scope===_m.SIZE||this.scope===_m.VIEWPORT||this.scope===_m.DPR)&&(a=WP.RENDER),this.updateType=a,a}update({renderer:a}){let b=a.getRenderTarget();this.scope===_m.VIEWPORT?null!==b?d.copy(b.viewport):(a.getViewport(d),d.multiplyScalar(a.getPixelRatio())):this.scope===_m.DPR?this._output.value=a.getPixelRatio():null!==b?(c.width=b.width,c.height=b.height):a.getDrawingBufferSize(c)}setup(){let a=this.scope,b=null;return b=a===_m.SIZE?YJ(c||(c=new Jc)):a===_m.VIEWPORT?YJ(d||(d=new Jv)):a===_m.DPR?YJ(1):XS(_q.div(_p)),this._output=b,b}generate(a){if(this.scope===_m.COORDINATE){let b=a.getFragCoord();if(a.isFlipY()){let c=a.getNodeProperties(_p).outputNode.build(a);b=`${a.getType("vec2")}( ${b}.x, ${c}.y - ${b}.y )`}return b}return super.generate(a)}}_m.COORDINATE="coordinate",_m.VIEWPORT="viewport",_m.SIZE="size",_m.UV="uv",_m.DPR="dpr";let _n=XE(_m,_m.DPR),_o=XE(_m,_m.UV),_p=XE(_m,_m.SIZE),_q=XE(_m,_m.COORDINATE),_r=XE(_m,_m.VIEWPORT),_s=_r.zw,_t=_q.sub(_r.xy),_u=_t.div(_s),_v=XI(()=>(I0('TSL: "viewportResolution" is deprecated. Use "screenSize" instead.'),_p),"vec2").once()(),_w=YJ(0,"uint").setName("u_cameraIndex").setGroup(YE("cameraIndex")).toVarying("v_cameraIndex"),_x=YJ("float").setName("cameraNear").setGroup(YG).onRenderUpdate(({camera:a})=>a.near),_y=YJ("float").setName("cameraFar").setGroup(YG).onRenderUpdate(({camera:a})=>a.far),_z=XI(({camera:a})=>{let b;if(a.isArrayCamera&&a.cameras.length>0){let c=[];for(let b of a.cameras)c.push(b.projectionMatrix);b=_k(c).setGroup(YG).setName("cameraProjectionMatrices").element(a.isMultiViewCamera?_l("gl_ViewID_OVR"):_w).toConst("cameraProjectionMatrix")}else b=YJ("mat4").setName("cameraProjectionMatrix").setGroup(YG).onRenderUpdate(({camera:a})=>a.projectionMatrix);return b}).once()(),_A=XI(({camera:a})=>{let b;if(a.isArrayCamera&&a.cameras.length>0){let c=[];for(let b of a.cameras)c.push(b.projectionMatrixInverse);b=_k(c).setGroup(YG).setName("cameraProjectionMatricesInverse").element(a.isMultiViewCamera?_l("gl_ViewID_OVR"):_w).toConst("cameraProjectionMatrixInverse")}else b=YJ("mat4").setName("cameraProjectionMatrixInverse").setGroup(YG).onRenderUpdate(({camera:a})=>a.projectionMatrixInverse);return b}).once()(),_B=XI(({camera:a})=>{let b;if(a.isArrayCamera&&a.cameras.length>0){let c=[];for(let b of a.cameras)c.push(b.matrixWorldInverse);b=_k(c).setGroup(YG).setName("cameraViewMatrices").element(a.isMultiViewCamera?_l("gl_ViewID_OVR"):_w).toConst("cameraViewMatrix")}else b=YJ("mat4").setName("cameraViewMatrix").setGroup(YG).onRenderUpdate(({camera:a})=>a.matrixWorldInverse);return b}).once()(),_C=XI(({camera:a})=>{let b;if(a.isArrayCamera&&a.cameras.length>0){let c=[];for(let b of a.cameras)c.push(b.matrixWorld);b=_k(c).setGroup(YG).setName("cameraWorldMatrices").element(a.isMultiViewCamera?_l("gl_ViewID_OVR"):_w).toConst("cameraWorldMatrix")}else b=YJ("mat4").setName("cameraWorldMatrix").setGroup(YG).onRenderUpdate(({camera:a})=>a.matrixWorld);return b}).once()(),_D=XI(({camera:a})=>{let b;if(a.isArrayCamera&&a.cameras.length>0){let c=[];for(let b of a.cameras)c.push(b.normalMatrix);b=_k(c).setGroup(YG).setName("cameraNormalMatrices").element(a.isMultiViewCamera?_l("gl_ViewID_OVR"):_w).toConst("cameraNormalMatrix")}else b=YJ("mat3").setName("cameraNormalMatrix").setGroup(YG).onRenderUpdate(({camera:a})=>a.normalMatrix);return b}).once()(),_E=XI(({camera:a})=>{let b;if(a.isArrayCamera&&a.cameras.length>0){let c=[];for(let b=0,d=a.cameras.length;b<d;b++)c.push(new Je);b=_k(c).setGroup(YG).setName("cameraPositions").onRenderUpdate(({camera:a},b)=>{let c=a.cameras,d=b.array;for(let a=0,b=c.length;a<b;a++)d[a].setFromMatrixPosition(c[a].matrixWorld)}).element(a.isMultiViewCamera?_l("gl_ViewID_OVR"):_w).toConst("cameraPosition")}else b=YJ(new Je).setName("cameraPosition").setGroup(YG).onRenderUpdate(({camera:a},b)=>b.value.setFromMatrixPosition(a.matrixWorld));return b}).once()(),_F=XI(({camera:a})=>{let b;if(a.isArrayCamera&&a.cameras.length>0){let c=[];for(let b of a.cameras)c.push(b.viewport);b=_k(c,"vec4").setGroup(YG).setName("cameraViewports").element(_w).toConst("cameraViewport")}else b=X$(0,0,_p.x,_p.y).toConst("cameraViewport");return b}).once()(),_G=new JR;class _H extends WW{static get type(){return"Object3DNode"}constructor(a,b=null){super(),this.scope=a,this.object3d=b,this.updateType=WP.OBJECT,this.uniformNode=new YI(null)}getNodeType(){let a=this.scope;return a===_H.WORLD_MATRIX?"mat4":a===_H.POSITION||a===_H.VIEW_POSITION||a===_H.DIRECTION||a===_H.SCALE?"vec3":a===_H.RADIUS?"float":void 0}update(a){let b=this.object3d,c=this.uniformNode,d=this.scope;if(d===_H.WORLD_MATRIX)c.value=b.matrixWorld;else if(d===_H.POSITION)c.value=c.value||new Je,c.value.setFromMatrixPosition(b.matrixWorld);else if(d===_H.SCALE)c.value=c.value||new Je,c.value.setFromMatrixScale(b.matrixWorld);else if(d===_H.DIRECTION)c.value=c.value||new Je,b.getWorldDirection(c.value);else if(d===_H.VIEW_POSITION){let d=a.camera;c.value=c.value||new Je,c.value.setFromMatrixPosition(b.matrixWorld),c.value.applyMatrix4(d.matrixWorldInverse)}else if(d===_H.RADIUS){let d=a.object.geometry;null===d.boundingSphere&&d.computeBoundingSphere(),_G.copy(d.boundingSphere).applyMatrix4(b.matrixWorld),c.value=_G.radius}}generate(a){let b=this.scope;return b===_H.WORLD_MATRIX?this.uniformNode.nodeType="mat4":b===_H.POSITION||b===_H.VIEW_POSITION||b===_H.DIRECTION||b===_H.SCALE?this.uniformNode.nodeType="vec3":b===_H.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(a)}serialize(a){super.serialize(a),a.scope=this.scope}deserialize(a){super.deserialize(a),this.scope=a.scope}}_H.WORLD_MATRIX="worldMatrix",_H.POSITION="position",_H.SCALE="scale",_H.VIEW_POSITION="viewPosition",_H.DIRECTION="direction",_H.RADIUS="radius";let _I=XD(_H,_H.DIRECTION).setParameterLength(1),_J=XD(_H,_H.WORLD_MATRIX).setParameterLength(1),_K=XD(_H,_H.POSITION).setParameterLength(1),_L=XD(_H,_H.SCALE).setParameterLength(1),_M=XD(_H,_H.VIEW_POSITION).setParameterLength(1),_N=XD(_H,_H.RADIUS).setParameterLength(1);class _O extends _H{static get type(){return"ModelNode"}constructor(a){super(a)}update(a){this.object3d=a.object,super.update(a)}}let _P=XE(_O,_O.DIRECTION),_Q=XE(_O,_O.WORLD_MATRIX),_R=XE(_O,_O.POSITION),_S=XE(_O,_O.SCALE),_T=XE(_O,_O.VIEW_POSITION),_U=XE(_O,_O.RADIUS),_V=YJ(new Jh).onObjectUpdate(({object:a},b)=>b.value.getNormalMatrix(a.matrixWorld)),_W=YJ(new JZ).onObjectUpdate(({object:a},b)=>b.value.copy(a.matrixWorld).invert()),_X=XI(a=>a.renderer.overrideNodes.modelViewMatrix||_Y).once()().toVar("modelViewMatrix"),_Y=_B.mul(_Q),_Z=XI(a=>(a.context.isHighPrecisionModelViewMatrix=!0,YJ("mat4").onObjectUpdate(({object:a,camera:b})=>a.modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,a.matrixWorld)))).once()().toVar("highpModelViewMatrix"),_$=XI(a=>{let b=a.context.isHighPrecisionModelViewMatrix;return YJ("mat3").onObjectUpdate(({object:a,camera:c})=>(!0!==b&&a.modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,a.matrixWorld),a.normalMatrix.getNormalMatrix(a.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix"),__=$7("position","vec3"),_0=__.toVarying("positionLocal"),_1=__.toVarying("positionPrevious"),_2=XI(a=>_Q.mul(_0).xyz.toVarying(a.getSubBuildProperty("v_positionWorld")),"vec3").once(["POSITION"])(),_3=XI(()=>_0.transformDirection(_Q).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),"vec3").once(["POSITION"])(),_4=XI(a=>a.context.setupPositionView().toVarying("v_positionView"),"vec3").once(["POSITION"])(),_5=XI(a=>(a.camera.isOrthographicCamera?XW(0,0,1):_4.negate().toVarying("v_positionViewDirection").normalize()).toVar("positionViewDirection"),"vec3").once(["POSITION"])(),_6=XE(class extends WW{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(a){if("fragment"!==a.shaderStage)return"true";let{material:b}=a;return 1===b.side?"false":a.getFrontFacing()}}),_7=XO(_6).mul(2).sub(1),_8=XI(([a],{material:b})=>{let c=b.side;return 1===c?a=a.mul(-1):2===c&&(a=a.mul(_7)),a}),_9=$7("normal","vec3"),aaa=XI(a=>!1===a.geometry.hasAttribute("normal")?(I0('TSL: Vertex attribute "normal" not found on geometry.'),XW(0,1,0)):_9,"vec3").once()().toVar("normalLocal"),aab=_4.dFdx().cross(_4.dFdy()).normalize().toVar("normalFlat"),aac=XI(a=>!0===a.material.flatShading?aab:aai(aaa).toVarying("v_normalViewGeometry").normalize(),"vec3").once()().toVar("normalViewGeometry"),aad=XI(a=>{let b=aac.transformDirection(_B);return!0!==a.material.flatShading&&(b=b.toVarying("v_normalWorldGeometry")),b.normalize().toVar("normalWorldGeometry")},"vec3").once()(),aae=XI(({subBuildFn:a,material:b,context:c})=>{let d;return"NORMAL"===a||"VERTEX"===a?(d=aac,!0!==b.flatShading&&(d=_8(d))):d=c.setupNormal().context({getUV:null}),d},"vec3").once(["NORMAL","VERTEX"])().toVar("normalView"),aaf=aae.transformDirection(_B).toVar("normalWorld"),aag=XI(({subBuildFn:a,context:b})=>"NORMAL"===a||"VERTEX"===a?aae:b.setupClearcoatNormal().context({getUV:null}),"vec3").once(["NORMAL","VERTEX"])().toVar("clearcoatNormalView"),aah=XI(([a,b=_Q])=>{let c=X3(b),d=a.div(XW(c[0].dot(c[0]),c[1].dot(c[1]),c[2].dot(c[2])));return c.mul(d).xyz}),aai=XI(([a],b)=>{let c=b.renderer.overrideNodes.modelNormalViewMatrix;if(null!==c)return c.transformDirection(a);let d=_V.mul(a);return _B.transformDirection(d)}),aaj=XI(()=>(I0('TSL: "transformedNormalView" is deprecated. Use "normalView" instead.'),aae)).once(["NORMAL","VERTEX"])(),aak=XI(()=>(I0('TSL: "transformedNormalWorld" is deprecated. Use "normalWorld" instead.'),aaf)).once(["NORMAL","VERTEX"])(),aal=XI(()=>(I0('TSL: "transformedClearcoatNormalView" is deprecated. Use "clearcoatNormalView" instead.'),aag)).once(["NORMAL","VERTEX"])(),aam=new J7,aan=new JZ,aao=YJ(0).onReference(({material:a})=>a).onObjectUpdate(({material:a})=>a.refractionRatio),aap=YJ(1).onReference(({material:a})=>a).onObjectUpdate(function({material:a,scene:b}){return a.envMap?a.envMapIntensity:b.environmentIntensity}),aaq=YJ(new JZ).onReference(function(a){return a.material}).onObjectUpdate(function({material:a,scene:b}){let c=null!==b.environment&&null===a.envMap?b.environmentRotation:a.envMapRotation;return c?(aam.copy(c),aan.makeRotationFromEuler(aam)):aan.identity(),aan}),aar=_5.negate().reflect(aae),aas=_5.negate().refract(aae,aao),aat=aar.transformDirection(_B).toVar("reflectVector"),aau=aas.transformDirection(_B).toVar("reflectVector"),aav=new Lp,aaw=XD(class extends _c{static get type(){return"CubeTextureNode"}constructor(a,b=null,c=null,d=null){super(a,b,c,d),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){let a=this.value;return 301===a.mapping?aat:302===a.mapping?aau:(I1('CubeTextureNode: Mapping "%s" not supported.',a.mapping),XW(0,0,0))}setUpdateMatrix(){}setupUV(a,b){let c=this.value;return 2001!==a.renderer.coordinateSystem&&c.isRenderTargetTexture||(b=XW(b.x.negate(),b.yz)),aaq.mul(b)}generateUV(a,b){return b.build(a,!0===this.sampler?"vec3":"ivec3")}}).setParameterLength(1,4).setName("cubeTexture"),aax=(a=aav,b=null,c=null,d=null)=>{let e;return a&&!0===a.isCubeTextureNode?((e=Xz(a.clone())).referenceNode=a,null!==b&&(e.uvNode=Xz(b)),null!==c&&(e.levelNode=Xz(c)),null!==d&&(e.biasNode=Xz(d))):e=aaw(a,b,c,d),e};class aay extends WX{static get type(){return"ReferenceElementNode"}constructor(a,b){super(a,b),this.referenceNode=a,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(a){let b=super.generate(a),c=this.referenceNode.getNodeType(),d=this.getNodeType();return a.format(b,c,d)}}class aaz extends WW{static get type(){return"ReferenceNode"}constructor(a,b,c=null,d=null){super(),this.property=a,this.uniformType=b,this.object=c,this.count=d,this.properties=a.split("."),this.reference=c,this.node=null,this.group=null,this.name=null,this.updateType=WP.OBJECT}element(a){return Xz(new aay(this,Xz(a)))}setGroup(a){return this.group=a,this}setName(a){return this.name=a,this}label(a){return I0('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(a)}setNodeType(a){let b=null;b=null!==this.count?_h(null,a,this.count):Array.isArray(this.getValueFromReference())?_k(null,a):"texture"===a?_e(null):"cubeTexture"===a?aax(null):YJ(null,a),null!==this.group&&b.setGroup(this.group),null!==this.name&&b.setName(this.name),this.node=b}getNodeType(a){return null===this.node&&(this.updateReference(a),this.updateValue()),this.node.getNodeType(a)}getValueFromReference(a=this.reference){let{properties:b}=this,c=a[b[0]];for(let a=1;a<b.length;a++)c=c[b[a]];return c}updateReference(a){return this.reference=null!==this.object?this.object:a.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){null===this.node&&this.setNodeType(this.uniformType);let a=this.getValueFromReference();Array.isArray(a)?this.node.array=a:this.node.value=a}}let aaA=(a,b,c)=>Xz(new aaz(a,b,c)),aaB=(a,b,c,d)=>Xz(new aaz(a,b,d,c));class aaC extends aaz{static get type(){return"MaterialReferenceNode"}constructor(a,b,c=null){super(a,b,c),this.material=c,this.isMaterialReferenceNode=!0}updateReference(a){return this.reference=null!==this.material?this.material:a.material,this.reference}}let aaD=(a,b,c=null)=>Xz(new aaC(a,b,c)),aaE=$8(),aaF=_4.dFdx(),aaG=_4.dFdy(),aaH=aaE.dFdx(),aaI=aaE.dFdy(),aaJ=aaG.cross(aae),aaK=aae.cross(aaF),aaL=aaJ.mul(aaH.x).add(aaK.mul(aaI.x)),aaM=aaJ.mul(aaH.y).add(aaK.mul(aaI.y)),aaN=aaL.dot(aaL).max(aaM.dot(aaM)),aaO=aaN.equal(0).select(0,aaN.inverseSqrt()),aaP=aaL.mul(aaO).toVar("tangentViewFrame"),aaQ=aaM.mul(aaO).toVar("bitangentViewFrame"),aaR=XI(a=>(!1===a.geometry.hasAttribute("tangent")&&a.geometry.computeTangents(),$7("tangent","vec4")))(),aaS=aaR.xyz.toVar("tangentLocal"),aaT=XI(({subBuildFn:a,geometry:b,material:c})=>{let d;return d="VERTEX"===a||b.hasAttribute("tangent")?_X.mul(X$(aaS,0)).xyz.toVarying("v_tangentView").normalize():aaP,!0!==c.flatShading&&(d=_8(d)),d},"vec3").once(["NORMAL","VERTEX"])().toVar("tangentView"),aaU=aaT.transformDirection(_B).toVarying("v_tangentWorld").normalize().toVar("tangentWorld"),aaV=XI(([a,b],{subBuildFn:c,material:d})=>{let e=a.mul(aaR.w).xyz;return"NORMAL"===c&&!0!==d.flatShading&&(e=e.toVarying(b)),e}).once(["NORMAL"]),aaW=aaV(_9.cross(aaR),"v_bitangentGeometry").normalize().toVar("bitangentGeometry"),aaX=aaV(aaa.cross(aaS),"v_bitangentLocal").normalize().toVar("bitangentLocal"),aaY=XI(({subBuildFn:a,geometry:b,material:c})=>{let d;return d="VERTEX"===a||b.hasAttribute("tangent")?aaV(aae.cross(aaT),"v_bitangentView").normalize():aaQ,!0!==c.flatShading&&(d=_8(d)),d},"vec3").once(["NORMAL","VERTEX"])().toVar("bitangentView"),aaZ=aaV(aaf.cross(aaU),"v_bitangentWorld").normalize().toVar("bitangentWorld"),aa$=X3(aaT,aaY,aae).toVar("TBNViewMatrix"),aa_=_5.mul(aa$),aa0=XI(()=>{let a=Yo.cross(_5);return Z8(a=a.cross(Yo).normalize(),aae,Ym.mul(Yc.oneMinus()).oneMinus().pow2().pow2()).normalize()}).once()(),aa1=XD(class extends WZ{static get type(){return"NormalMapNode"}constructor(a,b=null){super("vec3"),this.node=a,this.scaleNode=b,this.normalMapType=0}setup({material:a}){let{normalMapType:b,scaleNode:c}=this,d=this.node.mul(2).sub(1);if(null!==c){let b=c;!0===a.flatShading&&(b=_8(b)),d=XW(d.xy.mul(b),d.z)}let e=null;return 1===b?e=aai(d):0===b?e=aa$.mul(d).normalize():(I1(`NodeMaterial: Unsupported normal map type: ${b}`),e=aae),e}}).setParameterLength(1,2),aa2=XI(({textureNode:a,bumpScale:b})=>{let c=b=>a.isolate().context({getUV:a=>b(a.uvNode||$8()),forceUVContext:!0}),d=XO(c(a=>a));return XS(XO(c(a=>a.add(a.dFdx()))).sub(d),XO(c(a=>a.add(a.dFdy()))).sub(d)).mul(b)}),aa3=XI(a=>{let{surf_pos:b,surf_norm:c,dHdxy:d}=a,e=b.dFdx().normalize(),f=b.dFdy().normalize().cross(c),g=c.cross(e),h=e.dot(f).mul(_7),i=h.sign().mul(d.x.mul(f).add(d.y.mul(g)));return h.abs().mul(c).sub(i).normalize()}),aa4=XD(class extends WZ{static get type(){return"BumpMapNode"}constructor(a,b=null){super("vec3"),this.textureNode=a,this.scaleNode=b}setup(){let a=null!==this.scaleNode?this.scaleNode:1;return aa3({surf_pos:_4,surf_norm:aae,dHdxy:aa2({textureNode:this.textureNode,bumpScale:a})})}}).setParameterLength(1,2),aa5=new Map;class aa6 extends WW{static get type(){return"MaterialNode"}constructor(a){super(),this.scope=a}getCache(a,b){let c=aa5.get(a);return void 0===c&&(c=aaD(a,b),aa5.set(a,c)),c}getFloat(a){return this.getCache(a,"float")}getColor(a){return this.getCache(a,"color")}getTexture(a){return this.getCache("map"===a?"map":a+"Map","texture")}setup(a){let b=a.context.material,c=this.scope,d=null;if(c===aa6.COLOR){let a=void 0!==b.color?this.getColor(c):XW();d=b.map&&!0===b.map.isTexture?a.mul(this.getTexture("map")):a}else if(c===aa6.OPACITY){let a=this.getFloat(c);d=b.alphaMap&&!0===b.alphaMap.isTexture?a.mul(this.getTexture("alpha")):a}else if(c===aa6.SPECULAR_STRENGTH)d=b.specularMap&&!0===b.specularMap.isTexture?this.getTexture("specular").r:XO(1);else if(c===aa6.SPECULAR_INTENSITY){let a=this.getFloat(c);d=b.specularIntensityMap&&!0===b.specularIntensityMap.isTexture?a.mul(this.getTexture(c).a):a}else if(c===aa6.SPECULAR_COLOR){let a=this.getColor(c);d=b.specularColorMap&&!0===b.specularColorMap.isTexture?a.mul(this.getTexture(c).rgb):a}else if(c===aa6.ROUGHNESS){let a=this.getFloat(c);d=b.roughnessMap&&!0===b.roughnessMap.isTexture?a.mul(this.getTexture(c).g):a}else if(c===aa6.METALNESS){let a=this.getFloat(c);d=b.metalnessMap&&!0===b.metalnessMap.isTexture?a.mul(this.getTexture(c).b):a}else if(c===aa6.EMISSIVE){let a=this.getFloat("emissiveIntensity"),e=this.getColor(c).mul(a);d=b.emissiveMap&&!0===b.emissiveMap.isTexture?e.mul(this.getTexture(c)):e}else if(c===aa6.NORMAL)b.normalMap?(d=aa1(this.getTexture("normal"),this.getCache("normalScale","vec2"))).normalMapType=b.normalMapType:d=b.bumpMap?aa4(this.getTexture("bump").r,this.getFloat("bumpScale")):aae;else if(c===aa6.CLEARCOAT){let a=this.getFloat(c);d=b.clearcoatMap&&!0===b.clearcoatMap.isTexture?a.mul(this.getTexture(c).r):a}else if(c===aa6.CLEARCOAT_ROUGHNESS){let a=this.getFloat(c);d=b.clearcoatRoughnessMap&&!0===b.clearcoatRoughnessMap.isTexture?a.mul(this.getTexture(c).r):a}else if(c===aa6.CLEARCOAT_NORMAL)d=b.clearcoatNormalMap?aa1(this.getTexture(c),this.getCache(c+"Scale","vec2")):aae;else if(c===aa6.SHEEN){let a=this.getColor("sheenColor").mul(this.getFloat("sheen"));d=b.sheenColorMap&&!0===b.sheenColorMap.isTexture?a.mul(this.getTexture("sheenColor").rgb):a}else if(c===aa6.SHEEN_ROUGHNESS){let a=this.getFloat(c);d=(d=b.sheenRoughnessMap&&!0===b.sheenRoughnessMap.isTexture?a.mul(this.getTexture(c).a):a).clamp(.07,1)}else if(c===aa6.ANISOTROPY)if(b.anisotropyMap&&!0===b.anisotropyMap.isTexture){let a=this.getTexture(c);d=X2(abI.x,abI.y,abI.y.negate(),abI.x).mul(a.rg.mul(2).sub(XS(1)).normalize().mul(a.b))}else d=abI;else if(c===aa6.IRIDESCENCE_THICKNESS){let a=aaA("1","float",b.iridescenceThicknessRange);if(b.iridescenceThicknessMap){let e=aaA("0","float",b.iridescenceThicknessRange);d=a.sub(e).mul(this.getTexture(c).g).add(e)}else d=a}else if(c===aa6.TRANSMISSION){let a=this.getFloat(c);d=b.transmissionMap?a.mul(this.getTexture(c).r):a}else if(c===aa6.THICKNESS){let a=this.getFloat(c);d=b.thicknessMap?a.mul(this.getTexture(c).g):a}else if(c===aa6.IOR)d=this.getFloat(c);else if(c===aa6.LIGHT_MAP)d=this.getTexture(c).rgb.mul(this.getFloat("lightMapIntensity"));else if(c===aa6.AO)d=this.getTexture(c).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(c===aa6.LINE_DASH_OFFSET)d=b.dashOffset?this.getFloat(c):XO(0);else{let b=this.getNodeType(a);d=this.getCache(c,b)}return d}}aa6.ALPHA_TEST="alphaTest",aa6.COLOR="color",aa6.OPACITY="opacity",aa6.SHININESS="shininess",aa6.SPECULAR="specular",aa6.SPECULAR_STRENGTH="specularStrength",aa6.SPECULAR_INTENSITY="specularIntensity",aa6.SPECULAR_COLOR="specularColor",aa6.REFLECTIVITY="reflectivity",aa6.ROUGHNESS="roughness",aa6.METALNESS="metalness",aa6.NORMAL="normal",aa6.CLEARCOAT="clearcoat",aa6.CLEARCOAT_ROUGHNESS="clearcoatRoughness",aa6.CLEARCOAT_NORMAL="clearcoatNormal",aa6.EMISSIVE="emissive",aa6.ROTATION="rotation",aa6.SHEEN="sheen",aa6.SHEEN_ROUGHNESS="sheenRoughness",aa6.ANISOTROPY="anisotropy",aa6.IRIDESCENCE="iridescence",aa6.IRIDESCENCE_IOR="iridescenceIOR",aa6.IRIDESCENCE_THICKNESS="iridescenceThickness",aa6.IOR="ior",aa6.TRANSMISSION="transmission",aa6.THICKNESS="thickness",aa6.ATTENUATION_DISTANCE="attenuationDistance",aa6.ATTENUATION_COLOR="attenuationColor",aa6.LINE_SCALE="scale",aa6.LINE_DASH_SIZE="dashSize",aa6.LINE_GAP_SIZE="gapSize",aa6.LINE_WIDTH="linewidth",aa6.LINE_DASH_OFFSET="dashOffset",aa6.POINT_SIZE="size",aa6.DISPERSION="dispersion",aa6.LIGHT_MAP="light",aa6.AO="ao";let aa7=XE(aa6,aa6.ALPHA_TEST),aa8=XE(aa6,aa6.COLOR),aa9=XE(aa6,aa6.SHININESS),aba=XE(aa6,aa6.EMISSIVE),abb=XE(aa6,aa6.OPACITY),abc=XE(aa6,aa6.SPECULAR),abd=XE(aa6,aa6.SPECULAR_INTENSITY),abe=XE(aa6,aa6.SPECULAR_COLOR),abf=XE(aa6,aa6.SPECULAR_STRENGTH),abg=XE(aa6,aa6.REFLECTIVITY),abh=XE(aa6,aa6.ROUGHNESS),abi=XE(aa6,aa6.METALNESS),abj=XE(aa6,aa6.NORMAL),abk=XE(aa6,aa6.CLEARCOAT),abl=XE(aa6,aa6.CLEARCOAT_ROUGHNESS),abm=XE(aa6,aa6.CLEARCOAT_NORMAL),abn=XE(aa6,aa6.ROTATION),abo=XE(aa6,aa6.SHEEN),abp=XE(aa6,aa6.SHEEN_ROUGHNESS),abq=XE(aa6,aa6.ANISOTROPY),abr=XE(aa6,aa6.IRIDESCENCE),abs=XE(aa6,aa6.IRIDESCENCE_IOR),abt=XE(aa6,aa6.IRIDESCENCE_THICKNESS),abu=XE(aa6,aa6.TRANSMISSION),abv=XE(aa6,aa6.THICKNESS),abw=XE(aa6,aa6.IOR),abx=XE(aa6,aa6.ATTENUATION_DISTANCE),aby=XE(aa6,aa6.ATTENUATION_COLOR),abz=XE(aa6,aa6.LINE_SCALE),abA=XE(aa6,aa6.LINE_DASH_SIZE),abB=XE(aa6,aa6.LINE_GAP_SIZE),abC=XE(aa6,aa6.LINE_WIDTH),abD=XE(aa6,aa6.LINE_DASH_OFFSET),abE=XE(aa6,aa6.POINT_SIZE),abF=XE(aa6,aa6.DISPERSION),abG=XE(aa6,aa6.LIGHT_MAP),abH=XE(aa6,aa6.AO),abI=YJ(new Jc).onReference(function(a){return a.material}).onRenderUpdate(function({material:a}){this.value.set(a.anisotropy*Math.cos(a.anisotropyRotation),a.anisotropy*Math.sin(a.anisotropyRotation))}),abJ=XI(a=>a.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class abK extends WW{static get type(){return"IndexNode"}constructor(a){super("uint"),this.scope=a,this.isIndexNode=!0}generate(a){let b,c=this.getNodeType(a),d=this.scope;if(d===abK.VERTEX)b=a.getVertexIndex();else if(d===abK.INSTANCE)b=a.getInstanceIndex();else if(d===abK.DRAW)b=a.getDrawIndex();else if(d===abK.INVOCATION_LOCAL)b=a.getInvocationLocalIndex();else if(d===abK.INVOCATION_SUBGROUP)b=a.getInvocationSubgroupIndex();else if(d===abK.SUBGROUP)b=a.getSubgroupIndex();else throw Error("THREE.IndexNode: Unknown scope: "+d);return"vertex"===a.shaderStage||"compute"===a.shaderStage?b:$v(this).build(a,c)}}abK.VERTEX="vertex",abK.INSTANCE="instance",abK.SUBGROUP="subgroup",abK.INVOCATION_LOCAL="invocationLocal",abK.INVOCATION_SUBGROUP="invocationSubgroup",abK.DRAW="draw";let abL=XE(abK,abK.VERTEX),abM=XE(abK,abK.INSTANCE),abN=XE(abK,abK.SUBGROUP),abO=XE(abK,abK.INVOCATION_SUBGROUP),abP=XE(abK,abK.INVOCATION_LOCAL),abQ=XE(abK,abK.DRAW);class abR extends WW{static get type(){return"InstanceNode"}constructor(a,b,c=null){super("void"),this.count=a,this.instanceMatrix=b,this.instanceColor=c,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=WP.FRAME,this.buffer=null,this.bufferColor=null}setup(a){let{instanceMatrix:b,instanceColor:c}=this,{count:d}=b,{instanceMatrixNode:e,instanceColorNode:f}=this;if(null===e){if(d<=1e3)e=_h(b.array,"mat4",Math.max(d,1)).element(abM);else{let a=new LP(b.array,16,1);this.buffer=a;let c=35048===b.usage?$O:$N;e=X4(c(a,"vec4",16,0),c(a,"vec4",16,4),c(a,"vec4",16,8),c(a,"vec4",16,12))}this.instanceMatrixNode=e}if(c&&null===f){let a=new Ly(c.array,3),b=35048===c.usage?$O:$N;this.bufferColor=a,f=XW(b(a,"vec3",3,0)),this.instanceColorNode=f}let g=e.mul(_0).xyz;if(_0.assign(g),a.hasGeometryAttribute("normal")){let a=aah(aaa,e);aaa.assign(a)}null!==this.instanceColorNode&&X9("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){null!==this.buffer&&(this.buffer.clearUpdateRanges(),this.buffer.updateRanges.push(...this.instanceMatrix.updateRanges),35048!==this.instanceMatrix.usage&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version)),this.instanceColor&&null!==this.bufferColor&&(this.bufferColor.clearUpdateRanges(),this.bufferColor.updateRanges.push(...this.instanceColor.updateRanges),35048!==this.instanceColor.usage&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version))}}let abS=XD(abR).setParameterLength(2,3),abT=XD(class extends abR{static get type(){return"InstancedMeshNode"}constructor(a){const{count:b,instanceMatrix:c,instanceColor:d}=a;super(b,c,d),this.instancedMesh=a}}).setParameterLength(1),abU=XD(class extends WW{static get type(){return"BatchNode"}constructor(a){super("void"),this.batchMesh=a,this.batchingIdNode=null}setup(a){null===this.batchingIdNode&&(null===a.getDrawIndex()?this.batchingIdNode=abM:this.batchingIdNode=abQ);let b=XI(([a])=>{let b=XP($9(_f(this.batchMesh._indirectTexture),0).x),c=XP(a).mod(b),d=XP(a).div(b);return _f(this.batchMesh._indirectTexture,XT(c,d)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(XP(this.batchingIdNode)),c=this.batchMesh._matricesTexture,d=XP($9(_f(c),0).x),e=XO(b).mul(4).toInt().toVar(),f=e.mod(d),g=e.div(d),h=X4(_f(c,XT(f,g)),_f(c,XT(f.add(1),g)),_f(c,XT(f.add(2),g)),_f(c,XT(f.add(3),g))),i=this.batchMesh._colorsTexture;if(null!==i){let a=XI(([a])=>{let b=XP($9(_f(i),0).x);return _f(i,XT(a.mod(b),a.div(b))).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(b);X9("vec3","vBatchColor").assign(a)}let j=X3(h);_0.assign(h.mul(_0));let k=aaa.div(XW(j[0].dot(j[0]),j[1].dot(j[1]),j[2].dot(j[2]))),l=j.mul(k).xyz;aaa.assign(l),a.hasGeometryAttribute("tangent")&&aaS.mulAssign(j)}}).setParameterLength(1),abV=XD(class extends WX{static get type(){return"StorageArrayElementNode"}constructor(a,b){super(a,b),this.isStorageArrayElementNode=!0}set storageBufferNode(a){this.node=a}get storageBufferNode(){return this.node}getMemberType(a,b){let c=this.storageBufferNode.structTypeNode;return c?c.getMemberType(a,b):"void"}setup(a){return!1===a.isAvailable("storageBuffer")&&!0===this.node.isPBO&&a.setupPBO(this.node),super.setup(a)}generate(a,b){let c,d=a.context.assign;if(c=!1===a.isAvailable("storageBuffer")?!0===this.node.isPBO&&!0!==d&&(this.node.value.isInstancedBufferAttribute||"compute"!==a.shaderStage)?a.generatePBO(this):this.node.build(a):super.generate(a),!0!==d){let d=this.getNodeType(a);c=a.format(c,d,b)}return c}}).setParameterLength(2);class abW extends _g{static get type(){return"StorageBufferNode"}constructor(a,b=null,c=0){var d;let e,f=null;b&&b.isStruct?(e="struct",f=b.layout,(a.isStorageBufferAttribute||a.isStorageInstancedBufferAttribute)&&(c=a.count)):null===b&&(a.isStorageBufferAttribute||a.isStorageInstancedBufferAttribute)?(d=a.itemSize,e=WF.get(d),c=a.count):e=b,super(a,e,c),this.isStorageBufferNode=!0,this.structTypeNode=f,this.access=WQ.READ_WRITE,this.isAtomic=!1,this.isPBO=!1,this._attribute=null,this._varying=null,this.global=!0,!0!==a.isStorageBufferAttribute&&!0!==a.isStorageInstancedBufferAttribute&&(a.isInstancedBufferAttribute?a.isStorageInstancedBufferAttribute=!0:a.isStorageBufferAttribute=!0)}getHash(a){if(0===this.bufferCount){let b=a.globalCache.getData(this.value);return void 0===b&&(b={node:this},a.globalCache.setData(this.value,b)),b.node.uuid}return this.uuid}getInputType(){return this.value.isIndirectStorageBufferAttribute?"indirectStorageBuffer":"storageBuffer"}element(a){return abV(this,a)}setPBO(a){return this.isPBO=a,this}getPBO(){return this.isPBO}setAccess(a){return this.access=a,this}toReadOnly(){return this.setAccess(WQ.READ_ONLY)}setAtomic(a){return this.isAtomic=a,this}toAtomic(){return this.setAtomic(!0)}getAttributeData(){return null===this._attribute&&(this._attribute=$L(this.value),this._varying=$v(this._attribute)),{attribute:this._attribute,varying:this._varying}}getNodeType(a){if(null!==this.structTypeNode)return this.structTypeNode.getNodeType(a);if(a.isAvailable("storageBuffer")||a.isAvailable("indirectStorageBuffer"))return super.getNodeType(a);let{attribute:b}=this.getAttributeData();return b.getNodeType(a)}getMemberType(a,b){return null!==this.structTypeNode?this.structTypeNode.getMemberType(a,b):"void"}generate(a){if(null!==this.structTypeNode&&this.structTypeNode.build(a),a.isAvailable("storageBuffer")||a.isAvailable("indirectStorageBuffer"))return super.generate(a);let{attribute:b,varying:c}=this.getAttributeData(),d=c.build(a);return a.registerTransform(d,b),d}}let abX=(a,b=null,c=0)=>Xz(new abW(a,b,c)),abY=new WeakMap;class abZ extends WW{static get type(){return"SkinningNode"}constructor(a){super("void"),this.skinnedMesh=a,this.updateType=WP.OBJECT,this.skinIndexNode=$7("skinIndex","uvec4"),this.skinWeightNode=$7("skinWeight","vec4"),this.bindMatrixNode=aaA("bindMatrix","mat4"),this.bindMatrixInverseNode=aaA("bindMatrixInverse","mat4"),this.boneMatricesNode=aaB("skeleton.boneMatrices","mat4",a.skeleton.bones.length),this.positionNode=_0,this.toPositionNode=_0,this.previousBoneMatricesNode=null}getSkinnedPosition(a=this.boneMatricesNode,b=this.positionNode){let{skinIndexNode:c,skinWeightNode:d,bindMatrixNode:e,bindMatrixInverseNode:f}=this,g=a.element(c.x),h=a.element(c.y),i=a.element(c.z),j=a.element(c.w),k=e.mul(b),l=YR(g.mul(d.x).mul(k),h.mul(d.y).mul(k),i.mul(d.z).mul(k),j.mul(d.w).mul(k));return f.mul(l).xyz}getSkinnedNormal(a=this.boneMatricesNode,b=aaa){let{skinIndexNode:c,skinWeightNode:d,bindMatrixNode:e,bindMatrixInverseNode:f}=this,g=a.element(c.x),h=a.element(c.y),i=a.element(c.z),j=a.element(c.w),k=YR(d.x.mul(g),d.y.mul(h),d.z.mul(i),d.w.mul(j));return(k=f.mul(k).mul(e)).transformDirection(b).xyz}getPreviousSkinnedPosition(a){let b=a.object;return null===this.previousBoneMatricesNode&&(b.skeleton.previousBoneMatrices=new Float32Array(b.skeleton.boneMatrices),this.previousBoneMatricesNode=aaB("skeleton.previousBoneMatrices","mat4",b.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,_1)}needsPreviousBoneMatrices(a){let b=a.renderer.getMRT();return b&&b.has("velocity")||!0===WL(a.object).useVelocity}setup(a){this.needsPreviousBoneMatrices(a)&&_1.assign(this.getPreviousSkinnedPosition(a));let b=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(b),a.hasGeometryAttribute("normal")){let b=this.getSkinnedNormal();aaa.assign(b),a.hasGeometryAttribute("tangent")&&aaS.assign(b)}return b}generate(a,b){if("void"!==b)return super.generate(a,b)}update(a){let b=a.object&&a.object.skeleton?a.object.skeleton:this.skinnedMesh.skeleton;abY.get(b)!==a.frameId&&(abY.set(b,a.frameId),null!==this.previousBoneMatricesNode&&b.previousBoneMatrices.set(b.boneMatrices),b.update())}}let ab$=a=>Xz(new abZ(a));class ab_ extends WW{static get type(){return"LoopNode"}constructor(a=[]){super("void"),this.params=a}getVarName(a){return String.fromCharCode(105+a)}getProperties(a){let b=a.getNodeProperties(this);if(void 0!==b.stackNode)return b;let c={};for(let a=0,b=this.params.length-1;a<b;a++){let b=this.params[a],d=!0!==b.isNode&&b.name||this.getVarName(a),e=!0!==b.isNode&&b.type||"int";c[d]=$Z(d,e)}let d=a.addStack(),e=this.params[this.params.length-1](c);b.returnsNode=e.context({nodeLoop:e}),b.stackNode=d;let f=this.params[0];if(!0!==f.isNode&&"function"==typeof f.update){let a=XI(this.params[0].update)(c);b.updateNode=a.context({nodeLoop:a})}return a.removeStack(),b}setup(a){this.getProperties(a),a.fnCall&&(a.getDataFromNode(a.fnCall.shaderNode).hasLoop=!0)}generate(a){let b=this.getProperties(a),c=this.params,d=b.stackNode;for(let d=0,e=c.length-1;d<e;d++){let e,f=c[d],g=!1,h=null,i=null,j=null,k=null,l=null,m=null;if(f.isNode?"bool"===f.getNodeType(a)?(g=!0,k="bool",i=f.build(a,k)):(k="int",j=this.getVarName(d),h="0",i=f.build(a,k),l="<"):(k=f.type||"int",j=f.name||this.getVarName(d),h=f.start,i=f.end,l=f.condition,m=f.update,"number"==typeof h?h=a.generateConst(k,h):h&&h.isNode&&(h=h.build(a,k)),"number"==typeof i?i=a.generateConst(k,i):i&&i.isNode&&(i=i.build(a,k)),void 0!==h&&void 0===i?(h+=" - 1",i="0",l=">="):void 0!==i&&void 0===h&&(h="0",l="<"),void 0===l&&(l=Number(h)>Number(i)?">=":"<")),g)e=`while ( ${i} )`;else{let c,d=h,f=i,g=()=>l.includes("<")?"+=":"-=";if(null!=m)switch(typeof m){case"function":c=a.flowStagesNode(b.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":c=j+" "+g()+" "+a.generateConst(k,m);break;case"string":c=j+" "+m;break;default:m.isNode?c=j+" "+g()+" "+m.build(a):(I1("TSL: 'Loop( { update: ... } )' is not a function, string or number."),c="break /* invalid update */")}else c=j+" "+(m="int"===k||"uint"===k?l.includes("<")?"++":"--":g()+" 1.");let n=a.getVar(k,j)+" = "+d,o=j+" "+l+" "+f;e=`for ( ${n}; ${o}; ${c} )`}a.addFlowCode((0===d?`
`:"")+a.tab+e+` {

`).addFlowTab()}let e=d.build(a,"void");b.returnsNode.build(a,"void"),a.removeFlowTab().addFlowCode(`
`+a.tab+e);for(let b=0,c=this.params.length-1;b<c;b++)a.addFlowCode((0===b?"":a.tab)+`}

`).removeFlowTab();a.addFlowTab()}}let ab0=(...a)=>new ab_(XC(a,"int")).toStack(),ab1=()=>$Z("break").toStack(),ab2=new WeakMap,ab3=new Jv,ab4=XI(({bufferMap:a,influence:b,stride:c,width:d,depth:e,offset:f})=>{let g=XP(abL).mul(c).add(f),h=g.div(d);return _f(a,XT(g.sub(h.mul(d)),h)).depth(e).xyz.mul(b)}),ab5=XD(class extends WW{static get type(){return"MorphNode"}constructor(a){super("void"),this.mesh=a,this.morphBaseInfluence=YJ(1),this.updateType=WP.OBJECT}setup(a){let{geometry:b}=a,c=void 0!==b.morphAttributes.position,d=b.hasAttribute("normal")&&void 0!==b.morphAttributes.normal,e=b.morphAttributes.position||b.morphAttributes.normal||b.morphAttributes.color,f=void 0!==e?e.length:0,{texture:g,stride:h,size:i}=function(a){let b=void 0!==a.morphAttributes.position,c=void 0!==a.morphAttributes.normal,d=void 0!==a.morphAttributes.color,e=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,f=void 0!==e?e.length:0,g=ab2.get(a);if(void 0===g||g.count!==f){let e=function(){o.dispose(),ab2.delete(a),a.removeEventListener("dispose",e)};void 0!==g&&g.texture.dispose();let h=a.morphAttributes.position||[],i=a.morphAttributes.normal||[],j=a.morphAttributes.color||[],k=0;!0===b&&(k=1),!0===c&&(k=2),!0===d&&(k=3);let l=a.attributes.position.count*k,m=1;l>4096&&(m=Math.ceil(l/4096),l=4096);let n=new Float32Array(l*m*4*f),o=new Jy(n,l,m,f);o.type=1015,o.needsUpdate=!0;let p=4*k;for(let a=0;a<f;a++){let e=h[a],f=i[a],g=j[a],k=l*m*4*a;for(let a=0;a<e.count;a++){let h=a*p;!0===b&&(ab3.fromBufferAttribute(e,a),n[k+h+0]=ab3.x,n[k+h+1]=ab3.y,n[k+h+2]=ab3.z,n[k+h+3]=0),!0===c&&(ab3.fromBufferAttribute(f,a),n[k+h+4]=ab3.x,n[k+h+5]=ab3.y,n[k+h+6]=ab3.z,n[k+h+7]=0),!0===d&&(ab3.fromBufferAttribute(g,a),n[k+h+8]=ab3.x,n[k+h+9]=ab3.y,n[k+h+10]=ab3.z,n[k+h+11]=4===g.itemSize?ab3.w:1)}}g={count:f,texture:o,stride:k,size:new Jc(l,m)},ab2.set(a,g),a.addEventListener("dispose",e)}return g}(b);!0===c&&_0.mulAssign(this.morphBaseInfluence),!0===d&&aaa.mulAssign(this.morphBaseInfluence);let j=XP(i.width);ab0(f,({i:a})=>{let b=XO(0).toVar();this.mesh.count>1&&null!==this.mesh.morphTexture&&void 0!==this.mesh.morphTexture?b.assign(_f(this.mesh.morphTexture,XT(XP(a).add(1),XP(abM))).r):b.assign(aaA("morphTargetInfluences","float").element(a).toVar()),XL(b.notEqual(0),()=>{!0===c&&_0.addAssign(ab4({bufferMap:g,influence:b,stride:h,width:j,depth:a,offset:XP(0)})),!0===d&&aaa.addAssign(ab4({bufferMap:g,influence:b,stride:h,width:j,depth:a,offset:XP(1)}))})})}update(){let a=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?a.value=1:a.value=1-this.mesh.morphTargetInfluences.reduce((a,b)=>a+b,0)}}).setParameterLength(1);class ab6 extends WW{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class ab7 extends ab6{static get type(){return"AONode"}constructor(a=null){super(),this.aoNode=a}setup(a){a.context.ambientOcclusion.mulAssign(this.aoNode)}}let ab8=XD(class extends $k{static get type(){return"LightingContextNode"}constructor(a,b=null,c=null,d=null){super(a),this.lightingModel=b,this.backdropNode=c,this.backdropAlphaNode=d,this._value=null}getContext(){let{backdropNode:a,backdropAlphaNode:b}=this,c=XW().toVar("directDiffuse"),d=XW().toVar("directSpecular"),e=XW().toVar("indirectDiffuse"),f=XW().toVar("indirectSpecular");return{radiance:XW().toVar("radiance"),irradiance:XW().toVar("irradiance"),iblIrradiance:XW().toVar("iblIrradiance"),ambientOcclusion:XO(1).toVar("ambientOcclusion"),reflectedLight:{directDiffuse:c,directSpecular:d,indirectDiffuse:e,indirectSpecular:f},backdrop:a,backdropAlpha:b}}setup(a){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||a.context.lightingModel,super.setup(a)}});class ab9 extends ab6{static get type(){return"IrradianceNode"}constructor(a){super(),this.node=a}setup(a){a.context.irradiance.addAssign(this.node)}}let aca=new Jc;class acb extends _c{static get type(){return"ViewportTextureNode"}constructor(a=_o,b=null,c=null){let d=null;null===c?((d=new LH).minFilter=1008,c=d):d=c,super(c,a,b),this.generateMipmaps=!1,this.defaultFramebuffer=d,this.isOutputTextureNode=!0,this.updateBeforeType=WP.FRAME,this._cacheTextures=new WeakMap}getTextureForReference(a=null){let b,c;if(this.referenceNode?(b=this.referenceNode.defaultFramebuffer,c=this.referenceNode._cacheTextures):(b=this.defaultFramebuffer,c=this._cacheTextures),null===a)return b;if(!1===c.has(a)){let d=b.clone();c.set(a,d)}return c.get(a)}updateReference(a){let b=a.renderer.getRenderTarget();return this.value=this.getTextureForReference(b),this.value}updateBefore(a){let b=a.renderer,c=b.getRenderTarget();null===c?b.getDrawingBufferSize(aca):aca.set(c.width,c.height);let d=this.getTextureForReference(c);(d.image.width!==aca.width||d.image.height!==aca.height)&&(d.image.width=aca.width,d.image.height=aca.height,d.needsUpdate=!0);let e=d.generateMipmaps;d.generateMipmaps=this.generateMipmaps,b.copyFramebufferToTexture(d),d.generateMipmaps=e}clone(){let a=new this.constructor(this.uvNode,this.levelNode,this.value);return a.generateMipmaps=this.generateMipmaps,a}}let acc=XD(acb).setParameterLength(0,3),acd=XD(acb,null,null,{generateMipmaps:!0}).setParameterLength(0,3),ace=null,acf=XD(class extends acb{static get type(){return"ViewportDepthTextureNode"}constructor(a=_o,b=null){null===ace&&(ace=new LI),super(a,b,ace)}getTextureForReference(){return ace}}).setParameterLength(0,2);class acg extends WW{static get type(){return"ViewportDepthNode"}constructor(a,b=null){super("float"),this.scope=a,this.valueNode=b,this.isViewportDepthNode=!0}generate(a){let{scope:b}=this;return b===acg.DEPTH_BASE?a.getFragDepth():super.generate(a)}setup({camera:a}){let{scope:b}=this,c=this.valueNode,d=null;return b===acg.DEPTH_BASE?null!==c&&(d=acl().assign(c)):b===acg.DEPTH?d=a.isPerspectiveCamera?aci(_4.z,_x,_y):ach(_4.z,_x,_y):b===acg.LINEAR_DEPTH&&(d=null!==c?a.isPerspectiveCamera?ach(acj(c,_x,_y),_x,_y):c:ach(_4.z,_x,_y)),d}}acg.DEPTH_BASE="depthBase",acg.DEPTH="depth",acg.LINEAR_DEPTH="linearDepth";let ach=(a,b,c)=>a.add(b).div(b.sub(c)),aci=(a,b,c)=>b.add(a).mul(c).div(c.sub(b).mul(a)),acj=(a,b,c)=>b.mul(c).div(c.sub(b).mul(a).sub(c)),ack=(a,b,c)=>{b=b.max(1e-6).toVar();let d=Zt(a.negate().div(b)),e=Zt(c.div(b));return d.div(e)},acl=XD(acg,acg.DEPTH_BASE),acm=XE(acg,acg.DEPTH),acn=XD(acg,acg.LINEAR_DEPTH).setParameterLength(0,1),aco=acn(acf());acm.assign=a=>acl(a);class acp extends WW{static get type(){return"ClippingNode"}constructor(a=acp.DEFAULT){super(),this.scope=a}setup(a){super.setup(a);let{intersectionPlanes:b,unionPlanes:c}=a.clippingContext;return this.hardwareClipping=a.material.hardwareClipping,this.scope===acp.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(b,c):this.scope===acp.HARDWARE?this.setupHardwareClipping(c,a):this.setupDefault(b,c)}setupAlphaToCoverage(a,b){return XI(()=>{let c=XO().toVar("distanceToPlane"),d=XO().toVar("distanceToGradient"),e=XO(1).toVar("clipOpacity"),f=b.length;if(!1===this.hardwareClipping&&f>0){let a=_k(b).setGroup(YG);ab0(f,({i:b})=>{let f=a.element(b);c.assign(_4.dot(f.xyz).negate().add(f.w)),d.assign(c.fwidth().div(2)),e.mulAssign($c(d.negate(),d,c))})}let g=a.length;if(g>0){let b=_k(a).setGroup(YG),f=XO(1).toVar("intersectionClipOpacity");ab0(g,({i:a})=>{let e=b.element(a);c.assign(_4.dot(e.xyz).negate().add(e.w)),d.assign(c.fwidth().div(2)),f.mulAssign($c(d.negate(),d,c).oneMinus())}),e.mulAssign(f.oneMinus())}Ya.a.mulAssign(e),Ya.a.equal(0).discard()})()}setupDefault(a,b){return XI(()=>{let c=b.length;if(!1===this.hardwareClipping&&c>0){let a=_k(b).setGroup(YG);ab0(c,({i:b})=>{let c=a.element(b);_4.dot(c.xyz).greaterThan(c.w).discard()})}let d=a.length;if(d>0){let b=_k(a).setGroup(YG),c=XR(!0).toVar("clipped");ab0(d,({i:a})=>{let d=b.element(a);c.assign(_4.dot(d.xyz).greaterThan(d.w).and(c))}),c.discard()}})()}setupHardwareClipping(a,b){let c=a.length;return b.enableHardwareClipping(c),XI(()=>{let d=_k(a).setGroup(YG),e=_l(b.getClipDistance());ab0(c,({i:a})=>{let b=d.element(a),c=_4.dot(b.xyz).sub(b.w).negate();e.element(a).assign(c)})})()}}acp.ALPHA_TO_COVERAGE="alphaToCoverage",acp.DEFAULT="default",acp.HARDWARE="hardware";let acq=XI(([a])=>Zz(YT(1e4,ZA(YT(17,a.x).add(YT(.1,a.y)))).mul(YR(.1,ZG(ZA(YT(13,a.y).add(a.x))))))),acr=XI(([a])=>acq(XS(acq(a.xy),a.z))),acs=XI(([a])=>{let b=ZW(ZI(ZL(a.xyz)),ZI(ZM(a.xyz))),c=XO(1).div(XO(.05).mul(b)).toVar("pixScale"),d=XS(Zr(Zw(Zt(c))),Zr(Zx(Zt(c)))),e=XS(acr(Zw(d.x.mul(a.xyz))),acr(Zw(d.y.mul(a.xyz)))),f=Zz(Zt(c)),g=YR(YT(f.oneMinus(),e.x),YT(f,e.y)),h=ZV(f,f.oneMinus()),i=XW(g.mul(g).div(YT(2,h).mul(YS(1,h))),g.sub(YT(.5,h)).div(YS(1,h)),YS(1,YS(1,g).mul(YS(1,g)).div(YT(2,h).mul(YS(1,h)))));return Z9(g.lessThan(h.oneMinus()).select(g.lessThan(h).select(i.x,i.y),i.z),1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class act extends $6{static get type(){return"VertexColorNode"}constructor(a){super(null,"vec4"),this.isVertexColorNode=!0,this.index=a}getAttributeName(){let a=this.index;return"color"+(a>0?a:"")}generate(a){let b=this.getAttributeName(a);return!0===a.hasGeometryAttribute(b)?super.generate(a):a.generateConst(this.nodeType,new Jv(1,1,1,1))}serialize(a){super.serialize(a),a.index=this.index}deserialize(a){super.deserialize(a),this.index=a.index}}let acu=(a=0)=>Xz(new act(a)),acv=XI(([a,b])=>ZV(1,a.oneMinus().div(b)).oneMinus()).setLayout({name:"blendBurn",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),acw=XI(([a,b])=>ZV(a.div(b.oneMinus()),1)).setLayout({name:"blendDodge",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),acx=XI(([a,b])=>a.oneMinus().mul(b.oneMinus()).oneMinus()).setLayout({name:"blendScreen",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),acy=XI(([a,b])=>Z8(a.mul(2).mul(b),a.oneMinus().mul(2).mul(b.oneMinus()).oneMinus(),ZX(.5,a))).setLayout({name:"blendOverlay",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),acz=XI(([a,b])=>{let c=b.a.add(a.a.mul(b.a.oneMinus()));return X$(b.rgb.mul(b.a).add(a.rgb.mul(a.a).mul(b.a.oneMinus())).div(c),c)}).setLayout({name:"blendColor",type:"vec4",inputs:[{name:"base",type:"vec4"},{name:"blend",type:"vec4"}]}),acA=XI(([a])=>X$(a.rgb.mul(a.a),a.a),{color:"vec4",return:"vec4"}),acB=XI(([a])=>(XL(a.a.equal(0),()=>X$(0)),X$(a.rgb.div(a.a),a.a)),{color:"vec4",return:"vec4"});class acC extends KK{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(a){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,Object.defineProperty(this,"shadowPositionNode",{get:()=>this.receivedShadowPositionNode,set:a=>{I0('NodeMaterial: ".shadowPositionNode" was renamed to ".receivedShadowPositionNode".'),this.receivedShadowPositionNode=a}})}_getNodeChildren(){let a=[];for(let b of Object.getOwnPropertyNames(this)){if(!0===b.startsWith("_"))continue;let c=this[b];c&&!0===c.isNode&&a.push({property:b,childNode:c})}return a}customProgramCacheKey(){let a=[];for(let{property:b,childNode:c}of this._getNodeChildren())a.push(WE(b.slice(0,-4)),c.getCacheKey());return this.type+WD(a)}build(a){this.setup(a)}setupObserver(a){return new WC(a)}setup(a){let b;a.context.setupNormal=()=>$u(this.setupNormal(a),"NORMAL","vec3"),a.context.setupPositionView=()=>this.setupPositionView(a),a.context.setupModelViewProjection=()=>this.setupModelViewProjection(a);let c=a.renderer,d=c.getRenderTarget();a.addStack();let e=$u(this.setupVertex(a),"VERTEX"),f=this.vertexNode||e;a.stack.outputNode=f,this.setupHardwareClipping(a),null!==this.geometryNode&&(a.stack.outputNode=a.stack.outputNode.bypass(this.geometryNode)),a.addFlow("vertex",a.removeStack()),a.addStack();let g=this.setupClipping(a);if((!0===this.depthWrite||!0===this.depthTest)&&(null!==d?!0===d.depthBuffer&&this.setupDepth(a):!0===c.depth&&this.setupDepth(a)),null===this.fragmentNode){this.setupDiffuseColor(a),this.setupVariants(a);let e=this.setupLighting(a);null!==g&&a.stack.addToStack(g);let f=X$(e,Ya.a).max(0);b=this.setupOutput(a,f),Ys.assign(b);let h=null!==this.outputNode;if(h&&(b=this.outputNode),null!==d){let a=c.getMRT(),d=this.mrtNode;null!==a?(h&&Ys.assign(b),b=a,null!==d&&(b=a.merge(d))):null!==d&&(b=d)}}else{let c=this.fragmentNode;!0!==c.isOutputStructNode&&(c=X$(c)),b=this.setupOutput(a,c)}a.stack.outputNode=b,a.addFlow("fragment",a.removeStack()),a.observer=this.setupObserver(a)}setupClipping(a){if(null===a.clippingContext)return null;let{unionPlanes:b,intersectionPlanes:c}=a.clippingContext,d=null;if(b.length>0||c.length>0){let b=a.renderer.currentSamples;this.alphaToCoverage&&b>1?d=Xz(new acp(acp.ALPHA_TO_COVERAGE)):a.stack.addToStack(Xz(new acp))}return d}setupHardwareClipping(a){if(this.hardwareClipping=!1,null===a.clippingContext)return;let b=a.clippingContext.unionPlanes.length;b>0&&b<=8&&a.isAvailable("clipDistance")&&(a.stack.addToStack(Xz(new acp(acp.HARDWARE))),this.hardwareClipping=!0)}setupDepth(a){let{renderer:b,camera:c}=a,d=this.depthNode;if(null===d){let a=b.getMRT();a&&a.has("depth")?d=a.get("depth"):!0===b.logarithmicDepthBuffer&&(d=c.isPerspectiveCamera?ack(_4.z,_x,_y):ach(_4.z,_x,_y))}null!==d&&acm.assign(d).toStack()}setupPositionView(){return _X.mul(_0).xyz}setupModelViewProjection(){return _z.mul(_4)}setupVertex(a){return a.addStack(),this.setupPosition(a),a.context.vertex=a.removeStack(),abJ}setupPosition(a){let{object:b,geometry:c}=a;if((c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color)&&ab5(b).toStack(),!0===b.isSkinnedMesh&&ab$(b).toStack(),this.displacementMap){let a=aaD("displacementMap","texture"),b=aaD("displacementScale","float"),c=aaD("displacementBias","float");_0.addAssign(aaa.normalize().mul(a.x.mul(b).add(c)))}return b.isBatchedMesh&&abU(b).toStack(),b.isInstancedMesh&&b.instanceMatrix&&!0===b.instanceMatrix.isInstancedBufferAttribute&&abT(b).toStack(),null!==this.positionNode&&_0.assign($u(this.positionNode,"POSITION","vec3")),_0}setupDiffuseColor(a){let{object:b,geometry:c}=a;null!==this.maskNode&&XR(this.maskNode).not().discard();let d=this.colorNode?X$(this.colorNode):aa8;!0===this.vertexColors&&c.hasAttribute("color")&&(d=d.mul(acu())),b.instanceColor&&(d=X9("vec3","vInstanceColor").mul(d)),b.isBatchedMesh&&b._colorsTexture&&(d=X9("vec3","vBatchColor").mul(d)),Ya.assign(d);let e=this.opacityNode?XO(this.opacityNode):abb;Ya.a.assign(Ya.a.mul(e));let f=null;(null!==this.alphaTestNode||this.alphaTest>0)&&(f=null!==this.alphaTestNode?XO(this.alphaTestNode):aa7,!0===this.alphaToCoverage?(Ya.a=$c(f,f.add(ZQ(Ya.a)),Ya.a),Ya.a.lessThanEqual(0).discard()):Ya.a.lessThanEqual(f).discard()),!0===this.alphaHash&&Ya.a.lessThan(acs(_0)).discard(),a.isOpaque()&&Ya.a.assign(1)}setupVariants(){}setupOutgoingLight(){return!0===this.lights?XW(0):Ya.rgb}setupNormal(){return this.normalNode?XW(this.normalNode):abj}setupEnvironment(){let a=null;return this.envNode?a=this.envNode:this.envMap&&(a=this.envMap.isCubeTexture?aaD("envMap","cubeTexture"):aaD("envMap","texture")),a}setupLightMap(a){let b=null;return a.material.lightMap&&(b=new ab9(abG)),b}setupLights(a){let b=[],c=this.setupEnvironment(a);c&&c.isLightingNode&&b.push(c);let d=this.setupLightMap(a);if(d&&d.isLightingNode&&b.push(d),null!==this.aoNode||a.material.aoMap){let a=null!==this.aoNode?this.aoNode:abH;b.push(new ab7(a))}let e=this.lightsNode||a.lightsNode;return b.length>0&&(e=a.renderer.lighting.createNode([...e.getLights(),...b])),e}setupLightingModel(){}setupLighting(a){let{material:b}=a,{backdropNode:c,backdropAlphaNode:d,emissiveNode:e}=this,f=!0===this.lights||null!==this.lightsNode?this.setupLights(a):null,g=this.setupOutgoingLight(a);return f&&f.getScope().hasLights?g=ab8(f,this.setupLightingModel(a)||null,c,d):null!==c&&(g=XW(null!==d?Z8(g,c,d):c)),(e&&!0===e.isNode||b.emissive&&!0===b.emissive.isColor)&&(Yb.assign(XW(e||aba)),g=g.add(Yb)),g}setupFog(a,b){let c=a.fogNode;return c&&(Ys.assign(b),b=X$(c.toVar())),b}setupPremultipliedAlpha(a,b){return acA(b)}setupOutput(a,b){return!0===this.fog&&(b=this.setupFog(a,b)),!0===this.premultipliedAlpha&&(b=this.setupPremultipliedAlpha(a,b)),b}setDefaultValues(a){for(let b in a){let c=a[b];void 0===this[b]&&(this[b]=c,c&&c.clone&&(this[b]=c.clone()))}let b=Object.getOwnPropertyDescriptors(a.constructor.prototype);for(let a in b)void 0===Object.getOwnPropertyDescriptor(this.constructor.prototype,a)&&void 0!==b[a].get&&Object.defineProperty(this.constructor.prototype,a,b[a])}toJSON(a){let b=void 0===a||"string"==typeof a;b&&(a={textures:{},images:{},nodes:{}});let c=KK.prototype.toJSON.call(this,a);for(let{property:b,childNode:d}of(c.inputNodes={},this._getNodeChildren()))c.inputNodes[b]=d.toJSON(a).uuid;function d(a){let b=[];for(let c in a){let d=a[c];delete d.metadata,b.push(d)}return b}if(b){let b=d(a.textures),e=d(a.images),f=d(a.nodes);b.length>0&&(c.textures=b),e.length>0&&(c.images=e),f.length>0&&(c.nodes=f)}return c}copy(a){return this.lightsNode=a.lightsNode,this.envNode=a.envNode,this.aoNode=a.aoNode,this.colorNode=a.colorNode,this.normalNode=a.normalNode,this.opacityNode=a.opacityNode,this.backdropNode=a.backdropNode,this.backdropAlphaNode=a.backdropAlphaNode,this.alphaTestNode=a.alphaTestNode,this.maskNode=a.maskNode,this.positionNode=a.positionNode,this.geometryNode=a.geometryNode,this.depthNode=a.depthNode,this.receivedShadowPositionNode=a.receivedShadowPositionNode,this.castShadowPositionNode=a.castShadowPositionNode,this.receivedShadowNode=a.receivedShadowNode,this.castShadowNode=a.castShadowNode,this.outputNode=a.outputNode,this.mrtNode=a.mrtNode,this.fragmentNode=a.fragmentNode,this.vertexNode=a.vertexNode,super.copy(a)}}let acD=null,acE=XD(class extends acb{static get type(){return"ViewportSharedTextureNode"}constructor(a=_o,b=null){null===acD&&(acD=new LH),super(a,b,acD)}getTextureForReference(){return acD}updateReference(){return this}}).setParameterLength(0,2),acF=XI(([a=_3])=>XS(a.z.atan(a.x).mul(1/(2*Math.PI)).add(.5),a.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5))),acG=XI(({f0:a,f90:b,dotVH:c})=>{let d=c.mul(-5.55473).sub(6.98316).mul(c).exp2();return a.mul(d.oneMinus()).add(b.mul(d))}),acH=XI(a=>a.diffuseColor.mul(1/Math.PI)),acI=XI(a=>{if(!1===a.geometry.hasAttribute("normal"))return XO(0);let b=aac.dFdx().abs().max(aac.dFdy().abs());return b.x.max(b.y).max(b.z)}),acJ=XI(a=>{let{roughness:b}=a,c=acI(),d=b.max(.0525);return(d=d.add(c)).min(1)}),acK=XI(({alpha:a,dotNL:b,dotNV:c})=>{let d=a.pow2(),e=b.mul(d.add(d.oneMinus().mul(c.pow2())).sqrt()),f=c.mul(d.add(d.oneMinus().mul(b.pow2())).sqrt());return YU(.5,e.add(f).max(Zg))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),acL=XI(({alphaT:a,alphaB:b,dotTV:c,dotBV:d,dotTL:e,dotBL:f,dotNV:g,dotNL:h})=>{let i=h.mul(XW(a.mul(c),b.mul(d),g).length()),j=g.mul(XW(a.mul(e),b.mul(f),h).length());return YU(.5,i.add(j)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),acM=XI(({alpha:a,dotNH:b})=>{let c=a.pow2(),d=b.pow2().mul(c.oneMinus()).oneMinus();return c.div(d.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),acN=XO(1/Math.PI),acO=XI(({alphaT:a,alphaB:b,dotNH:c,dotTH:d,dotBH:e})=>{let f=a.mul(b),g=XW(b.mul(d),a.mul(e),f.mul(c)),h=g.dot(g),i=f.div(h);return acN.mul(f.mul(i.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),acP=XI(({lightDirection:a,f0:b,f90:c,roughness:d,f:e,normalView:f=aae,USE_IRIDESCENCE:g,USE_ANISOTROPY:h})=>{let i=d.pow2(),j=a.add(_5).normalize(),k=f.dot(a).clamp(),l=f.dot(_5).clamp(),m=f.dot(j).clamp(),n=acG({f0:b,f90:c,dotVH:_5.dot(j).clamp()}),o,p;if(Xw(g)&&(n=Yi.mix(n,e)),Xw(h)){let b=Yn.dot(a),c=Yn.dot(_5),d=Yn.dot(j),e=Yo.dot(a),f=Yo.dot(_5),g=Yo.dot(j);o=acL({alphaT:Yl,alphaB:i,dotTV:c,dotBV:f,dotTL:b,dotBL:e,dotNV:l,dotNL:k}),p=acO({alphaT:Yl,alphaB:i,dotNH:m,dotTH:d,dotBH:g})}else o=acK({alpha:i,dotNL:k,dotNV:l}),p=acM({alpha:i,dotNH:m});return n.mul(o).mul(p)}),acQ=new Uint16Array([11481,15204,11534,15171,11808,15015,12385,14843,12894,14716,13396,14600,13693,14483,13976,14366,14237,14171,14405,13961,14511,13770,14605,13598,14687,13444,14760,13305,14822,13066,14876,12857,14923,12675,14963,12517,14997,12379,15025,12230,15049,12023,15070,11843,15086,11687,15100,11551,15111,11433,15120,11330,15127,11217,15132,11060,15135,10922,15138,10801,15139,10695,15139,10600,13012,14923,13020,14917,13064,14886,13176,14800,13349,14666,13513,14526,13724,14398,13960,14230,14200,14020,14383,13827,14488,13651,14583,13491,14667,13348,14740,13132,14803,12908,14856,12713,14901,12542,14938,12394,14968,12241,14992,12017,15010,11822,15024,11654,15034,11507,15041,11380,15044,11269,15044,11081,15042,10913,15037,10764,15031,10635,15023,10520,15014,10419,15003,10330,13657,14676,13658,14673,13670,14660,13698,14622,13750,14547,13834,14442,13956,14317,14112,14093,14291,13889,14407,13704,14499,13538,14586,13389,14664,13201,14733,12966,14792,12758,14842,12577,14882,12418,14915,12272,14940,12033,14959,11826,14972,11646,14980,11490,14983,11355,14983,11212,14979,11008,14971,10830,14961,10675,14950,10540,14936,10420,14923,10315,14909,10204,14894,10041,14089,14460,14090,14459,14096,14452,14112,14431,14141,14388,14186,14305,14252,14130,14341,13941,14399,13756,14467,13585,14539,13430,14610,13272,14677,13026,14737,12808,14790,12617,14833,12449,14869,12303,14896,12065,14916,11845,14929,11655,14937,11490,14939,11347,14936,11184,14930,10970,14921,10783,14912,10621,14900,10480,14885,10356,14867,10247,14848,10062,14827,9894,14805,9745,14400,14208,14400,14206,14402,14198,14406,14174,14415,14122,14427,14035,14444,13913,14469,13767,14504,13613,14548,13463,14598,13324,14651,13082,14704,12858,14752,12658,14795,12483,14831,12330,14860,12106,14881,11875,14895,11675,14903,11501,14905,11351,14903,11178,14900,10953,14892,10757,14880,10589,14865,10442,14847,10313,14827,10162,14805,9965,14782,9792,14757,9642,14731,9507,14562,13883,14562,13883,14563,13877,14566,13862,14570,13830,14576,13773,14584,13689,14595,13582,14613,13461,14637,13336,14668,13120,14704,12897,14741,12695,14776,12516,14808,12358,14835,12150,14856,11910,14870,11701,14878,11519,14882,11361,14884,11187,14880,10951,14871,10748,14858,10572,14842,10418,14823,10286,14801,10099,14777,9897,14751,9722,14725,9567,14696,9430,14666,9309,14702,13604,14702,13604,14702,13600,14703,13591,14705,13570,14707,13533,14709,13477,14712,13400,14718,13305,14727,13106,14743,12907,14762,12716,14784,12539,14807,12380,14827,12190,14844,11943,14855,11727,14863,11539,14870,11376,14871,11204,14868,10960,14858,10748,14845,10565,14829,10406,14809,10269,14786,10058,14761,9852,14734,9671,14705,9512,14674,9374,14641,9253,14608,9076,14821,13366,14821,13365,14821,13364,14821,13358,14821,13344,14821,13320,14819,13252,14817,13145,14815,13011,14814,12858,14817,12698,14823,12539,14832,12389,14841,12214,14850,11968,14856,11750,14861,11558,14866,11390,14867,11226,14862,10972,14853,10754,14840,10565,14823,10401,14803,10259,14780,10032,14754,9820,14725,9635,14694,9473,14661,9333,14627,9203,14593,8988,14557,8798,14923,13014,14922,13014,14922,13012,14922,13004,14920,12987,14919,12957,14915,12907,14909,12834,14902,12738,14894,12623,14888,12498,14883,12370,14880,12203,14878,11970,14875,11759,14873,11569,14874,11401,14872,11243,14865,10986,14855,10762,14842,10568,14825,10401,14804,10255,14781,10017,14754,9799,14725,9611,14692,9445,14658,9301,14623,9139,14587,8920,14548,8729,14509,8562,15008,12672,15008,12672,15008,12671,15007,12667,15005,12656,15001,12637,14997,12605,14989,12556,14978,12490,14966,12407,14953,12313,14940,12136,14927,11934,14914,11742,14903,11563,14896,11401,14889,11247,14879,10992,14866,10767,14851,10570,14833,10400,14812,10252,14789,10007,14761,9784,14731,9592,14698,9424,14663,9279,14627,9088,14588,8868,14548,8676,14508,8508,14467,8360,15080,12386,15080,12386,15079,12385,15078,12383,15076,12378,15072,12367,15066,12347,15057,12315,15045,12253,15030,12138,15012,11998,14993,11845,14972,11685,14951,11530,14935,11383,14920,11228,14904,10981,14887,10762,14870,10567,14850,10397,14827,10248,14803,9997,14774,9771,14743,9578,14710,9407,14674,9259,14637,9048,14596,8826,14555,8632,14514,8464,14471,8317,14427,8182,15139,12008,15139,12008,15138,12008,15137,12007,15135,12003,15130,11990,15124,11969,15115,11929,15102,11872,15086,11794,15064,11693,15041,11581,15013,11459,14987,11336,14966,11170,14944,10944,14921,10738,14898,10552,14875,10387,14850,10239,14824,9983,14794,9758,14762,9563,14728,9392,14692,9244,14653,9014,14611,8791,14569,8597,14526,8427,14481,8281,14436,8110,14391,7885,15188,11617,15188,11617,15187,11617,15186,11618,15183,11617,15179,11612,15173,11601,15163,11581,15150,11546,15133,11495,15110,11427,15083,11346,15051,11246,15024,11057,14996,10868,14967,10687,14938,10517,14911,10362,14882,10206,14853,9956,14821,9737,14787,9543,14752,9375,14715,9228,14675,8980,14632,8760,14589,8565,14544,8395,14498,8248,14451,8049,14404,7824,14357,7630,15228,11298,15228,11298,15227,11299,15226,11301,15223,11303,15219,11302,15213,11299,15204,11290,15191,11271,15174,11217,15150,11129,15119,11015,15087,10886,15057,10744,15024,10599,14990,10455,14957,10318,14924,10143,14891,9911,14856,9701,14820,9516,14782,9352,14744,9200,14703,8946,14659,8725,14615,8533,14568,8366,14521,8220,14472,7992,14423,7770,14374,7578,14315,7408,15260,10819,15260,10819,15259,10822,15258,10826,15256,10832,15251,10836,15246,10841,15237,10838,15225,10821,15207,10788,15183,10734,15151,10660,15120,10571,15087,10469,15049,10359,15012,10249,14974,10041,14937,9837,14900,9647,14860,9475,14820,9320,14779,9147,14736,8902,14691,8688,14646,8499,14598,8335,14549,8189,14499,7940,14448,7720,14397,7529,14347,7363,14256,7218,15285,10410,15285,10411,15285,10413,15284,10418,15282,10425,15278,10434,15272,10442,15264,10449,15252,10445,15235,10433,15210,10403,15179,10358,15149,10301,15113,10218,15073,10059,15033,9894,14991,9726,14951,9565,14909,9413,14865,9273,14822,9073,14777,8845,14730,8641,14682,8459,14633,8300,14583,8129,14531,7883,14479,7670,14426,7482,14373,7321,14305,7176,14201,6939,15305,9939,15305,9940,15305,9945,15304,9955,15302,9967,15298,9989,15293,10010,15286,10033,15274,10044,15258,10045,15233,10022,15205,9975,15174,9903,15136,9808,15095,9697,15053,9578,15009,9451,14965,9327,14918,9198,14871,8973,14825,8766,14775,8579,14725,8408,14675,8259,14622,8058,14569,7821,14515,7615,14460,7435,14405,7276,14350,7108,14256,6866,14149,6653,15321,9444,15321,9445,15321,9448,15320,9458,15317,9470,15314,9490,15310,9515,15302,9540,15292,9562,15276,9579,15251,9577,15226,9559,15195,9519,15156,9463,15116,9389,15071,9304,15025,9208,14978,9023,14927,8838,14878,8661,14827,8496,14774,8344,14722,8206,14667,7973,14612,7749,14556,7555,14499,7382,14443,7229,14385,7025,14322,6791,14210,6588,14100,6409,15333,8920,15333,8921,15332,8927,15332,8943,15329,8965,15326,9002,15322,9048,15316,9106,15307,9162,15291,9204,15267,9221,15244,9221,15212,9196,15175,9134,15133,9043,15088,8930,15040,8801,14990,8665,14938,8526,14886,8391,14830,8261,14775,8087,14719,7866,14661,7664,14603,7482,14544,7322,14485,7178,14426,6936,14367,6713,14281,6517,14166,6348,14054,6198,15341,8360,15341,8361,15341,8366,15341,8379,15339,8399,15336,8431,15332,8473,15326,8527,15318,8585,15302,8632,15281,8670,15258,8690,15227,8690,15191,8664,15149,8612,15104,8543,15055,8456,15001,8360,14948,8259,14892,8122,14834,7923,14776,7734,14716,7558,14656,7397,14595,7250,14534,7070,14472,6835,14410,6628,14350,6443,14243,6283,14125,6135,14010,5889,15348,7715,15348,7717,15348,7725,15347,7745,15345,7780,15343,7836,15339,7905,15334,8e3,15326,8103,15310,8193,15293,8239,15270,8270,15240,8287,15204,8283,15163,8260,15118,8223,15067,8143,15014,8014,14958,7873,14899,7723,14839,7573,14778,7430,14715,7293,14652,7164,14588,6931,14524,6720,14460,6531,14396,6362,14330,6210,14207,6015,14086,5781,13969,5576,15352,7114,15352,7116,15352,7128,15352,7159,15350,7195,15348,7237,15345,7299,15340,7374,15332,7457,15317,7544,15301,7633,15280,7703,15251,7754,15216,7775,15176,7767,15131,7733,15079,7670,15026,7588,14967,7492,14906,7387,14844,7278,14779,7171,14714,6965,14648,6770,14581,6587,14515,6420,14448,6269,14382,6123,14299,5881,14172,5665,14049,5477,13929,5310,15355,6329,15355,6330,15355,6339,15355,6362,15353,6410,15351,6472,15349,6572,15344,6688,15337,6835,15323,6985,15309,7142,15287,7220,15260,7277,15226,7310,15188,7326,15142,7318,15090,7285,15036,7239,14976,7177,14914,7045,14849,6892,14782,6736,14714,6581,14645,6433,14576,6293,14506,6164,14438,5946,14369,5733,14270,5540,14140,5369,14014,5216,13892,5043,15357,5483,15357,5484,15357,5496,15357,5528,15356,5597,15354,5692,15351,5835,15347,6011,15339,6195,15328,6317,15314,6446,15293,6566,15268,6668,15235,6746,15197,6796,15152,6811,15101,6790,15046,6748,14985,6673,14921,6583,14854,6479,14785,6371,14714,6259,14643,6149,14571,5946,14499,5750,14428,5567,14358,5401,14242,5250,14109,5111,13980,4870,13856,4657,15359,4555,15359,4557,15358,4573,15358,4633,15357,4715,15355,4841,15353,5061,15349,5216,15342,5391,15331,5577,15318,5770,15299,5967,15274,6150,15243,6223,15206,6280,15161,6310,15111,6317,15055,6300,14994,6262,14928,6208,14860,6141,14788,5994,14715,5838,14641,5684,14566,5529,14492,5384,14418,5247,14346,5121,14216,4892,14079,4682,13948,4496,13822,4330,15359,3498,15359,3501,15359,3520,15359,3598,15358,3719,15356,3860,15355,4137,15351,4305,15344,4563,15334,4809,15321,5116,15303,5273,15280,5418,15250,5547,15214,5653,15170,5722,15120,5761,15064,5763,15002,5733,14935,5673,14865,5597,14792,5504,14716,5400,14640,5294,14563,5185,14486,5041,14410,4841,14335,4655,14191,4482,14051,4325,13918,4183,13790,4012,15360,2282,15360,2285,15360,2306,15360,2401,15359,2547,15357,2748,15355,3103,15352,3349,15345,3675,15336,4020,15324,4272,15307,4496,15285,4716,15255,4908,15220,5086,15178,5170,15128,5214,15072,5234,15010,5231,14943,5206,14871,5166,14796,5102,14718,4971,14639,4833,14559,4687,14480,4541,14402,4401,14315,4268,14167,4142,14025,3958,13888,3747,13759,3556,15360,923,15360,925,15360,946,15360,1052,15359,1214,15357,1494,15356,1892,15352,2274,15346,2663,15338,3099,15326,3393,15309,3679,15288,3980,15260,4183,15226,4325,15185,4437,15136,4517,15080,4570,15018,4591,14950,4581,14877,4545,14800,4485,14720,4411,14638,4325,14556,4231,14475,4136,14395,3988,14297,3803,14145,3628,13999,3465,13861,3314,13729,3177,15360,263,15360,264,15360,272,15360,325,15359,407,15358,548,15356,780,15352,1144,15347,1580,15339,2099,15328,2425,15312,2795,15292,3133,15264,3329,15232,3517,15191,3689,15143,3819,15088,3923,15025,3978,14956,3999,14882,3979,14804,3931,14722,3855,14639,3756,14554,3645,14470,3529,14388,3409,14279,3289,14124,3173,13975,3055,13834,2848,13701,2658,15360,49,15360,49,15360,52,15360,75,15359,111,15358,201,15356,283,15353,519,15348,726,15340,1045,15329,1415,15314,1795,15295,2173,15269,2410,15237,2649,15197,2866,15150,3054,15095,3140,15032,3196,14963,3228,14888,3236,14808,3224,14725,3191,14639,3146,14553,3088,14466,2976,14382,2836,14262,2692,14103,2549,13952,2409,13808,2278,13674,2154,15360,4,15360,4,15360,4,15360,13,15359,33,15358,59,15357,112,15353,199,15348,302,15341,456,15331,628,15316,827,15297,1082,15272,1332,15241,1601,15202,1851,15156,2069,15101,2172,15039,2256,14970,2314,14894,2348,14813,2358,14728,2344,14640,2311,14551,2263,14463,2203,14376,2133,14247,2059,14084,1915,13930,1761,13784,1609,13648,1464,15360,0,15360,0,15360,0,15360,3,15359,18,15358,26,15357,53,15354,80,15348,97,15341,165,15332,238,15318,326,15299,427,15275,529,15245,654,15207,771,15161,885,15108,994,15046,1089,14976,1170,14900,1229,14817,1266,14731,1284,14641,1282,14550,1260,14460,1223,14370,1174,14232,1116,14066,1050,13909,981,13761,910,13623,839]),acR=null,acS=XI(({roughness:a,dotNV:b})=>{null===acR&&((acR=new Lx(acQ,32,32,1030,1016)).minFilter=1006,acR.magFilter=1006,acR.wrapS=1001,acR.wrapT=1001,acR.generateMipmaps=!1,acR.needsUpdate=!0);let c=XS(a,b);return _e(acR,c).rg}),acT=XI(({f:a,f90:b,dotVH:c})=>{let d=c.oneMinus().saturate(),e=d.mul(d),f=d.mul(e,e).clamp(0,.9999);return a.sub(XW(b).mul(f)).div(f.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),acU=1/6,acV=a=>YT(acU,YT(a,YT(a,a.negate().add(3)).sub(3)).add(1)),acW=a=>YT(acU,YT(a,YT(a,YT(3,a).sub(6))).add(4)),acX=a=>YT(acU,YT(a,YT(a,YT(-3,a).add(3)).add(3)).add(1)),acY=a=>YT(acU,Z1(a,3)),acZ=a=>acV(a).add(acW(a)),ac$=a=>acX(a).add(acY(a)),ac_=a=>YR(-1,acW(a).div(acV(a).add(acW(a)))),ac0=a=>YR(1,acY(a).div(acX(a).add(acY(a)))),ac1=(a,b,c)=>{let d=YT(a.uvNode,b.zw).add(.5),e=Zw(d),f=Zz(d),g=acZ(f.x),h=ac$(f.x),i=ac_(f.x),j=ac0(f.x),k=ac_(f.y),l=ac0(f.y),m=XS(e.x.add(i),e.y.add(k)).sub(.5).mul(b.xy),n=XS(e.x.add(j),e.y.add(k)).sub(.5).mul(b.xy),o=XS(e.x.add(i),e.y.add(l)).sub(.5).mul(b.xy),p=XS(e.x.add(j),e.y.add(l)).sub(.5).mul(b.xy),q=acZ(f.y).mul(YR(g.mul(a.sample(m).level(c)),h.mul(a.sample(n).level(c)))),r=ac$(f.y).mul(YR(g.mul(a.sample(o).level(c)),h.mul(a.sample(p).level(c))));return q.add(r)},ac2=XI(([a,b])=>{let c=XS(a.size(XP(b))),d=XS(a.size(XP(b.add(1)))),e=YU(1,c),f=YU(1,d),g=ac1(a,X$(e,c),Zw(b)),h=ac1(a,X$(f,d),Zx(b));return Zz(b).mix(g,h)}),ac3=XI(([a,b])=>{let c=b.mul(_a(a));return ac2(a,c)});XW(.04),XO(1);let ac4=XO(1),ac5=XO(-2),ac6=XO(.8),ac7=XO(-1),ac8=XO(.4),ac9=XO(2),ada=XO(.305),adb=XO(3),adc=XO(.21),add=XO(4),ade=XO(4),adf=XO(16),adg=XI(([a])=>{let b=XW(ZG(a)).toVar(),c=XO(-1).toVar();return XL(b.x.greaterThan(b.z),()=>{XL(b.x.greaterThan(b.y),()=>{c.assign($j(a.x.greaterThan(0),0,3))}).Else(()=>{c.assign($j(a.y.greaterThan(0),1,4))})}).Else(()=>{XL(b.z.greaterThan(b.y),()=>{c.assign($j(a.z.greaterThan(0),2,5))}).Else(()=>{c.assign($j(a.y.greaterThan(0),1,4))})}),c}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),adh=XI(([a,b])=>{let c=XS().toVar();return XL(b.equal(0),()=>{c.assign(XS(a.z,a.y).div(ZG(a.x)))}).ElseIf(b.equal(1),()=>{c.assign(XS(a.x.negate(),a.z.negate()).div(ZG(a.y)))}).ElseIf(b.equal(2),()=>{c.assign(XS(a.x.negate(),a.y).div(ZG(a.z)))}).ElseIf(b.equal(3),()=>{c.assign(XS(a.z.negate(),a.y).div(ZG(a.x)))}).ElseIf(b.equal(4),()=>{c.assign(XS(a.x.negate(),a.z).div(ZG(a.y)))}).Else(()=>{c.assign(XS(a.x,a.y).div(ZG(a.z)))}),YT(.5,c.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),adi=XI(([a])=>{let b=XO(0).toVar();return XL(a.greaterThanEqual(ac6),()=>{b.assign(ac4.sub(a).mul(ac7.sub(ac5)).div(ac4.sub(ac6)).add(ac5))}).ElseIf(a.greaterThanEqual(ac8),()=>{b.assign(ac6.sub(a).mul(ac9.sub(ac7)).div(ac6.sub(ac8)).add(ac7))}).ElseIf(a.greaterThanEqual(ada),()=>{b.assign(ac8.sub(a).mul(adb.sub(ac9)).div(ac8.sub(ada)).add(ac9))}).ElseIf(a.greaterThanEqual(adc),()=>{b.assign(ada.sub(a).mul(add.sub(adb)).div(ada.sub(adc)).add(adb))}).Else(()=>{b.assign(XO(-2).mul(Zt(YT(1.16,a))))}),b}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),adj=XI(([a,b])=>{let c=a.toVar();c.assign(YT(2,c).sub(1));let d=XW(c,1).toVar();return XL(b.equal(0),()=>{d.assign(d.zyx)}).ElseIf(b.equal(1),()=>{d.assign(d.xzy),d.xz.mulAssign(-1)}).ElseIf(b.equal(2),()=>{d.x.mulAssign(-1)}).ElseIf(b.equal(3),()=>{d.assign(d.zyx),d.xz.mulAssign(-1)}).ElseIf(b.equal(4),()=>{d.assign(d.xzy),d.xy.mulAssign(-1)}).ElseIf(b.equal(5),()=>{d.z.mulAssign(-1)}),d}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),adk=XI(([a,b,c,d,e,f])=>{let g=XO(c),h=XW(b),i=Z9(adi(g),ac5,f),j=Zz(i),k=Zw(i),l=XW(adl(a,h,k,d,e,f)).toVar();return XL(j.notEqual(0),()=>{let b=XW(adl(a,h,k.add(1),d,e,f)).toVar();l.assign(Z8(l,b,j))}),l}),adl=XI(([a,b,c,d,e,f])=>{let g=XO(c).toVar(),h=XW(b),i=XO(adg(h)).toVar(),j=XO(ZW(ade.sub(g),0)).toVar();g.assign(ZW(g,ade));let k=XO(Zr(g)).toVar(),l=XS(adh(h,i).mul(k.sub(2)).add(1)).toVar();return XL(i.greaterThan(2),()=>{l.y.addAssign(k),i.subAssign(3)}),l.x.addAssign(i.mul(k)),l.x.addAssign(j.mul(YT(3,adf))),l.y.addAssign(YT(4,Zr(f).sub(k))),l.x.mulAssign(d),l.y.mulAssign(e),a.sample(l).grad(XS(),XS())}),adm=XI(({envMap:a,mipInt:b,outputDirection:c,theta:d,axis:e,CUBEUV_TEXEL_WIDTH:f,CUBEUV_TEXEL_HEIGHT:g,CUBEUV_MAX_MIP:h})=>{let i=ZB(d);return adl(a,c.mul(i).add(e.cross(c).mul(ZA(d))).add(e.mul(e.dot(c).mul(i.oneMinus()))),b,f,g,h)}),adn=XI(({n:a,latitudinal:b,poleAxis:c,outputDirection:d,weights:e,samples:f,dTheta:g,mipInt:h,envMap:i,CUBEUV_TEXEL_WIDTH:j,CUBEUV_TEXEL_HEIGHT:k,CUBEUV_MAX_MIP:l})=>{let m=XW($j(b,c,Z0(c,d))).toVar();XL(m.equal(XW(0)),()=>{m.assign(XW(d.z,0,d.x.negate()))}),m.assign(Zy(m));let n=XW().toVar();return n.addAssign(e.element(0).mul(adm({theta:0,axis:m,outputDirection:d,mipInt:h,envMap:i,CUBEUV_TEXEL_WIDTH:j,CUBEUV_TEXEL_HEIGHT:k,CUBEUV_MAX_MIP:l}))),ab0({start:XP(1),end:a},({i:a})=>{XL(a.greaterThanEqual(f),()=>{ab1()});let b=XO(g.mul(XO(a))).toVar();n.addAssign(e.element(a).mul(adm({theta:b.mul(-1),axis:m,outputDirection:d,mipInt:h,envMap:i,CUBEUV_TEXEL_WIDTH:j,CUBEUV_TEXEL_HEIGHT:k,CUBEUV_MAX_MIP:l}))),n.addAssign(e.element(a).mul(adm({theta:b,axis:m,outputDirection:d,mipInt:h,envMap:i,CUBEUV_TEXEL_WIDTH:j,CUBEUV_TEXEL_HEIGHT:k,CUBEUV_MAX_MIP:l})))}),X$(n,1)}),ado=XI(([a])=>{let b=XQ(a).toVar();return b.assign(b.shiftLeft(XQ(16)).bitOr(b.shiftRight(XQ(16)))),b.assign(b.bitAnd(XQ(0x55555555)).shiftLeft(XQ(1)).bitOr(b.bitAnd(XQ(0xaaaaaaaa)).shiftRight(XQ(1)))),b.assign(b.bitAnd(XQ(0x33333333)).shiftLeft(XQ(2)).bitOr(b.bitAnd(XQ(0xcccccccc)).shiftRight(XQ(2)))),b.assign(b.bitAnd(XQ(0xf0f0f0f)).shiftLeft(XQ(4)).bitOr(b.bitAnd(XQ(0xf0f0f0f0)).shiftRight(XQ(4)))),b.assign(b.bitAnd(XQ(0xff00ff)).shiftLeft(XQ(8)).bitOr(b.bitAnd(XQ(0xff00ff00)).shiftRight(XQ(8)))),XO(b).mul(23283064365386963e-26)}),adp=XI(([a,b])=>XS(XO(a).div(XO(b)),ado(a))),adq=XI(([a,b,c])=>{let d=XW(b).toVar(),e=XO(c),f=e.mul(e).toVar(),g=Zy(XW(f.mul(d.x),f.mul(d.y),d.z)).toVar(),h=g.x.mul(g.x).add(g.y.mul(g.y)),i=$j(h.greaterThan(0),XW(g.y.negate(),g.x,0).div(Zu(h)),XW(1,0,0)).toVar(),j=Z0(g,i).toVar(),k=Zu(a.x),l=YT(2,3.14159265359).mul(a.y),m=k.mul(ZB(l)).toVar(),n=k.mul(ZA(l)).toVar(),o=YT(.5,g.z.add(1));n.assign(o.oneMinus().mul(Zu(m.mul(m).oneMinus())).add(o.mul(n)));let p=i.mul(m).add(j.mul(n)).add(g.mul(Zu(ZW(0,m.mul(m).add(n.mul(n)).oneMinus()))));return Zy(XW(f.mul(p.x),f.mul(p.y),ZW(0,p.z)))}),adr=XI(({roughness:a,mipInt:b,envMap:c,N_immutable:d,GGX_SAMPLES:e,CUBEUV_TEXEL_WIDTH:f,CUBEUV_TEXEL_HEIGHT:g,CUBEUV_MAX_MIP:h})=>{let i=XW(d).toVar(),j=XW(0).toVar(),k=XO(0).toVar();return XL(a.lessThan(.001),()=>{j.assign(adl(c,i,b,f,g,h))}).Else(()=>{let d=Zy(Z0($j(ZG(i.z).lessThan(.999),XW(0,0,1),XW(1,0,0)),i)).toVar(),l=Z0(i,d).toVar();ab0({start:XQ(0),end:e},({i:m})=>{let n=adq(adp(m,e),XW(0,0,1),a),o=Zy(d.mul(n.x).add(l.mul(n.y)).add(i.mul(n.z))),p=Zy(o.mul(Z_(i,o).mul(2)).sub(i)),q=ZW(Z_(i,p),0);XL(q.greaterThan(0),()=>{let a=adl(c,p,b,f,g,h);j.addAssign(a.mul(q)),k.addAssign(q)})}),XL(k.greaterThan(0),()=>{j.assign(j.div(k))})}),X$(j,1)}),ads=[.125,.215,.35,.446,.526,.582],adt=new LN(-1,1,1,-1,0,1),adu=new Ln(90,1),adv=new KH,adw=null,adx=0,ady=0,adz=new Je,adA=new WeakMap,adB=[3,1,5,0,4,2],adC=adj($8(),$7("faceIndex")).normalize(),adD=XW(adC.x,adC.y,adC.z);class adE{constructor(a){this._renderer=a,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._ggxMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(a,b=0,c=.1,d=100,e={}){let{size:f=256,position:g=adz,renderTarget:h=null}=e;if(this._setSize(f),!1===this._hasInitialized){I0('PMREMGenerator: ".fromScene()" called before the backend is initialized. Try using "await renderer.init()" instead.');let f=h||this._allocateTarget();return e.renderTarget=f,this.fromSceneAsync(a,b,c,d,e),f}adw=this._renderer.getRenderTarget(),adx=this._renderer.getActiveCubeFace(),ady=this._renderer.getActiveMipmapLevel();let i=h||this._allocateTarget();return i.depthBuffer=!0,this._init(i),this._sceneToCubeUV(a,c,d,i,g),b>0&&this._blur(i,0,0,b),this._applyPMREM(i),this._cleanup(i),i}async fromSceneAsync(a,b=0,c=.1,d=100,e={}){return I2('PMREMGenerator: ".fromSceneAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this.fromScene(a,b,c,d,e)}fromEquirectangular(a,b=null){if(!1===this._hasInitialized){I0('PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using "await renderer.init()" instead.'),this._setSizeFromTexture(a);let c=b||this._allocateTarget();return this.fromEquirectangularAsync(a,c),c}return this._fromTexture(a,b)}async fromEquirectangularAsync(a,b=null){return I2('PMREMGenerator: ".fromEquirectangularAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(a,b)}fromCubemap(a,b=null){if(!1===this._hasInitialized){I0("PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(a);let c=b||this._allocateTarget();return this.fromCubemapAsync(a,b),c}return this._fromTexture(a,b)}async fromCubemapAsync(a,b=null){return I2('PMREMGenerator: ".fromCubemapAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(a,b)}async compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=adI(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=adJ(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose(),null!==this._backgroundBox&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(a){301===a.mapping||302===a.mapping?this._setSize(0===a.image.length?16:a.image[0].width||a.image[0].image.width):this._setSize(a.image.width/4)}_setSize(a){this._lodMax=Math.floor(Math.log2(a)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._ggxMaterial&&this._ggxMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let a=0;a<this._lodMeshes.length;a++)this._lodMeshes[a].geometry.dispose()}_cleanup(a){this._renderer.setRenderTarget(adw,adx,ady),a.scissorTest=!1,adG(a,0,0,a.width,a.height)}_fromTexture(a,b){this._setSizeFromTexture(a),adw=this._renderer.getRenderTarget(),adx=this._renderer.getActiveCubeFace(),ady=this._renderer.getActiveMipmapLevel();let c=b||this._allocateTarget();return this._init(c),this._textureToCubeUV(a,c),this._applyPMREM(c),this._cleanup(c),c}_allocateTarget(){return adF(3*Math.max(this._cubeSize,112),4*this._cubeSize)}_init(a){if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==a.width||this._pingPongRenderTarget.height!==a.height){var b,c,d;let e,f,g,h,i,j,k;null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=adF(a.width,a.height);let{_lodMax:l}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=function(a){let b=[],c=[],d=[],e=a,f=a-4+1+ads.length;for(let g=0;g<f;g++){let f=Math.pow(2,e);b.push(f);let h=1/f;g>a-4?h=ads[g-a+4-1]:0===g&&(h=0),c.push(h);let i=1/(f-2),j=-i,k=1+i,l=[j,j,k,j,k,k,j,j,k,k,j,k],m=new Float32Array(108),n=new Float32Array(72),o=new Float32Array(36);for(let a=0;a<6;a++){let b=a%3*2/3-1,c=a>2?0:-1,d=[b,c,0,b+2/3,c,0,b+2/3,c+1,0,b,c,0,b+2/3,c+1,0,b,c+1,0],e=adB[a];m.set(d,18*e),n.set(l,12*e);let f=[e,e,e,e,e,e];o.set(f,6*e)}let p=new K$;p.setAttribute("position",new KP(m,3)),p.setAttribute("uv",new KP(n,2)),p.setAttribute("faceIndex",new KP(o,1)),d.push(new La(p,null)),e>4&&e--}return{lodMeshes:d,sizeLods:b,sigmas:c}}(l)),this._blurMaterial=(b=l,c=a.width,d=a.height,e=_k(Array(20).fill(0)),f=YJ(new Je(0,1,0)),g=YJ(0),h=XO(20),j={n:h,latitudinal:i=YJ(0),weights:e,poleAxis:f,outputDirection:adD,dTheta:g,samples:YJ(1),envMap:_e(),mipInt:YJ(0),CUBEUV_TEXEL_WIDTH:XO(1/c),CUBEUV_TEXEL_HEIGHT:XO(1/d),CUBEUV_MAX_MIP:XO(b)},(k=adH("blur")).fragmentNode=adn({...j,latitudinal:i.equal(1)}),adA.set(k,j),k)}}async _compileMaterial(a){let b=new La(new K$,a);await this._renderer.compile(b,adt)}_sceneToCubeUV(a,b,c,d,e){adu.near=b,adu.far=c;let f=[1,1,1,1,-1,1],g=[1,-1,1,-1,1,-1],h=this._renderer,i=h.autoClear;h.getClearColor(adv),h.autoClear=!1,null===this._backgroundBox&&(this._backgroundBox=new La(new Lc,new KL({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1})));let j=this._backgroundBox,k=j.material,l=!1,m=a.background;m?m.isColor&&(k.color.copy(m),a.background=null,l=!0):(k.color.copy(adv),l=!0),h.setRenderTarget(d),h.clear(),l&&h.render(j,adu);for(let b=0;b<6;b++){let c=b%3;0===c?(adu.up.set(0,f[b],0),adu.position.set(e.x,e.y,e.z),adu.lookAt(e.x+g[b],e.y,e.z)):1===c?(adu.up.set(0,0,f[b]),adu.position.set(e.x,e.y,e.z),adu.lookAt(e.x,e.y+g[b],e.z)):(adu.up.set(0,f[b],0),adu.position.set(e.x,e.y,e.z),adu.lookAt(e.x,e.y,e.z+g[b]));let i=this._cubeSize;adG(d,c*i,b>2?i:0,i,i),h.render(a,adu)}h.autoClear=i,a.background=m}_textureToCubeUV(a,b){let c=this._renderer,d=301===a.mapping||302===a.mapping;d?null===this._cubemapMaterial&&(this._cubemapMaterial=adI(a)):null===this._equirectMaterial&&(this._equirectMaterial=adJ(a));let e=d?this._cubemapMaterial:this._equirectMaterial;e.fragmentNode.value=a;let f=this._lodMeshes[0];f.material=e;let g=this._cubeSize;adG(b,0,0,3*g,2*g),c.setRenderTarget(b),c.render(f,adt)}_applyPMREM(a){let b=this._renderer,c=b.autoClear;b.autoClear=!1;let d=this._lodMeshes.length;for(let b=1;b<d;b++)this._applyGGXFilter(a,b-1,b);b.autoClear=c}_applyGGXFilter(a,b,c){var d,e,f;let g,h,i=this._renderer,j=this._pingPongRenderTarget;null===this._ggxMaterial&&(this._ggxMaterial=(d=this._lodMax,e=this._pingPongRenderTarget.width,f=this._pingPongRenderTarget.height,g={envMap:_e(),roughness:YJ(0),mipInt:YJ(0),CUBEUV_TEXEL_WIDTH:XO(1/e),CUBEUV_TEXEL_HEIGHT:XO(1/f),CUBEUV_MAX_MIP:XO(d)},(h=adH("ggx")).fragmentNode=adr({...g,N_immutable:adD,GGX_SAMPLES:XQ(512)}),adA.set(h,g),h));let k=this._ggxMaterial,l=this._lodMeshes[c];l.material=k;let m=adA.get(k),n=c/(this._lodMeshes.length-1),o=b/(this._lodMeshes.length-1),p=Math.sqrt(n*n-o*o),{_lodMax:q}=this,r=this._sizeLods[c],s=3*r*(c>q-4?c-q+4:0),t=4*(this._cubeSize-r);a.texture.frame=(a.texture.frame||0)+1,m.envMap.value=a.texture,m.roughness.value=p*(.05+.95*n),m.mipInt.value=q-b,adG(j,s,t,3*r,2*r),i.setRenderTarget(j),i.render(l,adt),j.texture.frame=(j.texture.frame||0)+1,m.envMap.value=j.texture,m.roughness.value=0,m.mipInt.value=q-c,adG(a,s,t,3*r,2*r),i.setRenderTarget(a),i.render(l,adt)}_blur(a,b,c,d,e){let f=this._pingPongRenderTarget;this._halfBlur(a,f,b,c,d,"latitudinal",e),this._halfBlur(f,a,c,c,d,"longitudinal",e)}_halfBlur(a,b,c,d,e,f,g){let h=this._renderer,i=this._blurMaterial;"latitudinal"!==f&&"longitudinal"!==f&&I1("blur direction must be either latitudinal or longitudinal!");let j=this._lodMeshes[d];j.material=i;let k=adA.get(i),l=this._sizeLods[c]-1,m=isFinite(e)?Math.PI/(2*l):2*Math.PI/39,n=e/m,o=isFinite(e)?1+Math.floor(3*n):20;o>20&&I0(`sigmaRadians, ${e}, is too large and will clip, as it requested ${o} samples when the maximum is set to 20`);let p=[],q=0;for(let a=0;a<20;++a){let b=a/n,c=Math.exp(-b*b/2);p.push(c),0===a?q+=c:a<o&&(q+=2*c)}for(let a=0;a<p.length;a++)p[a]=p[a]/q;a.texture.frame=(a.texture.frame||0)+1,k.envMap.value=a.texture,k.samples.value=o,k.weights.array=p,k.latitudinal.value=+("latitudinal"===f),g&&(k.poleAxis.value=g);let{_lodMax:r}=this;k.dTheta.value=m,k.mipInt.value=r-c;let s=this._sizeLods[d],t=4*(this._cubeSize-s);adG(b,3*s*(d>r-4?d-r+4:0),t,3*s,2*s),h.setRenderTarget(b),h.render(j,adt)}}function adF(a,b){let c=new Jw(a,b,{magFilter:1006,minFilter:1006,generateMipmaps:!1,type:1016,format:1023,colorSpace:IU});return c.texture.mapping=306,c.texture.name="PMREM.cubeUv",c.texture.isPMREMTexture=!0,c.scissorTest=!0,c}function adG(a,b,c,d,e){a.viewport.set(b,c,d,e),a.scissor.set(b,c,d,e)}function adH(a){let b=new acC;return b.depthTest=!1,b.depthWrite=!1,b.blending=0,b.name=`PMREM_${a}`,b}function adI(a){let b=adH("cubemap");return b.fragmentNode=aax(a,adD),b}function adJ(a){let b=adH("equirect");return b.fragmentNode=_e(a,acF(adD),0),b}let adK=new WeakMap,adL=XD(class extends WZ{static get type(){return"PMREMNode"}constructor(a,b=null,c=null){super("vec3"),this._value=a,this._pmrem=null,this.uvNode=b,this.levelNode=c,this._generator=null;const d=new Ju;d.isRenderTargetTexture=!0,this._texture=_e(d),this._width=YJ(0),this._height=YJ(0),this._maxMip=YJ(0),this.updateBeforeType=WP.RENDER}set value(a){this._value=a,this._pmrem=null}get value(){return this._value}updateFromTexture(a){var b;let c,d={texelWidth:1/(3*Math.max(Math.pow(2,c=Math.log2(b=a.image.height)-2),112)),texelHeight:1/b,maxMip:c};this._texture.value=a,this._width.value=d.texelWidth,this._height.value=d.texelHeight,this._maxMip.value=d.maxMip}updateBefore(a){let b=this._pmrem,c=b?b.pmremVersion:-1,d=this._value;c!==d.pmremVersion&&null!==(b=!0===d.isPMREMTexture?d:function(a,b,c){var d,e;let f,g=(d=b,void 0===(f=adK.get(d))&&(f=new WeakMap,adK.set(d,f)),f),h=g.get(a);if((void 0!==h?h.pmremVersion:-1)!==a.pmremVersion){let b=a.image;if(a.isCubeTexture)if(!function(a){if(null==a)return!1;let b=0;for(let c=0;c<6;c++)void 0!==a[c]&&b++;return 6===b}(b))return null;else h=c.fromCubemap(a,h);else{if(!(null!=(e=b)&&e.height>0))return null;h=c.fromEquirectangular(a,h)}h.pmremVersion=a.pmremVersion,g.set(a,h)}return h.texture}(d,a.renderer,this._generator))&&(this._pmrem=b,this.updateFromTexture(b))}setup(a){null===this._generator&&(this._generator=new adE(a.renderer)),this.updateBefore(a);let b=this.uvNode;null===b&&a.context.getUV&&(b=a.context.getUV(this)),b=aaq.mul(XW(b.x,b.y.negate(),b.z));let c=this.levelNode;return null===c&&a.context.getTextureLevel&&(c=a.context.getTextureLevel(this)),adk(this._texture,b,c,this._width,this._height,this._maxMip)}dispose(){super.dispose(),null!==this._generator&&this._generator.dispose()}}).setParameterLength(1,3),adM=XI(()=>{let a=XW(_5.z,0,_5.x.negate()).normalize(),b=_5.cross(a);return XS(a.dot(aae),b.dot(aae)).mul(.495).add(.5)}).once(["NORMAL","VERTEX"])().toVar("matcapUV"),adN=XD(class extends WZ{static get type(){return"RotateNode"}constructor(a,b){super(),this.positionNode=a,this.rotationNode=b}getNodeType(a){return this.positionNode.getNodeType(a)}setup(a){let{rotationNode:b,positionNode:c}=this;if("vec2"===this.getNodeType(a)){let a=b.cos(),d=b.sin();return X2(a,d,d.negate(),a).mul(c)}{let a=X4(X$(1,0,0,0),X$(0,ZB(b.x),ZA(b.x).negate(),0),X$(0,ZA(b.x),ZB(b.x),0),X$(0,0,0,1)),d=X4(X$(ZB(b.y),0,ZA(b.y),0),X$(0,1,0,0),X$(ZA(b.y).negate(),0,ZB(b.y),0),X$(0,0,0,1)),e=X4(X$(ZB(b.z),ZA(b.z).negate(),0,0),X$(ZA(b.z),ZB(b.z),0,0),X$(0,0,1,0),X$(0,0,0,1));return a.mul(d).mul(e).mul(X$(c,1)).xyz}}}).setParameterLength(2);X8("vec3"),X8("vec3"),X8("vec3");class adO extends X7{static get type(){return"ParameterNode"}constructor(a,b=null){super(a,b),this.isParameterNode=!0}getMemberType(a,b){let c,d=this.getNodeType(a),e=a.getStructTypeNode(d);return null!==e?c=e.getMemberType(a,b):(I1(`TSL: Member "${b}" not found in struct "${d}".`),c="float"),c}getHash(){return this.uuid}generate(){return this.name}}let adP=XD(class extends WW{static get type(){return"StackNode"}constructor(a=null){super(),this.nodes=[],this.outputNode=null,this.parent=a,this._currentCond=null,this._expressionNode=null,this.isStackNode=!0}getElementType(a){return this.hasOutput?this.outputNode.getElementType(a):"void"}getNodeType(a){return this.hasOutput?this.outputNode.getNodeType(a):"void"}getMemberType(a,b){return this.hasOutput?this.outputNode.getMemberType(a,b):"void"}addToStack(a){return!0!==a.isNode?I1("TSL: Invalid node added to stack."):this.nodes.push(a),this}If(a,b){let c=new Xy(b);return this._currentCond=$j(a,c),this.addToStack(this._currentCond)}ElseIf(a,b){let c=$j(a,new Xy(b));return this._currentCond.elseNode=c,this._currentCond=c,this}Else(a){return this._currentCond.elseNode=new Xy(a),this}Switch(a){return this._expressionNode=Xz(a),this}Case(...a){let b=[];if(a.length>=2)for(let c=0;c<a.length-1;c++)b.push(this._expressionNode.equal(Xz(a[c])));else I1("TSL: Invalid parameter length. Case() requires at least two parameters.");let c=new Xy(a[a.length-1]),d=b[0];for(let a=1;a<b.length;a++)d=d.or(b[a]);let e=$j(d,c);return null===this._currentCond?(this._currentCond=e,this.addToStack(this._currentCond)):(this._currentCond.elseNode=e,this._currentCond=e,this)}Default(a){return this.Else(a),this}setup(a){let b=a.getNodeProperties(this),c=0;for(let d of this.getChildren())d.isVarNode&&!0===d.intent&&!0!==d.isAssign(a)||(b["node"+c++]=d);return b.outputNode||null}get hasOutput(){return this.outputNode&&this.outputNode.isNode}build(a,...b){let c,d=XK();XJ(this),a.setActiveStack(this);let e=a.buildStage;for(let b of this.nodes)if(!(b.isVarNode&&!0===b.intent&&!0!==b.isAssign(a))){if("setup"===e)b.build(a);else if("analyze"===e)b.build(a,this);else if("generate"===e){let c=a.getDataFromNode(b,"any").stages,d=c&&c[a.shaderStage];if(b.isVarNode&&d&&1===d.length&&d[0]&&d[0].isStackNode)continue;b.build(a,"void")}}return c=this.hasOutput?this.outputNode.build(a,...b):super.build(a,...b),XJ(d),a.removeActiveStack(this),c}}).setParameterLength(0,1);class adQ extends WW{static get type(){return"StructTypeNode"}constructor(a,b=null){super("struct"),this.membersLayout=Object.entries(a).map(([a,b])=>"string"==typeof b?{name:a,type:b,atomic:!1}:{name:a,type:b.type,atomic:b.atomic||!1}),this.name=b,this.isStructLayoutNode=!0}getLength(){let a=Float32Array.BYTES_PER_ELEMENT,b=0;for(let c of this.membersLayout){let d=c.type,e=(/float|int|uint/.test(d)?1:/vec2/.test(d)?2:/vec3/.test(d)?3:/vec4/.test(d)||/mat2/.test(d)?4:/mat3/.test(d)?12:/mat4/.test(d)?16:void I1("TSL: Unsupported type:",d))*a,f=/float|int|uint/.test(d)?4:/vec2/.test(d)?8:/vec3/.test(d)||/vec4/.test(d)?16:/mat2/.test(d)?8:/mat3/.test(d)?48:/mat4/.test(d)?64:void I1("TSL: Unsupported type:",d),g=b%8,h=g%f,i=g+h;b+=h,0!==i&&8-i<e&&(b+=8-i),b+=e}return 8*Math.ceil(b/8)/a}getMemberType(a,b){let c=this.membersLayout.find(a=>a.name===b);return c?c.type:"void"}getNodeType(a){return a.getStructTypeFromNode(this,this.membersLayout,this.name).name}setup(a){a.getStructTypeFromNode(this,this.membersLayout,this.name),a.addInclude(this)}generate(a){return this.getNodeType(a)}}class adR extends WW{static get type(){return"StructNode"}constructor(a,b){super("vec3"),this.structTypeNode=a,this.values=b,this.isStructNode=!0}getNodeType(a){return this.structTypeNode.getNodeType(a)}getMemberType(a,b){return this.structTypeNode.getMemberType(a,b)}generate(a){let b=a.getVarFromNode(this),c=b.type,d=a.getPropertyName(b);return a.addLineFlowCode(`${d} = ${a.generateStruct(c,this.structTypeNode.membersLayout,this.values)}`,this),b.name}}class adS extends WW{static get type(){return"OutputStructNode"}constructor(...a){super(),this.members=a,this.isOutputStructNode=!0}getNodeType(a){let b=a.getNodeProperties(this);if(void 0===b.membersLayout){let c=this.members,d=[];for(let b=0;b<c.length;b++){let e="m"+b,f=c[b].getNodeType(a);d.push({name:e,type:f,index:b})}b.membersLayout=d,b.structType=a.getOutputStructTypeFromNode(this,b.membersLayout)}return b.structType.name}generate(a){let b=a.getOutputStructName(),c=this.members,d=""!==b?b+".":"";for(let b=0;b<c.length;b++){let e=c[b].build(a);a.addLineFlowCode(`${d}m${b} = ${e}`,this)}return b}}let adT=XD(adS);function adU(a,b){for(let c=0;c<a.length;c++)if(a[c].name===b)return c;return -1}let adV=XD(class extends adS{static get type(){return"MRTNode"}constructor(a){super(),this.outputNodes=a,this.isMRTNode=!0}has(a){return void 0!==this.outputNodes[a]}get(a){return this.outputNodes[a]}merge(a){return adV({...this.outputNodes,...a.outputNodes})}setup(a){let b=this.outputNodes,c=a.renderer.getRenderTarget(),d=[],e=c.textures;for(let a in b)d[adU(e,a)]=X$(b[a]);return this.members=d,super.setup(a)}});class adW extends WZ{static get type(){return"BitcastNode"}constructor(a,b,c=null){super(),this.valueNode=a,this.conversionType=b,this.inputType=c,this.isBitcastNode=!0}getNodeType(a){if(null!==this.inputType){let b=this.valueNode.getNodeType(a),c=a.getTypeLength(b);return a.getTypeFromLength(c,this.conversionType)}return this.conversionType}generate(a){let b=this.getNodeType(a),c="";if(null!==this.inputType){let b=this.valueNode.getNodeType(a);c=1===a.getTypeLength(b)?this.inputType:a.changeComponentType(b,this.inputType)}else c=this.valueNode.getNodeType(a);return`${a.getBitcastMethod(b,c)}( ${this.valueNode.build(a,c)} )`}}let adX=XF(adW).setParameterLength(2),adY=XI(([a])=>{let b=a.toUint().mul(0x2c9277b5).add(0xac564b05),c=b.shiftRight(b.shiftRight(28).add(4)).bitXor(b).mul(0x108ef2d9);return c.shiftRight(22).bitXor(c).toFloat().mul(1/0x100000000)}),adZ=(a,b)=>Z1(YT(4,a.mul(YS(1,a))),b),ad$=XI(([a])=>a.fract().sub(.5).abs()).setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]}),ad_=XI(([a])=>XW(ad$(a.z.add(ad$(a.y.mul(1)))),ad$(a.z.add(ad$(a.x.mul(1)))),ad$(a.y.add(ad$(a.x.mul(1)))))).setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),ad0=XI(([a,b,c])=>{let d=XW(a).toVar(),e=XO(1.4).toVar(),f=XO(0).toVar(),g=XW(d).toVar();return ab0({start:XO(0),end:XO(3),type:"float",condition:"<="},()=>{let a=XW(ad_(g.mul(2))).toVar();d.addAssign(a.add(c.mul(XO(.1).mul(b)))),g.mulAssign(1.8),e.mulAssign(1.5),d.mulAssign(1.2);let h=XO(ad$(d.z.add(ad$(d.x.add(ad$(d.y)))))).toVar();f.addAssign(h.div(e)),g.addAssign(.14)}),f}).setLayout({name:"triNoise3D",type:"float",inputs:[{name:"position",type:"vec3"},{name:"speed",type:"float"},{name:"time",type:"float"}]}),ad1=XD(class extends WW{static get type(){return"FunctionOverloadingNode"}constructor(a=[],...b){super(),this.functionNodes=a,this.parametersNodes=b,this._candidateFn=null,this.global=!0}getNodeType(a){return this.getCandidateFn(a).shaderNode.layout.type}getCandidateFn(a){let b=this.parametersNodes,c=this._candidateFn;if(null===c){let d=null,e=-1;for(let c of this.functionNodes){let f=c.shaderNode.layout;if(null===f)throw Error("FunctionOverloadingNode: FunctionNode must be a layout.");let g=f.inputs;if(b.length===g.length){let f=0;for(let c=0;c<b.length;c++){let d=b[c],e=g[c];d.getNodeType(a)===e.type&&f++}f>e&&(d=c,e=f)}}this._candidateFn=c=d}return c}setup(a){return this.getCandidateFn(a)(...this.parametersNodes)}}),ad2=a=>(...b)=>ad1(a,...b),ad3=YJ(0).setGroup(YG).onRenderUpdate(a=>a.time),ad4=YJ(0).setGroup(YG).onRenderUpdate(a=>a.deltaTime),ad5=YJ(0,"uint").setGroup(YG).onRenderUpdate(a=>a.frameId),ad6=XI(([a,b,c=XS(.5)])=>adN(a.sub(c),b).add(c)),ad7=XI(([a,b,c=XS(.5)])=>{let d=a.sub(c),e=d.dot(d),f=e.mul(e).mul(b);return a.add(d.mul(f))}),ad8=XI(({position:a=null,horizontal:b=!0,vertical:c=!1})=>{let d;null!==a?((d=_Q.toVar())[3][0]=a.x,d[3][1]=a.y,d[3][2]=a.z):d=_Q;let e=_B.mul(d);return Xw(b)&&(e[0][0]=_Q[0].length(),e[0][1]=0,e[0][2]=0),Xw(c)&&(e[1][0]=0,e[1][1]=_Q[1].length(),e[1][2]=0),e[2][0]=0,e[2][1]=0,e[2][2]=1,_z.mul(e).mul(_0)}),ad9=XI(([a=null])=>{let b=acn();return acn(acf(a)).sub(b).lessThan(0).select(_o,a)}),aea=XD(class extends WW{static get type(){return"SpriteSheetUVNode"}constructor(a,b=$8(),c=XO(0)){super("vec2"),this.countNode=a,this.uvNode=b,this.frameNode=c}setup(){let{frameNode:a,uvNode:b,countNode:c}=this,{width:d,height:e}=c,f=a.mod(d.mul(e)).floor(),g=f.mod(d),h=e.sub(f.add(1).div(d).ceil()),i=c.reciprocal(),j=XS(g,h);return b.add(j).mul(i)}}).setParameterLength(3),aeb=XI(([a,b=null,c=null,d=XO(1),e=_0,f=aaa])=>{let g=f.abs().normalize();g=g.div(g.dot(XW(1)));let h=e.yz.mul(d),i=e.zx.mul(d),j=e.xy.mul(d),k=a.value,l=null!==b?b.value:k,m=null!==c?c.value:k;return YR(_e(k,h).mul(g.x),_e(l,i).mul(g.y),_e(m,j).mul(g.z))}),aec=new LC,aed=new Je,aee=new Je,aef=new Je,aeg=new JZ,aeh=new Je(0,0,-1),aei=new Jv,aej=new Je,aek=new Je,ael=new Jv,aem=new Jc,aen=new Jw,aeo=_o.flipX();aen.depthTexture=new LI(1,1);let aep=!1;class aeq extends _c{static get type(){return"ReflectorNode"}constructor(a={}){super(a.defaultTexture||aen.texture,aeo),this._reflectorBaseNode=a.reflector||new aer(this,a),this._depthNode=null,this.setUpdateMatrix(!1)}get reflector(){return this._reflectorBaseNode}get target(){return this._reflectorBaseNode.target}getDepthNode(){if(null===this._depthNode){if(!0!==this._reflectorBaseNode.depth)throw Error("THREE.ReflectorNode: Depth node can only be requested when the reflector is created with { depth: true }. ");this._depthNode=Xz(new aeq({defaultTexture:aen.depthTexture,reflector:this._reflectorBaseNode}))}return this._depthNode}setup(a){return a.object.isQuadMesh||this._reflectorBaseNode.build(a),super.setup(a)}clone(){let a=new this.constructor(this.reflectorNode);return a.uvNode=this.uvNode,a.levelNode=this.levelNode,a.biasNode=this.biasNode,a.sampler=this.sampler,a.depthNode=this.depthNode,a.compareNode=this.compareNode,a.gradNode=this.gradNode,a.offsetNode=this.offsetNode,a._reflectorBaseNode=this._reflectorBaseNode,a}dispose(){super.dispose(),this._reflectorBaseNode.dispose()}}class aer extends WW{static get type(){return"ReflectorBaseNode"}constructor(a,b={}){super();const{target:c=new Ko,resolutionScale:d=1,generateMipmaps:e=!1,bounces:f=!0,depth:g=!1,samples:h=0}=b;this.textureNode=a,this.target=c,this.resolutionScale=d,void 0!==b.resolution&&(I2('ReflectorNode: The "resolution" parameter has been renamed to "resolutionScale".'),this.resolutionScale=b.resolution),this.generateMipmaps=e,this.bounces=f,this.depth=g,this.samples=h,this.updateBeforeType=f?WP.RENDER:WP.FRAME,this.virtualCameras=new WeakMap,this.renderTargets=new Map,this.forceUpdate=!1,this.hasOutput=!1}_updateResolution(a,b){let c=this.resolutionScale;b.getDrawingBufferSize(aem),a.setSize(Math.round(aem.width*c),Math.round(aem.height*c))}setup(a){return this._updateResolution(aen,a.renderer),super.setup(a)}dispose(){for(let a of(super.dispose(),this.renderTargets.values()))a.dispose()}getVirtualCamera(a){let b=this.virtualCameras.get(a);return void 0===b&&(b=a.clone(),this.virtualCameras.set(a,b)),b}getRenderTarget(a){let b=this.renderTargets.get(a);return void 0===b&&(b=new Jw(0,0,{type:1016,samples:this.samples}),!0===this.generateMipmaps&&(b.texture.minFilter=1008,b.texture.generateMipmaps=!0),!0===this.depth&&(b.depthTexture=new LI),this.renderTargets.set(a,b)),b}updateBefore(a){if(!1===this.bounces&&aep)return!1;aep=!0;let{scene:b,camera:c,renderer:d,material:e}=a,{target:f}=this,g=this.getVirtualCamera(c),h=this.getRenderTarget(g);d.getDrawingBufferSize(aem),this._updateResolution(h,d),aee.setFromMatrixPosition(f.matrixWorld),aef.setFromMatrixPosition(c.matrixWorld),aeg.extractRotation(f.matrixWorld),aed.set(0,0,1),aed.applyMatrix4(aeg),aej.subVectors(aee,aef);let i=aej.dot(aed)>0,j=!1;if(!0===i&&!1===this.forceUpdate){if(!1===this.hasOutput){aep=!1;return}j=!0}aej.reflect(aed).negate(),aej.add(aee),aeg.extractRotation(c.matrixWorld),aeh.set(0,0,-1),aeh.applyMatrix4(aeg),aeh.add(aef),aek.subVectors(aee,aeh),aek.reflect(aed).negate(),aek.add(aee),g.coordinateSystem=c.coordinateSystem,g.position.copy(aej),g.up.set(0,1,0),g.up.applyMatrix4(aeg),g.up.reflect(aed),g.lookAt(aek),g.near=c.near,g.far=c.far,g.updateMatrixWorld(),g.projectionMatrix.copy(c.projectionMatrix),aec.setFromNormalAndCoplanarPoint(aed,aee),aec.applyMatrix4(g.matrixWorldInverse),aei.set(aec.normal.x,aec.normal.y,aec.normal.z,aec.constant);let k=g.projectionMatrix;ael.x=(Math.sign(aei.x)+k.elements[8])/k.elements[0],ael.y=(Math.sign(aei.y)+k.elements[9])/k.elements[5],ael.z=-1,ael.w=(1+k.elements[10])/k.elements[14],aei.multiplyScalar(1/aei.dot(ael)),k.elements[2]=aei.x,k.elements[6]=aei.y,k.elements[10]=2001===d.coordinateSystem?aei.z-0:aei.z+1-0,k.elements[14]=aei.w,this.textureNode.value=h.texture,!0===this.depth&&(this.textureNode.getDepthNode().value=h.depthTexture),e.visible=!1;let l=d.getRenderTarget(),m=d.getMRT(),n=d.autoClear;d.setMRT(null),d.setRenderTarget(h),d.autoClear=!0;let o=b.name;b.name=(b.name||"Scene")+" [ Reflector ]",j?(d.clear(),this.hasOutput=!1):(d.render(b,g),this.hasOutput=!0),b.name=o,d.setMRT(m),d.setRenderTarget(l),d.autoClear=n,e.visible=!0,aep=!1,this.forceUpdate=!1}get resolution(){return I2('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale}set resolution(a){I2('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale=a}}let aes=new LN(-1,1,1,-1,0,1),aet=new class extends K${constructor(a=!1){super(),this.setAttribute("position",new KS([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new KS(!1===a?[0,-1,0,1,2,1]:[0,2,0,0,2,0],2))}};class aeu extends La{constructor(a=null){super(aet,a),this.camera=aes,this.isQuadMesh=!0}async renderAsync(a){I2('QuadMesh: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await a.init(),a.render(this,aes)}render(a){a.render(this,aes)}}let aev=new Jc;class aew extends _c{static get type(){return"RTTNode"}constructor(a,b=null,c=null,d={type:1016}){const e=new Jw(b,c,d);super(e.texture,$8()),this.isRTTNode=!0,this.node=a,this.width=b,this.height=c,this.pixelRatio=1,this.renderTarget=e,this.textureNeedsUpdate=!0,this.autoUpdate=!0,this._rttNode=null,this._quadMesh=new aeu(new acC),this.updateBeforeType=WP.RENDER}get autoResize(){return null===this.width}setup(a){return this._rttNode=this.node.context(a.getSharedContext()),this._quadMesh.material.name="RTT",this._quadMesh.material.needsUpdate=!0,super.setup(a)}setSize(a,b){this.width=a,this.height=b;let c=a*this.pixelRatio,d=b*this.pixelRatio;this.renderTarget.setSize(c,d),this.textureNeedsUpdate=!0}setPixelRatio(a){this.pixelRatio=a,this.setSize(this.width,this.height)}updateBefore({renderer:a}){if(!1===this.textureNeedsUpdate&&!1===this.autoUpdate)return;if(this.textureNeedsUpdate=!1,!0===this.autoResize){let b=a.getPixelRatio(),c=a.getSize(aev),d=Math.floor(c.width*b),e=Math.floor(c.height*b);(d!==this.renderTarget.width||e!==this.renderTarget.height)&&(this.renderTarget.setSize(d,e),this.textureNeedsUpdate=!0)}let b="RTT";this.node.name&&(b=this.node.name+" [ "+b+" ]"),this._quadMesh.material.fragmentNode=this._rttNode,this._quadMesh.name=b;let c=a.getRenderTarget();a.setRenderTarget(this.renderTarget),this._quadMesh.render(a),a.setRenderTarget(c)}clone(){let a=new _c(this.value,this.uvNode,this.levelNode);return a.sampler=this.sampler,a.referenceNode=this,a}}let aex=(a,...b)=>Xz(new aew(Xz(a),...b)),aey=XI(([a,b,c],d)=>{let e;e=2001===d.renderer.coordinateSystem?X$(XW(a=XS(a.x,a.y.oneMinus()).mul(2).sub(1),b),1):X$(XW(a.x,a.y.oneMinus(),b).mul(2).sub(1),1);let f=X$(c.mul(e));return f.xyz.div(f.w)}),aez=XI(([a,b])=>{let c=b.mul(X$(a,1)),d=c.xy.div(c.w).mul(.5).add(.5).toVar();return XS(d.x,d.y.oneMinus())}),aeA=XI(([a,b,c])=>{let d=$9(_f(b)),e=XT(a.mul(d)).toVar(),f=_f(b,e).toVar(),g=_f(b,e.sub(XT(2,0))).toVar(),h=_f(b,e.sub(XT(1,0))).toVar(),i=_f(b,e.add(XT(1,0))).toVar(),j=_f(b,e.add(XT(2,0))).toVar(),k=_f(b,e.add(XT(0,2))).toVar(),l=_f(b,e.add(XT(0,1))).toVar(),m=_f(b,e.sub(XT(0,1))).toVar(),n=_f(b,e.sub(XT(0,2))).toVar(),o=ZG(YS(XO(2).mul(h).sub(g),f)).toVar(),p=ZG(YS(XO(2).mul(i).sub(j),f)).toVar(),q=ZG(YS(XO(2).mul(l).sub(k),f)).toVar(),r=ZG(YS(XO(2).mul(m).sub(n),f)).toVar(),s=aey(a,f,c).toVar();return Zy(Z0(o.lessThan(p).select(s.sub(aey(a.sub(XS(XO(1).div(d.x),0)),h,c)),s.negate().add(aey(a.add(XS(XO(1).div(d.x),0)),i,c))),q.lessThan(r).select(s.sub(aey(a.add(XS(0,XO(1).div(d.y))),l,c)),s.negate().add(aey(a.sub(XS(0,XO(1).div(d.y))),m,c)))))}),aeB=XI(([a])=>Zz(XO(52.9829189).mul(Zz(Z_(a,XS(.06711056,.00583715)))))).setLayout({name:"interleavedGradientNoise",type:"float",inputs:[{name:"position",type:"vec2"}]});class aeC extends WW{static get type(){return"SampleNode"}constructor(a,b=null){super(),this.callback=a,this.uvNode=b,this.isSampleNode=!0}setup(){return this.sample($8())}sample(a){return this.callback(a)}}class aeD extends WW{static get type(){return"EventNode"}constructor(a,b){super("void"),this.eventType=a,this.callback=b,a===aeD.OBJECT?this.updateType=WP.OBJECT:a===aeD.MATERIAL?this.updateType=WP.RENDER:a===aeD.BEFORE_OBJECT?this.updateBeforeType=WP.OBJECT:a===aeD.BEFORE_MATERIAL&&(this.updateBeforeType=WP.RENDER)}update(a){this.callback(a)}updateBefore(a){this.callback(a)}}aeD.OBJECT="object",aeD.MATERIAL="material",aeD.BEFORE_OBJECT="beforeObject",aeD.BEFORE_MATERIAL="beforeMaterial";let aeE=(a,b)=>Xz(new aeD(a,b)).toStack();class aeF extends Ly{constructor(a,b,c=Float32Array){super(ArrayBuffer.isView(a)?a:new c(a*b),b),this.isStorageInstancedBufferAttribute=!0}}class aeG extends KP{constructor(a,b,c=Float32Array){super(ArrayBuffer.isView(a)?a:new c(a*b),b),this.isStorageBufferAttribute=!0}}let aeH=XE(class extends WW{static get type(){return"PointUVNode"}constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}),aeI=new J7,aeJ=new JZ;class aeK extends WW{static get type(){return"SceneNode"}constructor(a=aeK.BACKGROUND_BLURRINESS,b=null){super(),this.scope=a,this.scene=b}setup(a){let b,c=this.scope,d=null!==this.scene?this.scene:a.scene;return c===aeK.BACKGROUND_BLURRINESS?b=aaA("backgroundBlurriness","float",d):c===aeK.BACKGROUND_INTENSITY?b=aaA("backgroundIntensity","float",d):c===aeK.BACKGROUND_ROTATION?b=YJ("mat4").setName("backgroundRotation").setGroup(YG).onRenderUpdate(()=>{let a=d.background;return null!==a&&a.isTexture&&300!==a.mapping?(aeI.copy(d.backgroundRotation),aeI.x*=-1,aeI.y*=-1,aeI.z*=-1,aeJ.makeRotationFromEuler(aeI)):aeJ.identity(),aeJ}):I1("SceneNode: Unknown scope:",c),b}}aeK.BACKGROUND_BLURRINESS="backgroundBlurriness",aeK.BACKGROUND_INTENSITY="backgroundIntensity",aeK.BACKGROUND_ROTATION="backgroundRotation";let aeL=XE(aeK,aeK.BACKGROUND_BLURRINESS),aeM=XE(aeK,aeK.BACKGROUND_INTENSITY),aeN=XE(aeK,aeK.BACKGROUND_ROTATION),aeO=XD(class extends _c{static get type(){return"StorageTextureNode"}constructor(a,b,c=null){super(a,b),this.storeNode=c,this.mipLevel=0,this.isStorageTextureNode=!0,this.access=WQ.WRITE_ONLY}getInputType(){return"storageTexture"}setup(a){super.setup(a);let b=a.getNodeProperties(this);return b.storeNode=this.storeNode,b}setAccess(a){return this.access=a,this}setMipLevel(a){return this.mipLevel=a,this}generate(a,b){return null!==this.storeNode?this.generateStore(a):super.generate(a,b)}toReadWrite(){return this.setAccess(WQ.READ_WRITE)}toReadOnly(){return this.setAccess(WQ.READ_ONLY)}toWriteOnly(){return this.setAccess(WQ.WRITE_ONLY)}generateStore(a){let{uvNode:b,storeNode:c,depthNode:d}=a.getNodeProperties(this),e=super.generate(a,"property"),f=b.build(a,!0===this.value.is3DTexture?"uvec3":"uvec2"),g=c.build(a,"vec4"),h=d?d.build(a,"int"):null,i=a.generateTextureStore(a,e,f,h,g);a.addLineFlowCode(i,this)}clone(){let a=super.clone();return a.storeNode=this.storeNode,a.mipLevel=this.mipLevel,a}}).setParameterLength(1,3),aeP=XI(({texture:a,uv:b})=>{let c=XW().toVar();return XL(b.x.lessThan(1e-4),()=>{c.assign(XW(1,0,0))}).ElseIf(b.y.lessThan(1e-4),()=>{c.assign(XW(0,1,0))}).ElseIf(b.z.lessThan(1e-4),()=>{c.assign(XW(0,0,1))}).ElseIf(b.x.greaterThan(.9999),()=>{c.assign(XW(-1,0,0))}).ElseIf(b.y.greaterThan(.9999),()=>{c.assign(XW(0,-1,0))}).ElseIf(b.z.greaterThan(.9999),()=>{c.assign(XW(0,0,-1))}).Else(()=>{let d=a.sample(b.add(XW(-.01,0,0))).r.sub(a.sample(b.add(XW(.01,0,0))).r),e=a.sample(b.add(XW(0,-.01,0))).r.sub(a.sample(b.add(XW(0,.01,0))).r),f=a.sample(b.add(XW(0,0,-.01))).r.sub(a.sample(b.add(XW(0,0,.01))).r);c.assign(XW(d,e,f))}),c.normalize()}),aeQ=XD(class extends _c{static get type(){return"Texture3DNode"}constructor(a,b=null,c=null){super(a,b,c),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return XW(.5,.5,.5)}setUpdateMatrix(){}setupUV(a,b){let c=this.value;return a.isFlipY()&&(!0===c.isRenderTargetTexture||!0===c.isFramebufferTexture)&&(b=this.sampler?b.flipY():b.setY(XP($9(this,this.levelNode).y).sub(b.y).sub(1))),b}generateUV(a,b){return b.build(a,!0===this.sampler?"vec3":"ivec3")}generateOffset(a,b){return b.build(a,"ivec3")}normal(a){return aeP({texture:this,uv:a})}}).setParameterLength(1,3);class aeR extends aaz{static get type(){return"UserDataNode"}constructor(a,b,c=null){super(a,b,c),this.userData=c}updateReference(a){return this.reference=null!==this.userData?this.userData:a.object.userData,this.reference}}let aeS=new WeakMap;function aeT(a){let b=aeS.get(a);return void 0===b&&(b={},aeS.set(a,b)),b}function aeU(a,b=0){let c=aeT(a),d=c[b];return void 0===d&&(c[b]=d=new JZ,c[b].copy(a.matrixWorld)),d}let aeV=XE(class extends WZ{static get type(){return"VelocityNode"}constructor(){super("vec2"),this.projectionMatrix=null,this.updateType=WP.OBJECT,this.updateAfterType=WP.OBJECT,this.previousModelWorldMatrix=YJ(new JZ),this.previousProjectionMatrix=YJ(new JZ).setGroup(YG),this.previousCameraViewMatrix=YJ(new JZ)}setProjectionMatrix(a){this.projectionMatrix=a}update({frameId:a,camera:b,object:c}){let d=aeU(c);this.previousModelWorldMatrix.value.copy(d);let e=aeT(b);e.frameId!==a&&(e.frameId=a,void 0===e.previousProjectionMatrix?(e.previousProjectionMatrix=new JZ,e.previousCameraViewMatrix=new JZ,e.currentProjectionMatrix=new JZ,e.currentCameraViewMatrix=new JZ,e.previousProjectionMatrix.copy(this.projectionMatrix||b.projectionMatrix),e.previousCameraViewMatrix.copy(b.matrixWorldInverse)):(e.previousProjectionMatrix.copy(e.currentProjectionMatrix),e.previousCameraViewMatrix.copy(e.currentCameraViewMatrix)),e.currentProjectionMatrix.copy(this.projectionMatrix||b.projectionMatrix),e.currentCameraViewMatrix.copy(b.matrixWorldInverse),this.previousProjectionMatrix.value.copy(e.previousProjectionMatrix),this.previousCameraViewMatrix.value.copy(e.previousCameraViewMatrix))}updateAfter({object:a}){aeU(a).copy(a.matrixWorld)}setup(){let a=null===this.projectionMatrix?_z:YJ(this.projectionMatrix),b=this.previousCameraViewMatrix.mul(this.previousModelWorldMatrix),c=a.mul(_X).mul(_0),d=this.previousProjectionMatrix.mul(b).mul(_1);return YS(c.xy.div(c.w),d.xy.div(d.w))}}),aeW=XI(([a])=>ae$(a.rgb)),aeX=XI(([a,b=XO(1)])=>b.mix(ae$(a.rgb),a.rgb)),aeY=XI(([a,b=XO(1)])=>{let c=YR(a.r,a.g,a.b).div(3),d=a.r.max(a.g.max(a.b)),e=d.sub(c).mul(b).mul(-3);return Z8(a.rgb,d,e)}),aeZ=XI(([a,b=XO(1)])=>{let c=XW(.57735,.57735,.57735),d=b.cos();return XW(a.rgb.mul(d).add(c.cross(a.rgb).mul(b.sin()).add(c.mul(Z_(c,a.rgb).mul(d.oneMinus())))))}),ae$=(a,b=XW(Jl.getLuminanceCoefficients(new Je)))=>Z_(a,b),ae_=XI(([a,b=XW(1),c=XW(0),d=XW(1),e=XO(1),f=XW(Jl.getLuminanceCoefficients(new Je,IU))])=>{let g=a.rgb.dot(XW(f)),h=ZW(a.rgb.mul(b).add(c),0).toVar(),i=h.pow(d).toVar();return XL(h.r.greaterThan(0),()=>{h.r.assign(i.r)}),XL(h.g.greaterThan(0),()=>{h.g.assign(i.g)}),XL(h.b.greaterThan(0),()=>{h.b.assign(i.b)}),h.assign(g.add(h.sub(g).mul(e))),X$(h.rgb,a.a)}),ae0=XD(class extends WZ{static get type(){return"PosterizeNode"}constructor(a,b){super(),this.sourceNode=a,this.stepsNode=b}setup(){let{sourceNode:a,stepsNode:b}=this;return a.mul(b).floor().div(b)}}).setParameterLength(2),ae1=new Jc;class ae2 extends _c{static get type(){return"PassTextureNode"}constructor(a,b){super(b),this.passNode=a,this.setUpdateMatrix(!1)}setup(a){return this.passNode.build(a),super.setup(a)}clone(){return new this.constructor(this.passNode,this.value)}}class ae3 extends ae2{static get type(){return"PassMultipleTextureNode"}constructor(a,b,c=!1){super(a,null),this.textureName=b,this.previousTexture=c}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(a){return this.updateTexture(),super.setup(a)}clone(){let a=new this.constructor(this.passNode,this.textureName,this.previousTexture);return a.uvNode=this.uvNode,a.levelNode=this.levelNode,a.biasNode=this.biasNode,a.sampler=this.sampler,a.depthNode=this.depthNode,a.compareNode=this.compareNode,a.gradNode=this.gradNode,a.offsetNode=this.offsetNode,a}}class ae4 extends WZ{static get type(){return"PassNode"}constructor(a,b,c,d={}){super("vec4"),this.scope=a,this.scene=b,this.camera=c,this.options=d,this._pixelRatio=1,this._width=1,this._height=1;const e=new LI;e.isRenderTargetTexture=!0,e.name="depth";const f=new Jw(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:1016,...d});f.texture.name="output",f.depthTexture=e,this.renderTarget=f,this._textures={output:f.texture,depth:e},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=YJ(0),this._cameraFar=YJ(0),this._mrt=null,this._layers=null,this._resolutionScale=1,this._viewport=null,this._scissor=null,this.isPassNode=!0,this.updateBeforeType=WP.FRAME,this.global=!0}setResolutionScale(a){return this._resolutionScale=a,this}getResolutionScale(){return this._resolutionScale}setResolution(a){return I0("PassNode: .setResolution() is deprecated. Use .setResolutionScale() instead."),this.setResolutionScale(a)}getResolution(){return I0("PassNode: .getResolution() is deprecated. Use .getResolutionScale() instead."),this.getResolutionScale()}setLayers(a){return this._layers=a,this}getLayers(){return this._layers}setMRT(a){return this._mrt=a,this}getMRT(){return this._mrt}getTexture(a){let b=this._textures[a];return void 0===b&&((b=this.renderTarget.texture.clone()).name=a,this._textures[a]=b,this.renderTarget.textures.push(b)),b}getPreviousTexture(a){let b=this._previousTextures[a];return void 0===b&&(b=this.getTexture(a).clone(),this._previousTextures[a]=b),b}toggleTexture(a){let b=this._previousTextures[a];if(void 0!==b){let c=this._textures[a],d=this.renderTarget.textures.indexOf(c);this.renderTarget.textures[d]=b,this._textures[a]=b,this._previousTextures[a]=c,this._textureNodes[a].updateTexture(),this._previousTextureNodes[a].updateTexture()}}getTextureNode(a="output"){let b=this._textureNodes[a];return void 0===b&&((b=Xz(new ae3(this,a))).updateTexture(),this._textureNodes[a]=b),b}getPreviousTextureNode(a="output"){let b=this._previousTextureNodes[a];return void 0===b&&(void 0===this._textureNodes[a]&&this.getTextureNode(a),(b=Xz(new ae3(this,a,!0))).updateTexture(),this._previousTextureNodes[a]=b),b}getViewZNode(a="depth"){let b=this._viewZNodes[a];if(void 0===b){let c=this._cameraNear,d=this._cameraFar;this._viewZNodes[a]=b=acj(this.getTextureNode(a),c,d)}return b}getLinearDepthNode(a="depth"){let b=this._linearDepthNodes[a];if(void 0===b){let c=this._cameraNear,d=this._cameraFar,e=this.getViewZNode(a);this._linearDepthNodes[a]=b=ach(e,c,d)}return b}async compileAsync(a){let b=a.getRenderTarget(),c=a.getMRT();a.setRenderTarget(this.renderTarget),a.setMRT(this._mrt),await a.compileAsync(this.scene,this.camera),a.setRenderTarget(b),a.setMRT(c)}setup({renderer:a}){return this.renderTarget.samples=void 0===this.options.samples?a.samples:this.options.samples,this.renderTarget.texture.type=a.getColorBufferType(),this.scope===ae4.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(a){let b,c,{renderer:d}=a,{scene:e}=this,f=d.getOutputRenderTarget();f&&!0===f.isXRRenderTarget?(c=1,b=d.xr.getCamera(),d.xr.updateCamera(b),ae1.set(f.width,f.height)):(b=this.camera,c=d.getPixelRatio(),d.getSize(ae1)),this._pixelRatio=c,this.setSize(ae1.width,ae1.height);let g=d.getRenderTarget(),h=d.getMRT(),i=d.autoClear,j=b.layers.mask;for(let a in this._cameraNear.value=b.near,this._cameraFar.value=b.far,null!==this._layers&&(b.layers.mask=this._layers.mask),this._previousTextures)this.toggleTexture(a);d.setRenderTarget(this.renderTarget),d.setMRT(this._mrt),d.autoClear=!0;let k=e.name;e.name=this.name?this.name:e.name,d.render(e,b),e.name=k,d.setRenderTarget(g),d.setMRT(h),d.autoClear=i,b.layers.mask=j}setSize(a,b){this._width=a,this._height=b;let c=Math.floor(this._width*this._pixelRatio*this._resolutionScale),d=Math.floor(this._height*this._pixelRatio*this._resolutionScale);this.renderTarget.setSize(c,d),null!==this._scissor&&this.renderTarget.scissor.copy(this._scissor),null!==this._viewport&&this.renderTarget.viewport.copy(this._viewport)}setScissor(a,b,c,d){null===a?this._scissor=null:(null===this._scissor&&(this._scissor=new Jv),a.isVector4?this._scissor.copy(a):this._scissor.set(a,b,c,d),this._scissor.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setViewport(a,b,c,d){null===a?this._viewport=null:(null===this._viewport&&(this._viewport=new Jv),a.isVector4?this._viewport.copy(a):this._viewport.set(a,b,c,d),this._viewport.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setPixelRatio(a){this._pixelRatio=a,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}ae4.COLOR="color",ae4.DEPTH="depth";class ae5 extends ae4{static get type(){return"ToonOutlinePassNode"}constructor(a,b,c,d,e){super(ae4.COLOR,a,b),this.colorNode=c,this.thicknessNode=d,this.alphaNode=e,this._materialCache=new WeakMap,this.name="Outline Pass"}updateBefore(a){let{renderer:b}=a,c=b.getRenderObjectFunction();b.setRenderObjectFunction((a,c,d,e,f,g,h,i)=>{if((f.isMeshToonMaterial||f.isMeshToonNodeMaterial)&&!1===f.wireframe){let j=this._getOutlineMaterial(f);b.renderObject(a,c,d,e,j,g,h,i)}b.renderObject(a,c,d,e,f,g,h,i)}),super.updateBefore(a),b.setRenderObjectFunction(c)}_createMaterial(){let a=new acC;a.isMeshToonOutlineMaterial=!0,a.name="Toon_Outline",a.side=1;let b=aaa.negate(),c=_z.mul(_X),d=XO(1),e=c.mul(X$(_0,1)),f=c.mul(X$(_0.add(b),1)),g=Zy(e.sub(f));return a.vertexNode=e.add(g.mul(this.thicknessNode).mul(e.w).mul(d)),a.colorNode=X$(this.colorNode,this.alphaNode),a}_getOutlineMaterial(a){let b=this._materialCache.get(a);return void 0===b&&(b=this._createMaterial(),this._materialCache.set(a,b)),b}}let ae6=XI(([a,b])=>a.mul(b).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),ae7=XI(([a,b])=>(a=a.mul(b)).div(a.add(1)).clamp()).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),ae8=XI(([a,b])=>{let c=(a=(a=a.mul(b)).sub(.004).max(0)).mul(a.mul(6.2).add(.5)),d=a.mul(a.mul(6.2).add(1.7)).add(.06);return c.div(d).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),ae9=XI(([a])=>{let b=a.mul(a.add(.0245786)).sub(90537e-9),c=a.mul(a.add(.432951).mul(.983729)).add(.238081);return b.div(c)}),afa=XI(([a,b])=>{let c=X3(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),d=X3(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return a=a.mul(b).div(.6),a=ae9(a=c.mul(a)),(a=d.mul(a)).clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),afb=X3(XW(1.6605,-.1246,-.0182),XW(-.5876,1.1329,-.1006),XW(-.0728,-.0083,1.1187)),afc=X3(XW(.6274,.0691,.0164),XW(.3293,.9195,.088),XW(.0433,.0113,.8956)),afd=XI(([a])=>{let b=XW(a).toVar(),c=XW(b.mul(b)).toVar(),d=XW(c.mul(c)).toVar();return XO(15.5).mul(d.mul(c)).sub(YT(40.14,d.mul(b))).add(YT(31.96,d).sub(YT(6.868,c.mul(b))).add(YT(.4298,c).add(YT(.1191,b).sub(.00232))))}),afe=XI(([a,b])=>{let c=XW(a).toVar(),d=X3(XW(.856627153315983,.137318972929847,.11189821299995),XW(.0951212405381588,.761241990602591,.0767994186031903),XW(.0482516061458583,.101439036467562,.811302368396859)),e=X3(XW(1.1271005818144368,-.1413297634984383,-.14132976349843826),XW(-.11060664309660323,1.157823702216272,-.11060664309660294),XW(-.016493938717834573,-.016493938717834257,1.2519364065950405)),f=XO(-12.47393),g=XO(4.026069);return c.mulAssign(b),c.assign(afc.mul(c)),c.assign(d.mul(c)),c.assign(ZW(c,1e-10)),c.assign(Zt(c)),c.assign(c.sub(f).div(g.sub(f))),c.assign(Z9(c,0,1)),c.assign(afd(c)),c.assign(e.mul(c)),c.assign(Z1(ZW(XW(0),c),XW(2.2))),c.assign(afb.mul(c)),c.assign(Z9(c,0,1)),c}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),aff=XI(([a,b])=>{let c=XO(.76),d=XO(.15),e=ZV((a=a.mul(b)).r,ZV(a.g,a.b)),f=$j(e.lessThan(.08),e.sub(YT(6.25,e.mul(e))),.04);a.subAssign(f);let g=ZW(a.r,ZW(a.g,a.b));XL(g.lessThan(c),()=>a);let h=YS(1,c),i=YS(1,h.mul(h).div(g.add(h.sub(c))));a.mulAssign(i.div(g));let j=YS(1,YU(1,d.mul(g.sub(i)).add(1)));return Z8(a,XW(i),j)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class afg extends WW{static get type(){return"CodeNode"}constructor(a="",b=[],c=""){super("code"),this.isCodeNode=!0,this.global=!0,this.code=a,this.includes=b,this.language=c}setIncludes(a){return this.includes=a,this}getIncludes(){return this.includes}generate(a){for(let b of this.getIncludes(a))b.build(a);let b=a.getCodeFromNode(this,this.getNodeType(a));return b.code=this.code,b.code}serialize(a){super.serialize(a),a.code=this.code,a.language=this.language}deserialize(a){super.deserialize(a),this.code=a.code,this.language=a.language}}let afh=XD(afg).setParameterLength(1,3);class afi extends afg{static get type(){return"FunctionNode"}constructor(a="",b=[],c=""){super(a,b,c)}getNodeType(a){return this.getNodeFunction(a).type}getMemberType(a,b){let c=this.getNodeType(a);return a.getStructTypeNode(c).getMemberType(a,b)}getInputs(a){return this.getNodeFunction(a).inputs}getNodeFunction(a){let b=a.getDataFromNode(this),c=b.nodeFunction;return void 0===c&&(b.nodeFunction=c=a.parser.parseFunction(this.code)),c}generate(a,b){super.generate(a);let c=this.getNodeFunction(a),d=c.name,e=c.type,f=a.getCodeFromNode(this,e);""!==d&&(f.name=d);let g=a.getPropertyName(f);return f.code=this.getNodeFunction(a).getCode(g)+`
`,"property"===b?g:a.format(`${g}()`,e,b)}}let afj=(a,b=[],c="")=>{for(let a=0;a<b.length;a++){let c=b[a];"function"==typeof c&&(b[a]=c.functionNode)}let d=Xz(new afi(a,b,c)),e=(...a)=>d.call(...a);return e.functionNode=d,e},afk=XD(class extends WW{static get type(){return"ScriptableValueNode"}constructor(a=null){super(),this._value=a,this._cache=null,this.inputType=null,this.outputType=null,this.events=new I3,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return null!==this.outputType}set value(a){this._value!==a&&(this._cache&&"URL"===this.inputType&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=a,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){let a=this.value;if(a&&null===this._cache&&"URL"===this.inputType&&a.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([a.value]));else if(a&&null!==a.value&&void 0!==a.value&&(("URL"===this.inputType||"String"===this.inputType)&&"string"==typeof a.value||"Number"===this.inputType&&"number"==typeof a.value||"Vector2"===this.inputType&&a.value.isVector2||"Vector3"===this.inputType&&a.value.isVector3||"Vector4"===this.inputType&&a.value.isVector4||"Color"===this.inputType&&a.value.isColor||"Matrix3"===this.inputType&&a.value.isMatrix3||"Matrix4"===this.inputType&&a.value.isMatrix4))return a.value;return this._cache||a}getNodeType(a){return this.value&&this.value.isNode?this.value.getNodeType(a):"float"}setup(){return this.value&&this.value.isNode?this.value:XO()}serialize(a){super.serialize(a),null!==this.value?"ArrayBuffer"===this.inputType?a.value=WM(this.value):a.value=this.value?this.value.toJSON(a.meta).uuid:null:a.value=null,a.inputType=this.inputType,a.outputType=this.outputType}deserialize(a){super.deserialize(a);let b=null;null!==a.value&&(b="ArrayBuffer"===a.inputType?WN(a.value):"Texture"===a.inputType?a.meta.textures[a.value]:a.meta.nodes[a.value]||null),this.value=b,this.inputType=a.inputType,this.outputType=a.outputType}}).setParameterLength(1);class afl extends Map{get(a,b=null,...c){if(this.has(a))return super.get(a);if(null!==b){let d=b(...c);return this.set(a,d),d}}}class afm{constructor(a){this.scriptableNode=a}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(a){return this.scriptableNode.getInputLayout(a)}get(a){let b=this.parameters[a];return b?b.getValue():null}}let afn=new afl,afo=XD(class extends WW{static get type(){return"ScriptableNode"}constructor(a=null,b={}){super(),this.codeNode=a,this.parameters=b,this._local=new afl,this._output=afk(null),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(a,b){return this._local.set(a,b)}getLocal(a){return this._local.get(a)}onRefresh(){this._refresh()}getInputLayout(a){for(let b of this.getLayout())if(b.inputType&&(b.id===a||b.name===a))return b}getOutputLayout(a){for(let b of this.getLayout())if(b.outputType&&(b.id===a||b.name===a))return b}setOutput(a,b){let c=this._outputs;return void 0===c[a]?c[a]=afk(b):c[a].value=b,this}getOutput(a){return this._outputs[a]}getParameter(a){return this.parameters[a]}setParameter(a,b){let c=this.parameters;return b&&b.isScriptableNode?(this.deleteParameter(a),c[a]=b,c[a].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):b&&b.isScriptableValueNode?(this.deleteParameter(a),c[a]=b,c[a].events.addEventListener("refresh",this.onRefresh)):void 0===c[a]?(c[a]=afk(b),c[a].events.addEventListener("refresh",this.onRefresh)):c[a].value=b,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(a){let b=this.parameters[a];return b&&(b.isScriptableNode&&(b=b.getDefaultOutput()),b.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(let a of Object.keys(this.parameters))this.deleteParameter(a);return this.needsUpdate=!0,this}call(a,...b){let c=this.getObject()[a];if("function"==typeof c)return c(...b)}async callAsync(a,...b){let c=this.getObject()[a];if("function"==typeof c)return"AsyncFunction"===c.constructor.name?await c(...b):c(...b)}getNodeType(a){return this.getDefaultOutputNode().getNodeType(a)}refresh(a=null){null!==a?this.getOutput(a).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),null!==this._object)return this._object;let a=()=>this.refresh(),b=(a,b)=>this.setOutput(a,b),c=new afm(this),d=afn.get("THREE"),e=afn.get("TSL"),f=this.getMethod(),g=[c,this._local,afn,a,b,d,e];this._object=f(...g);let h=this._object.layout;if(h&&(!1===h.cache&&this._local.clear(),this._output.outputType=h.outputType||null,Array.isArray(h.elements)))for(let a of h.elements){let b=a.id||a.name;a.inputType&&(void 0===this.getParameter(b)&&this.setParameter(b,null),this.getParameter(b).inputType=a.inputType),a.outputType&&(void 0===this.getOutput(b)&&this.setOutput(b,null),this.getOutput(b).outputType=a.outputType)}return this._object}deserialize(a){for(let b in super.deserialize(a),this.parameters){let a=this.parameters[b];a.isScriptableNode&&(a=a.getDefaultOutput()),a.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){let a=this.getDefaultOutput().value;return a&&a.isNode?a:XO()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),null!==this._method)return this._method;let a="layout, init, main, dispose",b="var "+a+`; var output = {};
`,c=`
return { ...output, `+a+" };",d=b+this.codeNode.code+c;return this._method=Function("parameters","local","global","refresh","setOutput","THREE","TSL",d),this._method}dispose(){null!==this._method&&(this._object&&"function"==typeof this._object.dispose&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}getCacheKey(a){let b=[WE(this.source),this.getDefaultOutputNode().getCacheKey(a)];for(let c in this.parameters)b.push(this.parameters[c].getCacheKey(a));return WD(b)}set needsUpdate(a){!0===a&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return null===this.codeNode||(!0===this._needsOutputUpdate&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value),this}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}).setParameterLength(1,2);function afp(a){let b,c=a.context.getViewZ;return void 0!==c&&(b=c(this)),(b||_4.z).negate()}let afq=XI(([a,b],c)=>$c(a,b,afp(c))),afr=XI(([a],b)=>{let c=afp(b);return a.mul(a,c,c).negate().exp().oneMinus()}),afs=XI(([a,b])=>X$(b.toFloat().mix(Ys.rgb,a.toVec3()),Ys.a)),aft=null,afu=null,afv=XD(class extends WW{static get type(){return"RangeNode"}constructor(a=XO(),b=XO()){super(),this.minNode=a,this.maxNode=b}getVectorLength(a){let b=this.getConstNode(this.minNode),c=this.getConstNode(this.maxNode),d=a.getTypeLength(WJ(b.value)),e=a.getTypeLength(WJ(c.value));return d>e?d:e}getNodeType(a){return a.object.count>1?a.getTypeFromLength(this.getVectorLength(a)):"float"}getConstNode(a){let b=null;if(a.traverse(a=>{!0===a.isConstNode&&(b=a)}),null===b)throw Error('THREE.TSL: No "ConstNode" found in node graph.');return b}setup(a){let b=a.object,c=null;if(b.count>1){let d=this.getConstNode(this.minNode),e=this.getConstNode(this.maxNode),f=d.value,g=e.value,h=a.getTypeLength(WJ(f)),i=a.getTypeLength(WJ(g));aft=aft||new Jv,afu=afu||new Jv,aft.setScalar(0),afu.setScalar(0),1===h?aft.setScalar(f):f.isColor?aft.set(f.r,f.g,f.b,1):aft.set(f.x,f.y,f.z||0,f.w||0),1===i?afu.setScalar(g):g.isColor?afu.set(g.r,g.g,g.b,1):afu.set(g.x,g.y,g.z||0,g.w||0);let j=4*b.count,k=new Float32Array(j);for(let a=0;a<j;a++){let b=a%4,c=aft.getComponent(b),d=afu.getComponent(b);k[a]=I9(c,d,Math.random())}let l=this.getNodeType(a);if(b.count<=4096)c=_h(k,"vec4",b.count).element(abM).convert(l);else{let b=new Ly(k,4);a.geometry.setAttribute("__range"+this.id,b),c=$N(b).convert(l)}}else c=XO(0);return c}}).setParameterLength(2);class afw extends WW{static get type(){return"ComputeBuiltinNode"}constructor(a,b){super(b),this._builtinName=a}getHash(a){return this.getBuiltinName(a)}getNodeType(){return this.nodeType}setBuiltinName(a){return this._builtinName=a,this}getBuiltinName(){return this._builtinName}hasBuiltin(a){return a.hasBuiltin(this._builtinName)}generate(a,b){let c=this.getBuiltinName(a),d=this.getNodeType(a);return"compute"===a.shaderStage?a.format(c,d,b):(I0(`ComputeBuiltinNode: Compute built-in value ${c} can not be accessed in the ${a.shaderStage} stage`),a.generateConst(d))}serialize(a){super.serialize(a),a.global=this.global,a._builtinName=this._builtinName}deserialize(a){super.deserialize(a),this.global=a.global,this._builtinName=a._builtinName}}let afx=(a,b)=>Xz(new afw(a,b)),afy=afx("numWorkgroups","uvec3"),afz=afx("workgroupId","uvec3"),afA=afx("globalId","uvec3"),afB=afx("localId","uvec3"),afC=afx("subgroupSize","uint"),afD=XD(class extends WW{constructor(a){super(),this.scope=a}generate(a){let{scope:b}=this,{renderer:c}=a;!0===c.backend.isWebGLBackend?a.addFlowCode(`	// ${b}Barrier 
`):a.addLineFlowCode(`${b}Barrier()`,this)}});class afE extends WX{constructor(a,b){super(a,b),this.isWorkgroupInfoElementNode=!0}generate(a,b){let c,d=a.context.assign;if(c=super.generate(a),!0!==d){let d=this.getNodeType(a);c=a.format(c,d,b)}return c}}class afF extends WW{constructor(a,b,c=0){super(b),this.bufferType=b,this.bufferCount=c,this.isWorkgroupInfoNode=!0,this.elementType=b,this.scope=a,this.name=""}setName(a){return this.name=a,this}label(a){return I0('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(a)}setScope(a){return this.scope=a,this}getElementType(){return this.elementType}getInputType(){return`${this.scope}Array`}element(a){return Xz(new afE(this,a))}generate(a){let b=""!==this.name?this.name:`${this.scope}Array_${this.id}`;return a.getScopedArray(b,this.scope.toLowerCase(),this.bufferType,this.bufferCount)}}class afG extends WW{static get type(){return"AtomicFunctionNode"}constructor(a,b,c){super("uint"),this.method=a,this.pointerNode=b,this.valueNode=c,this.parents=!0}getInputType(a){return this.pointerNode.getNodeType(a)}getNodeType(a){return this.getInputType(a)}generate(a){let b=a.getNodeProperties(this),c=b.parents,d=this.method,e=this.getNodeType(a),f=this.getInputType(a),g=this.pointerNode,h=this.valueNode,i=[];i.push(`&${g.build(a,f)}`),null!==h&&i.push(h.build(a,f));let j=`${a.getMethod(d,e)}( ${i.join(", ")} )`;if(!c||1!==c.length||!0!==c[0].isStackNode)return void 0===b.constNode&&(b.constNode=$Z(j,e).toConst()),b.constNode.build(a);a.addLineFlowCode(j,this)}}afG.ATOMIC_LOAD="atomicLoad",afG.ATOMIC_STORE="atomicStore",afG.ATOMIC_ADD="atomicAdd",afG.ATOMIC_SUB="atomicSub",afG.ATOMIC_MAX="atomicMax",afG.ATOMIC_MIN="atomicMin",afG.ATOMIC_AND="atomicAnd",afG.ATOMIC_OR="atomicOr",afG.ATOMIC_XOR="atomicXor";let afH=XD(afG),afI=(a,b,c)=>afH(a,b,c).toStack();class afJ extends WZ{static get type(){return"SubgroupFunctionNode"}constructor(a,b=null,c=null){super(),this.method=a,this.aNode=b,this.bNode=c}getInputType(a){let b=this.aNode?this.aNode.getNodeType(a):null,c=this.bNode?this.bNode.getNodeType(a):null;return(a.isMatrix(b)?0:a.getTypeLength(b))>(a.isMatrix(c)?0:a.getTypeLength(c))?b:c}getNodeType(a){let b=this.method;return b===afJ.SUBGROUP_ELECT?"bool":b===afJ.SUBGROUP_BALLOT?"uvec4":this.getInputType(a)}generate(a,b){let c=this.method,d=this.getNodeType(a),e=this.getInputType(a),f=this.aNode,g=this.bNode,h=[];if(c===afJ.SUBGROUP_BROADCAST||c===afJ.SUBGROUP_SHUFFLE||c===afJ.QUAD_BROADCAST){let b=g.getNodeType(a);h.push(f.build(a,d),g.build(a,"float"===b?"int":d))}else c===afJ.SUBGROUP_SHUFFLE_XOR||c===afJ.SUBGROUP_SHUFFLE_DOWN||c===afJ.SUBGROUP_SHUFFLE_UP?h.push(f.build(a,d),g.build(a,"uint")):(null!==f&&h.push(f.build(a,e)),null!==g&&h.push(g.build(a,e)));let i=0===h.length?"()":`( ${h.join(", ")} )`;return a.format(`${a.getMethod(c,d)}${i}`,d,b)}serialize(a){super.serialize(a),a.method=this.method}deserialize(a){super.deserialize(a),this.method=a.method}}afJ.SUBGROUP_ELECT="subgroupElect",afJ.SUBGROUP_BALLOT="subgroupBallot",afJ.SUBGROUP_ADD="subgroupAdd",afJ.SUBGROUP_INCLUSIVE_ADD="subgroupInclusiveAdd",afJ.SUBGROUP_EXCLUSIVE_AND="subgroupExclusiveAdd",afJ.SUBGROUP_MUL="subgroupMul",afJ.SUBGROUP_INCLUSIVE_MUL="subgroupInclusiveMul",afJ.SUBGROUP_EXCLUSIVE_MUL="subgroupExclusiveMul",afJ.SUBGROUP_AND="subgroupAnd",afJ.SUBGROUP_OR="subgroupOr",afJ.SUBGROUP_XOR="subgroupXor",afJ.SUBGROUP_MIN="subgroupMin",afJ.SUBGROUP_MAX="subgroupMax",afJ.SUBGROUP_ALL="subgroupAll",afJ.SUBGROUP_ANY="subgroupAny",afJ.SUBGROUP_BROADCAST_FIRST="subgroupBroadcastFirst",afJ.QUAD_SWAP_X="quadSwapX",afJ.QUAD_SWAP_Y="quadSwapY",afJ.QUAD_SWAP_DIAGONAL="quadSwapDiagonal",afJ.SUBGROUP_BROADCAST="subgroupBroadcast",afJ.SUBGROUP_SHUFFLE="subgroupShuffle",afJ.SUBGROUP_SHUFFLE_XOR="subgroupShuffleXor",afJ.SUBGROUP_SHUFFLE_UP="subgroupShuffleUp",afJ.SUBGROUP_SHUFFLE_DOWN="subgroupShuffleDown",afJ.QUAD_BROADCAST="quadBroadcast";let afK=XF(afJ,afJ.SUBGROUP_ELECT).setParameterLength(0),afL=XF(afJ,afJ.SUBGROUP_BALLOT).setParameterLength(1),afM=XF(afJ,afJ.SUBGROUP_ADD).setParameterLength(1),afN=XF(afJ,afJ.SUBGROUP_INCLUSIVE_ADD).setParameterLength(1),afO=XF(afJ,afJ.SUBGROUP_EXCLUSIVE_AND).setParameterLength(1),afP=XF(afJ,afJ.SUBGROUP_MUL).setParameterLength(1),afQ=XF(afJ,afJ.SUBGROUP_INCLUSIVE_MUL).setParameterLength(1),afR=XF(afJ,afJ.SUBGROUP_EXCLUSIVE_MUL).setParameterLength(1),afS=XF(afJ,afJ.SUBGROUP_AND).setParameterLength(1),afT=XF(afJ,afJ.SUBGROUP_OR).setParameterLength(1),afU=XF(afJ,afJ.SUBGROUP_XOR).setParameterLength(1),afV=XF(afJ,afJ.SUBGROUP_MIN).setParameterLength(1),afW=XF(afJ,afJ.SUBGROUP_MAX).setParameterLength(1),afX=XF(afJ,afJ.SUBGROUP_ALL).setParameterLength(0),afY=XF(afJ,afJ.SUBGROUP_ANY).setParameterLength(0),afZ=XF(afJ,afJ.SUBGROUP_BROADCAST_FIRST).setParameterLength(2),af$=XF(afJ,afJ.QUAD_SWAP_X).setParameterLength(1),af_=XF(afJ,afJ.QUAD_SWAP_Y).setParameterLength(1),af0=XF(afJ,afJ.QUAD_SWAP_DIAGONAL).setParameterLength(1),af1=XF(afJ,afJ.SUBGROUP_BROADCAST).setParameterLength(2),af2=XF(afJ,afJ.SUBGROUP_SHUFFLE).setParameterLength(2),af3=XF(afJ,afJ.SUBGROUP_SHUFFLE_XOR).setParameterLength(2),af4=XF(afJ,afJ.SUBGROUP_SHUFFLE_UP).setParameterLength(2),af5=XF(afJ,afJ.SUBGROUP_SHUFFLE_DOWN).setParameterLength(2),af6=XF(afJ,afJ.QUAD_BROADCAST).setParameterLength(1);function af7(a){let b=(e=e||new WeakMap).get(a);return void 0===b&&e.set(a,b={}),b}function af8(a){let b=af7(a);return b.shadowMatrix||(b.shadowMatrix=YJ("mat4").setGroup(YG).onRenderUpdate(b=>((!0!==a.castShadow||!1===b.renderer.shadowMap.enabled)&&(a.shadow.camera.coordinateSystem!==b.camera.coordinateSystem&&(a.shadow.camera.coordinateSystem=b.camera.coordinateSystem,a.shadow.camera.updateProjectionMatrix()),a.shadow.updateMatrices(a)),a.shadow.matrix)))}function af9(a){let b=af7(a);return b.position||(b.position=YJ(new Je).setGroup(YG).onRenderUpdate((b,c)=>c.value.setFromMatrixPosition(a.matrixWorld)))}function aga(a){let b=af7(a);return b.targetPosition||(b.targetPosition=YJ(new Je).setGroup(YG).onRenderUpdate((b,c)=>c.value.setFromMatrixPosition(a.target.matrixWorld)))}let agb=(a,b)=>{for(let c of b)if(c.isAnalyticLightNode&&c.light.id===a)return c;return null},agc=new WeakMap,agd=[];class age extends WW{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=X8("vec3","totalDiffuse"),this.totalSpecularNode=X8("vec3","totalSpecular"),this.outgoingLightNode=X8("vec3","outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){let a=this._lights;for(let b=0;b<a.length;b++){let c=a[b];if(agd.push(c.id),agd.push(+!!c.castShadow),!0===c.isSpotLight){let a=null!==c.map?c.map.id:-1,b=c.colorNode?c.colorNode.getCacheKey():-1;agd.push(a,b)}}let b=WD(agd);return agd.length=0,b}getHash(a){if(null===this._lightNodesHash){null===this._lightNodes&&this.setupLightsNode(a);let b=[];for(let a of this._lightNodes)b.push(a.getHash());this._lightNodesHash="lights-"+b.join(",")}return this._lightNodesHash}analyze(a){let b=a.getNodeProperties(this);for(let c of b.nodes)c.build(a);b.outputNode.build(a)}setupLightsNode(a){let b=[],c=this._lightNodes,d=this._lights.sort((a,b)=>a.id-b.id),e=a.renderer.library;for(let a of d)if(a.isNode)b.push(Xz(a));else{let d=null;if(null!==c&&(d=agb(a.id,c)),null===d){let c=e.getLightNodeClass(a.constructor);if(null===c){I0(`LightsNode.setupNodeLights: Light node not found for ${a.constructor.name}`);continue}let d=null;agc.has(a)?d=agc.get(a):(d=Xz(new c(a)),agc.set(a,d)),b.push(d)}}this._lightNodes=b}setupDirectLight(a,b,c){let{lightingModel:d,reflectedLight:e}=a.context;d.direct({...c,lightNode:b,reflectedLight:e},a)}setupDirectRectAreaLight(a,b,c){let{lightingModel:d,reflectedLight:e}=a.context;d.directRectArea({...c,lightNode:b,reflectedLight:e},a)}setupLights(a,b){for(let c of b)c.build(a)}getLightNodes(a){return null===this._lightNodes&&this.setupLightsNode(a),this._lightNodes}setup(a){let b=a.lightsNode;a.lightsNode=this;let c=this.outgoingLightNode,d=a.context,e=d.lightingModel,f=a.getNodeProperties(this);if(e){let{totalDiffuseNode:b,totalSpecularNode:g}=this;d.outgoingLight=c,f.nodes=a.addStack().nodes,e.start(a);let{backdrop:h,backdropAlpha:i}=d,{directDiffuse:j,directSpecular:k,indirectDiffuse:l,indirectSpecular:m}=d.reflectedLight,n=j.add(l);null!==h&&(n=null!==i?XW(i.mix(n,h)):XW(h)),b.assign(n),g.assign(k.add(m)),c.assign(b.add(g)),e.finish(a),c=c.bypass(a.removeStack())}else f.nodes=[];return a.lightsNode=b,c}setLights(a){return this._lights=a,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}class agf extends WW{static get type(){return"ShadowBaseNode"}constructor(a){super(),this.light=a,this.updateBeforeType=WP.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:a,material:b}){agg.assign(b.receivedShadowPositionNode||a.shadowPositionWorld||_2)}}let agg=X8("vec3","shadowPositionWorld"),agh=new WeakMap,agi=XI(({depthTexture:a,shadowCoord:b,depthLayer:c})=>{let d=_e(a,b.xy).setName("t_basic");return a.isArrayTexture&&(d=d.depth(c)),d.compare(b.z)}),agj=XI(({depthTexture:a,shadowCoord:b,shadow:c,depthLayer:d})=>{let e=(b,c)=>{let e=_e(a,b);return a.isArrayTexture&&(e=e.depth(d)),e.compare(c)},f=aaA("mapSize","vec2",c).setGroup(YG),g=aaA("radius","float",c).setGroup(YG),h=XS(1).div(f),i=h.x.negate().mul(g),j=h.y.negate().mul(g),k=h.x.mul(g),l=h.y.mul(g),m=i.div(2),n=j.div(2),o=k.div(2),p=l.div(2);return YR(e(b.xy.add(XS(i,j)),b.z),e(b.xy.add(XS(0,j)),b.z),e(b.xy.add(XS(k,j)),b.z),e(b.xy.add(XS(m,n)),b.z),e(b.xy.add(XS(0,n)),b.z),e(b.xy.add(XS(o,n)),b.z),e(b.xy.add(XS(i,0)),b.z),e(b.xy.add(XS(m,0)),b.z),e(b.xy,b.z),e(b.xy.add(XS(o,0)),b.z),e(b.xy.add(XS(k,0)),b.z),e(b.xy.add(XS(m,p)),b.z),e(b.xy.add(XS(0,p)),b.z),e(b.xy.add(XS(o,p)),b.z),e(b.xy.add(XS(i,l)),b.z),e(b.xy.add(XS(0,l)),b.z),e(b.xy.add(XS(k,l)),b.z)).mul(1/17)}),agk=XI(({depthTexture:a,shadowCoord:b,shadow:c,depthLayer:d})=>{let e=(b,c)=>{let e=_e(a,b);return a.isArrayTexture&&(e=e.depth(d)),e.compare(c)},f=aaA("mapSize","vec2",c).setGroup(YG),g=XS(1).div(f),h=g.x,i=g.y,j=b.xy,k=Zz(j.mul(f).add(.5));return j.subAssign(k.mul(g)),YR(e(j,b.z),e(j.add(XS(h,0)),b.z),e(j.add(XS(0,i)),b.z),e(j.add(g),b.z),Z8(e(j.add(XS(h.negate(),0)),b.z),e(j.add(XS(h.mul(2),0)),b.z),k.x),Z8(e(j.add(XS(h.negate(),i)),b.z),e(j.add(XS(h.mul(2),i)),b.z),k.x),Z8(e(j.add(XS(0,i.negate())),b.z),e(j.add(XS(0,i.mul(2))),b.z),k.y),Z8(e(j.add(XS(h,i.negate())),b.z),e(j.add(XS(h,i.mul(2))),b.z),k.y),Z8(Z8(e(j.add(XS(h.negate(),i.negate())),b.z),e(j.add(XS(h.mul(2),i.negate())),b.z),k.x),Z8(e(j.add(XS(h.negate(),i.mul(2))),b.z),e(j.add(XS(h.mul(2),i.mul(2))),b.z),k.x),k.y)).mul(1/9)}),agl=XI(({depthTexture:a,shadowCoord:b,depthLayer:c})=>{let d=XO(1).toVar(),e=_e(a).sample(b.xy);a.isArrayTexture&&(e=e.depth(c)),e=e.rg;let f=ZX(b.z,e.x);return XL(f.notEqual(XO(1)),()=>{let a=b.z.sub(e.x),c=ZW(0,e.y.mul(e.y)),g=c.div(c.add(a.mul(a)));g=Z9(YS(g,.3).div(.95-.3)),d.assign(Z9(ZW(f,g)))}),d}),agm=XI(([a,b,c])=>{let d=_2.sub(a).length();return(d=d.sub(b).div(c.sub(b))).saturate()}),agn=a=>{let b=agh.get(a);if(void 0===b){let c,d,e,f=a.isPointLight?(d=aaA("near","float",c=a.shadow.camera).setGroup(YG),e=aaA("far","float",c).setGroup(YG),agm(_K(a),d,e)):null;(b=new acC).colorNode=X$(0,0,0,1),b.depthNode=f,b.isShadowPassMaterial=!0,b.name="ShadowMaterial",b.fog=!1,agh.set(a,b)}return b},ago=new class{constructor(){this.weakMap=new WeakMap}get(a){let b=this.weakMap;for(let c=0;c<a.length-1;c++)if(void 0===(b=b.get(a[c])))return;return b.get(a[a.length-1])}set(a,b){let c=this.weakMap;for(let b=0;b<a.length-1;b++){let d=a[b];!1===c.has(d)&&c.set(d,new WeakMap),c=c.get(d)}return c.set(a[a.length-1],b),this}delete(a){let b=this.weakMap;for(let c=0;c<a.length-1;c++)if(void 0===(b=b.get(a[c])))return!1;return b.delete(a[a.length-1])}},agp=[],agq=(a,b,c,d)=>{agp[0]=a,agp[1]=b;let e=ago.get(agp);return(void 0===e||e.shadowType!==c||e.useVelocity!==d)&&((e=(e,f,g,h,i,j,...k)=>{(!0===e.castShadow||e.receiveShadow&&3===c)&&(d&&(WL(e).useVelocity=!0),e.onBeforeShadow(a,e,g,b.camera,h,f.overrideMaterial,j),a.renderObject(e,f,g,h,i,j,...k),e.onAfterShadow(a,e,g,b.camera,h,f.overrideMaterial,j))}).shadowType=c,e.useVelocity=d,ago.set(agp,e)),agp[0]=null,agp[1]=null,e},agr=XI(({samples:a,radius:b,size:c,shadowPass:d,depthLayer:e})=>{let f=XO(0).toVar("meanVertical"),g=XO(0).toVar("squareMeanVertical"),h=a.lessThanEqual(XO(1)).select(XO(0),XO(2).div(a.sub(1))),i=a.lessThanEqual(XO(1)).select(XO(0),XO(-1));ab0({start:XP(0),end:XP(a),type:"int",condition:"<"},({i:a})=>{let j=i.add(XO(a).mul(h)),k=d.sample(YR(_q.xy,XS(0,j).mul(b)).div(c));d.value.isArrayTexture&&(k=k.depth(e)),k=k.x,f.addAssign(k),g.addAssign(k.mul(k))}),f.divAssign(a),g.divAssign(a);let j=Zu(g.sub(f.mul(f)));return XS(f,j)}),ags=XI(({samples:a,radius:b,size:c,shadowPass:d,depthLayer:e})=>{let f=XO(0).toVar("meanHorizontal"),g=XO(0).toVar("squareMeanHorizontal"),h=a.lessThanEqual(XO(1)).select(XO(0),XO(2).div(a.sub(1))),i=a.lessThanEqual(XO(1)).select(XO(0),XO(-1));ab0({start:XP(0),end:XP(a),type:"int",condition:"<"},({i:a})=>{let j=i.add(XO(a).mul(h)),k=d.sample(YR(_q.xy,XS(j,0).mul(b)).div(c));d.value.isArrayTexture&&(k=k.depth(e)),f.addAssign(k.x),g.addAssign(YR(k.y.mul(k.y),k.x.mul(k.x)))}),f.divAssign(a),g.divAssign(a);let j=Zu(g.sub(f.mul(f)));return XS(f,j)}),agt=[agi,agj,agk,agl],agu=new aeu;class agv extends agf{static get type(){return"ShadowNode"}constructor(a,b=null){super(a),this.shadow=b||a.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._currentShadowType=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0,this.depthLayer=0}setupShadowFilter(a,{filterFn:b,depthTexture:c,shadowCoord:d,shadow:e,depthLayer:f}){let g=d.x.greaterThanEqual(0).and(d.x.lessThanEqual(1)).and(d.y.greaterThanEqual(0)).and(d.y.lessThanEqual(1)).and(d.z.lessThanEqual(1)),h=b({depthTexture:c,shadowCoord:d,shadow:e,depthLayer:f});return g.select(h,XO(1))}setupShadowCoord(a,b){let{shadow:c}=this,{renderer:d}=a,e=aaA("bias","float",c).setGroup(YG),f=b,g;if(c.camera.isOrthographicCamera||!0!==d.logarithmicDepthBuffer)g=(f=f.xyz.div(f.w)).z,2001===d.coordinateSystem&&(g=g.mul(2).sub(1));else{let a=f.w;f=f.xy.div(a);let b=aaA("near","float",c.camera).setGroup(YG),d=aaA("far","float",c.camera).setGroup(YG);g=ack(a.negate(),b,d)}return XW(f.x,f.y.oneMinus(),g.add(e))}getShadowFilterFn(a){return agt[a]}setupRenderTarget(a,b){let c=new LI(a.mapSize.width,a.mapSize.height);c.name="ShadowDepthTexture",c.compareFunction=513;let d=b.createRenderTarget(a.mapSize.width,a.mapSize.height);return d.texture.name="ShadowMap",d.texture.type=a.mapType,d.depthTexture=c,{shadowMap:d,depthTexture:c}}setupShadow(a){let{renderer:b,camera:c}=a,{light:d,shadow:e}=this,f=b.shadowMap.type,{depthTexture:g,shadowMap:h}=this.setupRenderTarget(e,a);if(e.camera.coordinateSystem=c.coordinateSystem,e.camera.updateProjectionMatrix(),3===f&&!0!==e.isPointLightShadow){g.compareFunction=null,h.depth>1?(h._vsmShadowMapVertical||(h._vsmShadowMapVertical=a.createRenderTarget(e.mapSize.width,e.mapSize.height,{format:1030,type:1016,depth:h.depth,depthBuffer:!1}),h._vsmShadowMapVertical.texture.name="VSMVertical"),this.vsmShadowMapVertical=h._vsmShadowMapVertical,h._vsmShadowMapHorizontal||(h._vsmShadowMapHorizontal=a.createRenderTarget(e.mapSize.width,e.mapSize.height,{format:1030,type:1016,depth:h.depth,depthBuffer:!1}),h._vsmShadowMapHorizontal.texture.name="VSMHorizontal"),this.vsmShadowMapHorizontal=h._vsmShadowMapHorizontal):(this.vsmShadowMapVertical=a.createRenderTarget(e.mapSize.width,e.mapSize.height,{format:1030,type:1016,depthBuffer:!1}),this.vsmShadowMapHorizontal=a.createRenderTarget(e.mapSize.width,e.mapSize.height,{format:1030,type:1016,depthBuffer:!1}));let b=_e(g);g.isArrayTexture&&(b=b.depth(this.depthLayer));let c=_e(this.vsmShadowMapVertical.texture);g.isArrayTexture&&(c=c.depth(this.depthLayer));let d=aaA("blurSamples","float",e).setGroup(YG),f=aaA("radius","float",e).setGroup(YG),i=aaA("mapSize","vec2",e).setGroup(YG),j=this.vsmMaterialVertical||(this.vsmMaterialVertical=new acC);j.fragmentNode=agr({samples:d,radius:f,size:i,shadowPass:b,depthLayer:this.depthLayer}).context(a.getSharedContext()),j.name="VSMVertical",(j=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new acC)).fragmentNode=ags({samples:d,radius:f,size:i,shadowPass:c,depthLayer:this.depthLayer}).context(a.getSharedContext()),j.name="VSMHorizontal"}let i=aaA("intensity","float",e).setGroup(YG),j=aaA("normalBias","float",e).setGroup(YG),k=af8(d).mul(agg.add(aaf.mul(j))),l=this.setupShadowCoord(a,k),m=e.filterNode||this.getShadowFilterFn(b.shadowMap.type)||null;if(null===m)throw Error("THREE.WebGPURenderer: Shadow map type not supported yet.");let n=3===f&&!0!==e.isPointLightShadow?this.vsmShadowMapHorizontal.texture:g,o=this.setupShadowFilter(a,{filterFn:m,shadowTexture:h.texture,depthTexture:n,shadowCoord:l,shadow:e,depthLayer:this.depthLayer}),p=_e(h.texture,l);g.isArrayTexture&&(p=p.depth(this.depthLayer));let q=Z8(1,o.rgb.mix(p,1),i.mul(p.a)).toVar();this.shadowMap=h,this.shadow.map=h;let r=`${this.light.type} Shadow [ ${this.light.name||"ID: "+this.light.id} ]`;return q.toInspector(`${r} / Color`,()=>_e(this.shadowMap.texture)).toInspector(`${r} / Depth`,()=>_f(this.shadowMap.depthTexture,$8().mul($9(_e(this.shadowMap.depthTexture)))).x.oneMinus())}setup(a){if(!1!==a.renderer.shadowMap.enabled)return XI(()=>{let b=a.renderer.shadowMap.type;this._currentShadowType!==b&&(this._reset(),this._node=null);let c=this._node;return this.setupShadowPosition(a),null===c&&(this._node=c=this.setupShadow(a),this._currentShadowType=b),a.material.shadowNode&&I0('NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),a.material.receivedShadowNode&&(c=a.material.receivedShadowNode(c)),c})()}renderShadow(a){let{shadow:b,shadowMap:c,light:d}=this,{renderer:e,scene:f}=a;b.updateMatrices(d),c.setSize(b.mapSize.width,b.mapSize.height,c.depth);let g=f.name;f.name=`Shadow Map [ ${d.name||"ID: "+d.id} ]`,e.render(f,b.camera),f.name=g}updateShadow(a){var b,c,d;let{shadowMap:e,light:g,shadow:h}=this,{renderer:i,scene:j,camera:k}=a,l=i.shadowMap.type,m=e.depthTexture.version;this._depthVersionCached=m;let n=h.camera.layers.mask;(0xfffffffe&h.camera.layers.mask)==0&&(h.camera.layers.mask=k.layers.mask);let o=i.getRenderObjectFunction(),p=i.getMRT(),q=!!p&&p.has("velocity");b=function(a,b={}){return b.toneMapping=a.toneMapping,b.toneMappingExposure=a.toneMappingExposure,b.outputColorSpace=a.outputColorSpace,b.renderTarget=a.getRenderTarget(),b.activeCubeFace=a.getActiveCubeFace(),b.activeMipmapLevel=a.getActiveMipmapLevel(),b.renderObjectFunction=a.getRenderObjectFunction(),b.pixelRatio=a.getPixelRatio(),b.mrt=a.getMRT(),b.clearColor=a.getClearColor(b.clearColor||new KH),b.clearAlpha=a.getClearAlpha(),b.autoClear=a.autoClear,b.scissorTest=a.getScissorTest(),b}(i,b=f),i.setMRT(null),i.setRenderObjectFunction(null),i.setClearColor(0,1),i.autoClear=!0,c=function(a,b={}){return b.background=a.background,b.backgroundNode=a.backgroundNode,b.overrideMaterial=a.overrideMaterial,b}(j,c=b),j.background=null,j.backgroundNode=null,j.overrideMaterial=null,f=c,j.overrideMaterial=agn(g),i.setRenderObjectFunction(agq(i,h,l,q)),i.setClearColor(0,0),i.setRenderTarget(e),this.renderShadow(a),i.setRenderObjectFunction(o),3===l&&!0!==h.isPointLightShadow&&this.vsmPass(i),h.camera.layers.mask=n,i.toneMapping=(d=f).toneMapping,i.toneMappingExposure=d.toneMappingExposure,i.outputColorSpace=d.outputColorSpace,i.setRenderTarget(d.renderTarget,d.activeCubeFace,d.activeMipmapLevel),i.setRenderObjectFunction(d.renderObjectFunction),i.setPixelRatio(d.pixelRatio),i.setMRT(d.mrt),i.setClearColor(d.clearColor,d.clearAlpha),i.autoClear=d.autoClear,i.setScissorTest(d.scissorTest),j.background=d.background,j.backgroundNode=d.backgroundNode,j.overrideMaterial=d.overrideMaterial}vsmPass(a){let{shadow:b}=this,c=this.shadowMap.depth;this.vsmShadowMapVertical.setSize(b.mapSize.width,b.mapSize.height,c),this.vsmShadowMapHorizontal.setSize(b.mapSize.width,b.mapSize.height,c),a.setRenderTarget(this.vsmShadowMapVertical),agu.material=this.vsmMaterialVertical,agu.render(a),a.setRenderTarget(this.vsmShadowMapHorizontal),agu.material=this.vsmMaterialHorizontal,agu.render(a)}dispose(){this._reset(),super.dispose()}_reset(){this._currentShadowType=null,this.shadowMap&&(this.shadowMap.dispose(),this.shadowMap=null),null!==this.vsmShadowMapVertical&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),null!==this.vsmShadowMapHorizontal&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null)}updateBefore(a){let{shadow:b}=this,c=b.needsUpdate||b.autoUpdate;c&&(this._cameraFrameId[a.camera]===a.frameId&&(c=!1),this._cameraFrameId[a.camera]=a.frameId),c&&(this.updateShadow(a),this.shadowMap.depthTexture.version===this._depthVersionCached&&(b.needsUpdate=!1))}}let agw=new KH,agx=XI(([a,b])=>{let c=a.toVar(),d=ZG(c),e=YU(1,ZW(d.x,ZW(d.y,d.z)));d.mulAssign(e),c.mulAssign(e.mul(b.mul(2).oneMinus()));let f=XS(c.xy).toVar(),g=b.mul(1.5).oneMinus();return XL(d.z.greaterThanEqual(g),()=>{XL(c.z.greaterThan(0),()=>{f.x.assign(YS(4,c.x))})}).ElseIf(d.x.greaterThanEqual(g),()=>{let a=ZH(c.x);f.x.assign(c.z.mul(a).add(a.mul(2)))}).ElseIf(d.y.greaterThanEqual(g),()=>{let a=ZH(c.y);f.x.assign(c.x.add(a.mul(2)).add(2)),f.y.assign(c.z.mul(a).sub(2))}),XS(.125,.25).mul(f).add(XS(.375,.75)).flipY()}).setLayout({name:"cubeToUV",type:"vec2",inputs:[{name:"pos",type:"vec3"},{name:"texelSizeY",type:"float"}]}),agy=XI(({depthTexture:a,bd3D:b,dp:c,texelSize:d})=>_e(a,agx(b,d.y)).compare(c)),agz=XI(({depthTexture:a,bd3D:b,dp:c,texelSize:d,shadow:e})=>{let f=aaA("radius","float",e).setGroup(YG),g=XS(-1,1).mul(f).mul(d.y);return _e(a,agx(b.add(g.xyy),d.y)).compare(c).add(_e(a,agx(b.add(g.yyy),d.y)).compare(c)).add(_e(a,agx(b.add(g.xyx),d.y)).compare(c)).add(_e(a,agx(b.add(g.yyx),d.y)).compare(c)).add(_e(a,agx(b,d.y)).compare(c)).add(_e(a,agx(b.add(g.xxy),d.y)).compare(c)).add(_e(a,agx(b.add(g.yxy),d.y)).compare(c)).add(_e(a,agx(b.add(g.xxx),d.y)).compare(c)).add(_e(a,agx(b.add(g.yxx),d.y)).compare(c)).mul(1/9)}),agA=XI(({filterFn:a,depthTexture:b,shadowCoord:c,shadow:d})=>{let e=c.xyz.toVar(),f=e.length(),g=YJ("float").setGroup(YG).onRenderUpdate(()=>d.camera.near),h=YJ("float").setGroup(YG).onRenderUpdate(()=>d.camera.far),i=aaA("bias","float",d).setGroup(YG),j=YJ(d.mapSize).setGroup(YG),k=XO(1).toVar();return XL(f.sub(h).lessThanEqual(0).and(f.sub(g).greaterThanEqual(0)),()=>{let c=f.sub(g).div(h.sub(g)).toVar();c.addAssign(i);let l=e.normalize(),m=XS(1).div(j.mul(XS(4,2)));k.assign(a({depthTexture:b,bd3D:l,dp:c,texelSize:m,shadow:d}))}),k}),agB=new Jv,agC=new Jc,agD=new Jc;class agE extends agv{static get type(){return"PointShadowNode"}constructor(a,b=null){super(a,b)}getShadowFilterFn(a){return 0===a?agy:agz}setupShadowCoord(a,b){return b}setupShadowFilter(a,{filterFn:b,shadowTexture:c,depthTexture:d,shadowCoord:e,shadow:f}){return agA({filterFn:b,shadowTexture:c,depthTexture:d,shadowCoord:e,shadow:f})}renderShadow(a){let{shadow:b,shadowMap:c,light:d}=this,{renderer:e,scene:f}=a,g=b.getFrameExtents();agD.copy(b.mapSize),agD.multiply(g),c.setSize(agD.width,agD.height),agC.copy(b.mapSize);let h=e.autoClear,i=e.getClearColor(agw),j=e.getClearAlpha();e.autoClear=!1,e.setClearColor(b.clearColor,b.clearAlpha),e.clear();let k=b.getViewportCount();for(let a=0;a<k;a++){let g=b.getViewport(a),h=agC.x*g.x,i=agD.y-agC.y-agC.y*g.y;agB.set(h,i,agC.x*g.z,agC.y*g.w),c.viewport.copy(agB),b.updateMatrices(d,a);let j=f.name;f.name=`Point Light Shadow [ ${d.name||"ID: "+d.id} ] - Face ${a+1}`,e.render(f,b.camera),f.name=j}e.autoClear=h,e.setClearColor(i,j)}}let agF=XI(({lightDistance:a,cutoffDistance:b,decayExponent:c})=>{let d=a.pow(c).max(.01).reciprocal();return b.greaterThan(0).select(d.mul(a.div(b).pow4().oneMinus().clamp().pow2()),d)}),agG=XI(([a=$8()])=>{let b=a.mul(2),c=b.x.floor(),d=b.y.floor();return c.add(d).mod(2).sign()}),agH=XI(([a=$8()],{renderer:b,material:c})=>{let d,e=Z7(a.mul(2).sub(1));if(c.alphaToCoverage&&b.currentSamples>0){let a=XO(e.fwidth()).toVar();d=$c(a.oneMinus(),a.add(1),e).oneMinus()}else d=$j(e.greaterThan(1),0,1);return d}),agI=XI(([a,b,c])=>{let d=XO(c).toVar(),e=XO(b).toVar();return $j(XR(a).toVar(),e,d)}).setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]}),agJ=XI(([a,b])=>{let c=XR(b).toVar(),d=XO(a).toVar();return $j(c,d.negate(),d)}).setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]}),agK=XI(([a])=>XP(Zw(XO(a).toVar()))).setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]}),agL=XI(([a,b])=>{let c=XO(a).toVar();return b.assign(agK(c)),c.sub(XO(b))}),agM=ad2([XI(([a,b,c,d,e,f])=>{let g=XO(f).toVar(),h=XO(e).toVar(),i=XO(d).toVar(),j=XO(c).toVar(),k=XO(b).toVar(),l=XO(a).toVar(),m=XO(YS(1,h)).toVar();return YS(1,g).mul(l.mul(m).add(k.mul(h))).add(g.mul(j.mul(m).add(i.mul(h))))}).setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]}),XI(([a,b,c,d,e,f])=>{let g=XO(f).toVar(),h=XO(e).toVar(),i=XW(d).toVar(),j=XW(c).toVar(),k=XW(b).toVar(),l=XW(a).toVar(),m=XO(YS(1,h)).toVar();return YS(1,g).mul(l.mul(m).add(k.mul(h))).add(g.mul(j.mul(m).add(i.mul(h))))}).setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]})]),agN=ad2([XI(([a,b,c,d,e,f,g,h,i,j,k])=>{let l=XO(k).toVar(),m=XO(j).toVar(),n=XO(i).toVar(),o=XO(h).toVar(),p=XO(g).toVar(),q=XO(f).toVar(),r=XO(e).toVar(),s=XO(d).toVar(),t=XO(c).toVar(),u=XO(b).toVar(),v=XO(a).toVar(),w=XO(YS(1,n)).toVar(),x=XO(YS(1,m)).toVar();return XO(YS(1,l)).toVar().mul(x.mul(v.mul(w).add(u.mul(n))).add(m.mul(t.mul(w).add(s.mul(n))))).add(l.mul(x.mul(r.mul(w).add(q.mul(n))).add(m.mul(p.mul(w).add(o.mul(n))))))}).setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),XI(([a,b,c,d,e,f,g,h,i,j,k])=>{let l=XO(k).toVar(),m=XO(j).toVar(),n=XO(i).toVar(),o=XW(h).toVar(),p=XW(g).toVar(),q=XW(f).toVar(),r=XW(e).toVar(),s=XW(d).toVar(),t=XW(c).toVar(),u=XW(b).toVar(),v=XW(a).toVar(),w=XO(YS(1,n)).toVar(),x=XO(YS(1,m)).toVar();return XO(YS(1,l)).toVar().mul(x.mul(v.mul(w).add(u.mul(n))).add(m.mul(t.mul(w).add(s.mul(n))))).add(l.mul(x.mul(r.mul(w).add(q.mul(n))).add(m.mul(p.mul(w).add(o.mul(n))))))}).setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]})]),agO=ad2([XI(([a,b,c])=>{let d=XO(c).toVar(),e=XO(b).toVar(),f=XQ(a).toVar(),g=XQ(f.bitAnd(XQ(7))).toVar(),h=XO(agI(g.lessThan(XQ(4)),e,d)).toVar(),i=XO(YT(2,agI(g.lessThan(XQ(4)),d,e))).toVar();return agJ(h,XR(g.bitAnd(XQ(1)))).add(agJ(i,XR(g.bitAnd(XQ(2)))))}).setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]}),XI(([a,b,c,d])=>{let e=XO(d).toVar(),f=XO(c).toVar(),g=XO(b).toVar(),h=XQ(a).toVar(),i=XQ(h.bitAnd(XQ(15))).toVar(),j=XO(agI(i.lessThan(XQ(8)),g,f)).toVar(),k=XO(agI(i.lessThan(XQ(4)),f,agI(i.equal(XQ(12)).or(i.equal(XQ(14))),g,e))).toVar();return agJ(j,XR(i.bitAnd(XQ(1)))).add(agJ(k,XR(i.bitAnd(XQ(2)))))}).setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]})]),agP=ad2([XI(([a,b,c])=>{let d=XO(c).toVar(),e=XO(b).toVar(),f=XY(a).toVar();return XW(agO(f.x,e,d),agO(f.y,e,d),agO(f.z,e,d))}).setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]}),XI(([a,b,c,d])=>{let e=XO(d).toVar(),f=XO(c).toVar(),g=XO(b).toVar(),h=XY(a).toVar();return XW(agO(h.x,g,f,e),agO(h.y,g,f,e),agO(h.z,g,f,e))}).setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]})]),agQ=XI(([a])=>YT(.6616,XO(a).toVar())).setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]}),agR=XI(([a])=>YT(.982,XO(a).toVar())).setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]}),agS=ad2([agQ,XI(([a])=>YT(.6616,XW(a).toVar())).setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]})]),agT=ad2([agR,XI(([a])=>YT(.982,XW(a).toVar())).setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]})]),agU=XI(([a,b])=>{let c=XP(b).toVar(),d=XQ(a).toVar();return d.shiftLeft(c).bitOr(d.shiftRight(XP(32).sub(c)))}).setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]}),agV=XI(([a,b,c])=>{a.subAssign(c),a.bitXorAssign(agU(c,XP(4))),c.addAssign(b),b.subAssign(a),b.bitXorAssign(agU(a,XP(6))),a.addAssign(c),c.subAssign(b),c.bitXorAssign(agU(b,XP(8))),b.addAssign(a),a.subAssign(c),a.bitXorAssign(agU(c,XP(16))),c.addAssign(b),b.subAssign(a),b.bitXorAssign(agU(a,XP(19))),a.addAssign(c),c.subAssign(b),c.bitXorAssign(agU(b,XP(4))),b.addAssign(a)}),agW=XI(([a,b,c])=>{let d=XQ(c).toVar(),e=XQ(b).toVar(),f=XQ(a).toVar();return d.bitXorAssign(e),d.subAssign(agU(e,XP(14))),f.bitXorAssign(d),f.subAssign(agU(d,XP(11))),e.bitXorAssign(f),e.subAssign(agU(f,XP(25))),d.bitXorAssign(e),d.subAssign(agU(e,XP(16))),f.bitXorAssign(d),f.subAssign(agU(d,XP(4))),e.bitXorAssign(f),e.subAssign(agU(f,XP(14))),d.bitXorAssign(e),d.subAssign(agU(e,XP(24))),d}).setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]}),agX=XI(([a])=>XO(XQ(a).toVar()).div(XO(XQ(XP(0xffffffff))))).setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]}),agY=XI(([a])=>{let b=XO(a).toVar();return b.mul(b).mul(b).mul(b.mul(b.mul(6).sub(15)).add(10))}).setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]}),agZ=ad2([XI(([a])=>{let b=XP(a).toVar(),c=XQ(XQ(1)).toVar(),d=XQ(XQ(XP(0xdeadbeef)).add(c.shiftLeft(XQ(2))).add(XQ(13))).toVar();return agW(d.add(XQ(b)),d,d)}).setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]}),XI(([a,b])=>{let c=XP(b).toVar(),d=XP(a).toVar(),e=XQ(XQ(2)).toVar(),f=XQ().toVar(),g=XQ().toVar(),h=XQ().toVar();return f.assign(g.assign(h.assign(XQ(XP(0xdeadbeef)).add(e.shiftLeft(XQ(2))).add(XQ(13))))),f.addAssign(XQ(d)),g.addAssign(XQ(c)),agW(f,g,h)}).setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),XI(([a,b,c])=>{let d=XP(c).toVar(),e=XP(b).toVar(),f=XP(a).toVar(),g=XQ(XQ(3)).toVar(),h=XQ().toVar(),i=XQ().toVar(),j=XQ().toVar();return h.assign(i.assign(j.assign(XQ(XP(0xdeadbeef)).add(g.shiftLeft(XQ(2))).add(XQ(13))))),h.addAssign(XQ(f)),i.addAssign(XQ(e)),j.addAssign(XQ(d)),agW(h,i,j)}).setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),XI(([a,b,c,d])=>{let e=XP(d).toVar(),f=XP(c).toVar(),g=XP(b).toVar(),h=XP(a).toVar(),i=XQ(XQ(4)).toVar(),j=XQ().toVar(),k=XQ().toVar(),l=XQ().toVar();return j.assign(k.assign(l.assign(XQ(XP(0xdeadbeef)).add(i.shiftLeft(XQ(2))).add(XQ(13))))),j.addAssign(XQ(h)),k.addAssign(XQ(g)),l.addAssign(XQ(f)),agV(j,k,l),j.addAssign(XQ(e)),agW(j,k,l)}).setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]}),XI(([a,b,c,d,e])=>{let f=XP(e).toVar(),g=XP(d).toVar(),h=XP(c).toVar(),i=XP(b).toVar(),j=XP(a).toVar(),k=XQ(XQ(5)).toVar(),l=XQ().toVar(),m=XQ().toVar(),n=XQ().toVar();return l.assign(m.assign(n.assign(XQ(XP(0xdeadbeef)).add(k.shiftLeft(XQ(2))).add(XQ(13))))),l.addAssign(XQ(j)),m.addAssign(XQ(i)),n.addAssign(XQ(h)),agV(l,m,n),l.addAssign(XQ(g)),m.addAssign(XQ(f)),agW(l,m,n)}).setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]})]),ag$=ad2([XI(([a,b])=>{let c=XP(b).toVar(),d=XQ(agZ(XP(a).toVar(),c)).toVar(),e=XY().toVar();return e.x.assign(d.bitAnd(XP(255))),e.y.assign(d.shiftRight(XP(8)).bitAnd(XP(255))),e.z.assign(d.shiftRight(XP(16)).bitAnd(XP(255))),e}).setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),XI(([a,b,c])=>{let d=XP(c).toVar(),e=XP(b).toVar(),f=XQ(agZ(XP(a).toVar(),e,d)).toVar(),g=XY().toVar();return g.x.assign(f.bitAnd(XP(255))),g.y.assign(f.shiftRight(XP(8)).bitAnd(XP(255))),g.z.assign(f.shiftRight(XP(16)).bitAnd(XP(255))),g}).setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]})]),ag_=ad2([XI(([a])=>{let b=XS(a).toVar(),c=XP().toVar(),d=XP().toVar(),e=XO(agL(b.x,c)).toVar(),f=XO(agL(b.y,d)).toVar(),g=XO(agY(e)).toVar(),h=XO(agY(f)).toVar();return agS(XO(agM(agO(agZ(c,d),e,f),agO(agZ(c.add(XP(1)),d),e.sub(1),f),agO(agZ(c,d.add(XP(1))),e,f.sub(1)),agO(agZ(c.add(XP(1)),d.add(XP(1))),e.sub(1),f.sub(1)),g,h)).toVar())}).setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]}),XI(([a])=>{let b=XW(a).toVar(),c=XP().toVar(),d=XP().toVar(),e=XP().toVar(),f=XO(agL(b.x,c)).toVar(),g=XO(agL(b.y,d)).toVar(),h=XO(agL(b.z,e)).toVar(),i=XO(agY(f)).toVar(),j=XO(agY(g)).toVar(),k=XO(agY(h)).toVar();return agT(XO(agN(agO(agZ(c,d,e),f,g,h),agO(agZ(c.add(XP(1)),d,e),f.sub(1),g,h),agO(agZ(c,d.add(XP(1)),e),f,g.sub(1),h),agO(agZ(c.add(XP(1)),d.add(XP(1)),e),f.sub(1),g.sub(1),h),agO(agZ(c,d,e.add(XP(1))),f,g,h.sub(1)),agO(agZ(c.add(XP(1)),d,e.add(XP(1))),f.sub(1),g,h.sub(1)),agO(agZ(c,d.add(XP(1)),e.add(XP(1))),f,g.sub(1),h.sub(1)),agO(agZ(c.add(XP(1)),d.add(XP(1)),e.add(XP(1))),f.sub(1),g.sub(1),h.sub(1)),i,j,k)).toVar())}).setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]})]),ag0=ad2([XI(([a])=>{let b=XS(a).toVar(),c=XP().toVar(),d=XP().toVar(),e=XO(agL(b.x,c)).toVar(),f=XO(agL(b.y,d)).toVar(),g=XO(agY(e)).toVar(),h=XO(agY(f)).toVar();return agS(XW(agM(agP(ag$(c,d),e,f),agP(ag$(c.add(XP(1)),d),e.sub(1),f),agP(ag$(c,d.add(XP(1))),e,f.sub(1)),agP(ag$(c.add(XP(1)),d.add(XP(1))),e.sub(1),f.sub(1)),g,h)).toVar())}).setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),XI(([a])=>{let b=XW(a).toVar(),c=XP().toVar(),d=XP().toVar(),e=XP().toVar(),f=XO(agL(b.x,c)).toVar(),g=XO(agL(b.y,d)).toVar(),h=XO(agL(b.z,e)).toVar(),i=XO(agY(f)).toVar(),j=XO(agY(g)).toVar(),k=XO(agY(h)).toVar();return agT(XW(agN(agP(ag$(c,d,e),f,g,h),agP(ag$(c.add(XP(1)),d,e),f.sub(1),g,h),agP(ag$(c,d.add(XP(1)),e),f,g.sub(1),h),agP(ag$(c.add(XP(1)),d.add(XP(1)),e),f.sub(1),g.sub(1),h),agP(ag$(c,d,e.add(XP(1))),f,g,h.sub(1)),agP(ag$(c.add(XP(1)),d,e.add(XP(1))),f.sub(1),g,h.sub(1)),agP(ag$(c,d.add(XP(1)),e.add(XP(1))),f,g.sub(1),h.sub(1)),agP(ag$(c.add(XP(1)),d.add(XP(1)),e.add(XP(1))),f.sub(1),g.sub(1),h.sub(1)),i,j,k)).toVar())}).setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]})]),ag1=ad2([XI(([a])=>agX(agZ(XP(agK(XO(a).toVar())).toVar()))).setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]}),XI(([a])=>{let b=XS(a).toVar();return agX(agZ(XP(agK(b.x)).toVar(),XP(agK(b.y)).toVar()))}).setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]}),XI(([a])=>{let b=XW(a).toVar();return agX(agZ(XP(agK(b.x)).toVar(),XP(agK(b.y)).toVar(),XP(agK(b.z)).toVar()))}).setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]}),XI(([a])=>{let b=X$(a).toVar();return agX(agZ(XP(agK(b.x)).toVar(),XP(agK(b.y)).toVar(),XP(agK(b.z)).toVar(),XP(agK(b.w)).toVar()))}).setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]})]),ag2=ad2([XI(([a])=>{let b=XP(agK(XO(a).toVar())).toVar();return XW(agX(agZ(b,XP(0))),agX(agZ(b,XP(1))),agX(agZ(b,XP(2))))}).setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]}),XI(([a])=>{let b=XS(a).toVar(),c=XP(agK(b.x)).toVar(),d=XP(agK(b.y)).toVar();return XW(agX(agZ(c,d,XP(0))),agX(agZ(c,d,XP(1))),agX(agZ(c,d,XP(2))))}).setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),XI(([a])=>{let b=XW(a).toVar(),c=XP(agK(b.x)).toVar(),d=XP(agK(b.y)).toVar(),e=XP(agK(b.z)).toVar();return XW(agX(agZ(c,d,e,XP(0))),agX(agZ(c,d,e,XP(1))),agX(agZ(c,d,e,XP(2))))}).setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),XI(([a])=>{let b=X$(a).toVar(),c=XP(agK(b.x)).toVar(),d=XP(agK(b.y)).toVar(),e=XP(agK(b.z)).toVar(),f=XP(agK(b.w)).toVar();return XW(agX(agZ(c,d,e,f,XP(0))),agX(agZ(c,d,e,f,XP(1))),agX(agZ(c,d,e,f,XP(2))))}).setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]})]),ag3=XI(([a,b,c,d])=>{let e=XO(d).toVar(),f=XO(c).toVar(),g=XP(b).toVar(),h=XW(a).toVar(),i=XO(0).toVar(),j=XO(1).toVar();return ab0(g,()=>{i.addAssign(j.mul(ag_(h))),j.mulAssign(e),h.mulAssign(f)}),i}).setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),ag4=XI(([a,b,c,d])=>{let e=XO(d).toVar(),f=XO(c).toVar(),g=XP(b).toVar(),h=XW(a).toVar(),i=XW(0).toVar(),j=XO(1).toVar();return ab0(g,()=>{i.addAssign(j.mul(ag0(h))),j.mulAssign(e),h.mulAssign(f)}),i}).setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),ag5=XI(([a,b,c,d])=>{let e=XO(d).toVar(),f=XO(c).toVar(),g=XP(b).toVar(),h=XW(a).toVar();return XS(ag3(h,g,f,e),ag3(h.add(XW(XP(19),XP(193),XP(17))),g,f,e))}).setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),ag6=XI(([a,b,c,d])=>{let e=XO(d).toVar(),f=XO(c).toVar(),g=XP(b).toVar(),h=XW(a).toVar();return X$(XW(ag4(h,g,f,e)).toVar(),XO(ag3(h.add(XW(XP(19),XP(193),XP(17))),g,f,e)).toVar())}).setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),ag7=ad2([XI(([a,b,c,d,e,f,g])=>{let h=XP(g).toVar(),i=XO(f).toVar(),j=XP(e).toVar(),k=XP(d).toVar(),l=XP(c).toVar(),m=XP(b).toVar(),n=XS(a).toVar(),o=XW(ag2(XS(m.add(k),l.add(j)))).toVar(),p=XS(o.x,o.y).toVar();p.subAssign(.5),p.mulAssign(i),p.addAssign(.5);let q=XS(XS(XO(m),XO(l)).add(p)).toVar(),r=XS(q.sub(n)).toVar();return XL(h.equal(XP(2)),()=>ZG(r.x).add(ZG(r.y))),XL(h.equal(XP(3)),()=>ZW(ZG(r.x),ZG(r.y))),Z_(r,r)}).setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),XI(([a,b,c,d,e,f,g,h,i])=>{let j=XP(i).toVar(),k=XO(h).toVar(),l=XP(g).toVar(),m=XP(f).toVar(),n=XP(e).toVar(),o=XP(d).toVar(),p=XP(c).toVar(),q=XP(b).toVar(),r=XW(a).toVar(),s=XW(ag2(XW(q.add(n),p.add(m),o.add(l)))).toVar();s.subAssign(.5),s.mulAssign(k),s.addAssign(.5);let t=XW(XW(XO(q),XO(p),XO(o)).add(s)).toVar(),u=XW(t.sub(r)).toVar();return XL(j.equal(XP(2)),()=>ZG(u.x).add(ZG(u.y)).add(ZG(u.z))),XL(j.equal(XP(3)),()=>ZW(ZG(u.x),ZG(u.y),ZG(u.z))),Z_(u,u)}).setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]})]),ag8=XI(([a,b,c])=>{let d=XP(c).toVar(),e=XO(b).toVar(),f=XS(a).toVar(),g=XP().toVar(),h=XP().toVar(),i=XS(agL(f.x,g),agL(f.y,h)).toVar(),j=XO(1e6).toVar();return ab0({start:-1,end:XP(1),name:"x",condition:"<="},({x:a})=>{ab0({start:-1,end:XP(1),name:"y",condition:"<="},({y:b})=>{let c=XO(ag7(i,a,b,g,h,e,d)).toVar();j.assign(ZV(j,c))})}),XL(d.equal(XP(0)),()=>{j.assign(Zu(j))}),j}).setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),ag9=XI(([a,b,c])=>{let d=XP(c).toVar(),e=XO(b).toVar(),f=XS(a).toVar(),g=XP().toVar(),h=XP().toVar(),i=XS(agL(f.x,g),agL(f.y,h)).toVar(),j=XS(1e6,1e6).toVar();return ab0({start:-1,end:XP(1),name:"x",condition:"<="},({x:a})=>{ab0({start:-1,end:XP(1),name:"y",condition:"<="},({y:b})=>{let c=XO(ag7(i,a,b,g,h,e,d)).toVar();XL(c.lessThan(j.x),()=>{j.y.assign(j.x),j.x.assign(c)}).ElseIf(c.lessThan(j.y),()=>{j.y.assign(c)})})}),XL(d.equal(XP(0)),()=>{j.assign(Zu(j))}),j}).setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),aha=XI(([a,b,c])=>{let d=XP(c).toVar(),e=XO(b).toVar(),f=XS(a).toVar(),g=XP().toVar(),h=XP().toVar(),i=XS(agL(f.x,g),agL(f.y,h)).toVar(),j=XW(1e6,1e6,1e6).toVar();return ab0({start:-1,end:XP(1),name:"x",condition:"<="},({x:a})=>{ab0({start:-1,end:XP(1),name:"y",condition:"<="},({y:b})=>{let c=XO(ag7(i,a,b,g,h,e,d)).toVar();XL(c.lessThan(j.x),()=>{j.z.assign(j.y),j.y.assign(j.x),j.x.assign(c)}).ElseIf(c.lessThan(j.y),()=>{j.z.assign(j.y),j.y.assign(c)}).ElseIf(c.lessThan(j.z),()=>{j.z.assign(c)})})}),XL(d.equal(XP(0)),()=>{j.assign(Zu(j))}),j}).setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),ahb=ad2([ag8,XI(([a,b,c])=>{let d=XP(c).toVar(),e=XO(b).toVar(),f=XW(a).toVar(),g=XP().toVar(),h=XP().toVar(),i=XP().toVar(),j=XW(agL(f.x,g),agL(f.y,h),agL(f.z,i)).toVar(),k=XO(1e6).toVar();return ab0({start:-1,end:XP(1),name:"x",condition:"<="},({x:a})=>{ab0({start:-1,end:XP(1),name:"y",condition:"<="},({y:b})=>{ab0({start:-1,end:XP(1),name:"z",condition:"<="},({z:c})=>{let f=XO(ag7(j,a,b,c,g,h,i,e,d)).toVar();k.assign(ZV(k,f))})})}),XL(d.equal(XP(0)),()=>{k.assign(Zu(k))}),k}).setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]})]),ahc=ad2([ag9,XI(([a,b,c])=>{let d=XP(c).toVar(),e=XO(b).toVar(),f=XW(a).toVar(),g=XP().toVar(),h=XP().toVar(),i=XP().toVar(),j=XW(agL(f.x,g),agL(f.y,h),agL(f.z,i)).toVar(),k=XS(1e6,1e6).toVar();return ab0({start:-1,end:XP(1),name:"x",condition:"<="},({x:a})=>{ab0({start:-1,end:XP(1),name:"y",condition:"<="},({y:b})=>{ab0({start:-1,end:XP(1),name:"z",condition:"<="},({z:c})=>{let f=XO(ag7(j,a,b,c,g,h,i,e,d)).toVar();XL(f.lessThan(k.x),()=>{k.y.assign(k.x),k.x.assign(f)}).ElseIf(f.lessThan(k.y),()=>{k.y.assign(f)})})})}),XL(d.equal(XP(0)),()=>{k.assign(Zu(k))}),k}).setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]})]),ahd=ad2([aha,XI(([a,b,c])=>{let d=XP(c).toVar(),e=XO(b).toVar(),f=XW(a).toVar(),g=XP().toVar(),h=XP().toVar(),i=XP().toVar(),j=XW(agL(f.x,g),agL(f.y,h),agL(f.z,i)).toVar(),k=XW(1e6,1e6,1e6).toVar();return ab0({start:-1,end:XP(1),name:"x",condition:"<="},({x:a})=>{ab0({start:-1,end:XP(1),name:"y",condition:"<="},({y:b})=>{ab0({start:-1,end:XP(1),name:"z",condition:"<="},({z:c})=>{let f=XO(ag7(j,a,b,c,g,h,i,e,d)).toVar();XL(f.lessThan(k.x),()=>{k.z.assign(k.y),k.y.assign(k.x),k.x.assign(f)}).ElseIf(f.lessThan(k.y),()=>{k.z.assign(k.y),k.y.assign(f)}).ElseIf(f.lessThan(k.z),()=>{k.z.assign(f)})})})}),XL(d.equal(XP(0)),()=>{k.assign(Zu(k))}),k}).setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]})]),ahe=XI(([a,b,c,d,e,f,g,h,i,j,k])=>{let l=XP(a).toVar(),m=XS(b).toVar(),n=XS(c).toVar(),o=XS(d).toVar(),p=XO(e).toVar(),q=XO(f).toVar(),r=XO(g).toVar(),s=XR(h).toVar(),t=XP(i).toVar(),u=XO(j).toVar(),v=XO(k).toVar(),w=m.mul(n).add(o),x=XO(0).toVar();return XL(l.equal(XP(0)),()=>{x.assign(ag0(w))}),XL(l.equal(XP(1)),()=>{x.assign(ag2(w))}),XL(l.equal(XP(2)),()=>{x.assign(ahd(w,p,XP(0)))}),XL(l.equal(XP(3)),()=>{x.assign(ag4(XW(w,0),t,u,v))}),x.assign(x.mul(r.sub(q)).add(q)),XL(s,()=>{x.assign(Z9(x,q,r))}),x}).setLayout({name:"mx_unifiednoise2d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"texcoord",type:"vec2"},{name:"freq",type:"vec2"},{name:"offset",type:"vec2"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),ahf=XI(([a,b,c,d,e,f,g,h,i,j,k])=>{let l=XP(a).toVar(),m=XW(b).toVar(),n=XW(c).toVar(),o=XW(d).toVar(),p=XO(e).toVar(),q=XO(f).toVar(),r=XO(g).toVar(),s=XR(h).toVar(),t=XP(i).toVar(),u=XO(j).toVar(),v=XO(k).toVar(),w=m.mul(n).add(o),x=XO(0).toVar();return XL(l.equal(XP(0)),()=>{x.assign(ag0(w))}),XL(l.equal(XP(1)),()=>{x.assign(ag2(w))}),XL(l.equal(XP(2)),()=>{x.assign(ahd(w,p,XP(0)))}),XL(l.equal(XP(3)),()=>{x.assign(ag4(w,t,u,v))}),x.assign(x.mul(r.sub(q)).add(q)),XL(s,()=>{x.assign(Z9(x,q,r))}),x}).setLayout({name:"mx_unifiednoise3d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"position",type:"vec3"},{name:"freq",type:"vec3"},{name:"offset",type:"vec3"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),ahg=XI(([a])=>{let b=a.y,c=a.z,d=XW().toVar();return XL(b.lessThan(1e-4),()=>{d.assign(XW(c,c,c))}).Else(()=>{let e=a.x,f=XP(ZP(e=e.sub(Zw(e)).mul(6).toVar())),g=e.sub(XO(f)),h=c.mul(b.oneMinus()),i=c.mul(b.mul(g).oneMinus()),j=c.mul(b.mul(g.oneMinus()).oneMinus());XL(f.equal(XP(0)),()=>{d.assign(XW(c,j,h))}).ElseIf(f.equal(XP(1)),()=>{d.assign(XW(i,c,h))}).ElseIf(f.equal(XP(2)),()=>{d.assign(XW(h,c,j))}).ElseIf(f.equal(XP(3)),()=>{d.assign(XW(h,i,c))}).ElseIf(f.equal(XP(4)),()=>{d.assign(XW(j,h,c))}).Else(()=>{d.assign(XW(c,h,i))})}),d}).setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]}),ahh=XI(([a])=>{let b=XW(a).toVar(),c=XO(b.x).toVar(),d=XO(b.y).toVar(),e=XO(b.z).toVar(),f=XO(ZV(c,ZV(d,e))).toVar(),g=XO(ZW(c,ZW(d,e))).toVar(),h=XO(g.sub(f)).toVar(),i=XO().toVar(),j=XO().toVar(),k=XO().toVar();return k.assign(g),XL(g.greaterThan(0),()=>{j.assign(h.div(g))}).Else(()=>{j.assign(0)}),XL(j.lessThanEqual(0),()=>{i.assign(0)}).Else(()=>{XL(c.greaterThanEqual(g),()=>{i.assign(d.sub(e).div(h))}).ElseIf(d.greaterThanEqual(g),()=>{i.assign(YR(2,e.sub(c).div(h)))}).Else(()=>{i.assign(YR(4,c.sub(d).div(h)))}),i.mulAssign(1/6),XL(i.lessThan(0),()=>{i.addAssign(1)})}),XW(i,j,k)}).setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]}),ahi=XI(([a])=>{let b=XW(a).toVar(),c=XZ(YZ(b,XW(.04045))).toVar();return Z8(XW(b.div(12.92)).toVar(),XW(Z1(ZW(b.add(XW(.055)),XW(0)).div(1.055),XW(2.4))).toVar(),c)}).setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),ahj=(a,b)=>{a=XO(a);let c=XS((b=XO(b)).dFdx(),b.dFdy()).length().mul(.7071067811865476);return $c(a.sub(c),a.add(c),b)},ahk=(a,b,c,d)=>Z8(a,b,c[d].clamp()),ahl=(a,b,c,d,e)=>Z8(a,b,ahj(c,d[e])),ahm=XI(([a,b,c])=>{let d=Zy(a).toVar(),e=YS(XO(.5).mul(b.sub(c)),_2).div(d).toVar(),f=YS(XO(-.5).mul(b.sub(c)),_2).div(d).toVar(),g=XW().toVar();g.x=d.x.greaterThan(XO(0)).select(e.x,f.x),g.y=d.y.greaterThan(XO(0)).select(e.y,f.y),g.z=d.z.greaterThan(XO(0)).select(e.z,f.z);let h=ZV(g.x,g.y,g.z).toVar();return _2.add(d.mul(h)).toVar().sub(c)}),ahn=XI(([a,b])=>{let c=a.x,d=a.y,e=a.z,f=b.element(0).mul(.886227);return(f=(f=(f=(f=(f=(f=(f=f.add(b.element(1).mul(1.023328).mul(d))).add(b.element(2).mul(1.023328).mul(e))).add(b.element(3).mul(1.023328).mul(c))).add(b.element(4).mul(.858086).mul(c).mul(d))).add(b.element(5).mul(.858086).mul(d).mul(e))).add(b.element(6).mul(e.mul(e).mul(.743125).sub(.247708)))).add(b.element(7).mul(.858086).mul(c).mul(e))).add(b.element(8).mul(.429043).mul(YT(c,c).sub(YT(d,d))))});var aho=Object.freeze({__proto__:null,BRDF_GGX:acP,BRDF_Lambert:acH,BasicPointShadowFilter:agy,BasicShadowFilter:agi,Break:ab1,Const:$r,Continue:()=>$Z("continue").toStack(),DFGApprox:acS,D_GGX:acM,Discard:$$,EPSILON:Zg,F_Schlick:acG,Fn:XI,HALF_PI:Zl,INFINITY:Zh,If:XL,Loop:ab0,NodeAccess:WQ,NodeShaderStage:WO,NodeType:{BOOLEAN:"bool",INTEGER:"int",FLOAT:"float",VECTOR2:"vec2",VECTOR3:"vec3",VECTOR4:"vec4",MATRIX2:"mat2",MATRIX3:"mat3",MATRIX4:"mat4"},NodeUpdateType:WP,OnBeforeMaterialUpdate:a=>aeE(aeD.BEFORE_MATERIAL,a),OnBeforeObjectUpdate:a=>aeE(aeD.BEFORE_OBJECT,a),OnMaterialUpdate:a=>aeE(aeD.MATERIAL,a),OnObjectUpdate:a=>aeE(aeD.OBJECT,a),PCFShadowFilter:agj,PCFSoftShadowFilter:agk,PI:Zi,PI2:Zj,PointShadowFilter:agz,Return:()=>$Z("return").toStack(),Schlick_to_F0:acT,ScriptableNodeResources:afn,ShaderNode:Xy,Stack:XM,Switch:(...a)=>W7.Switch(...a),TBNViewMatrix:aa$,TWO_PI:Zk,VSMShadowFilter:agl,V_GGX_SmithCorrelated:acK,Var:$q,VarIntent:$s,abs:ZG,acesFilmicToneMapping:afa,acos:ZE,add:YR,addMethodChaining:W9,addNodeElement:function(a){I0("TSL: AddNodeElement has been removed in favor of tree-shaking. Trying add",a)},agxToneMapping:afe,all:Zm,alphaT:Yl,and:Y0,anisotropy:Ym,anisotropyB:Yo,anisotropyT:Yn,any:Zn,append:a=>(I0("TSL: append() has been renamed to Stack()."),XM(a)),array:YL,arrayBuffer:a=>Xz(new W5(a,"ArrayBuffer")),asin:ZD,assign:YM,atan:ZF,atan2:$i,atomicAdd:(a,b)=>afI(afG.ATOMIC_ADD,a,b),atomicAnd:(a,b)=>afI(afG.ATOMIC_AND,a,b),atomicFunc:afI,atomicLoad:a=>afI(afG.ATOMIC_LOAD,a,null),atomicMax:(a,b)=>afI(afG.ATOMIC_MAX,a,b),atomicMin:(a,b)=>afI(afG.ATOMIC_MIN,a,b),atomicOr:(a,b)=>afI(afG.ATOMIC_OR,a,b),atomicStore:(a,b)=>afI(afG.ATOMIC_STORE,a,b),atomicSub:(a,b)=>afI(afG.ATOMIC_SUB,a,b),atomicXor:(a,b)=>afI(afG.ATOMIC_XOR,a,b),attenuationColor:YA,attenuationDistance:Yz,attribute:$7,attributeArray:(a,b="float")=>{let c,d;return!0===b.isStruct?(c=b.layout.getLength(),d=WH("float")):(c=WI(b),d=WH(b)),abX(new aeG(a,c,d),b,a)},backgroundBlurriness:aeL,backgroundIntensity:aeM,backgroundRotation:aeN,batch:abU,bentNormalView:aa0,billboarding:ad8,bitAnd:Y4,bitNot:Y5,bitOr:Y6,bitXor:Y7,bitangentGeometry:aaW,bitangentLocal:aaX,bitangentView:aaY,bitangentWorld:aaZ,bitcast:adX,blendBurn:acv,blendColor:acz,blendDodge:acw,blendOverlay:acy,blendScreen:acx,blur:adn,bool:XR,buffer:_h,bufferAttribute:$L,builtin:_l,bumpMap:aa4,burn:(...a)=>(I0('TSL: "burn" has been renamed. Use "blendBurn" instead.'),acv(a)),bvec2:XV,bvec3:XZ,bvec4:X1,bypass:$V,cache:$U,call:YO,cameraFar:_y,cameraIndex:_w,cameraNear:_x,cameraNormalMatrix:_D,cameraPosition:_E,cameraProjectionMatrix:_z,cameraProjectionMatrixInverse:_A,cameraViewMatrix:_B,cameraViewport:_F,cameraWorldMatrix:_C,cbrt:Z6,cdl:ae_,ceil:Zx,checker:agG,cineonToneMapping:ae8,clamp:Z9,clearcoat:Ye,clearcoatNormalView:aag,clearcoatRoughness:Yf,code:afh,color:XN,colorSpaceToWorking:$C,colorToDirection:a=>Xz(a).mul(2).sub(1),compute:$R,computeKernel:$Q,computeSkinning:(a,b=null)=>{let c=new abZ(a);return c.positionNode=abX(new Ly(a.geometry.getAttribute("position").array,3),"vec3").setPBO(!0).toReadOnly().element(abM).toVar(),c.skinIndexNode=abX(new Ly(new Uint32Array(a.geometry.getAttribute("skinIndex").array),4),"uvec4").setPBO(!0).toReadOnly().element(abM).toVar(),c.skinWeightNode=abX(new Ly(a.geometry.getAttribute("skinWeight").array,4),"vec4").setPBO(!0).toReadOnly().element(abM).toVar(),c.bindMatrixNode=YJ(a.bindMatrix,"mat4"),c.bindMatrixInverseNode=YJ(a.bindMatrixInverse,"mat4"),c.boneMatricesNode=_h(a.skeleton.boneMatrices,"mat4",a.skeleton.bones.length),c.toPositionNode=b,Xz(c)},context:$l,convert:X6,convertColorSpace:(a,b,c)=>Xz(new $A(Xz(a),b,c)),convertToTexture:(a,...b)=>a.isSampleNode||a.isTextureNode?a:a.isPassNode?a.getTextureNode():aex(a,...b),cos:ZB,cross:Z0,cubeTexture:aax,cubeTextureBase:aaw,cubeToUV:agx,dFdx:ZL,dFdy:ZM,dashSize:Yt,debug:$2,decrement:Zd,decrementBefore:Zb,defaultBuildStages:["setup","analyze","generate"],defaultShaderStages:WR,defined:Xw,degrees:Zp,deltaTime:ad4,densityFog:function(a,b){return I0('TSL: "densityFog( color, density )" is deprecated. Use "fog( color, densityFogFactor( density ) )" instead.'),afs(a,afr(b))},densityFogFactor:afr,depth:acm,depthPass:(a,b,c)=>Xz(new ae4(ae4.DEPTH,a,b,c)),determinant:ZS,difference:Z$,diffuseColor:Ya,directPointLight:({color:a,lightVector:b,cutoffDistance:c,decayExponent:d})=>{let e=b.normalize(),f=agF({lightDistance:b.length(),cutoffDistance:c,decayExponent:d});return{lightDirection:e,lightColor:a.mul(f)}},directionToColor:a=>Xz(a).mul(.5).add(.5),directionToFaceDirection:_8,dispersion:YB,distance:ZZ,div:YU,dodge:(...a)=>(I0('TSL: "dodge" has been renamed. Use "blendDodge" instead.'),acw(a)),dot:Z_,drawIndex:abQ,dynamicBufferAttribute:$M,element:X5,emissive:Yb,equal:YW,equals:ZU,equirectUV:acF,exp:Zq,exp2:Zr,expression:$Z,faceDirection:_7,faceForward:$d,faceforward:$d,float:XO,floatBitsToInt:a=>new adW(a,"int","float"),floatBitsToUint:a=>new adW(a,"uint","float"),floor:Zw,fog:afs,fract:Zz,frameGroup:YF,frameId:ad5,frontFacing:_6,fwidth:ZQ,gain:(a,b)=>a.lessThan(.5)?adZ(a.mul(2),b).div(2):YS(1,adZ(YT(YS(1,a),2),b).div(2)),gapSize:Yu,getConstNodeType:Xx,getCurrentStack:XK,getDirection:adj,getDistanceAttenuation:agF,getGeometryRoughness:acI,getNormalFromDepth:aeA,getParallaxCorrectNormal:ahm,getRoughness:acJ,getScreenPosition:aez,getShIrradianceAt:ahn,getShadowMaterial:agn,getShadowRenderObjectFunction:agq,getTextureIndex:adU,getViewPosition:aey,ggxConvolution:adr,globalId:afA,glsl:(a,b)=>afh(a,b,"glsl"),glslFn:(a,b)=>afj(a,b,"glsl"),grayscale:aeW,greaterThan:YZ,greaterThanEqual:Y_,hash:adY,highpModelNormalViewMatrix:_$,highpModelViewMatrix:_Z,hue:aeZ,increment:Zc,incrementBefore:Za,inspector:$5,instance:abS,instanceIndex:abM,instancedArray:(a,b="float")=>{let c,d;return!0===b.isStruct?(c=b.layout.getLength(),d=WH("float")):(c=WI(b),d=WH(b)),abX(new aeF(a,c,d),b,a)},instancedBufferAttribute:$N,instancedDynamicBufferAttribute:$O,instancedMesh:abT,int:XP,intBitsToFloat:a=>new adW(a,"float","int"),interleavedGradientNoise:aeB,inverse:ZT,inverseSqrt:Zv,inversesqrt:Zv,invocationLocalIndex:abP,invocationSubgroupIndex:abO,ior:Yw,iridescence:Yi,iridescenceIOR:Yj,iridescenceThickness:Yk,isolate:$T,ivec2:XT,ivec3:XX,ivec4:X_,js:(a,b)=>afh(a,b,"js"),label:$o,length:ZI,lengthSq:Z7,lessThan:YY,lessThanEqual:Y$,lightPosition:af9,lightProjectionUV:function(a,b=_2){let c=af8(a).mul(b);return c.xyz.div(c.w)},lightShadowMatrix:af8,lightTargetDirection:a=>_B.transformDirection(af9(a).sub(aga(a))),lightTargetPosition:aga,lightViewPosition:function(a){let b=af7(a);return b.viewPosition||(b.viewPosition=YJ(new Je).setGroup(YG).onRenderUpdate(({camera:b},c)=>{c.value=c.value||new Je,c.value.setFromMatrixPosition(a.matrixWorld),c.value.applyMatrix4(b.matrixWorldInverse)}))},lightingContext:ab8,lights:(a=[])=>Xz(new age).setLights(a),linearDepth:acn,linearToneMapping:ae6,localId:afB,log:Zs,log2:Zt,logarithmicDepthToViewZ:(a,b,c)=>{let d=a.mul(Zs(c.div(b)));return XO(Math.E).pow(d).mul(b).negate()},luminance:ae$,mat2:X2,mat3:X3,mat4:X4,matcapUV:adM,materialAO:abH,materialAlphaTest:aa7,materialAnisotropy:abq,materialAnisotropyVector:abI,materialAttenuationColor:aby,materialAttenuationDistance:abx,materialClearcoat:abk,materialClearcoatNormal:abm,materialClearcoatRoughness:abl,materialColor:aa8,materialDispersion:abF,materialEmissive:aba,materialEnvIntensity:aap,materialEnvRotation:aaq,materialIOR:abw,materialIridescence:abr,materialIridescenceIOR:abs,materialIridescenceThickness:abt,materialLightMap:abG,materialLineDashOffset:abD,materialLineDashSize:abA,materialLineGapSize:abB,materialLineScale:abz,materialLineWidth:abC,materialMetalness:abi,materialNormal:abj,materialOpacity:abb,materialPointSize:abE,materialReference:aaD,materialReflectivity:abg,materialRefractionRatio:aao,materialRotation:abn,materialRoughness:abh,materialSheen:abo,materialSheenRoughness:abp,materialShininess:aa9,materialSpecular:abc,materialSpecularColor:abe,materialSpecularIntensity:abd,materialSpecularStrength:abf,materialThickness:abv,materialTransmission:abu,max:ZW,maxMipLevel:_a,mediumpModelViewMatrix:_Y,metalness:Yd,min:ZV,mix:Z8,mixElement:$f,mod:YV,modInt:Ze,modelDirection:_P,modelNormalMatrix:_V,modelPosition:_R,modelRadius:_U,modelScale:_S,modelViewMatrix:_X,modelViewPosition:_T,modelViewProjection:abJ,modelWorldMatrix:_Q,modelWorldMatrixInverse:_W,morphReference:ab5,mrt:adV,mul:YT,mx_aastep:ahj,mx_add:(a,b=XO(0))=>YR(a,b),mx_atan2:(a=XO(0),b=XO(1))=>ZF(a,b),mx_cell_noise_float:(a=$8())=>ag1(a.convert("vec2|vec3")),mx_contrast:(a,b=1,c=.5)=>XO(a).sub(c).mul(b).add(c),mx_divide:(a,b=XO(1))=>YU(a,b),mx_fractal_noise_float:(a=$8(),b=3,c=2,d=.5,e=1)=>ag3(a,XP(b),c,d).mul(e),mx_fractal_noise_vec2:(a=$8(),b=3,c=2,d=.5,e=1)=>ag5(a,XP(b),c,d).mul(e),mx_fractal_noise_vec3:(a=$8(),b=3,c=2,d=.5,e=1)=>ag4(a,XP(b),c,d).mul(e),mx_fractal_noise_vec4:(a=$8(),b=3,c=2,d=.5,e=1)=>ag6(a,XP(b),c,d).mul(e),mx_frame:()=>ad5,mx_heighttonormal:(a,b)=>aa4(a=XW(a),b=XO(b)),mx_hsvtorgb:ahg,mx_ifequal:(a,b,c,d)=>a.equal(b).mix(c,d),mx_ifgreater:(a,b,c,d)=>a.greaterThan(b).mix(c,d),mx_ifgreatereq:(a,b,c,d)=>a.greaterThanEqual(b).mix(c,d),mx_invert:(a,b=XO(1))=>YS(b,a),mx_modulo:(a,b=XO(1))=>YV(a,b),mx_multiply:(a,b=XO(1))=>YT(a,b),mx_noise_float:(a=$8(),b=1,c=0)=>ag_(a.convert("vec2|vec3")).mul(b).add(c),mx_noise_vec3:(a=$8(),b=1,c=0)=>ag0(a.convert("vec2|vec3")).mul(b).add(c),mx_noise_vec4:(a=$8(),b=1,c=0)=>X$(ag0(a=a.convert("vec2|vec3")),ag_(a.add(XS(19,73)))).mul(b).add(c),mx_place2d:(a,b=XS(.5,.5),c=XS(1,1),d=XO(0),e=XS(0,0))=>{let f=a;if(b&&(f=f.sub(b)),c&&(f=f.mul(c)),d){let a=d.mul(Math.PI/180),b=a.cos(),c=a.sin();f=XS(f.x.mul(b).sub(f.y.mul(c)),f.x.mul(c).add(f.y.mul(b)))}return b&&(f=f.add(b)),e&&(f=f.add(e)),f},mx_power:(a,b=XO(1))=>Z1(a,b),mx_ramp4:(a,b,c,d,e=$8())=>{let f=e.x.clamp(),g=e.y.clamp(),h=Z8(a,b,f),i=Z8(c,d,f);return Z8(h,i,g)},mx_ramplr:(a,b,c=$8())=>ahk(a,b,c,"x"),mx_ramptb:(a,b,c=$8())=>ahk(a,b,c,"y"),mx_rgbtohsv:ahh,mx_rotate2d:(a,b)=>adN(a=XS(a),(b=XO(b)).mul(Math.PI/180)),mx_rotate3d:(a,b,c)=>{a=XW(a),b=XO(b),c=XW(c);let d=b.mul(Math.PI/180),e=c.normalize(),f=d.cos(),g=d.sin(),h=XO(1).sub(f);return a.mul(f).add(e.cross(a).mul(g)).add(e.mul(e.dot(a)).mul(h))},mx_safepower:(a,b=1)=>(a=XO(a)).abs().pow(b).mul(a.sign()),mx_separate:(a,b=null)=>{if("string"==typeof b){let c={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3},d=b.replace(/^out/,"").toLowerCase();if(void 0!==c[d])return a.element(c[d])}if("number"==typeof b)return a.element(b);if("string"==typeof b&&1===b.length){let c={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3};if(void 0!==c[b])return a.element(c[b])}return a},mx_splitlr:(a,b,c,d=$8())=>ahl(a,b,c,d,"x"),mx_splittb:(a,b,c,d=$8())=>ahl(a,b,c,d,"y"),mx_srgb_texture_to_lin_rec709:ahi,mx_subtract:(a,b=XO(0))=>YS(a,b),mx_timer:()=>ad3,mx_transform_uv:(a=1,b=0,c=$8())=>c.mul(a).add(b),mx_unifiednoise2d:(a,b=$8(),c=XS(1,1),d=XS(0,0),e=1,f=0,g=1,h=!1,i=1,j=2,k=.5)=>ahe(a,b.convert("vec2|vec3"),c,d,e,f,g,h,i,j,k),mx_unifiednoise3d:(a,b=$8(),c=XS(1,1),d=XS(0,0),e=1,f=0,g=1,h=!1,i=1,j=2,k=.5)=>ahf(a,b.convert("vec2|vec3"),c,d,e,f,g,h,i,j,k),mx_worley_noise_float:(a=$8(),b=1)=>ahb(a.convert("vec2|vec3"),b,XP(1)),mx_worley_noise_vec2:(a=$8(),b=1)=>ahc(a.convert("vec2|vec3"),b,XP(1)),mx_worley_noise_vec3:(a=$8(),b=1)=>ahd(a.convert("vec2|vec3"),b,XP(1)),negate:ZJ,neutralToneMapping:aff,nodeArray:XC,nodeImmutable:XE,nodeObject:Xz,nodeObjectIntent:XA,nodeObjects:XB,nodeProxy:XD,nodeProxyIntent:XF,normalFlat:aab,normalGeometry:_9,normalLocal:aaa,normalMap:aa1,normalView:aae,normalViewGeometry:aac,normalWorld:aaf,normalWorldGeometry:aad,normalize:Zy,not:Y2,notEqual:YX,numWorkgroups:afy,objectDirection:_I,objectGroup:YH,objectPosition:_K,objectRadius:_N,objectScale:_L,objectViewPosition:_M,objectWorldMatrix:_J,oneMinus:ZK,or:Y1,orthographicDepthToViewZ:(a,b,c)=>b.sub(c).mul(a).sub(b),oscSawtooth:(a=ad3)=>a.fract(),oscSine:(a=ad3)=>a.add(.75).mul(2*Math.PI).sin().mul(.5).add(.5),oscSquare:(a=ad3)=>a.fract().round(),oscTriangle:(a=ad3)=>a.add(.5).fract().mul(2).sub(1).abs(),output:Ys,outputStruct:adT,overlay:(...a)=>(I0('TSL: "overlay" has been renamed. Use "blendOverlay" instead.'),acy(a)),overloadingFn:ad2,parabola:adZ,parallaxDirection:aa_,parallaxUV:(a,b)=>a.sub(aa_.mul(b)),parameter:(a,b)=>Xz(new adO(a,b)),pass:(a,b,c)=>Xz(new ae4(ae4.COLOR,a,b,c)),passTexture:(a,b)=>Xz(new ae2(a,b)),pcurve:(a,b,c)=>Z1(YU(Z1(a,b),YR(Z1(a,b),Z1(YS(1,a),c))),1/b),perspectiveDepthToViewZ:acj,pmremTexture:adL,pointShadow:(a,b)=>Xz(new agE(a,b)),pointUV:aeH,pointWidth:Yv,positionGeometry:__,positionLocal:_0,positionPrevious:_1,positionView:_4,positionViewDirection:_5,positionWorld:_2,positionWorldDirection:_3,posterize:ae0,pow:Z1,pow2:Z2,pow3:Z3,pow4:Z4,premultiplyAlpha:acA,property:X8,quadBroadcast:af6,quadSwapDiagonal:af0,quadSwapX:af$,quadSwapY:af_,radians:Zo,rand:$e,range:afv,rangeFog:function(a,b,c){return I0('TSL: "rangeFog( color, near, far )" is deprecated. Use "fog( color, rangeFogFactor( near, far ) )" instead.'),afs(a,afq(b,c))},rangeFogFactor:afq,reciprocal:ZO,reference:aaA,referenceBuffer:aaB,reflect:ZY,reflectVector:aat,reflectView:aar,reflector:a=>Xz(new aeq(a)),refract:$b,refractVector:aau,refractView:aas,reinhardToneMapping:ae7,remap:$X,remapClamp:$Y,renderGroup:YG,renderOutput:$0,rendererReference:$G,rotate:adN,rotateUV:ad6,roughness:Yc,round:ZN,rtt:aex,sRGBTransferEOTF:$x,sRGBTransferOETF:$y,sample:(a,b=null)=>Xz(new aeC(a,Xz(b))),sampler:a=>(!0===a.isNode?a:_e(a)).convert("sampler"),samplerComparison:a=>(!0===a.isNode?a:_e(a)).convert("samplerComparison"),saturate:$a,saturation:aeX,screen:(...a)=>(I0('TSL: "screen" has been renamed. Use "blendScreen" instead.'),acx(a)),screenCoordinate:_q,screenDPR:_n,screenSize:_p,screenUV:_o,scriptable:afo,scriptableValue:afk,select:$j,setCurrentStack:XJ,setName:$n,shaderStages:WS,shadow:(a,b)=>Xz(new agv(a,b)),shadowPositionWorld:agg,shapeCircle:agH,sharedUniformGroup:YE,sheen:Yg,sheenRoughness:Yh,shiftLeft:Y8,shiftRight:Y9,shininess:Yr,sign:ZH,sin:ZA,sinc:(a,b)=>ZA(Zi.mul(b.mul(a).sub(1))).div(Zi.mul(b.mul(a).sub(1))),skinning:ab$,smoothstep:$c,smoothstepElement:$g,specularColor:Yp,specularF90:Yq,spherizeUV:ad7,split:(a,b)=>Xz(new W0(Xz(a),b)),spritesheetUV:aea,sqrt:Zu,stack:adP,step:ZX,stepElement:$h,storage:abX,storageBarrier:()=>afD("storage").toStack(),storageObject:(a,b,c)=>(I0('TSL: "storageObject()" is deprecated. Use "storage().setPBO( true )" instead.'),abX(a,b,c).setPBO(!0)),storageTexture:aeO,string:(a="")=>Xz(new W5(a,"string")),struct:(a,b=null)=>{let c=new adQ(a,b),d=(...b)=>{let d=null;if(b.length>0)if(b[0].isNode){d={};let c=Object.keys(a);for(let a=0;a<b.length;a++)d[c[a]]=b[a]}else d=b[0];return Xz(new adR(c,d))};return d.layout=c,d.isStruct=!0,d},sub:YS,subBuild:$u,subgroupAdd:afM,subgroupAll:afX,subgroupAnd:afS,subgroupAny:afY,subgroupBallot:afL,subgroupBroadcast:af1,subgroupBroadcastFirst:afZ,subgroupElect:afK,subgroupExclusiveAdd:afO,subgroupExclusiveMul:afR,subgroupInclusiveAdd:afN,subgroupInclusiveMul:afQ,subgroupIndex:abN,subgroupMax:afW,subgroupMin:afV,subgroupMul:afP,subgroupOr:afT,subgroupShuffle:af2,subgroupShuffleDown:af5,subgroupShuffleUp:af4,subgroupShuffleXor:af3,subgroupSize:afC,subgroupXor:afU,tan:ZC,tangentGeometry:aaR,tangentLocal:aaS,tangentView:aaT,tangentWorld:aaU,texture:_e,texture3D:aeQ,textureBarrier:()=>afD("texture").toStack(),textureBicubic:ac3,textureBicubicLevel:ac2,textureCubeUV:adk,textureLevel:(a,b,c)=>_e(a,b).level(c),textureLoad:_f,textureSize:$9,textureStore:(a,b,c)=>{let d=aeO(a,b,c);return null!==c&&d.toStack(),d},thickness:Yy,time:ad3,toneMapping:$I,toneMappingExposure:$J,toonOutlinePass:(a,b,c=new KH(0,0,0),d=.003,e=1)=>Xz(new ae5(a,b,Xz(c),Xz(d),Xz(e))),transformDirection:Z5,transformNormal:aah,transformNormalToView:aai,transformedClearcoatNormalView:aal,transformedNormalView:aaj,transformedNormalWorld:aak,transmission:Yx,transpose:ZR,triNoise3D:ad0,triplanarTexture:(...a)=>aeb(...a),triplanarTextures:aeb,trunc:ZP,uint:XQ,uintBitsToFloat:a=>new adW(a,"float","uint"),uniform:YJ,uniformArray:_k,uniformCubeTexture:(a=aav)=>aaw(a),uniformFlow:$m,uniformGroup:YD,uniformTexture:(a=_b)=>_e(a),unpremultiplyAlpha:acB,userData:(a,b,c)=>Xz(new aeR(a,b,c)),uv:$8,uvec2:XU,uvec3:XY,uvec4:X0,varying:$v,varyingProperty:X9,vec2:XS,vec3:XW,vec4:X$,vectorComponents:WT,velocity:aeV,vertexColor:acu,vertexIndex:abL,vertexStage:$w,vibrance:aeY,viewZToLogarithmicDepth:ack,viewZToOrthographicDepth:ach,viewZToPerspectiveDepth:aci,viewport:_r,viewportCoordinate:_t,viewportDepthTexture:acf,viewportLinearDepth:aco,viewportMipTexture:acd,viewportResolution:_v,viewportSafeUV:ad9,viewportSharedTexture:acE,viewportSize:_s,viewportTexture:acc,viewportUV:_u,wgsl:(a,b)=>afh(a,b,"wgsl"),wgslFn:(a,b)=>afj(a,b,"wgsl"),workgroupArray:(a,b)=>Xz(new afF("Workgroup",a,b)),workgroupBarrier:()=>afD("workgroup").toStack(),workgroupId:afz,workingToColorSpace:$B,xor:Y3});new afg("uint tsl_bitcast_uint_to_int ( int x ) { return floatBitsToInt( uintBitsToFloat( x ) ); }"),new afg("uint tsl_bitcast_int_to_uint ( int x ) { return floatBitsToUint( intBitsToFloat ( x ) ); }");let ahp="u">typeof self?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4};WQ.READ_ONLY,WQ.WRITE_ONLY,WQ.READ_WRITE,ahp&&ahp.VERTEX,ahp&&ahp.FRAGMENT,ahp&&ahp.COMPUTE,new afg("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),new afg("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),new afg("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),new afg("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),new afg("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),new afg("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),new afg("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),new afg("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),new afg("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),new afg("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),new afg("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),new afg("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),new afg(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`);let ahq=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]);"u">typeof Float16Array&&ahq.set(Float16Array,["float16"]),aho.BRDF_GGX,aho.BRDF_Lambert,aho.BasicPointShadowFilter,aho.BasicShadowFilter,aho.Break,aho.Const,aho.Continue,aho.DFGApprox,aho.D_GGX,aho.Discard,aho.EPSILON,aho.F_Schlick,aho.Fn,aho.INFINITY,aho.If,aho.Loop,aho.NodeAccess,aho.NodeShaderStage,aho.NodeType,aho.NodeUpdateType,aho.PCFShadowFilter,aho.PCFSoftShadowFilter,aho.PI,aho.PI2,aho.TWO_PI,aho.HALF_PI,aho.PointShadowFilter,aho.Return,aho.Schlick_to_F0,aho.ScriptableNodeResources,aho.ShaderNode,aho.Stack,aho.Switch,aho.TBNViewMatrix,aho.VSMShadowFilter,aho.V_GGX_SmithCorrelated,aho.Var,aho.VarIntent,aho.abs,aho.acesFilmicToneMapping,aho.acos,aho.add,aho.addMethodChaining,aho.addNodeElement,aho.agxToneMapping,aho.all,aho.alphaT,aho.and,aho.anisotropy,aho.anisotropyB,aho.anisotropyT,aho.any,aho.append,aho.array,aho.arrayBuffer,aho.asin,aho.assign,aho.atan,aho.atan2,aho.atomicAdd,aho.atomicAnd,aho.atomicFunc,aho.atomicLoad,aho.atomicMax,aho.atomicMin,aho.atomicOr,aho.atomicStore,aho.atomicSub,aho.atomicXor,aho.attenuationColor,aho.attenuationDistance,aho.attribute,aho.attributeArray,aho.backgroundBlurriness,aho.backgroundIntensity,aho.backgroundRotation,aho.batch,aho.bentNormalView,aho.billboarding,aho.bitAnd,aho.bitNot,aho.bitOr,aho.bitXor,aho.bitangentGeometry,aho.bitangentLocal,aho.bitangentView,aho.bitangentWorld,aho.bitcast,aho.blendBurn,aho.blendColor,aho.blendDodge,aho.blendOverlay,aho.blendScreen,aho.blur,aho.bool,aho.buffer,aho.bufferAttribute,aho.bumpMap,aho.burn,aho.builtin,aho.bvec2,aho.bvec3,aho.bvec4,aho.bypass,aho.cache,aho.call,aho.cameraFar,aho.cameraIndex,aho.cameraNear,aho.cameraNormalMatrix,aho.cameraPosition,aho.cameraProjectionMatrix,aho.cameraProjectionMatrixInverse,aho.cameraViewMatrix,aho.cameraViewport,aho.cameraWorldMatrix,aho.cbrt,aho.cdl,aho.ceil,aho.checker,aho.cineonToneMapping,aho.clamp,aho.clearcoat,aho.clearcoatNormalView,aho.clearcoatRoughness,aho.code,aho.color,aho.colorSpaceToWorking,aho.colorToDirection,aho.compute,aho.computeKernel,aho.computeSkinning,aho.context,aho.convert,aho.convertColorSpace,aho.convertToTexture,aho.cos,aho.cross,aho.cubeTexture,aho.cubeTextureBase,aho.cubeToUV,aho.dFdx,aho.dFdy,aho.dashSize,aho.debug,aho.decrement,aho.decrementBefore,aho.defaultBuildStages,aho.defaultShaderStages,aho.defined,aho.degrees,aho.deltaTime,aho.densityFog,aho.densityFogFactor,aho.depth,aho.depthPass,aho.determinant,aho.difference,aho.diffuseColor,aho.directPointLight,aho.directionToColor,aho.directionToFaceDirection,aho.dispersion,aho.distance,aho.div,aho.dodge,aho.dot,aho.drawIndex,aho.dynamicBufferAttribute,aho.element,aho.emissive,aho.equal,aho.equals,aho.equirectUV,aho.exp,aho.exp2,aho.expression,aho.faceDirection,aho.faceForward,aho.faceforward,aho.float,aho.floatBitsToInt,aho.floatBitsToUint,aho.floor,aho.fog,aho.fract,aho.frameGroup,aho.frameId,aho.frontFacing,aho.fwidth,aho.gain,aho.gapSize,aho.getConstNodeType,aho.getCurrentStack,aho.getDirection,aho.getDistanceAttenuation,aho.getGeometryRoughness,aho.getNormalFromDepth,aho.interleavedGradientNoise,aho.getParallaxCorrectNormal,aho.getRoughness,aho.getScreenPosition,aho.getShIrradianceAt,aho.getShadowMaterial,aho.getShadowRenderObjectFunction,aho.getTextureIndex,aho.getViewPosition,aho.globalId,aho.glsl,aho.glslFn,aho.grayscale,aho.greaterThan,aho.greaterThanEqual,aho.hash,aho.highpModelNormalViewMatrix,aho.highpModelViewMatrix,aho.hue,aho.increment,aho.incrementBefore,aho.instance,aho.instanceIndex,aho.instancedArray,aho.instancedBufferAttribute,aho.instancedDynamicBufferAttribute,aho.instancedMesh,aho.int,aho.intBitsToFloat,aho.inverse,aho.inverseSqrt,aho.inversesqrt,aho.invocationLocalIndex,aho.invocationSubgroupIndex,aho.ior,aho.iridescence,aho.iridescenceIOR,aho.iridescenceThickness,aho.ivec2,aho.ivec3,aho.ivec4,aho.js,aho.label,aho.length,aho.lengthSq,aho.lessThan,aho.lessThanEqual,aho.lightPosition,aho.lightProjectionUV,aho.lightShadowMatrix,aho.lightTargetDirection,aho.lightTargetPosition,aho.lightViewPosition,aho.lightingContext,aho.lights,aho.linearDepth,aho.linearToneMapping,aho.localId,aho.log,aho.log2,aho.logarithmicDepthToViewZ,aho.luminance,aho.mat2,aho.mat3,aho.mat4,aho.matcapUV,aho.materialAO,aho.materialAlphaTest,aho.materialAnisotropy,aho.materialAnisotropyVector,aho.materialAttenuationColor,aho.materialAttenuationDistance,aho.materialClearcoat,aho.materialClearcoatNormal,aho.materialClearcoatRoughness,aho.materialColor,aho.materialDispersion,aho.materialEmissive,aho.materialEnvIntensity,aho.materialEnvRotation,aho.materialIOR,aho.materialIridescence,aho.materialIridescenceIOR,aho.materialIridescenceThickness,aho.materialLightMap,aho.materialLineDashOffset,aho.materialLineDashSize,aho.materialLineGapSize,aho.materialLineScale,aho.materialLineWidth,aho.materialMetalness,aho.materialNormal,aho.materialOpacity,aho.materialPointSize,aho.materialReference,aho.materialReflectivity,aho.materialRefractionRatio,aho.materialRotation,aho.materialRoughness,aho.materialSheen,aho.materialSheenRoughness,aho.materialShininess,aho.materialSpecular,aho.materialSpecularColor,aho.materialSpecularIntensity,aho.materialSpecularStrength,aho.materialThickness,aho.materialTransmission,aho.max,aho.maxMipLevel,aho.mediumpModelViewMatrix,aho.metalness,aho.min,aho.mix,aho.mixElement,aho.mod,aho.modInt,aho.modelDirection,aho.modelNormalMatrix,aho.modelPosition,aho.modelRadius,aho.modelScale,aho.modelViewMatrix,aho.modelViewPosition,aho.modelViewProjection,aho.modelWorldMatrix,aho.modelWorldMatrixInverse,aho.morphReference,aho.mrt,aho.mul,aho.mx_aastep,aho.mx_add,aho.mx_atan2,aho.mx_cell_noise_float,aho.mx_contrast,aho.mx_divide,aho.mx_fractal_noise_float,aho.mx_fractal_noise_vec2,aho.mx_fractal_noise_vec3,aho.mx_fractal_noise_vec4,aho.mx_frame,aho.mx_heighttonormal,aho.mx_hsvtorgb,aho.mx_ifequal,aho.mx_ifgreater,aho.mx_ifgreatereq,aho.mx_invert,aho.mx_modulo,aho.mx_multiply,aho.mx_noise_float,aho.mx_noise_vec3,aho.mx_noise_vec4,aho.mx_place2d,aho.mx_power,aho.mx_ramp4,aho.mx_ramplr,aho.mx_ramptb,aho.mx_rgbtohsv,aho.mx_rotate2d,aho.mx_rotate3d,aho.mx_safepower,aho.mx_separate,aho.mx_splitlr,aho.mx_splittb,aho.mx_srgb_texture_to_lin_rec709,aho.mx_subtract,aho.mx_timer,aho.mx_transform_uv,aho.mx_unifiednoise2d,aho.mx_unifiednoise3d,aho.mx_worley_noise_float,aho.mx_worley_noise_vec2,aho.mx_worley_noise_vec3,aho.negate,aho.neutralToneMapping,aho.nodeArray,aho.nodeImmutable,aho.nodeObject,aho.nodeObjectIntent,aho.nodeObjects,aho.nodeProxy,aho.nodeProxyIntent,aho.normalFlat,aho.normalGeometry,aho.normalLocal,aho.normalMap,aho.normalView,aho.normalViewGeometry,aho.normalWorld,aho.normalWorldGeometry,aho.normalize,aho.not,aho.notEqual,aho.numWorkgroups,aho.objectDirection,aho.objectGroup,aho.objectPosition,aho.objectRadius,aho.objectScale,aho.objectViewPosition,aho.objectWorldMatrix,aho.OnBeforeObjectUpdate,aho.OnBeforeMaterialUpdate,aho.OnObjectUpdate,aho.OnMaterialUpdate,aho.oneMinus,aho.or,aho.orthographicDepthToViewZ,aho.oscSawtooth,aho.oscSine,aho.oscSquare,aho.oscTriangle,aho.output,aho.outputStruct,aho.overlay,aho.overloadingFn,aho.parabola,aho.parallaxDirection,aho.parallaxUV,aho.parameter,aho.pass,aho.passTexture,aho.pcurve,aho.perspectiveDepthToViewZ,aho.pmremTexture,aho.pointShadow,aho.pointUV,aho.pointWidth,aho.positionGeometry,aho.positionLocal,aho.positionPrevious,aho.positionView,aho.positionViewDirection,aho.positionWorld,aho.positionWorldDirection,aho.posterize,aho.pow,aho.pow2,aho.pow3,aho.pow4,aho.premultiplyAlpha,aho.property,aho.radians,aho.rand,aho.range,aho.rangeFog,aho.rangeFogFactor,aho.reciprocal,aho.reference,aho.referenceBuffer,aho.reflect,aho.reflectVector,aho.reflectView,aho.reflector,aho.refract,aho.refractVector,aho.refractView,aho.reinhardToneMapping,aho.remap,aho.remapClamp,aho.renderGroup,aho.renderOutput,aho.rendererReference,aho.rotate,aho.rotateUV,aho.roughness,aho.round,aho.rtt,aho.sRGBTransferEOTF,aho.sRGBTransferOETF,aho.sample,aho.sampler,aho.samplerComparison,aho.saturate,aho.saturation,aho.screen,aho.screenCoordinate,aho.screenDPR,aho.screenSize,aho.screenUV,aho.scriptable,aho.scriptableValue,aho.select,aho.setCurrentStack,aho.setName,aho.shaderStages,aho.shadow,aho.shadowPositionWorld,aho.shapeCircle,aho.sharedUniformGroup,aho.sheen,aho.sheenRoughness,aho.shiftLeft,aho.shiftRight,aho.shininess,aho.sign,aho.sin,aho.sinc,aho.skinning,aho.smoothstep,aho.smoothstepElement,aho.specularColor,aho.specularF90,aho.spherizeUV,aho.split,aho.spritesheetUV,aho.sqrt,aho.stack,aho.step,aho.stepElement,aho.storage,aho.storageBarrier,aho.storageObject,aho.storageTexture,aho.string,aho.struct,aho.sub,aho.subgroupAdd,aho.subgroupAll,aho.subgroupAnd,aho.subgroupAny,aho.subgroupBallot,aho.subgroupBroadcast,aho.subgroupBroadcastFirst,aho.subBuild,aho.subgroupElect,aho.subgroupExclusiveAdd,aho.subgroupExclusiveMul,aho.subgroupInclusiveAdd,aho.subgroupInclusiveMul,aho.subgroupIndex,aho.subgroupMax,aho.subgroupMin,aho.subgroupMul,aho.subgroupOr,aho.subgroupShuffle,aho.subgroupShuffleDown,aho.subgroupShuffleUp,aho.subgroupShuffleXor,aho.subgroupSize,aho.subgroupXor,aho.tan,aho.tangentGeometry,aho.tangentLocal,aho.tangentView,aho.tangentWorld,aho.texture,aho.texture3D,aho.textureBarrier,aho.textureBicubic,aho.textureBicubicLevel,aho.textureCubeUV,aho.textureLoad,aho.textureSize,aho.textureLevel,aho.textureStore,aho.thickness,aho.time,aho.toneMapping,aho.toneMappingExposure,aho.toonOutlinePass,aho.transformDirection,aho.transformNormal,aho.transformNormalToView,aho.transformedClearcoatNormalView,aho.transformedNormalView,aho.transformedNormalWorld,aho.transmission,aho.transpose,aho.triNoise3D,aho.triplanarTexture,aho.triplanarTextures,aho.trunc,aho.uint,aho.uintBitsToFloat,aho.uniform,aho.uniformArray,aho.uniformCubeTexture,aho.uniformGroup,aho.uniformFlow,aho.uniformTexture,aho.unpremultiplyAlpha,aho.userData,aho.uv,aho.uvec2,aho.uvec3,aho.uvec4,aho.varying,aho.varyingProperty,aho.vec2,aho.vec3;let ahr=aho.vec4;aho.vectorComponents,aho.velocity,aho.vertexColor,aho.vertexIndex,aho.vertexStage,aho.vibrance,aho.viewZToLogarithmicDepth,aho.viewZToOrthographicDepth,aho.viewZToPerspectiveDepth,aho.viewport,aho.viewportCoordinate,aho.viewportDepthTexture,aho.viewportLinearDepth,aho.viewportMipTexture,aho.viewportResolution,aho.viewportSafeUV,aho.viewportSharedTexture,aho.viewportSize,aho.viewportTexture,aho.viewportUV,aho.wgsl,aho.wgslFn,aho.workgroupArray,aho.workgroupBarrier,aho.workgroupId,aho.workingToColorSpace,aho.xor;let ahs=(0,w.createContext)(null),aht=({children:a,hideNotice:b=!1,style:c={},className:d="",...e})=>{let f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,x,y,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au=(0,w.useRef)(null),av=(0,w.useRef)(null),aw=(0,w.useMemo)(()=>"ombre-root-"+Math.random().toString(36).substring(7),[]),ax=(0,w.useRef)(null);null===ax.current&&(f=null,l={nodes:new Map,rootId:null,idToNodeId:new Map},m=new Map,n=null,o=null,p=null,q=!1,r=!1,s=!1,t=null,u=!1,x=!0,y=0,D=0,E=!1,F=0,G=!1,H=.5,I=.5,J=!1,K=!1,L=null,M=!1,N=new Wg,O=[],P=!1,Q=[],R=null,S=[],T=null,U=new Set,V=new Set,W=new Set,X=new Set,Y=null,Z=!1,$=(a,b)=>{a<=0||b<=0||a===y&&b===D||(Y={width:a,height:b},Z||(Z=!0,requestAnimationFrame(()=>{if(Z=!1,!Y)return;let{width:a,height:b}=Y;Y=null,y=a,D=b,s||(s=!0),g.setSize(a,b,!1);let c=a/b,d=2*c;h.left=-d/2,h.right=d/2,h.top=1,h.bottom=-1,h.updateProjectionMatrix(),j.scale.set(d,2,1),l.nodes.forEach(d=>{d.transformUniforms?.aspectRatio&&(d.transformUniforms.aspectRatio.value=c),d.resizeCallbacks.forEach(c=>{try{c({width:a,height:b})}catch(a){console.error("Error in resize callback:",a)}})}),ak().catch(console.warn)})))},_=a=>{let b,c;if(!g||!h||!j)return;let d=a[0];if(d){if(d.contentBoxSize){let a=Array.isArray(d.contentBoxSize)?d.contentBoxSize[0]:d.contentBoxSize;a?(b=Math.round(a.inlineSize),c=Math.round(a.blockSize)):(b=Math.round(d.contentRect.width),c=Math.round(d.contentRect.height))}else b=Math.round(d.contentRect.width),c=Math.round(d.contentRect.height);0===b||0===c||$(b,c)}},aa=a=>{let b=a[0];if(!b)return;let c=u;u=b.isIntersecting;let d=f?.getBoundingClientRect(),e=E;if(E=u&&!!d&&d.width>0&&d.height>0,u&&!c){if(G=!0,f){let{width:a,height:b}=f.getBoundingClientRect(),c=Math.round(a),d=Math.round(b);c>0&&d>0&&(0===y||0===D||c!==y||d!==D?($(c,d),!e&&E&&ad()):k&&q&&l.rootId&&(k.needsUpdate=!0,ad(),ak().catch(console.warn)))}x&&al()}else!u&&c&&am()},ab=()=>{X.forEach(a=>{try{a?.renderTarget?.dispose&&a.renderTarget.dispose()}catch{}}),X.clear()},ac=!1,ad=()=>{if(!(!l.rootId||!k||K)&&l.nodes.get(l.rootId)){if(0===y||0===D){ac||(ac=!0,requestAnimationFrame(()=>{ac=!1,y>0&&D>0&&ad()}));return}K=!0;try{X=new Set(W),W.clear();let a=new Set;V.clear(),l.nodes.forEach((a,b)=>{(a.requiresRTT||a.transformRTTActive)&&V.add(b)});let b=ah(l.rootId,new Set,a);if(b&&k){let c=!((a,b)=>{if(a.size!==b.size)return!1;for(let c of a)if(!b.has(c))return!1;return!0})(U,a),d=k.fragmentNode!==b;if(c||G||d){ab();try{k.dispose(),g.renderTarget&&g.renderTarget.dispose()}catch{}let c=new oN({transparent:!0});c.fragmentNode=b,c.needsUpdate=!0,j.material=c,k=c,G=!1,U=a}}}catch(a){console.error("Error composing shader tree:",a)}finally{K=!1}u&&ak().catch(console.warn)}},ae=a=>{let b=m.get(a);if(!b)return[];let c=[];for(let a of b){let b=l.nodes.get(a);b&&c.push(b)}return c},af=(a,b,c,d)=>{if(!b.metadata.mask?.source)return a;let e=(a=>{for(let[b,c]of l.nodes.entries())if(c.metadata.id===a)return b;return null})(b.metadata.mask.source);if(!e)return a;if(d.has(e))return console.error("Uh oh, looks like you've got a circular dependency in your shader masks."),a;let f=new Set(d);return f.add(c),function(a,b,c="alpha"){return(Wf[c]||Wf.alpha)(a,b)}(a,ah(e,f),b.metadata.mask.type||"alpha")},ag=(a,b)=>{var c,d,e,f,g,h,i,j;let k,l,m,n,o,p,q,r;if(!b.metadata.transform||!b.transformUniforms||!Wm(b.metadata.transform)&&!b.transformRTTActive)return a;let s=(k=A8(a),W.add(k),k),t=(c=Gu,d=b.transformUniforms.offsetX,e=b.transformUniforms.offsetY,f=b.transformUniforms.rotation,g=b.transformUniforms.scale,h=b.transformUniforms.anchorX,i=b.transformUniforms.anchorY,j=b.transformUniforms.aspectRatio,m=Wi(l=f.mul(Wl).div(Wk(180))),n=Wj(l),o=Wh(h,i),q=Wh((p=c.sub(o).div(g)).x.mul(j),p.y),r=Wh(q.x.mul(m).sub(q.y.mul(n)),q.x.mul(n).add(q.y.mul(m))),Wh(r.x.div(j),r.y).sub(Wh(d,e)).add(o));return IR(t,s.sample(t),s,b.transformUniforms.edges)},ah=(a,b=new Set,c)=>{if(0===y||0===D)return Ie(0,0,0,0);let d=l.nodes.get(a);if(!d)return Ie(0,0,0,0);let e=a=>{d.cleanupCallbacks.push(a)},h=a=>{d.beforeRenderCallbacks.push(a)},i=a=>{d.afterRenderCallbacks.push(a)},j=a=>{d.resizeCallbacks.push(a)},k=ae(a);if(0===k.length)return d.requiresRTT&&!E?Ie(0,0,0,0):(d.cleanupCallbacks.forEach(a=>{try{a()}catch(a){console.error("Error in cleanup callback:",a)}}),d.cleanupCallbacks=[],d.beforeRenderCallbacks=[],d.afterRenderCallbacks=[],d.resizeCallbacks=[],af(ag(d.fragmentNodeFunc({uniforms:d.uniforms??{},childNode:void 0,onCleanup:e,onBeforeRender:h,onAfterRender:i,onResize:j,canvas:f,dimensions:{width:y,height:D},renderer:g}),d),d,a,b));{let l=[...k].sort((a,b)=>a.metadata.renderOrder-b.metadata.renderOrder);if(null===d.parentId){let k;for(let a of l){let e;if(e=void 0===a.metadata.opacity?1:a.metadata.opacity,a.opacityUniform.value=e,!1===a.metadata.visible)continue;c&&c.add(a.id);let h=ae(a.id).length>0,i;if(h)i=ah(a.id,b,c);else if(a.requiresRTT&&!E)i=Ie(0,0,0,0);else{let c=b=>{a.cleanupCallbacks.push(b)},d=b=>{a.beforeRenderCallbacks.push(b)},e=b=>{a.afterRenderCallbacks.push(b)},h=b=>{a.resizeCallbacks.push(b)},j=k;a.requiresRTT&&void 0!==k&&(j=We(Ie(0,0,0,0),k,"normal",1)),a.cleanupCallbacks.forEach(a=>{try{a()}catch(a){console.error("Error in cleanup callback:",a)}}),a.cleanupCallbacks=[],a.beforeRenderCallbacks=[],a.afterRenderCallbacks=[],a.resizeCallbacks=[],i=af(ag(a.fragmentNodeFunc({uniforms:a.uniforms??{},childNode:j,onCleanup:c,onBeforeRender:d,onAfterRender:e,onResize:h,canvas:f,dimensions:{width:y,height:D},renderer:g}),a),a,a.id,b)}k=a.requiresChild&&"normal"===a.metadata.blendMode&&!h?We(Ie(0,0,0,0),i,"normal",a.opacityUniform):void 0===k?d.requiresRTT||1!==e?We(Ie(1,1,1,0),i,a.metadata.blendMode,a.opacityUniform):i:We(k,i,a.metadata.blendMode,a.opacityUniform)}return d.requiresRTT&&!E?Ie(0,0,0,0):(d.cleanupCallbacks.forEach(a=>{try{a()}catch(a){console.error("Error in cleanup callback:",a)}}),d.cleanupCallbacks=[],d.beforeRenderCallbacks=[],d.afterRenderCallbacks=[],d.resizeCallbacks=[],af(ag(d.fragmentNodeFunc({uniforms:d.uniforms??{},childNode:k,onCleanup:e,onBeforeRender:h,onAfterRender:i,onResize:j,canvas:f,dimensions:{width:y,height:D},renderer:g}),d),d,a,b))}{let k;for(let a of l){let e;if(e=void 0===a.metadata.opacity?1:a.metadata.opacity,a.opacityUniform.value=e,!1===a.metadata.visible)continue;c&&c.add(a.id);let h=ae(a.id).length>0,i;if(h)i=ah(a.id,b,c);else if(a.requiresRTT&&!E)i=Ie(0,0,0,0);else{let c=b=>{a.cleanupCallbacks.push(b)},d=b=>{a.beforeRenderCallbacks.push(b)},e=b=>{a.afterRenderCallbacks.push(b)},h=b=>{a.resizeCallbacks.push(b)},j=k;a.requiresRTT&&void 0!==k&&(j=We(Ie(0,0,0,0),k,"normal",1)),a.cleanupCallbacks=[],a.beforeRenderCallbacks=[],a.afterRenderCallbacks=[],a.resizeCallbacks=[],i=af(ag(a.fragmentNodeFunc({uniforms:a.uniforms??{},childNode:j,onCleanup:c,onBeforeRender:d,onAfterRender:e,onResize:h,canvas:f,dimensions:{width:y,height:D},renderer:g}),a),a,a.id,b)}k=a.requiresChild&&"normal"===a.metadata.blendMode&&!h?We(Ie(0,0,0,0),i,"normal",a.opacityUniform):void 0===k?d.requiresRTT||1!==e?We(Ie(1,1,1,0),i,a.metadata.blendMode,a.opacityUniform):i:We(k,i,a.metadata.blendMode,a.opacityUniform)}return d.requiresRTT&&!E?Ie(0,0,0,0):(d.cleanupCallbacks.forEach(a=>{try{a()}catch(a){console.error("Error in cleanup callback:",a)}}),d.cleanupCallbacks=[],d.beforeRenderCallbacks=[],d.afterRenderCallbacks=[],d.resizeCallbacks=[],af(ag(d.fragmentNodeFunc({uniforms:d.uniforms??{},childNode:k,onCleanup:e,onBeforeRender:h,onAfterRender:i,onResize:j,canvas:f,dimensions:{width:y,height:D},renderer:g}),d),d,a,b))}}},ai=(a,b,c,d,e={},f)=>{if(null===b){let b=O.findIndex(b=>b.id===a);return -1!==b?void O.splice(b,1):void aj(a)}if(!P){let g=O.findIndex(b=>b.id===a);-1===g?O.push({id:a,fragmentNodeFunc:b,parentId:c,metadata:d,uniforms:e,componentDefinition:f}):O[g]={id:a,fragmentNodeFunc:b,parentId:c,metadata:d,uniforms:e,componentDefinition:f};return}let g=0;if(null!==c){let a=m.get(c);if(a&&a.size>0){let b=0;for(let c of a){let a=l.nodes.get(c);a&&a.metadata.renderOrder>b&&(b=a.metadata.renderOrder)}g=b+1}}let h=H$(d?.opacity===void 0?1:d.opacity),i;if(d?.transform){let a=y/Math.max(1,D);i={offsetX:H$(d.transform.offsetX),offsetY:H$(d.transform.offsetY),rotation:H$(d.transform.rotation),scale:H$(d.transform.scale),anchorX:H$(d.transform.anchorX),anchorY:H$(d.transform.anchorY),edges:H$("stretch"===d.transform.edges?0:"transparent"===d.transform.edges?1:"mirror"===d.transform.edges?2:3),aspectRatio:H$(a)}}let j={id:a,componentName:f?.name||"Unknown",fragmentNodeFunc:b,parentId:c,requiresRTT:f?.requiresRTT||!1,requiresChild:f?.requiresChild||!1,opacityUniform:h,metadata:{blendMode:d?.blendMode||"normal",opacity:d?.opacity,visible:d?.visible!==!1,id:d?.id,mask:d?.mask,renderOrder:d?.renderOrder===void 0?g:d?.renderOrder,transform:d?.transform},uniforms:e,cleanupCallbacks:[],beforeRenderCallbacks:[],afterRenderCallbacks:[],resizeCallbacks:[],transformUniforms:i,transformRTTActive:!1};l.nodes.set(a,j),null===c&&(l.rootId=a);let n=m.get(c)||new Set;n.add(a),m.set(c,n),k&&q&&y>0&&D>0?(Q.includes(a)||Q.push(a),null===R&&(R=requestAnimationFrame(()=>{R=null,Q=[],ad()}))):k&&q&&(ac||(ac=!0,requestAnimationFrame(()=>{ac=!1,y>0&&D>0&&ad()})))},aj=a=>{if(!l.nodes.has(a))return;let b=l.nodes.get(a);if(b&&b.cleanupCallbacks.length>0)for(let c of b.cleanupCallbacks)try{c()}catch(b){console.error(`Error executing cleanup callback for node ${a}:`,b)}for(let b of ae(a))aj(b.id);if(l.rootId===a&&(l.rootId=null),b){let c=m.get(b.parentId);c&&(c.delete(a),0===c.size&&m.delete(b.parentId))}l.nodes.delete(a),k&&q&&ad()},ak=async()=>{if(!(q&&g&&i&&h&&k&&y>0&&D>0&&u))return;let a=M?performance.now():0,b=a||performance.now(),c=Math.min(F>0?(b-F)/1e3:.016,.1);F=b,M&&performance.mark("shader-cpu-start"),(a=>{let b={deltaTime:a,pointer:{x:H,y:I},pointerActive:J,dimensions:{width:y,height:D}};for(let a of l.nodes.values())if(a.beforeRenderCallbacks.length>0)for(let c of a.beforeRenderCallbacks)try{c(b)}catch(b){console.error(`Error executing before render callback for node ${a.id}:`,b)}})(c);try{if(K)return;if(M&&performance.mark("shader-gpu-start"),g.render(i,h),(a=>{let b={deltaTime:a,pointer:{x:H,y:I},pointerActive:J,dimensions:{width:y,height:D}};for(let a of l.nodes.values())if(a.afterRenderCallbacks.length>0)for(let c of a.afterRenderCallbacks)try{c(b)}catch(b){console.error(`Error executing after render callback for node ${a.id}:`,b)}})(c),M){if(performance.mark("shader-gpu-end"),g instanceof y0)try{let a=g.backend;if(a&&a.get&&a.get(g)){let b=a.get(g);if(b?.timestampQuery){let a=b.timestampQuery.getResult();null!=a&&N.recordGpuTime(a/1e6)}}}catch{}try{performance.measure("shader-gpu-time","shader-gpu-start","shader-gpu-end");let a=performance.getEntriesByName("shader-gpu-time")[0];a&&N.recordGpuTime(a.duration),performance.clearMarks("shader-gpu-start"),performance.clearMarks("shader-gpu-end"),performance.clearMeasures("shader-gpu-time")}catch{}}if(M){performance.mark("shader-cpu-end");try{performance.measure("shader-cpu-time","shader-cpu-start","shader-cpu-end");let a=performance.getEntriesByName("shader-cpu-time")[0];a&&N.recordCpuTime(a.duration),performance.clearMarks("shader-cpu-start"),performance.clearMarks("shader-cpu-end"),performance.clearMeasures("shader-cpu-time")}catch{}let b=performance.now()-a;N.recordFrame(b)}}catch(a){console.error("Render frame error:",a)}},al=()=>{if(n||!x||!u)return;N.setRendering(!0);let a=()=>{n=requestAnimationFrame(a),ak().catch(console.warn)};a()},am=()=>{n&&(cancelAnimationFrame(n),n=null),N.setRendering(!1)},an=a=>{let b,c;if(!f)return;if("touches"in a){if(0===a.touches.length)return;b=a.touches[0].clientX,c=a.touches[0].clientY}else b=a.clientX,c=a.clientY;let d=f.getBoundingClientRect(),e=(b-d.left)/d.width,g=(c-d.top)/d.height;H=e,I=g},ao=a=>{q&&f&&an(a)},ap=a=>{q&&f&&an(a)},aq=()=>{q&&(J=!1,ak().catch(console.warn))},ar=()=>{q&&(J=!1,ak().catch(console.warn))},as=()=>{J=!0,ak().catch(console.warn)},at=()=>{J=!0,ak().catch(console.warn)},ax.current={initialize:async({canvas:a,enablePerformanceTracking:b=!1})=>{if(q||r)return;M=b,r=!0;let c=t=new AbortController;try{if(f=a,(i=new d0).background=null,(h=new e$(-1,1,1,-1,.1,10)).position.z=1,h.lookAt(0,0,0),L=Wu.register({onMouseMove:ao,onTouchMove:ap,onMouseUp:aq,onTouchEnd:ar}),a.addEventListener("mousedown",as),a.addEventListener("touchstart",at),c.signal.aborted)return;try{let b={canvas:a,antialias:!0,alpha:!0,depth:!1,powerPreference:"high-performance"};if(M&&(b.forceWebGL=!1,b.requiredFeatures=["timestamp-query"]),g=new y0(b),await g.init(),c.signal.aborted)return}catch(b){if(c.signal.aborted)return;console.warn("[Shaders] WebGPU initialization failed, falling back to WebGL:",b);try{if(g=new N4({canvas:a,antialias:!0,alpha:!0,depth:!1,powerPreference:"high-performance"}),c.signal.aborted)return}catch(a){if(c.signal.aborted)return;console.error("[Shaders] Both WebGPU and WebGL initialization failed:",a);return}}if(c.signal.aborted)return;g.setPixelRatio(Math.min(window.devicePixelRatio,2)),g.outputColorSpace=br,(k=new oN({transparent:!0})).fragmentNode=Ie(0,0,0,0),j=new dM(new en(2,2),k),i.add(j);let b=a.parentElement;if(!b)return void console.warn("[Shaders] Canvas has no parent element for resize observation");(o=new ResizeObserver(_)).observe(b),(p=new IntersectionObserver(aa,{threshold:0})).observe(a);let d=a.getBoundingClientRect();E=(u=d.width>0&&d.height>0&&d.top<window.innerHeight&&d.bottom>0&&d.left<window.innerWidth&&d.right>0)&&d.width>0&&d.height>0,x=!window.matchMedia?.("(prefers-reduced-motion: reduce)").matches;let{width:e,height:l}=a.getBoundingClientRect(),m=Math.round(e),n=Math.round(l);m>0&&n>0?($(m,n),s=!0,await ak()):s=!1,x&&u&&al(),c.signal.aborted||(q=!0,P=!0,(()=>{if(0===O.length)return;let a=[...O];for(let{id:b,fragmentNodeFunc:c,parentId:d,metadata:e,uniforms:f,componentDefinition:g}of(O=[],a))c&&ai(b,c,d,e,f,g)})())}catch(a){console.error("[Shaders] Initialization error:",a)}finally{r=!1,t===c&&(t=null)}},cleanup:()=>{if(t&&t.abort(),o&&(o.disconnect(),o=null),p&&(p.disconnect(),p=null),L&&(L(),L=null),f&&(f.removeEventListener("mousedown",as),f.removeEventListener("touchstart",at)),am(),ab(),W.forEach(a=>{try{a?.renderTarget?.dispose&&a.renderTarget.dispose()}catch{}}),W.clear(),l.nodes.clear(),l.rootId=null,l.idToNodeId.clear(),m.clear(),O=[],P=!1,Q=[],null!==R&&(cancelAnimationFrame(R),R=null),S=[],null!==T&&(cancelAnimationFrame(T),T=null),Y=null,Z=!1,j){i&&i.remove(j);try{j.geometry&&"function"==typeof j.geometry.dispose&&j.geometry.dispose()}catch{}try{j.material instanceof dh&&"function"==typeof j.material.dispose&&j.material.dispose()}catch{}}if(g&&"function"==typeof g.dispose)try{g.dispose()}catch{}f=null,g=null,h=null,i=null,j=null,k=null,q=!1,r=!1,s=!1,t=null,y=0,D=0,u=!1,x=!0,H=.5,I=.5,J=!1},registerNode:ai,removeNode:aj,updateUniformValue:(a,b,c)=>{let d=l.nodes.get(a);if(!d||!d.uniforms)return;let e=d.uniforms[b];if(!(!e||!e.uniform)){if(e.transform){let{updateUniformValue:a}=(Ws(),((a,b,c,d)=>{if(b&&"object"==typeof b||"function"==typeof b)for(var e,f=B(b),g=0,h=f.length;g<h;g++)e=f[g],C.call(a,e)||e===c||z(a,e,{get:(a=>b[a]).bind(null,e),enumerable:!(d=A(b,e))||d.enumerable});return a})(z({},"__esModule",{value:!0}),Wn));a(e,c)}else e.uniform.value=c;u&&ak()}},updateNodeMetadata:(a,b)=>{let c=l.nodes.get(a);if(!c)return;let d=!1;void 0!==b.blendMode&&c.metadata.blendMode!==b.blendMode&&(c.metadata.blendMode=b.blendMode,d=!0),void 0!==b.opacity&&c.metadata.opacity!==b.opacity&&(c.metadata.opacity=b.opacity,c.opacityUniform.value=b.opacity),void 0!==b.renderOrder&&c.metadata.renderOrder!==b.renderOrder&&(c.metadata.renderOrder=b.renderOrder,d=!0);let e=!1!==b.visible;if(c.metadata.visible!==e&&(c.metadata.visible=e,d=!0),void 0!==b.id&&c.metadata.id!==b.id&&(c.metadata.id=b.id,d=!0),void 0!==b.mask&&(c.metadata.mask?.source!==b.mask?.source||c.metadata.mask?.type!==b.mask?.type)&&(c.metadata.mask=b.mask,d=!0),void 0!==b.transform){let a=!!c.metadata.transform&&Wm(c.metadata.transform),e=Wm(b.transform);if(c.metadata.transform=b.transform,!c.transformUniforms&&b.transform){let a=y/Math.max(1,D);c.transformUniforms={offsetX:H$(b.transform.offsetX),offsetY:H$(b.transform.offsetY),rotation:H$(b.transform.rotation),scale:H$(b.transform.scale),anchorX:H$(b.transform.anchorX),anchorY:H$(b.transform.anchorY),edges:H$("stretch"===b.transform.edges?0:"transparent"===b.transform.edges?1:"mirror"===b.transform.edges?2:3),aspectRatio:H$(a)}}else c.transformUniforms&&(c.transformUniforms.offsetX.value=b.transform.offsetX,c.transformUniforms.offsetY.value=b.transform.offsetY,c.transformUniforms.rotation.value=b.transform.rotation,c.transformUniforms.scale.value=b.transform.scale,c.transformUniforms.anchorX.value=b.transform.anchorX,c.transformUniforms.anchorY.value=b.transform.anchorY,c.transformUniforms.edges.value="stretch"===b.transform.edges?0:"transparent"===b.transform.edges?1:"mirror"===b.transform.edges?2:3);e&&!c.transformRTTActive&&(c.transformRTTActive=!0,d=!0),a||!e||c.transformRTTActive||(d=!0)}d&&k&&q?(S.includes(a)||S.push(a),null===T&&(T=requestAnimationFrame(()=>{T=null,S=[],ad()}))):u&&ak()},showLicenseWarning:()=>{!(()=>{try{{let{MODE:a,DEV:b}={DEV:!1,MODE:"production"};return b||"development"===a}}catch{return!1}})()||Wt||(console.warn("Shaders is running in development mode. Please purchase a license at https://shaders.com to use it in production."),Wt=!0)},isInitialized:()=>q,startAnimation:al,stopAnimation:am,getPerformanceStats:()=>{let a,b;a=Math.max(0,l.nodes.size-1),b=V.size,N.updateNodeCounts(a,b);let c=g?.info;return N.getStats(c)},getNodeRegistry:()=>({nodes:new Map(l.nodes)}),getRendererType:()=>g?g instanceof y0?"webgpu":"webgl":null});let ay=(0,w.useRef)(null),az=(0,w.useMemo)(()=>(a,b,c,d,e=null,f=null)=>{if(null===b){try{ax.current.removeNode(a)}catch(a){console.warn("Error removing node:",a)}return}try{ax.current.registerNode(a,b,c,d,e,f)}catch(b){console.error("Error registering node:",b,{id:a,parentId:c,metadata:d})}},[]),aA=(0,w.useMemo)(()=>(a,b,c)=>{try{ax.current.updateUniformValue(a,b,c)}catch(a){console.warn("Error updating uniform:",a)}},[]),aB=(0,w.useMemo)(()=>(a,b)=>{try{ax.current.updateNodeMetadata(a,b)}catch(a){console.warn("Error updating metadata:",a)}},[]),aC=(0,w.useMemo)(()=>({ombreParentId:aw,ombreNodeRegister:az,ombreUniformUpdate:aA,ombreMetadataUpdate:aB}),[aw,az,aA,aB]),aD=(0,w.useRef)(!1),aE=(0,w.useRef)(!1),aF=(0,w.useRef)(!1),aG=(0,w.useRef)(!1),aH=(0,w.useRef)(null),aI=async()=>{let a=av.current;if(!(!a||aD.current||aE.current)){aE.current=!0;try{let c=ax.current;c.isInitialized()||await c.initialize({canvas:a}),c.registerNode(aw,({childNode:a})=>a||ahr(0,0,0,0),null,null,{}),aD.current=!0,aE.current=!1,b||c.showLicenseWarning()}catch(a){throw console.error("[Shader] Initialization failed:",a),aE.current=!1,a}}};return(0,w.useEffect)(()=>{let a;aF.current=!1;let b=au.current;if(!b)return;let c=b.getBoundingClientRect();return c.width>0&&c.height>0?(aI().catch(console.error),aG.current=!0):aG.current=!1,(a=au.current)&&!aH.current&&(aH.current=new IntersectionObserver(b=>{let c=b[0];if(!c)return;let d=a.getBoundingClientRect(),e=c.isIntersecting&&d&&d.width>0&&d.height>0;e&&!aG.current?(ax.current.isInitialized()?ax.current.startAnimation():aI().catch(console.error),aG.current=!0):!e&&aG.current&&(ax.current.stopAnimation(),aG.current=!1)},{threshold:0}),aH.current.observe(a)),()=>{if(!aF.current){if(aF.current=!0,ay.current&&(ay.current.stop(),ay.current=null),aH.current&&(aH.current.disconnect(),aH.current=null),ax.current&&aD.current)try{ax.current.cleanup()}catch(a){console.warn("[Shader] Error during cleanup:",a)}aD.current=!1,aE.current=!1}}},[]),(0,w.useEffect)(()=>{if(!b&&ax.current&&aD.current)try{ax.current.showLicenseWarning()}catch{}},[b]),(0,v.jsx)(ahs.Provider,{value:aC,children:(0,v.jsxs)("div",{ref:au,className:"shader"+(d?" "+d:""),style:c,...e,children:[(0,v.jsx)("canvas",{"data-renderer":"shaders",ref:av,style:{width:"100%",height:"100%",display:"block"}}),a]})})},ahu={blendMode:"normal",renderOrder:0,visible:!0};try{Rf&&Rf.props&&Object.entries(Rf.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahu[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahv={blendMode:"normal",renderOrder:0,visible:!0};try{Rg&&Rg.props&&Object.entries(Rg.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahv[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahw={blendMode:"normal",renderOrder:0,visible:!0};try{Rw&&Rw.props&&Object.entries(Rw.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahw[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahx={blendMode:"normal",renderOrder:0,visible:!0};try{Rx&&Rx.props&&Object.entries(Rx.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahx[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahy={blendMode:"normal",renderOrder:0,visible:!0};try{Ry&&Ry.props&&Object.entries(Ry.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahy[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahz={blendMode:"normal",renderOrder:0,visible:!0};try{RE&&RE.props&&Object.entries(RE.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahz[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahA={blendMode:"normal",renderOrder:0,visible:!0};try{Rz&&Rz.props&&Object.entries(Rz.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahA[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahB={blendMode:"normal",renderOrder:0,visible:!0};try{RA&&RA.props&&Object.entries(RA.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahB[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahC={offsetX:0,offsetY:0,rotation:0,scale:1,anchorX:.5,anchorY:.5,edges:"transparent"},ahD={blendMode:"normal",renderOrder:0,visible:!0};try{RB&&RB.props&&Object.entries(RB.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahD[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahE=a=>{let b=(0,w.useContext)(ahs);if(!b)throw Error("Shader components must be used inside an <Shader> component or another shader component");let{ombreParentId:c,ombreNodeRegister:d,ombreUniformUpdate:e,ombreMetadataUpdate:f}=b,g=(0,w.useMemo)(()=>a.id||`${RB.name.toLowerCase()}_${Math.random().toString(36).substring(7)}`,[a.id]),h=(0,w.useMemo)(()=>(function(a,b){let c={...b};for(let[b,d]of Object.entries(a))"children"!==b&&"ref"!==b&&void 0!==d&&(c[b]=d);return c})(a,ahD),[a]),i=(0,w.useMemo)(()=>({...ahC,...a.transform}),[a.transform]),j=(0,w.useRef)(null);null===j.current&&(j.current=Wo(RB,h,g));let k=(0,w.useMemo)(()=>({...b,ombreParentId:g}),[b,g]);(0,w.useEffect)(()=>{if(j.current)try{let b={blendMode:a.blendMode||"normal",opacity:a.opacity,visible:!1!==a.visible,id:a.id,mask:a.maskSource?{source:a.maskSource,type:a.maskType||"alpha"}:void 0,renderOrder:a.renderOrder||0,transform:i};return d(g,RB.fragmentNode,c,b,j.current,RB),()=>{d(g,null,null,null,null)}}catch(a){return console.error("Error registering shader node:",a),()=>{}}},[g,c,d]);let l=(0,w.useRef)({});if((0,w.useEffect)(()=>{if(j.current)try{Object.entries(j.current).forEach(([a,b])=>{if(!b||"object"!=typeof b)return;let{uniform:c,transform:d}=b;if(c?.value!==void 0&&a in h){let b=h[a],c=l.current[a];b!==c&&(e(g,a,b),l.current[a]=b)}})}catch(a){console.error("Error updating uniforms:",a)}},[h,g,e]),(0,w.useEffect)(()=>{try{let b={blendMode:a.blendMode||"normal",opacity:a.opacity,visible:!1!==a.visible,id:a.id,mask:a.maskSource?{source:a.maskSource,type:a.maskType||"alpha"}:void 0,renderOrder:a.renderOrder||0,transform:i};f(g,b)}catch(a){console.error("Error updating metadata:",a)}},[a.blendMode,a.opacity,a.visible,a.maskSource,a.maskType,a.renderOrder,a.id,i,g,f]),a.ref&&"function"==typeof a.ref)try{a.ref(null)}catch{}return(0,v.jsx)(ahs.Provider,{value:k,children:a.children})},ahF={blendMode:"normal",renderOrder:0,visible:!0};try{RC&&RC.props&&Object.entries(RC.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahF[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahG={blendMode:"normal",renderOrder:0,visible:!0};try{RD&&RD.props&&Object.entries(RD.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahG[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahH={blendMode:"normal",renderOrder:0,visible:!0};try{RF&&RF.props&&Object.entries(RF.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahH[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahI={blendMode:"normal",renderOrder:0,visible:!0};try{RG&&RG.props&&Object.entries(RG.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahI[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahJ={blendMode:"normal",renderOrder:0,visible:!0};try{RH&&RH.props&&Object.entries(RH.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahJ[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahK={blendMode:"normal",renderOrder:0,visible:!0};try{RI&&RI.props&&Object.entries(RI.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahK[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahL={blendMode:"normal",renderOrder:0,visible:!0};try{RJ&&RJ.props&&Object.entries(RJ.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahL[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahM={blendMode:"normal",renderOrder:0,visible:!0};try{RK&&RK.props&&Object.entries(RK.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahM[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahN={blendMode:"normal",renderOrder:0,visible:!0};try{RL&&RL.props&&Object.entries(RL.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahN[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahO={blendMode:"normal",renderOrder:0,visible:!0};try{RM&&RM.props&&Object.entries(RM.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahO[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahP={blendMode:"normal",renderOrder:0,visible:!0};try{RN&&RN.props&&Object.entries(RN.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahP[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahQ={blendMode:"normal",renderOrder:0,visible:!0};try{RO&&RO.props&&Object.entries(RO.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahQ[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahR={blendMode:"normal",renderOrder:0,visible:!0};try{VE&&VE.props&&Object.entries(VE.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahR[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahS={blendMode:"normal",renderOrder:0,visible:!0};try{VF&&VF.props&&Object.entries(VF.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahS[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahT={blendMode:"normal",renderOrder:0,visible:!0};try{VG&&VG.props&&Object.entries(VG.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahT[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahU={blendMode:"normal",renderOrder:0,visible:!0};try{VH&&VH.props&&Object.entries(VH.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahU[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahV={blendMode:"normal",renderOrder:0,visible:!0};try{VI&&VI.props&&Object.entries(VI.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahV[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahW={blendMode:"normal",renderOrder:0,visible:!0};try{VJ&&VJ.props&&Object.entries(VJ.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahW[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahX={blendMode:"normal",renderOrder:0,visible:!0};try{VK&&VK.props&&Object.entries(VK.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahX[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahY={blendMode:"normal",renderOrder:0,visible:!0};try{VL&&VL.props&&Object.entries(VL.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahY[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ahZ={blendMode:"normal",renderOrder:0,visible:!0};try{VM&&VM.props&&Object.entries(VM.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ahZ[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ah$={blendMode:"normal",renderOrder:0,visible:!0};try{VN&&VN.props&&Object.entries(VN.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ah$[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ah_={blendMode:"normal",renderOrder:0,visible:!0};try{VO&&VO.props&&Object.entries(VO.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ah_[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ah0={blendMode:"normal",renderOrder:0,visible:!0};try{VP&&VP.props&&Object.entries(VP.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ah0[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ah1={blendMode:"normal",renderOrder:0,visible:!0};try{VQ&&VQ.props&&Object.entries(VQ.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ah1[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ah2={blendMode:"normal",renderOrder:0,visible:!0};try{VS&&VS.props&&Object.entries(VS.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ah2[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ah3={blendMode:"normal",renderOrder:0,visible:!0};try{VT&&VT.props&&Object.entries(VT.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ah3[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ah4={blendMode:"normal",renderOrder:0,visible:!0};try{VU&&VU.props&&Object.entries(VU.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ah4[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ah5={blendMode:"normal",renderOrder:0,visible:!0};try{VV&&VV.props&&Object.entries(VV.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ah5[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ah6={blendMode:"normal",renderOrder:0,visible:!0};try{VW&&VW.props&&Object.entries(VW.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ah6[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ah7={blendMode:"normal",renderOrder:0,visible:!0};try{VX&&VX.props&&Object.entries(VX.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ah7[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ah8={blendMode:"normal",renderOrder:0,visible:!0};try{VY&&VY.props&&Object.entries(VY.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ah8[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let ah9={blendMode:"normal",renderOrder:0,visible:!0};try{VZ&&VZ.props&&Object.entries(VZ.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(ah9[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let aia={blendMode:"normal",renderOrder:0,visible:!0};try{V$&&V$.props&&Object.entries(V$.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(aia[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let aib={blendMode:"normal",renderOrder:0,visible:!0};try{V_&&V_.props&&Object.entries(V_.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(aib[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let aic={offsetX:0,offsetY:0,rotation:0,scale:1,anchorX:.5,anchorY:.5,edges:"transparent"},aid={blendMode:"normal",renderOrder:0,visible:!0};try{V0&&V0.props&&Object.entries(V0.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(aid[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let aie=a=>{let b=(0,w.useContext)(ahs);if(!b)throw Error("Shader components must be used inside an <Shader> component or another shader component");let{ombreParentId:c,ombreNodeRegister:d,ombreUniformUpdate:e,ombreMetadataUpdate:f}=b,g=(0,w.useMemo)(()=>a.id||`${V0.name.toLowerCase()}_${Math.random().toString(36).substring(7)}`,[a.id]),h=(0,w.useMemo)(()=>(function(a,b){let c={...b};for(let[b,d]of Object.entries(a))"children"!==b&&"ref"!==b&&void 0!==d&&(c[b]=d);return c})(a,aid),[a]),i=(0,w.useMemo)(()=>({...aic,...a.transform}),[a.transform]),j=(0,w.useRef)(null);null===j.current&&(j.current=Wo(V0,h,g));let k=(0,w.useMemo)(()=>({...b,ombreParentId:g}),[b,g]);(0,w.useEffect)(()=>{if(j.current)try{let b={blendMode:a.blendMode||"normal",opacity:a.opacity,visible:!1!==a.visible,id:a.id,mask:a.maskSource?{source:a.maskSource,type:a.maskType||"alpha"}:void 0,renderOrder:a.renderOrder||0,transform:i};return d(g,V0.fragmentNode,c,b,j.current,V0),()=>{d(g,null,null,null,null)}}catch(a){return console.error("Error registering shader node:",a),()=>{}}},[g,c,d]);let l=(0,w.useRef)({});if((0,w.useEffect)(()=>{if(j.current)try{Object.entries(j.current).forEach(([a,b])=>{if(!b||"object"!=typeof b)return;let{uniform:c,transform:d}=b;if(c?.value!==void 0&&a in h){let b=h[a],c=l.current[a];b!==c&&(e(g,a,b),l.current[a]=b)}})}catch(a){console.error("Error updating uniforms:",a)}},[h,g,e]),(0,w.useEffect)(()=>{try{let b={blendMode:a.blendMode||"normal",opacity:a.opacity,visible:!1!==a.visible,id:a.id,mask:a.maskSource?{source:a.maskSource,type:a.maskType||"alpha"}:void 0,renderOrder:a.renderOrder||0,transform:i};f(g,b)}catch(a){console.error("Error updating metadata:",a)}},[a.blendMode,a.opacity,a.visible,a.maskSource,a.maskType,a.renderOrder,a.id,i,g,f]),a.ref&&"function"==typeof a.ref)try{a.ref(null)}catch{}return(0,v.jsx)(ahs.Provider,{value:k,children:a.children})},aif={blendMode:"normal",renderOrder:0,visible:!0};try{V1&&V1.props&&Object.entries(V1.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(aif[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let aig={blendMode:"normal",renderOrder:0,visible:!0};try{V2&&V2.props&&Object.entries(V2.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(aig[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let aih={blendMode:"normal",renderOrder:0,visible:!0};try{V3&&V3.props&&Object.entries(V3.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(aih[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let aii={blendMode:"normal",renderOrder:0,visible:!0};try{V4&&V4.props&&Object.entries(V4.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(aii[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let aij={blendMode:"normal",renderOrder:0,visible:!0};try{V5&&V5.props&&Object.entries(V5.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(aij[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}let aik={blendMode:"normal",renderOrder:0,visible:!0};try{V6&&V6.props&&Object.entries(V6.props).forEach(([a,b])=>{b&&"object"==typeof b&&"default"in b&&(aik[a]=b.default)})}catch(a){console.warn("Error extracting default props:",a)}function ail(){let[a,b]=(0,w.useState)(!1),c=(0,w.useRef)(null);return(0,w.useEffect)(()=>{let a=()=>{if(c.current){let a=c.current.querySelector("canvas");if(a&&a.width>0&&a.height>0)return b(!0),!0}return!1};if(a())return;let d=setInterval(()=>{a()&&clearInterval(d)},100),e=setTimeout(()=>{b(!0)},1500);return()=>{clearInterval(d),clearTimeout(e)}},[]),(0,v.jsxs)("div",{ref:c,className:`fixed inset-0 z-0 transition-opacity duration-700 ${a?"opacity-100":"opacity-0"}`,style:{contain:"strict"},children:[(0,v.jsxs)(aht,{className:"h-dvh w-dvw",children:[(0,v.jsx)(aie,{colorA:"#00665e",colorB:"#002924",speed:1,detail:1.5,blend:20,coarseX:40,coarseY:40,mediumX:40,mediumY:40,fineX:100,fineY:50,dithering:10}),(0,v.jsx)(ahE,{baseColor:"#7b2a41",upColor:"#d5859c",downColor:"#1f1f1f",leftColor:"#cedc00",rightColor:"#d6fffa",intensity:.8,radius:1.6,momentum:25,maskType:"alpha",opacity:.9})]}),(0,v.jsx)("div",{className:"bg-background/20 absolute inset-0"})]})}a.s(["default",()=>ail],34031)},93345,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.default=function({html:a,height:b=null,width:c=null,children:f,dataNtpc:g=""}){return(0,e.useEffect)(()=>{g&&performance.mark("mark_feature_usage",{detail:{feature:`next-third-parties-${g}`}})},[g]),(0,d.jsxs)(d.Fragment,{children:[f,a?(0,d.jsx)("div",{style:{height:null!=b?`${b}px`:"auto",width:null!=c?`${c}px`:"auto"},"data-ntpc":g,dangerouslySetInnerHTML:{__html:a}}):null]})};let d=a.r(87924),e=a.r(72131)},30089,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"setAttributesFromProps",{enumerable:!0,get:function(){return g}});let d={acceptCharset:"accept-charset",className:"class",htmlFor:"for",httpEquiv:"http-equiv",noModule:"noModule"},e=["onLoad","onReady","dangerouslySetInnerHTML","children","onError","strategy","stylesheets"];function f(a){return["async","defer","noModule"].includes(a)}function g(a,b){for(let[c,g]of Object.entries(b)){if(!b.hasOwnProperty(c)||e.includes(c)||void 0===g)continue;let h=d[c]||c.toLowerCase();"SCRIPT"===a.tagName&&f(h)?a[h]=!!g:a.setAttribute(h,String(g)),(!1===g||"SCRIPT"===a.tagName&&f(h)&&(!g||"false"===g))&&(a.setAttribute(h,""),a.removeAttribute(h))}}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},12962,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={cancelIdleCallback:function(){return g},requestIdleCallback:function(){return f}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f="undefined"!=typeof self&&self.requestIdleCallback&&self.requestIdleCallback.bind(window)||function(a){let b=Date.now();return self.setTimeout(function(){a({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-b))}})},1)},g="undefined"!=typeof self&&self.cancelIdleCallback&&self.cancelIdleCallback.bind(window)||function(a){return clearTimeout(a)};("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},96665,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={default:function(){return t},handleClientScriptLoad:function(){return q},initScriptLoader:function(){return r}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(33354),g=a.r(46058),h=a.r(87924),i=f._(a.r(35112)),j=g._(a.r(72131)),k=a.r(92966),l=a.r(30089),m=a.r(12962),n=new Map,o=new Set,p=a=>{let{src:b,id:c,onLoad:d=()=>{},onReady:e=null,dangerouslySetInnerHTML:f,children:g="",strategy:h="afterInteractive",onError:j,stylesheets:k}=a,m=c||b;if(m&&o.has(m))return;if(n.has(b)){o.add(m),n.get(b).then(d,j);return}let p=()=>{e&&e(),o.add(m)},q=document.createElement("script"),r=new Promise((a,b)=>{q.addEventListener("load",function(b){a(),d&&d.call(this,b),p()}),q.addEventListener("error",function(a){b(a)})}).catch(function(a){j&&j(a)});f?(q.innerHTML=f.__html||"",p()):g?(q.textContent="string"==typeof g?g:Array.isArray(g)?g.join(""):"",p()):b&&(q.src=b,n.set(b,r)),(0,l.setAttributesFromProps)(q,a),"worker"===h&&q.setAttribute("type","text/partytown"),q.setAttribute("data-nscript",h),k&&(a=>{if(i.default.preinit)return a.forEach(a=>{i.default.preinit(a,{as:"style"})})})(k),document.body.appendChild(q)};function q(a){let{strategy:b="afterInteractive"}=a;"lazyOnload"===b?window.addEventListener("load",()=>{(0,m.requestIdleCallback)(()=>p(a))}):p(a)}function r(a){a.forEach(q),[...document.querySelectorAll('[data-nscript="beforeInteractive"]'),...document.querySelectorAll('[data-nscript="beforePageRender"]')].forEach(a=>{let b=a.id||a.getAttribute("src");o.add(b)})}function s(a){let{id:b,src:c="",onLoad:d=()=>{},onReady:e=null,strategy:f="afterInteractive",onError:g,stylesheets:l,...n}=a,{updateScripts:q,scripts:r,getIsSsr:s,appDir:t,nonce:u}=(0,j.useContext)(k.HeadManagerContext);u=n.nonce||u;let v=(0,j.useRef)(!1);(0,j.useEffect)(()=>{let a=b||c;v.current||(e&&a&&o.has(a)&&e(),v.current=!0)},[e,b,c]);let w=(0,j.useRef)(!1);if((0,j.useEffect)(()=>{if(!w.current){if("afterInteractive"===f)p(a);else"lazyOnload"===f&&("complete"===document.readyState?(0,m.requestIdleCallback)(()=>p(a)):window.addEventListener("load",()=>{(0,m.requestIdleCallback)(()=>p(a))}));w.current=!0}},[a,f]),("beforeInteractive"===f||"worker"===f)&&(q?(r[f]=(r[f]||[]).concat([{id:b,src:c,onLoad:d,onReady:e,onError:g,...n,nonce:u}]),q(r)):s&&s()?o.add(b||c):s&&!s()&&p({...a,nonce:u})),t){if(l&&l.forEach(a=>{i.default.preinit(a,{as:"style"})}),"beforeInteractive"===f)if(!c)return n.dangerouslySetInnerHTML&&(n.children=n.dangerouslySetInnerHTML.__html,delete n.dangerouslySetInnerHTML),(0,h.jsx)("script",{nonce:u,dangerouslySetInnerHTML:{__html:`(self.__next_s=self.__next_s||[]).push(${JSON.stringify([0,{...n,id:b}])})`}});else return i.default.preload(c,n.integrity?{as:"script",integrity:n.integrity,nonce:u,crossOrigin:n.crossOrigin}:{as:"script",nonce:u,crossOrigin:n.crossOrigin}),(0,h.jsx)("script",{nonce:u,dangerouslySetInnerHTML:{__html:`(self.__next_s=self.__next_s||[]).push(${JSON.stringify([c,{...n,id:b}])})`}});"afterInteractive"===f&&c&&i.default.preload(c,n.integrity?{as:"script",integrity:n.integrity,nonce:u,crossOrigin:n.crossOrigin}:{as:"script",nonce:u,crossOrigin:n.crossOrigin})}return null}Object.defineProperty(s,"__nextScript",{value:!0});let t=s;("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},47283,(a,b,c)=>{b.exports=a.r(96665)},16941,(a,b,c)=>{"use strict";var d=a.e&&a.e.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(c,"__esModule",{value:!0}),c.sendGTMEvent=void 0,c.GoogleTagManager=function(a){let{gtmId:b,gtmScriptUrl:c,dataLayerName:d="dataLayer",auth:i,preview:j,dataLayer:k,nonce:l}=a;h=d;let m=new URL(c||"https://www.googletagmanager.com/gtm.js");return b&&m.searchParams.set("id",b),"dataLayer"!==d&&m.searchParams.set("l",d),i&&m.searchParams.set("gtm_auth",i),j&&(m.searchParams.set("gtm_preview",j),m.searchParams.set("gtm_cookies_win","x")),(0,f.useEffect)(()=>{performance.mark("mark_feature_usage",{detail:{feature:"next-third-parties-gtm"}})},[]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(g.default,{id:"_next-gtm-init",dangerouslySetInnerHTML:{__html:`
      (function(w,l){
        w[l]=w[l]||[];
        w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
        ${k?`w[l].push(${JSON.stringify(k)})`:""}
      })(window,'${d}');`},nonce:l}),(0,e.jsx)(g.default,{id:"_next-gtm","data-ntpc":"GTM",src:m.href,nonce:l})]})};let e=a.r(87924),f=a.r(72131),g=d(a.r(47283)),h="dataLayer";c.sendGTMEvent=(a,b)=>{let c=b||h;window[c]=window[c]||[],window[c].push(a)}},22942,(a,b,c)=>{"use strict";let d;var e=a.e&&a.e.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(c,"__esModule",{value:!0}),c.GoogleAnalytics=function(a){let{gaId:b,debugMode:c,dataLayerName:e="dataLayer",nonce:i}=a;return void 0===d&&(d=e),(0,g.useEffect)(()=>{performance.mark("mark_feature_usage",{detail:{feature:"next-third-parties-ga"}})},[]),(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(h.default,{id:"_next-ga-init",dangerouslySetInnerHTML:{__html:`
          window['${e}'] = window['${e}'] || [];
          function gtag(){window['${e}'].push(arguments);}
          gtag('js', new Date());

          gtag('config', '${b}' ${c?",{ 'debug_mode': true }":""});`},nonce:i}),(0,f.jsx)(h.default,{id:"_next-ga",src:`https://www.googletagmanager.com/gtag/js?id=${b}`,nonce:i})]})},c.sendGAEvent=function(){void 0===d?console.warn("@next/third-parties: GA has not been initialized"):window[d]?window[d].push(arguments):console.warn(`@next/third-parties: GA dataLayer ${d} does not exist`)};let f=a.r(87924),g=a.r(72131),h=e(a.r(47283))}];

//# sourceMappingURL=_ee2adebe._.js.map